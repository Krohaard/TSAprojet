var I=Object.defineProperty;var o=(l,e)=>I(l,"name",{value:e,configurable:!0});import{d as L}from"./vendor-primevue-D4_dEx5Z.js";import{r as h,w as R,d3 as k,b as A,bs as S,H as M,bP as O,c as b,d as y,p as z,bq as E,s as C,u as w,G as j,e as q}from"./vendor-other-CcUSxTdr.js";const x=""+new URL("images/default-template.png",import.meta.url).href;function B(l,e,t={}){const{immediate:a=!0,...s}=t,r=typeof window<"u"&&"IntersectionObserver"in window,c=h(!1);let n=null;const d=o(()=>{n&&(n.disconnect(),n=null)},"cleanup"),m=o(()=>{d(),!(!r||!l.value)&&(n=new IntersectionObserver(v=>{c.value=v.some(U=>U.isIntersecting),e(v,n)},s),n.observe(l.value))},"observe"),g=o(()=>{n&&l.value&&n.unobserve(l.value)},"unobserve");return a&&R(l,m,{immediate:!0,flush:"post"}),k(d),{isSupported:r,isIntersecting:c,observe:m,unobserve:g,cleanup:d}}o(B,"useIntersectionObserver");class D{static{o(this,"MediaCacheService")}cache=A(new Map);maxSize;maxAge;cleanupInterval=null;urlRefCount=new Map;constructor(e={}){this.maxSize=e.maxSize??100,this.maxAge=e.maxAge??30*60*1e3,this.startCleanupInterval()}startCleanupInterval(){this.cleanupInterval=window.setInterval(()=>{this.cleanup()},5*60*1e3)}cleanup(){const e=Date.now(),t=[];for(const[a,s]of Array.from(this.cache.entries()))e-s.lastAccessed>this.maxAge&&(s.objectUrl?(this.urlRefCount.get(s.objectUrl)||0)===0&&(URL.revokeObjectURL(s.objectUrl),this.urlRefCount.delete(s.objectUrl),t.push(a)):t.push(a));if(t.forEach(a=>this.cache.delete(a)),this.cache.size>this.maxSize){const a=Array.from(this.cache.entries());a.sort((c,n)=>c[1].lastAccessed-n[1].lastAccessed);let s=0;const r=this.cache.size-this.maxSize;for(const[c,n]of a){if(s>=r)break;n.objectUrl?(this.urlRefCount.get(n.objectUrl)||0)===0&&(URL.revokeObjectURL(n.objectUrl),this.urlRefCount.delete(n.objectUrl),this.cache.delete(c),s++):(this.cache.delete(c),s++)}}}async getCachedMedia(e){let t=this.cache.get(e);if(t)return t.lastAccessed=Date.now(),t;t={src:e,isLoading:!0,lastAccessed:Date.now()},this.cache.set(e,t);try{const a=await fetch(e,{cache:"force-cache"});if(!a.ok)throw new Error(`Failed to fetch: ${a.status}`);const s=await a.blob(),r=URL.createObjectURL(s),c={src:e,blob:s,objectUrl:r,isLoading:!1,lastAccessed:Date.now()};return this.cache.set(e,c),c}catch(a){console.warn("Failed to cache media:",e,a);const s={src:e,error:!0,isLoading:!1,lastAccessed:Date.now()};return this.cache.set(e,s),s}}acquireUrl(e){const t=this.cache.get(e);if(t?.objectUrl){const a=this.urlRefCount.get(t.objectUrl)||0;return this.urlRefCount.set(t.objectUrl,a+1),t.objectUrl}}releaseUrl(e){const t=this.cache.get(e);if(t?.objectUrl){const a=(this.urlRefCount.get(t.objectUrl)||1)-1;a<=0?(URL.revokeObjectURL(t.objectUrl),this.urlRefCount.delete(t.objectUrl),this.cache.delete(e)):this.urlRefCount.set(t.objectUrl,a)}}clearCache(){for(const e of Array.from(this.cache.values()))e.objectUrl&&URL.revokeObjectURL(e.objectUrl);this.cache.clear(),this.urlRefCount.clear()}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.clearCache()}}let u=null;function N(l){return u||(u=new D(l)),{getCachedMedia:o(r=>u.getCachedMedia(r),"getCachedMedia"),clearCache:o(()=>u.clearCache(),"clearCache"),acquireUrl:o(r=>u.acquireUrl(r),"acquireUrl"),releaseUrl:o(r=>u.releaseUrl(r),"releaseUrl"),cache:u.cache}}o(N,"useMediaCache");typeof window<"u"&&window.addEventListener("beforeunload",()=>{u&&u.destroy()});const F=["src","alt"],W={key:2,class:"absolute inset-0 flex items-center justify-center"},G=["alt"],V=S({__name:"LazyImage",props:{src:{},alt:{default:""},containerClass:{type:[Array,Object,String,Number,null,Boolean],default:""},imageClass:{type:[Array,Object,String,Number,null,Boolean],default:""},imageStyle:{},rootMargin:{default:"300px"}},setup(l){const e=h(null),t=h(null),a=h(!1),s=h(!1),r=h(!1),c=h(void 0),{getCachedMedia:n,acquireUrl:d,releaseUrl:m}=N();B(e,i=>{const f=i[0];a.value=f?.isIntersecting??!1},{rootMargin:l.rootMargin,threshold:.1});const g=M(()=>a.value);R(g,async i=>{if(i&&l.src&&!c.value&&!r.value)try{const f=await n(l.src);if(f.error)r.value=!0;else if(f.objectUrl){const p=d(l.src);c.value=p||f.objectUrl}else c.value=l.src}catch(f){console.warn("Failed to load cached media:",f),c.value=l.src}else i||(c.value?.startsWith("blob:")&&m(l.src),s.value=!1,c.value=void 0,r.value=!1)},{immediate:!0});const v=o(()=>{s.value=!0,r.value=!1},"onImageLoad"),U=o(()=>{r.value=!0,s.value=!1},"onImageError");return O(()=>{c.value?.startsWith("blob:")&&m(l.src)}),(i,f)=>(b(),y("div",{ref_key:"containerRef",ref:e,class:w(["relative flex h-full w-full items-center justify-center overflow-hidden",i.containerClass])},[s.value?C("",!0):(b(),z(E(L),{key:0,width:"100%",height:"100%",class:"absolute inset-0"})),c.value?(b(),y("img",{key:1,ref_key:"imageRef",ref:t,src:c.value,alt:i.alt,draggable:"false",class:w(i.imageClass),style:j(i.imageStyle),onLoad:v,onError:U},null,46,F)):C("",!0),r.value?(b(),y("div",W,[q("img",{src:x,alt:i.alt,draggable:"false",class:w(i.imageClass),style:j(i.imageStyle)},null,14,G)])):C("",!0)],2))}});export{x as _,V as a,B as u};
//# sourceMappingURL=LazyImage.vue_vue_type_script_setup_true_lang-BVGan4gh.js.map
