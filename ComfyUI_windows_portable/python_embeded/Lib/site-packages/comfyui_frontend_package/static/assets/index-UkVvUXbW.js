const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-B4KuK9HZ.js","./vendor-other-CcUSxTdr.js","./vendor-other-C4ppb7nW.css","./mathUtil-DlGw4Aca.js","./Load3D.vue_vue_type_script_setup_true_lang-Cnkq3Aau.js","./vendor-primevue-D4_dEx5Z.js","./Load3D-CS-OLjba.css","./audioUtils-Cdppfz5B.js","./audioService-CU-oljo0.js","./vendor-vue-BFtl7jfJ.js","./vendor-xterm-DV1MVhAx.js","./vendor-xterm-LZoznX6r.css","./vendor-three-zdhtZbSm.js","./vendor-tiptap-BLQhG9Oo.js","./index-B9SNoicH.css","./MediaVideoTop-B0UjJO0j.js","./MediaAudioTop-CtxDam9S.js","./MediaImageTop-DxVgiUyl.js","./Media3DTop-BoCKM1fD.js","./MediaVideoBottom-MWtP2JCQ.js","./MediaTitle.vue_vue_type_script_setup_true_lang-foQl-MlY.js","./MediaAudioBottom-CC2UhLc7.js","./MediaImageBottom-RZ8HpVO7.js","./Media3DBottom-BcH17akl.js","./WidgetButton-CO_p3EYg.js","./widgetPropFilter-CygYoMQt.js","./WidgetInputText-CQ2DMZbD.js","./index-Bq9c0rSj.js","./WidgetLayoutField.vue_vue_type_script_setup_true_lang-CyeRWKQg.js","./WidgetInputNumber-CWsi50jC.js","./WidgetInputNumber.vue_vue_type_script_setup_true_lang-BsOu6KNe.js","./WidgetInputNumber-Df2tetAs.css","./WidgetToggleSwitch-DneuOBzR.js","./WidgetSelect-CCfYw9j0.js","./WidgetSelect.vue_vue_type_script_setup_true_lang-1qEYTJtk.js","./LazyImage.vue_vue_type_script_setup_true_lang-BVGan4gh.js","./WidgetColorPicker-dZIEc4FM.js","./WidgetTextarea-CgQ7tNOm.js","./WidgetChart-BhgF-tyO.js","./WidgetImageCompare-BIqV6Oy9.js","./WidgetGalleria-C16n4C62.js","./WidgetGalleria-B85qzqLf.css","./WidgetMarkdown-BI0ARhBH.js","./WidgetLegacy-DUaZ0BYd.js","./WidgetRecordAudio-8vU9ms7V.js","./AudioPreviewPlayer-CejvjGwo.js","./nodeFilterUtil-D49mCu4H.js","./AudioPreviewPlayer-DH8_sxE0.css","./WidgetAudioUI-zk3asrva.js","./Load3D-Cv8D_vB1.js","./AboutPanel-CA8QIU54.js","./CreditsPanel-DtIWzS1h.js","./UserPanel-pAKycb4S.js","./UserAvatar.vue_vue_type_script_setup_true_lang-BRVc2hhq.js","./KeybindingPanel-qQrbj6Fg.js","./keybindingService-C6DMpW4T.js","./KeybindingPanel-Pxn1_Tu1.css","./ExtensionPanel-B5wIUQFP.js","./ServerConfigPanel-BjtPWljf.js","./serverConfigStore-4mCelzF0.js","./GraphView-JQ93MQWb.js","./GraphView-Dxs8bE_I.css","./UserSelectView-tIQVssmq.js"])))=>i.map(i=>d[i]);
var Ge=Object.defineProperty;var p=(i,o)=>Ge(i,"name",{value:o,configurable:!0});import{s as script,a as script$1,_ as __vitePreload,b as script$2,c as script$3,d as script$4,e as script$5,f as script$6,g as script$7,h as script$8,i as script$9,j as script$a,k as script$b,u as useToast,l as script$c,m as script$d,n as script$e,o as script$f,p as script$g,q as script$h,r as script$i,t as script$j,v as script$k,w as script$l,x as script$m,y as script$n,z as script$o,A as script$p,B as script$q,C as script$r,D as script$s,E as zodResolver,F as script$t,G as script$u,H as script$v,I as script$w,J as script$x,K as script$y,L as script$z,M as script$A,N as script$B,O as script$C,P as script$D,Q as script$E,R as script$F,S as script$G,T as script$H,U as script$I,V as script$J,W as definePreset,X as index,Y as Tooltip,Z as PrimeVue,$ as ConfirmationService,a0 as ToastService}from"./vendor-primevue-D4_dEx5Z.js";import{r as ref,H as computed,bs as defineComponent,j as resolveComponent,c as openBlock,d as createElementBlock,e as createBaseVNode,t as toDisplayString,bq as unref,A as createVNode,ci as axios,cj as get,ck as useAsyncState,cl as semver,p as createBlock,q as withCtx,z as renderList,F as Fragment,s as createCommentVNode,cm as useElementBounding,cn as z,co as fromZodError,cp as clamp,cq as YMap,cr as log,cs as Doc,ct as customRef,cu as applyUpdate,cv as encodeStateAsUpdate,cw as memoize,cx as pull,cy as toString,cz as toolkit,b9 as markRaw,ba as toRaw,cA as useLocalStorage,w as watch,cB as GoogleAuthProvider,cC as GithubAuthProvider,cD as setPersistence,cE as onAuthStateChanged,bi as onIdTokenChanged,bn as browserLocalPersistence,cF as FirebaseError,cG as AUTH_ERROR_CODES_MAP_DO_NOT_USE_INTERNALLY,cH as updatePassword,cI as deleteUser,cJ as signInWithEmailAndPassword,cK as createUserWithEmailAndPassword,cL as signInWithPopup,cM as signOut,cN as sendPasswordResetEmail,cO as useTimeoutFn,bg as onScopeDispose,cP as defaultWindow,cQ as useEventListener,cR as createSharedComposable,cS as whenever,cT as Fuse,cU as mergeModels,cV as useModel,cW as twMerge,cX as clsx,m as mergeProps,f as renderSlot,cY as useDebounceFn,o as onMounted,u as normalizeClass,cZ as merge,br as shallowReactive,bP as onUnmounted,c_ as debounce,c$ as useElementHover,k as resolveDirective,l as withDirectives,x as vShow,d0 as until,bp as shallowRef,L as toValue,d1 as useElementSize,d2 as useScroll,d3 as onBeforeUnmount,G as normalizeStyle,h as createTextVNode,d4 as vModelText,d5 as toRef$1,n as nextTick,E as withModifiers,i as inject,bu as provide,d6 as useSlots,d7 as useClipboard,d8 as isObject,bd as toRef$2,D as createSlots,v as resolveDynamicComponent,d9 as defineAsyncComponent,J as withKeys,da as useKeyModifier,db as refDebounced,dc as sortBy,dd as useResizeObserver,bb as isRef,de as dropTargetForElements,df as draggable,dg as setCustomNativeDragPreview,dh as DownloadStatus,y as Teleport,di as createStaticVNode,dj as onErrorCaptured,B as normalizeProps,b as reactive,a as readonly,dk as tryOnScopeDispose,dl as useTemplateRef,dm as watchEffect,dn as marked,dp as purify,dq as _Renderer,dr as mapKeys,bt as h,ds as render$3,dt as watchDebounced,du as triggerRef,dv as qs,dw as Ws,dx as Le,dy as h$1,dz as B,dA as c,dB as yo,dC as bf,dD as $s,dE as QuickLRU,dF as diff,dG as partition,dH as get$1,dI as pickBy,dJ as v4,dK as groupBy,dL as useStorage,dM as uniqBy,dN as isNil,dO as isEmpty,g as getCurrentInstance,dP as find,dQ as Suspense,dR as useCssVars,dS as useBreakpoints,dT as breakpointsTailwind,dU as useId,dV as stubTrue,dW as liteClient,dX as omit,dY as orderBy,dZ as flatMap,d_ as filter,d$ as map,e0 as some,e1 as useFavicon,e2 as initializeApp,e3 as createApp}from"./vendor-other-CcUSxTdr.js";import{u as useI18n,d as defineStore,c as createI18n,a as useFirebaseAuth,s as storeToRefs,b as createRouter,e as createWebHashHistory,f as createWebHistory,g as createPinia,i as init,V as VueFire,h as VueFireAuth}from"./vendor-vue-BFtl7jfJ.js";import{a as addonFitExports,x as xtermExports}from"./vendor-xterm-DV1MVhAx.js";import{A as AnimationMixer,L as LoopRepeat,P as PerspectiveCamera,O as OrthographicCamera,V as Vector3,a as OrbitControls,b as AmbientLight,D as DirectionalLight,G as GLTFLoader,c as OBJLoader,M as MTLLoader,F as FBXLoader,S as STLLoader,d as Mesh,e as Group,f as GLTFExporter,g as OBJExporter,h as STLExporter,T as TextureLoader,i as SpriteMaterial,j as Sprite,k as Scene,l as GridHelper,m as PlaneGeometry,n as MeshBasicMaterial,C as Color,o as DoubleSide,p as Material,q as Texture,r as SRGBColorSpace,E as EquirectangularReflectionMapping,N as NoToneMapping,s as MeshNormalMaterial,t as Vector2,u as MeshDepthMaterial,B as BasicDepthPacking,v as MeshStandardMaterial,w as LinearSRGBColorSpace,x as Box3,y as Light,z as Camera,H as ViewHelper,I as Clock,W as WebGLRenderer}from"./vendor-three-zdhtZbSm.js";import{M as Markdown,E as Editor,S as StarterKit,L as Link,T as Table,a as TableCell,b as TableHeader,c as TableRow}from"./vendor-tiptap-BLQhG9Oo.js";p(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}p(n,"getFetchOpts");function s(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}p(s,"processPreload")},"polyfill")();function isElectron(){return"electronAPI"in window&&window.electronAPI!==void 0}p(isElectron,"isElectron");function electronAPI(){return window.electronAPI}p(electronAPI,"electronAPI");function showNativeSystemMenu(){electronAPI()?.showContextMenu()}p(showNativeSystemMenu,"showNativeSystemMenu");function isNativeWindow(){return isElectron()&&!!window.navigator.windowControlsOverlay?.visible}p(isNativeWindow,"isNativeWindow");const DISTRIBUTION="localhost",isDesktop=isElectron(),isCloud=DISTRIBUTION==="cloud",remoteConfig=ref({});function configValueOrDefault(i,o,n){return i[o]||n}p(configValueOrDefault,"configValueOrDefault");const PROD_CONFIG={apiKey:"AIzaSyC2-fomLqgCjb7ELwta1I9cEarPK8ziTGs",authDomain:"dreamboothy.firebaseapp.com",databaseURL:"https://dreamboothy-default-rtdb.firebaseio.com",projectId:"dreamboothy",storageBucket:"dreamboothy.appspot.com",messagingSenderId:"357148958219",appId:"1:357148958219:web:f5917f72e5f36a2015310e",measurementId:"G-3ZBD3MBTG4"},BUILD_TIME_CONFIG=PROD_CONFIG;function getFirebaseConfig(){return BUILD_TIME_CONFIG}p(getFirebaseConfig,"getFirebaseConfig");function useExternalLink(){const{locale:i}=useI18n(),o=computed(()=>i.value==="zh"||i.value==="zh-TW"),n=computed(()=>isElectron()?electronAPI().getPlatform()==="darwin"?"macos":"windows":null);return{buildDocsUrl:p((r,l={})=>{const{includeLocale:u=!1,platform:m=!1}=l;let f="https://docs.comfy.org";u&&o.value&&(f+="/zh-CN");const _=r.startsWith("/")?r:`/${r}`;return f+=_,m&&n.value&&(f=f.endsWith("/")?f:`${f}/`,f+=n.value),f},"buildDocsUrl"),staticUrls:{discord:"https://www.comfy.org/discord",github:"https://github.com/comfyanonymous/ComfyUI",githubIssues:"https://github.com/comfyanonymous/ComfyUI/issues",githubFrontend:"https://github.com/Comfy-Org/ComfyUI_frontend",githubElectron:"https://github.com/Comfy-Org/electron",forum:"https://forum.comfy.org/",comfyOrg:"https://www.comfy.org/"}}}p(useExternalLink,"useExternalLink");const _hoisted_1$29={class:"flex h-110 max-w-96 flex-col gap-4 p-2"},_hoisted_2$1E={class:"mb-2 text-2xl font-medium"},_hoisted_3$18={class:"mb-4 text-base"},_hoisted_4$O={class:"flex items-center justify-between"},_hoisted_5$H={class:"flex gap-2"},_sfc_main$2G=defineComponent({__name:"ApiNodesSignInContent",props:{apiNodeNames:{},onLogin:{type:Function},onCancel:{type:Function}},setup(i){const{t:o}=useI18n(),{buildDocsUrl:n}=useExternalLink(),s=p(()=>{window.open(n("/tutorials/api-nodes/faq",{includeLocale:!0}),"_blank")},"handleLearnMoreClick");return(a,r)=>{const l=resolveComponent("ApiNodesList");return openBlock(),createElementBlock("div",_hoisted_1$29,[createBaseVNode("div",_hoisted_2$1E,toDisplayString(unref(o)("apiNodesSignInDialog.title")),1),createBaseVNode("div",_hoisted_3$18,toDisplayString(unref(o)("apiNodesSignInDialog.message")),1),createVNode(l,{"node-names":a.apiNodeNames},null,8,["node-names"]),createBaseVNode("div",_hoisted_4$O,[createVNode(unref(script),{label:unref(o)("g.learnMore"),link:"",onClick:s},null,8,["label"]),createBaseVNode("div",_hoisted_5$H,[createVNode(unref(script),{label:unref(o)("g.cancel"),outlined:"",severity:"secondary",onClick:r[0]||(r[0]=u=>a.onCancel?.())},null,8,["label"]),createVNode(unref(script),{label:unref(o)("g.login"),onClick:r[1]||(r[1]=u=>a.onLogin?.())},null,8,["label"])])])])}}}),supports_preview_metadata=!0,supports_manager_v4_ui=!0,defaultClientFeatureFlags={supports_preview_metadata,supports_manager_v4_ui},useToastStore=defineStore("toast",()=>{const i=ref([]),o=ref([]),n=ref(!1);function s(u){i.value=[...i.value,u]}p(s,"add");function a(u){o.value=[...o.value,u]}p(a,"remove");function r(){n.value=!0}p(r,"removeAll");function l(u){s({severity:"warn",summary:"Alert",detail:u})}return p(l,"addAlert"),{messagesToAdd:i,messagesToRemove:o,removeAllRequested:n,add:s,remove:a,removeAll:r,addAlert:l}});async function fetchHistoryV1(i,o=200,n){if(n!==void 0&&(n<0||!Number.isInteger(n)))throw new Error(`Invalid offset parameter: ${n}. Must be a non-negative integer.`);const s=new URLSearchParams({max_items:o.toString()});n!==void 0&&s.set("offset",n.toString());const a=`/history?${s.toString()}`,l=await(await i(a)).json();return{History:Object.values(l).map(u=>({...u,taskType:"History"}))}}p(fetchHistoryV1,"fetchHistoryV1");const fetchHistory=fetchHistoryV1;class UnauthorizedError extends Error{static{p(this,"UnauthorizedError")}}function addHeaderEntry(i,o,n){Array.isArray(i)?i.push([o,n]):i instanceof Headers?i.set(o,n):i[o]=n}p(addHeaderEntry,"addHeaderEntry");class PromptExecutionError extends Error{static{p(this,"PromptExecutionError")}response;constructor(o){super("Prompt execution failed"),this.response=o}toString(){let o="";typeof this.response.error=="string"?o+=this.response.error:this.response.error&&(o+=this.response.error.message+": "+this.response.error.details);for(const[n,s]of Object.entries(this.response.node_errors??[])){o+=`
`+s.class_type+":";for(const a of s.errors)o+=`
    - `+a.message+": "+a.details}return o}}class ComfyApi extends EventTarget{static{p(this,"ComfyApi")}#e=new Set;api_host;api_base;initialClientId;clientId;user;socket=null;authStoreComposable;reportedUnknownMessageTypes=new Set;getClientFeatureFlags(){return{...defaultClientFeatureFlags}}serverFeatureFlags={};authToken;apiKey;constructor(){super(),this.user="",this.api_host=location.host,this.api_base=location.pathname.split("/").slice(0,-1).join("/"),this.initialClientId=sessionStorage.getItem("clientId")}internalURL(o){return this.api_base+"/internal"+o}apiURL(o){return this.api_base+"/api"+o}fileURL(o){return this.api_base+o}async getAuthStore(){}async waitForAuthInitialization(){}async fetchApi(o,n){const s=n?.headers??{};return addHeaderEntry(s,"Comfy-User",this.user),fetch(this.apiURL(o),{cache:"no-cache",...n,headers:s})}addEventListener(o,n,s){super.addEventListener(o,n,s),this.#e.add(o)}removeEventListener(o,n,s){super.removeEventListener(o,n,s)}dispatchCustomEvent(o,n){const s=n===void 0?new CustomEvent(o):new CustomEvent(o,{detail:n});return super.dispatchEvent(s)}dispatchEvent(o){return super.dispatchEvent(o)}#t(){setInterval(async()=>{try{const n=await(await this.fetchApi("/prompt")).json();this.dispatchCustomEvent("status",n)}catch{this.dispatchCustomEvent("status",null)}},1e3)}async createSocket(o){if(this.socket)return;let n=!1,s=window.name;const a=new URLSearchParams;s&&a.set("clientId",s);const l=`${window.location.protocol==="https:"?"wss":"ws"}://${this.api_host}${this.api_base}/ws`,u=a.toString(),m=u?`${l}?${u}`:l;this.socket=new WebSocket(m),this.socket.binaryType="arraybuffer",this.socket.addEventListener("open",()=>{n=!0,this.socket.send(JSON.stringify({type:"feature_flags",data:this.getClientFeatureFlags()})),o&&this.dispatchCustomEvent("reconnected")}),this.socket.addEventListener("error",()=>{this.socket&&this.socket.close(),!o&&!n&&this.#t()}),this.socket.addEventListener("close",()=>{setTimeout(async()=>{this.socket=null,await this.createSocket(!0)},300),n&&(this.dispatchCustomEvent("status",null),this.dispatchCustomEvent("reconnecting"))}),this.socket.addEventListener("message",f=>{try{if(f.data instanceof ArrayBuffer){const _=new DataView(f.data),y=_.getUint32(0);let b;switch(y){case 3:const w=new TextDecoder,k=f.data.slice(4),S=_.getUint32(4);this.dispatchCustomEvent("progress_text",{nodeId:w.decode(k.slice(4,4+S)),text:w.decode(k.slice(4+S))});break;case 1:const C=_.getUint32(4),I=f.data.slice(8);switch(C){case 2:b="image/png";break;case 1:default:b="image/jpeg";break}const T=new Blob([I],{type:b});this.dispatchCustomEvent("b_preview",T);break;case 4:const E=new TextDecoder,N=_.getUint32(4),L=f.data.slice(8,8+N),A=JSON.parse(E.decode(L)),D=f.data.slice(8+N);let O=A.image_type;const M=new Blob([D],{type:O});this.dispatchCustomEvent("b_preview_with_metadata",{blob:M,nodeId:A.node_id,displayNodeId:A.display_node_id,parentNodeId:A.parent_node_id,realNodeId:A.real_node_id,promptId:A.prompt_id}),this.dispatchCustomEvent("b_preview",M);break;default:throw new Error(`Unknown binary websocket message of type ${y}`)}}else{const _=JSON.parse(f.data);switch(_.type){case"status":if(_.data.sid){const y=_.data.sid;this.clientId=y,window.name=y,sessionStorage.setItem("clientId",y)}this.dispatchCustomEvent("status",_.data.status??null);break;case"executing":this.dispatchCustomEvent("executing",_.data.display_node||_.data.node);break;case"execution_start":case"execution_error":case"execution_interrupted":case"execution_cached":case"execution_success":case"progress":case"progress_state":case"executed":case"graphChanged":case"promptQueued":case"logs":case"b_preview":case"notification":this.dispatchCustomEvent(_.type,_.data);break;case"feature_flags":this.serverFeatureFlags=_.data,this.serverFeatureFlags;break;default:if(this.#e.has(_.type))super.dispatchEvent(new CustomEvent(_.type,{detail:_.data}));else if(!this.reportedUnknownMessageTypes.has(_.type))throw this.reportedUnknownMessageTypes.add(_.type),new Error(`Unknown message type ${_.type}`)}}}catch(_){console.warn("Unhandled message:",f.data,_)}})}init(){this.createSocket()}async getExtensions(){return await(await this.fetchApi("/extensions",{cache:"no-store"})).json()}async getWorkflowTemplates(){return await(await this.fetchApi("/workflow_templates")).json()}async getCoreWorkflowTemplates(o){const n=o&&o!=="en"?`index.${o}.json`:"index.json";try{const s=await axios.get(this.fileURL(`/templates/${n}`));return s.headers["content-type"]?.includes("application/json")?s.data:[]}catch(s){return o&&o!=="en"?(console.warn(`Localized templates for '${o}' not found, falling back to English`),this.getCoreWorkflowTemplates()):(console.error("Error loading core workflow templates:",s),[])}}async getEmbeddings(){return await(await this.fetchApi("/embeddings",{cache:"no-store"})).json()}async getNodeDefs(){return await(await this.fetchApi("/object_info",{cache:"no-store"})).json()}async queuePrompt(o,n,s){const{output:a,workflow:r}=n,l={client_id:this.clientId??"",prompt:a,...s?.partialExecutionTargets&&{partial_execution_targets:s.partialExecutionTargets},extra_data:{auth_token_comfy_org:this.authToken,api_key_comfy_org:this.apiKey,extra_pnginfo:{workflow:r}}};o===-1?l.front=!0:o!=0&&(l.number=o);const u=await this.fetchApi("/prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(u.status!==200)throw new PromptExecutionError(await u.json());return await u.json()}async getModelFolders(){const o=await this.fetchApi("/experiment/models");if(o.status===404)return[];const n=["configs","custom_nodes"];return(await o.json()).filter(s=>!n.includes(s.name))}async getModels(o){const n=await this.fetchApi(`/experiment/models/${o}`);return n.status===404?[]:await n.json()}async viewMetadata(o,n){const s=await this.fetchApi(`/view_metadata/${o}?filename=${encodeURIComponent(n)}`),a=await s.text();if(!a)return null;try{return JSON.parse(a)}catch(r){return console.error("Error viewing metadata",s.status,s.statusText,a,r),null}}async getItems(o){return o==="queue"?this.getQueue():this.getHistory()}async getQueue(){try{const n=await(await this.fetchApi("/queue")).json(),s=p(a=>{if(!Array.isArray(a))return a;const r=a.slice(0,5),l=r[3],u=r[4];if(Array.isArray(l)&&u&&typeof u=="object"&&!Array.isArray(u)){const f={...u};return[r[0],r[1],r[2],f,l]}return r},"normalizeQueuePrompt");return{Running:n.queue_running.map(a=>{const r=s(a);return{taskType:"Running",prompt:r,remove:{name:"Cancel",cb:p(()=>api.interrupt(r[1]),"cb")}}}),Pending:n.queue_pending.map(a=>({taskType:"Pending",prompt:s(a)}))}}catch(o){return console.error(o),{Running:[],Pending:[]}}}async getHistory(o=200,n){try{return await fetchHistory(this.fetchApi.bind(this),o,n?.offset)}catch(s){return console.error(s),{History:[]}}}async getSystemStats(){return await(await this.fetchApi("/system_stats")).json()}async#o(o,n){try{await this.fetchApi("/"+o,{method:"POST",headers:{"Content-Type":"application/json"},body:n?JSON.stringify(n):void 0})}catch(s){console.error(s)}}async deleteItem(o,n){await this.#o(o,{delete:[n]})}async clearItems(o){await this.#o(o,{clear:!0})}async interrupt(o){await this.#o("interrupt",o?{prompt_id:o}:void 0)}async getUserConfig(){return(await this.fetchApi("/users")).json()}createUser(o){return this.fetchApi("/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o})})}async getSettings(){const o=await this.fetchApi("/settings");if(o.status==401)throw new UnauthorizedError(o.statusText);return await o.json()}async getSetting(o){return(await this.fetchApi(`/settings/${encodeURIComponent(o)}`)).json()}async storeSettings(o){return this.fetchApi("/settings",{method:"POST",body:JSON.stringify(o)})}async storeSetting(o,n){return this.fetchApi(`/settings/${encodeURIComponent(o)}`,{method:"POST",body:JSON.stringify(n)})}async getUserData(o,n){return this.fetchApi(`/userdata/${encodeURIComponent(o)}`,n)}async storeUserData(o,n,s={overwrite:!0,stringify:!0,throwOnError:!0,full_info:!1}){const a=await this.fetchApi(`/userdata/${encodeURIComponent(o)}?overwrite=${s.overwrite}&full_info=${s.full_info}`,{method:"POST",body:s?.stringify?JSON.stringify(n):n,...s});if(a.status!==200&&s.throwOnError!==!1)throw new Error(`Error storing user data file '${o}': ${a.status} ${(await a).statusText}`);return a}async deleteUserData(o){return await this.fetchApi(`/userdata/${encodeURIComponent(o)}`,{method:"DELETE"})}async moveUserData(o,n,s={overwrite:!1}){return await this.fetchApi(`/userdata/${encodeURIComponent(o)}/move/${encodeURIComponent(n)}?overwrite=${s?.overwrite}`,{method:"POST"})}async listUserDataFullInfo(o){const n=await this.fetchApi(`/userdata?dir=${encodeURIComponent(o)}&recurse=true&split=false&full_info=true`);if(n.status===404)return[];if(n.status!==200)throw new Error(`Error getting user data list '${o}': ${n.status} ${n.statusText}`);return n.json()}async getGlobalSubgraphData(o){const n=await api.fetchApi("/global_subgraphs/"+o);return n.status!==200?"":(await n.json())?.data??""}async getGlobalSubgraphs(){const o=await api.fetchApi("/global_subgraphs");if(o.status!==200)return{};const n=await o.json();for(const[s,a]of Object.entries(n))a.data||(a.data=this.getGlobalSubgraphData(s));return n}async getLogs(){const o=this.internalURL("/logs");return(await axios.get(o)).data}async getRawLogs(){const o=this.internalURL("/logs/raw");return(await axios.get(o)).data}async subscribeLogs(o){const n=this.internalURL("/logs/subscribe");return await axios.patch(n,{enabled:o,clientId:this.clientId})}async getFolderPaths(){const o=await axios.get(this.internalURL("/folder_paths")).catch(()=>null);return o?o.data:{}}async freeMemory(o){try{let n="";o.freeExecutionCache?n='{"unload_models": true, "free_memory": true}':n='{"unload_models": true}',(await this.fetchApi("/free",{method:"POST",headers:{"Content-Type":"application/json"},body:n})).status===200?o.freeExecutionCache?useToastStore().add({severity:"success",summary:"Models and Execution Cache have been cleared.",life:3e3}):useToastStore().add({severity:"success",summary:"Models have been unloaded.",life:3e3}):useToastStore().add({severity:"error",summary:"Unloading of models failed. Installed ComfyUI may be an outdated version.",life:5e3})}catch{useToastStore().add({severity:"error",summary:"An error occurred while trying to unload models.",life:5e3})}}async getCustomNodesI18n(){return(await axios.get(this.apiURL("/i18n"))).data}serverSupportsFeature(o){return get(this.serverFeatureFlags,o)===!0}getServerFeature(o,n){return get(this.serverFeatureFlags,o,n)}getServerFeatures(){return{...this.serverFeatureFlags}}}const api=new ComfyApi;window.comfyAPI=window.comfyAPI||{};window.comfyAPI.api=window.comfyAPI.api||{};window.comfyAPI.api.UnauthorizedError=UnauthorizedError;window.comfyAPI.api.PromptExecutionError=PromptExecutionError;window.comfyAPI.api.ComfyApi=ComfyApi;window.comfyAPI.api.api=api;const useSystemStatsStore=defineStore("systemStats",()=>{const i=p(async()=>{try{return await api.getSystemStats()}catch(u){throw console.error("Error fetching system stats:",u),u}},"fetchSystemStatsData"),{state:o,isLoading:n,error:s,isReady:a,execute:r}=useAsyncState(i,null,{immediate:!0});function l(){if(!o.value?.system?.os)return"other";const u=o.value.system.os.toLowerCase();if(isElectron()){if(u.includes("windows"))return"desktop-windows";if(u.includes("darwin")||u.includes("mac"))return"desktop-mac"}else{if(u.includes("windows"))return"git-windows";if(u.includes("darwin")||u.includes("mac"))return"git-mac";if(u.includes("linux"))return"git-linux"}return"other"}return p(l,"getFormFactor"),{systemStats:o,isLoading:n,error:s,isInitialized:a,refetchSystemStats:r,getFormFactor:l}}),_hoisted_1$28={class:"flex flex-col gap-2"},_hoisted_2$1D={class:"text-sm font-medium text-surface-600"},_hoisted_3$17={class:"ml-4 text-sm text-surface-500"},_sfc_main$2F=defineComponent({__name:"MissingCoreNodesMessage",props:{missingCoreNodes:{}},setup(i){const o=useSystemStatsStore(),n=computed(()=>Object.keys(i.missingCoreNodes).length>0),s=computed(()=>n.value?o.systemStats?.system?.comfyui_version??null:null),a=computed(()=>Object.entries(i.missingCoreNodes).sort(([l],[u])=>semver.compare(u,l))),r=p(l=>l.reduce((u,m)=>(m.type&&!u.includes(m.type)&&u.push(m.type),u),[]).sort(),"getUniqueNodeNames");return(l,u)=>n.value?(openBlock(),createBlock(unref(script$1),{key:0,severity:"info",icon:"pi pi-info-circle",class:"mx-2 my-2",pt:{root:{class:"flex-col"},text:{class:"flex-1"}}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$28,[createBaseVNode("div",null,toDisplayString(s.value?l.$t("loadWorkflowWarning.outdatedVersion",{version:s.value}):l.$t("loadWorkflowWarning.outdatedVersionGeneric")),1),(openBlock(!0),createElementBlock(Fragment,null,renderList(a.value,([m,f])=>(openBlock(),createElementBlock("div",{key:m,class:"ml-4"},[createBaseVNode("div",_hoisted_2$1D,toDisplayString(l.$t("loadWorkflowWarning.coreNodesFromVersion",{version:m||"unknown"})),1),createBaseVNode("div",_hoisted_3$17,toDisplayString(r(f).join(", ")),1)]))),128))])]),_:1})):createCommentVNode("",!0)}}),Comfy_3DViewer_Open3DViewer={label:"Open 3D Viewer (Beta) for Selected Node"},Comfy_BrowseModelAssets={label:"Experimental: Browse Model Assets"},Comfy_BrowseTemplates={label:"Browse Templates"},Comfy_Canvas_DeleteSelectedItems={label:"Delete Selected Items"},Comfy_Canvas_FitView={label:"Fit view to selected nodes"},Comfy_Canvas_Lock={label:"Lock Canvas"},Comfy_Canvas_MoveSelectedNodes_Down={label:"Move Selected Nodes Down"},Comfy_Canvas_MoveSelectedNodes_Left={label:"Move Selected Nodes Left"},Comfy_Canvas_MoveSelectedNodes_Right={label:"Move Selected Nodes Right"},Comfy_Canvas_MoveSelectedNodes_Up={label:"Move Selected Nodes Up"},Comfy_Canvas_ResetView={label:"Reset View"},Comfy_Canvas_Resize={label:"Resize Selected Nodes"},Comfy_Canvas_ToggleLinkVisibility={label:"Canvas Toggle Link Visibility"},Comfy_Canvas_ToggleLock={label:"Canvas Toggle Lock"},Comfy_Canvas_ToggleMinimap={label:"Canvas Toggle Minimap"},Comfy_Canvas_ToggleSelected_Pin={label:"Pin/Unpin Selected Items"},Comfy_Canvas_ToggleSelectedNodes_Bypass={label:"Bypass/Unbypass Selected Nodes"},Comfy_Canvas_ToggleSelectedNodes_Collapse={label:"Collapse/Expand Selected Nodes"},Comfy_Canvas_ToggleSelectedNodes_Mute={label:"Mute/Unmute Selected Nodes"},Comfy_Canvas_ToggleSelectedNodes_Pin={label:"Pin/Unpin Selected Nodes"},Comfy_Canvas_Unlock={label:"Unlock Canvas"},Comfy_Canvas_ZoomIn={label:"Zoom In"},Comfy_Canvas_ZoomOut={label:"Zoom Out"},Comfy_ClearPendingTasks={label:"Clear Pending Tasks"},Comfy_ClearWorkflow={label:"Clear Workflow"},Comfy_ContactSupport={label:"Contact Support"},Comfy_Dev_ShowModelSelector={label:"Show Model Selector (Dev)"},Comfy_DuplicateWorkflow={label:"Duplicate Current Workflow"},Comfy_ExportWorkflow={label:"Export Workflow"},Comfy_ExportWorkflowAPI={label:"Export Workflow (API Format)"},Comfy_Graph_ConvertToSubgraph={label:"Convert Selection to Subgraph"},Comfy_Graph_EditSubgraphWidgets={label:"Edit Subgraph Widgets"},Comfy_Graph_ExitSubgraph={label:"Exit Subgraph"},Comfy_Graph_FitGroupToContents={label:"Fit Group To Contents"},Comfy_Graph_GroupSelectedNodes={label:"Group Selected Nodes"},Comfy_Graph_ToggleWidgetPromotion={label:"Toggle promotion of hovered widget"},Comfy_Graph_UnpackSubgraph={label:"Unpack the selected Subgraph"},Comfy_GroupNode_ConvertSelectedNodesToGroupNode={label:"Convert selected nodes to group node"},Comfy_GroupNode_ManageGroupNodes={label:"Manage group nodes"},Comfy_GroupNode_UngroupSelectedGroupNodes={label:"Ungroup selected group nodes"},Comfy_Help_AboutComfyUI={label:"Open About ComfyUI"},Comfy_Help_OpenComfyOrgDiscord={label:"Open Comfy-Org Discord"},Comfy_Help_OpenComfyUIDocs={label:"Open ComfyUI Docs"},Comfy_Help_OpenComfyUIForum={label:"Open ComfyUI Forum"},Comfy_Help_OpenComfyUIIssues={label:"Open ComfyUI Issues"},Comfy_Interrupt={label:"Interrupt"},Comfy_LoadDefaultWorkflow={label:"Load Default Workflow"},Comfy_Manager_CustomNodesManager_ShowCustomNodesMenu={label:"Custom Nodes Manager"},Comfy_Manager_CustomNodesManager_ShowLegacyCustomNodesMenu={label:"Custom Nodes (Legacy)"},Comfy_Manager_ShowLegacyManagerMenu={label:"Manager Menu (Legacy)"},Comfy_Manager_ShowMissingPacks={label:"Install Missing Custom Nodes"},Comfy_Manager_ShowUpdateAvailablePacks={label:"Check for Custom Node Updates"},Comfy_Manager_ToggleManagerProgressDialog={label:"Toggle the Custom Nodes Manager Progress Bar"},Comfy_MaskEditor_BrushSize_Decrease={label:"Decrease Brush Size in MaskEditor"},Comfy_MaskEditor_BrushSize_Increase={label:"Increase Brush Size in MaskEditor"},Comfy_MaskEditor_OpenMaskEditor={label:"Open Mask Editor for Selected Node"},Comfy_Memory_UnloadModels={label:"Unload Models"},Comfy_Memory_UnloadModelsAndExecutionCache={label:"Unload Models and Execution Cache"},Comfy_NewBlankWorkflow={label:"New Blank Workflow"},Comfy_OpenClipspace={label:"Clipspace"},Comfy_OpenManagerDialog={label:"Manager"},Comfy_OpenWorkflow={label:"Open Workflow"},Comfy_PublishSubgraph={label:"Publish Subgraph"},Comfy_QueuePrompt={label:"Queue Prompt"},Comfy_QueuePromptFront={label:"Queue Prompt (Front)"},Comfy_QueueSelectedOutputNodes={label:"Queue Selected Output Nodes"},Comfy_Redo={label:"Redo"},Comfy_RefreshNodeDefinitions={label:"Refresh Node Definitions"},Comfy_SaveWorkflow={label:"Save Workflow"},Comfy_SaveWorkflowAs={label:"Save Workflow As"},Comfy_ShowSettingsDialog={label:"Show Settings Dialog"},Comfy_ToggleAssetAPI={label:"Experimental: Enable AssetAPI"},Comfy_ToggleCanvasInfo={label:"Canvas Performance"},Comfy_ToggleHelpCenter={label:"Help Center"},Comfy_ToggleLinear={label:"toggle linear mode"},Comfy_ToggleTheme={label:"Toggle Theme (Dark/Light)"},Comfy_Undo={label:"Undo"},Comfy_User_OpenSignInDialog={label:"Open Sign In Dialog"},Comfy_User_SignOut={label:"Sign Out"},Experimental_ToggleVueNodes={label:"Experimental: Enable Nodes 2.0"},Workspace_CloseWorkflow={label:"Close Current Workflow"},Workspace_NextOpenedWorkflow={label:"Next Opened Workflow"},Workspace_PreviousOpenedWorkflow={label:"Previous Opened Workflow"},Workspace_SearchBox_Toggle={label:"Toggle Search Box"},Workspace_ToggleBottomPanel={label:"Toggle Bottom Panel"},Workspace_ToggleBottomPanel_Shortcuts={label:"Show Keybindings Dialog"},Workspace_ToggleFocusMode={label:"Toggle Focus Mode"},Workspace_ToggleSidebarTab_assets={label:"Toggle Assets Sidebar",tooltip:"Assets"},Workspace_ToggleSidebarTab_workflows={label:"Toggle Workflows Sidebar",tooltip:"Workflows"},enCommands={Comfy_3DViewer_Open3DViewer,Comfy_BrowseModelAssets,Comfy_BrowseTemplates,Comfy_Canvas_DeleteSelectedItems,Comfy_Canvas_FitView,Comfy_Canvas_Lock,Comfy_Canvas_MoveSelectedNodes_Down,Comfy_Canvas_MoveSelectedNodes_Left,Comfy_Canvas_MoveSelectedNodes_Right,Comfy_Canvas_MoveSelectedNodes_Up,Comfy_Canvas_ResetView,Comfy_Canvas_Resize,Comfy_Canvas_ToggleLinkVisibility,Comfy_Canvas_ToggleLock,Comfy_Canvas_ToggleMinimap,Comfy_Canvas_ToggleSelected_Pin,Comfy_Canvas_ToggleSelectedNodes_Bypass,Comfy_Canvas_ToggleSelectedNodes_Collapse,Comfy_Canvas_ToggleSelectedNodes_Mute,Comfy_Canvas_ToggleSelectedNodes_Pin,Comfy_Canvas_Unlock,Comfy_Canvas_ZoomIn,Comfy_Canvas_ZoomOut,Comfy_ClearPendingTasks,Comfy_ClearWorkflow,Comfy_ContactSupport,Comfy_Dev_ShowModelSelector,Comfy_DuplicateWorkflow,Comfy_ExportWorkflow,Comfy_ExportWorkflowAPI,Comfy_Graph_ConvertToSubgraph,Comfy_Graph_EditSubgraphWidgets,Comfy_Graph_ExitSubgraph,Comfy_Graph_FitGroupToContents,Comfy_Graph_GroupSelectedNodes,Comfy_Graph_ToggleWidgetPromotion,Comfy_Graph_UnpackSubgraph,Comfy_GroupNode_ConvertSelectedNodesToGroupNode,Comfy_GroupNode_ManageGroupNodes,Comfy_GroupNode_UngroupSelectedGroupNodes,Comfy_Help_AboutComfyUI,Comfy_Help_OpenComfyOrgDiscord,Comfy_Help_OpenComfyUIDocs,Comfy_Help_OpenComfyUIForum,Comfy_Help_OpenComfyUIIssues,Comfy_Interrupt,Comfy_LoadDefaultWorkflow,Comfy_Manager_CustomNodesManager_ShowCustomNodesMenu,Comfy_Manager_CustomNodesManager_ShowLegacyCustomNodesMenu,Comfy_Manager_ShowLegacyManagerMenu,Comfy_Manager_ShowMissingPacks,Comfy_Manager_ShowUpdateAvailablePacks,Comfy_Manager_ToggleManagerProgressDialog,Comfy_MaskEditor_BrushSize_Decrease,Comfy_MaskEditor_BrushSize_Increase,Comfy_MaskEditor_OpenMaskEditor,Comfy_Memory_UnloadModels,Comfy_Memory_UnloadModelsAndExecutionCache,Comfy_NewBlankWorkflow,Comfy_OpenClipspace,Comfy_OpenManagerDialog,Comfy_OpenWorkflow,Comfy_PublishSubgraph,Comfy_QueuePrompt,Comfy_QueuePromptFront,Comfy_QueueSelectedOutputNodes,Comfy_Redo,Comfy_RefreshNodeDefinitions,Comfy_SaveWorkflow,Comfy_SaveWorkflowAs,Comfy_ShowSettingsDialog,Comfy_ToggleAssetAPI,Comfy_ToggleCanvasInfo,Comfy_ToggleHelpCenter,Comfy_ToggleLinear,Comfy_ToggleTheme,Comfy_Undo,Comfy_User_OpenSignInDialog,Comfy_User_SignOut,Experimental_ToggleVueNodes,Workspace_CloseWorkflow,Workspace_NextOpenedWorkflow,Workspace_PreviousOpenedWorkflow,Workspace_SearchBox_Toggle,Workspace_ToggleBottomPanel,Workspace_ToggleBottomPanel_Shortcuts,"Workspace_ToggleBottomPanelTab_command-terminal":{label:"Toggle Terminal Bottom Panel"},"Workspace_ToggleBottomPanelTab_logs-terminal":{label:"Toggle Logs Bottom Panel"},"Workspace_ToggleBottomPanelTab_shortcuts-essentials":{label:"Toggle Essential Bottom Panel"},"Workspace_ToggleBottomPanelTab_shortcuts-view-controls":{label:"Toggle View Controls Bottom Panel"},Workspace_ToggleFocusMode,Workspace_ToggleSidebarTab_assets,"Workspace_ToggleSidebarTab_model-library":{label:"Toggle Model Library Sidebar",tooltip:"Model Library"},"Workspace_ToggleSidebarTab_node-library":{label:"Toggle Node Library Sidebar",tooltip:"Node Library"},Workspace_ToggleSidebarTab_workflows},g={beta:"BETA",user:"User",currentUser:"Current user",empty:"Empty",noWorkflowsFound:"No workflows found.",comingSoon:"Coming Soon",download:"Download",downloadImage:"Download image",downloadVideo:"Download video",editOrMaskImage:"Edit or mask image",editImage:"Edit image",deleteImage:"Delete image",deleteAudioFile:"Delete audio file",removeImage:"Remove image",removeVideo:"Remove video",chart:"Chart",chartLowercase:"chart",file:"file",selectedFile:"Selected file",none:"None",markdown:"markdown",content:"content",audioProgress:"Audio progress",viewImageOfTotal:"View image {index} of {total}",viewVideoOfTotal:"View video {index} of {total}",imagePreview:"Image preview - Use arrow keys to navigate between images",videoPreview:"Video preview - Use arrow keys to navigate between videos",galleryImage:"Gallery image",galleryThumbnail:"Gallery thumbnail",errorLoadingImage:"Error loading image",errorLoadingVideo:"Error loading video",failedToDownloadImage:"Failed to download image",failedToDownloadVideo:"Failed to download video",calculatingDimensions:"Calculating dimensions",import:"Import",loadAllFolders:"Load All Folders",logoAlt:"ComfyUI Logo",comfyOrgLogoAlt:"ComfyOrg Logo",comfy:"Comfy",refresh:"Refresh",refreshNode:"Refresh Node",vitePreloadErrorTitle:"New Version Available",vitePreloadErrorMessage:`A new version of the app has been released. Would you like to reload?
If not, some parts of the app might not work as expected.
Feel free to decline and save your progress before reloading.`,terminal:"Terminal",logs:"Logs",videoFailedToLoad:"Video failed to load",audioFailedToLoad:"Audio failed to load",liveSamplingPreview:"Live sampling preview",extensionName:"Extension Name",reloadToApplyChanges:"Reload to apply changes",insert:"Insert",systemInfo:"System Info",devices:"Devices",about:"About",add:"Add",confirm:"Confirm",confirmed:"Confirmed",reset:"Reset",resetAll:"Reset All",clearFilters:"Clear Filters",resetAllKeybindingsTooltip:"Reset all keybindings to default",customizeFolder:"Customize Folder",icon:"Icon",color:"Color",error:"Error",resizeFromBottomRight:"Resize from bottom-right corner",resizeFromTopRight:"Resize from top-right corner",resizeFromBottomLeft:"Resize from bottom-left corner",resizeFromTopLeft:"Resize from top-left corner",info:"Node Info",bookmark:"Save to Library",moreOptions:"More Options",more:"More",loading:"Loading",loadingPanel:"Loading {panel} panel...",preview:"PREVIEW",addNodeFilterCondition:"Add node filter condition",architecture:"Architecture",author:"Author",usageHint:"Usage hint",triggerPhrase:"Trigger phrase",findIssues:"Find Issues",reportIssue:"Send Report",reportIssueTooltip:"Submit the error report to Comfy Org",reportSent:"Report Submitted",copyToClipboard:"Copy to Clipboard",openNewIssue:"Open New Issue",showReport:"Show Report",imageFailedToLoad:"Image failed to load",reconnecting:"Reconnecting",reconnected:"Reconnected",delete:"Delete",rename:"Rename",save:"Save",saving:"Saving",no:"No",cancel:"Cancel",close:"Close",pressKeysForNewBinding:"Press keys for new binding",defaultBanner:"default banner",enableOrDisablePack:"Enable or disable pack",openManager:"Open Manager",graphNavigation:"Graph navigation",dropYourFileOr:"Drop your file or",back:"Back",next:"Next",submit:"Submit",install:"Install",installing:"Installing",overwrite:"Overwrite",customize:"Customize",experimental:"BETA",deprecated:"DEPR",loadWorkflow:"Load Workflow",goToNode:"Go to Node",setAsBackground:"Set as Background",customBackground:"Custom Background",settings:"Settings",searchWorkflows:"Search Workflows",searchSettings:"Search Settings",searchNodes:"Search Nodes",searchModels:"Search Models",searchKeybindings:"Search Keybindings",searchExtensions:"Search Extensions",search:"Search",noResultsFound:"No Results Found",searchFailedMessage:"We couldn't find any settings matching your search. Try adjusting your search terms.",noTasksFound:"No Tasks Found",noTasksFoundMessage:"There are no tasks in the queue.",newFolder:"New Folder",enableAll:"Enable All",disableAll:"Disable All",command:"Command",keybinding:"Keybinding",upload:"Upload",export:"Export",workflow:"Workflow",success:"Success",ok:"OK",feedback:"Feedback",continue:"Continue",control_after_generate:"control after generate",control_before_generate:"control before generate",choose_file_to_upload:"choose file to upload",capture:"capture",nodes:"Nodes",community:"Community",all:"All",versionMismatchWarning:"Version Compatibility Warning",versionMismatchWarningMessage:"{warning}: {detail} Visit https://docs.comfy.org/installation/update_comfyui#common-update-issues for update instructions.",frontendOutdated:"Frontend version {frontendVersion} is outdated. Backend requires {requiredVersion} or higher.",frontendNewer:"Frontend version {frontendVersion} may not be compatible with backend version {backendVersion}.",updateFrontend:"Update Frontend",dismiss:"Dismiss",update:"Update",updated:"Updated",resultsCount:"Found {count} Results",status:"Status",description:"Description",warning:"Warning",name:"Name",category:"Category",sort:"Sort",source:"Source",filter:"Filter",apply:"Apply",enabled:"Enabled",installed:"Installed",restart:"Restart",missing:"Missing",inProgress:"In progress",completed:"Completed",interrupted:"Interrupted",queued:"Queued",running:"Running",failed:"Failed",cancelled:"Cancelled",job:"Job",untitled:"Untitled",emDash:"â€”",enabling:"Enabling {id}",disabling:"Disabling {id}",updating:"Updating {id}",migrate:"Migrate",updateAvailable:"Update Available",login:"Login",learnMore:"Learn more",amount:"Amount",unknownError:"Unknown error",title:"Title",edit:"Edit",copy:"Copy",copyJobId:"Copy Job ID",copied:"Copied",jobIdCopied:"Job ID copied to clipboard",failedToCopyJobId:"Failed to copy job ID",imageUrl:"Image URL",clear:"Clear",clearAll:"Clear all",copyURL:"Copy URL",releaseTitle:"{package} {version} Release",itemSelected:"{selectedCount} item selected",itemsSelected:"{selectedCount} items selected",multiSelectDropdown:"Multi-select dropdown",singleSelectDropdown:"Single-select dropdown",progressCountOf:"of",keybindingAlreadyExists:"Keybinding already exists on",commandProhibited:"Command {command} is prohibited. Contact an administrator for more information.",startRecording:"Start Recording",stopRecording:"Stop Recording",micPermissionDenied:"Microphone permission denied",noAudioRecorded:"No audio recorded",nodesRunning:"nodes running",duplicate:"Duplicate",itemsCopiedToClipboard:"Items copied to clipboard",selectItemsToCopy:"Select items to copy",nothingToCopy:"Nothing to copy",selectItemsToDuplicate:"Select items to duplicate",nothingToDuplicate:"Nothing to duplicate",selectItemsToDelete:"Select items to delete",nothingToDelete:"Nothing to delete",batchRename:"Batch rename",enterBaseName:"Enter base name",enterNewName:"Enter new name",selectItemsToRename:"Select items to rename",nothingToRename:"Nothing to rename",moreWorkflows:"More workflows",seeTutorial:"See a tutorial",nodeRenderError:"Node Render Error",nodeContentError:"Node Content Error",nodeHeaderError:"Node Header Error",nodeSlotsError:"Node Slots Error",nodeWidgetsError:"Node Widgets Error",frameNodes:"Frame Nodes",listening:"Listening...",ready:"Ready",playPause:"Play/Pause",playRecording:"Play Recording",playing:"Playing",stopPlayback:"Stop Playback",playbackSpeed:"Playback Speed",volume:"Volume",halfSpeed:"0.5x","1x":"1x","2x":"2x",profile:"Profile",noItems:"No items"},manager={title:"Custom Nodes Manager",legacyMenuNotAvailable:"Legacy manager menu is not available, defaulting to the new manager menu.",legacyManagerUI:"Use Legacy UI",legacyManagerUIDescription:"To use the legacy Manager UI, start ComfyUI with --enable-manager-legacy-ui",failed:"Failed",failedToInstall:"Failed to Install",installError:"Install Error",importFailedGenericError:"Package failed to import. Check the console for more details.",noNodesFound:"No nodes found",noNodesFoundDescription:"The pack's nodes either could not be parsed, or the pack is a frontend extension only and doesn't have any nodes.",installationQueue:"Installation Queue",changingVersion:"Changing version from {from} to {to}",dependencies:"Dependencies",inWorkflow:"In Workflow",infoPanelEmpty:"Click an item to see the info",applyChanges:"Apply Changes",restartToApplyChanges:"To apply changes, please restart ComfyUI",clickToFinishSetup:"Click",toFinishSetup:"to finish setup",restartingBackend:"Restarting backend to apply changes...",extensionsSuccessfullyInstalled:"Extension(s) successfully installed and are ready to use!",installingDependencies:"Installing dependencies...",loadingVersions:"Loading versions...",selectVersion:"Select Version",downloads:"Downloads",repository:"Repository",uninstall:"Uninstall",uninstalling:"Uninstalling {id}",update:"Update",uninstallSelected:"Uninstall Selected",updateSelected:"Update Selected",updateAll:"Update All",updatingAllPacks:"Updating all packages",disabledNodesWontUpdate:"Disabled nodes will not be updated",enablePackToChangeVersion:"Enable this pack to change versions",license:"License",nightlyVersion:"Nightly",latestVersion:"Latest",createdBy:"Created By",totalNodes:"Total Nodes",discoverCommunityContent:"Discover community-made Node Packs, Extensions, and more...",errorConnecting:"Error connecting to the Comfy Node Registry.",noResultsFound:"No results found matching your search.",tryDifferentSearch:"Please try a different search query.",tryAgainLater:"Please try again later.",gettingInfo:"Getting info...",nodePack:"Node Pack",searchPlaceholder:"Search",version:"Version",lastUpdated:"Last Updated",noDescription:"No description available",installSelected:"Install Selected",installAllMissingNodes:"Install All",allMissingNodesInstalled:"All missing nodes have been successfully installed",packsSelected:"packs selected",mixedSelectionMessage:"Cannot perform bulk action on mixed selection",notAvailable:"Not Available",status:{active:"Active",pending:"Pending",flagged:"Flagged",deleted:"Deleted",banned:"Banned",unknown:"Unknown",conflicting:"Conflicting",importFailed:"Install Error"},sort:{downloads:"Most Popular",publisher:"Publisher",created:"Newest",updated:"Updated Recently"},filter:{nodePack:"Node Pack",enabled:"Enabled",disabled:"Disabled"},conflicts:{title:"Node Pack Issues Detected!",description:"We've detected conflicts between some of your extensions and the new version of ComfyUI. By updating you risk breaking workflows that rely on those extensions.",info:"If you continue with the update, the conflicting extensions will be disabled automatically. You can review and manage them anytime in the ComfyUI Manager.",extensionAtRisk:"Extension at Risk",conflicts:"Conflicts",importFailedExtensions:"Import Failed Extensions",conflictInfoTitle:"Why is this happening?",installAnyway:"Install Anyway",enableAnyway:"Enable Anyway",understood:"Understood",warningBanner:{title:"Some extensions are disabled due to incompatibility with your current setup",message:"These extensions require versions of system packages  that differ from your current setup. Installing them may override core dependencies and affect other extensions or workflows.",button:"Learn More..."},conflictMessages:{comfyui_version:"ComfyUI version mismatch (current: {current}, required: {required})",frontend_version:"Frontend version mismatch (current: {current}, required: {required})",os:"Operating system not supported (current: {current}, required: {required})",accelerator:"GPU/Accelerator not supported (available: {current}, required: {required})",generic:"Compatibility issue (current: {current}, required: {required})",banned:"This package is banned for security reasons",pending:"Security verification pending - compatibility cannot be verified",import_failed:"Import Failed"},warningTooltip:"This package may have compatibility issues with your current environment"}},issueReport={helpFix:"Help Fix This"},color={noColor:"No Color",default:"Default",blue:"Blue",green:"Green",red:"Red",pink:"Pink",yellow:"Yellow",brown:"Brown",pale_blue:"Pale Blue",cyan:"Cyan",purple:"Purple",black:"Black",custom:"Custom"},contextMenu={Inputs:"Inputs",Outputs:"Outputs",Properties:"Properties","Properties Panel":"Properties Panel",Title:"Title",Mode:"Mode",Resize:"Resize",Collapse:"Collapse",Expand:"Expand",Pin:"Pin",Unpin:"Unpin",Clone:"Clone",Remove:"Remove",Colors:"Colors",Shapes:"Shapes",Bypass:"Bypass","Copy (Clipspace)":"Copy (Clipspace)","Add Node":"Add Node","Add Group":"Add Group","Convert to Group Node":"Convert to Group Node","Manage Group Nodes":"Manage Group Nodes","Add Group For Selected Nodes":"Add Group For Selected Nodes","Save Selected as Template":"Save Selected as Template","Node Templates":"Node Templates",Manage:"Manage",Search:"Search","Open in Mask Editor":"Open in Mask Editor","Open Image":"Open Image","Copy Image":"Copy Image","Save Image":"Save Image",Rename:"Rename",RenameWidget:"Rename Widget",Copy:"Copy",Duplicate:"Duplicate",Paste:"Paste","Node Info":"Node Info","Adjust Size":"Adjust Size","Minimize Node":"Minimize Node","Expand Node":"Expand Node",Shape:"Shape",Color:"Color","Add Subgraph to Library":"Add Subgraph to Library","Unpack Subgraph":"Unpack Subgraph","Edit Subgraph Widgets":"Edit Subgraph Widgets","Convert to Subgraph":"Convert to Subgraph","Align Selected To":"Align Selected To","Distribute Nodes":"Distribute Nodes","Remove Bypass":"Remove Bypass","Run Branch":"Run Branch",Delete:"Delete",Top:"Top",Bottom:"Bottom",Left:"Left",Right:"Right",Horizontal:"Horizontal",Vertical:"Vertical",new:"new",deprecated:"deprecated"},icon={bookmark:"Bookmark",folder:"Folder",star:"Star",heart:"Heart",file:"File",inbox:"Inbox",box:"Box",briefcase:"Briefcase","exclamation-triangle":"Warning"},welcome={title:"Welcome to ComfyUI",getStarted:"Get Started"},userSelect={newUser:"New user",enterUsername:"Enter a username",existingUser:"Existing user",selectUser:"Select a user",next:"Next"},notSupported={title:"Your device is not supported",message:"Only following devices are supported:",learnMore:"Learn More",reportIssue:"Report Issue",supportedDevices:{macos:"MacOS (M1 or later)",windows:"Windows (Nvidia GPU with CUDA support)"},continue:"Continue",continueTooltip:"I am sure my device is supported"},downloadGit={title:"Download git",message:"Unable to locate git.  A working copy of git is required for normal operation.",instructions:"Please download and install the latest version for your operating system.  The Download git button below opens the git-scm.com downloads page.",warning:"If you are sure you do not need git installed, or there has been a mistake, you may click Skip to byapss this check.  Attempting to run ComfyUI without a working copy of git is not currently supported.",gitWebsite:"Download git",skip:"Skip"},install={installLocation:"Install Location",migration:"Migration",desktopSettings:"Desktop Settings",chooseInstallationLocation:"Choose Installation Location",gpuPicker:{title:"Choose your hardware setup",recommended:"RECOMMENDED",nvidiaSubtitle:"NVIDIA CUDA",cpuSubtitle:"CPU Mode",manualSubtitle:"Manual Setup",appleMetalDescription:"Leverages your Mac's GPU for faster speed and a better overall experience",nvidiaDescription:"Use your NVIDIA GPU with CUDA acceleration for the best performance.",cpuDescription:"Use CPU mode for compatibility when GPU acceleration is not available",manualDescription:"Configure ComfyUI manually for advanced setups or unsupported hardware"},locationPicker:{title:"Choose where to install ComfyUI",subtitle:"Pick a folder for ComfyUI's files. We'll also set up Python there automatically.",pathPlaceholder:"/Users/username/Documents/ComfyUI",migrationPathPlaceholder:"Select existing ComfyUI installation (optional)",migrateFromExisting:"Migrate from existing installation",migrateDescription:"Copy or link your existing models, custom nodes, and configurations from a previous ComfyUI installation.",chooseDownloadServers:"Choose download servers manually",downloadServersDescription:"Select specific mirror servers for downloading Python, PyPI packages, and PyTorch based on your location."},systemLocations:"System Locations",failedToSelectDirectory:"Failed to select directory",pathValidationFailed:"Failed to validate path",pathExists:"Directory already exists - please ensure you have backed up all data",cannotWrite:"Unable to write to the selected path",insufficientFreeSpace:"Insufficient space - minimum free space",isOneDrive:"OneDrive is not supported. Please install ComfyUI in another location.",insideAppInstallDir:"This folder is inside the ComfyUI Desktop application bundle and will be deleted during updates. Choose a directory outside the install folder, such as Documents/ComfyUI.",insideUpdaterCache:"This folder is inside the ComfyUI updater cache, which is cleared on every update. Select a different location for your data.",nonDefaultDrive:"Please install ComfyUI on your system drive (eg. C:\\). Drives with different file systems may cause unpredicable issues. Models and other files can be stored on other drives after installation.",parentMissing:"Path does not exist - create the containing directory first",unhandledError:"Unknown error",installLocationDescription:"Select the directory for ComfyUI's user data. A python environment will be installed to the selected location.",installLocationTooltip:`ComfyUI's user data directory. Stores:
- Python Environment
- Models
- Custom nodes
`,appDataLocationTooltip:`ComfyUI's app data directory. Stores:
- Logs
- Server configs`,appPathLocationTooltip:"ComfyUI's app asset directory. Stores the ComfyUI code and assets",migrateFromExistingInstallation:"Migrate from Existing Installation",migrationSourcePathDescription:"If you have an existing ComfyUI installation, we can copy/link your existing user files and models to the new installation. Your existing ComfyUI installation will not be affected.",selectItemsToMigrate:"Select Items to Migrate",migrationOptional:"Migration is optional. If you don't have an existing installation, you can skip this step.",desktopAppSettings:"Desktop App Settings",desktopAppSettingsDescription:"Configure how ComfyUI behaves on your desktop. You can change these settings later.",gpu:"GPU",gpuSelection:{selectGpu:"Select GPU",selectGpuDescription:"Select the type of GPU you have",cpuMode:"CPU Mode",cpuModeDescription:"CPU mode is intended for developers and rare edge cases only.",cpuModeDescription2:"If you are not absolutely certain you need this, please ignore this box and select your GPU above.",enableCpuMode:"Enable CPU Mode",nvidiaDescription:"NVIDIA devices are directly supported using pytorch CUDA builds.",mpsDescription:"Apple Metal Performance Shaders are supported using pytorch nightly.",customSkipsPython:"This option skips the normal python setup.",customComfyNeedsPython:"ComfyUI will not work until python is setup",customManualVenv:"Manually configure python venv",customInstallRequirements:"Install all requirements and dependencies (e.g. custom torch)",customMayNotWork:"This is entirely unsupported, and may simply not work"},manualConfiguration:{title:"Manual Configuration",requirements:"Requirements",createVenv:"You will need to create a virtual environment in the following directory",virtualEnvironmentPath:"Virtual environment path",restartWhenFinished:"When you have finished configuring the virtual environment, please restart ComfyUI."},settings:{autoUpdate:"Automatic Updates",allowMetrics:"Usage Metrics",errorUpdatingConsent:"Error Updating Consent",errorUpdatingConsentDetail:"Failed to update metrics consent settings",autoUpdateDescription:"Automatically download updates when they become available. You will be notified before updates are installed.",allowMetricsDescription:"Help improve ComfyUI by sending anonymous usage metrics. No personal information or workflow content will be collected.",learnMoreAboutData:"Learn more about data collection",dataCollectionDialog:{title:"About Data Collection",whatWeCollect:"What we collect:",whatWeDoNotCollect:"What we don't collect:",collect:{errorReports:"Error message and stack trace",systemInfo:"Hardware, OS type, and app version",userJourneyEvents:"User journey events"},doNotCollect:{personalInformation:"Personal information",fileSystemInformation:"File system information",workflowContents:"Workflow contents",customNodeConfigurations:"Custom node configurations"},viewFullPolicy:"View full policy"},pythonMirrorPlaceholder:"Enter Python mirror URL",pypiMirrorPlaceholder:"Enter PyPI mirror URL",checkingMirrors:"Checking network access to python mirrors...",mirrorsReachable:"Network access to python mirrors is good",mirrorsUnreachable:"Network access to some python mirrors is bad",mirrorSettings:"Mirror Settings"},customNodes:"Custom Nodes",customNodesDescription:"Reinstall custom nodes from existing ComfyUI installations.",helpImprove:"Please help improve ComfyUI",moreInfo:"For more info, please read our",privacyPolicy:"privacy policy",metricsEnabled:"Metrics Enabled",metricsDisabled:"Metrics Disabled",updateConsent:"You previously opted in to reporting crashes. We are now tracking event-based metrics to help identify bugs and improve the app. No personal identifiable information is collected."},desktopStart={initialising:"Initialising..."},serverStart={title:"Starting ComfyUI",troubleshoot:"Troubleshoot",reportIssue:"Report Issue",openLogs:"Open Logs",showTerminal:"Show Terminal",copySelectionTooltip:"Copy selection",copyAllTooltip:"Copy all",errorMessage:"Unable to start ComfyUI Desktop",installation:{title:"Installing ComfyUI"},process:{"initial-state":"Loading...","python-setup":"Setting up Python Environment...","starting-server":"Starting ComfyUI server...",ready:"Loading Human Interface",error:"Unable to start ComfyUI Desktop"}},serverConfig={modifiedConfigs:"You have modified the following server configurations. Restart to apply changes.",revertChanges:"Revert Changes",restart:"Restart"},shape={default:"Default",round:"Round",CARD:"Card",circle:"Circle",arrow:"Arrow",box:"Box"},sideToolbar={themeToggle:"Toggle Theme",helpCenter:"Help Center",logout:"Logout",queue:"Queue",nodeLibrary:"Node Library",workflows:"Workflows",templates:"Templates",assets:"Assets",mediaAssets:{title:"Media Assets",sortNewestFirst:"Newest first",sortOldestFirst:"Oldest first",sortLongestFirst:"Generation time (longest first)",sortFastestFirst:"Generation time (fastest first)",filterImage:"Image",filterVideo:"Video",filterAudio:"Audio",filter3D:"3D"},backToAssets:"Back to all assets",searchAssets:"Search assets...",labels:{queue:"Queue",nodes:"Nodes",models:"Models",assets:"Assets",workflows:"Workflows",templates:"Templates",console:"Console",menu:"Menu",imported:"Imported",generated:"Generated"},noFilesFound:"No files found",noImportedFiles:"No imported files found",noGeneratedFiles:"No generated files found",noFilesFoundMessage:"Upload files or generate content to see them here",browseTemplates:"Browse example templates",openWorkflow:"Open workflow in local file system",newBlankWorkflow:"Create a new blank workflow",nodeLibraryTab:{groupBy:"Group By",sortMode:"Sort Mode",resetView:"Reset View to Default",groupStrategies:{category:"Category",categoryDesc:"Group by node category",module:"Module",moduleDesc:"Group by module source",source:"Source",sourceDesc:"Group by source type (Core, Custom, API)"},sortBy:{original:"Original",originalDesc:"Keep original order",alphabetical:"Alphabetical",alphabeticalDesc:"Sort alphabetically within groups"}},modelLibrary:"Model Library",downloads:"Downloads",queueProgressOverlay:{title:"Queue Progress",total:"Total: {percent}",colonPercent:": {percent}",currentNode:"Current node:",viewAllJobs:"View all jobs",running:"running",preview:"Preview",interruptAll:"Interrupt all running jobs",moreOptions:"More options",showAssets:"Show assets",showAssetsPanel:"Show assets panel",queuedSuffix:"queued",clearQueued:"Clear queued",clearHistory:"Clear job queue history",filterJobs:"Filter jobs",filterBy:"Filter by",filterAllWorkflows:"All workflows",filterCurrentWorkflow:"Current workflow",sortJobs:"Sort jobs",sortBy:"Sort by",activeJobsSuffix:"active jobs",jobQueue:"Job Queue",expandCollapsedQueue:"Expand job queue",viewJobHistory:"View job history",noActiveJobs:"No active jobs",stubClipTextEncode:"CLIP Text Encode:",jobsCompleted:"{count} job completed | {count} jobs completed",jobsFailed:"{count} job failed | {count} jobs failed",cancelJobTooltip:"Cancel job",clearQueueTooltip:"Clear queue",clearHistoryDialogTitle:"Clear your job queue history?",clearHistoryDialogDescription:"All the finished or failed jobs below will be removed from this Job queue panel.",clearHistoryDialogAssetsNote:"Assets generated by these jobs wonâ€™t be deleted and can always be viewed from the assets panel."},workflowTab:{confirmDeleteTitle:"Delete workflow?",confirmDelete:"Are you sure you want to delete this workflow?",deleted:"Workflow deleted",deleteFailedTitle:"Delete failed",deleteFailed:"Attempt to delete the workflow failed.",dirtyCloseTitle:"Save Changes?",dirtyClose:"The files below have been changed.  Would you like to save them before closing?",dirtyCloseHint:"Hold Shift to close without prompt",confirmOverwriteTitle:"Overwrite existing file?",confirmOverwrite:"The file below already exists. Would you like to overwrite it?",workflowTreeType:{browse:"Browse",bookmarks:"Bookmarks",open:"Open"}}},helpCenter={docs:"Docs",github:"Github",helpFeedback:"Help & Feedback",managerExtension:"Manager Extension",more:"More...",whatsNew:"What's New?",clickToLearnMore:"Click to learn more â†’",loadingReleases:"Loading releases...",recentReleases:"Recent releases",noRecentReleases:"No recent releases",updateAvailable:"Update",desktopUserGuide:"Desktop User Guide",openDevTools:"Open Dev Tools",reinstall:"Re-Install"},releaseToast={newVersionAvailable:"New Version Available!",whatsNew:"What's New?",skip:"Skip",update:"Update"},menu={hideMenu:"Hide Menu",showMenu:"Show Menu",batchCount:"Batch Count",batchCountTooltip:"The number of times the workflow generation should be queued",autoQueue:"Auto Queue",disabled:"Disabled",disabledTooltip:"The workflow will not be automatically queued",instant:"Instant",instantTooltip:"The workflow will be queued instantly after a generation finishes",onChange:"On Change",onChangeTooltip:"The workflow will be queued once a change is made",runWorkflow:"Run workflow (Shift to queue at front)",runWorkflowFront:"Run workflow (Queue at front)",runWorkflowDisabled:"Workflow contains unsupported nodes (highlighted red). Remove these to run the workflow.",run:"Run",execute:"Execute",interrupt:"Cancel current run",refresh:"Refresh node definitions",clipspace:"Open Clipspace",resetView:"Reset canvas view",clear:"Clear workflow",toggleBottomPanel:"Toggle Bottom Panel",theme:"Theme",dark:"Dark",light:"Light",manageExtensions:"Manage Extensions",settings:"Settings",help:"Help",queue:"Queue Panel"},tabMenu={duplicateTab:"Duplicate Tab",closeTab:"Close Tab",closeTabsToLeft:"Close Tabs to Left",closeTabsToRight:"Close Tabs to Right",closeOtherTabs:"Close Other Tabs",addToBookmarks:"Add to Bookmarks",removeFromBookmarks:"Remove from Bookmarks"},templateWorkflows={title:"Get Started with a Template",loadingMore:"Loading more templates...",searchPlaceholder:"Search templates...",category:{"ComfyUI Examples":"ComfyUI Examples","Custom Nodes":"Custom Nodes",Basics:"Basics",GettingStarted:"Getting Started",Flux:"Flux",ControlNet:"ControlNet",Upscaling:"Upscaling",Video:"Video",Image:"Image","Area Composition":"Area Composition","3D":"3D",Audio:"Audio",LLMs:"LLMs","Image API":"Image API","Video API":"Video API","LLM API":"LLM API",All:"All Templates",Extensions:"Extensions","Partner Nodes":"Partner Nodes","Generation Type":"Generation Type"},categories:"Categories",resetFilters:"Clear Filters",sorting:"Sort by",activeFilters:"Filters:",loading:"Loading templates...",noResults:"No templates found",noResultsHint:"Try adjusting your search or filters",allTemplates:"All Templates",modelFilter:"Model Filter",useCaseFilter:"Use Case",licenseFilter:"License",modelsSelected:"{count} Models",useCasesSelected:"{count} Use Cases",runsOnSelected:"{count} Runs On",runsOnFilter:"Runs on",resultsCount:"Showing {count} of {total} templates",sort:{recommended:"Recommended",alphabetical:"A â†’ Z",newest:"Newest",searchPlaceholder:"Search...",vramLowToHigh:"VRAM Usage (Low to High)",modelSizeLowToHigh:"Model Size (Low to High)",default:"Default"},error:{templateNotFound:'Template "{templateName}" not found'}},templateWidgets={sort:{searchPlaceholder:"Search..."}},graphCanvasMenu={zoomIn:"Zoom In",zoomOut:"Zoom Out",resetView:"Reset View",fitView:"Fit View",selectMode:"Select Mode",panMode:"Pan Mode",toggleMinimap:"Toggle Minimap",select:"Select",hand:"Hand",zoomOptions:"Zoom Options",focusMode:"Focus Mode",hideLinks:"Hide Links",showLinks:"Show Links",toggleLinkVisibility:"Toggle Link Visibility"},zoomControls={label:"Zoom Controls",zoomToFit:"Zoom To Fit",showMinimap:"Show Minimap",hideMinimap:"Hide Minimap"},groupNode={create:"Create group node",enterName:"Enter name"},nodeTemplates={saveAsTemplate:"Save as template",enterName:"Enter name"},workflowService={exportWorkflow:"Export Workflow",enterFilename:"Enter the filename",saveWorkflow:"Save workflow"},subgraphStore={confirmDeleteTitle:"Delete blueprint?",confirmDelete:"This action will permanently remove the blueprint from your library",saveBlueprint:"Save Subgraph to Library",overwriteBlueprintTitle:"Overwrite existing blueprint?",overwriteBlueprint:"Saving will overwrite the current blueprint with your changes",blueprintName:"Subgraph name",promoteOutsideSubgraph:"Can't promote widget when not in subgraph",publish:"Publish Subgraph",publishSuccess:"Saved to Nodes Library",publishSuccessMessage:'You can find your subgraph blueprint in the nodes library under "Subgraph Blueprints"',loadFailure:"Failed to load subgraph blueprints",shown:"Shown on node",showAll:"Show all",hidden:"Hidden / nested parameters",hideAll:"Hide all",showRecommended:"Show recommended widgets"},electronFileDownload={inProgress:"In Progress",pause:"Pause Download",paused:"Paused",resume:"Resume Download",cancel:"Cancel Download",cancelled:"Cancelled"},maskEditor={title:"Mask Editor",invert:"Invert",clear:"Clear",undo:"Undo",redo:"Redo",clickToResetZoom:"Click to reset zoom",brushSettings:"Brush Settings",brushShape:"Brush Shape",colorSelector:"Color Selector",thickness:"Thickness",opacity:"Opacity",hardness:"Hardness",stepSize:"Step Size",smoothingPrecision:"Smoothing Precision",resetToDefault:"Reset to Default",paintBucketSettings:"Paint Bucket Settings",tolerance:"Tolerance",fillOpacity:"Fill Opacity",colorSelectSettings:"Color Select Settings",selectionOpacity:"Selection Opacity",livePreview:"Live Preview",applyToWholeImage:"Apply to Whole Image",method:"Method",stopAtMask:"Stop at mask",maskTolerance:"Mask Tolerance",layers:"Layers",maskLayer:"Mask Layer",maskOpacity:"Mask Opacity",imageLayer:"Image Layer",maskBlendingOptions:"Mask Blending Options",paintLayer:"Paint Layer",baseImageLayer:"Base Image Layer",activateLayer:"Activate Layer",baseLayerPreview:"Base layer preview",black:"Black",white:"White",negative:"Negative"},commands={runWorkflow:"Run workflow",runWorkflowFront:"Run workflow (Queue at front)",run:"Run",execute:"Execute",interrupt:"Cancel current run",refresh:"Refresh node definitions",clipspace:"Open Clipspace",resetView:"Reset canvas view",clear:"Clear workflow",toggleBottomPanel:"Toggle Bottom Panel",theme:"Theme",dark:"Dark",light:"Light",manageExtensions:"Manage Extensions",settings:"Settings",help:"Help",queue:"Queue Panel"},queue={initializingAlmostReady:"Initializing - Almost ready",inQueue:"In queue...",jobAddedToQueue:"Job added to queue",jobMenu:{openAsWorkflowNewTab:"Open as workflow in new tab",openWorkflowNewTab:"Open workflow in new tab",copyJobId:"Copy job ID",cancelJob:"Cancel job",inspectAsset:"Inspect asset",addToCurrentWorkflow:"Add to current workflow",download:"Download",exportWorkflow:"Export workflow",delete:"Delete",deleteAsset:"Delete asset",removeJob:"Remove job",copyErrorMessage:"Copy error message",reportError:"Report error"},jobList:{undated:"Undated",sortMostRecent:"Most recent",sortTotalGenerationTime:"Total generation time (longest first)",sortComputeHoursUsed:"Compute hours used (most first)"},jobDetails:{header:"Job Details",workflow:"Workflow",jobId:"Job ID",queuedAt:"Queued at",queuePosition:"Queue position",timeElapsed:"Time elapsed",estimatedStartIn:"Estimated to start in",estimatedFinishIn:"Estimated to finish in",generatedOn:"Generated on",totalGenerationTime:"Total generation time",computeHoursUsed:"Compute hours used",failedAfter:"Failed after",errorMessage:"Error message",report:"Report",queuePositionValue:"~{count} job ahead of yours | ~{count} jobs ahead of yours",eta:{seconds:"~{count} second | ~{count} seconds",secondsRange:"~{lo}-{hi} seconds",minutes:"~{count} minute | ~{count} minutes",minutesRange:"~{lo}-{hi} minutes"}}},menuLabels={File:"File",Edit:"Edit",View:"View",Help:"Help","Open 3D Viewer (Beta) for Selected Node":"Open 3D Viewer (Beta) for Selected Node","Experimental: Browse Model Assets":"Experimental: Browse Model Assets","Browse Templates":"Browse Templates","Delete Selected Items":"Delete Selected Items","Zoom to fit":"Zoom to fit","Lock Canvas":"Lock Canvas","Move Selected Nodes Down":"Move Selected Nodes Down","Move Selected Nodes Left":"Move Selected Nodes Left","Move Selected Nodes Right":"Move Selected Nodes Right","Move Selected Nodes Up":"Move Selected Nodes Up","Reset View":"Reset View","Resize Selected Nodes":"Resize Selected Nodes","Node Links":"Node Links","Canvas Toggle Lock":"Canvas Toggle Lock",Minimap:"Minimap","Pin/Unpin Selected Items":"Pin/Unpin Selected Items","Bypass/Unbypass Selected Nodes":"Bypass/Unbypass Selected Nodes","Collapse/Expand Selected Nodes":"Collapse/Expand Selected Nodes","Mute/Unmute Selected Nodes":"Mute/Unmute Selected Nodes","Pin/Unpin Selected Nodes":"Pin/Unpin Selected Nodes","Unlock Canvas":"Unlock Canvas","Zoom In":"Zoom In","Zoom Out":"Zoom Out","Clear Pending Tasks":"Clear Pending Tasks","Clear Workflow":"Clear Workflow","Contact Support":"Contact Support","Show Model Selector (Dev)":"Show Model Selector (Dev)","Duplicate Current Workflow":"Duplicate Current Workflow",Export:"Export","Export (API)":"Export (API)","Convert Selection to Subgraph":"Convert Selection to Subgraph","Edit Subgraph Widgets":"Edit Subgraph Widgets","Exit Subgraph":"Exit Subgraph","Fit Group To Contents":"Fit Group To Contents","Group Selected Nodes":"Group Selected Nodes","Toggle promotion of hovered widget":"Toggle promotion of hovered widget","Unpack the selected Subgraph":"Unpack the selected Subgraph","Convert selected nodes to group node":"Convert selected nodes to group node","Manage group nodes":"Manage group nodes","Ungroup selected group nodes":"Ungroup selected group nodes","About ComfyUI":"About ComfyUI","Comfy-Org Discord":"Comfy-Org Discord","ComfyUI Docs":"ComfyUI Docs","ComfyUI Forum":"ComfyUI Forum","ComfyUI Issues":"ComfyUI Issues",Interrupt:"Interrupt","Load Default Workflow":"Load Default Workflow","Custom Nodes Manager":"Custom Nodes Manager","Custom Nodes (Legacy)":"Custom Nodes (Legacy)","Manager Menu (Legacy)":"Manager Menu (Legacy)","Install Missing Custom Nodes":"Install Missing Custom Nodes","Check for Custom Node Updates":"Check for Custom Node Updates","Toggle the Custom Nodes Manager Progress Bar":"Toggle the Custom Nodes Manager Progress Bar","Decrease Brush Size in MaskEditor":"Decrease Brush Size in MaskEditor","Increase Brush Size in MaskEditor":"Increase Brush Size in MaskEditor","Open Mask Editor for Selected Node":"Open Mask Editor for Selected Node","Unload Models":"Unload Models","Unload Models and Execution Cache":"Unload Models and Execution Cache",New:"New",Clipspace:"Clipspace",Manager:"Manager",Open:"Open",Publish:"Publish","Queue Prompt":"Queue Prompt","Queue Prompt (Front)":"Queue Prompt (Front)","Queue Selected Output Nodes":"Queue Selected Output Nodes",Redo:"Redo","Refresh Node Definitions":"Refresh Node Definitions",Save:"Save","Save As":"Save As","Show Settings Dialog":"Show Settings Dialog","Experimental: Enable AssetAPI":"Experimental: Enable AssetAPI","Canvas Performance":"Canvas Performance","Help Center":"Help Center","toggle linear mode":"toggle linear mode","Toggle Theme (Dark/Light)":"Toggle Theme (Dark/Light)",Undo:"Undo","Open Sign In Dialog":"Open Sign In Dialog","Sign Out":"Sign Out","Experimental: Enable Vue Nodes":"Experimental: Enable Nodes 2.0","Experimental: Enable Nodes 2.0":"Experimental: Enable Nodes 2.0","Experimental: Disable Nodes 2.0":"Experimental: Disable Nodes 2.0","Close Current Workflow":"Close Current Workflow","Next Opened Workflow":"Next Opened Workflow","Previous Opened Workflow":"Previous Opened Workflow","Toggle Search Box":"Toggle Search Box","Bottom Panel":"Bottom Panel","Show Keybindings Dialog":"Show Keybindings Dialog","Toggle Terminal Bottom Panel":"Toggle Terminal Bottom Panel","Toggle Logs Bottom Panel":"Toggle Logs Bottom Panel","Toggle Essential Bottom Panel":"Toggle Essential Bottom Panel","Toggle View Controls Bottom Panel":"Toggle View Controls Bottom Panel","Focus Mode":"Focus Mode",Assets:"Assets","Model Library":"Model Library","Node Library":"Node Library",Workflows:"Workflows"},desktopMenu={reinstall:"Reinstall",confirmReinstall:`This will clear your extra_models_config.yaml file,
and begin installation again.

Are you sure?`,quit:"Quit",confirmQuit:"There are unsaved workflows open; any unsaved changes will be lost.  Ignore this and quit?"},settingsCategories={"Comfy-Desktop":"Comfy-Desktop",General:"General",Appearance:"Appearance",ColorPalette:"Color Palette",Comfy:"Comfy",Workflow:"Workflow",DevMode:"Dev Mode",LiteGraph:"Lite Graph","Node Widget":"Node Widget",Node:"Node",Extension:"Extension",Canvas:"Canvas",Link:"Link",Group:"Group",Menu:"Menu",Keybinding:"Keybinding",LinkRelease:"Link Release",Graph:"Graph",Locale:"Locale","Mask Editor":"Mask Editor",BrushAdjustment:"Brush Adjustment",NewEditor:"New Editor",ModelLibrary:"Model Library",NodeLibrary:"Node Library","Node Search Box":"Node Search Box",Pointer:"Pointer",Queue:"Queue",QueueButton:"Queue Button",RerouteBeta:"Reroute Beta",Server:"Server",Settings:"Settings",Sidebar:"Sidebar","Tree Explorer":"Tree Explorer",Validation:"Validation",Window:"Window","Server-Config":"Server-Config",About:"About",EditTokenWeight:"Edit Token Weight",CustomColorPalettes:"Custom Color Palettes",UV:"UV",ContextMenu:"Context Menu",Reroute:"Reroute","Load 3D":"Load 3D & Animation",Camera:"Camera",Scene:"Scene","3D":"3D",Light:"Light",User:"User",Credits:"Credits","API Nodes":"API Nodes","Notification Preferences":"Notification Preferences","3DViewer":"3DViewer","Canvas Navigation":"Canvas Navigation",PlanCredits:"Plan & Credits","Vue Nodes":"Nodes 2.0",VueNodes:"Nodes 2.0","Nodes 2_0":"Nodes 2.0"},serverConfigItems={listen:{name:"Host: The IP address to listen on"},port:{name:"Port: The port to listen on"},"tls-keyfile":{name:"TLS Key File: Path to TLS key file for HTTPS"},"tls-certfile":{name:"TLS Certificate File: Path to TLS certificate file for HTTPS"},"enable-cors-header":{name:'Enable CORS header: Use "*" for all origins or specify domain'},"max-upload-size":{name:"Maximum upload size (MB)"},"cuda-device":{name:"CUDA device index to use"},"cuda-malloc":{name:"Use CUDA malloc for memory allocation"},"global-precision":{name:"Global floating point precision",tooltip:"Global floating point precision"},"unet-precision":{name:"UNET precision",tooltip:"UNET precision"},"vae-precision":{name:"VAE precision",tooltip:"VAE precision"},"cpu-vae":{name:"Run VAE on CPU"},"text-encoder-precision":{name:"Text Encoder precision",tooltip:"Text Encoder precision"},"force-channels-last":{name:"Force channels-last memory format"},directml:{name:"DirectML device index"},"disable-ipex-optimize":{name:"Disable IPEX optimization"},"preview-method":{name:"Method used for latent previews"},"preview-size":{name:"Size of preview images"},"cache-classic":{name:"Use classic cache system"},"cache-lru":{name:"Use LRU caching with a maximum of N node results cached.",tooltip:"May use more RAM/VRAM."},"cross-attention-method":{name:"Cross attention method"},"disable-xformers":{name:"Disable xFormers optimization"},"force-upcast-attention":{name:"Force attention upcast"},"dont-upcast-attention":{name:"Prevent attention upcast"},"vram-management":{name:"VRAM management mode"},"reserve-vram":{name:"Reserved VRAM (GB)",tooltip:"Set the amount of vram in GB you want to reserve for use by your OS/other software. By default some amount is reserved depending on your OS."},"default-hashing-function":{name:"Default hashing function for model files"},"disable-smart-memory":{name:"Disable smart memory management",tooltip:"Force ComfyUI to aggressively offload to regular ram instead of keeping models in vram when it can."},deterministic:{name:"Make pytorch use slower deterministic algorithms when it can.",tooltip:"Note that this might not make images deterministic in all cases."},fast:{name:"Enable some untested and potentially quality deteriorating optimizations."},"dont-print-server":{name:"Don't print server output to console."},"disable-metadata":{name:"Disable saving prompt metadata in files."},"disable-all-custom-nodes":{name:"Disable loading all custom nodes."},"log-level":{name:"Logging verbosity level"},"input-directory":{name:"Input directory"},"output-directory":{name:"Output directory"}},serverConfigCategories={Network:"Network",CUDA:"CUDA",Inference:"Inference",Memory:"Memory",Preview:"Preview",Cache:"Cache",Attention:"Attention",General:"General",Directories:"Directories"},nodeCategories={_for_testing:"_for_testing",custom_sampling:"custom_sampling",noise:"noise",sampling:"sampling",schedulers:"schedulers",audio:"audio",conditioning:"conditioning",loaders:"loaders",guiders:"guiders","api node":"api node",video:"video",ByteDance:"ByteDance",image:"image",preprocessors:"preprocessors",utils:"utils",string:"string",advanced:"advanced",guidance:"guidance",model_merging:"model_merging",model_patches:"model_patches",chroma_radiance:"chroma_radiance",attention_experiments:"attention_experiments",flux:"flux",hooks:"hooks",combine:"combine","cond single":"cond single",context:"context",controlnet:"controlnet",inpaint:"inpaint",scheduling:"scheduling",create:"create",mask:"mask",deprecated:"deprecated",debug:"debug",model:"model",latent:"latent","3d":"3d",ltxv:"ltxv",sd3:"sd3",unet:"unet",sigmas:"sigmas",BFL:"BFL",Gemini:"Gemini",text:"text",gligen:"gligen",video_models:"video_models",sd:"sd",Ideogram:"Ideogram",postprocessing:"postprocessing",transform:"transform",batch:"batch",upscaling:"upscaling",instructpix2pix:"instructpix2pix",compositing:"compositing",Kling:"Kling",samplers:"samplers",operations:"operations",training:"training",lotus:"lotus",LTXV:"LTXV",Luma:"Luma",MiniMax:"MiniMax",model_specific:"model_specific","Moonvalley Marey":"Moonvalley Marey",OpenAI:"OpenAI",Sora:"Sora","cond pair":"cond pair",photomaker:"photomaker",Pika:"Pika",PixVerse:"PixVerse",primitive:"primitive",qwen:"qwen",Recraft:"Recraft",edit_models:"edit_models",Rodin:"Rodin",Runway:"Runway",animation:"animation",api:"api",save:"save",upscale_diffusion:"upscale_diffusion",clip:"clip","Stability AI":"Stability AI",stable_cascade:"stable_cascade","3d_models":"3d_models",style_model:"style_model",Topaz:"Topaz",Tripo:"Tripo",Veo:"Veo",Vidu:"Vidu","":"",camera:"camera",Wan:"Wan"},dataTypes={"*":"*",AUDIO:"AUDIO",AUDIO_ENCODER:"AUDIO_ENCODER",AUDIO_ENCODER_OUTPUT:"AUDIO_ENCODER_OUTPUT",AUDIO_RECORD:"AUDIO_RECORD",BOOLEAN:"BOOLEAN",CAMERA_CONTROL:"CAMERA_CONTROL",CLIP:"CLIP",CLIP_VISION:"CLIP_VISION",CLIP_VISION_OUTPUT:"CLIP_VISION_OUTPUT",COMBO:"COMBO",CONDITIONING:"CONDITIONING",CONTROL_NET:"CONTROL_NET",FLOAT:"FLOAT",FLOATS:"FLOATS",GEMINI_INPUT_FILES:"GEMINI_INPUT_FILES",GLIGEN:"GLIGEN",GUIDER:"GUIDER",HOOK_KEYFRAMES:"HOOK_KEYFRAMES",HOOKS:"HOOKS",IMAGE:"IMAGE",INT:"INT",LATENT:"LATENT",LATENT_OPERATION:"LATENT_OPERATION",LATENT_UPSCALE_MODEL:"LATENT_UPSCALE_MODEL",LOAD_3D:"LOAD_3D",LOAD_3D_ANIMATION:"LOAD_3D_ANIMATION",LOAD3D_CAMERA:"LOAD3D_CAMERA",LORA_MODEL:"LORA_MODEL",LOSS_MAP:"LOSS_MAP",LUMA_CONCEPTS:"LUMA_CONCEPTS",LUMA_REF:"LUMA_REF",MASK:"MASK",MESH:"MESH",MODEL:"MODEL",MODEL_PATCH:"MODEL_PATCH",MODEL_TASK_ID:"MODEL_TASK_ID",NOISE:"NOISE",OPENAI_CHAT_CONFIG:"OPENAI_CHAT_CONFIG",OPENAI_INPUT_FILES:"OPENAI_INPUT_FILES",PHOTOMAKER:"PHOTOMAKER",PIXVERSE_TEMPLATE:"PIXVERSE_TEMPLATE",RECRAFT_COLOR:"RECRAFT_COLOR",RECRAFT_CONTROLS:"RECRAFT_CONTROLS",RECRAFT_V3_STYLE:"RECRAFT_V3_STYLE",RETARGET_TASK_ID:"RETARGET_TASK_ID",RIG_TASK_ID:"RIG_TASK_ID",SAMPLER:"SAMPLER",SIGMAS:"SIGMAS",STRING:"STRING",STYLE_MODEL:"STYLE_MODEL",SVG:"SVG",TIMESTEPS_RANGE:"TIMESTEPS_RANGE",UPSCALE_MODEL:"UPSCALE_MODEL",VAE:"VAE",VIDEO:"VIDEO",VOXEL:"VOXEL",WAN_CAMERA_EMBEDDING:"WAN_CAMERA_EMBEDDING",WEBCAM:"WEBCAM"},maintenance={title:"Maintenance",allOk:"No issues were detected.",status:"Status",detected:"Detected",refreshing:"Refreshing",None:"None",OK:"OK",Skipped:"Skipped",showManual:"Show maintenance tasks",confirmTitle:"Are you sure?",terminalDefaultMessage:"When you run a troubleshooting command, any output will be shown here.",consoleLogs:"Console Logs",error:{toastTitle:"Task error",taskFailed:"Task failed to run.",cannotContinue:"Unable to continue - errors remain",defaultDescription:"An error occurred while running a maintenance task."},unsafeMigration:{title:"Unsafe install location detected",generic:"Your current ComfyUI base path is in a location that may be deleted or modified during updates. To avoid data loss, move it to a safe folder.",appInstallDir:"Your base path is inside the ComfyUI Desktop application bundle. This folder may be deleted or overwritten during updates. Choose a directory outside the install folder, such as Documents/ComfyUI.",updaterCache:"Your base path is inside the ComfyUI updater cache, which is cleared on each update. Choose a different location for your data.",oneDrive:"Your base path is on OneDrive, which can cause sync issues and accidental data loss. Choose a local folder that is not managed by OneDrive.",action:'Use the "Base path" maintenance task below to move ComfyUI to a safe location.'}},missingModelsDialog={doNotAskAgain:"Don't show this again",missingModels:"Missing Models",missingModelsMessage:"When loading the graph, the following models were not found"},versionMismatchWarning={title:"Version Compatibility Warning",frontendOutdated:"Frontend version {frontendVersion} is outdated. Backend requires version {requiredVersion} or higher.",frontendNewer:"Frontend version {frontendVersion} may not be compatible with backend version {backendVersion}.",updateFrontend:"Update Frontend",dismiss:"Dismiss"},errorDialog={defaultTitle:"An error occurred",loadWorkflowTitle:"Loading aborted due to error reloading workflow data",noStackTrace:"No stacktrace available",extensionFileHint:"This may be due to the following script",promptExecutionError:"Prompt execution failed"},apiNodesSignInDialog={title:"Sign In Required to Use API Nodes",message:"This workflow contains API Nodes, which require you to be signed in to your account in order to run."},apiNodesCostBreakdown={title:"API Node(s)",costPerRun:"Cost per run",totalCost:"Total Cost"},desktopUpdate={title:"Updating ComfyUI Desktop",description:"ComfyUI Desktop is installing new dependencies.  This may take a few minutes.",terminalDefaultMessage:"Any console output from the update will be shown here.",updateFoundTitle:"Update Found (v{version})",updateAvailableMessage:"An update is available. Do you want to restart and update now?",noUpdateFound:"No update found",errorCheckingUpdate:"Error checking for updates",errorInstallingUpdate:"Error installing update"},clipboard={successMessage:"Copied to clipboard",errorMessage:"Failed to copy to clipboard",errorNotSupported:"Clipboard API not supported in your browser"},load3d={switchCamera:"Switch Camera",showGrid:"Show Grid",backgroundColor:"Background Color",lightIntensity:"Light Intensity",fov:"FOV",previewOutput:"Preview Output",uploadBackgroundImage:"Upload Background Image",removeBackgroundImage:"Remove Background Image",tiledMode:"Tiled",panoramaMode:"Panorama",loadingModel:"Loading 3D Model...",upDirection:"Up Direction",materialMode:"Material Mode",scene:"Scene",model:"Model",camera:"Camera",light:"Light",switchingMaterialMode:"Switching Material Mode...",edgeThreshold:"Edge Threshold",export:"Export",exportModel:"Export Model",exportingModel:"Exporting model...",reloadingModel:"Reloading model...",uploadTexture:"Upload Texture",applyingTexture:"Applying Texture...",materialModes:{normal:"Normal",wireframe:"Wireframe",original:"Original",depth:"Depth",lineart:"Lineart"},upDirections:{original:"Original"},startRecording:"Start Recording",stopRecording:"Stop Recording",exportRecording:"Export Recording",clearRecording:"Clear Recording",resizeNodeMatchOutput:"Resize Node to match output",loadingBackgroundImage:"Loading Background Image",cameraType:{perspective:"Perspective",orthographic:"Orthographic"},viewer:{title:"3D Viewer (Beta)",apply:"Apply",cancel:"Cancel",cameraType:"Camera Type",sceneSettings:"Scene Settings",cameraSettings:"Camera Settings",lightSettings:"Light Settings",exportSettings:"Export Settings",modelSettings:"Model Settings"},openIn3DViewer:"Open in 3D Viewer",dropToLoad:"Drop 3D model to load",unsupportedFileType:"Unsupported file type (supports .gltf, .glb, .obj, .fbx, .stl)",uploadingModel:"Uploading 3D model..."},toastMessages={nothingToQueue:"Nothing to queue",pleaseSelectOutputNodes:"Please select output nodes",failedToQueue:"Failed to queue",failedExecutionPathResolution:"Could not resolve path to selected nodes",no3dScene:"No 3D scene to apply texture",failedToApplyTexture:"Failed to apply texture",no3dSceneToExport:"No 3D scene to export",failedToExportModel:"Failed to export model as {format}",exportSuccess:"Successfully exported model as {format}",fileLoadError:"Unable to find workflow in {fileName}",dropFileError:"Unable to process dropped item: {error}",interrupted:"Execution has been interrupted",pendingTasksDeleted:"Pending tasks deleted",nothingToGroup:"Nothing to group",pleaseSelectNodesToGroup:"Please select the nodes (or other groups) to create a group for",emptyCanvas:"Empty canvas",fileUploadFailed:"File upload failed",unableToGetModelFilePath:"Unable to get model file path",couldNotDetermineFileType:"Could not determine file type",errorLoadingModel:"Error loading model",failedToDownloadFile:"Failed to download file",updateRequested:"Update requested",nodeDefinitionsUpdated:"Node definitions updated",errorSaveSetting:"Error saving setting {id}: {err}",errorCopyImage:"Error copying image: {error}",noTemplatesToExport:"No templates to export",failedToFetchLogs:"Failed to fetch server logs",migrateToLitegraphReroute:"Reroute nodes will be removed in future versions. Click to migrate to litegraph-native reroute.",userNotAuthenticated:"User not authenticated",failedToFetchBalance:"Failed to fetch balance: {error}",failedToCreateCustomer:"Failed to create customer: {error}",failedToInitiateCreditPurchase:"Failed to initiate credit purchase: {error}",failedToAccessBillingPortal:"Failed to access billing portal: {error}",failedToPurchaseCredits:"Failed to purchase credits: {error}",failedToFetchSubscription:"Failed to fetch subscription status: {error}",failedToInitiateSubscription:"Failed to initiate subscription: {error}",unauthorizedDomain:"Your domain {domain} is not authorized to use this service. Please contact {email} to add your domain to the whitelist.",useApiKeyTip:"Tip: Can't access normal login? Use the Comfy API Key option.",nothingSelected:"Nothing selected",cannotCreateSubgraph:"Cannot create subgraph",failedToConvertToSubgraph:"Failed to convert items to subgraph",failedToInitializeLoad3dViewer:"Failed to initialize 3D Viewer",failedToLoadBackgroundImage:"Failed to load background image",failedToLoadModel:"Failed to load 3D model",modelLoadedSuccessfully:"3D model loaded successfully",failedToUpdateBackgroundColor:"Failed to update background color",failedToToggleGrid:"Failed to toggle grid",failedToToggleCamera:"Failed to toggle camera",failedToUpdateFOV:"Failed to update field of view",failedToUpdateLightIntensity:"Failed to update light intensity",failedToUpdateBackgroundImage:"Failed to update background image",failedToUpdateUpDirection:"Failed to update up direction",failedToUpdateMaterialMode:"Failed to update material mode",failedToUpdateEdgeThreshold:"Failed to update edge threshold",failedToUploadBackgroundImage:"Failed to upload background image",failedToUpdateBackgroundRenderMode:"Failed to update background render mode to {mode}"},nodeErrors={render:"Node Render Error",content:"Node Content Error",header:"Node Header Error",slots:"Node Slots Error",widgets:"Node Widgets Error"},auth={apiKey:{title:"API Key",label:"API Key",description:"Use your Comfy API key to enable API Nodes",placeholder:"Enter your API Key",error:"Invalid API Key",storageFailed:"Failed to store API Key",storageFailedDetail:"Please try again.",stored:"API Key stored",storedDetail:"Your API Key has been stored successfully",cleared:"API Key cleared",clearedDetail:"Your API Key has been cleared successfully",invalid:"Invalid API Key",invalidDetail:"Please enter a valid API Key",helpText:"Need an API key?",generateKey:"Get one here",whitelistInfo:"About non-whitelisted sites"},login:{title:"Log in to your account",useApiKey:"Comfy API Key",signInOrSignUp:"Sign In / Sign Up",forgotPasswordError:"Failed to send password reset email",passwordResetSent:"Password reset email sent",passwordResetSentDetail:"Please check your email for a link to reset your password.",newUser:"New here?",userAvatar:"User Avatar",signUp:"Sign up",emailLabel:"Email",emailPlaceholder:"Enter your email",passwordLabel:"Password",passwordPlaceholder:"Enter your password",confirmPasswordLabel:"Confirm Password",confirmPasswordPlaceholder:"Enter the same password again",forgotPassword:"Forgot password?",passwordResetInstructions:"Enter your email address and we'll send you a link to reset your password.",sendResetLink:"Send reset link",backToLogin:"Back to login",didntReceiveEmail:"Didn't receive an email? Contact us at",passwordResetError:"Failed to send password reset email. Please try again.",loginButton:"Sign in",orContinueWith:"Or continue with",loginWithGoogle:"Log in with Google",loginWithGithub:"Log in with Github",termsText:'By clicking "Next" or "Sign Up", you agree to our',termsLink:"Terms of Use",andText:"and",privacyLink:"Privacy Policy",success:"Login successful",failed:"Login failed",insecureContextWarning:"This connection is insecure (HTTP) - your credentials may be intercepted by attackers if you proceed to login.",questionsContactPrefix:"Questions? Contact us at",noAssociatedUser:"There is no Comfy user associated with the provided API key"},signup:{title:"Create an account",alreadyHaveAccount:"Already have an account?",emailLabel:"Email",emailPlaceholder:"Enter your email",passwordLabel:"Password",passwordPlaceholder:"Enter new password",signUpButton:"Sign up",signIn:"Sign in",signUpWithGoogle:"Sign up with Google",signUpWithGithub:"Sign up with Github",regionRestrictionChina:"In accordance with local regulatory requirements, our services are temporarily unavailable to users located in China.",personalDataConsentLabel:"I agree to the processing of my personal data."},signOut:{signOut:"Log Out",success:"Signed out successfully",successDetail:"You have been signed out of your account."},passwordUpdate:{success:"Password Updated",successDetail:"Your password has been updated successfully"},errors:{"auth/invalid-email":"Please enter a valid email address.","auth/user-disabled":"This account has been disabled. Please contact support.","auth/user-not-found":"No account found with this email. Would you like to create a new account?","auth/wrong-password":"The password you entered is incorrect. Please try again.","auth/email-already-in-use":"An account with this email already exists. Try signing in instead.","auth/weak-password":"Password is too weak. Please use a stronger password with at least 6 characters.","auth/too-many-requests":"Too many login attempts. Please wait a moment and try again.","auth/operation-not-allowed":"This sign-in method is not currently supported.","auth/invalid-credential":"Invalid login credentials. Please check your email and password.","auth/network-request-failed":"Network error. Please check your connection and try again.","auth/popup-closed-by-user":"Sign-in was cancelled. Please try again.","auth/cancelled-popup-request":"Sign-in was cancelled. Please try again."},deleteAccount:{deleteAccount:"Delete Account",confirmTitle:"Delete Account",confirmMessage:"Are you sure you want to delete your account? This action cannot be undone and will permanently remove all your data.",confirm:"Delete Account",cancel:"Cancel",success:"Account Deleted",successDetail:"Your account has been successfully deleted."},reauthRequired:{title:"Re-authentication Required",message:"For security reasons, this action requires you to sign in again. Would you like to proceed?",confirm:"Sign In Again",cancel:"Cancel"},loginButton:{tooltipHelp:'Login to be able to use "API Nodes"',tooltipLearnMore:"Learn more..."}},validation={invalidEmail:"Invalid email address",required:"Required",minLength:"Must be at least {length} characters",maxLength:"Must be no more than {length} characters",prefix:"Must start with {prefix}",descriptionRequired:"Description is required",length:"Must be {length} characters",password:{requirements:"Password requirements",minLength:"Must be between 8 and 32 characters",uppercase:"Must contain at least one uppercase letter",lowercase:"Must contain at least one lowercase letter",number:"Must contain at least one number",special:"Must contain at least one special character",match:"Passwords must match"},personalDataConsentRequired:"You must agree to the processing of your personal data."},credits={activity:"Activity",credits:"Credits",yourCreditBalance:"Your credit balance",purchaseCredits:"Purchase Credits",invoiceHistory:"Invoice History",apiPricing:"API Pricing",faqs:"FAQs",messageSupport:"Message Support",lastUpdated:"Last updated",topUp:{insufficientTitle:"Insufficient Credits",insufficientMessage:"You don't have enough credits to run this workflow.",quickPurchase:"Quick Purchase",maxAmount:"(Max. $1,000 USD)",buyNow:"Buy now",seeDetails:"See details",topUp:"Top Up"},eventType:"Event Type",details:"Details",time:"Time",additionalInfo:"Additional Info",model:"Model",added:"Added",accountInitialized:"Account initialized"},subscription={title:"Subscription",titleUnsubscribed:"Subscribe to Comfy Cloud",comfyCloud:"Comfy Cloud",comfyCloudLogo:"Comfy Cloud Logo",beta:"BETA",perMonth:"USD / month",renewsDate:"Renews {date}",refreshesOn:"Refreshes to ${monthlyCreditBonusUsd} on {date}",expiresDate:"Expires {date}",manageSubscription:"Manage subscription",partnerNodesBalance:'"Partner Nodes" Credit Balance',partnerNodesDescription:"For running commercial/proprietary models",totalCredits:"Total credits",viewUsageHistory:"View usage history",addApiCredits:"Add API credits",addCredits:"Add credits",monthlyCreditsRollover:"These credits will rollover to the next month",monthlyBonusDescription:"Monthly credit bonus",prepaidDescription:"Pre-paid credits",prepaidCreditsInfo:"Pre-paid credits expire after 1 year from purchase date.",nextBillingCycle:"next billing cycle",yourPlanIncludes:"Your plan includes:",viewMoreDetails:"View more details",learnMore:"Learn more",messageSupport:"Message support",invoiceHistory:"Invoice history",benefits:{benefit1:"$10 in monthly credits for Partner Nodes â€” top up when needed",benefit2:"Up to 30 min runtime per job"},required:{title:"Subscribe to",waitingForSubscription:"Complete your subscription in the new tab. We'll automatically detect when you're done!",subscribe:"Subscribe"},subscribeToRun:"Subscribe",subscribeToRunFull:"Subscribe to Run",subscribeNow:"Subscribe Now",subscribeToComfyCloud:"Subscribe to Comfy Cloud",partnerNodesCredits:"Partner Nodes pricing table"},userSettings={title:"User Settings",name:"Name",email:"Email",provider:"Sign-in Provider",notSet:"Not set",updatePassword:"Update Password"},selectionToolbox={executeButton:{tooltip:"Execute to selected output nodes (Highlighted with orange border)",disabledTooltip:"No output nodes selected"},"Set Group Nodes to Never":"Set Group Nodes to Never","Bypass Group Nodes":"Bypass Group Nodes","Set Group Nodes to Always":"Set Group Nodes to Always"},widgets$1={selectModel:"Select model",uploadSelect:{placeholder:"Select...",placeholderImage:"Select image...",placeholderAudio:"Select audio...",placeholderVideo:"Select video...",placeholderModel:"Select model...",placeholderUnknown:"Select media..."}},widgetFileUpload={dropPrompt:"Drop your file or",browseFiles:"Browse Files"},nodeHelpPage={inputs:"Inputs",outputs:"Outputs",type:"Type",moreHelp:"For more help, visit the",documentationPage:"documentation page",loadError:"Failed to load help: {error}"},whatsNewPopup={learnMore:"Learn more",noReleaseNotes:"No release notes available."},breadcrumbsMenu={duplicate:"Duplicate",clearWorkflow:"Clear Workflow",deleteWorkflow:"Delete Workflow",deleteBlueprint:"Delete Blueprint",enterNewName:"Enter new name",missingNodesWarning:"Workflow contains unsupported nodes (highlighted red)."},shortcuts={shortcuts:"Shortcuts",essentials:"Essential",viewControls:"View Controls",manageShortcuts:"Manage Shortcuts",noKeybinding:"No keybinding",keyboardShortcuts:"Keyboard Shortcuts",subcategories:{workflow:"Workflow",node:"Node",queue:"Queue",view:"View",panelControls:"Panel Controls"}},minimap={nodeColors:"Node Colors",showLinks:"Show Links",showGroups:"Show Frames/Groups",renderBypassState:"Render Bypass State",renderErrorState:"Render Error State"},cloudOnboarding={survey:{title:"Cloud Survey",placeholder:"Survey questions placeholder",steps:{familiarity:"How familiar are you with ComfyUI?",purpose:"What will you primarily use ComfyUI for?",industry:"What's your primary industry?",making:"What do you plan on making?"},questions:{familiarity:"How familiar are you with ComfyUI?",purpose:"What will you primarily use ComfyUI for?",industry:"What's your primary industry?",making:"What do you plan on making?"},options:{familiarity:{new:"New to ComfyUI (never used it before)",starting:"Just getting started (following tutorials)",basics:"Comfortable with basics",advanced:"Advanced user (custom workflows)",expert:"Expert (help others)"},purpose:{personal:"Personal projects / hobby",community:"Community contributions (nodes, workflows, etc.)",client:"Client work (freelance)",inhouse:"My own workplace (in-house)",research:"Academic research"},industry:{film_tv_animation:"Film, TV, & animation",gaming:"Gaming",marketing:"Marketing & advertising",architecture:"Architecture",product_design:"Product & graphic design",fine_art:"Fine art & illustration",software:"Software & technology",education:"Education",other:"Other",otherPlaceholder:"Please specify"},making:{images:"Images",video:"Video & animation","3d":"3D assets",audio:"Audio / music",custom_nodes:"Custom nodes & workflows"}}},forgotPassword:{title:"Forgot Password",instructions:"Enter your email address and we'll send you a link to reset your password.",emailLabel:"Email",emailPlaceholder:"Enter your email",sendResetLink:"Send reset link",backToLogin:"Back to login",didntReceiveEmail:"Didn't receive an email? Contact us at",passwordResetSent:"Password reset email sent",passwordResetError:"Failed to send password reset email. Please try again.",emailRequired:"Email is required"},privateBeta:{title:"Cloud is currently in private beta",desc:"Sign in to join the waitlist. Weâ€™ll notify you when itâ€™s your turn. Already been notified? Sign in start using Cloud."},start:{title:"start creating in seconds",desc:"Zero setup required. Works on any device.",explain:"Generate multiple outputs at once. Share workflows with ease.",learnAboutButton:"Learn about Cloud",wantToRun:"Want to run ComfyUI locally instead?",download:"Download ComfyUI"},checkingStatus:"Checking your account status...",retrying:"Retrying...",retry:"Try Again",authTimeout:{title:"Connection Taking Too Long",message:"We're having trouble connecting to ComfyUI Cloud. This could be due to a slow connection or temporary service issue.",restart:"Sign Out & Try Again",troubleshooting:"Common causes:",causes:["Corporate firewall or proxy blocking authentication services","VPN or network restrictions","Browser extensions interfering with requests","Regional network limitations","Try a different browser or network"],technicalDetails:"Technical Details",helpText:"Need help? Contact",supportLink:"support"}},cloudFooter_needHelp="Need Help?",cloudStart_title="start creating in seconds",cloudStart_desc="Zero setup required. Works on any device.",cloudStart_explain="Generate multiple outputs at once. Share workflows with ease.",cloudStart_learnAboutButton="Learn about Cloud",cloudStart_wantToRun="Want to run ComfyUI locally instead?",cloudStart_download="Download ComfyUI",cloudWaitlist_questionsText="Questions? Contact us",cloudWaitlist_contactLink="here",cloudSorryContactSupport_title="Sorry, contact support",cloudPrivateBeta_title="Cloud is currently in private beta",cloudPrivateBeta_desc="Sign in to join the waitlist. We'll notify you when it's your turn. Already been notified? Sign in start using Cloud.",cloudForgotPassword_title="Forgot Password",cloudForgotPassword_instructions="Enter your email address and we'll send you a link to reset your password.",cloudForgotPassword_emailLabel="Email",cloudForgotPassword_emailPlaceholder="Enter your email",cloudForgotPassword_sendResetLink="Send reset link",cloudForgotPassword_backToLogin="Back to login",cloudForgotPassword_didntReceiveEmail="Didn't receive an email?",cloudForgotPassword_emailRequired="Email is required",cloudForgotPassword_passwordResetSent="Password reset sent",cloudForgotPassword_passwordResetError="Failed to send password reset email",cloudSurvey_steps_familiarity="How familiar are you with ComfyUI?",cloudSurvey_steps_purpose="What will you primarily use ComfyUI for?",cloudSurvey_steps_industry="What's your primary industry?",cloudSurvey_steps_making="What do you plan on making?",assetBrowser={assets:"Assets",assetCollection:"Asset collection",checkpoints:"Checkpoints",browseAssets:"Browse Assets",noAssetsFound:"No assets found",tryAdjustingFilters:"Try adjusting your search or filters",loadingModels:"Loading {type}...",connectionError:"Please check your connection and try again",failedToCreateNode:"Failed to create node. Please try again or check console for details.",noModelsInFolder:"No {type} available in this folder",searchAssetsPlaceholder:"Type to search...",uploadModel:"Import model",uploadModelFromCivitai:"Import a model from Civitai",uploadModelFailedToRetrieveMetadata:"Failed to retrieve metadata. Please check the link and try again.",onlyCivitaiUrlsSupported:"Only Civitai URLs are supported",uploadModelDescription1:"Paste a Civitai model download link to add it to your library.",uploadModelDescription2:'Only links from <a href="https://civitai.com" target="_blank" class="text-muted-foreground">https://civitai.com</a> are supported at the moment',uploadModelDescription3:"Max file size: <strong>1 GB</strong>",civitaiLinkLabel:'Civitai model <span class="font-bold italic">download</span> link',civitaiLinkPlaceholder:"Paste link here",civitaiLinkExample:'<strong>Example:</strong> <a href="https://civitai.com/api/download/models/833921?type=Model&format=SafeTensor" target="_blank" class="text-muted-foreground">https://civitai.com/api/download/models/833921?type=Model&format=SafeTensor</a>',confirmModelDetails:"Confirm Model Details",fileName:"File Name",fileSize:"File Size",modelName:"Model Name",modelNamePlaceholder:"Enter a name for this model",tags:"Tags",tagsPlaceholder:"e.g., models, checkpoint",tagsHelp:"Separate tags with commas",upload:"Import",uploadingModel:"Importing model...",uploadSuccess:"Model imported successfully!",uploadFailed:"Import failed",modelAssociatedWithLink:"The model associated with the link you provided:",modelTypeSelectorLabel:"What type of model is this?",modelTypeSelectorPlaceholder:"Select model type",selectModelType:"Select model type",notSureLeaveAsIs:"Not sure? Just leave this as is",modelUploaded:"Model imported! ðŸŽ‰",findInLibrary:"Find it in the {type} section of the models library.",finish:"Finish",allModels:"All Models",allCategory:"All {category}",unknown:"Unknown",fileFormats:"File formats",baseModels:"Base models",filterBy:"Filter by",sortBy:"Sort by",sortAZ:"A-Z",sortZA:"Z-A",sortRecent:"Recent",sortPopular:"Popular",selectFrameworks:"Select Frameworks",selectProjects:"Select Projects",sortingType:"Sorting Type",errorFileTooLarge:"File exceeds the maximum allowed size limit",errorFormatNotAllowed:"Only SafeTensor format is allowed",errorUnsafePickleScan:"CivitAI detected potentially unsafe code in this file",errorUnsafeVirusScan:"CivitAI detected malware or suspicious content in this file",errorModelTypeNotSupported:"This model type is not supported",errorUnknown:"An unexpected error occurred",errorUploadFailed:"Failed to import asset. Please try again.",ariaLabel:{assetCard:"{name} - {type} asset",loadingAsset:"Loading asset"},media:{threeDModelPlaceholder:"3D Model",audioPlaceholder:"Audio"}},mediaAsset={deleteAssetTitle:"Delete this asset?",deleteAssetDescription:"This asset will be permanently removed.",deleteSelectedTitle:"Delete selected assets?",deleteSelectedDescription:"{count} asset(s) will be permanently removed.",assetDeletedSuccessfully:"Asset deleted successfully",deletingImportedFilesCloudOnly:"Deleting imported files is only supported in cloud version",failedToDeleteAsset:"Failed to delete asset",actions:{inspect:"Inspect",more:"More options",seeMoreOutputs:"See more outputs"},jobIdToast:{jobIdCopied:"Job ID copied to clipboard",jobIdCopyFailed:"Failed to copy Job ID",copied:"Copied",error:"Error"},selection:{selectedCount:"Assets Selected: {count}",deselectAll:"Deselect all",downloadSelected:"Download",deleteSelected:"Delete",downloadStarted:"Downloading {count} files...",downloadsStarted:"Started downloading {count} file(s)",assetsDeletedSuccessfully:"{count} asset(s) deleted successfully",failedToDeleteAssets:"Failed to delete selected assets",partialDeleteSuccess:"{succeeded} deleted successfully, {failed} failed"},noJobIdFound:"No job ID found for this asset",unsupportedFileType:"Unsupported file type for loader node",nodeTypeNotFound:"Node type {nodeType} not found",failedToCreateNode:"Failed to create node",nodeAddedToWorkflow:"{nodeType} node added to workflow",noWorkflowDataFound:"No workflow data found in this asset",workflowOpenedInNewTab:"Workflow opened in new tab",failedToExportWorkflow:"Failed to export workflow",workflowExportedSuccessfully:"Workflow exported successfully"},actionbar={dockToTop:"Dock to top",feedback:"Feedback",feedbackTooltip:"Feedback"},desktopDialogs={"":{title:"Invalid Dialog",message:"Invalid dialog ID was provided.",buttons:{Close:"Close"}}},vueNodesBanner={title:"Introducing Nodes 2.0",desc:"â€“ More flexible workflows, powerful new widgets, built for extensibility",tryItOut:"Try it out"},vueNodesMigration={message:"Prefer the legacy design?",button:"Switch back"},vueNodesMigrationMainMenu={message:"Switch back to Nodes 2.0 anytime from the main menu."},linearMode={share:"Share",openWorkflow:"Open Workflow"},missingNodes={cloud:{title:"These nodes aren't available on Comfy Cloud yet",description:"This workflow uses custom nodes that aren't supported in the Cloud version yet.",priorityMessage:"We've automatically flagged these nodes so we can prioritize adding them.",replacementInstruction:"In the meantime, replace these nodes (highlighted red on the canvas) with supported ones if possible, or try a different workflow.",learnMore:"Learn more",gotIt:"Ok, got it"},oss:{title:"This workflow has missing nodes",description:"This workflow uses custom nodes you haven't installed yet.",replacementInstruction:"Install these nodes to run this workflow, or replace them with installed alternatives. Missing nodes are highlighted in red on the canvas."}},en={g,manager,issueReport,color,contextMenu,icon,welcome,userSelect,notSupported,downloadGit,install,desktopStart,serverStart,serverConfig,shape,sideToolbar,helpCenter,releaseToast,menu,tabMenu,templateWorkflows,templateWidgets,graphCanvasMenu,zoomControls,groupNode,nodeTemplates,workflowService,subgraphStore,electronFileDownload,maskEditor,commands,queue,menuLabels,desktopMenu,settingsCategories,serverConfigItems,serverConfigCategories,nodeCategories,dataTypes,maintenance,missingModelsDialog,versionMismatchWarning,errorDialog,apiNodesSignInDialog,apiNodesCostBreakdown,desktopUpdate,clipboard,load3d,toastMessages,nodeErrors,auth,validation,credits,subscription,userSettings,selectionToolbox,widgets:widgets$1,widgetFileUpload,nodeHelpPage,whatsNewPopup,breadcrumbsMenu,shortcuts,minimap,cloudOnboarding,cloudFooter_needHelp,cloudStart_title,cloudStart_desc,cloudStart_explain,cloudStart_learnAboutButton,cloudStart_wantToRun,cloudStart_download,cloudWaitlist_questionsText,cloudWaitlist_contactLink,cloudSorryContactSupport_title,cloudPrivateBeta_title,cloudPrivateBeta_desc,cloudForgotPassword_title,cloudForgotPassword_instructions,cloudForgotPassword_emailLabel,cloudForgotPassword_emailPlaceholder,cloudForgotPassword_sendResetLink,cloudForgotPassword_backToLogin,cloudForgotPassword_didntReceiveEmail,cloudForgotPassword_emailRequired,cloudForgotPassword_passwordResetSent,cloudForgotPassword_passwordResetError,cloudSurvey_steps_familiarity,cloudSurvey_steps_purpose,cloudSurvey_steps_industry,cloudSurvey_steps_making,assetBrowser,mediaAsset,actionbar,desktopDialogs,vueNodesBanner,vueNodesMigration,vueNodesMigrationMainMenu,linearMode,missingNodes},AddNoise={display_name:"AddNoise",inputs:{model:{name:"model"},noise:{name:"noise"},sigmas:{name:"sigmas"},latent_image:{name:"latent_image"}}},AlignYourStepsScheduler={display_name:"AlignYourStepsScheduler",inputs:{model_type:{name:"model_type"},steps:{name:"steps"},denoise:{name:"denoise"}},outputs:{0:{tooltip:null}}},APG={display_name:"Adaptive Projected Guidance",inputs:{model:{name:"model"},eta:{name:"eta",tooltip:"Controls the scale of the parallel guidance vector. Default CFG behavior at a setting of 1."},norm_threshold:{name:"norm_threshold",tooltip:"Normalize guidance vector to this value, normalization disable at a setting of 0."},momentum:{name:"momentum",tooltip:"Controls a running average of guidance during diffusion, disabled at a setting of 0."}},outputs:{0:{tooltip:null}}},AudioAdjustVolume={display_name:"Audio Adjust Volume",inputs:{audio:{name:"audio"},volume:{name:"volume",tooltip:"Volume adjustment in decibels (dB). 0 = no change, +6 = double, -6 = half, etc"}}},AudioConcat={display_name:"Audio Concat",description:"Concatenates the audio1 to audio2 in the specified direction.",inputs:{audio1:{name:"audio1"},audio2:{name:"audio2"},direction:{name:"direction",tooltip:"Whether to append audio2 after or before audio1."}}},AudioEncoderEncode={display_name:"AudioEncoderEncode",inputs:{audio_encoder:{name:"audio_encoder"},audio:{name:"audio"}},outputs:{0:{tooltip:null}}},AudioEncoderLoader={display_name:"AudioEncoderLoader",inputs:{audio_encoder_name:{name:"audio_encoder_name"}},outputs:{0:{tooltip:null}}},AudioMerge={display_name:"Audio Merge",description:"Combine two audio tracks by overlaying their waveforms.",inputs:{audio1:{name:"audio1"},audio2:{name:"audio2"},merge_method:{name:"merge_method",tooltip:"The method used to combine the audio waveforms."}}},BasicGuider={display_name:"BasicGuider",inputs:{model:{name:"model"},conditioning:{name:"conditioning"}}},BasicScheduler={display_name:"BasicScheduler",inputs:{model:{name:"model"},scheduler:{name:"scheduler"},steps:{name:"steps"},denoise:{name:"denoise"}}},BetaSamplingScheduler={display_name:"BetaSamplingScheduler",inputs:{model:{name:"model"},steps:{name:"steps"},alpha:{name:"alpha"},beta:{name:"beta"}}},ByteDanceFirstLastFrameNode={display_name:"ByteDance First-Last-Frame to Video",description:"Generate video using prompt and first and last frames.",inputs:{model:{name:"model",tooltip:"Model name"},prompt:{name:"prompt",tooltip:"The text prompt used to generate the video."},first_frame:{name:"first_frame",tooltip:"First frame to be used for the video."},last_frame:{name:"last_frame",tooltip:"Last frame to be used for the video."},resolution:{name:"resolution",tooltip:"The resolution of the output video."},aspect_ratio:{name:"aspect_ratio",tooltip:"The aspect ratio of the output video."},duration:{name:"duration",tooltip:"The duration of the output video in seconds."},seed:{name:"seed",tooltip:"Seed to use for generation."},camera_fixed:{name:"camera_fixed",tooltip:"Specifies whether to fix the camera. The platform appends an instruction to fix the camera to your prompt, but does not guarantee the actual effect."},watermark:{name:"watermark",tooltip:'Whether to add an "AI generated" watermark to the video.'},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},ByteDanceImageEditNode={display_name:"ByteDance Image Edit",description:"Edit images using ByteDance models via api based on prompt",inputs:{model:{name:"model",tooltip:"Model name"},image:{name:"image",tooltip:"The base image to edit"},prompt:{name:"prompt",tooltip:"Instruction to edit image"},seed:{name:"seed",tooltip:"Seed to use for generation"},guidance_scale:{name:"guidance_scale",tooltip:"Higher value makes the image follow the prompt more closely"},watermark:{name:"watermark",tooltip:'Whether to add an "AI generated" watermark to the image'},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},ByteDanceImageNode={display_name:"ByteDance Image",description:"Generate images using ByteDance models via api based on prompt",inputs:{model:{name:"model",tooltip:"Model name"},prompt:{name:"prompt",tooltip:"The text prompt used to generate the image"},size_preset:{name:"size_preset",tooltip:"Pick a recommended size. Select Custom to use the width and height below"},width:{name:"width",tooltip:"Custom width for image. Value is working only if `size_preset` is set to `Custom`"},height:{name:"height",tooltip:"Custom height for image. Value is working only if `size_preset` is set to `Custom`"},seed:{name:"seed",tooltip:"Seed to use for generation"},guidance_scale:{name:"guidance_scale",tooltip:"Higher value makes the image follow the prompt more closely"},watermark:{name:"watermark",tooltip:'Whether to add an "AI generated" watermark to the image'},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},ByteDanceImageReferenceNode={display_name:"ByteDance Reference Images to Video",description:"Generate video using prompt and reference images.",inputs:{model:{name:"model",tooltip:"Model name"},prompt:{name:"prompt",tooltip:"The text prompt used to generate the video."},images:{name:"images",tooltip:"One to four images."},resolution:{name:"resolution",tooltip:"The resolution of the output video."},aspect_ratio:{name:"aspect_ratio",tooltip:"The aspect ratio of the output video."},duration:{name:"duration",tooltip:"The duration of the output video in seconds."},seed:{name:"seed",tooltip:"Seed to use for generation."},watermark:{name:"watermark",tooltip:'Whether to add an "AI generated" watermark to the video.'},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},ByteDanceImageToVideoNode={display_name:"ByteDance Image to Video",description:"Generate video using ByteDance models via api based on image and prompt",inputs:{model:{name:"model",tooltip:"Model name"},prompt:{name:"prompt",tooltip:"The text prompt used to generate the video."},image:{name:"image",tooltip:"First frame to be used for the video."},resolution:{name:"resolution",tooltip:"The resolution of the output video."},aspect_ratio:{name:"aspect_ratio",tooltip:"The aspect ratio of the output video."},duration:{name:"duration",tooltip:"The duration of the output video in seconds."},seed:{name:"seed",tooltip:"Seed to use for generation."},camera_fixed:{name:"camera_fixed",tooltip:"Specifies whether to fix the camera. The platform appends an instruction to fix the camera to your prompt, but does not guarantee the actual effect."},watermark:{name:"watermark",tooltip:'Whether to add an "AI generated" watermark to the video.'},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},ByteDanceSeedreamNode={display_name:"ByteDance Seedream 4",description:"Unified text-to-image generation and precise single-sentence editing at up to 4K resolution.",inputs:{model:{name:"model",tooltip:"Model name"},prompt:{name:"prompt",tooltip:"Text prompt for creating or editing an image."},size_preset:{name:"size_preset",tooltip:"Pick a recommended size. Select Custom to use the width and height below."},image:{name:"image",tooltip:"Input image(s) for image-to-image generation. List of 1-10 images for single or multi-reference generation."},width:{name:"width",tooltip:"Custom width for image. Value is working only if `size_preset` is set to `Custom`"},height:{name:"height",tooltip:"Custom height for image. Value is working only if `size_preset` is set to `Custom`"},sequential_image_generation:{name:"sequential_image_generation",tooltip:"Group image generation mode. 'disabled' generates a single image. 'auto' lets the model decide whether to generate multiple related images (e.g., story scenes, character variations)."},max_images:{name:"max_images",tooltip:"Maximum number of images to generate when sequential_image_generation='auto'. Total images (input + generated) cannot exceed 15."},seed:{name:"seed",tooltip:"Seed to use for generation."},watermark:{name:"watermark",tooltip:'Whether to add an "AI generated" watermark to the image.'},fail_on_partial:{name:"fail_on_partial",tooltip:"If enabled, abort execution if any requested images are missing or return an error."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},ByteDanceTextToVideoNode={display_name:"ByteDance Text to Video",description:"Generate video using ByteDance models via api based on prompt",inputs:{model:{name:"model",tooltip:"Model name"},prompt:{name:"prompt",tooltip:"The text prompt used to generate the video."},resolution:{name:"resolution",tooltip:"The resolution of the output video."},aspect_ratio:{name:"aspect_ratio",tooltip:"The aspect ratio of the output video."},duration:{name:"duration",tooltip:"The duration of the output video in seconds."},seed:{name:"seed",tooltip:"Seed to use for generation."},camera_fixed:{name:"camera_fixed",tooltip:"Specifies whether to fix the camera. The platform appends an instruction to fix the camera to your prompt, but does not guarantee the actual effect."},watermark:{name:"watermark",tooltip:'Whether to add an "AI generated" watermark to the video.'},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},Canny={display_name:"Canny",inputs:{image:{name:"image"},low_threshold:{name:"low_threshold"},high_threshold:{name:"high_threshold"}},outputs:{0:{tooltip:null}}},CaseConverter={display_name:"Case Converter",inputs:{string:{name:"string"},mode:{name:"mode"}},outputs:{0:{tooltip:null}}},CFGGuider={display_name:"CFGGuider",inputs:{model:{name:"model"},positive:{name:"positive"},negative:{name:"negative"},cfg:{name:"cfg"}}},CFGNorm={display_name:"CFGNorm",inputs:{model:{name:"model"},strength:{name:"strength"}},outputs:{0:{name:"patched_model",tooltip:null}}},CFGZeroStar={display_name:"CFGZeroStar",inputs:{model:{name:"model"}},outputs:{0:{name:"patched_model",tooltip:null}}},CheckpointLoader={display_name:"Load Checkpoint With Config (DEPRECATED)",inputs:{config_name:{name:"config_name"},ckpt_name:{name:"ckpt_name"}}},CheckpointLoaderSimple={display_name:"Load Checkpoint",description:"Loads a diffusion model checkpoint, diffusion models are used to denoise latents.",inputs:{ckpt_name:{name:"ckpt_name",tooltip:"The name of the checkpoint (model) to load."}},outputs:{0:{tooltip:"The model used for denoising latents."},1:{tooltip:"The CLIP model used for encoding text prompts."},2:{tooltip:"The VAE model used for encoding and decoding images to and from latent space."}}},CheckpointSave={display_name:"Save Checkpoint",inputs:{model:{name:"model"},clip:{name:"clip"},vae:{name:"vae"},filename_prefix:{name:"filename_prefix"}}},ChromaRadianceOptions={display_name:"ChromaRadianceOptions",description:"Allows setting advanced options for the Chroma Radiance model.",inputs:{model:{name:"model"},preserve_wrapper:{name:"preserve_wrapper",tooltip:"When enabled, will delegate to an existing model function wrapper if it exists. Generally should be left enabled."},start_sigma:{name:"start_sigma",tooltip:"First sigma that these options will be in effect."},end_sigma:{name:"end_sigma",tooltip:"Last sigma that these options will be in effect."},nerf_tile_size:{name:"nerf_tile_size",tooltip:"Allows overriding the default NeRF tile size. -1 means use the default (32). 0 means use non-tiling mode (may require a lot of VRAM)."}},outputs:{0:{tooltip:null}}},CLIPAttentionMultiply={display_name:"CLIPAttentionMultiply",inputs:{clip:{name:"clip"},q:{name:"q"},k:{name:"k"},v:{name:"v"},out:{name:"out"}},outputs:{0:{tooltip:null}}},CLIPLoader={display_name:"Load CLIP",description:`[Recipes]

stable_diffusion: clip-l
stable_cascade: clip-g
sd3: t5 xxl/ clip-g / clip-l
stable_audio: t5 base
mochi: t5 xxl
cosmos: old t5 xxl
lumina2: gemma 2 2B
wan: umt5 xxl
 hidream: llama-3.1 (Recommend) or t5
omnigen2: qwen vl 2.5 3B`,inputs:{clip_name:{name:"clip_name"},type:{name:"type"},device:{name:"device"}}},CLIPMergeAdd={display_name:"CLIPMergeAdd",inputs:{clip1:{name:"clip1"},clip2:{name:"clip2"}}},CLIPMergeSimple={display_name:"CLIPMergeSimple",inputs:{clip1:{name:"clip1"},clip2:{name:"clip2"},ratio:{name:"ratio"}}},CLIPMergeSubtract={display_name:"CLIPMergeSubtract",inputs:{clip1:{name:"clip1"},clip2:{name:"clip2"},multiplier:{name:"multiplier"}}},CLIPSave={display_name:"CLIPSave",inputs:{clip:{name:"clip"},filename_prefix:{name:"filename_prefix"}}},CLIPSetLastLayer={display_name:"CLIP Set Last Layer",inputs:{clip:{name:"clip"},stop_at_clip_layer:{name:"stop_at_clip_layer"}}},CLIPTextEncode={display_name:"CLIP Text Encode (Prompt)",description:"Encodes a text prompt using a CLIP model into an embedding that can be used to guide the diffusion model towards generating specific images.",inputs:{text:{name:"text",tooltip:"The text to be encoded."},clip:{name:"clip",tooltip:"The CLIP model used for encoding the text."}},outputs:{0:{tooltip:"A conditioning containing the embedded text used to guide the diffusion model."}}},CLIPTextEncodeControlnet={display_name:"CLIPTextEncodeControlnet",inputs:{clip:{name:"clip"},conditioning:{name:"conditioning"},text:{name:"text"}},outputs:{0:{tooltip:null}}},CLIPTextEncodeFlux={display_name:"CLIPTextEncodeFlux",inputs:{clip:{name:"clip"},clip_l:{name:"clip_l"},t5xxl:{name:"t5xxl"},guidance:{name:"guidance"}},outputs:{0:{tooltip:null}}},CLIPTextEncodeHiDream={display_name:"CLIPTextEncodeHiDream",inputs:{clip:{name:"clip"},clip_l:{name:"clip_l"},clip_g:{name:"clip_g"},t5xxl:{name:"t5xxl"},llama:{name:"llama"}},outputs:{0:{tooltip:null}}},CLIPTextEncodeHunyuanDiT={display_name:"CLIPTextEncodeHunyuanDiT",inputs:{clip:{name:"clip"},bert:{name:"bert"},mt5xl:{name:"mt5xl"}},outputs:{0:{tooltip:null}}},CLIPTextEncodeLumina2={display_name:"CLIP Text Encode for Lumina2",description:"Encodes a system prompt and a user prompt using a CLIP model into an embedding that can be used to guide the diffusion model towards generating specific images.",inputs:{system_prompt:{name:"system_prompt",tooltip:"Lumina2 provide two types of system prompts:Superior: You are an assistant designed to generate superior images with the superior degree of image-text alignment based on textual prompts or user prompts. Alignment: You are an assistant designed to generate high-quality images with the highest degree of image-text alignment based on textual prompts."},user_prompt:{name:"user_prompt",tooltip:"The text to be encoded."},clip:{name:"clip",tooltip:"The CLIP model used for encoding the text."}},outputs:{0:{tooltip:"A conditioning containing the embedded text used to guide the diffusion model."}}},CLIPTextEncodePixArtAlpha={display_name:"CLIPTextEncodePixArtAlpha",description:"Encodes text and sets the resolution conditioning for PixArt Alpha. Does not apply to PixArt Sigma.",inputs:{width:{name:"width"},height:{name:"height"},text:{name:"text"},clip:{name:"clip"}},outputs:{0:{tooltip:null}}},CLIPTextEncodeSD3={display_name:"CLIPTextEncodeSD3",inputs:{clip:{name:"clip"},clip_l:{name:"clip_l"},clip_g:{name:"clip_g"},t5xxl:{name:"t5xxl"},empty_padding:{name:"empty_padding"}},outputs:{0:{tooltip:null}}},CLIPTextEncodeSDXL={display_name:"CLIPTextEncodeSDXL",inputs:{clip:{name:"clip"},width:{name:"width"},height:{name:"height"},crop_w:{name:"crop_w"},crop_h:{name:"crop_h"},target_width:{name:"target_width"},target_height:{name:"target_height"},text_g:{name:"text_g"},text_l:{name:"text_l"}},outputs:{0:{tooltip:null}}},CLIPTextEncodeSDXLRefiner={display_name:"CLIPTextEncodeSDXLRefiner",inputs:{ascore:{name:"ascore"},width:{name:"width"},height:{name:"height"},text:{name:"text"},clip:{name:"clip"}},outputs:{0:{tooltip:null}}},CLIPVisionEncode={display_name:"CLIP Vision Encode",inputs:{clip_vision:{name:"clip_vision"},image:{name:"image"},crop:{name:"crop"}}},CLIPVisionLoader={display_name:"Load CLIP Vision",inputs:{clip_name:{name:"clip_name"}}},CombineHooks2={display_name:"Combine Hooks [2]",inputs:{hooks_A:{name:"hooks_A"},hooks_B:{name:"hooks_B"}}},CombineHooks4={display_name:"Combine Hooks [4]",inputs:{hooks_A:{name:"hooks_A"},hooks_B:{name:"hooks_B"},hooks_C:{name:"hooks_C"},hooks_D:{name:"hooks_D"}}},CombineHooks8={display_name:"Combine Hooks [8]",inputs:{hooks_A:{name:"hooks_A"},hooks_B:{name:"hooks_B"},hooks_C:{name:"hooks_C"},hooks_D:{name:"hooks_D"},hooks_E:{name:"hooks_E"},hooks_F:{name:"hooks_F"},hooks_G:{name:"hooks_G"},hooks_H:{name:"hooks_H"}}},ConditioningAverage={display_name:"ConditioningAverage",inputs:{conditioning_to:{name:"conditioning_to"},conditioning_from:{name:"conditioning_from"},conditioning_to_strength:{name:"conditioning_to_strength"}}},ConditioningCombine={display_name:"Conditioning (Combine)",inputs:{conditioning_1:{name:"conditioning_1"},conditioning_2:{name:"conditioning_2"}}},ConditioningConcat={display_name:"Conditioning (Concat)",inputs:{conditioning_to:{name:"conditioning_to"},conditioning_from:{name:"conditioning_from"}}},ConditioningSetArea={display_name:"Conditioning (Set Area)",inputs:{conditioning:{name:"conditioning"},width:{name:"width"},height:{name:"height"},x:{name:"x"},y:{name:"y"},strength:{name:"strength"}}},ConditioningSetAreaPercentage={display_name:"Conditioning (Set Area with Percentage)",inputs:{conditioning:{name:"conditioning"},width:{name:"width"},height:{name:"height"},x:{name:"x"},y:{name:"y"},strength:{name:"strength"}}},ConditioningSetAreaPercentageVideo={display_name:"ConditioningSetAreaPercentageVideo",inputs:{conditioning:{name:"conditioning"},width:{name:"width"},height:{name:"height"},temporal:{name:"temporal"},x:{name:"x"},y:{name:"y"},z:{name:"z"},strength:{name:"strength"}}},ConditioningSetAreaStrength={display_name:"ConditioningSetAreaStrength",inputs:{conditioning:{name:"conditioning"},strength:{name:"strength"}}},ConditioningSetDefaultCombine={display_name:"Cond Set Default Combine",inputs:{cond:{name:"cond"},cond_DEFAULT:{name:"cond_DEFAULT"},hooks:{name:"hooks"}}},ConditioningSetMask={display_name:"Conditioning (Set Mask)",inputs:{conditioning:{name:"conditioning"},mask:{name:"mask"},strength:{name:"strength"},set_cond_area:{name:"set_cond_area"}}},ConditioningSetProperties={display_name:"Cond Set Props",inputs:{cond_NEW:{name:"cond_NEW"},strength:{name:"strength"},set_cond_area:{name:"set_cond_area"},mask:{name:"mask"},hooks:{name:"hooks"},timesteps:{name:"timesteps"}}},ConditioningSetPropertiesAndCombine={display_name:"Cond Set Props Combine",inputs:{cond:{name:"cond"},cond_NEW:{name:"cond_NEW"},strength:{name:"strength"},set_cond_area:{name:"set_cond_area"},mask:{name:"mask"},hooks:{name:"hooks"},timesteps:{name:"timesteps"}}},ConditioningSetTimestepRange={display_name:"ConditioningSetTimestepRange",inputs:{conditioning:{name:"conditioning"},start:{name:"start"},end:{name:"end"}}},ConditioningStableAudio={display_name:"ConditioningStableAudio",inputs:{positive:{name:"positive"},negative:{name:"negative"},seconds_start:{name:"seconds_start"},seconds_total:{name:"seconds_total"}},outputs:{0:{name:"positive"},1:{name:"negative"}}},ConditioningTimestepsRange={display_name:"Timesteps Range",inputs:{start_percent:{name:"start_percent"},end_percent:{name:"end_percent"}},outputs:{1:{name:"BEFORE_RANGE"},2:{name:"AFTER_RANGE"}}},ConditioningZeroOut={display_name:"ConditioningZeroOut",inputs:{conditioning:{name:"conditioning"}}},ContextWindowsManual={display_name:"Context Windows (Manual)",description:"Manually set context windows.",inputs:{model:{name:"model",tooltip:"The model to apply context windows to during sampling."},context_length:{name:"context_length",tooltip:"The length of the context window."},context_overlap:{name:"context_overlap",tooltip:"The overlap of the context window."},context_schedule:{name:"context_schedule",tooltip:"The stride of the context window."},context_stride:{name:"context_stride",tooltip:"The stride of the context window; only applicable to uniform schedules."},closed_loop:{name:"closed_loop",tooltip:"Whether to close the context window loop; only applicable to looped schedules."},fuse_method:{name:"fuse_method",tooltip:"The method to use to fuse the context windows."},dim:{name:"dim",tooltip:"The dimension to apply the context windows to."}},outputs:{0:{tooltip:"The model with context windows applied during sampling."}}},ControlNetApply={display_name:"Apply ControlNet (OLD)",inputs:{conditioning:{name:"conditioning"},control_net:{name:"control_net"},image:{name:"image"},strength:{name:"strength"}}},ControlNetApplyAdvanced={display_name:"Apply ControlNet",inputs:{positive:{name:"positive"},negative:{name:"negative"},control_net:{name:"control_net"},image:{name:"image"},strength:{name:"strength"},start_percent:{name:"start_percent"},end_percent:{name:"end_percent"},vae:{name:"vae"}},outputs:{0:{name:"positive"},1:{name:"negative"}}},ControlNetApplySD3={display_name:"Apply Controlnet with VAE",inputs:{positive:{name:"positive"},negative:{name:"negative"},control_net:{name:"control_net"},vae:{name:"vae"},image:{name:"image"},strength:{name:"strength"},start_percent:{name:"start_percent"},end_percent:{name:"end_percent"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null}}},ControlNetInpaintingAliMamaApply={display_name:"ControlNetInpaintingAliMamaApply",inputs:{positive:{name:"positive"},negative:{name:"negative"},control_net:{name:"control_net"},vae:{name:"vae"},image:{name:"image"},mask:{name:"mask"},strength:{name:"strength"},start_percent:{name:"start_percent"},end_percent:{name:"end_percent"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null}}},ControlNetLoader={display_name:"Load ControlNet Model",inputs:{control_net_name:{name:"control_net_name"}}},CosmosImageToVideoLatent={display_name:"CosmosImageToVideoLatent",inputs:{vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},start_image:{name:"start_image"},end_image:{name:"end_image"}},outputs:{0:{tooltip:null}}},CosmosPredict2ImageToVideoLatent={display_name:"CosmosPredict2ImageToVideoLatent",inputs:{vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},start_image:{name:"start_image"},end_image:{name:"end_image"}},outputs:{0:{tooltip:null}}},CreateHookKeyframe={display_name:"Create Hook Keyframe",inputs:{strength_mult:{name:"strength_mult"},start_percent:{name:"start_percent"},prev_hook_kf:{name:"prev_hook_kf"}},outputs:{0:{name:"HOOK_KF"}}},CreateHookKeyframesFromFloats={display_name:"Create Hook Keyframes From Floats",inputs:{floats_strength:{name:"floats_strength"},start_percent:{name:"start_percent"},end_percent:{name:"end_percent"},print_keyframes:{name:"print_keyframes"},prev_hook_kf:{name:"prev_hook_kf"}},outputs:{0:{name:"HOOK_KF"}}},CreateHookKeyframesInterpolated={display_name:"Create Hook Keyframes Interp.",inputs:{strength_start:{name:"strength_start"},strength_end:{name:"strength_end"},interpolation:{name:"interpolation"},start_percent:{name:"start_percent"},end_percent:{name:"end_percent"},keyframes_count:{name:"keyframes_count"},print_keyframes:{name:"print_keyframes"},prev_hook_kf:{name:"prev_hook_kf"}},outputs:{0:{name:"HOOK_KF"}}},CreateHookLora={display_name:"Create Hook LoRA",inputs:{lora_name:{name:"lora_name"},strength_model:{name:"strength_model"},strength_clip:{name:"strength_clip"},prev_hooks:{name:"prev_hooks"}}},CreateHookLoraModelOnly={display_name:"Create Hook LoRA (MO)",inputs:{lora_name:{name:"lora_name"},strength_model:{name:"strength_model"},prev_hooks:{name:"prev_hooks"}}},CreateHookModelAsLora={display_name:"Create Hook Model as LoRA",inputs:{ckpt_name:{name:"ckpt_name"},strength_model:{name:"strength_model"},strength_clip:{name:"strength_clip"},prev_hooks:{name:"prev_hooks"}}},CreateHookModelAsLoraModelOnly={display_name:"Create Hook Model as LoRA (MO)",inputs:{ckpt_name:{name:"ckpt_name"},strength_model:{name:"strength_model"},prev_hooks:{name:"prev_hooks"}}},CreateVideo={display_name:"Create Video",description:"Create a video from images.",inputs:{images:{name:"images",tooltip:"The images to create a video from."},fps:{name:"fps"},audio:{name:"audio",tooltip:"The audio to add to the video."}},outputs:{0:{tooltip:null}}},CropMask={display_name:"CropMask",inputs:{mask:{name:"mask"},x:{name:"x"},y:{name:"y"},width:{name:"width"},height:{name:"height"}}},DiffControlNetLoader={display_name:"Load ControlNet Model (diff)",inputs:{model:{name:"model"},control_net_name:{name:"control_net_name"}}},DifferentialDiffusion={display_name:"Differential Diffusion",inputs:{model:{name:"model"},strength:{name:"strength"}},outputs:{0:{tooltip:null}}},DiffusersLoader={display_name:"DiffusersLoader",inputs:{model_path:{name:"model_path"}}},DisableNoise={display_name:"DisableNoise"},DualCFGGuider={display_name:"DualCFGGuider",inputs:{model:{name:"model"},cond1:{name:"cond1"},cond2:{name:"cond2"},negative:{name:"negative"},cfg_conds:{name:"cfg_conds"},cfg_cond2_negative:{name:"cfg_cond2_negative"},style:{name:"style"}}},DualCLIPLoader={display_name:"DualCLIPLoader",description:`[Recipes]

sdxl: clip-l, clip-g
sd3: clip-l, clip-g / clip-l, t5 / clip-g, t5
flux: clip-l, t5
hidream: at least one of t5 or llama, recommended t5 and llama
hunyuan_image: qwen2.5vl 7b and byt5 small`,inputs:{clip_name1:{name:"clip_name1"},clip_name2:{name:"clip_name2"},type:{name:"type"},device:{name:"device"}}},EasyCache={display_name:"EasyCache",description:"Native EasyCache implementation.",inputs:{model:{name:"model",tooltip:"The model to add EasyCache to."},reuse_threshold:{name:"reuse_threshold",tooltip:"The threshold for reusing cached steps."},start_percent:{name:"start_percent",tooltip:"The relative sampling step to begin use of EasyCache."},end_percent:{name:"end_percent",tooltip:"The relative sampling step to end use of EasyCache."},verbose:{name:"verbose",tooltip:"Whether to log verbose information."}},outputs:{0:{tooltip:"The model with EasyCache."}}},EmptyAceStepLatentAudio={display_name:"EmptyAceStepLatentAudio",inputs:{seconds:{name:"seconds"},batch_size:{name:"batch_size",tooltip:"The number of latent images in the batch."}},outputs:{0:{tooltip:null}}},EmptyAudio={display_name:"Empty Audio",inputs:{duration:{name:"duration",tooltip:"Duration of the empty audio clip in seconds"},sample_rate:{name:"sample_rate",tooltip:"Sample rate of the empty audio clip."},channels:{name:"channels",tooltip:"Number of audio channels (1 for mono, 2 for stereo)."}}},EmptyChromaRadianceLatentImage={display_name:"EmptyChromaRadianceLatentImage",inputs:{width:{name:"width"},height:{name:"height"},batch_size:{name:"batch_size"}},outputs:{0:{tooltip:null}}},EmptyCosmosLatentVideo={display_name:"EmptyCosmosLatentVideo",inputs:{width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"}},outputs:{0:{tooltip:null}}},EmptyHunyuanImageLatent={display_name:"EmptyHunyuanImageLatent",inputs:{width:{name:"width"},height:{name:"height"},batch_size:{name:"batch_size"}},outputs:{0:{tooltip:null}}},EmptyHunyuanLatentVideo={display_name:"Empty HunyuanVideo 1.0 Latent",inputs:{width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"}},outputs:{0:{tooltip:null}}},EmptyHunyuanVideo15Latent={display_name:"Empty HunyuanVideo 1.5 Latent",inputs:{width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"}},outputs:{0:{tooltip:null}}},EmptyImage={display_name:"EmptyImage",inputs:{width:{name:"width"},height:{name:"height"},batch_size:{name:"batch_size"},color:{name:"color"}}},EmptyLatentAudio={display_name:"Empty Latent Audio",inputs:{seconds:{name:"seconds"},batch_size:{name:"batch_size",tooltip:"The number of latent images in the batch."}}},EmptyLatentHunyuan3Dv2={display_name:"EmptyLatentHunyuan3Dv2",inputs:{resolution:{name:"resolution"},batch_size:{name:"batch_size",tooltip:"The number of latent images in the batch."}},outputs:{0:{tooltip:null}}},EmptyLatentImage={display_name:"Empty Latent Image",description:"Create a new batch of empty latent images to be denoised via sampling.",inputs:{width:{name:"width",tooltip:"The width of the latent images in pixels."},height:{name:"height",tooltip:"The height of the latent images in pixels."},batch_size:{name:"batch_size",tooltip:"The number of latent images in the batch."}},outputs:{0:{tooltip:"The empty latent image batch."}}},EmptyLTXVLatentVideo={display_name:"EmptyLTXVLatentVideo",inputs:{width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"}},outputs:{0:{tooltip:null}}},EmptyMochiLatentVideo={display_name:"EmptyMochiLatentVideo",inputs:{width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"}},outputs:{0:{tooltip:null}}},EmptySD3LatentImage={display_name:"EmptySD3LatentImage",inputs:{width:{name:"width"},height:{name:"height"},batch_size:{name:"batch_size"}},outputs:{0:{tooltip:null}}},ExponentialScheduler={display_name:"ExponentialScheduler",inputs:{steps:{name:"steps"},sigma_max:{name:"sigma_max"},sigma_min:{name:"sigma_min"}}},ExtendIntermediateSigmas={display_name:"ExtendIntermediateSigmas",inputs:{sigmas:{name:"sigmas"},steps:{name:"steps"},start_at_sigma:{name:"start_at_sigma"},end_at_sigma:{name:"end_at_sigma"},spacing:{name:"spacing"}}},FeatherMask={display_name:"FeatherMask",inputs:{mask:{name:"mask"},left:{name:"left"},top:{name:"top"},right:{name:"right"},bottom:{name:"bottom"}}},FlipSigmas={display_name:"FlipSigmas",inputs:{sigmas:{name:"sigmas"}}},FluxDisableGuidance={display_name:"FluxDisableGuidance",description:"This node completely disables the guidance embed on Flux and Flux like models",inputs:{conditioning:{name:"conditioning"}},outputs:{0:{tooltip:null}}},FluxGuidance={display_name:"FluxGuidance",inputs:{conditioning:{name:"conditioning"},guidance:{name:"guidance"}},outputs:{0:{tooltip:null}}},FluxKontextImageScale={display_name:"FluxKontextImageScale",description:"This node resizes the image to one that is more optimal for flux kontext.",inputs:{image:{name:"image"}},outputs:{0:{tooltip:null}}},FluxKontextMaxImageNode={display_name:"Flux.1 Kontext [max] Image",description:"Edits images using Flux.1 Kontext [max] via api based on prompt and aspect ratio.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the image generation - specify what and how to edit."},aspect_ratio:{name:"aspect_ratio",tooltip:"Aspect ratio of image; must be between 1:4 and 4:1."},guidance:{name:"guidance",tooltip:"Guidance strength for the image generation process"},steps:{name:"steps",tooltip:"Number of steps for the image generation process"},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},prompt_upsampling:{name:"prompt_upsampling",tooltip:"Whether to perform upsampling on the prompt. If active, automatically modifies the prompt for more creative generation, but results are nondeterministic (same seed will not produce exactly the same result)."},input_image:{name:"input_image"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},FluxKontextMultiReferenceLatentMethod={display_name:"FluxKontextMultiReferenceLatentMethod",inputs:{conditioning:{name:"conditioning"},reference_latents_method:{name:"reference_latents_method"}},outputs:{0:{tooltip:null}}},FluxKontextProImageNode={display_name:"Flux.1 Kontext [pro] Image",description:"Edits images using Flux.1 Kontext [pro] via api based on prompt and aspect ratio.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the image generation - specify what and how to edit."},aspect_ratio:{name:"aspect_ratio",tooltip:"Aspect ratio of image; must be between 1:4 and 4:1."},guidance:{name:"guidance",tooltip:"Guidance strength for the image generation process"},steps:{name:"steps",tooltip:"Number of steps for the image generation process"},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},prompt_upsampling:{name:"prompt_upsampling",tooltip:"Whether to perform upsampling on the prompt. If active, automatically modifies the prompt for more creative generation, but results are nondeterministic (same seed will not produce exactly the same result)."},input_image:{name:"input_image"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},FluxProExpandNode={display_name:"Flux.1 Expand Image",description:"Outpaints image based on prompt.",inputs:{image:{name:"image"},prompt:{name:"prompt",tooltip:"Prompt for the image generation"},prompt_upsampling:{name:"prompt_upsampling",tooltip:"Whether to perform upsampling on the prompt. If active, automatically modifies the prompt for more creative generation, but results are nondeterministic (same seed will not produce exactly the same result)."},top:{name:"top",tooltip:"Number of pixels to expand at the top of the image"},bottom:{name:"bottom",tooltip:"Number of pixels to expand at the bottom of the image"},left:{name:"left",tooltip:"Number of pixels to expand at the left of the image"},right:{name:"right",tooltip:"Number of pixels to expand at the right of the image"},guidance:{name:"guidance",tooltip:"Guidance strength for the image generation process"},steps:{name:"steps",tooltip:"Number of steps for the image generation process"},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},FluxProFillNode={display_name:"Flux.1 Fill Image",description:"Inpaints image based on mask and prompt.",inputs:{image:{name:"image"},mask:{name:"mask"},prompt:{name:"prompt",tooltip:"Prompt for the image generation"},prompt_upsampling:{name:"prompt_upsampling",tooltip:"Whether to perform upsampling on the prompt. If active, automatically modifies the prompt for more creative generation, but results are nondeterministic (same seed will not produce exactly the same result)."},guidance:{name:"guidance",tooltip:"Guidance strength for the image generation process"},steps:{name:"steps",tooltip:"Number of steps for the image generation process"},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},FluxProUltraImageNode={display_name:"Flux 1.1 [pro] Ultra Image",description:"Generates images using Flux Pro 1.1 Ultra via api based on prompt and resolution.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the image generation"},prompt_upsampling:{name:"prompt_upsampling",tooltip:"Whether to perform upsampling on the prompt. If active, automatically modifies the prompt for more creative generation, but results are nondeterministic (same seed will not produce exactly the same result)."},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},aspect_ratio:{name:"aspect_ratio",tooltip:"Aspect ratio of image; must be between 1:4 and 4:1."},raw:{name:"raw",tooltip:"When True, generate less processed, more natural-looking images."},image_prompt:{name:"image_prompt"},image_prompt_strength:{name:"image_prompt_strength",tooltip:"Blend between the prompt and the image prompt."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},FreeU={display_name:"FreeU",inputs:{model:{name:"model"},b1:{name:"b1"},b2:{name:"b2"},s1:{name:"s1"},s2:{name:"s2"}}},FreeU_V2={display_name:"FreeU_V2",inputs:{model:{name:"model"},b1:{name:"b1"},b2:{name:"b2"},s1:{name:"s1"},s2:{name:"s2"}}},FreSca={display_name:"FreSca",description:"Applies frequency-dependent scaling to the guidance",inputs:{model:{name:"model"},scale_low:{name:"scale_low",tooltip:"Scaling factor for low-frequency components"},scale_high:{name:"scale_high",tooltip:"Scaling factor for high-frequency components"},freq_cutoff:{name:"freq_cutoff",tooltip:"Number of frequency indices around center to consider as low-frequency"}},outputs:{0:{tooltip:null}}},GeminiImage2Node={display_name:"Nano Banana Pro (Google Gemini Image)",description:"Generate or edit images synchronously via Google Vertex API.",inputs:{prompt:{name:"prompt",tooltip:"Text prompt describing the image to generate or the edits to apply. Include any constraints, styles, or details the model should follow."},model:{name:"model"},seed:{name:"seed",tooltip:"When the seed is fixed to a specific value, the model makes a best effort to provide the same response for repeated requests. Deterministic output isn't guaranteed. Also, changing the model or parameter settings, such as the temperature, can cause variations in the response even when you use the same seed value. By default, a random seed value is used."},aspect_ratio:{name:"aspect_ratio",tooltip:"If set to 'auto', matches your input image's aspect ratio; if no image is provided, generates a 1:1 square."},resolution:{name:"resolution",tooltip:"Target output resolution. For 2K/4K the native Gemini upscaler is used."},response_modalities:{name:"response_modalities",tooltip:"Choose 'IMAGE' for image-only output, or 'IMAGE+TEXT' to return both the generated image and a text response."},images:{name:"images",tooltip:"Optional reference image(s). To include multiple images, use the Batch Images node (up to 14)."},files:{name:"files",tooltip:"Optional file(s) to use as context for the model. Accepts inputs from the Gemini Generate Content Input Files node."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null},1:{tooltip:null}}},GeminiImageNode={display_name:"Nano Banana (Google Gemini Image)",description:"Edit images synchronously via Google API.",inputs:{prompt:{name:"prompt",tooltip:"Text prompt for generation"},model:{name:"model",tooltip:"The Gemini model to use for generating responses."},seed:{name:"seed",tooltip:"When seed is fixed to a specific value, the model makes a best effort to provide the same response for repeated requests. Deterministic output isn't guaranteed. Also, changing the model or parameter settings, such as the temperature, can cause variations in the response even when you use the same seed value. By default, a random seed value is used."},images:{name:"images",tooltip:"Optional image(s) to use as context for the model. To include multiple images, you can use the Batch Images node."},files:{name:"files",tooltip:"Optional file(s) to use as context for the model. Accepts inputs from the Gemini Generate Content Input Files node."},aspect_ratio:{name:"aspect_ratio",tooltip:"Defaults to matching the output image size to that of your input image, or otherwise generates 1:1 squares."},response_modalities:{name:"response_modalities",tooltip:"Choose 'IMAGE' for image-only output, or 'IMAGE+TEXT' to return both the generated image and a text response."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null},1:{tooltip:null}}},GeminiInputFiles={display_name:"Gemini Input Files",description:"Loads and prepares input files to include as inputs for Gemini LLM nodes. The files will be read by the Gemini model when generating a response. The contents of the text file count toward the token limit. ðŸ›ˆ TIP: Can be chained together with other Gemini Input File nodes.",inputs:{file:{name:"file",tooltip:"Input files to include as context for the model. Only accepts text (.txt) and PDF (.pdf) files for now."},GEMINI_INPUT_FILES:{name:"GEMINI_INPUT_FILES",tooltip:"An optional additional file(s) to batch together with the file loaded from this node. Allows chaining of input files so that a single message can include multiple input files."}},outputs:{0:{tooltip:null}}},GeminiNode={display_name:"Google Gemini",description:"Generate text responses with Google's Gemini AI model. You can provide multiple types of inputs (text, images, audio, video) as context for generating more relevant and meaningful responses.",inputs:{prompt:{name:"prompt",tooltip:"Text inputs to the model, used to generate a response. You can include detailed instructions, questions, or context for the model."},model:{name:"model",tooltip:"The Gemini model to use for generating responses."},seed:{name:"seed",tooltip:"When seed is fixed to a specific value, the model makes a best effort to provide the same response for repeated requests. Deterministic output isn't guaranteed. Also, changing the model or parameter settings, such as the temperature, can cause variations in the response even when you use the same seed value. By default, a random seed value is used."},images:{name:"images",tooltip:"Optional image(s) to use as context for the model. To include multiple images, you can use the Batch Images node."},audio:{name:"audio",tooltip:"Optional audio to use as context for the model."},video:{name:"video",tooltip:"Optional video to use as context for the model."},files:{name:"files",tooltip:"Optional file(s) to use as context for the model. Accepts inputs from the Gemini Generate Content Input Files node."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},GetImageSize={display_name:"Get Image Size",description:"Returns width and height of the image, and passes it through unchanged.",inputs:{image:{name:"image"}},outputs:{0:{name:"width"},1:{name:"height"},2:{name:"batch_size"}}},GetVideoComponents={display_name:"Get Video Components",description:"Extracts all components from a video: frames, audio, and framerate.",inputs:{video:{name:"video",tooltip:"The video to extract components from."}},outputs:{0:{name:"images",tooltip:null},1:{name:"audio",tooltip:null},2:{name:"fps",tooltip:null}}},GITSScheduler={display_name:"GITSScheduler",inputs:{coeff:{name:"coeff"},steps:{name:"steps"},denoise:{name:"denoise"}},outputs:{0:{tooltip:null}}},GLIGENLoader={display_name:"GLIGENLoader",inputs:{gligen_name:{name:"gligen_name"}}},GLIGENTextBoxApply={display_name:"GLIGENTextBoxApply",inputs:{conditioning_to:{name:"conditioning_to"},clip:{name:"clip"},gligen_textbox_model:{name:"gligen_textbox_model"},text:{name:"text"},width:{name:"width"},height:{name:"height"},x:{name:"x"},y:{name:"y"}}},GrowMask={display_name:"GrowMask",inputs:{mask:{name:"mask"},expand:{name:"expand"},tapered_corners:{name:"tapered_corners"}}},Hunyuan3Dv2Conditioning={display_name:"Hunyuan3Dv2Conditioning",inputs:{clip_vision_output:{name:"clip_vision_output"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null}}},Hunyuan3Dv2ConditioningMultiView={display_name:"Hunyuan3Dv2ConditioningMultiView",inputs:{front:{name:"front"},left:{name:"left"},back:{name:"back"},right:{name:"right"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null}}},HunyuanImageToVideo={display_name:"HunyuanImageToVideo",inputs:{positive:{name:"positive"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},guidance_type:{name:"guidance_type"},start_image:{name:"start_image"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"latent",tooltip:null}}},HunyuanRefinerLatent={display_name:"HunyuanRefinerLatent",inputs:{positive:{name:"positive"},negative:{name:"negative"},latent:{name:"latent"},noise_augmentation:{name:"noise_augmentation"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},HunyuanVideo15ImageToVideo={display_name:"HunyuanVideo15ImageToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},start_image:{name:"start_image"},clip_vision_output:{name:"clip_vision_output"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},HunyuanVideo15LatentUpscaleWithModel={display_name:"Hunyuan Video 15 Latent Upscale With Model",inputs:{model:{name:"model"},samples:{name:"samples"},upscale_method:{name:"upscale_method"},width:{name:"width"},height:{name:"height"},crop:{name:"crop"}},outputs:{0:{tooltip:null}}},HunyuanVideo15SuperResolution={display_name:"HunyuanVideo15SuperResolution",inputs:{positive:{name:"positive"},negative:{name:"negative"},latent:{name:"latent"},noise_augmentation:{name:"noise_augmentation"},vae:{name:"vae"},start_image:{name:"start_image"},clip_vision_output:{name:"clip_vision_output"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},HypernetworkLoader={display_name:"HypernetworkLoader",inputs:{model:{name:"model"},hypernetwork_name:{name:"hypernetwork_name"},strength:{name:"strength"}},outputs:{0:{tooltip:null}}},HyperTile={display_name:"HyperTile",inputs:{model:{name:"model"},tile_size:{name:"tile_size"},swap_size:{name:"swap_size"},max_depth:{name:"max_depth"},scale_depth:{name:"scale_depth"}},outputs:{0:{tooltip:null}}},IdeogramV1={display_name:"Ideogram V1",description:"Generates images using the Ideogram V1 model.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the image generation"},turbo:{name:"turbo",tooltip:"Whether to use turbo mode (faster generation, potentially lower quality)"},aspect_ratio:{name:"aspect_ratio",tooltip:"The aspect ratio for image generation."},magic_prompt_option:{name:"magic_prompt_option",tooltip:"Determine if MagicPrompt should be used in generation"},seed:{name:"seed"},negative_prompt:{name:"negative_prompt",tooltip:"Description of what to exclude from the image"},num_images:{name:"num_images"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},IdeogramV2={display_name:"Ideogram V2",description:"Generates images using the Ideogram V2 model.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the image generation"},turbo:{name:"turbo",tooltip:"Whether to use turbo mode (faster generation, potentially lower quality)"},aspect_ratio:{name:"aspect_ratio",tooltip:"The aspect ratio for image generation. Ignored if resolution is not set to AUTO."},resolution:{name:"resolution",tooltip:"The resolution for image generation. If not set to AUTO, this overrides the aspect_ratio setting."},magic_prompt_option:{name:"magic_prompt_option",tooltip:"Determine if MagicPrompt should be used in generation"},seed:{name:"seed"},style_type:{name:"style_type",tooltip:"Style type for generation (V2 only)"},negative_prompt:{name:"negative_prompt",tooltip:"Description of what to exclude from the image"},num_images:{name:"num_images"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},IdeogramV3={display_name:"Ideogram V3",description:"Generates images using the Ideogram V3 model. Supports both regular image generation from text prompts and image editing with mask.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the image generation or editing"},image:{name:"image",tooltip:"Optional reference image for image editing."},mask:{name:"mask",tooltip:"Optional mask for inpainting (white areas will be replaced)"},aspect_ratio:{name:"aspect_ratio",tooltip:"The aspect ratio for image generation. Ignored if resolution is not set to Auto."},resolution:{name:"resolution",tooltip:"The resolution for image generation. If not set to Auto, this overrides the aspect_ratio setting."},magic_prompt_option:{name:"magic_prompt_option",tooltip:"Determine if MagicPrompt should be used in generation"},seed:{name:"seed"},num_images:{name:"num_images"},rendering_speed:{name:"rendering_speed",tooltip:"Controls the trade-off between generation speed and quality"},character_image:{name:"character_image",tooltip:"Image to use as character reference."},character_mask:{name:"character_mask",tooltip:"Optional mask for character reference image."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},ImageAddNoise={display_name:"ImageAddNoise",inputs:{image:{name:"image"},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},strength:{name:"strength"},control_after_generate:{name:"control after generate"}}},ImageBatch={display_name:"Batch Images",inputs:{image1:{name:"image1"},image2:{name:"image2"}}},ImageBlend={display_name:"ImageBlend",inputs:{image1:{name:"image1"},image2:{name:"image2"},blend_factor:{name:"blend_factor"},blend_mode:{name:"blend_mode"}},outputs:{0:{tooltip:null}}},ImageBlur={display_name:"ImageBlur",inputs:{image:{name:"image"},blur_radius:{name:"blur_radius"},sigma:{name:"sigma"}},outputs:{0:{tooltip:null}}},ImageColorToMask={display_name:"ImageColorToMask",inputs:{image:{name:"image"},color:{name:"color"}}},ImageCompositeMasked={display_name:"ImageCompositeMasked",inputs:{destination:{name:"destination"},source:{name:"source"},x:{name:"x"},y:{name:"y"},resize_source:{name:"resize_source"},mask:{name:"mask"}}},ImageCrop={display_name:"Image Crop",inputs:{image:{name:"image"},width:{name:"width"},height:{name:"height"},x:{name:"x"},y:{name:"y"}}},ImageFlip={display_name:"ImageFlip",inputs:{image:{name:"image"},flip_method:{name:"flip_method"}}},ImageFromBatch={display_name:"ImageFromBatch",inputs:{image:{name:"image"},batch_index:{name:"batch_index"},length:{name:"length"}}},ImageInvert={display_name:"Invert Image",inputs:{image:{name:"image"}}},ImageOnlyCheckpointLoader={display_name:"Image Only Checkpoint Loader (img2vid model)",inputs:{ckpt_name:{name:"ckpt_name"}}},ImageOnlyCheckpointSave={display_name:"ImageOnlyCheckpointSave",inputs:{model:{name:"model"},clip_vision:{name:"clip_vision"},vae:{name:"vae"},filename_prefix:{name:"filename_prefix"}}},ImagePadForOutpaint={display_name:"Pad Image for Outpainting",inputs:{image:{name:"image"},left:{name:"left"},top:{name:"top"},right:{name:"right"},bottom:{name:"bottom"},feathering:{name:"feathering"}}},ImageQuantize={display_name:"ImageQuantize",inputs:{image:{name:"image"},colors:{name:"colors"},dither:{name:"dither"}},outputs:{0:{tooltip:null}}},ImageRGBToYUV={display_name:"ImageRGBToYUV",inputs:{image:{name:"image"}},outputs:{0:{name:"Y",tooltip:null},1:{name:"U",tooltip:null},2:{name:"V",tooltip:null}}},ImageRotate={display_name:"ImageRotate",inputs:{image:{name:"image"},rotation:{name:"rotation"}}},ImageScale={display_name:"Upscale Image",inputs:{image:{name:"image"},upscale_method:{name:"upscale_method"},width:{name:"width"},height:{name:"height"},crop:{name:"crop"}}},ImageScaleBy={display_name:"Upscale Image By",inputs:{image:{name:"image"},upscale_method:{name:"upscale_method"},scale_by:{name:"scale_by"}}},ImageScaleToMaxDimension={display_name:"ImageScaleToMaxDimension",inputs:{image:{name:"image"},upscale_method:{name:"upscale_method"},largest_size:{name:"largest_size"}}},ImageScaleToTotalPixels={display_name:"ImageScaleToTotalPixels",inputs:{image:{name:"image"},upscale_method:{name:"upscale_method"},megapixels:{name:"megapixels"}},outputs:{0:{tooltip:null}}},ImageSharpen={display_name:"ImageSharpen",inputs:{image:{name:"image"},sharpen_radius:{name:"sharpen_radius"},sigma:{name:"sigma"},alpha:{name:"alpha"}},outputs:{0:{tooltip:null}}},ImageStitch={display_name:"Image Stitch",description:`
Stitches image2 to image1 in the specified direction.
If image2 is not provided, returns image1 unchanged.
Optional spacing can be added between images.
`,inputs:{image1:{name:"image1"},direction:{name:"direction"},match_image_size:{name:"match_image_size"},spacing_width:{name:"spacing_width"},spacing_color:{name:"spacing_color"},image2:{name:"image2"}}},ImageToMask={display_name:"Convert Image to Mask",inputs:{image:{name:"image"},channel:{name:"channel"}}},ImageUpscaleWithModel={display_name:"Upscale Image (using Model)",inputs:{upscale_model:{name:"upscale_model"},image:{name:"image"}},outputs:{0:{tooltip:null}}},ImageYUVToRGB={display_name:"ImageYUVToRGB",inputs:{Y:{name:"Y"},U:{name:"U"},V:{name:"V"}},outputs:{0:{tooltip:null}}},InpaintModelConditioning={display_name:"InpaintModelConditioning",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},pixels:{name:"pixels"},mask:{name:"mask"},noise_mask:{name:"noise_mask",tooltip:"Add a noise mask to the latent so sampling will only happen within the mask. Might improve results or completely break things depending on the model."}},outputs:{0:{name:"positive"},1:{name:"negative"},2:{name:"latent"}}},InstructPixToPixConditioning={display_name:"InstructPixToPixConditioning",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},pixels:{name:"pixels"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},InvertMask={display_name:"InvertMask",inputs:{mask:{name:"mask"}}},JoinImageWithAlpha={display_name:"Join Image with Alpha",inputs:{image:{name:"image"},alpha:{name:"alpha"}},outputs:{0:{tooltip:null}}},KarrasScheduler={display_name:"KarrasScheduler",inputs:{steps:{name:"steps"},sigma_max:{name:"sigma_max"},sigma_min:{name:"sigma_min"},rho:{name:"rho"}}},KlingCameraControlI2VNode={display_name:"Kling Image to Video (Camera Control)",description:"Transform still images into cinematic videos with professional camera movements that simulate real-world cinematography. Control virtual camera actions including zoom, rotation, pan, tilt, and first-person view, while maintaining focus on your original image.",inputs:{start_frame:{name:"start_frame",tooltip:"Reference Image - URL or Base64 encoded string, cannot exceed 10MB, resolution not less than 300*300px, aspect ratio between 1:2.5 ~ 2.5:1. Base64 should not include data:image prefix."},prompt:{name:"prompt",tooltip:"Positive text prompt"},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt"},cfg_scale:{name:"cfg_scale"},aspect_ratio:{name:"aspect_ratio"},camera_control:{name:"camera_control",tooltip:"Can be created using the Kling Camera Controls node. Controls the camera movement and motion during the video generation."}},outputs:{0:{tooltip:null},1:{name:"video_id",tooltip:null},2:{name:"duration",tooltip:null}}},KlingCameraControls={display_name:"Kling Camera Controls",description:"Allows specifying configuration options for Kling Camera Controls and motion control effects.",inputs:{camera_control_type:{name:"camera_control_type"},horizontal_movement:{name:"horizontal_movement",tooltip:"Controls camera's movement along horizontal axis (x-axis). Negative indicates left, positive indicates right"},vertical_movement:{name:"vertical_movement",tooltip:"Controls camera's movement along vertical axis (y-axis). Negative indicates downward, positive indicates upward."},pan:{name:"pan",tooltip:"Controls camera's rotation in vertical plane (x-axis). Negative indicates downward rotation, positive indicates upward rotation."},tilt:{name:"tilt",tooltip:"Controls camera's rotation in horizontal plane (y-axis). Negative indicates left rotation, positive indicates right rotation."},roll:{name:"roll",tooltip:"Controls camera's rolling amount (z-axis). Negative indicates counterclockwise, positive indicates clockwise."},zoom:{name:"zoom",tooltip:"Controls change in camera's focal length. Negative indicates narrower field of view, positive indicates wider field of view."}},outputs:{0:{name:"camera_control",tooltip:null}}},KlingCameraControlT2VNode={display_name:"Kling Text to Video (Camera Control)",description:"Transform text into cinematic videos with professional camera movements that simulate real-world cinematography. Control virtual camera actions including zoom, rotation, pan, tilt, and first-person view, while maintaining focus on your original text.",inputs:{prompt:{name:"prompt",tooltip:"Positive text prompt"},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt"},cfg_scale:{name:"cfg_scale"},aspect_ratio:{name:"aspect_ratio"},camera_control:{name:"camera_control",tooltip:"Can be created using the Kling Camera Controls node. Controls the camera movement and motion during the video generation."}},outputs:{0:{tooltip:null},1:{name:"video_id",tooltip:null},2:{name:"duration",tooltip:null}}},KlingDualCharacterVideoEffectNode={display_name:"Kling Dual Character Video Effects",description:"Achieve different special effects when generating a video based on the effect_scene. First image will be positioned on left side, second on right side of the composite.",inputs:{image_left:{name:"image_left",tooltip:"Left side image"},image_right:{name:"image_right",tooltip:"Right side image"},effect_scene:{name:"effect_scene"},model_name:{name:"model_name"},mode:{name:"mode"},duration:{name:"duration"}},outputs:{0:{tooltip:null},1:{name:"duration",tooltip:null}}},KlingImage2VideoNode={display_name:"Kling Image to Video",description:"Kling Image to Video Node",inputs:{start_frame:{name:"start_frame",tooltip:"The reference image used to generate the video."},prompt:{name:"prompt",tooltip:"Positive text prompt"},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt"},model_name:{name:"model_name"},cfg_scale:{name:"cfg_scale"},mode:{name:"mode"},aspect_ratio:{name:"aspect_ratio"},duration:{name:"duration"}},outputs:{0:{tooltip:null},1:{name:"video_id",tooltip:null},2:{name:"duration",tooltip:null}}},KlingImageGenerationNode={display_name:"Kling Image Generation",description:"Kling Image Generation Node. Generate an image from a text prompt with an optional reference image.",inputs:{prompt:{name:"prompt",tooltip:"Positive text prompt"},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt"},image_type:{name:"image_type"},image_fidelity:{name:"image_fidelity",tooltip:"Reference intensity for user-uploaded images"},human_fidelity:{name:"human_fidelity",tooltip:"Subject reference similarity"},model_name:{name:"model_name"},aspect_ratio:{name:"aspect_ratio"},n:{name:"n",tooltip:"Number of generated images"},image:{name:"image"}},outputs:{0:{tooltip:null}}},KlingLipSyncAudioToVideoNode={display_name:"Kling Lip Sync Video with Audio",description:"Kling Lip Sync Audio to Video Node. Syncs mouth movements in a video file to the audio content of an audio file. When using, ensure that the audio contains clearly distinguishable vocals and that the video contains a distinct face. The audio file should not be larger than 5MB. The video file should not be larger than 100MB, should have height/width between 720px and 1920px, and should be between 2s and 10s in length.",inputs:{video:{name:"video"},audio:{name:"audio"},voice_language:{name:"voice_language"}},outputs:{0:{tooltip:null},1:{name:"video_id",tooltip:null},2:{name:"duration",tooltip:null}}},KlingLipSyncTextToVideoNode={display_name:"Kling Lip Sync Video with Text",description:"Kling Lip Sync Text to Video Node. Syncs mouth movements in a video file to a text prompt. The video file should not be larger than 100MB, should have height/width between 720px and 1920px, and should be between 2s and 10s in length.",inputs:{video:{name:"video"},text:{name:"text",tooltip:"Text Content for Lip-Sync Video Generation. Required when mode is text2video. Maximum length is 120 characters."},voice:{name:"voice"},voice_speed:{name:"voice_speed",tooltip:"Speech Rate. Valid range: 0.8~2.0, accurate to one decimal place."}},outputs:{0:{tooltip:null},1:{name:"video_id",tooltip:null},2:{name:"duration",tooltip:null}}},KlingSingleImageVideoEffectNode={display_name:"Kling Video Effects",description:"Achieve different special effects when generating a video based on the effect_scene.",inputs:{image:{name:"image",tooltip:" Reference Image. URL or Base64 encoded string (without data:image prefix). File size cannot exceed 10MB, resolution not less than 300*300px, aspect ratio between 1:2.5 ~ 2.5:1"},effect_scene:{name:"effect_scene"},model_name:{name:"model_name"},duration:{name:"duration"}},outputs:{0:{tooltip:null},1:{name:"video_id",tooltip:null},2:{name:"duration",tooltip:null}}},KlingStartEndFrameNode={display_name:"Kling Start-End Frame to Video",description:"Generate a video sequence that transitions between your provided start and end images. The node creates all frames in between, producing a smooth transformation from the first frame to the last.",inputs:{start_frame:{name:"start_frame",tooltip:"Reference Image - URL or Base64 encoded string, cannot exceed 10MB, resolution not less than 300*300px, aspect ratio between 1:2.5 ~ 2.5:1. Base64 should not include data:image prefix."},end_frame:{name:"end_frame",tooltip:"Reference Image - End frame control. URL or Base64 encoded string, cannot exceed 10MB, resolution not less than 300*300px. Base64 should not include data:image prefix."},prompt:{name:"prompt",tooltip:"Positive text prompt"},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt"},cfg_scale:{name:"cfg_scale"},aspect_ratio:{name:"aspect_ratio"},mode:{name:"mode",tooltip:"The configuration to use for the video generation following the format: mode / duration / model_name."}},outputs:{0:{tooltip:null},1:{name:"video_id",tooltip:null},2:{name:"duration",tooltip:null}}},KlingTextToVideoNode={display_name:"Kling Text to Video",description:"Kling Text to Video Node",inputs:{prompt:{name:"prompt",tooltip:"Positive text prompt"},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt"},cfg_scale:{name:"cfg_scale"},aspect_ratio:{name:"aspect_ratio"},mode:{name:"mode",tooltip:"The configuration to use for the video generation following the format: mode / duration / model_name."}},outputs:{0:{tooltip:null},1:{name:"video_id",tooltip:null},2:{name:"duration",tooltip:null}}},KlingVideoExtendNode={display_name:"Kling Video Extend",description:"Kling Video Extend Node. Extend videos made by other Kling nodes. The video_id is created by using other Kling Nodes.",inputs:{prompt:{name:"prompt",tooltip:"Positive text prompt for guiding the video extension"},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt for elements to avoid in the extended video"},cfg_scale:{name:"cfg_scale"},video_id:{name:"video_id",tooltip:"The ID of the video to be extended. Supports videos generated by text-to-video, image-to-video, and previous video extension operations. Cannot exceed 3 minutes total duration after extension."}},outputs:{0:{tooltip:null},1:{name:"video_id",tooltip:null},2:{name:"duration",tooltip:null}}},KlingVirtualTryOnNode={display_name:"Kling Virtual Try On",description:"Kling Virtual Try On Node. Input a human image and a cloth image to try on the cloth on the human. You can merge multiple clothing item pictures into one image with a white background.",inputs:{human_image:{name:"human_image"},cloth_image:{name:"cloth_image"},model_name:{name:"model_name"}},outputs:{0:{tooltip:null}}},KSampler={display_name:"KSampler",description:"Uses the provided model, positive and negative conditioning to denoise the latent image.",inputs:{model:{name:"model",tooltip:"The model used for denoising the input latent."},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},steps:{name:"steps",tooltip:"The number of steps used in the denoising process."},cfg:{name:"cfg",tooltip:"The Classifier-Free Guidance scale balances creativity and adherence to the prompt. Higher values result in images more closely matching the prompt however too high values will negatively impact quality."},sampler_name:{name:"sampler_name",tooltip:"The algorithm used when sampling, this can affect the quality, speed, and style of the generated output."},scheduler:{name:"scheduler",tooltip:"The scheduler controls how noise is gradually removed to form the image."},positive:{name:"positive",tooltip:"The conditioning describing the attributes you want to include in the image."},negative:{name:"negative",tooltip:"The conditioning describing the attributes you want to exclude from the image."},latent_image:{name:"latent_image",tooltip:"The latent image to denoise."},denoise:{name:"denoise",tooltip:"The amount of denoising applied, lower values will maintain the structure of the initial image allowing for image to image sampling."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:"The denoised latent."}}},KSamplerAdvanced={display_name:"KSampler (Advanced)",inputs:{model:{name:"model"},add_noise:{name:"add_noise"},noise_seed:{name:"noise_seed"},steps:{name:"steps"},cfg:{name:"cfg"},sampler_name:{name:"sampler_name"},scheduler:{name:"scheduler"},positive:{name:"positive"},negative:{name:"negative"},latent_image:{name:"latent_image"},start_at_step:{name:"start_at_step"},end_at_step:{name:"end_at_step"},return_with_leftover_noise:{name:"return_with_leftover_noise"},control_after_generate:{name:"control after generate"}}},KSamplerSelect={display_name:"KSamplerSelect",inputs:{sampler_name:{name:"sampler_name"}}},LaplaceScheduler={display_name:"LaplaceScheduler",inputs:{steps:{name:"steps"},sigma_max:{name:"sigma_max"},sigma_min:{name:"sigma_min"},mu:{name:"mu"},beta:{name:"beta"}}},LatentAdd={display_name:"LatentAdd",inputs:{samples1:{name:"samples1"},samples2:{name:"samples2"}},outputs:{0:{tooltip:null}}},LatentApplyOperation={display_name:"LatentApplyOperation",inputs:{samples:{name:"samples"},operation:{name:"operation"}},outputs:{0:{tooltip:null}}},LatentApplyOperationCFG={display_name:"LatentApplyOperationCFG",inputs:{model:{name:"model"},operation:{name:"operation"}},outputs:{0:{tooltip:null}}},LatentBatch={display_name:"LatentBatch",inputs:{samples1:{name:"samples1"},samples2:{name:"samples2"}},outputs:{0:{tooltip:null}}},LatentBatchSeedBehavior={display_name:"LatentBatchSeedBehavior",inputs:{samples:{name:"samples"},seed_behavior:{name:"seed_behavior"}},outputs:{0:{tooltip:null}}},LatentBlend={display_name:"Latent Blend",inputs:{samples1:{name:"samples1"},samples2:{name:"samples2"},blend_factor:{name:"blend_factor"}}},LatentComposite={display_name:"Latent Composite",inputs:{samples_to:{name:"samples_to"},samples_from:{name:"samples_from"},x:{name:"x"},y:{name:"y"},feather:{name:"feather"}}},LatentCompositeMasked={display_name:"LatentCompositeMasked",inputs:{destination:{name:"destination"},source:{name:"source"},x:{name:"x"},y:{name:"y"},resize_source:{name:"resize_source"},mask:{name:"mask"}}},LatentConcat={display_name:"LatentConcat",inputs:{samples1:{name:"samples1"},samples2:{name:"samples2"},dim:{name:"dim"}},outputs:{0:{tooltip:null}}},LatentCrop={display_name:"Crop Latent",inputs:{samples:{name:"samples"},width:{name:"width"},height:{name:"height"},x:{name:"x"},y:{name:"y"}}},LatentCut={display_name:"LatentCut",inputs:{samples:{name:"samples"},dim:{name:"dim"},index:{name:"index"},amount:{name:"amount"}},outputs:{0:{tooltip:null}}},LatentFlip={display_name:"Flip Latent",inputs:{samples:{name:"samples"},flip_method:{name:"flip_method"}}},LatentFromBatch={display_name:"Latent From Batch",inputs:{samples:{name:"samples"},batch_index:{name:"batch_index"},length:{name:"length"}}},LatentInterpolate={display_name:"LatentInterpolate",inputs:{samples1:{name:"samples1"},samples2:{name:"samples2"},ratio:{name:"ratio"}},outputs:{0:{tooltip:null}}},LatentMultiply={display_name:"LatentMultiply",inputs:{samples:{name:"samples"},multiplier:{name:"multiplier"}},outputs:{0:{tooltip:null}}},LatentOperationSharpen={display_name:"LatentOperationSharpen",inputs:{sharpen_radius:{name:"sharpen_radius"},sigma:{name:"sigma"},alpha:{name:"alpha"}},outputs:{0:{tooltip:null}}},LatentOperationTonemapReinhard={display_name:"LatentOperationTonemapReinhard",inputs:{multiplier:{name:"multiplier"}},outputs:{0:{tooltip:null}}},LatentRotate={display_name:"Rotate Latent",inputs:{samples:{name:"samples"},rotation:{name:"rotation"}}},LatentSubtract={display_name:"LatentSubtract",inputs:{samples1:{name:"samples1"},samples2:{name:"samples2"}},outputs:{0:{tooltip:null}}},LatentUpscale={display_name:"Upscale Latent",inputs:{samples:{name:"samples"},upscale_method:{name:"upscale_method"},width:{name:"width"},height:{name:"height"},crop:{name:"crop"}}},LatentUpscaleBy={display_name:"Upscale Latent By",inputs:{samples:{name:"samples"},upscale_method:{name:"upscale_method"},scale_by:{name:"scale_by"}}},LatentUpscaleModelLoader={display_name:"Load Latent Upscale Model",inputs:{model_name:{name:"model_name"}},outputs:{0:{tooltip:null}}},LazyCache={display_name:"LazyCache",description:"A homebrew version of EasyCache - even 'easier' version of EasyCache to implement. Overall works worse than EasyCache, but better in some rare cases AND universal compatibility with everything in ComfyUI.",inputs:{model:{name:"model",tooltip:"The model to add LazyCache to."},reuse_threshold:{name:"reuse_threshold",tooltip:"The threshold for reusing cached steps."},start_percent:{name:"start_percent",tooltip:"The relative sampling step to begin use of LazyCache."},end_percent:{name:"end_percent",tooltip:"The relative sampling step to end use of LazyCache."},verbose:{name:"verbose",tooltip:"Whether to log verbose information."}},outputs:{0:{tooltip:"The model with LazyCache."}}},Load3D$1={display_name:"Load 3D",inputs:{model_file:{name:"model_file"},image:{name:"image"},width:{name:"width"},height:{name:"height"},clear:{},"upload 3d model":{},"upload extra resources":{}},outputs:{0:{name:"image"},1:{name:"mask"},2:{name:"mesh_path"},3:{name:"normal"},4:{name:"lineart"},5:{name:"camera_info"},6:{name:"recording_video"}}},Load3DAnimation={display_name:"Load 3D - Animation",inputs:{model_file:{name:"model_file"},image:{name:"image"},width:{name:"width"},height:{name:"height"}},outputs:{0:{name:"image"},1:{name:"mask"},2:{name:"mesh_path"},3:{name:"normal"},4:{name:"camera_info"},5:{name:"recording_video"}}},LoadAudio={display_name:"Load Audio",inputs:{audio:{name:"audio"},audioUI:{name:"audioUI"},upload:{name:"choose file to upload"}}},LoadImage={display_name:"Load Image",inputs:{image:{name:"image"},upload:{name:"choose file to upload"}}},LoadImageMask={display_name:"Load Image (as Mask)",inputs:{image:{name:"image"},channel:{name:"channel"},upload:{name:"choose file to upload"}}},LoadImageOutput={display_name:"Load Image (from Outputs)",description:"Load an image from the output folder. When the refresh button is clicked, the node will update the image list and automatically select the first image, allowing for easy iteration.",inputs:{image:{name:"image"},"Auto-refresh after generation":{},refresh:{},upload:{name:"choose file to upload"}}},LoadImageSetFromFolderNode={display_name:"Load Image Dataset from Folder",description:"Loads a batch of images from a directory for training.",inputs:{folder:{name:"folder",tooltip:"The folder to load images from."},resize_method:{name:"resize_method"}}},LoadImageTextSetFromFolderNode={display_name:"Load Image and Text Dataset from Folder",description:"Loads a batch of images and caption from a directory for training.",inputs:{folder:{name:"folder",tooltip:"The folder to load images from."},clip:{name:"clip",tooltip:"The CLIP model used for encoding the text."},resize_method:{name:"resize_method"},width:{name:"width",tooltip:"The width to resize the images to. -1 means use the original width."},height:{name:"height",tooltip:"The height to resize the images to. -1 means use the original height."}}},LoadLatent={display_name:"LoadLatent",inputs:{latent:{name:"latent"}}},LoadVideo={display_name:"Load Video",inputs:{file:{name:"file"},upload:{name:"choose file to upload"}},outputs:{0:{tooltip:null}}},LoraLoader={display_name:"Load LoRA",description:"LoRAs are used to modify diffusion and CLIP models, altering the way in which latents are denoised such as applying styles. Multiple LoRA nodes can be linked together.",inputs:{model:{name:"model",tooltip:"The diffusion model the LoRA will be applied to."},clip:{name:"clip",tooltip:"The CLIP model the LoRA will be applied to."},lora_name:{name:"lora_name",tooltip:"The name of the LoRA."},strength_model:{name:"strength_model",tooltip:"How strongly to modify the diffusion model. This value can be negative."},strength_clip:{name:"strength_clip",tooltip:"How strongly to modify the CLIP model. This value can be negative."}},outputs:{0:{tooltip:"The modified diffusion model."},1:{tooltip:"The modified CLIP model."}}},LoraLoaderModelOnly={display_name:"LoraLoaderModelOnly",description:"LoRAs are used to modify diffusion and CLIP models, altering the way in which latents are denoised such as applying styles. Multiple LoRA nodes can be linked together.",inputs:{model:{name:"model"},lora_name:{name:"lora_name"},strength_model:{name:"strength_model"}},outputs:{0:{tooltip:"The modified diffusion model."}}},LoraModelLoader={display_name:"Load LoRA Model",description:"Load Trained LoRA weights from Train LoRA node.",inputs:{model:{name:"model",tooltip:"The diffusion model the LoRA will be applied to."},lora:{name:"lora",tooltip:"The LoRA model to apply to the diffusion model."},strength_model:{name:"strength_model",tooltip:"How strongly to modify the diffusion model. This value can be negative."}},outputs:{0:{tooltip:"The modified diffusion model."}}},LoraSave={display_name:"Extract and Save Lora",inputs:{filename_prefix:{name:"filename_prefix"},rank:{name:"rank"},lora_type:{name:"lora_type"},bias_diff:{name:"bias_diff"},model_diff:{name:"model_diff",tooltip:"The ModelSubtract output to be converted to a lora."},text_encoder_diff:{name:"text_encoder_diff",tooltip:"The CLIPSubtract output to be converted to a lora."}}},LossGraphNode={display_name:"Plot Loss Graph",description:"Plots the loss graph and saves it to the output directory.",inputs:{loss:{name:"loss"},filename_prefix:{name:"filename_prefix"}}},LotusConditioning={display_name:"LotusConditioning",outputs:{0:{name:"conditioning",tooltip:null}}},LTXVAddGuide={display_name:"LTXVAddGuide",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},latent:{name:"latent"},image:{name:"image",tooltip:"Image or video to condition the latent video on. Must be 8*n + 1 frames. If the video is not 8*n + 1 frames, it will be cropped to the nearest 8*n + 1 frames."},frame_idx:{name:"frame_idx",tooltip:"Frame index to start the conditioning at. For single-frame images or videos with 1-8 frames, any frame_idx value is acceptable. For videos with 9+ frames, frame_idx must be divisible by 8, otherwise it will be rounded down to the nearest multiple of 8. Negative values are counted from the end of the video."},strength:{name:"strength"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},LtxvApiImageToVideo={display_name:"LTXV Image To Video",description:"Professional-quality videos with customizable duration and resolution based on start image.",inputs:{image:{name:"image",tooltip:"First frame to be used for the video."},model:{name:"model"},prompt:{name:"prompt"},duration:{name:"duration"},resolution:{name:"resolution"},fps:{name:"fps"},generate_audio:{name:"generate_audio",tooltip:"When true, the generated video will include AI-generated audio matching the scene."}},outputs:{0:{tooltip:null}}},LtxvApiTextToVideo={display_name:"LTXV Text To Video",description:"Professional-quality videos with customizable duration and resolution.",inputs:{model:{name:"model"},prompt:{name:"prompt"},duration:{name:"duration"},resolution:{name:"resolution"},fps:{name:"fps"},generate_audio:{name:"generate_audio",tooltip:"When true, the generated video will include AI-generated audio matching the scene."}},outputs:{0:{tooltip:null}}},LTXVConditioning={display_name:"LTXVConditioning",inputs:{positive:{name:"positive"},negative:{name:"negative"},frame_rate:{name:"frame_rate"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null}}},LTXVCropGuides={display_name:"LTXVCropGuides",inputs:{positive:{name:"positive"},negative:{name:"negative"},latent:{name:"latent"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},LTXVImgToVideo={display_name:"LTXVImgToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},image:{name:"image"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},strength:{name:"strength"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},LTXVPreprocess={display_name:"LTXVPreprocess",inputs:{image:{name:"image"},img_compression:{name:"img_compression",tooltip:"Amount of compression to apply on image."}},outputs:{0:{name:"output_image",tooltip:null}}},LTXVScheduler={display_name:"LTXVScheduler",inputs:{steps:{name:"steps"},max_shift:{name:"max_shift"},base_shift:{name:"base_shift"},stretch:{name:"stretch",tooltip:"Stretch the sigmas to be in the range [terminal, 1]."},terminal:{name:"terminal",tooltip:"The terminal value of the sigmas after stretching."},latent:{name:"latent"}},outputs:{0:{tooltip:null}}},LumaConceptsNode={display_name:"Luma Concepts",description:"Camera Concepts for use with Luma Text to Video and Luma Image to Video nodes.",inputs:{concept1:{name:"concept1"},concept2:{name:"concept2"},concept3:{name:"concept3"},concept4:{name:"concept4"},luma_concepts:{name:"luma_concepts",tooltip:"Optional Camera Concepts to add to the ones chosen here."}},outputs:{0:{name:"luma_concepts",tooltip:null}}},LumaImageModifyNode={display_name:"Luma Image to Image",description:"Modifies images synchronously based on prompt and aspect ratio.",inputs:{image:{name:"image"},prompt:{name:"prompt",tooltip:"Prompt for the image generation"},image_weight:{name:"image_weight",tooltip:"Weight of the image; the closer to 1.0, the less the image will be modified."},model:{name:"model"},seed:{name:"seed",tooltip:"Seed to determine if node should re-run; actual results are nondeterministic regardless of seed."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},LumaImageNode={display_name:"Luma Text to Image",description:"Generates images synchronously based on prompt and aspect ratio.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the image generation"},model:{name:"model"},aspect_ratio:{name:"aspect_ratio"},seed:{name:"seed",tooltip:"Seed to determine if node should re-run; actual results are nondeterministic regardless of seed."},style_image_weight:{name:"style_image_weight",tooltip:"Weight of style image. Ignored if no style_image provided."},image_luma_ref:{name:"image_luma_ref",tooltip:"Luma Reference node connection to influence generation with input images; up to 4 images can be considered."},style_image:{name:"style_image",tooltip:"Style reference image; only 1 image will be used."},character_image:{name:"character_image",tooltip:"Character reference images; can be a batch of multiple, up to 4 images can be considered."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},LumaImageToVideoNode={display_name:"Luma Image to Video",description:"Generates videos synchronously based on prompt, input images, and output_size.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the video generation"},model:{name:"model"},resolution:{name:"resolution"},duration:{name:"duration"},loop:{name:"loop"},seed:{name:"seed",tooltip:"Seed to determine if node should re-run; actual results are nondeterministic regardless of seed."},first_image:{name:"first_image",tooltip:"First frame of generated video."},last_image:{name:"last_image",tooltip:"Last frame of generated video."},luma_concepts:{name:"luma_concepts",tooltip:"Optional Camera Concepts to dictate camera motion via the Luma Concepts node."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},LumaReferenceNode={display_name:"Luma Reference",description:"Holds an image and weight for use with Luma Generate Image node.",inputs:{image:{name:"image",tooltip:"Image to use as reference."},weight:{name:"weight",tooltip:"Weight of image reference."},luma_ref:{name:"luma_ref"}},outputs:{0:{name:"luma_ref",tooltip:null}}},LumaVideoNode={display_name:"Luma Text to Video",description:"Generates videos synchronously based on prompt and output_size.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the video generation"},model:{name:"model"},aspect_ratio:{name:"aspect_ratio"},resolution:{name:"resolution"},duration:{name:"duration"},loop:{name:"loop"},seed:{name:"seed",tooltip:"Seed to determine if node should re-run; actual results are nondeterministic regardless of seed."},luma_concepts:{name:"luma_concepts",tooltip:"Optional Camera Concepts to dictate camera motion via the Luma Concepts node."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},Mahiro={display_name:"Mahiro is so cute that she deserves a better guidance function!! (ã€‚ãƒ»Ï‰ãƒ»ã€‚)",description:"Modify the guidance to scale more on the 'direction' of the positive prompt rather than the difference between the negative prompt.",inputs:{model:{name:"model"}},outputs:{0:{name:"patched_model",tooltip:null}}},MaskComposite={display_name:"MaskComposite",inputs:{destination:{name:"destination"},source:{name:"source"},x:{name:"x"},y:{name:"y"},operation:{name:"operation"}}},MaskPreview={display_name:"MaskPreview",description:"Saves the input images to your ComfyUI output directory.",inputs:{mask:{name:"mask"}}},MaskToImage={display_name:"Convert Mask to Image",inputs:{mask:{name:"mask"}}},MinimaxHailuoVideoNode={display_name:"MiniMax Hailuo Video",description:"Generates videos from prompt, with optional start frame using the new MiniMax Hailuo-02 model.",inputs:{prompt_text:{name:"prompt_text",tooltip:"Text prompt to guide the video generation."},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},first_frame_image:{name:"first_frame_image",tooltip:"Optional image to use as the first frame to generate a video."},prompt_optimizer:{name:"prompt_optimizer",tooltip:"Optimize prompt to improve generation quality when needed."},duration:{name:"duration",tooltip:"The length of the output video in seconds."},resolution:{name:"resolution",tooltip:"The dimensions of the video display. 1080p is 1920x1080, 768p is 1366x768."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},MinimaxImageToVideoNode={display_name:"MiniMax Image to Video",description:"Generates videos synchronously based on an image and prompt, and optional parameters.",inputs:{image:{name:"image",tooltip:"Image to use as first frame of video generation"},prompt_text:{name:"prompt_text",tooltip:"Text prompt to guide the video generation"},model:{name:"model",tooltip:"Model to use for video generation"},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},MinimaxTextToVideoNode={display_name:"MiniMax Text to Video",description:"Generates videos synchronously based on a prompt, and optional parameters.",inputs:{prompt_text:{name:"prompt_text",tooltip:"Text prompt to guide the video generation"},model:{name:"model",tooltip:"Model to use for video generation"},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},ModelComputeDtype={display_name:"ModelComputeDtype",inputs:{model:{name:"model"},dtype:{name:"dtype"}}},ModelMergeAdd={display_name:"ModelMergeAdd",inputs:{model1:{name:"model1"},model2:{name:"model2"}}},ModelMergeAuraflow={display_name:"ModelMergeAuraflow",inputs:{model1:{name:"model1"},model2:{name:"model2"},init_x_linear_:{name:"init_x_linear."},positional_encoding:{name:"positional_encoding"},cond_seq_linear_:{name:"cond_seq_linear."},register_tokens:{name:"register_tokens"},t_embedder_:{name:"t_embedder."},double_layers_0_:{name:"double_layers.0."},double_layers_1_:{name:"double_layers.1."},double_layers_2_:{name:"double_layers.2."},double_layers_3_:{name:"double_layers.3."},single_layers_0_:{name:"single_layers.0."},single_layers_1_:{name:"single_layers.1."},single_layers_2_:{name:"single_layers.2."},single_layers_3_:{name:"single_layers.3."},single_layers_4_:{name:"single_layers.4."},single_layers_5_:{name:"single_layers.5."},single_layers_6_:{name:"single_layers.6."},single_layers_7_:{name:"single_layers.7."},single_layers_8_:{name:"single_layers.8."},single_layers_9_:{name:"single_layers.9."},single_layers_10_:{name:"single_layers.10."},single_layers_11_:{name:"single_layers.11."},single_layers_12_:{name:"single_layers.12."},single_layers_13_:{name:"single_layers.13."},single_layers_14_:{name:"single_layers.14."},single_layers_15_:{name:"single_layers.15."},single_layers_16_:{name:"single_layers.16."},single_layers_17_:{name:"single_layers.17."},single_layers_18_:{name:"single_layers.18."},single_layers_19_:{name:"single_layers.19."},single_layers_20_:{name:"single_layers.20."},single_layers_21_:{name:"single_layers.21."},single_layers_22_:{name:"single_layers.22."},single_layers_23_:{name:"single_layers.23."},single_layers_24_:{name:"single_layers.24."},single_layers_25_:{name:"single_layers.25."},single_layers_26_:{name:"single_layers.26."},single_layers_27_:{name:"single_layers.27."},single_layers_28_:{name:"single_layers.28."},single_layers_29_:{name:"single_layers.29."},single_layers_30_:{name:"single_layers.30."},single_layers_31_:{name:"single_layers.31."},modF_:{name:"modF."},final_linear_:{name:"final_linear."}}},ModelMergeBlocks={display_name:"ModelMergeBlocks",inputs:{model1:{name:"model1"},model2:{name:"model2"},input:{name:"input"},middle:{name:"middle"},out:{name:"out"}}},ModelMergeCosmos14B={display_name:"ModelMergeCosmos14B",inputs:{model1:{name:"model1"},model2:{name:"model2"},pos_embedder_:{name:"pos_embedder."},extra_pos_embedder_:{name:"extra_pos_embedder."},x_embedder_:{name:"x_embedder."},t_embedder_:{name:"t_embedder."},affline_norm_:{name:"affline_norm."},blocks_block0_:{name:"blocks.block0."},blocks_block1_:{name:"blocks.block1."},blocks_block2_:{name:"blocks.block2."},blocks_block3_:{name:"blocks.block3."},blocks_block4_:{name:"blocks.block4."},blocks_block5_:{name:"blocks.block5."},blocks_block6_:{name:"blocks.block6."},blocks_block7_:{name:"blocks.block7."},blocks_block8_:{name:"blocks.block8."},blocks_block9_:{name:"blocks.block9."},blocks_block10_:{name:"blocks.block10."},blocks_block11_:{name:"blocks.block11."},blocks_block12_:{name:"blocks.block12."},blocks_block13_:{name:"blocks.block13."},blocks_block14_:{name:"blocks.block14."},blocks_block15_:{name:"blocks.block15."},blocks_block16_:{name:"blocks.block16."},blocks_block17_:{name:"blocks.block17."},blocks_block18_:{name:"blocks.block18."},blocks_block19_:{name:"blocks.block19."},blocks_block20_:{name:"blocks.block20."},blocks_block21_:{name:"blocks.block21."},blocks_block22_:{name:"blocks.block22."},blocks_block23_:{name:"blocks.block23."},blocks_block24_:{name:"blocks.block24."},blocks_block25_:{name:"blocks.block25."},blocks_block26_:{name:"blocks.block26."},blocks_block27_:{name:"blocks.block27."},blocks_block28_:{name:"blocks.block28."},blocks_block29_:{name:"blocks.block29."},blocks_block30_:{name:"blocks.block30."},blocks_block31_:{name:"blocks.block31."},blocks_block32_:{name:"blocks.block32."},blocks_block33_:{name:"blocks.block33."},blocks_block34_:{name:"blocks.block34."},blocks_block35_:{name:"blocks.block35."},final_layer_:{name:"final_layer."}}},ModelMergeCosmos7B={display_name:"ModelMergeCosmos7B",inputs:{model1:{name:"model1"},model2:{name:"model2"},pos_embedder_:{name:"pos_embedder."},extra_pos_embedder_:{name:"extra_pos_embedder."},x_embedder_:{name:"x_embedder."},t_embedder_:{name:"t_embedder."},affline_norm_:{name:"affline_norm."},blocks_block0_:{name:"blocks.block0."},blocks_block1_:{name:"blocks.block1."},blocks_block2_:{name:"blocks.block2."},blocks_block3_:{name:"blocks.block3."},blocks_block4_:{name:"blocks.block4."},blocks_block5_:{name:"blocks.block5."},blocks_block6_:{name:"blocks.block6."},blocks_block7_:{name:"blocks.block7."},blocks_block8_:{name:"blocks.block8."},blocks_block9_:{name:"blocks.block9."},blocks_block10_:{name:"blocks.block10."},blocks_block11_:{name:"blocks.block11."},blocks_block12_:{name:"blocks.block12."},blocks_block13_:{name:"blocks.block13."},blocks_block14_:{name:"blocks.block14."},blocks_block15_:{name:"blocks.block15."},blocks_block16_:{name:"blocks.block16."},blocks_block17_:{name:"blocks.block17."},blocks_block18_:{name:"blocks.block18."},blocks_block19_:{name:"blocks.block19."},blocks_block20_:{name:"blocks.block20."},blocks_block21_:{name:"blocks.block21."},blocks_block22_:{name:"blocks.block22."},blocks_block23_:{name:"blocks.block23."},blocks_block24_:{name:"blocks.block24."},blocks_block25_:{name:"blocks.block25."},blocks_block26_:{name:"blocks.block26."},blocks_block27_:{name:"blocks.block27."},final_layer_:{name:"final_layer."}}},ModelMergeCosmosPredict2_14B={display_name:"ModelMergeCosmosPredict2_14B",inputs:{model1:{name:"model1"},model2:{name:"model2"},pos_embedder_:{name:"pos_embedder."},x_embedder_:{name:"x_embedder."},t_embedder_:{name:"t_embedder."},t_embedding_norm_:{name:"t_embedding_norm."},blocks_0_:{name:"blocks.0."},blocks_1_:{name:"blocks.1."},blocks_2_:{name:"blocks.2."},blocks_3_:{name:"blocks.3."},blocks_4_:{name:"blocks.4."},blocks_5_:{name:"blocks.5."},blocks_6_:{name:"blocks.6."},blocks_7_:{name:"blocks.7."},blocks_8_:{name:"blocks.8."},blocks_9_:{name:"blocks.9."},blocks_10_:{name:"blocks.10."},blocks_11_:{name:"blocks.11."},blocks_12_:{name:"blocks.12."},blocks_13_:{name:"blocks.13."},blocks_14_:{name:"blocks.14."},blocks_15_:{name:"blocks.15."},blocks_16_:{name:"blocks.16."},blocks_17_:{name:"blocks.17."},blocks_18_:{name:"blocks.18."},blocks_19_:{name:"blocks.19."},blocks_20_:{name:"blocks.20."},blocks_21_:{name:"blocks.21."},blocks_22_:{name:"blocks.22."},blocks_23_:{name:"blocks.23."},blocks_24_:{name:"blocks.24."},blocks_25_:{name:"blocks.25."},blocks_26_:{name:"blocks.26."},blocks_27_:{name:"blocks.27."},blocks_28_:{name:"blocks.28."},blocks_29_:{name:"blocks.29."},blocks_30_:{name:"blocks.30."},blocks_31_:{name:"blocks.31."},blocks_32_:{name:"blocks.32."},blocks_33_:{name:"blocks.33."},blocks_34_:{name:"blocks.34."},blocks_35_:{name:"blocks.35."},final_layer_:{name:"final_layer."}}},ModelMergeCosmosPredict2_2B={display_name:"ModelMergeCosmosPredict2_2B",inputs:{model1:{name:"model1"},model2:{name:"model2"},pos_embedder_:{name:"pos_embedder."},x_embedder_:{name:"x_embedder."},t_embedder_:{name:"t_embedder."},t_embedding_norm_:{name:"t_embedding_norm."},blocks_0_:{name:"blocks.0."},blocks_1_:{name:"blocks.1."},blocks_2_:{name:"blocks.2."},blocks_3_:{name:"blocks.3."},blocks_4_:{name:"blocks.4."},blocks_5_:{name:"blocks.5."},blocks_6_:{name:"blocks.6."},blocks_7_:{name:"blocks.7."},blocks_8_:{name:"blocks.8."},blocks_9_:{name:"blocks.9."},blocks_10_:{name:"blocks.10."},blocks_11_:{name:"blocks.11."},blocks_12_:{name:"blocks.12."},blocks_13_:{name:"blocks.13."},blocks_14_:{name:"blocks.14."},blocks_15_:{name:"blocks.15."},blocks_16_:{name:"blocks.16."},blocks_17_:{name:"blocks.17."},blocks_18_:{name:"blocks.18."},blocks_19_:{name:"blocks.19."},blocks_20_:{name:"blocks.20."},blocks_21_:{name:"blocks.21."},blocks_22_:{name:"blocks.22."},blocks_23_:{name:"blocks.23."},blocks_24_:{name:"blocks.24."},blocks_25_:{name:"blocks.25."},blocks_26_:{name:"blocks.26."},blocks_27_:{name:"blocks.27."},final_layer_:{name:"final_layer."}}},ModelMergeFlux1={display_name:"ModelMergeFlux1",inputs:{model1:{name:"model1"},model2:{name:"model2"},img_in_:{name:"img_in."},time_in_:{name:"time_in."},guidance_in:{name:"guidance_in"},vector_in_:{name:"vector_in."},txt_in_:{name:"txt_in."},double_blocks_0_:{name:"double_blocks.0."},double_blocks_1_:{name:"double_blocks.1."},double_blocks_2_:{name:"double_blocks.2."},double_blocks_3_:{name:"double_blocks.3."},double_blocks_4_:{name:"double_blocks.4."},double_blocks_5_:{name:"double_blocks.5."},double_blocks_6_:{name:"double_blocks.6."},double_blocks_7_:{name:"double_blocks.7."},double_blocks_8_:{name:"double_blocks.8."},double_blocks_9_:{name:"double_blocks.9."},double_blocks_10_:{name:"double_blocks.10."},double_blocks_11_:{name:"double_blocks.11."},double_blocks_12_:{name:"double_blocks.12."},double_blocks_13_:{name:"double_blocks.13."},double_blocks_14_:{name:"double_blocks.14."},double_blocks_15_:{name:"double_blocks.15."},double_blocks_16_:{name:"double_blocks.16."},double_blocks_17_:{name:"double_blocks.17."},double_blocks_18_:{name:"double_blocks.18."},single_blocks_0_:{name:"single_blocks.0."},single_blocks_1_:{name:"single_blocks.1."},single_blocks_2_:{name:"single_blocks.2."},single_blocks_3_:{name:"single_blocks.3."},single_blocks_4_:{name:"single_blocks.4."},single_blocks_5_:{name:"single_blocks.5."},single_blocks_6_:{name:"single_blocks.6."},single_blocks_7_:{name:"single_blocks.7."},single_blocks_8_:{name:"single_blocks.8."},single_blocks_9_:{name:"single_blocks.9."},single_blocks_10_:{name:"single_blocks.10."},single_blocks_11_:{name:"single_blocks.11."},single_blocks_12_:{name:"single_blocks.12."},single_blocks_13_:{name:"single_blocks.13."},single_blocks_14_:{name:"single_blocks.14."},single_blocks_15_:{name:"single_blocks.15."},single_blocks_16_:{name:"single_blocks.16."},single_blocks_17_:{name:"single_blocks.17."},single_blocks_18_:{name:"single_blocks.18."},single_blocks_19_:{name:"single_blocks.19."},single_blocks_20_:{name:"single_blocks.20."},single_blocks_21_:{name:"single_blocks.21."},single_blocks_22_:{name:"single_blocks.22."},single_blocks_23_:{name:"single_blocks.23."},single_blocks_24_:{name:"single_blocks.24."},single_blocks_25_:{name:"single_blocks.25."},single_blocks_26_:{name:"single_blocks.26."},single_blocks_27_:{name:"single_blocks.27."},single_blocks_28_:{name:"single_blocks.28."},single_blocks_29_:{name:"single_blocks.29."},single_blocks_30_:{name:"single_blocks.30."},single_blocks_31_:{name:"single_blocks.31."},single_blocks_32_:{name:"single_blocks.32."},single_blocks_33_:{name:"single_blocks.33."},single_blocks_34_:{name:"single_blocks.34."},single_blocks_35_:{name:"single_blocks.35."},single_blocks_36_:{name:"single_blocks.36."},single_blocks_37_:{name:"single_blocks.37."},final_layer_:{name:"final_layer."}}},ModelMergeLTXV={display_name:"ModelMergeLTXV",inputs:{model1:{name:"model1"},model2:{name:"model2"},patchify_proj_:{name:"patchify_proj."},adaln_single_:{name:"adaln_single."},caption_projection_:{name:"caption_projection."},transformer_blocks_0_:{name:"transformer_blocks.0."},transformer_blocks_1_:{name:"transformer_blocks.1."},transformer_blocks_2_:{name:"transformer_blocks.2."},transformer_blocks_3_:{name:"transformer_blocks.3."},transformer_blocks_4_:{name:"transformer_blocks.4."},transformer_blocks_5_:{name:"transformer_blocks.5."},transformer_blocks_6_:{name:"transformer_blocks.6."},transformer_blocks_7_:{name:"transformer_blocks.7."},transformer_blocks_8_:{name:"transformer_blocks.8."},transformer_blocks_9_:{name:"transformer_blocks.9."},transformer_blocks_10_:{name:"transformer_blocks.10."},transformer_blocks_11_:{name:"transformer_blocks.11."},transformer_blocks_12_:{name:"transformer_blocks.12."},transformer_blocks_13_:{name:"transformer_blocks.13."},transformer_blocks_14_:{name:"transformer_blocks.14."},transformer_blocks_15_:{name:"transformer_blocks.15."},transformer_blocks_16_:{name:"transformer_blocks.16."},transformer_blocks_17_:{name:"transformer_blocks.17."},transformer_blocks_18_:{name:"transformer_blocks.18."},transformer_blocks_19_:{name:"transformer_blocks.19."},transformer_blocks_20_:{name:"transformer_blocks.20."},transformer_blocks_21_:{name:"transformer_blocks.21."},transformer_blocks_22_:{name:"transformer_blocks.22."},transformer_blocks_23_:{name:"transformer_blocks.23."},transformer_blocks_24_:{name:"transformer_blocks.24."},transformer_blocks_25_:{name:"transformer_blocks.25."},transformer_blocks_26_:{name:"transformer_blocks.26."},transformer_blocks_27_:{name:"transformer_blocks.27."},scale_shift_table:{name:"scale_shift_table"},proj_out_:{name:"proj_out."}}},ModelMergeMochiPreview={display_name:"ModelMergeMochiPreview",inputs:{model1:{name:"model1"},model2:{name:"model2"},pos_frequencies_:{name:"pos_frequencies."},t_embedder_:{name:"t_embedder."},t5_y_embedder_:{name:"t5_y_embedder."},t5_yproj_:{name:"t5_yproj."},blocks_0_:{name:"blocks.0."},blocks_1_:{name:"blocks.1."},blocks_2_:{name:"blocks.2."},blocks_3_:{name:"blocks.3."},blocks_4_:{name:"blocks.4."},blocks_5_:{name:"blocks.5."},blocks_6_:{name:"blocks.6."},blocks_7_:{name:"blocks.7."},blocks_8_:{name:"blocks.8."},blocks_9_:{name:"blocks.9."},blocks_10_:{name:"blocks.10."},blocks_11_:{name:"blocks.11."},blocks_12_:{name:"blocks.12."},blocks_13_:{name:"blocks.13."},blocks_14_:{name:"blocks.14."},blocks_15_:{name:"blocks.15."},blocks_16_:{name:"blocks.16."},blocks_17_:{name:"blocks.17."},blocks_18_:{name:"blocks.18."},blocks_19_:{name:"blocks.19."},blocks_20_:{name:"blocks.20."},blocks_21_:{name:"blocks.21."},blocks_22_:{name:"blocks.22."},blocks_23_:{name:"blocks.23."},blocks_24_:{name:"blocks.24."},blocks_25_:{name:"blocks.25."},blocks_26_:{name:"blocks.26."},blocks_27_:{name:"blocks.27."},blocks_28_:{name:"blocks.28."},blocks_29_:{name:"blocks.29."},blocks_30_:{name:"blocks.30."},blocks_31_:{name:"blocks.31."},blocks_32_:{name:"blocks.32."},blocks_33_:{name:"blocks.33."},blocks_34_:{name:"blocks.34."},blocks_35_:{name:"blocks.35."},blocks_36_:{name:"blocks.36."},blocks_37_:{name:"blocks.37."},blocks_38_:{name:"blocks.38."},blocks_39_:{name:"blocks.39."},blocks_40_:{name:"blocks.40."},blocks_41_:{name:"blocks.41."},blocks_42_:{name:"blocks.42."},blocks_43_:{name:"blocks.43."},blocks_44_:{name:"blocks.44."},blocks_45_:{name:"blocks.45."},blocks_46_:{name:"blocks.46."},blocks_47_:{name:"blocks.47."},final_layer_:{name:"final_layer."}}},ModelMergeQwenImage={display_name:"ModelMergeQwenImage",inputs:{model1:{name:"model1"},model2:{name:"model2"},pos_embeds_:{name:"pos_embeds."},img_in_:{name:"img_in."},txt_norm_:{name:"txt_norm."},txt_in_:{name:"txt_in."},time_text_embed_:{name:"time_text_embed."},transformer_blocks_0_:{name:"transformer_blocks.0."},transformer_blocks_1_:{name:"transformer_blocks.1."},transformer_blocks_2_:{name:"transformer_blocks.2."},transformer_blocks_3_:{name:"transformer_blocks.3."},transformer_blocks_4_:{name:"transformer_blocks.4."},transformer_blocks_5_:{name:"transformer_blocks.5."},transformer_blocks_6_:{name:"transformer_blocks.6."},transformer_blocks_7_:{name:"transformer_blocks.7."},transformer_blocks_8_:{name:"transformer_blocks.8."},transformer_blocks_9_:{name:"transformer_blocks.9."},transformer_blocks_10_:{name:"transformer_blocks.10."},transformer_blocks_11_:{name:"transformer_blocks.11."},transformer_blocks_12_:{name:"transformer_blocks.12."},transformer_blocks_13_:{name:"transformer_blocks.13."},transformer_blocks_14_:{name:"transformer_blocks.14."},transformer_blocks_15_:{name:"transformer_blocks.15."},transformer_blocks_16_:{name:"transformer_blocks.16."},transformer_blocks_17_:{name:"transformer_blocks.17."},transformer_blocks_18_:{name:"transformer_blocks.18."},transformer_blocks_19_:{name:"transformer_blocks.19."},transformer_blocks_20_:{name:"transformer_blocks.20."},transformer_blocks_21_:{name:"transformer_blocks.21."},transformer_blocks_22_:{name:"transformer_blocks.22."},transformer_blocks_23_:{name:"transformer_blocks.23."},transformer_blocks_24_:{name:"transformer_blocks.24."},transformer_blocks_25_:{name:"transformer_blocks.25."},transformer_blocks_26_:{name:"transformer_blocks.26."},transformer_blocks_27_:{name:"transformer_blocks.27."},transformer_blocks_28_:{name:"transformer_blocks.28."},transformer_blocks_29_:{name:"transformer_blocks.29."},transformer_blocks_30_:{name:"transformer_blocks.30."},transformer_blocks_31_:{name:"transformer_blocks.31."},transformer_blocks_32_:{name:"transformer_blocks.32."},transformer_blocks_33_:{name:"transformer_blocks.33."},transformer_blocks_34_:{name:"transformer_blocks.34."},transformer_blocks_35_:{name:"transformer_blocks.35."},transformer_blocks_36_:{name:"transformer_blocks.36."},transformer_blocks_37_:{name:"transformer_blocks.37."},transformer_blocks_38_:{name:"transformer_blocks.38."},transformer_blocks_39_:{name:"transformer_blocks.39."},transformer_blocks_40_:{name:"transformer_blocks.40."},transformer_blocks_41_:{name:"transformer_blocks.41."},transformer_blocks_42_:{name:"transformer_blocks.42."},transformer_blocks_43_:{name:"transformer_blocks.43."},transformer_blocks_44_:{name:"transformer_blocks.44."},transformer_blocks_45_:{name:"transformer_blocks.45."},transformer_blocks_46_:{name:"transformer_blocks.46."},transformer_blocks_47_:{name:"transformer_blocks.47."},transformer_blocks_48_:{name:"transformer_blocks.48."},transformer_blocks_49_:{name:"transformer_blocks.49."},transformer_blocks_50_:{name:"transformer_blocks.50."},transformer_blocks_51_:{name:"transformer_blocks.51."},transformer_blocks_52_:{name:"transformer_blocks.52."},transformer_blocks_53_:{name:"transformer_blocks.53."},transformer_blocks_54_:{name:"transformer_blocks.54."},transformer_blocks_55_:{name:"transformer_blocks.55."},transformer_blocks_56_:{name:"transformer_blocks.56."},transformer_blocks_57_:{name:"transformer_blocks.57."},transformer_blocks_58_:{name:"transformer_blocks.58."},transformer_blocks_59_:{name:"transformer_blocks.59."},proj_out_:{name:"proj_out."}}},ModelMergeSD1={display_name:"ModelMergeSD1",inputs:{model1:{name:"model1"},model2:{name:"model2"},time_embed_:{name:"time_embed."},label_emb_:{name:"label_emb."},input_blocks_0_:{name:"input_blocks.0."},input_blocks_1_:{name:"input_blocks.1."},input_blocks_2_:{name:"input_blocks.2."},input_blocks_3_:{name:"input_blocks.3."},input_blocks_4_:{name:"input_blocks.4."},input_blocks_5_:{name:"input_blocks.5."},input_blocks_6_:{name:"input_blocks.6."},input_blocks_7_:{name:"input_blocks.7."},input_blocks_8_:{name:"input_blocks.8."},input_blocks_9_:{name:"input_blocks.9."},input_blocks_10_:{name:"input_blocks.10."},input_blocks_11_:{name:"input_blocks.11."},middle_block_0_:{name:"middle_block.0."},middle_block_1_:{name:"middle_block.1."},middle_block_2_:{name:"middle_block.2."},output_blocks_0_:{name:"output_blocks.0."},output_blocks_1_:{name:"output_blocks.1."},output_blocks_2_:{name:"output_blocks.2."},output_blocks_3_:{name:"output_blocks.3."},output_blocks_4_:{name:"output_blocks.4."},output_blocks_5_:{name:"output_blocks.5."},output_blocks_6_:{name:"output_blocks.6."},output_blocks_7_:{name:"output_blocks.7."},output_blocks_8_:{name:"output_blocks.8."},output_blocks_9_:{name:"output_blocks.9."},output_blocks_10_:{name:"output_blocks.10."},output_blocks_11_:{name:"output_blocks.11."},out_:{name:"out."}}},ModelMergeSD2={display_name:"ModelMergeSD2",inputs:{model1:{name:"model1"},model2:{name:"model2"},time_embed_:{name:"time_embed."},label_emb_:{name:"label_emb."},input_blocks_0_:{name:"input_blocks.0."},input_blocks_1_:{name:"input_blocks.1."},input_blocks_2_:{name:"input_blocks.2."},input_blocks_3_:{name:"input_blocks.3."},input_blocks_4_:{name:"input_blocks.4."},input_blocks_5_:{name:"input_blocks.5."},input_blocks_6_:{name:"input_blocks.6."},input_blocks_7_:{name:"input_blocks.7."},input_blocks_8_:{name:"input_blocks.8."},input_blocks_9_:{name:"input_blocks.9."},input_blocks_10_:{name:"input_blocks.10."},input_blocks_11_:{name:"input_blocks.11."},middle_block_0_:{name:"middle_block.0."},middle_block_1_:{name:"middle_block.1."},middle_block_2_:{name:"middle_block.2."},output_blocks_0_:{name:"output_blocks.0."},output_blocks_1_:{name:"output_blocks.1."},output_blocks_2_:{name:"output_blocks.2."},output_blocks_3_:{name:"output_blocks.3."},output_blocks_4_:{name:"output_blocks.4."},output_blocks_5_:{name:"output_blocks.5."},output_blocks_6_:{name:"output_blocks.6."},output_blocks_7_:{name:"output_blocks.7."},output_blocks_8_:{name:"output_blocks.8."},output_blocks_9_:{name:"output_blocks.9."},output_blocks_10_:{name:"output_blocks.10."},output_blocks_11_:{name:"output_blocks.11."},out_:{name:"out."}}},ModelMergeSD3_2B={display_name:"ModelMergeSD3_2B",inputs:{model1:{name:"model1"},model2:{name:"model2"},pos_embed_:{name:"pos_embed."},x_embedder_:{name:"x_embedder."},context_embedder_:{name:"context_embedder."},y_embedder_:{name:"y_embedder."},t_embedder_:{name:"t_embedder."},joint_blocks_0_:{name:"joint_blocks.0."},joint_blocks_1_:{name:"joint_blocks.1."},joint_blocks_2_:{name:"joint_blocks.2."},joint_blocks_3_:{name:"joint_blocks.3."},joint_blocks_4_:{name:"joint_blocks.4."},joint_blocks_5_:{name:"joint_blocks.5."},joint_blocks_6_:{name:"joint_blocks.6."},joint_blocks_7_:{name:"joint_blocks.7."},joint_blocks_8_:{name:"joint_blocks.8."},joint_blocks_9_:{name:"joint_blocks.9."},joint_blocks_10_:{name:"joint_blocks.10."},joint_blocks_11_:{name:"joint_blocks.11."},joint_blocks_12_:{name:"joint_blocks.12."},joint_blocks_13_:{name:"joint_blocks.13."},joint_blocks_14_:{name:"joint_blocks.14."},joint_blocks_15_:{name:"joint_blocks.15."},joint_blocks_16_:{name:"joint_blocks.16."},joint_blocks_17_:{name:"joint_blocks.17."},joint_blocks_18_:{name:"joint_blocks.18."},joint_blocks_19_:{name:"joint_blocks.19."},joint_blocks_20_:{name:"joint_blocks.20."},joint_blocks_21_:{name:"joint_blocks.21."},joint_blocks_22_:{name:"joint_blocks.22."},joint_blocks_23_:{name:"joint_blocks.23."},final_layer_:{name:"final_layer."}}},ModelMergeSD35_Large={display_name:"ModelMergeSD35_Large",inputs:{model1:{name:"model1"},model2:{name:"model2"},pos_embed_:{name:"pos_embed."},x_embedder_:{name:"x_embedder."},context_embedder_:{name:"context_embedder."},y_embedder_:{name:"y_embedder."},t_embedder_:{name:"t_embedder."},joint_blocks_0_:{name:"joint_blocks.0."},joint_blocks_1_:{name:"joint_blocks.1."},joint_blocks_2_:{name:"joint_blocks.2."},joint_blocks_3_:{name:"joint_blocks.3."},joint_blocks_4_:{name:"joint_blocks.4."},joint_blocks_5_:{name:"joint_blocks.5."},joint_blocks_6_:{name:"joint_blocks.6."},joint_blocks_7_:{name:"joint_blocks.7."},joint_blocks_8_:{name:"joint_blocks.8."},joint_blocks_9_:{name:"joint_blocks.9."},joint_blocks_10_:{name:"joint_blocks.10."},joint_blocks_11_:{name:"joint_blocks.11."},joint_blocks_12_:{name:"joint_blocks.12."},joint_blocks_13_:{name:"joint_blocks.13."},joint_blocks_14_:{name:"joint_blocks.14."},joint_blocks_15_:{name:"joint_blocks.15."},joint_blocks_16_:{name:"joint_blocks.16."},joint_blocks_17_:{name:"joint_blocks.17."},joint_blocks_18_:{name:"joint_blocks.18."},joint_blocks_19_:{name:"joint_blocks.19."},joint_blocks_20_:{name:"joint_blocks.20."},joint_blocks_21_:{name:"joint_blocks.21."},joint_blocks_22_:{name:"joint_blocks.22."},joint_blocks_23_:{name:"joint_blocks.23."},joint_blocks_24_:{name:"joint_blocks.24."},joint_blocks_25_:{name:"joint_blocks.25."},joint_blocks_26_:{name:"joint_blocks.26."},joint_blocks_27_:{name:"joint_blocks.27."},joint_blocks_28_:{name:"joint_blocks.28."},joint_blocks_29_:{name:"joint_blocks.29."},joint_blocks_30_:{name:"joint_blocks.30."},joint_blocks_31_:{name:"joint_blocks.31."},joint_blocks_32_:{name:"joint_blocks.32."},joint_blocks_33_:{name:"joint_blocks.33."},joint_blocks_34_:{name:"joint_blocks.34."},joint_blocks_35_:{name:"joint_blocks.35."},joint_blocks_36_:{name:"joint_blocks.36."},joint_blocks_37_:{name:"joint_blocks.37."},final_layer_:{name:"final_layer."}}},ModelMergeSDXL={display_name:"ModelMergeSDXL",inputs:{model1:{name:"model1"},model2:{name:"model2"},time_embed_:{name:"time_embed."},label_emb_:{name:"label_emb."},input_blocks_0:{name:"input_blocks.0"},input_blocks_1:{name:"input_blocks.1"},input_blocks_2:{name:"input_blocks.2"},input_blocks_3:{name:"input_blocks.3"},input_blocks_4:{name:"input_blocks.4"},input_blocks_5:{name:"input_blocks.5"},input_blocks_6:{name:"input_blocks.6"},input_blocks_7:{name:"input_blocks.7"},input_blocks_8:{name:"input_blocks.8"},middle_block_0:{name:"middle_block.0"},middle_block_1:{name:"middle_block.1"},middle_block_2:{name:"middle_block.2"},output_blocks_0:{name:"output_blocks.0"},output_blocks_1:{name:"output_blocks.1"},output_blocks_2:{name:"output_blocks.2"},output_blocks_3:{name:"output_blocks.3"},output_blocks_4:{name:"output_blocks.4"},output_blocks_5:{name:"output_blocks.5"},output_blocks_6:{name:"output_blocks.6"},output_blocks_7:{name:"output_blocks.7"},output_blocks_8:{name:"output_blocks.8"},out_:{name:"out."}}},ModelMergeSimple={display_name:"ModelMergeSimple",inputs:{model1:{name:"model1"},model2:{name:"model2"},ratio:{name:"ratio"}}},ModelMergeSubtract={display_name:"ModelMergeSubtract",inputs:{model1:{name:"model1"},model2:{name:"model2"},multiplier:{name:"multiplier"}}},ModelMergeWAN2_1={display_name:"ModelMergeWAN2_1",description:"1.3B model has 30 blocks, 14B model has 40 blocks. Image to video model has the extra img_emb.",inputs:{model1:{name:"model1"},model2:{name:"model2"},patch_embedding_:{name:"patch_embedding."},time_embedding_:{name:"time_embedding."},time_projection_:{name:"time_projection."},text_embedding_:{name:"text_embedding."},img_emb_:{name:"img_emb."},blocks_0_:{name:"blocks.0."},blocks_1_:{name:"blocks.1."},blocks_2_:{name:"blocks.2."},blocks_3_:{name:"blocks.3."},blocks_4_:{name:"blocks.4."},blocks_5_:{name:"blocks.5."},blocks_6_:{name:"blocks.6."},blocks_7_:{name:"blocks.7."},blocks_8_:{name:"blocks.8."},blocks_9_:{name:"blocks.9."},blocks_10_:{name:"blocks.10."},blocks_11_:{name:"blocks.11."},blocks_12_:{name:"blocks.12."},blocks_13_:{name:"blocks.13."},blocks_14_:{name:"blocks.14."},blocks_15_:{name:"blocks.15."},blocks_16_:{name:"blocks.16."},blocks_17_:{name:"blocks.17."},blocks_18_:{name:"blocks.18."},blocks_19_:{name:"blocks.19."},blocks_20_:{name:"blocks.20."},blocks_21_:{name:"blocks.21."},blocks_22_:{name:"blocks.22."},blocks_23_:{name:"blocks.23."},blocks_24_:{name:"blocks.24."},blocks_25_:{name:"blocks.25."},blocks_26_:{name:"blocks.26."},blocks_27_:{name:"blocks.27."},blocks_28_:{name:"blocks.28."},blocks_29_:{name:"blocks.29."},blocks_30_:{name:"blocks.30."},blocks_31_:{name:"blocks.31."},blocks_32_:{name:"blocks.32."},blocks_33_:{name:"blocks.33."},blocks_34_:{name:"blocks.34."},blocks_35_:{name:"blocks.35."},blocks_36_:{name:"blocks.36."},blocks_37_:{name:"blocks.37."},blocks_38_:{name:"blocks.38."},blocks_39_:{name:"blocks.39."},head_:{name:"head."}}},ModelPatchLoader={display_name:"ModelPatchLoader",inputs:{name:{name:"name"}}},ModelSamplingAuraFlow={display_name:"ModelSamplingAuraFlow",inputs:{model:{name:"model"},shift:{name:"shift"}}},ModelSamplingContinuousEDM={display_name:"ModelSamplingContinuousEDM",inputs:{model:{name:"model"},sampling:{name:"sampling"},sigma_max:{name:"sigma_max"},sigma_min:{name:"sigma_min"}}},ModelSamplingContinuousV={display_name:"ModelSamplingContinuousV",inputs:{model:{name:"model"},sampling:{name:"sampling"},sigma_max:{name:"sigma_max"},sigma_min:{name:"sigma_min"}}},ModelSamplingDiscrete={display_name:"ModelSamplingDiscrete",inputs:{model:{name:"model"},sampling:{name:"sampling"},zsnr:{name:"zsnr"}}},ModelSamplingFlux={display_name:"ModelSamplingFlux",inputs:{model:{name:"model"},max_shift:{name:"max_shift"},base_shift:{name:"base_shift"},width:{name:"width"},height:{name:"height"}}},ModelSamplingLTXV={display_name:"ModelSamplingLTXV",inputs:{model:{name:"model"},max_shift:{name:"max_shift"},base_shift:{name:"base_shift"},latent:{name:"latent"}},outputs:{0:{tooltip:null}}},ModelSamplingSD3={display_name:"ModelSamplingSD3",inputs:{model:{name:"model"},shift:{name:"shift"}}},ModelSamplingStableCascade={display_name:"ModelSamplingStableCascade",inputs:{model:{name:"model"},shift:{name:"shift"}}},ModelSave={display_name:"ModelSave",inputs:{model:{name:"model"},filename_prefix:{name:"filename_prefix"}}},MoonvalleyImg2VideoNode={display_name:"Moonvalley Marey Image to Video",description:"Moonvalley Marey Image to Video Node",inputs:{image:{name:"image",tooltip:"The reference image used to generate the video"},prompt:{name:"prompt"},negative_prompt:{name:"negative_prompt",tooltip:"Negative prompt text"},resolution:{name:"resolution",tooltip:"Resolution of the output video"},prompt_adherence:{name:"prompt_adherence",tooltip:"Guidance scale for generation control"},seed:{name:"seed",tooltip:"Random seed value"},steps:{name:"steps",tooltip:"Number of denoising steps"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},MoonvalleyTxt2VideoNode={display_name:"Moonvalley Marey Text to Video",inputs:{prompt:{name:"prompt"},negative_prompt:{name:"negative_prompt",tooltip:"Negative prompt text"},resolution:{name:"resolution",tooltip:"Resolution of the output video"},prompt_adherence:{name:"prompt_adherence",tooltip:"Guidance scale for generation control"},seed:{name:"seed",tooltip:"Random seed value"},steps:{name:"steps",tooltip:"Inference steps"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},MoonvalleyVideo2VideoNode={display_name:"Moonvalley Marey Video to Video",inputs:{prompt:{name:"prompt",tooltip:"Describes the video to generate"},negative_prompt:{name:"negative_prompt",tooltip:"Negative prompt text"},seed:{name:"seed",tooltip:"Random seed value"},video:{name:"video",tooltip:"The reference video used to generate the output video. Must be at least 5 seconds long. Videos longer than 5s will be automatically trimmed. Only MP4 format supported."},steps:{name:"steps",tooltip:"Number of inference steps"},control_type:{name:"control_type"},motion_intensity:{name:"motion_intensity",tooltip:"Only used if control_type is 'Motion Transfer'"}},outputs:{0:{tooltip:null}}},Morphology={display_name:"ImageMorphology",inputs:{image:{name:"image"},operation:{name:"operation"},kernel_size:{name:"kernel_size"}},outputs:{0:{tooltip:null}}},OpenAIChatConfig={display_name:"OpenAI ChatGPT Advanced Options",description:"Allows specifying advanced configuration options for the OpenAI Chat Nodes.",inputs:{truncation:{name:"truncation",tooltip:"The truncation strategy to use for the model response. auto: If the context of this response and previous ones exceeds the model's context window size, the model will truncate the response to fit the context window by dropping input items in the middle of the conversation.disabled: If a model response will exceed the context window size for a model, the request will fail with a 400 error"},max_output_tokens:{name:"max_output_tokens",tooltip:"An upper bound for the number of tokens that can be generated for a response, including visible output tokens"},instructions:{name:"instructions",tooltip:"Instructions for the model on how to generate the response"}},outputs:{0:{tooltip:null}}},OpenAIChatNode={display_name:"OpenAI ChatGPT",description:"Generate text responses from an OpenAI model.",inputs:{prompt:{name:"prompt",tooltip:"Text inputs to the model, used to generate a response."},persist_context:{name:"persist_context",tooltip:"This parameter is deprecated and has no effect."},model:{name:"model",tooltip:"The model used to generate the response"},images:{name:"images",tooltip:"Optional image(s) to use as context for the model. To include multiple images, you can use the Batch Images node."},files:{name:"files",tooltip:"Optional file(s) to use as context for the model. Accepts inputs from the OpenAI Chat Input Files node."},advanced_options:{name:"advanced_options",tooltip:"Optional configuration for the model. Accepts inputs from the OpenAI Chat Advanced Options node."}},outputs:{0:{tooltip:null}}},OpenAIDalle2={display_name:"OpenAI DALLÂ·E 2",description:"Generates images synchronously via OpenAI's DALLÂ·E 2 endpoint.",inputs:{prompt:{name:"prompt",tooltip:"Text prompt for DALLÂ·E"},seed:{name:"seed",tooltip:"not implemented yet in backend"},size:{name:"size",tooltip:"Image size"},n:{name:"n",tooltip:"How many images to generate"},image:{name:"image",tooltip:"Optional reference image for image editing."},mask:{name:"mask",tooltip:"Optional mask for inpainting (white areas will be replaced)"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},OpenAIDalle3={display_name:"OpenAI DALLÂ·E 3",description:"Generates images synchronously via OpenAI's DALLÂ·E 3 endpoint.",inputs:{prompt:{name:"prompt",tooltip:"Text prompt for DALLÂ·E"},seed:{name:"seed",tooltip:"not implemented yet in backend"},quality:{name:"quality",tooltip:"Image quality"},style:{name:"style",tooltip:"Vivid causes the model to lean towards generating hyper-real and dramatic images. Natural causes the model to produce more natural, less hyper-real looking images."},size:{name:"size",tooltip:"Image size"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},OpenAIGPTImage1={display_name:"OpenAI GPT Image 1",description:"Generates images synchronously via OpenAI's GPT Image 1 endpoint.",inputs:{prompt:{name:"prompt",tooltip:"Text prompt for GPT Image 1"},seed:{name:"seed",tooltip:"not implemented yet in backend"},quality:{name:"quality",tooltip:"Image quality, affects cost and generation time."},background:{name:"background",tooltip:"Return image with or without background"},size:{name:"size",tooltip:"Image size"},n:{name:"n",tooltip:"How many images to generate"},image:{name:"image",tooltip:"Optional reference image for image editing."},mask:{name:"mask",tooltip:"Optional mask for inpainting (white areas will be replaced)"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},OpenAIInputFiles={display_name:"OpenAI ChatGPT Input Files",description:"Loads and prepares input files (text, pdf, etc.) to include as inputs for the OpenAI Chat Node. The files will be read by the OpenAI model when generating a response. ðŸ›ˆ TIP: Can be chained together with other OpenAI Input File nodes.",inputs:{file:{name:"file",tooltip:"Input files to include as context for the model. Only accepts text (.txt) and PDF (.pdf) files for now."},OPENAI_INPUT_FILES:{name:"OPENAI_INPUT_FILES",tooltip:"An optional additional file(s) to batch together with the file loaded from this node. Allows chaining of input files so that a single message can include multiple input files."}},outputs:{0:{tooltip:null}}},OpenAIVideoSora2={display_name:"OpenAI Sora - Video",description:"OpenAI video and audio generation.",inputs:{model:{name:"model"},prompt:{name:"prompt",tooltip:"Guiding text; may be empty if an input image is present."},size:{name:"size"},duration:{name:"duration"},image:{name:"image"},seed:{name:"seed",tooltip:"Seed to determine if node should re-run; actual results are nondeterministic regardless of seed."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},OptimalStepsScheduler={display_name:"OptimalStepsScheduler",inputs:{model_type:{name:"model_type"},steps:{name:"steps"},denoise:{name:"denoise"}},outputs:{0:{tooltip:null}}},PairConditioningCombine={display_name:"Cond Pair Combine",inputs:{positive_A:{name:"positive_A"},negative_A:{name:"negative_A"},positive_B:{name:"positive_B"},negative_B:{name:"negative_B"}},outputs:{0:{name:"positive"},1:{name:"negative"}}},PairConditioningSetDefaultCombine={display_name:"Cond Pair Set Default Combine",inputs:{positive:{name:"positive"},negative:{name:"negative"},positive_DEFAULT:{name:"positive_DEFAULT"},negative_DEFAULT:{name:"negative_DEFAULT"},hooks:{name:"hooks"}},outputs:{0:{name:"positive"},1:{name:"negative"}}},PairConditioningSetProperties={display_name:"Cond Pair Set Props",inputs:{positive_NEW:{name:"positive_NEW"},negative_NEW:{name:"negative_NEW"},strength:{name:"strength"},set_cond_area:{name:"set_cond_area"},mask:{name:"mask"},hooks:{name:"hooks"},timesteps:{name:"timesteps"}},outputs:{0:{name:"positive"},1:{name:"negative"}}},PairConditioningSetPropertiesAndCombine={display_name:"Cond Pair Set Props Combine",inputs:{positive:{name:"positive"},negative:{name:"negative"},positive_NEW:{name:"positive_NEW"},negative_NEW:{name:"negative_NEW"},strength:{name:"strength"},set_cond_area:{name:"set_cond_area"},mask:{name:"mask"},hooks:{name:"hooks"},timesteps:{name:"timesteps"}},outputs:{0:{name:"positive"},1:{name:"negative"}}},PatchModelAddDownscale={display_name:"PatchModelAddDownscale (Kohya Deep Shrink)",inputs:{model:{name:"model"},block_number:{name:"block_number"},downscale_factor:{name:"downscale_factor"},start_percent:{name:"start_percent"},end_percent:{name:"end_percent"},downscale_after_skip:{name:"downscale_after_skip"},downscale_method:{name:"downscale_method"},upscale_method:{name:"upscale_method"}},outputs:{0:{tooltip:null}}},PerpNeg={display_name:"Perp-Neg (DEPRECATED by PerpNegGuider)",inputs:{model:{name:"model"},empty_conditioning:{name:"empty_conditioning"},neg_scale:{name:"neg_scale"}},outputs:{0:{tooltip:null}}},PerpNegGuider={display_name:"PerpNegGuider",inputs:{model:{name:"model"},positive:{name:"positive"},negative:{name:"negative"},empty_conditioning:{name:"empty_conditioning"},cfg:{name:"cfg"},neg_scale:{name:"neg_scale"}},outputs:{0:{tooltip:null}}},PerturbedAttentionGuidance={display_name:"PerturbedAttentionGuidance",inputs:{model:{name:"model"},scale:{name:"scale"}},outputs:{0:{tooltip:null}}},PhotoMakerEncode={display_name:"PhotoMakerEncode",inputs:{photomaker:{name:"photomaker"},image:{name:"image"},clip:{name:"clip"},text:{name:"text"}},outputs:{0:{tooltip:null}}},PhotoMakerLoader={display_name:"PhotoMakerLoader",inputs:{photomaker_model_name:{name:"photomaker_model_name"}},outputs:{0:{tooltip:null}}},Pikadditions={display_name:"Pikadditions (Video Object Insertion)",description:"Add any object or image into your video. Upload a video and specify what you'd like to add to create a seamlessly integrated result.",inputs:{video:{name:"video",tooltip:"The video to add an image to."},image:{name:"image",tooltip:"The image to add to the video."},prompt_text:{name:"prompt_text"},negative_prompt:{name:"negative_prompt"},seed:{name:"seed"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},Pikaffects={display_name:"Pikaffects (Video Effects)",description:"Generate a video with a specific Pikaffect. Supported Pikaffects: Cake-ify, Crumble, Crush, Decapitate, Deflate, Dissolve, Explode, Eye-pop, Inflate, Levitate, Melt, Peel, Poke, Squish, Ta-da, Tear",inputs:{image:{name:"image",tooltip:"The reference image to apply the Pikaffect to."},pikaffect:{name:"pikaffect"},prompt_text:{name:"prompt_text"},negative_prompt:{name:"negative_prompt"},seed:{name:"seed"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},PikaImageToVideoNode2_2={display_name:"Pika Image to Video",description:"Sends an image and prompt to the Pika API v2.2 to generate a video.",inputs:{image:{name:"image",tooltip:"The image to convert to video"},prompt_text:{name:"prompt_text"},negative_prompt:{name:"negative_prompt"},seed:{name:"seed"},resolution:{name:"resolution"},duration:{name:"duration"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},PikaScenesV2_2={display_name:"Pika Scenes (Video Image Composition)",description:"Combine your images to create a video with the objects in them. Upload multiple images as ingredients and generate a high-quality video that incorporates all of them.",inputs:{prompt_text:{name:"prompt_text"},negative_prompt:{name:"negative_prompt"},seed:{name:"seed"},resolution:{name:"resolution"},duration:{name:"duration"},ingredients_mode:{name:"ingredients_mode"},aspect_ratio:{name:"aspect_ratio",tooltip:"Aspect ratio (width / height)"},image_ingredient_1:{name:"image_ingredient_1",tooltip:"Image that will be used as ingredient to create a video."},image_ingredient_2:{name:"image_ingredient_2",tooltip:"Image that will be used as ingredient to create a video."},image_ingredient_3:{name:"image_ingredient_3",tooltip:"Image that will be used as ingredient to create a video."},image_ingredient_4:{name:"image_ingredient_4",tooltip:"Image that will be used as ingredient to create a video."},image_ingredient_5:{name:"image_ingredient_5",tooltip:"Image that will be used as ingredient to create a video."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},PikaStartEndFrameNode2_2={display_name:"Pika Start and End Frame to Video",description:"Generate a video by combining your first and last frame. Upload two images to define the start and end points, and let the AI create a smooth transition between them.",inputs:{image_start:{name:"image_start",tooltip:"The first image to combine."},image_end:{name:"image_end",tooltip:"The last image to combine."},prompt_text:{name:"prompt_text"},negative_prompt:{name:"negative_prompt"},seed:{name:"seed"},resolution:{name:"resolution"},duration:{name:"duration"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},Pikaswaps={display_name:"Pika Swaps (Video Object Replacement)",description:"Swap out any object or region of your video with a new image or object. Define areas to replace either with a mask or coordinates.",inputs:{video:{name:"video",tooltip:"The video to swap an object in."},image:{name:"image",tooltip:"The image used to replace the masked object in the video."},mask:{name:"mask",tooltip:"Use the mask to define areas in the video to replace."},prompt_text:{name:"prompt_text"},negative_prompt:{name:"negative_prompt"},seed:{name:"seed"},region_to_modify:{name:"region_to_modify",tooltip:"Plaintext description of the object / region to modify."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},PikaTextToVideoNode2_2={display_name:"Pika Text to Video",description:"Sends a text prompt to the Pika API v2.2 to generate a video.",inputs:{prompt_text:{name:"prompt_text"},negative_prompt:{name:"negative_prompt"},seed:{name:"seed"},resolution:{name:"resolution"},duration:{name:"duration"},aspect_ratio:{name:"aspect_ratio",tooltip:"Aspect ratio (width / height)"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},PixverseImageToVideoNode={display_name:"PixVerse Image to Video",description:"Generates videos based on prompt and output_size.",inputs:{image:{name:"image"},prompt:{name:"prompt",tooltip:"Prompt for the video generation"},quality:{name:"quality"},duration_seconds:{name:"duration_seconds"},motion_mode:{name:"motion_mode"},seed:{name:"seed",tooltip:"Seed for video generation."},negative_prompt:{name:"negative_prompt",tooltip:"An optional text description of undesired elements on an image."},pixverse_template:{name:"pixverse_template",tooltip:"An optional template to influence style of generation, created by the PixVerse Template node."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},PixverseTemplateNode={display_name:"PixVerse Template",inputs:{template:{name:"template"}},outputs:{0:{name:"pixverse_template",tooltip:null}}},PixverseTextToVideoNode={display_name:"PixVerse Text to Video",description:"Generates videos based on prompt and output_size.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the video generation"},aspect_ratio:{name:"aspect_ratio"},quality:{name:"quality"},duration_seconds:{name:"duration_seconds"},motion_mode:{name:"motion_mode"},seed:{name:"seed",tooltip:"Seed for video generation."},negative_prompt:{name:"negative_prompt",tooltip:"An optional text description of undesired elements on an image."},pixverse_template:{name:"pixverse_template",tooltip:"An optional template to influence style of generation, created by the PixVerse Template node."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},PixverseTransitionVideoNode={display_name:"PixVerse Transition Video",description:"Generates videos based on prompt and output_size.",inputs:{first_frame:{name:"first_frame"},last_frame:{name:"last_frame"},prompt:{name:"prompt",tooltip:"Prompt for the video generation"},quality:{name:"quality"},duration_seconds:{name:"duration_seconds"},motion_mode:{name:"motion_mode"},seed:{name:"seed",tooltip:"Seed for video generation."},negative_prompt:{name:"negative_prompt",tooltip:"An optional text description of undesired elements on an image."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},PolyexponentialScheduler={display_name:"PolyexponentialScheduler",inputs:{steps:{name:"steps"},sigma_max:{name:"sigma_max"},sigma_min:{name:"sigma_min"},rho:{name:"rho"}}},PorterDuffImageComposite={display_name:"Porter-Duff Image Composite",inputs:{source:{name:"source"},source_alpha:{name:"source_alpha"},destination:{name:"destination"},destination_alpha:{name:"destination_alpha"},mode:{name:"mode"}},outputs:{0:{tooltip:null},1:{tooltip:null}}},Preview3D={display_name:"Preview 3D",inputs:{model_file:{name:"model_file"},camera_info:{name:"camera_info"},image:{name:"image"}}},Preview3DAnimation={display_name:"Preview 3D - Animation",inputs:{model_file:{name:"model_file"},camera_info:{name:"camera_info"}}},PreviewAny={display_name:"Preview as Text",inputs:{source:{name:"source"},preview:{}}},PreviewAudio={display_name:"Preview Audio",inputs:{audio:{name:"audio"},audioUI:{name:"audioUI"}}},PreviewImage={display_name:"Preview Image",description:"Saves the input images to your ComfyUI output directory.",inputs:{images:{name:"images"}}},PrimitiveBoolean={display_name:"Boolean",inputs:{value:{name:"value"}},outputs:{0:{tooltip:null}}},PrimitiveFloat={display_name:"Float",inputs:{value:{name:"value"}},outputs:{0:{tooltip:null}}},PrimitiveInt={display_name:"Int",inputs:{value:{name:"value"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},PrimitiveString={display_name:"String",inputs:{value:{name:"value"}},outputs:{0:{tooltip:null}}},PrimitiveStringMultiline={display_name:"String (Multiline)",inputs:{value:{name:"value"}},outputs:{0:{tooltip:null}}},QuadrupleCLIPLoader={display_name:"QuadrupleCLIPLoader",description:`[Recipes]

hidream: long clip-l, long clip-g, t5xxl, llama_8b_3.1_instruct`,inputs:{clip_name1:{name:"clip_name1"},clip_name2:{name:"clip_name2"},clip_name3:{name:"clip_name3"},clip_name4:{name:"clip_name4"}},outputs:{0:{tooltip:null}}},QwenImageDiffsynthControlnet={display_name:"QwenImageDiffsynthControlnet",inputs:{model:{name:"model"},model_patch:{name:"model_patch"},vae:{name:"vae"},image:{name:"image"},strength:{name:"strength"},mask:{name:"mask"}}},RandomNoise={display_name:"RandomNoise",inputs:{noise_seed:{name:"noise_seed"},control_after_generate:{name:"control after generate"}}},RebatchImages={display_name:"Rebatch Images",inputs:{images:{name:"images"},batch_size:{name:"batch_size"}},outputs:{0:{tooltip:null}}},RebatchLatents={display_name:"Rebatch Latents",inputs:{latents:{name:"latents"},batch_size:{name:"batch_size"}},outputs:{0:{tooltip:null}}},RecordAudio={display_name:"Record Audio",inputs:{audio:{name:"audio"}}},RecraftColorRGB={display_name:"Recraft Color RGB",description:"Create Recraft Color by choosing specific RGB values.",inputs:{r:{name:"r",tooltip:"Red value of color."},g:{name:"g",tooltip:"Green value of color."},b:{name:"b",tooltip:"Blue value of color."},recraft_color:{name:"recraft_color"}},outputs:{0:{name:"recraft_color",tooltip:null}}},RecraftControls={display_name:"Recraft Controls",description:"Create Recraft Controls for customizing Recraft generation.",inputs:{colors:{name:"colors"},background_color:{name:"background_color"}},outputs:{0:{name:"recraft_controls",tooltip:null}}},RecraftCreativeUpscaleNode={display_name:"Recraft Creative Upscale Image",description:`Upscale image synchronously.
Enhances a given raster image using â€˜creative upscaleâ€™ tool, boosting resolution with a focus on refining small details and faces.`,inputs:{image:{name:"image"}},outputs:{0:{tooltip:null}}},RecraftCrispUpscaleNode={display_name:"Recraft Crisp Upscale Image",description:`Upscale image synchronously.
Enhances a given raster image using â€˜crisp upscaleâ€™ tool, increasing image resolution, making the image sharper and cleaner.`,inputs:{image:{name:"image"}},outputs:{0:{tooltip:null}}},RecraftImageInpaintingNode={display_name:"Recraft Image Inpainting",description:"Modify image based on prompt and mask.",inputs:{image:{name:"image"},mask:{name:"mask"},prompt:{name:"prompt",tooltip:"Prompt for the image generation."},n:{name:"n",tooltip:"The number of images to generate."},seed:{name:"seed",tooltip:"Seed to determine if node should re-run; actual results are nondeterministic regardless of seed."},recraft_style:{name:"recraft_style"},negative_prompt:{name:"negative_prompt",tooltip:"An optional text description of undesired elements on an image."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},RecraftImageToImageNode={display_name:"Recraft Image to Image",description:"Modify image based on prompt and strength.",inputs:{image:{name:"image"},prompt:{name:"prompt",tooltip:"Prompt for the image generation."},n:{name:"n",tooltip:"The number of images to generate."},strength:{name:"strength",tooltip:"Defines the difference with the original image, should lie in [0, 1], where 0 means almost identical, and 1 means miserable similarity."},seed:{name:"seed",tooltip:"Seed to determine if node should re-run; actual results are nondeterministic regardless of seed."},recraft_style:{name:"recraft_style"},negative_prompt:{name:"negative_prompt",tooltip:"An optional text description of undesired elements on an image."},recraft_controls:{name:"recraft_controls",tooltip:"Optional additional controls over the generation via the Recraft Controls node."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},RecraftRemoveBackgroundNode={display_name:"Recraft Remove Background",description:"Remove background from image, and return processed image and mask.",inputs:{image:{name:"image"}},outputs:{0:{tooltip:null},1:{tooltip:null}}},RecraftReplaceBackgroundNode={display_name:"Recraft Replace Background",description:"Replace background on image, based on provided prompt.",inputs:{image:{name:"image"},prompt:{name:"prompt",tooltip:"Prompt for the image generation."},n:{name:"n",tooltip:"The number of images to generate."},seed:{name:"seed",tooltip:"Seed to determine if node should re-run; actual results are nondeterministic regardless of seed."},recraft_style:{name:"recraft_style"},negative_prompt:{name:"negative_prompt",tooltip:"An optional text description of undesired elements on an image."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},RecraftStyleV3DigitalIllustration={display_name:"Recraft Style - Digital Illustration",description:"Select realistic_image style and optional substyle.",inputs:{substyle:{name:"substyle"}},outputs:{0:{name:"recraft_style",tooltip:null}}},RecraftStyleV3InfiniteStyleLibrary={display_name:"Recraft Style - Infinite Style Library",description:"Select style based on preexisting UUID from Recraft's Infinite Style Library.",inputs:{style_id:{name:"style_id",tooltip:"UUID of style from Infinite Style Library."}},outputs:{0:{name:"recraft_style",tooltip:null}}},RecraftStyleV3LogoRaster={display_name:"Recraft Style - Logo Raster",description:"Select realistic_image style and optional substyle.",inputs:{substyle:{name:"substyle"}},outputs:{0:{name:"recraft_style",tooltip:null}}},RecraftStyleV3RealisticImage={display_name:"Recraft Style - Realistic Image",description:"Select realistic_image style and optional substyle.",inputs:{substyle:{name:"substyle"}},outputs:{0:{name:"recraft_style",tooltip:null}}},RecraftTextToImageNode={display_name:"Recraft Text to Image",description:"Generates images synchronously based on prompt and resolution.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the image generation."},size:{name:"size",tooltip:"The size of the generated image."},n:{name:"n",tooltip:"The number of images to generate."},seed:{name:"seed",tooltip:"Seed to determine if node should re-run; actual results are nondeterministic regardless of seed."},recraft_style:{name:"recraft_style"},negative_prompt:{name:"negative_prompt",tooltip:"An optional text description of undesired elements on an image."},recraft_controls:{name:"recraft_controls",tooltip:"Optional additional controls over the generation via the Recraft Controls node."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},RecraftTextToVectorNode={display_name:"Recraft Text to Vector",description:"Generates SVG synchronously based on prompt and resolution.",inputs:{prompt:{name:"prompt",tooltip:"Prompt for the image generation."},substyle:{name:"substyle"},size:{name:"size",tooltip:"The size of the generated image."},n:{name:"n",tooltip:"The number of images to generate."},seed:{name:"seed",tooltip:"Seed to determine if node should re-run; actual results are nondeterministic regardless of seed."},negative_prompt:{name:"negative_prompt",tooltip:"An optional text description of undesired elements on an image."},recraft_controls:{name:"recraft_controls",tooltip:"Optional additional controls over the generation via the Recraft Controls node."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},RecraftVectorizeImageNode={display_name:"Recraft Vectorize Image",description:"Generates SVG synchronously from an input image.",inputs:{image:{name:"image"}},outputs:{0:{tooltip:null}}},ReferenceLatent={display_name:"ReferenceLatent",description:"This node sets the guiding latent for an edit model. If the model supports it you can chain multiple to set multiple reference images.",inputs:{conditioning:{name:"conditioning"},latent:{name:"latent"}},outputs:{0:{tooltip:null}}},RegexExtract={display_name:"Regex Extract",inputs:{string:{name:"string"},regex_pattern:{name:"regex_pattern"},mode:{name:"mode"},case_insensitive:{name:"case_insensitive"},multiline:{name:"multiline"},dotall:{name:"dotall"},group_index:{name:"group_index"}},outputs:{0:{tooltip:null}}},RegexMatch={display_name:"Regex Match",inputs:{string:{name:"string"},regex_pattern:{name:"regex_pattern"},case_insensitive:{name:"case_insensitive"},multiline:{name:"multiline"},dotall:{name:"dotall"}},outputs:{0:{name:"matches",tooltip:null}}},RegexReplace={display_name:"Regex Replace",description:"Find and replace text using regex patterns.",inputs:{string:{name:"string"},regex_pattern:{name:"regex_pattern"},replace:{name:"replace"},case_insensitive:{name:"case_insensitive"},multiline:{name:"multiline"},dotall:{name:"dotall",tooltip:"When enabled, the dot (.) character will match any character including newline characters. When disabled, dots won't match newlines."},count:{name:"count",tooltip:"Maximum number of replacements to make. Set to 0 to replace all occurrences (default). Set to 1 to replace only the first match, 2 for the first two matches, etc."}},outputs:{0:{tooltip:null}}},RenormCFG={display_name:"RenormCFG",inputs:{model:{name:"model"},cfg_trunc:{name:"cfg_trunc"},renorm_cfg:{name:"renorm_cfg"}},outputs:{0:{tooltip:null}}},RepeatImageBatch={display_name:"RepeatImageBatch",inputs:{image:{name:"image"},amount:{name:"amount"}}},RepeatLatentBatch={display_name:"Repeat Latent Batch",inputs:{samples:{name:"samples"},amount:{name:"amount"}}},RescaleCFG={display_name:"RescaleCFG",inputs:{model:{name:"model"},multiplier:{name:"multiplier"}}},ResizeAndPadImage={display_name:"ResizeAndPadImage",inputs:{image:{name:"image"},target_width:{name:"target_width"},target_height:{name:"target_height"},padding_color:{name:"padding_color"},interpolation:{name:"interpolation"}}},Rodin3D_Detail={display_name:"Rodin 3D Generate - Detail Generate",description:"Generate 3D Assets using Rodin API",inputs:{Images:{name:"Images"},Seed:{name:"Seed"},Material_Type:{name:"Material_Type"},Polygon_count:{name:"Polygon_count"}},outputs:{0:{name:"3D Model Path",tooltip:null}}},Rodin3D_Gen2={display_name:"Rodin 3D Generate - Gen-2 Generate",description:"Generate 3D Assets using Rodin API",inputs:{Images:{name:"Images"},TAPose:{name:"TAPose"},Seed:{name:"Seed"},Material_Type:{name:"Material_Type"},Polygon_count:{name:"Polygon_count"}},outputs:{0:{name:"3D Model Path",tooltip:null}}},Rodin3D_Regular={display_name:"Rodin 3D Generate - Regular Generate",description:"Generate 3D Assets using Rodin API",inputs:{Images:{name:"Images"},Seed:{name:"Seed"},Material_Type:{name:"Material_Type"},Polygon_count:{name:"Polygon_count"}},outputs:{0:{name:"3D Model Path",tooltip:null}}},Rodin3D_Sketch={display_name:"Rodin 3D Generate - Sketch Generate",description:"Generate 3D Assets using Rodin API",inputs:{Images:{name:"Images"},Seed:{name:"Seed"}},outputs:{0:{name:"3D Model Path",tooltip:null}}},Rodin3D_Smooth={display_name:"Rodin 3D Generate - Smooth Generate",description:"Generate 3D Assets using Rodin API",inputs:{Images:{name:"Images"},Seed:{name:"Seed"},Material_Type:{name:"Material_Type"},Polygon_count:{name:"Polygon_count"}},outputs:{0:{name:"3D Model Path",tooltip:null}}},RunwayFirstLastFrameNode={display_name:"Runway First-Last-Frame to Video",description:"Upload first and last keyframes, draft a prompt, and generate a video. More complex transitions, such as cases where the Last frame is completely different from the First frame, may benefit from the longer 10s duration. This would give the generation more time to smoothly transition between the two inputs. Before diving in, review these best practices to ensure that your input selections will set your generation up for success: https://help.runwayml.com/hc/en-us/articles/34170748696595-Creating-with-Keyframes-on-Gen-3.",inputs:{prompt:{name:"prompt",tooltip:"Text prompt for the generation"},start_frame:{name:"start_frame",tooltip:"Start frame to be used for the video"},end_frame:{name:"end_frame",tooltip:"End frame to be used for the video. Supported for gen3a_turbo only."},duration:{name:"duration"},ratio:{name:"ratio"},seed:{name:"seed",tooltip:"Random seed for generation"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},RunwayImageToVideoNodeGen3a={display_name:"Runway Image to Video (Gen3a Turbo)",description:"Generate a video from a single starting frame using Gen3a Turbo model. Before diving in, review these best practices to ensure that your input selections will set your generation up for success: https://help.runwayml.com/hc/en-us/articles/33927968552339-Creating-with-Act-One-on-Gen-3-Alpha-and-Turbo.",inputs:{prompt:{name:"prompt",tooltip:"Text prompt for the generation"},start_frame:{name:"start_frame",tooltip:"Start frame to be used for the video"},duration:{name:"duration"},ratio:{name:"ratio"},seed:{name:"seed",tooltip:"Random seed for generation"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},RunwayImageToVideoNodeGen4={display_name:"Runway Image to Video (Gen4 Turbo)",description:"Generate a video from a single starting frame using Gen4 Turbo model. Before diving in, review these best practices to ensure that your input selections will set your generation up for success: https://help.runwayml.com/hc/en-us/articles/37327109429011-Creating-with-Gen-4-Video.",inputs:{prompt:{name:"prompt",tooltip:"Text prompt for the generation"},start_frame:{name:"start_frame",tooltip:"Start frame to be used for the video"},duration:{name:"duration"},ratio:{name:"ratio"},seed:{name:"seed",tooltip:"Random seed for generation"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},RunwayTextToImageNode={display_name:"Runway Text to Image",description:"Generate an image from a text prompt using Runway's Gen 4 model. You can also include reference image to guide the generation.",inputs:{prompt:{name:"prompt",tooltip:"Text prompt for the generation"},ratio:{name:"ratio"},reference_image:{name:"reference_image",tooltip:"Optional reference image to guide the generation"}},outputs:{0:{tooltip:null}}},SamplerCustom={display_name:"SamplerCustom",inputs:{model:{name:"model"},add_noise:{name:"add_noise"},noise_seed:{name:"noise_seed"},cfg:{name:"cfg"},positive:{name:"positive"},negative:{name:"negative"},sampler:{name:"sampler"},sigmas:{name:"sigmas"},latent_image:{name:"latent_image"},control_after_generate:{name:"control after generate"}},outputs:{0:{name:"output"},1:{name:"denoised_output"}}},SamplerCustomAdvanced={display_name:"SamplerCustomAdvanced",inputs:{noise:{name:"noise"},guider:{name:"guider"},sampler:{name:"sampler"},sigmas:{name:"sigmas"},latent_image:{name:"latent_image"}},outputs:{0:{name:"output"},1:{name:"denoised_output"}}},SamplerDPMAdaptative={display_name:"SamplerDPMAdaptative",inputs:{order:{name:"order"},rtol:{name:"rtol"},atol:{name:"atol"},h_init:{name:"h_init"},pcoeff:{name:"pcoeff"},icoeff:{name:"icoeff"},dcoeff:{name:"dcoeff"},accept_safety:{name:"accept_safety"},eta:{name:"eta"},s_noise:{name:"s_noise"}}},SamplerDPMPP_2M_SDE={display_name:"SamplerDPMPP_2M_SDE",inputs:{solver_type:{name:"solver_type"},eta:{name:"eta"},s_noise:{name:"s_noise"},noise_device:{name:"noise_device"}}},SamplerDPMPP_2S_Ancestral={display_name:"SamplerDPMPP_2S_Ancestral",inputs:{eta:{name:"eta"},s_noise:{name:"s_noise"}}},SamplerDPMPP_3M_SDE={display_name:"SamplerDPMPP_3M_SDE",inputs:{eta:{name:"eta"},s_noise:{name:"s_noise"},noise_device:{name:"noise_device"}}},SamplerDPMPP_SDE={display_name:"SamplerDPMPP_SDE",inputs:{eta:{name:"eta"},s_noise:{name:"s_noise"},r:{name:"r"},noise_device:{name:"noise_device"}}},SamplerER_SDE={display_name:"SamplerER_SDE",inputs:{solver_type:{name:"solver_type"},max_stage:{name:"max_stage"},eta:{name:"eta",tooltip:`Stochastic strength of reverse-time SDE.
When eta=0, it reduces to deterministic ODE. This setting doesn't apply to ER-SDE solver type.`},s_noise:{name:"s_noise"}}},SamplerEulerAncestral={display_name:"SamplerEulerAncestral",inputs:{eta:{name:"eta"},s_noise:{name:"s_noise"}}},SamplerEulerAncestralCFGPP={display_name:"SamplerEulerAncestralCFG++",inputs:{eta:{name:"eta"},s_noise:{name:"s_noise"}}},SamplerEulerCFGpp={display_name:"SamplerEulerCFG++",inputs:{version:{name:"version"}},outputs:{0:{tooltip:null}}},SamplerLCMUpscale={display_name:"SamplerLCMUpscale",inputs:{scale_ratio:{name:"scale_ratio"},scale_steps:{name:"scale_steps"},upscale_method:{name:"upscale_method"}},outputs:{0:{tooltip:null}}},SamplerLMS={display_name:"SamplerLMS",inputs:{order:{name:"order"}}},SamplerSASolver={display_name:"SamplerSASolver",inputs:{model:{name:"model"},eta:{name:"eta"},sde_start_percent:{name:"sde_start_percent"},sde_end_percent:{name:"sde_end_percent"},s_noise:{name:"s_noise"},predictor_order:{name:"predictor_order"},corrector_order:{name:"corrector_order"},use_pece:{name:"use_pece"},simple_order_2:{name:"simple_order_2"}}},SamplingPercentToSigma={display_name:"SamplingPercentToSigma",inputs:{model:{name:"model"},sampling_percent:{name:"sampling_percent"},return_actual_sigma:{name:"return_actual_sigma",tooltip:`Return the actual sigma value instead of the value used for interval checks.
This only affects results at 0.0 and 1.0.`}},outputs:{0:{name:"sigma_value"}}},SaveAnimatedPNG={display_name:"SaveAnimatedPNG",inputs:{images:{name:"images"},filename_prefix:{name:"filename_prefix"},fps:{name:"fps"},compress_level:{name:"compress_level"}}},SaveAnimatedWEBP={display_name:"SaveAnimatedWEBP",inputs:{images:{name:"images"},filename_prefix:{name:"filename_prefix"},fps:{name:"fps"},lossless:{name:"lossless"},quality:{name:"quality"},method:{name:"method"}}},SaveAudio={display_name:"Save Audio (FLAC)",inputs:{audio:{name:"audio"},filename_prefix:{name:"filename_prefix"},audioUI:{name:"audioUI"}}},SaveAudioMP3={display_name:"Save Audio (MP3)",inputs:{audio:{name:"audio"},filename_prefix:{name:"filename_prefix"},quality:{name:"quality"},audioUI:{name:"audioUI"}}},SaveAudioOpus={display_name:"Save Audio (Opus)",inputs:{audio:{name:"audio"},filename_prefix:{name:"filename_prefix"},quality:{name:"quality"},audioUI:{name:"audioUI"}}},SaveGLB={display_name:"SaveGLB",inputs:{mesh:{name:"mesh"},filename_prefix:{name:"filename_prefix"},image:{name:"image"}}},SaveImage={display_name:"Save Image",description:"Saves the input images to your ComfyUI output directory.",inputs:{images:{name:"images",tooltip:"The images to save."},filename_prefix:{name:"filename_prefix",tooltip:"The prefix for the file to save. This may include formatting information such as %date:yyyy-MM-dd% or %Empty Latent Image.width% to include values from nodes."}}},SaveImageWebsocket={display_name:"SaveImageWebsocket",inputs:{images:{name:"images"}}},SaveLatent={display_name:"SaveLatent",inputs:{samples:{name:"samples"},filename_prefix:{name:"filename_prefix"}}},SaveLoRANode={display_name:"Save LoRA Weights",inputs:{lora:{name:"lora",tooltip:"The LoRA model to save. Do not use the model with LoRA layers."},prefix:{name:"prefix",tooltip:"The prefix to use for the saved LoRA file."},steps:{name:"steps",tooltip:"Optional: The number of steps to LoRA has been trained for, used to name the saved file."}}},SaveSVGNode={display_name:"SaveSVGNode",description:"Save SVG files on disk.",inputs:{svg:{name:"svg"},filename_prefix:{name:"filename_prefix",tooltip:"The prefix for the file to save. This may include formatting information such as %date:yyyy-MM-dd% or %Empty Latent Image.width% to include values from nodes."}}},SaveVideo={display_name:"Save Video",description:"Saves the input images to your ComfyUI output directory.",inputs:{video:{name:"video",tooltip:"The video to save."},filename_prefix:{name:"filename_prefix",tooltip:"The prefix for the file to save. This may include formatting information such as %date:yyyy-MM-dd% or %Empty Latent Image.width% to include values from nodes."},format:{name:"format",tooltip:"The format to save the video as."},codec:{name:"codec",tooltip:"The codec to use for the video."}}},SaveWEBM={display_name:"SaveWEBM",inputs:{images:{name:"images"},filename_prefix:{name:"filename_prefix"},codec:{name:"codec"},fps:{name:"fps"},crf:{name:"crf",tooltip:"Higher crf means lower quality with a smaller file size, lower crf means higher quality higher filesize."}}},ScaleROPE={display_name:"ScaleROPE",description:"Scale and shift the ROPE of the model.",inputs:{model:{name:"model"},scale_x:{name:"scale_x"},shift_x:{name:"shift_x"},scale_y:{name:"scale_y"},shift_y:{name:"shift_y"},scale_t:{name:"scale_t"},shift_t:{name:"shift_t"}},outputs:{0:{tooltip:null}}},SD_4XUpscale_Conditioning={display_name:"SD_4XUpscale_Conditioning",inputs:{images:{name:"images"},positive:{name:"positive"},negative:{name:"negative"},scale_ratio:{name:"scale_ratio"},noise_augmentation:{name:"noise_augmentation"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},SDTurboScheduler={display_name:"SDTurboScheduler",inputs:{model:{name:"model"},steps:{name:"steps"},denoise:{name:"denoise"}}},SelfAttentionGuidance={display_name:"Self-Attention Guidance",inputs:{model:{name:"model"},scale:{name:"scale"},blur_sigma:{name:"blur_sigma"}},outputs:{0:{tooltip:null}}},SetClipHooks={display_name:"Set CLIP Hooks",inputs:{clip:{name:"clip"},apply_to_conds:{name:"apply_to_conds"},schedule_clip:{name:"schedule_clip"},hooks:{name:"hooks"}}},SetFirstSigma={display_name:"SetFirstSigma",inputs:{sigmas:{name:"sigmas"},sigma:{name:"sigma"}}},SetHookKeyframes={display_name:"Set Hook Keyframes",inputs:{hooks:{name:"hooks"},hook_kf:{name:"hook_kf"}}},SetLatentNoiseMask={display_name:"Set Latent Noise Mask",inputs:{samples:{name:"samples"},mask:{name:"mask"}}},SetUnionControlNetType={display_name:"SetUnionControlNetType",inputs:{control_net:{name:"control_net"},type:{name:"type"}},outputs:{0:{tooltip:null}}},SkipLayerGuidanceDiT={display_name:"SkipLayerGuidanceDiT",description:"Generic version of SkipLayerGuidance node that can be used on every DiT model.",inputs:{model:{name:"model"},double_layers:{name:"double_layers"},single_layers:{name:"single_layers"},scale:{name:"scale"},start_percent:{name:"start_percent"},end_percent:{name:"end_percent"},rescaling_scale:{name:"rescaling_scale"}},outputs:{0:{tooltip:null}}},SkipLayerGuidanceDiTSimple={display_name:"SkipLayerGuidanceDiTSimple",description:"Simple version of the SkipLayerGuidanceDiT node that only modifies the uncond pass.",inputs:{model:{name:"model"},double_layers:{name:"double_layers"},single_layers:{name:"single_layers"},start_percent:{name:"start_percent"},end_percent:{name:"end_percent"}},outputs:{0:{tooltip:null}}},SkipLayerGuidanceSD3={display_name:"SkipLayerGuidanceSD3",description:"Generic version of SkipLayerGuidance node that can be used on every DiT model.",inputs:{model:{name:"model"},layers:{name:"layers"},scale:{name:"scale"},start_percent:{name:"start_percent"},end_percent:{name:"end_percent"}},outputs:{0:{tooltip:null}}},SolidMask={display_name:"SolidMask",inputs:{value:{name:"value"},width:{name:"width"},height:{name:"height"}}},SplitAudioChannels={display_name:"Split Audio Channels",description:"Separates the audio into left and right channels.",inputs:{audio:{name:"audio"}},outputs:{0:{name:"left"},1:{name:"right"}}},SplitImageWithAlpha={display_name:"Split Image with Alpha",inputs:{image:{name:"image"}},outputs:{0:{tooltip:null},1:{tooltip:null}}},SplitSigmas={display_name:"SplitSigmas",inputs:{sigmas:{name:"sigmas"},step:{name:"step"}},outputs:{0:{name:"high_sigmas"},1:{name:"low_sigmas"}}},SplitSigmasDenoise={display_name:"SplitSigmasDenoise",inputs:{sigmas:{name:"sigmas"},denoise:{name:"denoise"}},outputs:{0:{name:"high_sigmas"},1:{name:"low_sigmas"}}},StabilityAudioInpaint={display_name:"Stability AI Audio Inpaint",description:"Transforms part of existing audio sample using text instructions.",inputs:{model:{name:"model"},prompt:{name:"prompt"},audio:{name:"audio",tooltip:"Audio must be between 6 and 190 seconds long."},duration:{name:"duration",tooltip:"Controls the duration in seconds of the generated audio."},seed:{name:"seed",tooltip:"The random seed used for generation."},steps:{name:"steps",tooltip:"Controls the number of sampling steps."},mask_start:{name:"mask_start"},mask_end:{name:"mask_end"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},StabilityAudioToAudio={display_name:"Stability AI Audio To Audio",description:"Transforms existing audio samples into new high-quality compositions using text instructions.",inputs:{model:{name:"model"},prompt:{name:"prompt"},audio:{name:"audio",tooltip:"Audio must be between 6 and 190 seconds long."},duration:{name:"duration",tooltip:"Controls the duration in seconds of the generated audio."},seed:{name:"seed",tooltip:"The random seed used for generation."},steps:{name:"steps",tooltip:"Controls the number of sampling steps."},strength:{name:"strength",tooltip:"Parameter controls how much influence the audio parameter has on the generated audio."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},StabilityStableImageSD_3_5Node={display_name:"Stability AI Stable Diffusion 3.5 Image",description:"Generates images synchronously based on prompt and resolution.",inputs:{prompt:{name:"prompt",tooltip:"What you wish to see in the output image. A strong, descriptive prompt that clearly defines elements, colors, and subjects will lead to better results."},model:{name:"model"},aspect_ratio:{name:"aspect_ratio",tooltip:"Aspect ratio of generated image."},style_preset:{name:"style_preset",tooltip:"Optional desired style of generated image."},cfg_scale:{name:"cfg_scale",tooltip:"How strictly the diffusion process adheres to the prompt text (higher values keep your image closer to your prompt)"},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},image:{name:"image"},negative_prompt:{name:"negative_prompt",tooltip:"Keywords of what you do not wish to see in the output image. This is an advanced feature."},image_denoise:{name:"image_denoise",tooltip:"Denoise of input image; 0.0 yields image identical to input, 1.0 is as if no image was provided at all."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},StabilityStableImageUltraNode={display_name:"Stability AI Stable Image Ultra",description:"Generates images synchronously based on prompt and resolution.",inputs:{prompt:{name:"prompt",tooltip:"What you wish to see in the output image. A strong, descriptive prompt that clearly defineselements, colors, and subjects will lead to better results. To control the weight of a given word use the format `(word:weight)`,where `word` is the word you'd like to control the weight of and `weight`is a value between 0 and 1. For example: `The sky was a crisp (blue:0.3) and (green:0.8)`would convey a sky that was blue and green, but more green than blue."},aspect_ratio:{name:"aspect_ratio",tooltip:"Aspect ratio of generated image."},style_preset:{name:"style_preset",tooltip:"Optional desired style of generated image."},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},image:{name:"image"},negative_prompt:{name:"negative_prompt",tooltip:"A blurb of text describing what you do not wish to see in the output image. This is an advanced feature."},image_denoise:{name:"image_denoise",tooltip:"Denoise of input image; 0.0 yields image identical to input, 1.0 is as if no image was provided at all."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},StabilityTextToAudio={display_name:"Stability AI Text To Audio",description:"Generates high-quality music and sound effects from text descriptions.",inputs:{model:{name:"model"},prompt:{name:"prompt"},duration:{name:"duration",tooltip:"Controls the duration in seconds of the generated audio."},seed:{name:"seed",tooltip:"The random seed used for generation."},steps:{name:"steps",tooltip:"Controls the number of sampling steps."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},StabilityUpscaleConservativeNode={display_name:"Stability AI Upscale Conservative",description:"Upscale image with minimal alterations to 4K resolution.",inputs:{image:{name:"image"},prompt:{name:"prompt",tooltip:"What you wish to see in the output image. A strong, descriptive prompt that clearly defines elements, colors, and subjects will lead to better results."},creativity:{name:"creativity",tooltip:"Controls the likelihood of creating additional details not heavily conditioned by the init image."},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},negative_prompt:{name:"negative_prompt",tooltip:"Keywords of what you do not wish to see in the output image. This is an advanced feature."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},StabilityUpscaleCreativeNode={display_name:"Stability AI Upscale Creative",description:"Upscale image with minimal alterations to 4K resolution.",inputs:{image:{name:"image"},prompt:{name:"prompt",tooltip:"What you wish to see in the output image. A strong, descriptive prompt that clearly defines elements, colors, and subjects will lead to better results."},creativity:{name:"creativity",tooltip:"Controls the likelihood of creating additional details not heavily conditioned by the init image."},style_preset:{name:"style_preset",tooltip:"Optional desired style of generated image."},seed:{name:"seed",tooltip:"The random seed used for creating the noise."},negative_prompt:{name:"negative_prompt",tooltip:"Keywords of what you do not wish to see in the output image. This is an advanced feature."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},StabilityUpscaleFastNode={display_name:"Stability AI Upscale Fast",description:"Quickly upscales an image via Stability API call to 4x its original size; intended for upscaling low-quality/compressed images.",inputs:{image:{name:"image"}},outputs:{0:{tooltip:null}}},StableCascade_EmptyLatentImage={display_name:"StableCascade_EmptyLatentImage",inputs:{width:{name:"width"},height:{name:"height"},compression:{name:"compression"},batch_size:{name:"batch_size"}},outputs:{0:{name:"stage_c",tooltip:null},1:{name:"stage_b",tooltip:null}}},StableCascade_StageB_Conditioning={display_name:"StableCascade_StageB_Conditioning",inputs:{conditioning:{name:"conditioning"},stage_c:{name:"stage_c"}},outputs:{0:{tooltip:null}}},StableCascade_StageC_VAEEncode={display_name:"StableCascade_StageC_VAEEncode",inputs:{image:{name:"image"},vae:{name:"vae"},compression:{name:"compression"}},outputs:{0:{name:"stage_c",tooltip:null},1:{name:"stage_b",tooltip:null}}},StableCascade_SuperResolutionControlnet={display_name:"StableCascade_SuperResolutionControlnet",inputs:{image:{name:"image"},vae:{name:"vae"}},outputs:{0:{name:"controlnet_input",tooltip:null},1:{name:"stage_c",tooltip:null},2:{name:"stage_b",tooltip:null}}},StableZero123_Conditioning={display_name:"StableZero123_Conditioning",inputs:{clip_vision:{name:"clip_vision"},init_image:{name:"init_image"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},batch_size:{name:"batch_size"},elevation:{name:"elevation"},azimuth:{name:"azimuth"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},StableZero123_Conditioning_Batched={display_name:"StableZero123_Conditioning_Batched",inputs:{clip_vision:{name:"clip_vision"},init_image:{name:"init_image"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},batch_size:{name:"batch_size"},elevation:{name:"elevation"},azimuth:{name:"azimuth"},elevation_batch_increment:{name:"elevation_batch_increment"},azimuth_batch_increment:{name:"azimuth_batch_increment"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},StringCompare={display_name:"Compare",inputs:{string_a:{name:"string_a"},string_b:{name:"string_b"},mode:{name:"mode"},case_sensitive:{name:"case_sensitive"}},outputs:{0:{tooltip:null}}},StringConcatenate={display_name:"Concatenate",inputs:{string_a:{name:"string_a"},string_b:{name:"string_b"},delimiter:{name:"delimiter"}},outputs:{0:{tooltip:null}}},StringContains={display_name:"Contains",inputs:{string:{name:"string"},substring:{name:"substring"},case_sensitive:{name:"case_sensitive"}},outputs:{0:{name:"contains",tooltip:null}}},StringLength={display_name:"Length",inputs:{string:{name:"string"}},outputs:{0:{name:"length",tooltip:null}}},StringReplace={display_name:"Replace",inputs:{string:{name:"string"},find:{name:"find"},replace:{name:"replace"}},outputs:{0:{tooltip:null}}},StringSubstring={display_name:"Substring",inputs:{string:{name:"string"},start:{name:"start"},end:{name:"end"}},outputs:{0:{tooltip:null}}},StringTrim={display_name:"Trim",inputs:{string:{name:"string"},mode:{name:"mode"}},outputs:{0:{tooltip:null}}},StyleModelApply={display_name:"Apply Style Model",inputs:{conditioning:{name:"conditioning"},style_model:{name:"style_model"},clip_vision_output:{name:"clip_vision_output"},strength:{name:"strength"},strength_type:{name:"strength_type"}}},StyleModelLoader={display_name:"Load Style Model",inputs:{style_model_name:{name:"style_model_name"}}},SV3D_Conditioning={display_name:"SV3D_Conditioning",inputs:{clip_vision:{name:"clip_vision"},init_image:{name:"init_image"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},video_frames:{name:"video_frames"},elevation:{name:"elevation"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},SVD_img2vid_Conditioning={display_name:"SVD_img2vid_Conditioning",inputs:{clip_vision:{name:"clip_vision"},init_image:{name:"init_image"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},video_frames:{name:"video_frames"},motion_bucket_id:{name:"motion_bucket_id"},fps:{name:"fps"},augmentation_level:{name:"augmentation_level"}},outputs:{0:{name:"positive"},1:{name:"negative"},2:{name:"latent"}}},T5TokenizerOptions={display_name:"T5TokenizerOptions",inputs:{clip:{name:"clip"},min_padding:{name:"min_padding"},min_length:{name:"min_length"}},outputs:{0:{tooltip:null}}},TCFG={display_name:"Tangential Damping CFG",description:`TCFG â€“ Tangential Damping CFG (2503.18137)

Refine the uncond (negative) to align with the cond (positive) for improving quality.`,inputs:{model:{name:"model"}},outputs:{0:{name:"patched_model",tooltip:null}}},TemporalScoreRescaling={display_name:"TSR - Temporal Score Rescaling",description:`[Post-CFG Function]
TSR - Temporal Score Rescaling (2510.01184)

Rescaling the model's score or noise to steer the sampling diversity.
`,inputs:{model:{name:"model"},tsr_k:{name:"tsr_k",tooltip:`Controls the rescaling strength.
Lower k produces more detailed results; higher k produces smoother results in image generation. Setting k = 1 disables rescaling.`},tsr_sigma:{name:"tsr_sigma",tooltip:`Controls how early rescaling takes effect.
Larger values take effect earlier.`}},outputs:{0:{name:"patched_model",tooltip:null}}},TextEncodeAceStepAudio={display_name:"TextEncodeAceStepAudio",inputs:{clip:{name:"clip"},tags:{name:"tags"},lyrics:{name:"lyrics"},lyrics_strength:{name:"lyrics_strength"}},outputs:{0:{tooltip:null}}},TextEncodeHunyuanVideo_ImageToVideo={display_name:"TextEncodeHunyuanVideo_ImageToVideo",inputs:{clip:{name:"clip"},clip_vision_output:{name:"clip_vision_output"},prompt:{name:"prompt"},image_interleave:{name:"image_interleave",tooltip:"How much the image influences things vs the text prompt. Higher number means more influence from the text prompt."}},outputs:{0:{tooltip:null}}},TextEncodeQwenImageEdit={display_name:"TextEncodeQwenImageEdit",inputs:{clip:{name:"clip"},prompt:{name:"prompt"},vae:{name:"vae"},image:{name:"image"}},outputs:{0:{tooltip:null}}},TextEncodeQwenImageEditPlus={display_name:"TextEncodeQwenImageEditPlus",inputs:{clip:{name:"clip"},prompt:{name:"prompt"},vae:{name:"vae"},image1:{name:"image1"},image2:{name:"image2"},image3:{name:"image3"}},outputs:{0:{tooltip:null}}},ThresholdMask={display_name:"ThresholdMask",inputs:{mask:{name:"mask"},value:{name:"value"}}},TomePatchModel={display_name:"TomePatchModel",inputs:{model:{name:"model"},ratio:{name:"ratio"}},outputs:{0:{tooltip:null}}},TopazImageEnhance={display_name:"Topaz Image Enhance",description:"Industry-standard upscaling and image enhancement.",inputs:{model:{name:"model"},image:{name:"image"},prompt:{name:"prompt",tooltip:"Optional text prompt for creative upscaling guidance."},subject_detection:{name:"subject_detection"},face_enhancement:{name:"face_enhancement",tooltip:"Enhance faces (if present) during processing."},face_enhancement_creativity:{name:"face_enhancement_creativity",tooltip:"Set the creativity level for face enhancement."},face_enhancement_strength:{name:"face_enhancement_strength",tooltip:"Controls how sharp enhanced faces are relative to the background."},crop_to_fill:{name:"crop_to_fill",tooltip:"By default, the image is letterboxed when the output aspect ratio differs. Enable to crop the image to fill the output dimensions."},output_width:{name:"output_width",tooltip:"Zero value means to calculate automatically (usually it will be original size or output_height if specified)."},output_height:{name:"output_height",tooltip:"Zero value means to output in the same height as original or output width."},creativity:{name:"creativity"},face_preservation:{name:"face_preservation",tooltip:"Preserve subjects' facial identity."},color_preservation:{name:"color_preservation",tooltip:"Preserve the original colors."}},outputs:{0:{tooltip:null}}},TopazVideoEnhance={display_name:"Topaz Video Enhance",description:"Breathe new life into video with powerful upscaling and recovery technology.",inputs:{video:{name:"video"},upscaler_enabled:{name:"upscaler_enabled"},upscaler_model:{name:"upscaler_model"},upscaler_resolution:{name:"upscaler_resolution"},upscaler_creativity:{name:"upscaler_creativity",tooltip:"Creativity level (applies only to Starlight (Astra) Creative)."},interpolation_enabled:{name:"interpolation_enabled"},interpolation_model:{name:"interpolation_model"},interpolation_slowmo:{name:"interpolation_slowmo",tooltip:"Slow-motion factor applied to the input video. For example, 2 makes the output twice as slow and doubles the duration."},interpolation_frame_rate:{name:"interpolation_frame_rate",tooltip:"Output frame rate."},interpolation_duplicate:{name:"interpolation_duplicate",tooltip:"Analyze the input for duplicate frames and remove them."},interpolation_duplicate_threshold:{name:"interpolation_duplicate_threshold",tooltip:"Detection sensitivity for duplicate frames."},dynamic_compression_level:{name:"dynamic_compression_level",tooltip:"CQP level."}},outputs:{0:{tooltip:null}}},TorchCompileModel={display_name:"TorchCompileModel",inputs:{model:{name:"model"},backend:{name:"backend"}},outputs:{0:{tooltip:null}}},TrainLoraNode={display_name:"Train LoRA",inputs:{model:{name:"model",tooltip:"The model to train the LoRA on."},latents:{name:"latents",tooltip:"The Latents to use for training, serve as dataset/input of the model."},positive:{name:"positive",tooltip:"The positive conditioning to use for training."},batch_size:{name:"batch_size",tooltip:"The batch size to use for training."},grad_accumulation_steps:{name:"grad_accumulation_steps",tooltip:"The number of gradient accumulation steps to use for training."},steps:{name:"steps",tooltip:"The number of steps to train the LoRA for."},learning_rate:{name:"learning_rate",tooltip:"The learning rate to use for training."},rank:{name:"rank",tooltip:"The rank of the LoRA layers."},optimizer:{name:"optimizer",tooltip:"The optimizer to use for training."},loss_function:{name:"loss_function",tooltip:"The loss function to use for training."},seed:{name:"seed",tooltip:"The seed to use for training (used in generator for LoRA weight initialization and noise sampling)"},training_dtype:{name:"training_dtype",tooltip:"The dtype to use for training."},lora_dtype:{name:"lora_dtype",tooltip:"The dtype to use for lora."},algorithm:{name:"algorithm",tooltip:"The algorithm to use for training."},gradient_checkpointing:{name:"gradient_checkpointing",tooltip:"Use gradient checkpointing for training."},existing_lora:{name:"existing_lora",tooltip:"The existing LoRA to append to. Set to None for new LoRA."},control_after_generate:{name:"control after generate"}},outputs:{0:{name:"model_with_lora"},1:{name:"lora"},2:{name:"loss"},3:{name:"steps"}}},TrimAudioDuration={display_name:"Trim Audio Duration",description:"Trim audio tensor into chosen time range.",inputs:{audio:{name:"audio"},start_index:{name:"start_index",tooltip:"Start time in seconds, can be negative to count from the end (supports sub-seconds)."},duration:{name:"duration",tooltip:"Duration in seconds"}}},TrimVideoLatent={display_name:"TrimVideoLatent",inputs:{samples:{name:"samples"},trim_amount:{name:"trim_amount"}},outputs:{0:{tooltip:null}}},TripleCLIPLoader={display_name:"TripleCLIPLoader",description:`[Recipes]

sd3: clip-l, clip-g, t5`,inputs:{clip_name1:{name:"clip_name1"},clip_name2:{name:"clip_name2"},clip_name3:{name:"clip_name3"}},outputs:{0:{tooltip:null}}},TripoConversionNode={display_name:"Tripo: Convert model",inputs:{original_model_task_id:{name:"original_model_task_id"},format:{name:"format"},quad:{name:"quad"},face_limit:{name:"face_limit"},texture_size:{name:"texture_size"},texture_format:{name:"texture_format"}}},TripoImageToModelNode={display_name:"Tripo: Image to Model",inputs:{image:{name:"image"},model_version:{name:"model_version",tooltip:"The model version to use for generation"},style:{name:"style"},texture:{name:"texture"},pbr:{name:"pbr"},model_seed:{name:"model_seed"},orientation:{name:"orientation"},texture_seed:{name:"texture_seed"},texture_quality:{name:"texture_quality"},texture_alignment:{name:"texture_alignment"},face_limit:{name:"face_limit"},quad:{name:"quad"}},outputs:{0:{name:"model_file",tooltip:null},1:{name:"model task_id",tooltip:null}}},TripoMultiviewToModelNode={display_name:"Tripo: Multiview to Model",inputs:{image:{name:"image"},image_left:{name:"image_left"},image_back:{name:"image_back"},image_right:{name:"image_right"},model_version:{name:"model_version",tooltip:"The model version to use for generation"},orientation:{name:"orientation"},texture:{name:"texture"},pbr:{name:"pbr"},model_seed:{name:"model_seed"},texture_seed:{name:"texture_seed"},texture_quality:{name:"texture_quality"},texture_alignment:{name:"texture_alignment"},face_limit:{name:"face_limit"},quad:{name:"quad"}},outputs:{0:{name:"model_file",tooltip:null},1:{name:"model task_id",tooltip:null}}},TripoRefineNode={display_name:"Tripo: Refine Draft model",description:"Refine a draft model created by v1.4 Tripo models only.",inputs:{model_task_id:{name:"model_task_id",tooltip:"Must be a v1.4 Tripo model"}},outputs:{0:{name:"model_file",tooltip:null},1:{name:"model task_id",tooltip:null}}},TripoRetargetNode={display_name:"Tripo: Retarget rigged model",inputs:{original_model_task_id:{name:"original_model_task_id"},animation:{name:"animation"}},outputs:{0:{name:"model_file",tooltip:null},1:{name:"retarget task_id",tooltip:null}}},TripoRigNode={display_name:"Tripo: Rig model",inputs:{original_model_task_id:{name:"original_model_task_id"}},outputs:{0:{name:"model_file",tooltip:null},1:{name:"rig task_id",tooltip:null}}},TripoTextToModelNode={display_name:"Tripo: Text to Model",inputs:{prompt:{name:"prompt"},negative_prompt:{name:"negative_prompt"},model_version:{name:"model_version"},style:{name:"style"},texture:{name:"texture"},pbr:{name:"pbr"},image_seed:{name:"image_seed"},model_seed:{name:"model_seed"},texture_seed:{name:"texture_seed"},texture_quality:{name:"texture_quality"},face_limit:{name:"face_limit"},quad:{name:"quad"}},outputs:{0:{name:"model_file",tooltip:null},1:{name:"model task_id",tooltip:null}}},TripoTextureNode={display_name:"Tripo: Texture model",inputs:{model_task_id:{name:"model_task_id"},texture:{name:"texture"},pbr:{name:"pbr"},texture_seed:{name:"texture_seed"},texture_quality:{name:"texture_quality"},texture_alignment:{name:"texture_alignment"}},outputs:{0:{name:"model_file",tooltip:null},1:{name:"model task_id",tooltip:null}}},unCLIPCheckpointLoader={display_name:"unCLIPCheckpointLoader",inputs:{ckpt_name:{name:"ckpt_name"}}},unCLIPConditioning={display_name:"unCLIPConditioning",inputs:{conditioning:{name:"conditioning"},clip_vision_output:{name:"clip_vision_output"},strength:{name:"strength"},noise_augmentation:{name:"noise_augmentation"}}},UNetCrossAttentionMultiply={display_name:"UNetCrossAttentionMultiply",inputs:{model:{name:"model"},q:{name:"q"},k:{name:"k"},v:{name:"v"},out:{name:"out"}},outputs:{0:{tooltip:null}}},UNETLoader={display_name:"Load Diffusion Model",inputs:{unet_name:{name:"unet_name"},weight_dtype:{name:"weight_dtype"}}},UNetSelfAttentionMultiply={display_name:"UNetSelfAttentionMultiply",inputs:{model:{name:"model"},q:{name:"q"},k:{name:"k"},v:{name:"v"},out:{name:"out"}},outputs:{0:{tooltip:null}}},UNetTemporalAttentionMultiply={display_name:"UNetTemporalAttentionMultiply",inputs:{model:{name:"model"},self_structural:{name:"self_structural"},self_temporal:{name:"self_temporal"},cross_structural:{name:"cross_structural"},cross_temporal:{name:"cross_temporal"}},outputs:{0:{tooltip:null}}},UpscaleModelLoader={display_name:"Load Upscale Model",inputs:{model_name:{name:"model_name"}},outputs:{0:{tooltip:null}}},USOStyleReference={display_name:"USOStyleReference",inputs:{model:{name:"model"},model_patch:{name:"model_patch"},clip_vision_output:{name:"clip_vision_output"}}},VAEDecode={display_name:"VAE Decode",description:"Decodes latent images back into pixel space images.",inputs:{samples:{name:"samples",tooltip:"The latent to be decoded."},vae:{name:"vae",tooltip:"The VAE model used for decoding the latent."}},outputs:{0:{tooltip:"The decoded image."}}},VAEDecodeAudio={display_name:"VAE Decode Audio",inputs:{samples:{name:"samples"},vae:{name:"vae"}}},VAEDecodeHunyuan3D={display_name:"VAEDecodeHunyuan3D",inputs:{samples:{name:"samples"},vae:{name:"vae"},num_chunks:{name:"num_chunks"},octree_resolution:{name:"octree_resolution"}},outputs:{0:{tooltip:null}}},VAEDecodeTiled={display_name:"VAE Decode (Tiled)",inputs:{samples:{name:"samples"},vae:{name:"vae"},tile_size:{name:"tile_size"},overlap:{name:"overlap"},temporal_size:{name:"temporal_size",tooltip:"Only used for video VAEs: Amount of frames to decode at a time."},temporal_overlap:{name:"temporal_overlap",tooltip:"Only used for video VAEs: Amount of frames to overlap."}}},VAEEncode={display_name:"VAE Encode",inputs:{pixels:{name:"pixels"},vae:{name:"vae"}}},VAEEncodeAudio={display_name:"VAE Encode Audio",inputs:{audio:{name:"audio"},vae:{name:"vae"}}},VAEEncodeForInpaint={display_name:"VAE Encode (for Inpainting)",inputs:{pixels:{name:"pixels"},vae:{name:"vae"},mask:{name:"mask"},grow_mask_by:{name:"grow_mask_by"}}},VAEEncodeTiled={display_name:"VAE Encode (Tiled)",inputs:{pixels:{name:"pixels"},vae:{name:"vae"},tile_size:{name:"tile_size"},overlap:{name:"overlap"},temporal_size:{name:"temporal_size",tooltip:"Only used for video VAEs: Amount of frames to encode at a time."},temporal_overlap:{name:"temporal_overlap",tooltip:"Only used for video VAEs: Amount of frames to overlap."}}},VAELoader={display_name:"Load VAE",inputs:{vae_name:{name:"vae_name"}}},VAESave={display_name:"VAESave",inputs:{vae:{name:"vae"},filename_prefix:{name:"filename_prefix"}}},Veo3VideoGenerationNode={display_name:"Google Veo 3 Video Generation",description:"Generates videos from text prompts using Google's Veo 3 API",inputs:{prompt:{name:"prompt",tooltip:"Text description of the video"},aspect_ratio:{name:"aspect_ratio",tooltip:"Aspect ratio of the output video"},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt to guide what to avoid in the video"},duration_seconds:{name:"duration_seconds",tooltip:"Duration of the output video in seconds (Veo 3 only supports 8 seconds)"},enhance_prompt:{name:"enhance_prompt",tooltip:"Whether to enhance the prompt with AI assistance"},person_generation:{name:"person_generation",tooltip:"Whether to allow generating people in the video"},seed:{name:"seed",tooltip:"Seed for video generation (0 for random)"},image:{name:"image",tooltip:"Optional reference image to guide video generation"},model:{name:"model",tooltip:"Veo 3 model to use for video generation"},generate_audio:{name:"generate_audio",tooltip:"Generate audio for the video. Supported by all Veo 3 models."},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},VeoVideoGenerationNode={display_name:"Google Veo 2 Video Generation",description:"Generates videos from text prompts using Google's Veo 2 API",inputs:{prompt:{name:"prompt",tooltip:"Text description of the video"},aspect_ratio:{name:"aspect_ratio",tooltip:"Aspect ratio of the output video"},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt to guide what to avoid in the video"},duration_seconds:{name:"duration_seconds",tooltip:"Duration of the output video in seconds"},enhance_prompt:{name:"enhance_prompt",tooltip:"Whether to enhance the prompt with AI assistance"},person_generation:{name:"person_generation",tooltip:"Whether to allow generating people in the video"},seed:{name:"seed",tooltip:"Seed for video generation (0 for random)"},image:{name:"image",tooltip:"Optional reference image to guide video generation"},model:{name:"model",tooltip:"Veo 2 model to use for video generation"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},VideoLinearCFGGuidance={display_name:"VideoLinearCFGGuidance",inputs:{model:{name:"model"},min_cfg:{name:"min_cfg"}}},VideoTriangleCFGGuidance={display_name:"VideoTriangleCFGGuidance",inputs:{model:{name:"model"},min_cfg:{name:"min_cfg"}}},ViduImageToVideoNode={display_name:"Vidu Image To Video Generation",description:"Generate video from image and optional prompt",inputs:{model:{name:"model",tooltip:"Model name"},image:{name:"image",tooltip:"An image to be used as the start frame of the generated video"},prompt:{name:"prompt",tooltip:"A textual description for video generation"},duration:{name:"duration",tooltip:"Duration of the output video in seconds"},seed:{name:"seed",tooltip:"Seed for video generation (0 for random)"},resolution:{name:"resolution",tooltip:"Supported values may vary by model & duration"},movement_amplitude:{name:"movement_amplitude",tooltip:"The movement amplitude of objects in the frame"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},ViduReferenceVideoNode={display_name:"Vidu Reference To Video Generation",description:"Generate video from multiple images and prompt",inputs:{model:{name:"model",tooltip:"Model name"},images:{name:"images",tooltip:"Images to use as references to generate a video with consistent subjects (max 7 images)."},prompt:{name:"prompt",tooltip:"A textual description for video generation"},duration:{name:"duration",tooltip:"Duration of the output video in seconds"},seed:{name:"seed",tooltip:"Seed for video generation (0 for random)"},aspect_ratio:{name:"aspect_ratio",tooltip:"The aspect ratio of the output video"},resolution:{name:"resolution",tooltip:"Supported values may vary by model & duration"},movement_amplitude:{name:"movement_amplitude",tooltip:"The movement amplitude of objects in the frame"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},ViduStartEndToVideoNode={display_name:"Vidu Start End To Video Generation",description:"Generate a video from start and end frames and a prompt",inputs:{model:{name:"model",tooltip:"Model name"},first_frame:{name:"first_frame",tooltip:"Start frame"},end_frame:{name:"end_frame",tooltip:"End frame"},prompt:{name:"prompt",tooltip:"A textual description for video generation"},duration:{name:"duration",tooltip:"Duration of the output video in seconds"},seed:{name:"seed",tooltip:"Seed for video generation (0 for random)"},resolution:{name:"resolution",tooltip:"Supported values may vary by model & duration"},movement_amplitude:{name:"movement_amplitude",tooltip:"The movement amplitude of objects in the frame"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},ViduTextToVideoNode={display_name:"Vidu Text To Video Generation",description:"Generate video from text prompt",inputs:{model:{name:"model",tooltip:"Model name"},prompt:{name:"prompt",tooltip:"A textual description for video generation"},duration:{name:"duration",tooltip:"Duration of the output video in seconds"},seed:{name:"seed",tooltip:"Seed for video generation (0 for random)"},aspect_ratio:{name:"aspect_ratio",tooltip:"The aspect ratio of the output video"},resolution:{name:"resolution",tooltip:"Supported values may vary by model & duration"},movement_amplitude:{name:"movement_amplitude",tooltip:"The movement amplitude of objects in the frame"},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},VoxelToMesh={display_name:"VoxelToMesh",inputs:{voxel:{name:"voxel"},algorithm:{name:"algorithm"},threshold:{name:"threshold"}},outputs:{0:{tooltip:null}}},VoxelToMeshBasic={display_name:"VoxelToMeshBasic",inputs:{voxel:{name:"voxel"},threshold:{name:"threshold"}},outputs:{0:{tooltip:null}}},VPScheduler={display_name:"VPScheduler",inputs:{steps:{name:"steps"},beta_d:{name:"beta_d"},beta_min:{name:"beta_min"},eps_s:{name:"eps_s"}}},Wan22FunControlToVideo={display_name:"Wan22FunControlToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},ref_image:{name:"ref_image"},control_video:{name:"control_video"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},Wan22ImageToVideoLatent={display_name:"Wan22ImageToVideoLatent",inputs:{vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},start_image:{name:"start_image"}},outputs:{0:{tooltip:null}}},WanAnimateToVideo={display_name:"WanAnimateToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},continue_motion_max_frames:{name:"continue_motion_max_frames"},video_frame_offset:{name:"video_frame_offset",tooltip:"The amount of frames to seek in all the input videos. Used for generating longer videos by chunk. Connect to the video_frame_offset output of the previous node for extending a video."},clip_vision_output:{name:"clip_vision_output"},reference_image:{name:"reference_image"},face_video:{name:"face_video"},pose_video:{name:"pose_video"},background_video:{name:"background_video"},character_mask:{name:"character_mask"},continue_motion:{name:"continue_motion"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null},3:{name:"trim_latent",tooltip:null},4:{name:"trim_image",tooltip:null},5:{name:"video_frame_offset",tooltip:null}}},wanBlockSwap={display_name:"wanBlockSwap",description:"NOP",inputs:{model:{name:"model"}},outputs:{0:{tooltip:null}}},WanCameraEmbedding={display_name:"WanCameraEmbedding",inputs:{camera_pose:{name:"camera_pose"},width:{name:"width"},height:{name:"height"},length:{name:"length"},speed:{name:"speed"},fx:{name:"fx"},fy:{name:"fy"},cx:{name:"cx"},cy:{name:"cy"}},outputs:{0:{name:"camera_embedding",tooltip:null},1:{name:"width",tooltip:null},2:{name:"height",tooltip:null},3:{name:"length",tooltip:null}}},WanCameraImageToVideo={display_name:"WanCameraImageToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},clip_vision_output:{name:"clip_vision_output"},start_image:{name:"start_image"},camera_conditions:{name:"camera_conditions"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},WanContextWindowsManual={display_name:"WAN Context Windows (Manual)",description:"Manually set context windows for WAN-like models (dim=2).",inputs:{model:{name:"model",tooltip:"The model to apply context windows to during sampling."},context_length:{name:"context_length",tooltip:"The length of the context window."},context_overlap:{name:"context_overlap",tooltip:"The overlap of the context window."},context_schedule:{name:"context_schedule",tooltip:"The stride of the context window."},context_stride:{name:"context_stride",tooltip:"The stride of the context window; only applicable to uniform schedules."},closed_loop:{name:"closed_loop",tooltip:"Whether to close the context window loop; only applicable to looped schedules."},fuse_method:{name:"fuse_method",tooltip:"The method to use to fuse the context windows."}},outputs:{0:{tooltip:"The model with context windows applied during sampling."}}},WanFirstLastFrameToVideo={display_name:"WanFirstLastFrameToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},clip_vision_start_image:{name:"clip_vision_start_image"},clip_vision_end_image:{name:"clip_vision_end_image"},start_image:{name:"start_image"},end_image:{name:"end_image"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},WanFunControlToVideo={display_name:"WanFunControlToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},clip_vision_output:{name:"clip_vision_output"},start_image:{name:"start_image"},control_video:{name:"control_video"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},WanFunInpaintToVideo={display_name:"WanFunInpaintToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},clip_vision_output:{name:"clip_vision_output"},start_image:{name:"start_image"},end_image:{name:"end_image"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},WanHuMoImageToVideo={display_name:"WanHuMoImageToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},audio_encoder_output:{name:"audio_encoder_output"},ref_image:{name:"ref_image"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},WanImageToImageApi={display_name:"Wan Image to Image",description:"Generates an image from one or two input images and a text prompt. The output image is currently fixed at 1.6 MP; its aspect ratio matches the input image(s).",inputs:{model:{name:"model",tooltip:"Model to use."},image:{name:"image",tooltip:"Single-image editing or multi-image fusion, maximum 2 images."},prompt:{name:"prompt",tooltip:"Prompt used to describe the elements and visual features, supports English/Chinese."},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt to guide what to avoid."},seed:{name:"seed",tooltip:"Seed to use for generation."},watermark:{name:"watermark",tooltip:'Whether to add an "AI generated" watermark to the result.'},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},WanImageToVideo={display_name:"WanImageToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},clip_vision_output:{name:"clip_vision_output"},start_image:{name:"start_image"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},WanImageToVideoApi={display_name:"Wan Image to Video",description:"Generates video based on the first frame and text prompt.",inputs:{model:{name:"model",tooltip:"Model to use."},image:{name:"image"},prompt:{name:"prompt",tooltip:"Prompt used to describe the elements and visual features, supports English/Chinese."},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt to guide what to avoid."},resolution:{name:"resolution"},duration:{name:"duration",tooltip:"Available durations: 5 and 10 seconds"},audio:{name:"audio",tooltip:"Audio must contain a clear, loud voice, without extraneous noise, background music."},seed:{name:"seed",tooltip:"Seed to use for generation."},generate_audio:{name:"generate_audio",tooltip:"If there is no audio input, generate audio automatically."},prompt_extend:{name:"prompt_extend",tooltip:"Whether to enhance the prompt with AI assistance."},watermark:{name:"watermark",tooltip:'Whether to add an "AI generated" watermark to the result.'},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},WanPhantomSubjectToVideo={display_name:"WanPhantomSubjectToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},images:{name:"images"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative_text",tooltip:null},2:{name:"negative_img_text",tooltip:null},3:{name:"latent",tooltip:null}}},WanSoundImageToVideo={display_name:"WanSoundImageToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},audio_encoder_output:{name:"audio_encoder_output"},ref_image:{name:"ref_image"},control_video:{name:"control_video"},ref_motion:{name:"ref_motion"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},WanSoundImageToVideoExtend={display_name:"WanSoundImageToVideoExtend",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},length:{name:"length"},video_latent:{name:"video_latent"},audio_encoder_output:{name:"audio_encoder_output"},ref_image:{name:"ref_image"},control_video:{name:"control_video"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},WanTextToImageApi={display_name:"Wan Text to Image",description:"Generates image based on text prompt.",inputs:{model:{name:"model",tooltip:"Model to use."},prompt:{name:"prompt",tooltip:"Prompt used to describe the elements and visual features, supports English/Chinese."},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt to guide what to avoid."},width:{name:"width"},height:{name:"height"},seed:{name:"seed",tooltip:"Seed to use for generation."},prompt_extend:{name:"prompt_extend",tooltip:"Whether to enhance the prompt with AI assistance."},watermark:{name:"watermark",tooltip:'Whether to add an "AI generated" watermark to the result.'},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},WanTextToVideoApi={display_name:"Wan Text to Video",description:"Generates video based on text prompt.",inputs:{model:{name:"model",tooltip:"Model to use."},prompt:{name:"prompt",tooltip:"Prompt used to describe the elements and visual features, supports English/Chinese."},negative_prompt:{name:"negative_prompt",tooltip:"Negative text prompt to guide what to avoid."},size:{name:"size"},duration:{name:"duration",tooltip:"Available durations: 5 and 10 seconds"},audio:{name:"audio",tooltip:"Audio must contain a clear, loud voice, without extraneous noise, background music."},seed:{name:"seed",tooltip:"Seed to use for generation."},generate_audio:{name:"generate_audio",tooltip:"If there is no audio input, generate audio automatically."},prompt_extend:{name:"prompt_extend",tooltip:"Whether to enhance the prompt with AI assistance."},watermark:{name:"watermark",tooltip:'Whether to add an "AI generated" watermark to the result.'},control_after_generate:{name:"control after generate"}},outputs:{0:{tooltip:null}}},WanTrackToVideo={display_name:"WanTrackToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},tracks:{name:"tracks"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},temperature:{name:"temperature"},topk:{name:"topk"},start_image:{name:"start_image"},clip_vision_output:{name:"clip_vision_output"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null}}},WanVaceToVideo={display_name:"WanVaceToVideo",inputs:{positive:{name:"positive"},negative:{name:"negative"},vae:{name:"vae"},width:{name:"width"},height:{name:"height"},length:{name:"length"},batch_size:{name:"batch_size"},strength:{name:"strength"},control_video:{name:"control_video"},control_masks:{name:"control_masks"},reference_image:{name:"reference_image"}},outputs:{0:{name:"positive",tooltip:null},1:{name:"negative",tooltip:null},2:{name:"latent",tooltip:null},3:{name:"trim_latent",tooltip:null}}},WebcamCapture={display_name:"Webcam Capture",inputs:{image:{name:"image"},width:{name:"width"},height:{name:"height"},capture_on_queue:{name:"capture_on_queue"},"waiting for camera___":{}}},enNodes={AddNoise,AlignYourStepsScheduler,APG,AudioAdjustVolume,AudioConcat,AudioEncoderEncode,AudioEncoderLoader,AudioMerge,BasicGuider,BasicScheduler,BetaSamplingScheduler,ByteDanceFirstLastFrameNode,ByteDanceImageEditNode,ByteDanceImageNode,ByteDanceImageReferenceNode,ByteDanceImageToVideoNode,ByteDanceSeedreamNode,ByteDanceTextToVideoNode,Canny,CaseConverter,CFGGuider,CFGNorm,CFGZeroStar,CheckpointLoader,CheckpointLoaderSimple,CheckpointSave,ChromaRadianceOptions,CLIPAttentionMultiply,CLIPLoader,CLIPMergeAdd,CLIPMergeSimple,CLIPMergeSubtract,CLIPSave,CLIPSetLastLayer,CLIPTextEncode,CLIPTextEncodeControlnet,CLIPTextEncodeFlux,CLIPTextEncodeHiDream,CLIPTextEncodeHunyuanDiT,CLIPTextEncodeLumina2,CLIPTextEncodePixArtAlpha,CLIPTextEncodeSD3,CLIPTextEncodeSDXL,CLIPTextEncodeSDXLRefiner,CLIPVisionEncode,CLIPVisionLoader,CombineHooks2,CombineHooks4,CombineHooks8,ConditioningAverage,ConditioningCombine,ConditioningConcat,ConditioningSetArea,ConditioningSetAreaPercentage,ConditioningSetAreaPercentageVideo,ConditioningSetAreaStrength,ConditioningSetDefaultCombine,ConditioningSetMask,ConditioningSetProperties,ConditioningSetPropertiesAndCombine,ConditioningSetTimestepRange,ConditioningStableAudio,ConditioningTimestepsRange,ConditioningZeroOut,ContextWindowsManual,ControlNetApply,ControlNetApplyAdvanced,ControlNetApplySD3,ControlNetInpaintingAliMamaApply,ControlNetLoader,CosmosImageToVideoLatent,CosmosPredict2ImageToVideoLatent,CreateHookKeyframe,CreateHookKeyframesFromFloats,CreateHookKeyframesInterpolated,CreateHookLora,CreateHookLoraModelOnly,CreateHookModelAsLora,CreateHookModelAsLoraModelOnly,CreateVideo,CropMask,DiffControlNetLoader,DifferentialDiffusion,DiffusersLoader,DisableNoise,DualCFGGuider,DualCLIPLoader,EasyCache,EmptyAceStepLatentAudio,EmptyAudio,EmptyChromaRadianceLatentImage,EmptyCosmosLatentVideo,EmptyHunyuanImageLatent,EmptyHunyuanLatentVideo,EmptyHunyuanVideo15Latent,EmptyImage,EmptyLatentAudio,EmptyLatentHunyuan3Dv2,EmptyLatentImage,EmptyLTXVLatentVideo,EmptyMochiLatentVideo,EmptySD3LatentImage,"Epsilon Scaling":{display_name:"Epsilon Scaling",inputs:{model:{name:"model"},scaling_factor:{name:"scaling_factor"}},outputs:{0:{tooltip:null}}},ExponentialScheduler,ExtendIntermediateSigmas,FeatherMask,FlipSigmas,FluxDisableGuidance,FluxGuidance,FluxKontextImageScale,FluxKontextMaxImageNode,FluxKontextMultiReferenceLatentMethod,FluxKontextProImageNode,FluxProExpandNode,FluxProFillNode,FluxProUltraImageNode,FreeU,FreeU_V2,FreSca,GeminiImage2Node,GeminiImageNode,GeminiInputFiles,GeminiNode,GetImageSize,GetVideoComponents,GITSScheduler,GLIGENLoader,GLIGENTextBoxApply,GrowMask,Hunyuan3Dv2Conditioning,Hunyuan3Dv2ConditioningMultiView,HunyuanImageToVideo,HunyuanRefinerLatent,HunyuanVideo15ImageToVideo,HunyuanVideo15LatentUpscaleWithModel,HunyuanVideo15SuperResolution,HypernetworkLoader,HyperTile,IdeogramV1,IdeogramV2,IdeogramV3,ImageAddNoise,ImageBatch,ImageBlend,ImageBlur,ImageColorToMask,ImageCompositeMasked,ImageCrop,ImageFlip,ImageFromBatch,ImageInvert,ImageOnlyCheckpointLoader,ImageOnlyCheckpointSave,ImagePadForOutpaint,ImageQuantize,ImageRGBToYUV,ImageRotate,ImageScale,ImageScaleBy,ImageScaleToMaxDimension,ImageScaleToTotalPixels,ImageSharpen,ImageStitch,ImageToMask,ImageUpscaleWithModel,ImageYUVToRGB,InpaintModelConditioning,InstructPixToPixConditioning,InvertMask,JoinImageWithAlpha,KarrasScheduler,KlingCameraControlI2VNode,KlingCameraControls,KlingCameraControlT2VNode,KlingDualCharacterVideoEffectNode,KlingImage2VideoNode,KlingImageGenerationNode,KlingLipSyncAudioToVideoNode,KlingLipSyncTextToVideoNode,KlingSingleImageVideoEffectNode,KlingStartEndFrameNode,KlingTextToVideoNode,KlingVideoExtendNode,KlingVirtualTryOnNode,KSampler,KSamplerAdvanced,KSamplerSelect,LaplaceScheduler,LatentAdd,LatentApplyOperation,LatentApplyOperationCFG,LatentBatch,LatentBatchSeedBehavior,LatentBlend,LatentComposite,LatentCompositeMasked,LatentConcat,LatentCrop,LatentCut,LatentFlip,LatentFromBatch,LatentInterpolate,LatentMultiply,LatentOperationSharpen,LatentOperationTonemapReinhard,LatentRotate,LatentSubtract,LatentUpscale,LatentUpscaleBy,LatentUpscaleModelLoader,LazyCache,Load3D:Load3D$1,Load3DAnimation,LoadAudio,LoadImage,LoadImageMask,LoadImageOutput,LoadImageSetFromFolderNode,LoadImageTextSetFromFolderNode,LoadLatent,LoadVideo,LoraLoader,LoraLoaderModelOnly,LoraModelLoader,LoraSave,LossGraphNode,LotusConditioning,LTXVAddGuide,LtxvApiImageToVideo,LtxvApiTextToVideo,LTXVConditioning,LTXVCropGuides,LTXVImgToVideo,LTXVPreprocess,LTXVScheduler,LumaConceptsNode,LumaImageModifyNode,LumaImageNode,LumaImageToVideoNode,LumaReferenceNode,LumaVideoNode,Mahiro,MaskComposite,MaskPreview,MaskToImage,MinimaxHailuoVideoNode,MinimaxImageToVideoNode,MinimaxTextToVideoNode,ModelComputeDtype,ModelMergeAdd,ModelMergeAuraflow,ModelMergeBlocks,ModelMergeCosmos14B,ModelMergeCosmos7B,ModelMergeCosmosPredict2_14B,ModelMergeCosmosPredict2_2B,ModelMergeFlux1,ModelMergeLTXV,ModelMergeMochiPreview,ModelMergeQwenImage,ModelMergeSD1,ModelMergeSD2,ModelMergeSD3_2B,ModelMergeSD35_Large,ModelMergeSDXL,ModelMergeSimple,ModelMergeSubtract,ModelMergeWAN2_1,ModelPatchLoader,ModelSamplingAuraFlow,ModelSamplingContinuousEDM,ModelSamplingContinuousV,ModelSamplingDiscrete,ModelSamplingFlux,ModelSamplingLTXV,ModelSamplingSD3,ModelSamplingStableCascade,ModelSave,MoonvalleyImg2VideoNode,MoonvalleyTxt2VideoNode,MoonvalleyVideo2VideoNode,Morphology,OpenAIChatConfig,OpenAIChatNode,OpenAIDalle2,OpenAIDalle3,OpenAIGPTImage1,OpenAIInputFiles,OpenAIVideoSora2,OptimalStepsScheduler,PairConditioningCombine,PairConditioningSetDefaultCombine,PairConditioningSetProperties,PairConditioningSetPropertiesAndCombine,PatchModelAddDownscale,PerpNeg,PerpNegGuider,PerturbedAttentionGuidance,PhotoMakerEncode,PhotoMakerLoader,Pikadditions,Pikaffects,PikaImageToVideoNode2_2,PikaScenesV2_2,PikaStartEndFrameNode2_2,Pikaswaps,PikaTextToVideoNode2_2,PixverseImageToVideoNode,PixverseTemplateNode,PixverseTextToVideoNode,PixverseTransitionVideoNode,PolyexponentialScheduler,PorterDuffImageComposite,Preview3D,Preview3DAnimation,PreviewAny,PreviewAudio,PreviewImage,PrimitiveBoolean,PrimitiveFloat,PrimitiveInt,PrimitiveString,PrimitiveStringMultiline,QuadrupleCLIPLoader,QwenImageDiffsynthControlnet,RandomNoise,RebatchImages,RebatchLatents,RecordAudio,RecraftColorRGB,RecraftControls,RecraftCreativeUpscaleNode,RecraftCrispUpscaleNode,RecraftImageInpaintingNode,RecraftImageToImageNode,RecraftRemoveBackgroundNode,RecraftReplaceBackgroundNode,RecraftStyleV3DigitalIllustration,RecraftStyleV3InfiniteStyleLibrary,RecraftStyleV3LogoRaster,RecraftStyleV3RealisticImage,RecraftTextToImageNode,RecraftTextToVectorNode,RecraftVectorizeImageNode,ReferenceLatent,RegexExtract,RegexMatch,RegexReplace,RenormCFG,RepeatImageBatch,RepeatLatentBatch,RescaleCFG,ResizeAndPadImage,Rodin3D_Detail,Rodin3D_Gen2,Rodin3D_Regular,Rodin3D_Sketch,Rodin3D_Smooth,RunwayFirstLastFrameNode,RunwayImageToVideoNodeGen3a,RunwayImageToVideoNodeGen4,RunwayTextToImageNode,SamplerCustom,SamplerCustomAdvanced,SamplerDPMAdaptative,SamplerDPMPP_2M_SDE,SamplerDPMPP_2S_Ancestral,SamplerDPMPP_3M_SDE,SamplerDPMPP_SDE,SamplerER_SDE,SamplerEulerAncestral,SamplerEulerAncestralCFGPP,SamplerEulerCFGpp,SamplerLCMUpscale,SamplerLMS,SamplerSASolver,SamplingPercentToSigma,SaveAnimatedPNG,SaveAnimatedWEBP,SaveAudio,SaveAudioMP3,SaveAudioOpus,SaveGLB,SaveImage,SaveImageWebsocket,SaveLatent,SaveLoRANode,SaveSVGNode,SaveVideo,SaveWEBM,ScaleROPE,SD_4XUpscale_Conditioning,SDTurboScheduler,SelfAttentionGuidance,SetClipHooks,SetFirstSigma,SetHookKeyframes,SetLatentNoiseMask,SetUnionControlNetType,SkipLayerGuidanceDiT,SkipLayerGuidanceDiTSimple,SkipLayerGuidanceSD3,SolidMask,SplitAudioChannels,SplitImageWithAlpha,SplitSigmas,SplitSigmasDenoise,StabilityAudioInpaint,StabilityAudioToAudio,StabilityStableImageSD_3_5Node,StabilityStableImageUltraNode,StabilityTextToAudio,StabilityUpscaleConservativeNode,StabilityUpscaleCreativeNode,StabilityUpscaleFastNode,StableCascade_EmptyLatentImage,StableCascade_StageB_Conditioning,StableCascade_StageC_VAEEncode,StableCascade_SuperResolutionControlnet,StableZero123_Conditioning,StableZero123_Conditioning_Batched,StringCompare,StringConcatenate,StringContains,StringLength,StringReplace,StringSubstring,StringTrim,StyleModelApply,StyleModelLoader,SV3D_Conditioning,SVD_img2vid_Conditioning,T5TokenizerOptions,TCFG,TemporalScoreRescaling,TextEncodeAceStepAudio,TextEncodeHunyuanVideo_ImageToVideo,TextEncodeQwenImageEdit,TextEncodeQwenImageEditPlus,ThresholdMask,TomePatchModel,TopazImageEnhance,TopazVideoEnhance,TorchCompileModel,TrainLoraNode,TrimAudioDuration,TrimVideoLatent,TripleCLIPLoader,TripoConversionNode,TripoImageToModelNode,TripoMultiviewToModelNode,TripoRefineNode,TripoRetargetNode,TripoRigNode,TripoTextToModelNode,TripoTextureNode,unCLIPCheckpointLoader,unCLIPConditioning,UNetCrossAttentionMultiply,UNETLoader,UNetSelfAttentionMultiply,UNetTemporalAttentionMultiply,UpscaleModelLoader,USOStyleReference,VAEDecode,VAEDecodeAudio,VAEDecodeHunyuan3D,VAEDecodeTiled,VAEEncode,VAEEncodeAudio,VAEEncodeForInpaint,VAEEncodeTiled,VAELoader,VAESave,Veo3VideoGenerationNode,VeoVideoGenerationNode,VideoLinearCFGGuidance,VideoTriangleCFGGuidance,ViduImageToVideoNode,ViduReferenceVideoNode,ViduStartEndToVideoNode,ViduTextToVideoNode,VoxelToMesh,VoxelToMeshBasic,VPScheduler,Wan22FunControlToVideo,Wan22ImageToVideoLatent,WanAnimateToVideo,wanBlockSwap,WanCameraEmbedding,WanCameraImageToVideo,WanContextWindowsManual,WanFirstLastFrameToVideo,WanFunControlToVideo,WanFunInpaintToVideo,WanHuMoImageToVideo,WanImageToImageApi,WanImageToVideo,WanImageToVideoApi,WanPhantomSubjectToVideo,WanSoundImageToVideo,WanSoundImageToVideoExtend,WanTextToImageApi,WanTextToVideoApi,WanTrackToVideo,WanVaceToVideo,WebcamCapture},Comfy_Canvas_BackgroundImage={name:"Canvas background image",tooltip:'Image URL for the canvas background. You can right-click an image in the outputs panel and select "Set as Background" to use it, or upload your own image using the upload button.'},Comfy_Canvas_LeftMouseClickBehavior={name:"Left Mouse Click Behavior",options:{Panning:"Panning",Select:"Select"}},Comfy_Canvas_MouseWheelScroll={name:"Mouse Wheel Scroll",options:{Panning:"Panning","Zoom in/out":"Zoom in/out"}},Comfy_Canvas_NavigationMode={name:"Navigation Mode",options:{"Standard (New)":"Standard (New)","Drag Navigation":"Drag Navigation",Custom:"Custom"}},Comfy_Canvas_SelectionToolbox={name:"Show selection toolbox"},Comfy_ConfirmClear={name:"Require confirmation when clearing workflow"},Comfy_DevMode={name:"Enable dev mode options (API save, etc.)"},Comfy_DisableFloatRounding={name:"Disable default float widget rounding.",tooltip:"(requires page reload) Cannot disable round when round is set by the node in the backend."},Comfy_DisableSliders={name:"Disable node widget sliders"},Comfy_DOMClippingEnabled={name:"Enable DOM element clipping (enabling may reduce performance)"},Comfy_EditAttention_Delta={name:"Ctrl+up/down precision"},Comfy_EnableTooltips={name:"Enable Tooltips"},Comfy_EnableWorkflowViewRestore={name:"Save and restore canvas position and zoom level in workflows"},Comfy_FloatRoundingPrecision={name:"Float widget rounding decimal places [0 = auto].",tooltip:"(requires page reload)"},Comfy_Graph_CanvasInfo={name:"Show canvas info on bottom left corner (fps, etc.)"},Comfy_Graph_CanvasMenu={name:"Show graph canvas menu"},Comfy_Graph_CtrlShiftZoom={name:"Enable fast-zoom shortcut (Ctrl + Shift + Drag)"},Comfy_Graph_LinkMarkers={name:"Link midpoint markers",options:{None:"None",Circle:"Circle",Arrow:"Arrow"}},Comfy_Graph_ZoomSpeed={name:"Canvas zoom speed"},Comfy_Group_DoubleClickTitleToEdit={name:"Double click group title to edit"},Comfy_GroupSelectedNodes_Padding={name:"Group selected nodes padding"},Comfy_LinkRelease_Action={name:"Action on link release (No modifier)",options:{"context menu":"context menu","search box":"search box","no action":"no action"}},Comfy_LinkRelease_ActionShift={name:"Action on link release (Shift)",options:{"context menu":"context menu","search box":"search box","no action":"no action"}},Comfy_LinkRenderMode={name:"Link Render Mode",options:{Straight:"Straight",Linear:"Linear",Spline:"Spline",Hidden:"Hidden"}},Comfy_Load3D_3DViewerEnable={name:"Enable 3D Viewer (Beta)",tooltip:"Enables the 3D Viewer (Beta) for selected nodes. This feature allows you to visualize and interact with 3D models directly within the full size 3d viewer."},Comfy_Load3D_BackgroundColor={name:"Initial Background Color",tooltip:"Controls the default background color of the 3D scene. This setting determines the background appearance when a new 3D widget is created, but can be adjusted individually for each widget after creation."},Comfy_Load3D_CameraType={name:"Initial Camera Type",tooltip:"Controls whether the camera is perspective or orthographic by default when a new 3D widget is created. This default can still be toggled individually for each widget after creation.",options:{perspective:"perspective",orthographic:"orthographic"}},Comfy_Load3D_LightAdjustmentIncrement={name:"Light Adjustment Increment",tooltip:"Controls the increment size when adjusting light intensity in 3D scenes. A smaller step value allows for finer control over lighting adjustments, while a larger value results in more noticeable changes per adjustment."},Comfy_Load3D_LightIntensity={name:"Initial Light Intensity",tooltip:"Sets the default brightness level of lighting in the 3D scene. This value determines how intensely lights illuminate objects when a new 3D widget is created, but can be adjusted individually for each widget after creation."},Comfy_Load3D_LightIntensityMaximum={name:"Light Intensity Maximum",tooltip:"Sets the maximum allowable light intensity value for 3D scenes. This defines the upper brightness limit that can be set when adjusting lighting in any 3D widget."},Comfy_Load3D_LightIntensityMinimum={name:"Light Intensity Minimum",tooltip:"Sets the minimum allowable light intensity value for 3D scenes. This defines the lower brightness limit that can be set when adjusting lighting in any 3D widget."},Comfy_Load3D_ShowGrid={name:"Initial Grid Visibility",tooltip:"Controls whether the grid is visible by default when a new 3D widget is created. This default can still be toggled individually for each widget after creation."},Comfy_Locale={name:"Language"},Comfy_MaskEditor_BrushAdjustmentSpeed={name:"Brush adjustment speed multiplier",tooltip:"Controls how quickly the brush size and hardness change when adjusting. Higher values mean faster changes."},Comfy_MaskEditor_UseDominantAxis={name:"Lock brush adjustment to dominant axis",tooltip:"When enabled, brush adjustments will only affect size OR hardness based on which direction you move more"},Comfy_MaskEditor_UseNewEditor={name:"Use new mask editor",tooltip:"Switch to the new mask editor interface"},Comfy_ModelLibrary_AutoLoadAll={name:"Automatically load all model folders",tooltip:"If true, all folders will load as soon as you open the model library (this may cause delays while it loads). If false, root level model folders will only load once you click on them."},Comfy_ModelLibrary_NameFormat={name:"What name to display in the model library tree view",tooltip:'Select "filename" to render a simplified view of the raw filename (without directory or ".safetensors" extension) in the model list. Select "title" to display the configurable model metadata title.',options:{filename:"filename",title:"title"}},Comfy_Node_AllowImageSizeDraw={name:"Show width Ã— height below the image preview"},Comfy_Node_AutoSnapLinkToSlot={name:"Auto snap link to node slot",tooltip:"When dragging a link over a node, the link automatically snap to a viable input slot on the node"},Comfy_Node_BypassAllLinksOnDelete={name:"Keep all links when deleting nodes",tooltip:"When deleting a node, attempt to reconnect all of its input and output links (bypassing the deleted node)"},Comfy_Node_DoubleClickTitleToEdit={name:"Double click node title to edit"},Comfy_Node_MiddleClickRerouteNode={name:"Middle-click creates a new Reroute node"},Comfy_Node_Opacity={name:"Node opacity"},Comfy_Node_ShowDeprecated={name:"Show deprecated nodes in search",tooltip:"Deprecated nodes are hidden by default in the UI, but remain functional in existing workflows that use them."},Comfy_Node_ShowExperimental={name:"Show experimental nodes in search",tooltip:"Experimental nodes are marked as such in the UI and may be subject to significant changes or removal in future versions. Use with caution in production workflows"},Comfy_Node_SnapHighlightsNode={name:"Snap highlights node",tooltip:"When dragging a link over a node with viable input slot, highlight the node"},Comfy_NodeBadge_NodeIdBadgeMode={name:"Node ID badge mode",options:{None:"None","Show all":"Show all"}},Comfy_NodeBadge_NodeLifeCycleBadgeMode={name:"Node life cycle badge mode",options:{None:"None","Show all":"Show all"}},Comfy_NodeBadge_NodeSourceBadgeMode={name:"Node source badge mode",options:{None:"None","Show all":"Show all","Hide built-in":"Hide built-in"}},Comfy_NodeBadge_ShowApiPricing={name:"Show API node pricing badge"},Comfy_NodeSearchBoxImpl={name:"Node search box implementation",options:{default:"default","litegraph (legacy)":"litegraph (legacy)"}},Comfy_NodeSearchBoxImpl_NodePreview={name:"Node preview",tooltip:"Only applies to the default implementation"},Comfy_NodeSearchBoxImpl_ShowCategory={name:"Show node category in search results",tooltip:"Only applies to the default implementation"},Comfy_NodeSearchBoxImpl_ShowIdName={name:"Show node id name in search results",tooltip:"Only applies to the default implementation"},Comfy_NodeSearchBoxImpl_ShowNodeFrequency={name:"Show node frequency in search results",tooltip:"Only applies to the default implementation"},Comfy_NodeSuggestions_number={name:"Number of nodes suggestions",tooltip:"Only for litegraph searchbox/context menu"},Comfy_Notification_ShowVersionUpdates={name:"Show version updates",tooltip:"Show updates for new models, and major new features."},Comfy_Pointer_ClickBufferTime={name:"Pointer click drift delay",tooltip:`After pressing a pointer button down, this is the maximum time (in milliseconds) that pointer movement can be ignored for.

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`},Comfy_Pointer_ClickDrift={name:"Pointer click drift (maximum distance)",tooltip:`If the pointer moves more than this distance while holding a button down, it is considered dragging (rather than clicking).

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`},Comfy_Pointer_DoubleClickTime={name:"Double click interval (maximum)",tooltip:"The maximum time in milliseconds between the two clicks of a double-click.  Increasing this value may assist if double-clicks are sometimes not registered."},Comfy_PreviewFormat={name:"Preview image format",tooltip:"When displaying a preview in the image widget, convert it to a lightweight image, e.g. webp, jpeg, webp;50, etc."},Comfy_PromptFilename={name:"Prompt for filename when saving workflow"},Comfy_Queue_MaxHistoryItems={name:"Queue history size",tooltip:"The maximum number of tasks that show in the queue history."},Comfy_QueueButton_BatchCountLimit={name:"Batch count limit",tooltip:"The maximum number of tasks added to the queue at one button click"},Comfy_Sidebar_Location={name:"Sidebar location",options:{left:"left",right:"right"}},Comfy_Sidebar_Size={name:"Sidebar size",options:{normal:"normal",small:"small"}},Comfy_Sidebar_Style={name:"Sidebar style",options:{floating:"floating",connected:"connected"}},Comfy_Sidebar_UnifiedWidth={name:"Unified sidebar width"},Comfy_SnapToGrid_GridSize={name:"Snap to grid size",tooltip:"When dragging and resizing nodes while holding shift they will be aligned to the grid, this controls the size of that grid."},Comfy_TextareaWidget_FontSize={name:"Textarea widget font size"},Comfy_TextareaWidget_Spellcheck={name:"Textarea widget spellcheck"},Comfy_TreeExplorer_ItemPadding={name:"Tree explorer item padding"},Comfy_UseNewMenu={name:"Use new menu",tooltip:"Menu bar position. On mobile devices, the menu is always shown at the top.",options:{Disabled:"Disabled",Top:"Top"}},Comfy_Validation_Workflows={name:"Validate workflows"},Comfy_VueNodes_AutoScaleLayout={name:"Auto-scale layout (Nodes 2.0)",tooltip:"Automatically scale node positions when switching to Nodes 2.0 rendering to prevent overlap"},Comfy_VueNodes_Enabled={name:"Modern Node Design (Nodes 2.0)",tooltip:"Modern: DOM-based rendering with enhanced interactivity, native browser features, and updated visual design. Classic: Traditional canvas rendering."},Comfy_WidgetControlMode={name:"Widget control mode",tooltip:"Controls when widget values are updated (randomize/increment/decrement), either before the prompt is queued or after.",options:{before:"before",after:"after"}},Comfy_Window_UnloadConfirmation={name:"Show confirmation when closing window"},Comfy_Workflow_AutoSave={name:"Auto Save",options:{off:"off","after delay":"after delay"}},Comfy_Workflow_AutoSaveDelay={name:"Auto Save Delay (ms)",tooltip:'Only applies if Auto Save is set to "after delay".'},Comfy_Workflow_ConfirmDelete={name:"Show confirmation when deleting workflows"},Comfy_Workflow_Persist={name:"Persist workflow state and restore on page (re)load"},Comfy_Workflow_ShowMissingModelsWarning={name:"Show missing models warning"},Comfy_Workflow_ShowMissingNodesWarning={name:"Show missing nodes warning"},Comfy_Workflow_SortNodeIdOnSave={name:"Sort node IDs when saving workflow"},Comfy_Workflow_WarnBlueprintOverwrite={name:"Require confirmation to overwrite an existing subgraph blueprint"},Comfy_Workflow_WorkflowTabsPosition={name:"Opened workflows position",options:{Sidebar:"Sidebar",Topbar:"Topbar"}},LiteGraph_Canvas_MaximumFps={name:"Maximum FPS",tooltip:"The maximum frames per second that the canvas is allowed to render. Caps GPU usage at the cost of smoothness. If 0, the screen refresh rate is used. Default: 0"},LiteGraph_Canvas_MinFontSizeForLOD={name:"Zoom Node Level of Detail - font size threshold",tooltip:"Controls when the nodes switch to low quality LOD rendering. Uses font size in pixels to determine when to switch. Set to 0 to disable. Values 1-24 set the minimum font size threshold for LOD - higher values (24px) = switch nodes to simplified rendering sooner when zooming out, lower values (1px) = maintain full node quality longer."},LiteGraph_ContextMenu_Scaling={name:"Scale node combo widget menus (lists) when zoomed in"},LiteGraph_Node_DefaultPadding={name:"Always shrink new nodes",tooltip:"Resize nodes to the smallest possible size when created. When disabled, a newly added node will be widened slightly to show widget values."},LiteGraph_Node_TooltipDelay={name:"Tooltip Delay"},LiteGraph_Reroute_SplineOffset={name:"Reroute spline offset",tooltip:"The bezier control point offset from the reroute centre point"},pysssss_SnapToGrid={name:"Always snap to grid"},enSettings={Comfy_Canvas_BackgroundImage,Comfy_Canvas_LeftMouseClickBehavior,Comfy_Canvas_MouseWheelScroll,Comfy_Canvas_NavigationMode,Comfy_Canvas_SelectionToolbox,Comfy_ConfirmClear,Comfy_DevMode,Comfy_DisableFloatRounding,Comfy_DisableSliders,Comfy_DOMClippingEnabled,Comfy_EditAttention_Delta,Comfy_EnableTooltips,Comfy_EnableWorkflowViewRestore,Comfy_FloatRoundingPrecision,Comfy_Graph_CanvasInfo,Comfy_Graph_CanvasMenu,Comfy_Graph_CtrlShiftZoom,Comfy_Graph_LinkMarkers,Comfy_Graph_ZoomSpeed,Comfy_Group_DoubleClickTitleToEdit,Comfy_GroupSelectedNodes_Padding,Comfy_LinkRelease_Action,Comfy_LinkRelease_ActionShift,Comfy_LinkRenderMode,Comfy_Load3D_3DViewerEnable,Comfy_Load3D_BackgroundColor,Comfy_Load3D_CameraType,Comfy_Load3D_LightAdjustmentIncrement,Comfy_Load3D_LightIntensity,Comfy_Load3D_LightIntensityMaximum,Comfy_Load3D_LightIntensityMinimum,Comfy_Load3D_ShowGrid,Comfy_Locale,Comfy_MaskEditor_BrushAdjustmentSpeed,Comfy_MaskEditor_UseDominantAxis,Comfy_MaskEditor_UseNewEditor,Comfy_ModelLibrary_AutoLoadAll,Comfy_ModelLibrary_NameFormat,Comfy_Node_AllowImageSizeDraw,Comfy_Node_AutoSnapLinkToSlot,Comfy_Node_BypassAllLinksOnDelete,Comfy_Node_DoubleClickTitleToEdit,Comfy_Node_MiddleClickRerouteNode,Comfy_Node_Opacity,Comfy_Node_ShowDeprecated,Comfy_Node_ShowExperimental,Comfy_Node_SnapHighlightsNode,Comfy_NodeBadge_NodeIdBadgeMode,Comfy_NodeBadge_NodeLifeCycleBadgeMode,Comfy_NodeBadge_NodeSourceBadgeMode,Comfy_NodeBadge_ShowApiPricing,Comfy_NodeSearchBoxImpl,Comfy_NodeSearchBoxImpl_NodePreview,Comfy_NodeSearchBoxImpl_ShowCategory,Comfy_NodeSearchBoxImpl_ShowIdName,Comfy_NodeSearchBoxImpl_ShowNodeFrequency,Comfy_NodeSuggestions_number,Comfy_Notification_ShowVersionUpdates,Comfy_Pointer_ClickBufferTime,Comfy_Pointer_ClickDrift,Comfy_Pointer_DoubleClickTime,Comfy_PreviewFormat,Comfy_PromptFilename,Comfy_Queue_MaxHistoryItems,Comfy_QueueButton_BatchCountLimit,Comfy_Sidebar_Location,Comfy_Sidebar_Size,Comfy_Sidebar_Style,Comfy_Sidebar_UnifiedWidth,Comfy_SnapToGrid_GridSize,Comfy_TextareaWidget_FontSize,Comfy_TextareaWidget_Spellcheck,Comfy_TreeExplorer_ItemPadding,Comfy_UseNewMenu,Comfy_Validation_Workflows,Comfy_VueNodes_AutoScaleLayout,Comfy_VueNodes_Enabled,Comfy_WidgetControlMode,Comfy_Window_UnloadConfirmation,Comfy_Workflow_AutoSave,Comfy_Workflow_AutoSaveDelay,Comfy_Workflow_ConfirmDelete,Comfy_Workflow_Persist,Comfy_Workflow_ShowMissingModelsWarning,Comfy_Workflow_ShowMissingNodesWarning,Comfy_Workflow_SortNodeIdOnSave,Comfy_Workflow_WarnBlueprintOverwrite,Comfy_Workflow_WorkflowTabsPosition,LiteGraph_Canvas_MaximumFps,LiteGraph_Canvas_MinFontSizeForLOD,LiteGraph_ContextMenu_Scaling,LiteGraph_Node_DefaultPadding,LiteGraph_Node_TooltipDelay,LiteGraph_Reroute_SplineOffset,pysssss_SnapToGrid};function buildLocale(i,o,n,s){return{...i,nodeDefs:o,commands:n,settings:s}}p(buildLocale,"buildLocale");const localeLoaders={ar:p(()=>__vitePreload(()=>import("./main-B_O5JXqb.js"),[],import.meta.url),"ar"),es:p(()=>__vitePreload(()=>import("./main-BfYm0UZk.js"),[],import.meta.url),"es"),fr:p(()=>__vitePreload(()=>import("./main-DIydJIVo.js"),[],import.meta.url),"fr"),ja:p(()=>__vitePreload(()=>import("./main--26ITiPg.js"),[],import.meta.url),"ja"),ko:p(()=>__vitePreload(()=>import("./main-bbDWwSQg.js"),[],import.meta.url),"ko"),ru:p(()=>__vitePreload(()=>import("./main-BWz7eSuQ.js"),[],import.meta.url),"ru"),tr:p(()=>__vitePreload(()=>import("./main-CWNQ1grz.js"),[],import.meta.url),"tr"),zh:p(()=>__vitePreload(()=>import("./main-Of5833rh.js"),[],import.meta.url),"zh"),"zh-TW":p(()=>__vitePreload(()=>import("./main-DWBzsDHD.js"),[],import.meta.url),"zh-TW")},nodeDefsLoaders={ar:p(()=>__vitePreload(()=>import("./nodeDefs-C_3dtUrw.js"),[],import.meta.url),"ar"),es:p(()=>__vitePreload(()=>import("./nodeDefs-mYynvwT3.js"),[],import.meta.url),"es"),fr:p(()=>__vitePreload(()=>import("./nodeDefs-Wg0kyx6g.js"),[],import.meta.url),"fr"),ja:p(()=>__vitePreload(()=>import("./nodeDefs-XIDOZLYj.js"),[],import.meta.url),"ja"),ko:p(()=>__vitePreload(()=>import("./nodeDefs-CNu3gsAP.js"),[],import.meta.url),"ko"),ru:p(()=>__vitePreload(()=>import("./nodeDefs-BkNa93BN.js"),[],import.meta.url),"ru"),tr:p(()=>__vitePreload(()=>import("./nodeDefs-1D8r_Uwh.js"),[],import.meta.url),"tr"),zh:p(()=>__vitePreload(()=>import("./nodeDefs-BJhLfPLg.js"),[],import.meta.url),"zh"),"zh-TW":p(()=>__vitePreload(()=>import("./nodeDefs-XOOUpZDn.js"),[],import.meta.url),"zh-TW")},commandsLoaders={ar:p(()=>__vitePreload(()=>import("./commands-0xkGzmt3.js"),[],import.meta.url),"ar"),es:p(()=>__vitePreload(()=>import("./commands-u9cgoPdp.js"),[],import.meta.url),"es"),fr:p(()=>__vitePreload(()=>import("./commands-X5kSNSWw.js"),[],import.meta.url),"fr"),ja:p(()=>__vitePreload(()=>import("./commands-D0WARiDH.js"),[],import.meta.url),"ja"),ko:p(()=>__vitePreload(()=>import("./commands-D4XGo5GT.js"),[],import.meta.url),"ko"),ru:p(()=>__vitePreload(()=>import("./commands-CnHExAPr.js"),[],import.meta.url),"ru"),tr:p(()=>__vitePreload(()=>import("./commands-6A9LrJbU.js"),[],import.meta.url),"tr"),zh:p(()=>__vitePreload(()=>import("./commands-DqtkowGX.js"),[],import.meta.url),"zh"),"zh-TW":p(()=>__vitePreload(()=>import("./commands-BTkaheqA.js"),[],import.meta.url),"zh-TW")},settingsLoaders={ar:p(()=>__vitePreload(()=>import("./settings-B5pGXAeN.js"),[],import.meta.url),"ar"),es:p(()=>__vitePreload(()=>import("./settings-RBKtfA0r.js"),[],import.meta.url),"es"),fr:p(()=>__vitePreload(()=>import("./settings-B0UwBejy.js"),[],import.meta.url),"fr"),ja:p(()=>__vitePreload(()=>import("./settings-8Va-NIvr.js"),[],import.meta.url),"ja"),ko:p(()=>__vitePreload(()=>import("./settings-B4kDTXCC.js"),[],import.meta.url),"ko"),ru:p(()=>__vitePreload(()=>import("./settings-CPvZ6jKg.js"),[],import.meta.url),"ru"),tr:p(()=>__vitePreload(()=>import("./settings-DdORcUx_.js"),[],import.meta.url),"tr"),zh:p(()=>__vitePreload(()=>import("./settings-DTTyyvro.js"),[],import.meta.url),"zh"),"zh-TW":p(()=>__vitePreload(()=>import("./settings-Ce6V_3lU.js"),[],import.meta.url),"zh-TW")},loadedLocales=new Set(["en"]),loadingLocales=new Map,customNodesI18nData={};async function loadLocale(i){if(loadedLocales.has(i))return;const o=loadingLocales.get(i);if(o)return o;const n=localeLoaders[i],s=nodeDefsLoaders[i],a=commandsLoaders[i],r=settingsLoaders[i];if(!n||!s||!a||!r){console.warn(`Locale "${i}" is not supported`);return}const l=(async()=>{try{const[u,m,f,_]=await Promise.all([n(),s(),a(),r()]),y=buildLocale(u.default,m.default,f.default,_.default);i18n.global.setLocaleMessage(i,y),loadedLocales.add(i),customNodesI18nData[i]&&i18n.global.mergeLocaleMessage(i,customNodesI18nData[i])}catch(u){throw console.error(`Failed to load locale "${i}":`,u),u}finally{loadingLocales.delete(i)}})();return loadingLocales.set(i,l),l}p(loadLocale,"loadLocale");function mergeCustomNodesI18n(i){for(const o of Object.keys(customNodesI18nData))delete customNodesI18nData[o];Object.assign(customNodesI18nData,i);for(const[o,n]of Object.entries(i))loadedLocales.has(o)&&i18n.global.mergeLocaleMessage(o,n)}p(mergeCustomNodesI18n,"mergeCustomNodesI18n");const messages={en:buildLocale(en,enNodes,enCommands,enSettings)},i18n=createI18n({legacy:!1,locale:navigator.language.split("-")[0]||"en",fallbackLocale:"en",messages,missingWarn:/^(?!settings\.Comfy_Locale\.options\.).+/,fallbackWarn:/^(?!settings\.Comfy_Locale\.options\.).+/}),{t,te,d}=i18n.global;function st(i,o){return te(i)?t(i):o}p(st,"st");let sharedConverter=null;const useCanvasPositionConversion=p((i,o)=>{const{left:n,top:s,update:a}=useElementBounding(i);return{clientPosToCanvasPos:p(u=>{const{offset:m,scale:f}=o.ds;return[(u[0]-n.value)/f-m[0],(u[1]-s.value)/f-m[1]]},"clientPosToCanvasPos"),canvasPosToClientPos:p(u=>{const{offset:m,scale:f}=o.ds;return[(u[0]+m[0])*f+n.value,(u[1]+m[1])*f+s.value]},"canvasPosToClientPos"),update:a}},"useCanvasPositionConversion");function useSharedCanvasPositionConversion(){if(sharedConverter)return sharedConverter;const i=useCanvasStore().getCanvas();return sharedConverter=useCanvasPositionConversion(i.canvas,i),sharedConverter}p(useSharedCanvasPositionConversion,"useSharedCanvasPositionConversion");const proxyWidgetsPropertySchema=z.array(z.tuple([z.string(),z.string()]));function parseProxyWidgets(i){typeof i=="string"&&(i=JSON.parse(i));const o=proxyWidgetsPropertySchema.safeParse(typeof i=="string"?JSON.parse(i):i);if(o.success)return o.data;const n=fromZodError(o.error);throw new Error(`Invalid assignment for properties.proxyWidgets:
${n}`)}p(parseProxyWidgets,"parseProxyWidgets");const DEFAULT_DOWNLOAD_FILENAME="download.png";function triggerLinkDownload(i,o){const n=document.createElement("a");n.href=i,n.download=o,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}p(triggerLinkDownload,"triggerLinkDownload");function downloadFile(i,o){if(!i||typeof i!="string"||i.trim().length===0)throw new Error("Invalid URL provided for download");const n=o||extractFilenameFromUrl(i)||DEFAULT_DOWNLOAD_FILENAME;triggerLinkDownload(i,n)}p(downloadFile,"downloadFile");function downloadBlob(i,o){const n=URL.createObjectURL(o);triggerLinkDownload(n,i),queueMicrotask(()=>URL.revokeObjectURL(n))}p(downloadBlob,"downloadBlob");const extractFilenameFromUrl=p(i=>{try{return new URL(i,window.location.origin).searchParams.get("filename")}catch{return null}},"extractFilenameFromUrl");class ContextMenu{static{p(this,"ContextMenu")}options;parentMenu;root;current_submenu;lock;controller=new AbortController;constructor(o,n){n||={},this.options=n;const s=n.parentMenu;s&&(s instanceof ContextMenu?(this.parentMenu=s,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this):(console.error("parentMenu must be of class ContextMenu, ignoring it"),n.parentMenu=void 0),s.options?.className==="dark"&&(n.className="dark"));const a=n.event?n.event.constructor.name:null;a!=="MouseEvent"&&a!=="CustomEvent"&&a!=="PointerEvent"&&(console.error(`Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (${a})`),n.event=void 0);const r=document.createElement("div");let l="litegraph litecontextmenu litemenubar-panel";n.className&&(l+=` ${n.className}`),r.className=l,r.style.minWidth="100",r.style.minHeight="100";const{signal:u}=this.controller,m={capture:!0,signal:u};if(this.parentMenu||document.addEventListener("pointerdown",w=>{w.target instanceof Node&&!this.containsNode(w.target)&&this.close()},m),r.addEventListener("pointerup",w=>w.preventDefault(),m),r.addEventListener("contextmenu",w=>{w.button===2&&w.preventDefault()},m),r.addEventListener("pointerdown",w=>{w.button==2&&(this.close(),w.preventDefault())},m),this.root=r,n.title){const w=document.createElement("div");w.className="litemenu-title",w.innerHTML=n.title,r.append(w)}for(let w=0;w<o.length;w++){const k=o[w];let S=Array.isArray(o)?k:String(w);typeof S!="string"&&(S=S!=null?S.content===void 0?String(S):S.content:S),this.addItem(S,k,n)}const _=n.event?.target?.ownerDocument||document;_.fullscreenElement?_.fullscreenElement.append(r):_.body.append(r);let y=n.left||0,b=n.top||0;if(n.event){if(y=n.event.clientX-10,b=n.event.clientY-10,n.title&&(b-=20),s){const S=s.root.getBoundingClientRect();y=S.left+S.width}const w=document.body.getBoundingClientRect(),k=r.getBoundingClientRect();w.height==0&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),w.width&&y>w.width-k.width-10&&(y=w.width-k.width-10),w.height&&b>w.height-k.height-10&&(b=w.height-k.height-10)}r.style.left=`${y}px`,r.style.top=`${b}px`,LiteGraph.context_menu_scaling&&n.scale&&(r.style.transform=`scale(${Math.round(n.scale*4)*.25})`)}containsNode(o,n=new Set){return n.has(this)?!1:(n.add(this),this.current_submenu?.containsNode(o,n)||this.root.contains(o))}addItem(o,n,s){s||={};const a=document.createElement("div");a.className="litemenu-entry submenu";let r=!1;if(n===null)a.classList.add("separator");else{const _=o===null?"":String(o);typeof n=="string"?a.innerHTML=_:(a.innerHTML=n?.title??_,n.disabled&&(r=!0,a.classList.add("disabled"),a.setAttribute("aria-disabled","true")),(n.submenu||n.has_submenu)&&(a.classList.add("has_submenu"),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false")),n.className&&(a.className+=` ${n.className}`)),a.value=n,a.setAttribute("role","menuitem"),typeof n=="function"?(a.dataset.value=String(o),a.onclick_callback=n):a.dataset.value=String(n)}this.root.append(a),r||a.addEventListener("click",f),!r&&s.autoopen&&a.addEventListener("pointerenter",u);const l=p(()=>{const _=this.root.querySelectorAll("div.litemenu-entry.has_submenu");if(_)for(const y of _)y.setAttribute("aria-expanded","false");a.setAttribute("aria-expanded","true")},"setAriaExpanded");function u(_){const y=this.value;!y||!y.has_submenu||(f.call(this,_),l())}p(u,"inner_over");const m=this;function f(_){const y=this.value;let b=!0;if(m.current_submenu?.close(_),(y?.has_submenu||y?.submenu)&&l(),s.callback&&s.callback.call(this,y,s,_,m,s.node)===!0&&(b=!1),typeof y=="object"&&(y.callback&&!s.ignore_item_callbacks&&y.disabled!==!0&&y.callback.call(this,y,s,_,m,s.extra)===!0&&(b=!1),y.submenu)){if(!y.submenu.options)throw"ContextMenu submenu needs options";new m.constructor(y.submenu.options,{callback:y.submenu.callback,event:_,parentMenu:m,ignore_item_callbacks:y.submenu.ignore_item_callbacks,title:y.submenu.title,extra:y.submenu.extra,autoopen:s.autoopen}),b=!1}b&&!m.lock&&m.close()}return p(f,"inner_onclick"),a}close(o,n){this.controller.abort(),this.root.remove(),this.parentMenu&&!n&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=void 0,o===void 0?this.parentMenu.close():o&&!ContextMenu.isCursorOverElement(o,this.parentMenu.root)&&ContextMenu.trigger(this.parentMenu.root,`${LiteGraph.pointerevents_method}leave`,o)),this.current_submenu?.close(o,!0)}static trigger(o,n,s){const a=document.createEvent("CustomEvent");return a.initCustomEvent(n,!0,!0,s),o.dispatchEvent&&o.dispatchEvent(a),a}getTopMenu(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this}getFirstEvent(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event}static isCursorOverElement(o,n){const s=o.clientX,a=o.clientY,r=n.getBoundingClientRect();return r?a>r.top&&a<r.top+r.height&&s>r.left&&s<r.left+r.width:!1}}var NodeSlotType=(i=>(i[i.INPUT=1]="INPUT",i[i.OUTPUT=2]="OUTPUT",i))(NodeSlotType||{}),RenderShape=(i=>(i[i.BOX=1]="BOX",i[i.ROUND=2]="ROUND",i[i.CIRCLE=3]="CIRCLE",i[i.CARD=4]="CARD",i[i.ARROW=5]="ARROW",i[i.GRID=6]="GRID",i[i.HollowCircle=7]="HollowCircle",i))(RenderShape||{}),CanvasItem=(i=>(i[i.Nothing=0]="Nothing",i[i.Node=1]="Node",i[i.Group=2]="Group",i[i.Reroute=4]="Reroute",i[i.Link=8]="Link",i[i.RerouteSlot=32]="RerouteSlot",i[i.SubgraphIoNode=64]="SubgraphIoNode",i[i.SubgraphIoSlot=128]="SubgraphIoSlot",i))(CanvasItem||{}),LinkDirection=(i=>(i[i.NONE=0]="NONE",i[i.UP=1]="UP",i[i.DOWN=2]="DOWN",i[i.LEFT=3]="LEFT",i[i.RIGHT=4]="RIGHT",i[i.CENTER=5]="CENTER",i))(LinkDirection||{}),LinkRenderType=(i=>(i[i.HIDDEN_LINK=-1]="HIDDEN_LINK",i[i.STRAIGHT_LINK=0]="STRAIGHT_LINK",i[i.LINEAR_LINK=1]="LINEAR_LINK",i[i.SPLINE_LINK=2]="SPLINE_LINK",i))(LinkRenderType||{}),LinkMarkerShape=(i=>(i[i.None=0]="None",i[i.Circle=1]="Circle",i[i.Arrow=2]="Arrow",i))(LinkMarkerShape||{}),TitleMode=(i=>(i[i.NORMAL_TITLE=0]="NORMAL_TITLE",i[i.NO_TITLE=1]="NO_TITLE",i[i.TRANSPARENT_TITLE=2]="TRANSPARENT_TITLE",i[i.AUTOHIDE_TITLE=3]="AUTOHIDE_TITLE",i))(TitleMode||{}),LGraphEventMode=(i=>(i[i.ALWAYS=0]="ALWAYS",i[i.ON_EVENT=1]="ON_EVENT",i[i.NEVER=2]="NEVER",i[i.ON_TRIGGER=3]="ON_TRIGGER",i[i.BYPASS=4]="BYPASS",i))(LGraphEventMode||{}),EaseFunction=(i=>(i.EASE_IN_OUT_QUAD="easeInOutQuad",i))(EaseFunction||{}),Alignment=(i=>(i[i.None=0]="None",i[i.Top=1]="Top",i[i.Bottom=2]="Bottom",i[i.Middle=4]="Middle",i[i.Left=8]="Left",i[i.Right=16]="Right",i[i.Centre=32]="Centre",i[i.TopLeft=9]="TopLeft",i[i.TopCentre=33]="TopCentre",i[i.TopRight=17]="TopRight",i[i.MidLeft=12]="MidLeft",i[i.MidCentre=36]="MidCentre",i[i.MidRight=20]="MidRight",i[i.BottomLeft=10]="BottomLeft",i[i.BottomCentre=34]="BottomCentre",i[i.BottomRight=18]="BottomRight",i))(Alignment||{});function hasFlag(i,o){return(i&o)===o}p(hasFlag,"hasFlag");function distance(i,o){return Math.sqrt((o[0]-i[0])*(o[0]-i[0])+(o[1]-i[1])*(o[1]-i[1]))}p(distance,"distance");function dist2(i,o,n,s){return(n-i)*(n-i)+(s-o)*(s-o)}p(dist2,"dist2");function isInRectangle(i,o,n,s,a,r){return i>=n&&i<n+a&&o>=s&&o<s+r}p(isInRectangle,"isInRectangle");function isPointInRect(i,o){return i[0]>=o[0]&&i[0]<o[0]+o[2]&&i[1]>=o[1]&&i[1]<o[1]+o[3]}p(isPointInRect,"isPointInRect");function isInRect(i,o,n){return i>=n[0]&&i<n[0]+n[2]&&o>=n[1]&&o<n[1]+n[3]}p(isInRect,"isInRect");function isInsideRectangle(i,o,n,s,a,r){return n<i&&n+a>i&&s<o&&s+r>o}p(isInsideRectangle,"isInsideRectangle");function overlapBounding(i,o){const n=i[0]+i[2],s=i[1]+i[3],a=o[0]+o[2],r=o[1]+o[3];return!(i[0]>a||i[1]>r||n<o[0]||s<o[1])}p(overlapBounding,"overlapBounding");function getCentre(i){return[i[0]+i[2]*.5,i[1]+i[3]*.5]}p(getCentre,"getCentre");function containsCentre(i,o){const n=o[0]+o[2]*.5,s=o[1]+o[3]*.5;return isInRect(n,s,i)}p(containsCentre,"containsCentre");function containsRect(i,o){const n=i[0]+i[2],s=i[1]+i[3],a=o[0]+o[2],r=o[1]+o[3];return!(i[0]===o[0]&&i[1]===o[1]&&n===a&&s===r)&&i[0]<=o[0]&&i[1]<=o[1]&&n>=a&&s>=r}p(containsRect,"containsRect");function createBounds(i,o=10){const n=[1/0,1/0,-1/0,-1/0];for(const s of i){const a=s.boundingRect;n[0]=Math.min(n[0],a[0]),n[1]=Math.min(n[1],a[1]),n[2]=Math.max(n[2],a[0]+a[2]),n[3]=Math.max(n[3],a[1]+a[3])}return n.every(s=>isFinite(s))?[n[0]-o,n[1]-o,n[2]-n[0]+2*o,n[3]-n[1]+2*o]:null}p(createBounds,"createBounds");function snapPoint(i,o){return o?(i[0]=o*Math.round(i[0]/o),i[1]=o*Math.round(i[1]/o),!0):!1}p(snapPoint,"snapPoint");function alignToContainer(i,o,[n,s,a,r],[l,u]=[0,0]){return hasFlag(o,Alignment.Left)?i[0]=n+l:hasFlag(o,Alignment.Right)?i[0]=n+a-l-i[2]:hasFlag(o,Alignment.Centre)&&(i[0]=n+a*.5-i[2]*.5),hasFlag(o,Alignment.Top)?i[1]=s+u:hasFlag(o,Alignment.Bottom)?i[1]=s+r-u-i[3]:hasFlag(o,Alignment.Middle)&&(i[1]=s+r*.5-i[3]*.5),i}p(alignToContainer,"alignToContainer");function alignOutsideContainer(i,o,[n,s,a,r],[l,u]=[0,0]){return hasFlag(o,Alignment.Left)?i[0]=n-l-i[2]:hasFlag(o,Alignment.Right)?i[0]=n+a+l:hasFlag(o,Alignment.Centre)&&(i[0]=n+a*.5-i[2]*.5),hasFlag(o,Alignment.Top)?i[1]=s-u-i[3]:hasFlag(o,Alignment.Bottom)?i[1]=s+r+u:hasFlag(o,Alignment.Middle)&&(i[1]=s+r*.5-i[3]*.5),i}p(alignOutsideContainer,"alignOutsideContainer");class CurveEditor{static{p(this,"CurveEditor")}points;selected;nearest;size;must_update;margin;_nearest;constructor(o){this.points=o,this.selected=-1,this.nearest=-1,this.size=null,this.must_update=!0,this.margin=5}static sampleCurve(o,n){if(n){for(let s=0;s<n.length-1;++s){const a=n[s],r=n[s+1];if(r[0]<o)continue;const l=r[0]-a[0];if(Math.abs(l)<1e-5)return a[1];const u=(o-a[0])/l;return a[1]*(1-u)+r[1]*u}return 0}}draw(o,n,s,a,r,l=!1){const u=this.points;if(!u)return;this.size=n;const m=n[0]-this.margin*2,f=n[1]-this.margin*2;r=r||"#666",o.save(),o.translate(this.margin,this.margin),a&&(o.fillStyle="#111",o.fillRect(0,0,m,f),o.fillStyle="#222",o.fillRect(m*.5,0,1,f),o.strokeStyle="#333",o.strokeRect(0,0,m,f)),o.strokeStyle=r,l&&(o.globalAlpha=.5),o.beginPath();for(const _ of u)o.lineTo(_[0]*m,(1-_[1])*f);if(o.stroke(),o.globalAlpha=1,!l)for(const[_,y]of u.entries())o.fillStyle=this.selected==_?"#FFF":this.nearest==_?"#DDD":"#AAA",o.beginPath(),o.arc(y[0]*m,(1-y[1])*f,2,0,Math.PI*2),o.fill();o.restore()}onMouseDown(o,n){const s=this.points;if(!s||o[1]<0)return;if(this.size==null)throw new Error("CurveEditor.size was null or undefined.");const a=this.size[0]-this.margin*2,r=this.size[1]-this.margin*2,l=o[0]-this.margin,u=o[1]-this.margin,m=[l,u],f=30/n.ds.scale;if(this.selected=this.getCloserPoint(m,f),this.selected==-1){const _=[l/a,1-u/r];s.push(_),s.sort(function(y,b){return y[0]-b[0]}),this.selected=s.indexOf(_),this.must_update=!0}if(this.selected!=-1)return!0}onMouseMove(o,n){const s=this.points;if(!s)return;const a=this.selected;if(a<0)return;if(this.size==null)throw new Error("CurveEditor.size was null or undefined.");const r=(o[0]-this.margin)/(this.size[0]-this.margin*2),l=(o[1]-this.margin)/(this.size[1]-this.margin*2),u=[o[0]-this.margin,o[1]-this.margin],m=30/n.ds.scale;this._nearest=this.getCloserPoint(u,m);const f=s[a];if(f){const _=a==0||a==s.length-1;if(!_&&(o[0]<-10||o[0]>this.size[0]+10||o[1]<-10||o[1]>this.size[1]+10)){s.splice(a,1),this.selected=-1;return}_?f[0]=a==0?0:1:f[0]=clamp(r,0,1),f[1]=1-clamp(l,0,1),s.sort(function(y,b){return y[0]-b[0]}),this.selected=s.indexOf(f),this.must_update=!0}}onMouseUp(){return this.selected=-1,!1}getCloserPoint(o,n){const s=this.points;if(!s)return-1;if(n=n||30,this.size==null)throw new Error("CurveEditor.size was null or undefined.");const a=this.size[0]-this.margin*2,r=this.size[1]-this.margin*2,l=s.length,u=[0,0];let m=1e6,f=-1;for(let _=0;_<l;++_){const y=s[_];u[0]=y[0]*a,u[1]=(1-y[1])*r;const b=distance(o,u);b>m||b>n||(f=_,m=b)}return f}}class DragAndScale{static{p(this,"DragAndScale")}state;lastState={offset:[0,0],scale:0};max_scale;min_scale;enabled;last_mouse;element;visible_area;dragging;viewport;get offset(){return this.state.offset}set offset(o){this.state.offset[0]=o[0],this.state.offset[1]=o[1]}get scale(){return this.state.scale}set scale(o){this.state.scale=o}constructor(o){this.state={offset:[0,0],scale:1},this.max_scale=10,this.min_scale=.1,this.enabled=!0,this.last_mouse=[0,0],this.visible_area=new Rectangle,this.element=o}#e(){const o=this.state,n=this.lastState;return o.scale!==n.scale||o.offset[0]!==n.offset[0]||o.offset[1]!==n.offset[1]}computeVisibleArea(o){const{scale:n,offset:s,visible_area:a}=this;if(this.#e()&&(this.onChanged?.(n,s),copyState(this.state,this.lastState)),!this.element){a[0]=a[1]=a[2]=a[3]=0;return}let{width:r,height:l}=this.element,u=-s[0],m=-s[1];o&&(u+=o[0]/n,m+=o[1]/n,r=o[2],l=o[3]);const f=u+r/n,_=m+l/n;a[0]=u,a[1]=m,a.resizeBottomRight(f,_)}toCanvasContext(o){o.scale(this.scale,this.scale),o.translate(this.offset[0],this.offset[1])}convertOffsetToCanvas(o){return[(o[0]+this.offset[0])*this.scale,(o[1]+this.offset[1])*this.scale]}convertCanvasToOffset(o,n){return n=n||[0,0],n[0]=o[0]/this.scale-this.offset[0],n[1]=o[1]/this.scale-this.offset[1],n}mouseDrag(o,n){this.offset[0]+=o/this.scale,this.offset[1]+=n/this.scale,this.onredraw?.(this)}changeScale(o,n,s=!0){if(o<this.min_scale?o=this.min_scale:o>this.max_scale&&(o=this.max_scale),o==this.scale)return;const a=this.element.getBoundingClientRect();if(!a)return;n=n??[a.width*.5,a.height*.5];const r=[n[0]-a.x,n[1]-a.y],l=this.convertCanvasToOffset(r);this.scale=o,s&&Math.abs(this.scale-1)<.01&&(this.scale=1);const u=this.convertCanvasToOffset(r),m=[u[0]-l[0],u[1]-l[1]];this.offset[0]+=m[0],this.offset[1]+=m[1],this.onredraw?.(this)}changeDeltaScale(o,n){this.changeScale(this.scale*o,n)}fitToBounds(o,{zoom:n=.75}={}){const s=this.element.width/window.devicePixelRatio,a=this.element.height/window.devicePixelRatio;let r=this.scale;if(n>0){const _=n*s/Math.max(o[2],300),y=n*a/Math.max(o[3],300);r=Math.min(_,y,this.max_scale)}const l=s/r,u=a/r,m=-o[0]-o[2]*.5+l*.5,f=-o[1]-o[3]*.5+u*.5;this.offset[0]=m,this.offset[1]=f,this.scale=r}animateToBounds(o,n,{duration:s=350,zoom:a=.75,easing:r=EaseFunction.EASE_IN_OUT_QUAD}={}){if(!(s>0))throw new RangeError("Duration must be greater than 0");const l={linear:p(M=>M,"linear"),easeInQuad:p(M=>M*M,"easeInQuad"),easeOutQuad:p(M=>M*(2-M),"easeOutQuad"),easeInOutQuad:p(M=>M<.5?2*M*M:-1+(4-2*M)*M,"easeInOutQuad")},u=l[r]??l.linear,m=performance.now(),f=this.element.width/window.devicePixelRatio,_=this.element.height/window.devicePixelRatio,y=this.offset[0],b=this.offset[1],w=y-f/this.scale,k=b-_/this.scale;let C=this.scale;if(a>0){const M=a*f/Math.max(o[2],300),P=a*_/Math.max(o[3],300);C=Math.min(M,P,this.max_scale)}const I=f/C,T=_/C,E=-o[0]-o[2]*.5+I*.5,N=-o[1]-o[3]*.5+T*.5,L=E-I,A=N-T,D=p(M=>{const P=M-m,R=Math.min(P/s,1),V=u(R),$=y+(E-y)*V,F=b+(N-b)*V;if(this.offset[0]=$,this.offset[1]=F,a>0){const j=w+(L-w)*V,U=k+(A-k)*V,G=Math.abs(j-$),H=Math.abs(U-F);this.scale=Math.min(f/G,_/H)}n(),R<1?O=requestAnimationFrame(D):cancelAnimationFrame(O)},"animate");let O=requestAnimationFrame(D)}reset(){this.scale=1,this.offset[0]=0,this.offset[1]=0}}function copyState(i,o){o.scale=i.scale,o.offset[0]=i.offset[0],o.offset[1]=i.offset[1]}p(copyState,"copyState");const SUBGRAPH_INPUT_ID=-10,SUBGRAPH_OUTPUT_ID=-20,zeroUuid="00000000-0000-0000-0000-000000000000",randomStorage=new Uint32Array(31);function createUuidv4(){if(typeof crypto?.randomUUID=="function")return crypto.randomUUID();if(typeof crypto?.getRandomValues=="function"){const i=crypto.getRandomValues(randomStorage);let o=0;return"10000000-1000-4000-8000-100000000000".replaceAll(/[018]/g,n=>(Number(n)^i[o++]*3725290298461914e-24>>Number(n)*.25).toString(16))}return"10000000-1000-4000-8000-100000000000".replaceAll(/[018]/g,i=>(Number(i)^Math.random()*16>>Number(i)*.25).toString(16))}p(createUuidv4,"createUuidv4");const removeNodeTitleHeight=p(i=>Math.max(0,i-(LiteGraph.NODE_TITLE_HEIGHT||0)),"removeNodeTitleHeight"),addNodeTitleHeight=p(i=>i+LiteGraph.NODE_TITLE_HEIGHT,"addNodeTitleHeight");var LayoutSource=(i=>(i.Canvas="canvas",i.Vue="vue",i.DOM="dom",i.External="external",i))(LayoutSource||{});const QUADTREE_CONFIG={DEFAULT_BOUNDS:{x:-1e4,y:-1e4,width:2e4,height:2e4},MAX_DEPTH:6,MAX_ITEMS_PER_NODE:4},PERFORMANCE_CONFIG={CHANGE_DETECTION_INTERVAL:16,SPATIAL_CACHE_TTL:1e3,SPATIAL_CACHE_MAX_SIZE:100,BATCH_UPDATE_DELAY:4},ACTOR_CONFIG={USER_PREFIX:"user-",ID_LENGTH:9,DEFAULT_SOURCE:LayoutSource.External};function toPoint(i,o){return{x:i,y:o}}p(toPoint,"toPoint");function isPointEqual(i,o){return i.x===o.x&&i.y===o.y}p(isPointEqual,"isPointEqual");function isBoundsEqual(i,o){return i.x===o.x&&i.y===o.y&&i.width===o.width&&i.height===o.height}p(isBoundsEqual,"isBoundsEqual");function isSizeEqual(i,o){return i.width===o.width&&i.height===o.height}p(isSizeEqual,"isSizeEqual");const REROUTE_RADIUS=8;function pointInBounds(i,o){return i.x>=o.x&&i.x<=o.x+o.width&&i.y>=o.y&&i.y<=o.y+o.height}p(pointInBounds,"pointInBounds");function boundsIntersect(i,o){return!(i.x+i.width<o.x||o.x+o.width<i.x||i.y+i.height<o.y||o.y+o.height<i.y)}p(boundsIntersect,"boundsIntersect");function calculateBounds(i){let o=1/0,n=1/0,s=-1/0,a=-1/0;for(const r of i){const l=r.bounds;o=Math.min(o,l.x),n=Math.min(n,l.y),s=Math.max(s,l.x+l.width),a=Math.max(a,l.y+l.height)}return{x:o,y:n,width:s-o,height:a-n}}p(calculateBounds,"calculateBounds");function selectionBounds(i){return i.length===0?null:calculateBounds(i)}p(selectionBounds,"selectionBounds");function makeLinkSegmentKey(i,o){return`${i}:${o??"final"}`}p(makeLinkSegmentKey,"makeLinkSegmentKey");const NODE_LAYOUT_DEFAULTS={id:"unknown-node",position:{x:0,y:0},size:{width:100,height:50},zIndex:0,visible:!0,bounds:{x:0,y:0,width:100,height:50}};function layoutToYNode(i){const o=new YMap;return o.set("id",i.id),o.set("position",i.position),o.set("size",i.size),o.set("zIndex",i.zIndex),o.set("visible",i.visible),o.set("bounds",i.bounds),o}p(layoutToYNode,"layoutToYNode");function getOr(i,o,n){return i.get(o)??n}p(getOr,"getOr");function yNodeToLayout(i){return{id:getOr(i,"id",NODE_LAYOUT_DEFAULTS.id),position:getOr(i,"position",NODE_LAYOUT_DEFAULTS.position),size:getOr(i,"size",NODE_LAYOUT_DEFAULTS.size),zIndex:getOr(i,"zIndex",NODE_LAYOUT_DEFAULTS.zIndex),visible:getOr(i,"visible",NODE_LAYOUT_DEFAULTS.visible),bounds:getOr(i,"bounds",NODE_LAYOUT_DEFAULTS.bounds)}}p(yNodeToLayout,"yNodeToLayout");class QuadNode{static{p(this,"QuadNode")}bounds;depth;maxDepth;maxItems;items=[];children=null;divided=!1;constructor(o,n=0,s=5,a=4){this.bounds=o,this.depth=n,this.maxDepth=s,this.maxItems=a}insert(o){if(!this.contains(o.bounds))return!1;if(this.items.length<this.maxItems&&!this.divided)return this.items.push(o),!0;if(!this.divided&&this.depth<this.maxDepth&&this.subdivide(),this.divided&&this.children){for(const n of this.children)if(n.insert(o))return!0}return this.items.push(o),!0}remove(o){const n=this.items.findIndex(s=>s.id===o.id);if(n!==-1)return this.items.splice(n,1),!0;if(this.divided&&this.children){for(const s of this.children)if(s.remove(o))return!0}return!1}query(o,n=[]){if(!this.intersects(o))return n;for(const s of this.items)this.boundsIntersect(s.bounds,o)&&n.push(s);if(this.divided&&this.children)for(const s of this.children)s.query(o,n);return n}subdivide(){const{x:o,y:n,width:s,height:a}=this.bounds,r=s/2,l=a/2;this.children=[new QuadNode({x:o,y:n,width:r,height:l},this.depth+1,this.maxDepth,this.maxItems),new QuadNode({x:o+r,y:n,width:r,height:l},this.depth+1,this.maxDepth,this.maxItems),new QuadNode({x:o,y:n+l,width:r,height:l},this.depth+1,this.maxDepth,this.maxItems),new QuadNode({x:o+r,y:n+l,width:r,height:l},this.depth+1,this.maxDepth,this.maxItems)],this.divided=!0;const u=[...this.items];this.items=[];for(const m of u){let f=!1;for(const _ of this.children)if(_.insert(m)){f=!0;break}f||this.items.push(m)}}contains(o){return o.x>=this.bounds.x&&o.y>=this.bounds.y&&o.x+o.width<=this.bounds.x+this.bounds.width&&o.y+o.height<=this.bounds.y+this.bounds.height}intersects(o){return this.boundsIntersect(this.bounds,o)}boundsIntersect(o,n){return!(o.x+o.width<n.x||n.x+n.width<o.x||o.y+o.height<n.y||n.y+n.height<o.y)}getDebugInfo(){return{bounds:this.bounds,depth:this.depth,itemCount:this.items.length,divided:this.divided,children:this.children?.map(o=>o.getDebugInfo())}}}class QuadTree{static{p(this,"QuadTree")}root;itemMap=new Map;options;constructor(o,n={}){this.options={maxDepth:n.maxDepth??5,maxItemsPerNode:n.maxItemsPerNode??4,minNodeSize:n.minNodeSize??50},this.root=new QuadNode(o,0,this.options.maxDepth,this.options.maxItemsPerNode)}insert(o,n,s){const a={id:o,bounds:n,data:s};this.itemMap.has(o)&&this.remove(o);const r=this.root.insert(a);return r&&this.itemMap.set(o,a),r}remove(o){const n=this.itemMap.get(o);if(!n)return!1;const s=this.root.remove(n);return s&&this.itemMap.delete(o),s}update(o,n){const s=this.itemMap.get(o);if(!s)return!1;const a=s.data;return this.remove(o),this.insert(o,n,a)}query(o){return this.root.query(o).map(s=>s.data)}clear(){this.root=new QuadNode(this.root.bounds,0,this.options.maxDepth,this.options.maxItemsPerNode),this.itemMap.clear()}get size(){return this.itemMap.size}getDebugInfo(){return{size:this.size,tree:this.root.getDebugInfo()}}}class SpatialIndexManager{static{p(this,"SpatialIndexManager")}quadTree;queryCache;cacheSize=0;constructor(o){this.quadTree=new QuadTree(o??QUADTREE_CONFIG.DEFAULT_BOUNDS,{maxDepth:QUADTREE_CONFIG.MAX_DEPTH,maxItemsPerNode:QUADTREE_CONFIG.MAX_ITEMS_PER_NODE}),this.queryCache=new Map}insert(o,n){this.quadTree.insert(o,n,o),this.invalidateCache()}update(o,n){this.quadTree.update(o,n),this.invalidateCache()}batchUpdate(o){for(const{nodeId:n,bounds:s}of o)this.quadTree.update(n,s);this.invalidateCache()}remove(o){this.quadTree.remove(o),this.invalidateCache()}query(o){const n=this.getCacheKey(o),s=this.queryCache.get(n);if(s){if(Date.now()-s.timestamp<PERFORMANCE_CONFIG.SPATIAL_CACHE_TTL)return s.result;this.queryCache.delete(n),this.cacheSize--}const a=this.quadTree.query(o);return this.addToCache(n,a),a}clear(){this.quadTree.clear(),this.invalidateCache()}get size(){return this.quadTree.size}getDebugInfo(){return{quadTreeInfo:this.quadTree.getDebugInfo(),cacheSize:this.cacheSize,cacheEntries:this.queryCache.size}}getCacheKey(o){return`${o.x},${o.y},${o.width},${o.height}`}addToCache(o,n){if(this.cacheSize>=PERFORMANCE_CONFIG.SPATIAL_CACHE_MAX_SIZE){const s=this.findOldestCacheEntry();s&&(this.queryCache.delete(s),this.cacheSize--)}this.queryCache.set(o,{result:n,timestamp:Date.now()}),this.cacheSize++}findOldestCacheEntry(){let o=null,n=1/0;for(const[s,a]of this.queryCache)a.timestamp<n&&(n=a.timestamp,o=s);return o}invalidateCache(){this.queryCache.clear(),this.cacheSize=0}}const logger$2=log.getLogger("LayoutStore");function asRerouteId(i){return Number(i)}p(asRerouteId,"asRerouteId");function asLinkId(i){return Number(i)}p(asLinkId,"asLinkId");class LayoutStoreImpl{static{p(this,"LayoutStoreImpl")}static REROUTE_DEFAULTS={id:0,position:{x:0,y:0},parentId:0,linkIds:[]};ydoc=new Doc;ynodes;ylinks;yreroutes;yoperations;version=0;currentSource=ACTOR_CONFIG.DEFAULT_SOURCE;currentActor=`${ACTOR_CONFIG.USER_PREFIX}${Math.random().toString(36).substring(2,2+ACTOR_CONFIG.ID_LENGTH)}`;changeListeners=new Set;nodeRefs=new Map;nodeTriggers=new Map;linkLayouts=new Map;linkSegmentLayouts=new Map;slotLayouts=new Map;rerouteLayouts=new Map;spatialIndex;linkSegmentSpatialIndex;slotSpatialIndex;rerouteSpatialIndex;isDraggingVueNodes=ref(!1);isResizingVueNodes=ref(!1);constructor(){this.ynodes=this.ydoc.getMap("nodes"),this.ylinks=this.ydoc.getMap("links"),this.yreroutes=this.ydoc.getMap("reroutes"),this.yoperations=this.ydoc.getArray("operations"),this.spatialIndex=new SpatialIndexManager,this.linkSegmentSpatialIndex=new SpatialIndexManager,this.slotSpatialIndex=new SpatialIndexManager,this.rerouteSpatialIndex=new SpatialIndexManager,this.ynodes.observe(o=>{this.version++,o.changes.keys.forEach((n,s)=>{const a=this.nodeTriggers.get(s);a&&a()})}),this.ylinks.observe(o=>{this.version++,o.changes.keys.forEach((n,s)=>{this.handleLinkChange(n,s)})}),this.yreroutes.observe(o=>{this.version++,o.changes.keys.forEach((n,s)=>{this.handleRerouteChange(n,s)})})}getLinkField(o,n){return o.get(n)}getRerouteField(o,n,s=LayoutStoreImpl.REROUTE_DEFAULTS[n]){return o.get(n)??s}getNodeLayoutRef(o){let n=this.nodeRefs.get(o);return n||(n=customRef((s,a)=>(this.nodeTriggers.set(o,a),{get:p(()=>{s();const r=this.ynodes.get(o);return r?yNodeToLayout(r):null},"get"),set:p(r=>{if(r===null){const l=this.ynodes.get(o);l&&this.applyOperation({type:"deleteNode",entity:"node",nodeId:o,timestamp:Date.now(),source:this.currentSource,actor:this.currentActor,previousLayout:yNodeToLayout(l)})}else{const l=this.ynodes.get(o);if(!l)this.applyOperation({type:"createNode",entity:"node",nodeId:o,layout:r,timestamp:Date.now(),source:this.currentSource,actor:this.currentActor});else{const u=yNodeToLayout(l);(u.position.x!==r.position.x||u.position.y!==r.position.y)&&this.applyOperation({type:"moveNode",entity:"node",nodeId:o,position:r.position,previousPosition:u.position,timestamp:Date.now(),source:this.currentSource,actor:this.currentActor}),(u.size.width!==r.size.width||u.size.height!==r.size.height)&&this.applyOperation({type:"resizeNode",entity:"node",nodeId:o,size:r.size,previousSize:u.size,timestamp:Date.now(),source:this.currentSource,actor:this.currentActor}),u.zIndex!==r.zIndex&&this.applyOperation({type:"setNodeZIndex",entity:"node",nodeId:o,zIndex:r.zIndex,previousZIndex:u.zIndex,timestamp:Date.now(),source:this.currentSource,actor:this.currentActor})}}a()},"set")})),this.nodeRefs.set(o,n)),n}getNodesInBounds(o){return computed(()=>{this.version;const n=[];for(const[s]of this.ynodes){const a=this.ynodes.get(s);if(a){const r=yNodeToLayout(a);r&&boundsIntersect(r.bounds,o)&&n.push(s)}}return n})}getAllNodes(){return computed(()=>{this.version;const o=new Map;for(const[n]of this.ynodes){const s=this.ynodes.get(n);if(s){const a=yNodeToLayout(s);a&&o.set(n,a)}}return o})}getVersion(){return computed(()=>this.version)}queryNodeAtPoint(o){const n=[];for(const[s]of this.ynodes){const a=this.ynodes.get(s);if(a){const r=yNodeToLayout(a);r&&n.push([s,r])}}n.sort(([,s],[,a])=>a.zIndex-s.zIndex);for(const[s,a]of n)if(pointInBounds(o,a.bounds))return s;return null}queryNodesInBounds(o){return this.spatialIndex.query(o)}updateLinkLayout(o,n){const s=this.linkLayouts.get(o);if(s&&isBoundsEqual(s.bounds,n.bounds)&&isPointEqual(s.centerPos,n.centerPos)){n.path&&(s.path=n.path);return}this.linkLayouts.set(o,n)}deleteLinkLayout(o){if(this.linkLayouts.delete(o)){const s=[];for(const[a]of this.linkSegmentLayouts)a.startsWith(`${o}:`)&&s.push(a);for(const a of s)this.linkSegmentLayouts.delete(a),this.linkSegmentSpatialIndex.remove(a)}}updateSlotLayout(o,n){const s=this.slotLayouts.get(o);if(s){if(isPointEqual(s.position,n.position)&&isBoundsEqual(s.bounds,n.bounds))return;this.slotSpatialIndex.update(o,n.bounds)}else this.slotSpatialIndex.insert(o,n.bounds);this.slotLayouts.set(o,n)}batchUpdateSlotLayouts(o){if(o.length)for(const{key:n,layout:s}of o){const a=this.slotLayouts.get(n);if(a){if(isPointEqual(a.position,s.position)&&isBoundsEqual(a.bounds,s.bounds))continue;this.slotSpatialIndex.update(n,s.bounds)}else this.slotSpatialIndex.insert(n,s.bounds);this.slotLayouts.set(n,s)}}deleteSlotLayout(o){this.slotLayouts.delete(o)&&this.slotSpatialIndex.remove(o)}deleteNodeSlotLayouts(o){const n=[];for(const[s,a]of this.slotLayouts)a.nodeId===o&&n.push(s);for(const s of n)this.slotLayouts.delete(s),this.slotSpatialIndex.remove(s)}clearAllSlotLayouts(){this.slotLayouts.clear(),this.slotSpatialIndex.clear()}updateRerouteLayout(o,n){const s=this.rerouteLayouts.get(o);s||logger$2.debug("Adding reroute layout:",{rerouteId:o,position:n.position,bounds:n.bounds}),s?this.rerouteSpatialIndex.update(String(o),n.bounds):this.rerouteSpatialIndex.insert(String(o),n.bounds),this.rerouteLayouts.set(o,n)}deleteRerouteLayout(o){this.rerouteLayouts.delete(o)&&this.rerouteSpatialIndex.remove(String(o))}getLinkLayout(o){return this.linkLayouts.get(o)||null}getSlotLayout(o){return this.slotLayouts.get(o)||null}getRerouteLayout(o){return this.rerouteLayouts.get(o)||null}getAllSlotKeys(){return Array.from(this.slotLayouts.keys())}updateLinkSegmentLayout(o,n,s){const a=makeLinkSegmentKey(o,n),r=this.linkSegmentLayouts.get(a);if(r&&isBoundsEqual(r.bounds,s.bounds)&&isPointEqual(r.centerPos,s.centerPos)){s.path&&(r.path=s.path);return}const l={...s,linkId:o,rerouteId:n};r||logger$2.debug("Adding link segment:",{linkId:o,rerouteId:n,bounds:s.bounds,hasPath:!!s.path}),r?this.linkSegmentSpatialIndex.update(a,s.bounds):this.linkSegmentSpatialIndex.insert(a,s.bounds),this.linkSegmentLayouts.set(a,l)}deleteLinkSegmentLayout(o,n){const s=makeLinkSegmentKey(o,n);this.linkSegmentLayouts.delete(s)&&this.linkSegmentSpatialIndex.remove(s)}queryLinkSegmentAtPoint(o,n){const s=n?.lineWidth??10,a=Math.max(10,s),r={x:o.x-a,y:o.y-a,width:a*2,height:a*2},l=this.linkSegmentSpatialIndex.query(r);l.length>0&&logger$2.debug("Checking link segments at point:",{point:o,candidateCount:l.length,tolerance:s});for(const u of l){const m=this.linkSegmentLayouts.get(u);if(m){if(n&&m.path){const f=typeof window<"u"&&window?.devicePixelRatio||1;if(n.isPointInStroke(m.path,o.x*f,o.y*f))return logger$2.debug("Link segment hit:",{linkId:m.linkId,rerouteId:m.rerouteId,point:o}),{linkId:m.linkId,rerouteId:m.rerouteId}}else if(pointInBounds(o,m.bounds))return{linkId:m.linkId,rerouteId:m.rerouteId}}}return null}queryLinkAtPoint(o,n){const s=this.queryLinkSegmentAtPoint(o,n);return s?s.linkId:null}querySlotAtPoint(o){const n={x:o.x-10,y:o.y-10,width:20,height:20},s=this.slotSpatialIndex.query(n);for(const a of s){const r=this.slotLayouts.get(a);if(r&&pointInBounds(o,r.bounds))return r}return null}queryRerouteAtPoint(o){const s={x:o.x-20,y:o.y-20,width:40,height:40},a=this.rerouteSpatialIndex.query(s);a.length>0&&logger$2.debug("Checking reroutes at point:",{point:o,candidateCount:a.length});for(const r of a){const l=asRerouteId(r),u=this.rerouteLayouts.get(l);if(u){const m=o.x-u.position.x,f=o.y-u.position.y,_=Math.sqrt(m*m+f*f);if(_<=u.radius)return logger$2.debug("Reroute hit:",{rerouteId:u.id,position:u.position,distance:_}),u}}return null}queryItemsInBounds(o){const n=this.linkSegmentSpatialIndex.query(o),s=new Set;for(const a of n){const r=this.linkSegmentLayouts.get(a);r&&s.add(r.linkId)}return{nodes:this.queryNodesInBounds(o),links:Array.from(s),slots:this.slotSpatialIndex.query(o),reroutes:this.rerouteSpatialIndex.query(o).map(a=>asRerouteId(a))}}applyOperation(o){const n={type:"update",nodeIds:[],timestamp:o.timestamp,source:o.source,operation:o};this.ydoc.transact(()=>{this.yoperations.push([o]),this.applyOperationInTransaction(o,n)},this.currentActor),this.finalizeOperation(n)}applyOperationInTransaction(o,n){switch(o.type){case"moveNode":this.handleMoveNode(o,n);break;case"resizeNode":this.handleResizeNode(o,n);break;case"setNodeZIndex":this.handleSetNodeZIndex(o,n);break;case"createNode":this.handleCreateNode(o,n);break;case"deleteNode":this.handleDeleteNode(o,n);break;case"batchUpdateBounds":this.handleBatchUpdateBounds(o,n);break;case"createLink":this.handleCreateLink(o,n);break;case"deleteLink":this.handleDeleteLink(o,n);break;case"createReroute":this.handleCreateReroute(o,n);break;case"deleteReroute":this.handleDeleteReroute(o,n);break;case"moveReroute":this.handleMoveReroute(o,n);break}}finalizeOperation(o){this.version++,o.nodeIds.forEach(n=>{const s=this.nodeTriggers.get(n);s&&s()}),setTimeout(()=>this.notifyChange(o),0)}onChange(o){return this.changeListeners.add(o),()=>this.changeListeners.delete(o)}setSource(o){this.currentSource=o}setActor(o){this.currentActor=o}getCurrentSource(){return this.currentSource}getCurrentActor(){return this.currentActor}cleanupNodeRef(o){this.nodeRefs.delete(o),this.nodeTriggers.delete(o)}initializeFromLiteGraph(o){this.ydoc.transact(()=>{this.ynodes.clear(),this.spatialIndex.clear(),this.linkSegmentSpatialIndex.clear(),this.slotSpatialIndex.clear(),this.rerouteSpatialIndex.clear(),this.linkLayouts.clear(),this.linkSegmentLayouts.clear(),this.slotLayouts.clear(),this.rerouteLayouts.clear(),o.forEach((n,s)=>{const a={id:n.id.toString(),position:{x:n.pos[0],y:n.pos[1]},size:{width:n.size[0],height:n.size[1]},zIndex:s,visible:!0,bounds:{x:n.pos[0],y:n.pos[1],width:n.size[0],height:n.size[1]}};this.ynodes.set(a.id,layoutToYNode(a)),this.spatialIndex.insert(a.id,a.bounds)}),this.nodeTriggers.forEach(n=>n())},"initialization")}handleMoveNode(o,n){const s=this.ynodes.get(o.nodeId);if(!s)return;const a=yNodeToLayout(s).size,r={x:o.position.x,y:o.position.y,width:a.width,height:a.height};this.spatialIndex.update(o.nodeId,r),s.set("position",o.position),this.updateNodeBounds(s,o.position,a),n.nodeIds.push(o.nodeId)}handleResizeNode(o,n){const s=this.ynodes.get(o.nodeId);if(!s)return;const a=yNodeToLayout(s).position,r={x:a.x,y:a.y,width:o.size.width,height:o.size.height};this.spatialIndex.update(o.nodeId,r),s.set("size",o.size),this.updateNodeBounds(s,a,o.size),n.nodeIds.push(o.nodeId)}handleSetNodeZIndex(o,n){const s=this.ynodes.get(o.nodeId);s&&(s.set("zIndex",o.zIndex),n.nodeIds.push(o.nodeId))}handleCreateNode(o,n){const s=layoutToYNode(o.layout);this.ynodes.set(o.nodeId,s),this.spatialIndex.insert(o.nodeId,o.layout.bounds),n.type="create",n.nodeIds.push(o.nodeId)}handleDeleteNode(o,n){if(!this.ynodes.has(o.nodeId))return;this.ynodes.delete(o.nodeId),this.spatialIndex.remove(o.nodeId),this.deleteNodeSlotLayouts(o.nodeId);const s=this.findLinksConnectedToNode(o.nodeId);for(const a of s)this.ylinks.delete(String(a)),this.linkLayouts.delete(a),this.cleanupLinkSegments(a);n.type="delete",n.nodeIds.push(o.nodeId)}handleBatchUpdateBounds(o,n){const s=[];for(const a of o.nodeIds){const r=o.bounds[a],l=this.ynodes.get(a);!l||!r||(l.set("position",{x:r.bounds.x,y:r.bounds.y}),l.set("size",{width:r.bounds.width,height:r.bounds.height}),l.set("bounds",r.bounds),s.push({nodeId:a,bounds:r.bounds}),n.nodeIds.push(a))}s.length>0&&this.spatialIndex.batchUpdate(s),n.nodeIds.length&&(n.type="update")}handleCreateLink(o,n){const s=new YMap;s.set("id",o.linkId),s.set("sourceNodeId",o.sourceNodeId),s.set("sourceSlot",o.sourceSlot),s.set("targetNodeId",o.targetNodeId),s.set("targetSlot",o.targetSlot),this.ylinks.set(String(o.linkId),s),n.type="create"}handleDeleteLink(o,n){this.ylinks.has(String(o.linkId))&&(this.ylinks.delete(String(o.linkId)),this.linkLayouts.delete(o.linkId),this.cleanupLinkSegments(o.linkId),n.type="delete")}handleCreateReroute(o,n){const s=new YMap;s.set("id",o.rerouteId),s.set("position",o.position),s.set("parentId",o.parentId),s.set("linkIds",o.linkIds),this.yreroutes.set(String(o.rerouteId),s),n.type="create"}handleDeleteReroute(o,n){this.yreroutes.has(String(o.rerouteId))&&(this.yreroutes.delete(String(o.rerouteId)),this.rerouteLayouts.delete(o.rerouteId),this.rerouteSpatialIndex.remove(String(o.rerouteId)),n.type="delete")}handleMoveReroute(o,n){const s=this.yreroutes.get(String(o.rerouteId));if(!s)return;s.set("position",o.position);const a=o.position,r={id:o.rerouteId,position:a,radius:8,bounds:{x:a.x-8,y:a.y-8,width:16,height:16}};this.updateRerouteLayout(o.rerouteId,r),n.type="update"}updateNodeBounds(o,n,s){o.set("bounds",{x:n.x,y:n.y,width:s.width,height:s.height})}findLinksConnectedToNode(o){const n=[];return this.ylinks.forEach((s,a)=>{const r=asLinkId(a),l=this.getLinkField(s,"sourceNodeId"),u=this.getLinkField(s,"targetNodeId");(l===o||u===o)&&n.push(r)}),n}handleLinkChange(o,n){if(o.action==="delete"){const s=asLinkId(n);this.cleanupLinkData(s)}}cleanupLinkData(o){this.linkLayouts.delete(o),this.cleanupLinkSegments(o)}cleanupLinkSegments(o){const n=[];for(const[s]of this.linkSegmentLayouts)s.startsWith(`${o}:`)&&n.push(s);for(const s of n)this.linkSegmentLayouts.delete(s),this.linkSegmentSpatialIndex.remove(s)}handleRerouteChange(o,n){const s=asRerouteId(n);o.action==="delete"?this.handleRerouteDelete(s):this.handleRerouteUpsert(s)}handleRerouteDelete(o){this.rerouteLayouts.delete(o),this.rerouteSpatialIndex.remove(String(o))}handleRerouteUpsert(o){const n=this.yreroutes.get(String(o));if(!n)return;const s=this.getRerouteField(n,"position");if(!s)return;const a=this.createRerouteLayout(o,s);this.updateRerouteLayout(o,a)}createRerouteLayout(o,n){return{id:o,position:n,radius:REROUTE_RADIUS,bounds:{x:n.x-REROUTE_RADIUS,y:n.y-REROUTE_RADIUS,width:REROUTE_RADIUS*2,height:REROUTE_RADIUS*2}}}notifyChange(o){this.changeListeners.forEach(n=>{try{n(o)}catch(s){console.error("Error in layout change listener:",s)}})}getOperationsSince(o){const n=[];return this.yoperations.forEach(s=>{s&&s.timestamp>o&&n.push(s)}),n}getOperationsByActor(o){const n=[];return this.yoperations.forEach(s=>{s&&s.actor===o&&n.push(s)}),n}getYDoc(){return this.ydoc}applyUpdate(o){applyUpdate(this.ydoc,o)}getStateAsUpdate(){return encodeStateAsUpdate(this.ydoc)}batchUpdateNodeBounds(o){if(o.length===0)return;const n=this.currentSource,s=n===LayoutSource.DOM;this.currentSource=LayoutSource.Vue;const a=[],r={};for(const{nodeId:u,bounds:m}of o){const f=this.ynodes.get(u);if(!f)continue;const _=yNodeToLayout(f),y=s?{...m,height:removeNodeTitleHeight(m.height)}:m;r[u]={bounds:y,previousBounds:_.bounds},a.push(u)}if(!a.length){this.currentSource=n;return}const l={type:"batchUpdateBounds",entity:"node",nodeIds:a,bounds:r,timestamp:Date.now(),source:this.currentSource,actor:this.currentActor};this.applyOperation(l),this.currentSource=n}}const layoutStore=new LayoutStoreImpl,logger$1=log.getLogger("LayoutMutations");function useLayoutMutations(){const i=p(w=>{layoutStore.setSource(w)},"setSource"),o=p(w=>{layoutStore.setActor(w)},"setActor"),n=p((w,k)=>{const S=String(w),C=layoutStore.getNodeLayoutRef(S).value;C&&layoutStore.applyOperation({type:"moveNode",entity:"node",nodeId:S,position:k,previousPosition:C.position,timestamp:Date.now(),source:layoutStore.getCurrentSource(),actor:layoutStore.getCurrentActor()})},"moveNode"),s=p((w,k)=>{const S=String(w),C=layoutStore.getNodeLayoutRef(S).value;C&&layoutStore.applyOperation({type:"resizeNode",entity:"node",nodeId:S,size:k,previousSize:C.size,timestamp:Date.now(),source:layoutStore.getCurrentSource(),actor:layoutStore.getCurrentActor()})},"resizeNode"),a=p((w,k)=>{const S=String(w),C=layoutStore.getNodeLayoutRef(S).value;C&&layoutStore.applyOperation({type:"setNodeZIndex",entity:"node",nodeId:S,zIndex:k,previousZIndex:C.zIndex,timestamp:Date.now(),source:layoutStore.getCurrentSource(),actor:layoutStore.getCurrentActor()})},"setNodeZIndex");return{setSource:i,setActor:o,moveNode:n,resizeNode:s,setNodeZIndex:a,createNode:p((w,k)=>{const S=String(w),C={id:S,position:k.position??{x:0,y:0},size:k.size??{width:200,height:100},zIndex:k.zIndex??0,visible:k.visible??!0,bounds:{x:k.position?.x??0,y:k.position?.y??0,width:k.size?.width??200,height:k.size?.height??100}};layoutStore.applyOperation({type:"createNode",entity:"node",nodeId:S,layout:C,timestamp:Date.now(),source:layoutStore.getCurrentSource(),actor:layoutStore.getCurrentActor()})},"createNode"),deleteNode:p(w=>{const k=String(w),S=layoutStore.getNodeLayoutRef(k).value;S&&layoutStore.applyOperation({type:"deleteNode",entity:"node",nodeId:k,previousLayout:S,timestamp:Date.now(),source:layoutStore.getCurrentSource(),actor:layoutStore.getCurrentActor()})},"deleteNode"),bringNodeToFront:p(w=>{const k=layoutStore.getAllNodes().value;let S=0;for(const[,C]of k)C.zIndex>S&&(S=C.zIndex);a(w,S+1)},"bringNodeToFront"),createLink:p((w,k,S,C,I)=>{const T=String(k),E=String(C);logger$1.debug("Creating link:",{linkId:w,from:`${T}[${S}]`,to:`${E}[${I}]`}),layoutStore.applyOperation({type:"createLink",entity:"link",linkId:w,sourceNodeId:T,sourceSlot:S,targetNodeId:E,targetSlot:I,timestamp:Date.now(),source:layoutStore.getCurrentSource(),actor:layoutStore.getCurrentActor()})},"createLink"),deleteLink:p(w=>{logger$1.debug("Deleting link:",w),layoutStore.applyOperation({type:"deleteLink",entity:"link",linkId:w,timestamp:Date.now(),source:layoutStore.getCurrentSource(),actor:layoutStore.getCurrentActor()})},"deleteLink"),createReroute:p((w,k,S,C=[])=>{logger$1.debug("Creating reroute:",{rerouteId:w,position:k,parentId:S,linkCount:C.length}),layoutStore.applyOperation({type:"createReroute",entity:"reroute",rerouteId:w,position:k,parentId:S,linkIds:C,timestamp:Date.now(),source:layoutStore.getCurrentSource(),actor:layoutStore.getCurrentActor()})},"createReroute"),deleteReroute:p(w=>{logger$1.debug("Deleting reroute:",w),layoutStore.applyOperation({type:"deleteReroute",entity:"reroute",rerouteId:w,timestamp:Date.now(),source:layoutStore.getCurrentSource(),actor:layoutStore.getCurrentActor()})},"deleteReroute"),moveReroute:p((w,k,S)=>{logger$1.debug("Moving reroute:",{rerouteId:w,from:S,to:k}),layoutStore.applyOperation({type:"moveReroute",entity:"reroute",rerouteId:w,position:k,previousPosition:S,timestamp:Date.now(),source:layoutStore.getCurrentSource(),actor:layoutStore.getCurrentActor()})},"moveReroute")}}p(useLayoutMutations,"useLayoutMutations");const PREFIX="workflow",SEPARATOR=">";class CanvasPathRenderer{static{p(this,"CanvasPathRenderer")}drawLink(o,n,s){const a=new Path2D,r=s.highlightedIds?.has(n.id)??!1,l=this.determineLinkColor(n,s,r);return o.save(),n.disabled&&s.patterns?.disabled?o.strokeStyle=s.patterns.disabled:o.strokeStyle=l,o.lineWidth=s.style.connectionWidth,o.lineJoin="round",s.style.borderWidth&&!s.style.lowQuality&&this.drawLinkPath(o,a,n,s,s.style.connectionWidth+s.style.borderWidth,"rgba(0,0,0,0.5)"),this.drawLinkPath(o,a,n,s,s.style.connectionWidth,l),this.calculateCenterPoint(n,s),s.style.showArrows&&this.drawArrows(o,n,s,l),s.style.showCenterMarker&&s.scale&&s.scale>=.6&&s.style.highQuality&&this.drawCenterMarker(o,n,s,l),n.flow&&s.animation&&this.drawFlowAnimation(o,a,n,s),o.restore(),a}determineLinkColor(o,n,s){return s?n.colors.highlighted:o.color?o.color:o.type&&n.colors.byType[o.type]?n.colors.byType[o.type]:n.colors.default}drawLinkPath(o,n,s,a,r,l){o.strokeStyle=l,o.lineWidth=r;const u=s.startPoint,m=s.endPoint;a.style.mode==="linear"?this.buildLinearPath(n,u,m,s.startDirection,s.endDirection):a.style.mode==="straight"?this.buildStraightPath(n,u,m,s.startDirection,s.endDirection):this.buildSplinePath(n,u,m,s.startDirection,s.endDirection,s.controlPoints),o.stroke(n)}buildLinearPath(o,n,s,a,r){const u={x:n.x,y:n.y},m={x:s.x,y:s.y};switch(a){case"left":u.x-=15;break;case"right":u.x+=15;break;case"up":u.y-=15;break;case"down":u.y+=15;break}switch(r){case"left":m.x-=15;break;case"right":m.x+=15;break;case"up":m.y-=15;break;case"down":m.y+=15;break}o.moveTo(n.x,n.y),o.lineTo(u.x,u.y),o.lineTo(m.x,m.y),o.lineTo(s.x,s.y)}buildStraightPath(o,n,s,a,r){const u={x:n.x,y:n.y},m={x:s.x,y:s.y};switch(a){case"left":u.x-=10;break;case"right":u.x+=10;break;case"up":u.y-=10;break;case"down":u.y+=10;break}switch(r){case"left":m.x-=10;break;case"right":m.x+=10;break;case"up":m.y-=10;break;case"down":m.y+=10;break}const f=(u.x+m.x)*.5;o.moveTo(n.x,n.y),o.lineTo(u.x,u.y),o.lineTo(f,u.y),o.lineTo(f,m.y),o.lineTo(m.x,m.y),o.lineTo(s.x,s.y)}buildSplinePath(o,n,s,a,r,l){o.moveTo(n.x,n.y);const u=l||this.calculateControlPoints(n,s,a,r);u.length>=2?o.bezierCurveTo(u[0].x,u[0].y,u[1].x,u[1].y,s.x,s.y):u.length===1?o.quadraticCurveTo(u[0].x,u[0].y,s.x,s.y):o.lineTo(s.x,s.y)}calculateControlPoints(o,n,s,a){const r=Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2)),l=Math.max(30,r*.25),u=this.getDirectionOffset(s,l),m=this.getDirectionOffset(a,l);return[{x:o.x+u.x,y:o.y+u.y},{x:n.x+m.x,y:n.y+m.y}]}getDirectionOffset(o,n){switch(o){case"left":return{x:-n,y:0};case"right":return{x:n,y:0};case"up":return{x:0,y:-n};case"down":return{x:0,y:n};case"none":default:return{x:0,y:0}}}drawArrows(o,n,s,a){if(!s.style.showArrows)return;const r=[.25,.75];for(const l of r){const u=this.computeConnectionPoint(n,l,s),m=this.computeConnectionPoint(n,l+.01,s),f=Math.atan2(m.y-u.y,m.x-u.x),_=o.getTransform();o.translate(u.x,u.y),o.rotate(f),o.fillStyle=a,o.beginPath(),o.moveTo(-5,-3),o.lineTo(0,7),o.lineTo(5,-3),o.fill(),o.setTransform(_)}}computeConnectionPoint(o,n,s){const{startPoint:a,endPoint:r,startDirection:l,endDirection:u}=o,m=Math.sqrt(Math.pow(r.x-a.x,2)+Math.pow(r.y-a.y,2)),f=.25,_={x:a.x,y:a.y},y={x:r.x,y:r.y};switch(l){case"left":_.x-=m*f;break;case"right":_.x+=m*f;break;case"up":_.y-=m*f;break;case"down":_.y+=m*f;break}switch(u){case"left":y.x-=m*f;break;case"right":y.x+=m*f;break;case"up":y.y-=m*f;break;case"down":y.y+=m*f;break}const b=(1-n)*(1-n)*(1-n),w=3*((1-n)*(1-n))*n,k=3*(1-n)*(n*n),S=n*n*n;return{x:b*a.x+w*_.x+k*y.x+S*r.x,y:b*a.y+w*_.y+k*y.y+S*r.y}}drawFlowAnimation(o,n,s,a){if(!a.animation)return;const r=a.animation.time,l=this.determineLinkColor(s,a,!1);o.save(),o.fillStyle=l;for(let u=0;u<5;++u){const m=(r+u*.2)%1,f=this.computeConnectionPoint(s,m,a);o.beginPath(),o.arc(f.x,f.y,5,0,2*Math.PI),o.fill()}o.restore()}findPointOnBezier(o,n,s,a,r){const l=1-o,u=l*l,m=u*l,f=o*o,_=f*o;return{x:m*n.x+3*u*o*s.x+3*l*f*a.x+_*r.x,y:m*n.y+3*u*o*s.y+3*l*f*a.y+_*r.y}}drawDraggingLink(o,n,s){const a=n.fromInput?{id:"dragging",startPoint:n.dragPoint,endPoint:n.fixedPoint,startDirection:n.dragDirection||this.getOppositeDirection(n.fixedDirection),endDirection:n.fixedDirection,color:n.color,type:n.type,disabled:n.disabled}:{id:"dragging",startPoint:n.fixedPoint,endPoint:n.dragPoint,startDirection:n.fixedDirection,endDirection:n.dragDirection||this.getOppositeDirection(n.fixedDirection),color:n.color,type:n.type,disabled:n.disabled};return this.drawLink(o,a,s)}getOppositeDirection(o){switch(o){case"left":return"right";case"right":return"left";case"up":return"down";case"down":return"up";case"none":default:return"none"}}getLinkCenter(o){return{x:(o.startPoint.x+o.endPoint.x)/2,y:(o.startPoint.y+o.endPoint.y)/2}}calculateCenterPoint(o,n){const{startPoint:s,endPoint:a,controlPoints:r}=o;if(n.style.mode==="spline"&&r&&r.length>=2){const l=this.findPointOnBezier(.5,s,r[0],r[1],a);if(o.centerPos=l,n.style.centerMarkerShape==="arrow"){const u=this.findPointOnBezier(.51,s,r[0],r[1],a);o.centerAngle=Math.atan2(u.y-l.y,u.x-l.x)}}else if(n.style.mode==="linear"){const u={x:s.x,y:s.y},m={x:a.x,y:a.y};switch(o.startDirection){case"left":u.x-=15;break;case"right":u.x+=15;break;case"up":u.y-=15;break;case"down":u.y+=15;break}switch(o.endDirection){case"left":m.x-=15;break;case"right":m.x+=15;break;case"up":m.y-=15;break;case"down":m.y+=15;break}o.centerPos={x:(u.x+m.x)*.5,y:(u.y+m.y)*.5},n.style.centerMarkerShape==="arrow"&&(o.centerAngle=Math.atan2(m.y-u.y,m.x-u.x))}else if(n.style.mode==="straight"){const u={x:s.x,y:s.y},m={x:a.x,y:a.y};switch(o.startDirection){case"left":u.x-=10;break;case"right":u.x+=10;break;case"up":u.y-=10;break;case"down":u.y+=10;break}switch(o.endDirection){case"left":m.x-=10;break;case"right":m.x+=10;break;case"up":m.y-=10;break;case"down":m.y+=10;break}const f=(u.x+m.x)*.5;if(o.centerPos={x:f,y:(u.y+m.y)*.5},n.style.centerMarkerShape==="arrow"){const _=m.y-u.y;Math.abs(_)<4?o.centerAngle=0:_>0?o.centerAngle=Math.PI*.5:o.centerAngle=-(Math.PI*.5)}}else o.centerPos=this.getLinkCenter(o),n.style.centerMarkerShape==="arrow"&&(o.centerAngle=Math.atan2(a.y-s.y,a.x-s.x))}drawCenterMarker(o,n,s,a){if(n.centerPos){if(o.beginPath(),s.style.centerMarkerShape==="arrow"&&n.centerAngle!==void 0){const r=o.getTransform();o.translate(n.centerPos.x,n.centerPos.y),o.rotate(n.centerAngle),o.moveTo(-3.2,-5),o.lineTo(7,0),o.lineTo(-3.2,5),o.setTransform(r)}else o.arc(n.centerPos.x,n.centerPos.y,5,0,Math.PI*2);if(n.disabled&&s.patterns?.disabled){const{fillStyle:r,globalAlpha:l}=o;o.fillStyle=s.patterns.disabled,o.globalAlpha=.75,o.fill(),o.globalAlpha=l,o.fillStyle=r}else o.fillStyle=a,o.fill()}}}class LitegraphLinkAdapter{static{p(this,"LitegraphLinkAdapter")}constructor(o=!0){this.enableLayoutStoreWrites=o}pathRenderer=new CanvasPathRenderer;convertDirection(o){switch(o){case LinkDirection.LEFT:return"left";case LinkDirection.RIGHT:return"right";case LinkDirection.UP:return"up";case LinkDirection.DOWN:return"down";case LinkDirection.CENTER:return"none";default:return"right"}}convertToPathRenderContext(o){const n=o.scale>=.6&&o.highQualityRender&&o.renderConnectionArrows,s=o.linkMarkerShape!==LinkMarkerShape.None;return{style:{mode:this.convertRenderMode(o.renderMode),connectionWidth:o.connectionWidth,borderWidth:o.renderBorder?4:void 0,arrowShape:this.convertArrowShape(o.linkMarkerShape),showArrows:n,lowQuality:o.lowQuality,showCenterMarker:s,centerMarkerShape:o.linkMarkerShape===LinkMarkerShape.Arrow?"arrow":"circle",highQuality:o.highQualityRender},colors:{default:String(o.defaultLinkColor),byType:this.convertColorMap(o.linkTypeColors),highlighted:"#FFF"},patterns:{disabled:o.disabledPattern},animation:{time:LiteGraph.getTime()*.001},scale:o.scale,highlightedIds:new Set(Array.from(o.highlightedLinks).map(String))}}convertRenderMode(o){switch(o){case LinkRenderType.LINEAR_LINK:return"linear";case LinkRenderType.STRAIGHT_LINK:return"straight";case LinkRenderType.SPLINE_LINK:default:return"spline"}}convertArrowShape(o){switch(o){case LinkMarkerShape.Circle:return"circle";case LinkMarkerShape.Arrow:default:return"triangle"}}convertColorMap(o){const n={};for(const[s,a]of Object.entries(o))n[s]=String(a);return n}applySplineOffset(o,n,s){switch(n){case LinkDirection.LEFT:o.x-=s;break;case LinkDirection.RIGHT:o.x+=s;break;case LinkDirection.UP:o.y-=s;break;case LinkDirection.DOWN:o.y+=s;break}}renderLinkDirect(o,n,s,a,r,l,u,m,f,_,y={}){const b=m||LinkDirection.RIGHT,w=f||LinkDirection.LEFT,k=l===!0||typeof l=="number"&&l>0,S={id:a?String(a.id):"temp",startPoint:{x:n[0],y:n[1]},endPoint:{x:s[0],y:s[1]},startDirection:this.convertDirection(b),endDirection:this.convertDirection(w),color:u!=null?String(u):void 0,type:a?.type!==void 0?String(a.type):void 0,flow:k,disabled:y.disabled||!1};if(_.renderMode===LinkRenderType.SPLINE_LINK){const E=!!y.startControl,N=!!y.endControl,L=Math.sqrt((s[0]-n[0])*(s[0]-n[0])+(s[1]-n[1])*(s[1]-n[1])),A=.25,D=[];if(E&&N)D.push({x:n[0]+(y.startControl[0]||0),y:n[1]+(y.startControl[1]||0)},{x:s[0]+(y.endControl[0]||0),y:s[1]+(y.endControl[1]||0)}),S.controlPoints=D;else if(E&&!N){const O={x:n[0]+(y.startControl[0]||0),y:n[1]+(y.startControl[1]||0)},M={x:s[0],y:s[1]};this.applySplineOffset(M,w,L*A),D.push(O,M),S.controlPoints=D}else if(!E&&N){const O={x:n[0],y:n[1]};this.applySplineOffset(O,b,L*A);const M={x:s[0]+(y.endControl[0]||0),y:s[1]+(y.endControl[1]||0)};D.push(O,M),S.controlPoints=D}else{const O={x:n[0],y:n[1]},M={x:s[0],y:s[1]};this.applySplineOffset(O,b,L*A),this.applySplineOffset(M,w,L*A),D.push(O,M),S.controlPoints=D}}const C=this.convertToPathRenderContext(_);r&&(C.style.borderWidth=void 0);const I=this.pathRenderer.drawLink(o,S,C),T=y.reroute??a;if(T&&(T.path=I,S.centerPos&&(T._pos=T._pos||[0,0],T._pos[0]=S.centerPos.x,T._pos[1]=S.centerPos.y,S.centerAngle!==void 0&&(T._centreAngle=S.centerAngle)),this.enableLayoutStoreWrites&&a&&a.id!==-1)){const E=this.calculateLinkBounds([S.startPoint.x,S.startPoint.y],[S.endPoint.x,S.endPoint.y],S),N=S.centerPos||{x:(S.startPoint.x+S.endPoint.x)/2,y:(S.startPoint.y+S.endPoint.y)/2};y.reroute||layoutStore.updateLinkLayout(a.id,{id:a.id,path:I,bounds:E,centerPos:N,sourceNodeId:String(a.origin_id),targetNodeId:String(a.target_id),sourceSlot:a.origin_slot,targetSlot:a.target_slot});const L=y.reroute?y.reroute.id:null;layoutStore.updateLinkSegmentLayout(a.id,L,{path:I,bounds:E,centerPos:N})}}renderDraggingLink(o,n,s,a,r,l,u){this.renderLinkDirect(o,n,s,null,!1,null,a,r,l,{...u,linkMarkerShape:LinkMarkerShape.None},{disabled:!1})}calculateLinkBounds(o,n,s){let a=Math.min(o[0],n[0]),r=Math.max(o[0],n[0]),l=Math.min(o[1],n[1]),u=Math.max(o[1],n[1]);if(s.controlPoints)for(const f of s.controlPoints)a=Math.min(a,f.x),r=Math.max(r,f.x),l=Math.min(l,f.y),u=Math.max(u,f.y);const m=20;return{x:a-m,y:l-m,width:r-a+2*m,height:u-l+2*m}}}function shallowCloneCommonProps(i){const{color_off:o,color_on:n,dir:s,label:a,localized_name:r,locked:l,name:u,nameLocked:m,removable:f,shape:_,type:y}=i;return{color_off:o,color_on:n,dir:s,label:a,localized_name:r,locked:l,name:u,nameLocked:m,removable:f,shape:_,type:y}}p(shallowCloneCommonProps,"shallowCloneCommonProps");function inputAsSerialisable(i){const{link:o}=i,n=i.widget?{widget:{name:i.widget.name}}:{pos:i.pos};return{...shallowCloneCommonProps(i),...n,link:o}}p(inputAsSerialisable,"inputAsSerialisable");function outputAsSerialisable(i){const{pos:o,slot_index:n,links:s,widget:a}=i,r=a?{widget:{name:a.name}}:null;return{...shallowCloneCommonProps(i),...r,pos:o,slot_index:n,links:s}}p(outputAsSerialisable,"outputAsSerialisable");function isINodeInputSlot(i){return"link"in i}p(isINodeInputSlot,"isINodeInputSlot");function isWidgetInputSlot(i){return!!i.widget}p(isWidgetInputSlot,"isWidgetInputSlot");function getSlotKey(i,o,n){if(typeof i=="object"){const{nodeId:s,index:a,isInput:r}=i;return`${s}-${r?"in":"out"}-${a}`}if(o===void 0||n===void 0)throw new Error("Missing required parameters for slot key generation");return`${i}-${n?"in":"out"}-${o}`}p(getSlotKey,"getSlotKey");function calculateInputSlotPos(i,o){const n=i.inputs[o];return n?calculateInputSlotPosFromSlot(i,n):[i.nodeX,i.nodeY]}p(calculateInputSlotPos,"calculateInputSlotPos");function calculateInputSlotPosFromSlot(i,o){const{nodeX:n,nodeY:s,collapsed:a}=i;if(a){const y=LiteGraph.NODE_TITLE_HEIGHT*.5;return[n,s-y]}const{pos:r}=o;if(r)return[n+r[0],s+r[1]];const l=LiteGraph.NODE_SLOT_HEIGHT*.5,u=i.slotStartY||0,_=(getDefaultVerticalInputs(i).indexOf(o)+.7)*LiteGraph.NODE_SLOT_HEIGHT;return[n+l,s+_+u]}p(calculateInputSlotPosFromSlot,"calculateInputSlotPosFromSlot");function calculateOutputSlotPos(i,o){const{nodeX:n,nodeY:s,nodeWidth:a,collapsed:r,collapsedWidth:l,outputs:u}=i;if(r){const S=l||LiteGraph.NODE_COLLAPSED_WIDTH,C=LiteGraph.NODE_TITLE_HEIGHT*.5;return[n+S,s-C]}const m=u[o];if(!m)return[n+a,s];const f=m.pos;if(f)return[n+f[0],s+f[1]];const _=LiteGraph.NODE_SLOT_HEIGHT*.5,y=i.slotStartY||0,k=(getDefaultVerticalOutputs(i).indexOf(m)+.7)*LiteGraph.NODE_SLOT_HEIGHT;return[n+a+1-_,s+k+y]}p(calculateOutputSlotPos,"calculateOutputSlotPos");function getSlotPosition(i,o,n){const s=getSlotKey(String(i.id),o,n),a=layoutStore.getSlotLayout(s);if(a)return[a.position.x,a.position.y];const r=layoutStore.getNodeLayoutRef(String(i.id)).value;if(r){const u={nodeX:r.position.x,nodeY:r.position.y,nodeWidth:r.size.width,nodeHeight:r.size.height,collapsed:i.flags.collapsed||!1,collapsedWidth:i._collapsed_width,slotStartY:i.constructor.slot_start_y,inputs:i.inputs,outputs:i.outputs,widgets:i.widgets};return n?calculateInputSlotPos(u,o):calculateOutputSlotPos(u,o)}const l={nodeX:i.pos[0],nodeY:i.pos[1],nodeWidth:i.size[0],nodeHeight:i.size[1],collapsed:i.flags.collapsed||!1,collapsedWidth:i._collapsed_width,slotStartY:i.constructor.slot_start_y,inputs:i.inputs,outputs:i.outputs,widgets:i.widgets};return n?calculateInputSlotPos(l,o):calculateOutputSlotPos(l,o)}p(getSlotPosition,"getSlotPosition");function getDefaultVerticalInputs(i){return i.inputs.filter(o=>!o.pos&&!(i.widgets?.length&&isWidgetInputSlot(o)))}p(getDefaultVerticalInputs,"getDefaultVerticalInputs");function getDefaultVerticalOutputs(i){return i.outputs.filter(o=>!o.pos)}p(getDefaultVerticalOutputs,"getDefaultVerticalOutputs");class CanvasPointer{static{p(this,"CanvasPointer")}static bufferTime=150;static doubleClickTime=300;static get maxClickDrift(){return this.#e}static set maxClickDrift(o){this.#e=o,this.#t=o*o}static#e=6;static#t=this.#e**2;static trackpadThreshold=60;static trackpadMaxGap=500;static maxHighResBufferTime=10;element;pointerId;dragStarted=!1;eLastDown;isDouble=!1;isDown=!1;resizeDirection;clearEventsOnReset=!0;eDown;eMove;eUp;detectedDevice="mouse";lastWheelEventTime=0;hasReceivedWheelEvent=!1;bufferedLinuxEvent;bufferedLinuxEventTime=0;linuxBufferTimeoutId;get finally(){return this.#o}set finally(o){try{this.#o?.()}finally{this.#o=o}}#o;constructor(o){this.element=o}down(o){this.reset(),this.eDown=o,this.pointerId=o.pointerId,this.element.setPointerCapture(o.pointerId)}move(o){const{eDown:n}=this;if(!n)return;if(!o.buttons){this.reset();return}if(!(o.buttons&n.buttons)){this.#n(o),this.reset();return}if(this.eMove=o,this.onDrag?.(o),this.dragStarted)return;(o.timeStamp-n.timeStamp>CanvasPointer.bufferTime||!this.#s(o,n))&&this.#c(o)}up(o){if(o.button!==this.eDown?.button)return!1;this.#n(o);const{dragStarted:n}=this;return this.reset(),!n}#n(o){const{eDown:n}=this;n&&(this.eUp=o,this.dragStarted?this.onDragEnd?.(o):this.#s(o,n)?this.onDoubleClick&&this.#i()?(this.onDoubleClick(o),this.eLastDown=void 0):(this.onClick?.(o),this.eLastDown=n):(this.#c(),this.onDragEnd?.(o)))}#s(o,n,s=CanvasPointer.#t){return dist2(o.clientX,o.clientY,n.clientX,n.clientY)<=s}#i(){const{eDown:o,eLastDown:n}=this;if(!o||!n)return!1;const s=(3*CanvasPointer.#e)**2,a=o.timeStamp-n.timeStamp;return a>0&&a<CanvasPointer.doubleClickTime&&this.#s(o,n,s)}#c(o){this.dragStarted=!0,this.onDragStart?.(this,o),delete this.onDragStart}isTrackpadGesture(o){const n=performance.now(),s=Math.max(0,n-this.lastWheelEventTime);return this.lastWheelEventTime=n,this.#l(o,n)?this.detectedDevice="mouse":this.#f(s)?this.#u(o)&&this.#p(o,n):(this.#a(o,n),this.hasReceivedWheelEvent=!0),this.detectedDevice==="trackpad"}#l(o,n){return!this.bufferedLinuxEvent||this.bufferedLinuxEventTime<=0?!1:n-this.bufferedLinuxEventTime>CanvasPointer.maxHighResBufferTime?(this.#r(),!1):o.deltaX===0&&this.#_(this.bufferedLinuxEvent.deltaY,o.deltaY)?(this.#r(),!0):!1}#f(o){const n=!this.hasReceivedWheelEvent,s=o>=CanvasPointer.trackpadMaxGap;return!n&&!s}#a(o,n){this.#d(o)?this.detectedDevice="trackpad":this.#g(o)?this.detectedDevice="mouse":this.detectedDevice==="trackpad"&&this.#u(o)&&this.#p(o,n)}#r(){this.bufferedLinuxEvent=void 0,this.bufferedLinuxEventTime=0,this.linuxBufferTimeoutId!==void 0&&(clearTimeout(this.linuxBufferTimeoutId),this.linuxBufferTimeoutId=void 0)}#d(o){return!!(o.deltaX!==0&&o.deltaY!==0||o.ctrlKey&&Math.abs(o.deltaY)<10)}#g(o){const n=Math.abs(o.deltaY);return n>80?!0:n>=60&&o.deltaX===0&&this.detectedDevice==="mouse"}#u(o){const n=Math.abs(o.deltaY),s=n>=10&&n<60,a=o.deltaX===0,r=Number.isInteger(o.deltaY);return this.detectedDevice==="trackpad"&&s&&a&&r}#p(o,n){this.linuxBufferTimeoutId!==void 0&&clearTimeout(this.linuxBufferTimeoutId),this.bufferedLinuxEvent=o,this.bufferedLinuxEventTime=n,this.linuxBufferTimeoutId=setTimeout(()=>{this.#r()},CanvasPointer.maxHighResBufferTime)}#_(o,n){const s=Math.abs(o),a=Math.abs(n);return s===0||a===0?!1:s===a?!0:s%a===0||a%s===0}reset(){this.finally=void 0,delete this.onClick,delete this.onDoubleClick,delete this.onDragStart,delete this.onDrag,delete this.onDragEnd,this.isDown=!1,this.isDouble=!1,this.dragStarted=!1,this.resizeDirection=void 0,this.clearEventsOnReset&&(this.eDown=void 0,this.eMove=void 0,this.eUp=void 0);const{element:o,pointerId:n}=this;this.pointerId=void 0,typeof n=="number"&&o.hasPointerCapture(n)&&o.releasePointerCapture(n)}}class NullGraphError extends Error{static{p(this,"NullGraphError")}constructor(o="Attempted to access LGraph reference that was null or undefined.",n){super(o,{cause:n}),this.name="NullGraphError"}}const DEFAULT_TRACKED_PROPERTIES=["title","flags.collapsed","flags.pinned","mode","color","bgcolor"];class LGraphNodeProperties{static{p(this,"LGraphNodeProperties")}node;#e=new Set;constructor(o){this.node=o,this.#t()}#t(){for(const o of DEFAULT_TRACKED_PROPERTIES)this.#o(o)}#o(o){const n=o.split(".");n.length>1&&this.#i(o);let s=this.node,a=n[0];if(n.length>1){for(let u=0;u<n.length-1;u++)s=s[n[u]];a=n.at(-1)}const r=Object.prototype.hasOwnProperty.call(s,a),l=s[a];if(r)Object.defineProperty(s,a,this.#n(o,l));else{let u;Object.defineProperty(s,a,{get:p(()=>u,"get"),set:p(m=>{const f=u;u=m,this.#s(o,f,m);const _=m!==void 0,y=Object.getOwnPropertyDescriptor(s,a);y&&y.enumerable!==_&&Object.defineProperty(s,a,{...y,enumerable:_})},"set"),enumerable:!1,configurable:!0})}this.#e.add(o)}#n(o,n){let s=n;return{get:p(()=>s,"get"),set:p(a=>{const r=s;s=a,this.#s(o,r,a)},"set"),enumerable:!0,configurable:!0}}#s(o,n,s){this.node.graph?.trigger("node:property:changed",{nodeId:this.node.id,property:o,oldValue:n,newValue:s})}#i(o){const n=o.split(".");let s=this.node;for(let a=0;a<n.length-1;a++){const r=n[a];s[r]||(s[r]={}),s=s[r]}}isTracked(o){return this.#e.has(o)}getTrackedProperties(){return[...DEFAULT_TRACKED_PROPERTIES]}toJSON(){}}function rgbToHsl({r:i,g:o,b:n}){i/=255,o/=255,n/=255;const s=Math.max(i,o,n),a=Math.min(i,o,n);let r=0,l=0;const u=(s+a)/2;if(s!==a){const m=s-a;switch(l=u>.5?m/(2-s-a):m/(s+a),s){case i:r=(o-n)/m+(o<n?6:0);break;case o:r=(n-i)/m+2;break;case n:r=(i-o)/m+4;break}r/=6}return{h:r,s:l,l:u}}p(rgbToHsl,"rgbToHsl");function hexToRgb(i){let o=0,n=0,s=0;return i.length==4?(o=parseInt(i[1]+i[1],16),n=parseInt(i[2]+i[2],16),s=parseInt(i[3]+i[3],16)):i.length==7&&(o=parseInt(i.slice(1,3),16),n=parseInt(i.slice(3,5),16),s=parseInt(i.slice(5,7),16)),{r:o,g:n,b:s}}p(hexToRgb,"hexToRgb");function rgbToHex({r:i,g:o,b:n}){const s=p(a=>Math.max(0,Math.min(255,Math.round(a))).toString(16).padStart(2,"0"),"toHex");return`#${s(i)}${s(o)}${s(n)}`}p(rgbToHex,"rgbToHex");function hsbToRgb({h:i,s:o,b:n}){const s=(i%360+360)%360,a=Math.max(0,Math.min(100,o))/100,r=Math.max(0,Math.min(100,n))/100,l=r*a,u=l*(1-Math.abs(s/60%2-1)),m=r-l;let f=0,_=0,y=0;return s<60?(f=l,_=u,y=0):s<120?(f=u,_=l,y=0):s<180?(f=0,_=l,y=u):s<240?(f=0,_=u,y=l):s<300?(f=u,_=0,y=l):(f=l,_=0,y=u),{r:Math.floor((f+m)*255),g:Math.floor((_+m)*255),b:Math.floor((y+m)*255)}}p(hsbToRgb,"hsbToRgb");function parseToRgb(i){const o=identifyColorFormat(i);if(!o)return{r:0,g:0,b:0};const n=parseToHSLA(i,o);if(!isHSLA(n))return{r:0,g:0,b:0};const s=n.h/360,a=n.s/100,r=n.l/100,l=(1-Math.abs(2*r-1))*a,u=l*(1-Math.abs(s*6%2-1)),m=r-l/2;let f=0,_=0,y=0;return s<1/6?(f=l,_=u,y=0):s<2/6?(f=u,_=l,y=0):s<3/6?(f=0,_=l,y=u):s<4/6?(f=0,_=u,y=l):s<5/6?(f=u,_=0,y=l):(f=l,_=0,y=u),{r:Math.round((f+m)*255),g:Math.round((_+m)*255),b:Math.round((y+m)*255)}}p(parseToRgb,"parseToRgb");const identifyColorFormat=p(i=>i?i.startsWith("#")&&(i.length===4||i.length===7)?"hex":/rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*/.test(i)?i.includes("rgba")?"rgba":"rgb":/hsla?\(\s*\d+(\.\d+)?\s*,\s*\d+(\.\d+)?%\s*,\s*\d+(\.\d+)?%/.test(i)?i.includes("hsla")?"hsla":"hsl":null:null,"identifyColorFormat"),isHSLA=p(i=>typeof i!="object"||i===null?!1:["h","s","l","a"].every(o=>typeof i[o]=="number"&&!isNaN(i[o])),"isHSLA");function isColorFormat(i){return i==="hex"||i==="rgb"||i==="hsb"}p(isColorFormat,"isColorFormat");function isHSBObject(i){if(!i||typeof i!="object")return!1;const o=i;return typeof o.h=="number"&&Number.isFinite(o.h)&&typeof o.s=="number"&&Number.isFinite(o.s)&&typeof o.b=="number"&&Number.isFinite(o.b)}p(isHSBObject,"isHSBObject");function isHSVObject(i){if(!i||typeof i!="object")return!1;const o=i;return typeof o.h=="number"&&Number.isFinite(o.h)&&typeof o.s=="number"&&Number.isFinite(o.s)&&typeof o.v=="number"&&Number.isFinite(o.v)}p(isHSVObject,"isHSVObject");function toHexFromFormat(i,o){if(o==="hex"&&typeof i=="string"){const n=i.trim().toLowerCase();return n?/^[0-9a-f]{3}$/.test(n)?`#${n}`:/^#[0-9a-f]{3}$/.test(n)?n:/^[0-9a-f]{6}$/.test(n)?`#${n}`:/^#[0-9a-f]{6}$/.test(n)?n:"#000000":"#000000"}if(o==="rgb"&&typeof i=="string"){const n=parseToRgb(i);return rgbToHex(n).toLowerCase()}if(o==="hsb"){if(isHSBObject(i))return rgbToHex(hsbToRgb(i)).toLowerCase();if(isHSVObject(i)){const{h:n,s,v:a}=i;return rgbToHex(hsbToRgb({h:n,s,b:a})).toLowerCase()}if(typeof i=="string"){const n=i.match(/\d+(?:\.\d+)?/g)?.map(Number)||[];if(n.length>=3)return rgbToHex(hsbToRgb({h:n[0],s:n[1],b:n[2]})).toLowerCase()}}return"#000000"}p(toHexFromFormat,"toHexFromFormat");function parseToHSLA(i,o){let n;switch(o){case"hex":{const s=rgbToHsl(hexToRgb(i));return{h:Math.round(s.h*360),s:+(s.s*100).toFixed(1),l:+(s.l*100).toFixed(1),a:1}}case"rgb":case"rgba":{if(n=i.match(/\d+(\.\d+)?/g),!n||n.length<3)return null;const[s,a,r]=n.map(Number),l=rgbToHsl({r:s,g:a,b:r}),u=o==="rgba"&&n[3]?parseFloat(n[3]):1;return{h:Math.round(l.h*360),s:+(l.s*100).toFixed(1),l:+(l.l*100).toFixed(1),a:u}}case"hsl":case"hsla":{if(n=i.match(/\d+(\.\d+)?/g),!n||n.length<3)return null;const[s,a,r]=n.map(Number),l=o==="hsla"&&n[3]?parseFloat(n[3]):1;return{h:s,s:a,l:r,a:l}}default:return null}}p(parseToHSLA,"parseToHSLA");const applyColorAdjustments=p((i,o)=>{if(!Object.keys(o).length)return i;const n=identifyColorFormat(i);if(!n)return console.warn(`Unsupported color format in color palette: ${i}`),i;const s=parseToHSLA(i,n);return isHSLA(s)?(o.lightness&&(s.l=Math.max(0,Math.min(100,s.l+o.lightness*100))),o.opacity&&(s.a=Math.max(0,Math.min(1,o.opacity))),`hsla(${s.h}, ${s.s}%, ${s.l}%, ${s.a})`):(console.warn(`Invalid color values in color palette: ${i}`),i)},"applyColorAdjustments"),adjustColor=memoize(applyColorAdjustments,(i,o)=>`${i}-${JSON.stringify(o)}`);class LGraphIcon{static{p(this,"LGraphIcon")}unicode;fontFamily;color;bgColor;fontSize;circlePadding;xOffset;yOffset;constructor({unicode:o,fontFamily:n="PrimeIcons",color:s="#e6c200",bgColor:a,fontSize:r=16,circlePadding:l=2,xOffset:u=0,yOffset:m=0}){this.unicode=o,this.fontFamily=n,this.color=s,this.bgColor=a,this.fontSize=r,this.circlePadding=l,this.xOffset=u,this.yOffset=m}draw(o,n,s){n+=this.xOffset,s+=this.yOffset;const{font:a,textBaseline:r,textAlign:l,fillStyle:u}=o;o.font=`${this.fontSize}px '${this.fontFamily}'`,o.textBaseline="middle",o.textAlign="center";const m=this.fontSize/2+this.circlePadding;this.bgColor&&(o.beginPath(),o.arc(n+m,s,m,0,2*Math.PI),o.fillStyle=this.bgColor,o.fill()),o.fillStyle=this.color,o.fillText(this.unicode,n+m,s),o.font=a,o.textBaseline=r,o.textAlign=l,o.fillStyle=u}}var BadgePosition=(i=>(i.TopLeft="top-left",i.TopRight="top-right",i))(BadgePosition||{});class LGraphBadge{static{p(this,"LGraphBadge")}text;fgColor;bgColor;fontSize;padding;height;cornerRadius;icon;xOffset;yOffset;constructor({text:o,fgColor:n="white",bgColor:s="#0F1F0F",fontSize:a=12,padding:r=6,height:l=20,cornerRadius:u=5,iconOptions:m,xOffset:f=0,yOffset:_=0}){this.text=o,this.fgColor=n,this.bgColor=s,this.fontSize=a,this.padding=r,this.height=l,this.cornerRadius=u,m&&(this.icon=new LGraphIcon(m)),this.xOffset=f,this.yOffset=_}get visible(){return(this.text?.length??0)>0||!!this.icon}getWidth(o){if(!this.visible)return 0;const{font:n}=o;let s=0;this.icon&&(o.font=`${this.icon.fontSize}px '${this.icon.fontFamily}'`,s=o.measureText(this.icon.unicode).width+this.padding),o.font=`${this.fontSize}px sans-serif`;const a=this.text?o.measureText(this.text).width:0;return o.font=n,s+a+this.padding*2}draw(o,n,s){if(!this.visible)return;n+=this.xOffset,s+=this.yOffset;const{font:a,fillStyle:r,textBaseline:l,textAlign:u}=o;o.font=`${this.fontSize}px sans-serif`;const m=this.getWidth(o),f=0;o.fillStyle=this.bgColor,o.beginPath(),o.roundRect?o.roundRect(n+f,s,m,this.height,this.cornerRadius):o.rect(n+f,s,m,this.height),o.fill();let _=n+f+this.padding;const y=s+this.height/2;this.icon&&(this.icon.draw(o,_,y),_+=this.icon.fontSize+this.padding/2+4),this.text&&(o.fillStyle=this.fgColor,o.textBaseline="middle",o.textAlign="left",o.fillText(this.text,_,y+1)),o.font=a,o.fillStyle=r,o.textBaseline=l,o.textAlign=u}}class Rectangle extends Float64Array{static{p(this,"Rectangle")}#e;#t;constructor(o=0,n=0,s=0,a=0){super(4),this[0]=o,this[1]=n,this[2]=s,this[3]=a}static from([o,n,s,a]){return new Rectangle(o,n,s,a)}static fromCentre([o,n],s,a=s){const r=o-s*.5,l=n-a*.5;return new Rectangle(r,l,s,a)}static ensureRect(o){return o instanceof Rectangle?o:new Rectangle(o[0],o[1],o[2],o[3])}subarray(o=0,n){const s=o<<3,a=n===void 0?n:n-o;return new Float64Array(this.buffer,s,a)}get pos(){return this.#e??=this.subarray(0,2),this.#e}set pos(o){this[0]=o[0],this[1]=o[1]}get size(){return this.#t??=this.subarray(2,4),this.#t}set size(o){this[2]=o[0],this[3]=o[1]}get x(){return this[0]}set x(o){this[0]=o}get y(){return this[1]}set y(o){this[1]=o}get width(){return this[2]}set width(o){this[2]=o}get height(){return this[3]}set height(o){this[3]=o}get left(){return this[0]}set left(o){this[0]=o}get top(){return this[1]}set top(o){this[1]=o}get right(){return this[0]+this[2]}set right(o){this[0]=o-this[2]}get bottom(){return this[1]+this[3]}set bottom(o){this[1]=o-this[3]}get centreX(){return this[0]+this[2]*.5}get centreY(){return this[1]+this[3]*.5}updateTo(o){this[0]=o[0],this[1]=o[1],this[2]=o[2],this[3]=o[3]}containsXy(o,n){const[s,a,r,l]=this;return o>=s&&o<s+r&&n>=a&&n<a+l}containsPoint([o,n]){const[s,a,r,l]=this;return o>=s&&o<s+r&&n>=a&&n<a+l}containsRect(o){const{right:n,bottom:s}=this,a=o[0]+o[2],r=o[1]+o[3];return!(this.x===o[0]&&this.y===o[1]&&n===a&&s===r)&&this.x<=o[0]&&this.y<=o[1]&&n>=a&&s>=r}overlaps(o){return this.x<o[0]+o[2]&&this.y<o[1]+o[3]&&this.x+this.width>o[0]&&this.y+this.height>o[1]}findContainingCorner(o,n,s){if(this.isInTopLeftCorner(o,n,s))return"NW";if(this.isInTopRightCorner(o,n,s))return"NE";if(this.isInBottomLeftCorner(o,n,s))return"SW";if(this.isInBottomRightCorner(o,n,s))return"SE"}isInTopLeftCorner(o,n,s){return isInRectangle(o,n,this.x,this.y,s,s)}isInTopRightCorner(o,n,s){return isInRectangle(o,n,this.right-s,this.y,s,s)}isInBottomLeftCorner(o,n,s){return isInRectangle(o,n,this.x,this.bottom-s,s,s)}isInBottomRightCorner(o,n,s){return isInRectangle(o,n,this.right-s,this.bottom-s,s,s)}isInTopEdge(o,n,s){return isInRectangle(o,n,this.x,this.y,this.width,s)}isInBottomEdge(o,n,s){return isInRectangle(o,n,this.x,this.bottom-s,this.width,s)}isInLeftEdge(o,n,s){return isInRectangle(o,n,this.x,this.y,s,this.height)}isInRightEdge(o,n,s){return isInRectangle(o,n,this.right-s,this.y,s,this.height)}getCentre(){return[this.centreX,this.centreY]}getArea(){return this.width*this.height}getPerimeter(){return 2*(this.width+this.height)}getTopLeft(){return[this[0],this[1]]}getBottomRight(){return[this.right,this.bottom]}getSize(){return[this[2],this[3]]}getOffsetTo([o,n]){return[o-this[0],n-this[1]]}getOffsetFrom([o,n]){return[this[0]-o,this[1]-n]}resizeTopLeft(o,n){this[2]+=this[0]-o,this[3]+=this[1]-n,this[0]=o,this[1]=n}resizeBottomLeft(o,n){this[2]+=this[0]-o,this[3]=n-this[1],this[0]=o}resizeTopRight(o,n){this[2]=o-this[0],this[3]+=this[1]-n,this[1]=n}resizeBottomRight(o,n){this[2]=o-this[0],this[3]=n-this[1]}setWidthRightAnchored(o){const n=this[2];this[2]=o,this[0]+=n-o}setHeightBottomAnchored(o){const n=this[3];this[3]=o,this[1]+=n-o}clone(){return new Rectangle(this[0],this[1],this[2],this[3])}toArray(){return this.export()}export(){return[this[0],this[1],this[2],this[3]]}_drawDebug(o,n="red"){const{strokeStyle:s,lineWidth:a}=o;try{o.strokeStyle=n,o.lineWidth=.5,o.beginPath(),o.strokeRect(this[0],this[1],this[2],this[3])}finally{o.strokeStyle=s,o.lineWidth=a}}}class LGraphButton extends LGraphBadge{static{p(this,"LGraphButton")}name;_last_area=new Rectangle;constructor(o){super(o),this.name=o.name}getWidth(o){if(!this.visible)return 0;const{font:n}=o;o.font=`${this.fontSize}px 'PrimeIcons'`;const s=this.text?o.measureText(this.text).width:0;return o.font=n,s}draw(o,n,s){if(!this.visible)return;const a=this.getWidth(o);this._last_area[0]=n+this.xOffset,this._last_area[1]=s+this.yOffset,this._last_area[2]=a,this._last_area[3]=this.height;const r=n+this.xOffset,l=s+this.yOffset,{font:u,fillStyle:m,textBaseline:f,textAlign:_}=o,y=o.fillStyle||"white";o.font=`${this.fontSize}px 'PrimeIcons'`,o.fillStyle=y,o.textBaseline="middle",o.textAlign="center";const b=r+a/2,w=l+this.height/2;this.text&&o.fillText(this.text,b,w),o.font=u,o.fillStyle=m,o.textBaseline=f,o.textAlign=_}isPointInside(o,n){return this._last_area.containsPoint([o,n])}}const layoutMutations$1=useLayoutMutations();class LLink{static{p(this,"LLink")}static _drawDebug=!1;id;parentId;type;origin_id;origin_slot;target_id;target_slot;data;_data;_pos;_last_time;path;_centreAngle;_dragging;#e;get color(){return this.#e}set color(o){this.#e=o===""?null:o}get isFloatingOutput(){return this.origin_id===-1&&this.origin_slot===-1}get isFloatingInput(){return this.target_id===-1&&this.target_slot===-1}get isFloating(){return this.isFloatingOutput||this.isFloatingInput}get originIsIoNode(){return this.origin_id===SUBGRAPH_INPUT_ID}get targetIsIoNode(){return this.target_id===SUBGRAPH_OUTPUT_ID}constructor(o,n,s,a,r,l,u){this.id=o,this.type=n,this.origin_id=s,this.origin_slot=a,this.target_id=r,this.target_slot=l,this.parentId=u,this._data=null,this._pos=[0,0]}static createFromArray(o){return new LLink(o[0],o[5],o[1],o[2],o[3],o[4])}static create(o){return new LLink(o.id,o.type,o.origin_id,o.origin_slot,o.target_id,o.target_slot,o.parentId)}static getReroutes(o,n){return n.parentId===void 0?[]:o.reroutes.get(n.parentId)?.getReroutes()??[]}static getFirstReroute(o,n){return LLink.getReroutes(o,n).at(0)}static findNextReroute(o,n,s){if(n.parentId!==void 0)return o.reroutes.get(n.parentId)?.findNextReroute(s)}static getOriginNode(o,n){const s=o.links.get(n)?.origin_id;return o.getNodeById(s)??void 0}static getTargetNode(o,n){const s=o.links.get(n)?.target_id;return o.getNodeById(s)??void 0}static resolve(o,n){return n.getLink(o)?.resolve(n)}static resolveMany(o,n){const s=[];for(const a of o){const r=n.getLink(a)?.resolve(n);r&&s.push(r)}return s}resolve(o){const n=this.target_id===-1?void 0:o.getNodeById(this.target_id)??void 0,s=n?.inputs[this.target_slot],a=this.originIsIoNode?o.inputNode?.slots[this.origin_slot]:void 0;if(a)return{inputNode:n,input:s,subgraphInput:a,link:this};const r=this.origin_id===-1?void 0:o.getNodeById(this.origin_id)??void 0,l=r?.outputs[this.origin_slot],u=this.targetIsIoNode?o.outputNode?.slots[this.target_slot]:void 0;return u?{outputNode:r,output:l,subgraphInput:void 0,subgraphOutput:u,link:this}:{inputNode:n,outputNode:r,input:s,output:l,subgraphInput:a,subgraphOutput:u,link:this}}configure(o){Array.isArray(o)?(this.id=o[0],this.origin_id=o[1],this.origin_slot=o[2],this.target_id=o[3],this.target_slot=o[4],this.type=o[5]):(this.id=o.id,this.type=o.type,this.origin_id=o.origin_id,this.origin_slot=o.origin_slot,this.target_id=o.target_id,this.target_slot=o.target_slot,this.parentId=o.parentId)}hasOrigin(o,n){return this.origin_id===o&&this.origin_slot===n}hasTarget(o,n){return this.target_id===o&&this.target_slot===n}toFloating(o,n){const s=this.asSerialisable();return s.id=-1,s.parentId=n,o==="input"?(s.origin_id=-1,s.origin_slot=-1):(s.target_id=-1,s.target_slot=-1),LLink.create(s)}disconnect(o,n){const s=LLink.getReroutes(o,this),a=s.at(-1);if(n==="output"&&a?.linkIds.size===1&&a.floatingLinkIds.size===0||n==="input"&&a){const l=LLink.create(this);l.id=-1,n==="input"?(l.origin_id=-1,l.origin_slot=-1,a.floating={slotType:"input"}):(l.target_id=-1,l.target_slot=-1,a.floating={slotType:"output"}),o.addFloatingLink(l)}for(const l of s)l.linkIds.delete(this.id),!n&&!l.totalLinks&&(o.reroutes.delete(l.id),layoutMutations$1.setSource(LayoutSource.Canvas),layoutMutations$1.deleteReroute(l.id));o.links.delete(this.id),layoutMutations$1.setSource(LayoutSource.Canvas),layoutMutations$1.deleteLink(this.id)}serialize(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]}asSerialisable(){const o={id:this.id,origin_id:this.origin_id,origin_slot:this.origin_slot,target_id:this.target_id,target_slot:this.target_slot,type:this.type};return this.parentId!==void 0&&(o.parentId=this.parentId),o}}function getNodeInputOnPos(i,o,n){const{inputs:s}=i;if(s)for(const[a,r]of s.entries()){const l=i.getInputPos(a),m=20+((r.label?.length??r.localized_name?.length??r.name?.length)||3)*7;if(isInRectangle(o,n,l[0]-10,l[1]-10,m,20))return{index:a,input:r,pos:l}}}p(getNodeInputOnPos,"getNodeInputOnPos");function getNodeOutputOnPos(i,o,n){const{outputs:s}=i;if(s)for(const[a,r]of s.entries()){const l=i.getOutputPos(a);if(isInRectangle(o,n,l[0]-10,l[1]-10,40,20))return{index:a,output:r,pos:l}}}p(getNodeOutputOnPos,"getNodeOutputOnPos");function isOverNodeInput(i,o,n,s){const a=getNodeInputOnPos(i,o,n);return a?(s&&(s[0]=a.pos[0],s[1]=a.pos[1]),a.index):-1}p(isOverNodeInput,"isOverNodeInput");function isOverNodeOutput(i,o,n,s){const a=getNodeOutputOnPos(i,o,n);return a?(s&&(s[0]=a.pos[0],s[1]=a.pos[1]),a.index):-1}p(isOverNodeOutput,"isOverNodeOutput");const ELLIPSIS="â€¦",TWO_DOT_LEADER="â€¥",ONE_DOT_LEADER="â€¤";var SlotType=(i=>(i.Array="array",i[i.Event=-1]="Event",i))(SlotType||{}),SlotShape=(i=>(i[i.Box=RenderShape.BOX]="Box",i[i.Arrow=RenderShape.ARROW]="Arrow",i[i.Grid=RenderShape.GRID]="Grid",i[i.Circle=RenderShape.CIRCLE]="Circle",i[i.HollowCircle=RenderShape.HollowCircle]="HollowCircle",i))(SlotShape||{}),SlotDirection=(i=>i)(SlotDirection||{}),LabelPosition=(i=>(i.Left="left",i.Right="right",i))(LabelPosition||{});function strokeShape(i,o,{shape:n=RenderShape.BOX,round_radius:s,title_height:a,title_mode:r=TitleMode.NORMAL_TITLE,color:l,padding:u=6,collapsed:m=!1,lineWidth:f=1}={}){if(s??=LiteGraph.ROUND_RADIUS,l??=LiteGraph.NODE_BOX_OUTLINE_COLOR,r===TitleMode.TRANSPARENT_TITLE){const C=a??LiteGraph.NODE_TITLE_HEIGHT;o[1]-=C,o[3]+=C}const{lineWidth:_,strokeStyle:y}=i;i.lineWidth=f,i.globalAlpha=.8,i.strokeStyle=l,i.beginPath();const[b,w,k,S]=o;switch(n){case RenderShape.BOX:{i.rect(b-u,w-u,k+2*u,S+2*u);break}case RenderShape.ROUND:case RenderShape.CARD:{const C=s+u,T=n===RenderShape.CARD&&m||n===RenderShape.ROUND?[C]:[C,2,C,2];i.roundRect(b-u,w-u,k+2*u,S+2*u,T);break}case RenderShape.CIRCLE:{const C=b+k/2,I=w+S/2,T=Math.max(k,S)/2+u;i.arc(C,I,T,0,Math.PI*2);break}}i.stroke(),i.lineWidth=_,i.strokeStyle=y,i.globalAlpha=1}p(strokeShape,"strokeShape");function truncateTextToWidth(i,o,n){if(!(n>0))return"";if(i.measureText(o).width<=n)return o;const a=i.measureText(ELLIPSIS).width*.75;if(a>n)return i.measureText(TWO_DOT_LEADER).width*.75<n?TWO_DOT_LEADER:i.measureText(ONE_DOT_LEADER).width*.75<n?ONE_DOT_LEADER:"";let r=0,l=o.length,u=0;for(;r<=l;){const m=Math.floor((r+l)*.5);if(m===0){r=m+1;continue}const f=o.substring(0,m);i.measureText(f).width+a<=n?(u=m,r=m+1):l=m-1}return u===0?ELLIPSIS:o.substring(0,u)+ELLIPSIS}p(truncateTextToWidth,"truncateTextToWidth");function drawTextInArea({ctx:i,text:o,area:n,align:s="left"}){const{left:a,right:r,bottom:l,width:u,centreX:m}=n;if(i.measureText(o).width<=u){i.textAlign=s;const b=s==="left"?a:s==="right"?r:m;i.fillText(o,b,l);return}const _=truncateTextToWidth(i,o,u);if(_.length===0)return;i.textAlign="left",i.fillText(_.slice(0,-1),a,l),i.rect(a,l,u,1),i.textAlign="right";const y=_.at(-1);i.fillText(y,r,l,i.measureText(y).width*.75)}p(drawTextInArea,"drawTextInArea");class SlotBase{static{p(this,"SlotBase")}name;localized_name;label;type;dir;removable;shape;color_off;color_on;locked;nameLocked;widget;_floatingLinks;hasErrors;boundingRect;constructor(o,n,s){this.name=o,this.type=n,this.boundingRect=s??new Rectangle}renderingColor(o){return this.isConnected?this.color_on||o.getConnectedColor(this.type):this.color_off||o.getDisconnectedColor(this.type)}}class NodeSlot extends SlotBase{static{p(this,"NodeSlot")}pos;get#e(){const o=this.node.pos,{boundingRect:n}=this,s=n[3];return getCentre([n[0]-o[0],n[1]-o[1],s,s])}#t;get node(){return this.#t}get highlightColor(){return LiteGraph.NODE_TEXT_HIGHLIGHT_COLOR??LiteGraph.NODE_SELECTED_TITLE_COLOR??LiteGraph.NODE_TEXT_COLOR}constructor(o,n){const s=o,{boundingRect:a,name:r,type:l,_listenerController:u,...m}=s,f=a?Rectangle.ensureRect(a):new Rectangle;super(r,l,f),Object.assign(this,m),this.#t=n}get renderingLabel(){return this.label||this.localized_name||this.name||""}draw(o,{colorContext:n,labelPosition:s=LabelPosition.Right,lowQuality:a=!1,highlight:r=!1,doStroke:l=!1}){const u=o.fillStyle,m=o.strokeStyle,f=o.lineWidth,_=r?this.highlightColor:LiteGraph.NODE_TEXT_COLOR,y=this.#e,b=this.type,w=b===SlotType.Array?SlotShape.Grid:this.shape;o.beginPath();let k=!0;if(o.fillStyle=this.renderingColor(n),o.lineWidth=1,b===SlotType.Event||w===SlotShape.Box)o.rect(y[0]-6+.5,y[1]-5+.5,14,10);else if(w===SlotShape.Arrow)o.moveTo(y[0]+8,y[1]+.5),o.lineTo(y[0]-4,y[1]+6+.5),o.lineTo(y[0]-4,y[1]-6+.5),o.closePath();else if(w===SlotShape.Grid){for(let E=0;E<3;E++)for(let N=0;N<3;N++)o.rect(y[0]-4+E*3,y[1]-4+N*3,2,2);l=!1}else if(a)o.rect(y[0]-4,y[1]-4,8,8);else{let C;w===SlotShape.HollowCircle?(k=!1,l=!0,o.lineWidth=3,o.strokeStyle=o.fillStyle,C=r?4:3):C=r?5:4,o.arc(y[0],y[1],C,0,Math.PI*2)}if(k&&o.fill(),!a&&l&&o.stroke(),!(a||this.isWidgetInputSlot)){const C=this.renderingLabel;C&&(o.fillStyle=_,s===LabelPosition.Right?this.dir==LinkDirection.UP?o.fillText(C,y[0],y[1]-10):o.fillText(C,y[0]+10,y[1]+5):this.dir==LinkDirection.DOWN?o.fillText(C,y[0],y[1]-8):o.fillText(C,y[0]-10,y[1]+5))}this.hasErrors&&(o.lineWidth=2,o.strokeStyle="red",o.beginPath(),o.arc(y[0],y[1],12,0,Math.PI*2),o.stroke()),o.fillStyle=u,o.strokeStyle=m,o.lineWidth=f}drawCollapsed(o){const[n,s]=this.collapsedPos,{fillStyle:a}=o;o.fillStyle="#686",o.beginPath(),this.type===SlotType.Event||this.shape===RenderShape.BOX?o.rect(n-7+.5,s-4,14,8):this.shape===RenderShape.ARROW?(this instanceof NodeInputSlot?(o.moveTo(n+8,s),o.lineTo(n-4,s-4),o.lineTo(n-4,s+4)):(o.moveTo(n+6,s),o.lineTo(n-6,s-4),o.lineTo(n-6,s+4)),o.closePath()):o.arc(n,s,4,0,Math.PI*2),o.fill(),o.fillStyle=a}}const layoutMutations=useLayoutMutations();class Reroute{static{p(this,"Reroute")}constructor(o,n,s,a,r,l){this.id=o,this.network=new WeakRef(n),this.parentId=a,s&&(this.pos=s),this.linkIds=new Set(r),this.floatingLinkIds=new Set(l)}static radius=10;static maxSplineOffset=80;static drawIdBadge=!1;static slotRadius=5;static get slotOffset(){const o=Reroute.slotRadius*.33;return Reroute.radius+o+Reroute.slotRadius}network;parentIdInternal;get parentId(){return this.parentIdInternal}set parentId(o){o!==this.id&&this.getReroutes()!==null&&(this.parentIdInternal=o)}get parent(){return this.network.deref()?.getReroute(this.parentIdInternal)}floating;posInternal=[0,0];get pos(){return this.posInternal}set pos(o){if(!(o?.length>=2))throw new TypeError("Reroute.pos is an x,y point, and expects an indexable with at least two values.");this.posInternal[0]=o[0],this.posInternal[1]=o[1]}get boundingRect(){const{radius:o}=Reroute,[n,s]=this.posInternal;return[n-o,s-o,2*o,2*o]}get hoverArea(){const o=2*Reroute.slotOffset,n=2*Math.max(Reroute.radius,Reroute.slotRadius),[s,a]=this.posInternal;return[s-o,a-n,2*o,2*n]}get totalLinks(){return this.linkIds.size+this.floatingLinkIds.size}selected;linkIds;floatingLinkIds;cos=0;sin=0;controlPoint=[0,0];path;_centreAngle;_pos=[0,0];_dragging;_colour;get colour(){return this._colour??"#18184d"}lastRenderTime=-1/0;inputSlot=new RerouteSlot(this,!0);outputSlot=new RerouteSlot(this,!1);get isSlotHovered(){return this.isInputHovered||this.isOutputHovered}get isInputHovered(){return this.inputSlot.hovering}get isOutputHovered(){return this.outputSlot.hovering}get firstLink(){const o=this.linkIds.values().next().value;return o===void 0?void 0:this.network.deref()?.links.get(o)}get firstFloatingLink(){const o=this.floatingLinkIds.values().next().value;return o===void 0?void 0:this.network.deref()?.floatingLinks.get(o)}get origin_id(){return this.firstLink?.origin_id}get origin_slot(){return this.firstLink?.origin_slot}update(o,n,s,a){this.parentId=o,n&&(this.pos=n),s&&(this.linkIds=new Set(s)),this.floating=a}validateLinks(o,n){const{linkIds:s,floatingLinkIds:a}=this;for(const r of s)o.has(r)||s.delete(r);for(const r of a)n.has(r)||a.delete(r);return s.size>0||a.size>0}getReroutes(o=new Set){if(this.parentIdInternal===void 0)return[this];if(o.has(this))return null;o.add(this);const n=this.network.deref()?.reroutes.get(this.parentIdInternal);if(!n)return this.parentIdInternal=void 0,[this];const s=n.getReroutes(o);return s?.push(this),s}findNextReroute(o,n=new Set){if(this.parentIdInternal===o)return this;if(n.has(this))return null;if(n.add(this),this.parentIdInternal!==void 0)return this.network.deref()?.reroutes.get(this.parentIdInternal)?.findNextReroute(o,n)}findSourceOutput(){const o=this.firstLink??this.firstFloatingLink;if(!o)return;const n=this.network.deref()?.getNodeById(o.origin_id);if(n)return{node:n,output:n.outputs[o.origin_slot]}}findTargetInputs(){const o=this.network.deref();if(!o)return;const n=[];return s(o,this.linkIds,o.links),s(o,this.floatingLinkIds,o.floatingLinks),n;function s(a,r,l){for(const u of r){const m=l.get(u);if(!m)continue;const f=a.getNodeById(m.target_id),_=f?.inputs[m.target_slot];_&&n.push({node:f,input:_,link:m})}}p(s,"addAllResults")}getFloatingLinks(o){const n=this.network.deref()?.floatingLinks;if(!n)return;const s=o==="input"?"origin_id":"target_id",a=[];for(const r of this.floatingLinkIds){const l=n.get(r);l?.[s]===-1&&a.push(l)}return a}setFloatingLinkOrigin(o,n,s){const a=this.network.deref(),r=this.getFloatingLinks("output");if(!r)throw new Error("[setFloatingLinkOrigin]: Invalid network.");if(r.length){n._floatingLinks??=new Set;for(const l of r)n._floatingLinks.add(l),a?.getNodeById(l.origin_id)?.outputs[l.origin_slot]?._floatingLinks?.delete(l),l.origin_id=o.id,l.origin_slot=s}}move(o,n){const s={x:this.posInternal[0],y:this.posInternal[1]};this.posInternal[0]+=o,this.posInternal[1]+=n,layoutMutations.setSource(LayoutSource.Canvas),layoutMutations.moveReroute(this.id,{x:this.posInternal[0],y:this.posInternal[1]},s)}snapToGrid(o){if(!o)return!1;const{pos:n}=this;return n[0]=o*Math.round(n[0]/o),n[1]=o*Math.round(n[1]/o),!0}removeAllFloatingLinks(){for(const o of this.floatingLinkIds)this.removeFloatingLink(o)}removeFloatingLink(o){const n=this.network.deref();if(!n)return;const s=n.floatingLinks.get(o);if(!s){console.warn(`[Reroute.removeFloatingLink] Floating link not found: ${o}, ignoring and discarding ID.`),this.floatingLinkIds.delete(o);return}n.removeFloatingLink(s)}removeLink(o){const n=this.network.deref();if(!n)return;const s=n.floatingLinks.get(o.id);o===s?this.floatingLinkIds.delete(o.id):this.linkIds.delete(o.id)}remove(){const o=this.network.deref();o&&o.removeReroute(this.id)}calculateAngle(o,n,s){if(!(o>this.lastRenderTime))return;this.lastRenderTime=o;const{id:a,pos:r}=this,l=[];let u=0;if(k(this.linkIds,n.links),k(this.floatingLinkIds,n.floatingLinks),!l.length){this.cos=0,this.sin=0,this.controlPoint[0]=0,this.controlPoint[1]=0;return}u/=l.length;const m=Math.atan2(this.posInternal[1]-s[1],this.posInternal[0]-s[0]);let f=(m-u)*.5;Math.abs(f)>Math.PI*.5&&(f+=Math.PI);const _=Math.min(Reroute.maxSplineOffset,distance(s,this.posInternal)*.25),y=m-f,b=Math.cos(y),w=Math.sin(y);this.cos=b,this.sin=w,this.controlPoint[0]=_*-b,this.controlPoint[1]=_*-w;function k(S,C){for(const I of S){const T=C.get(I),E=getNextPos(n,T,a);if(!E)continue;const N=getDirection(r,E);l.push(N),u+=N}}p(k,"calculateAngles")}draw(o,n){const{globalAlpha:s}=o,{pos:a}=this;if(o.beginPath(),o.arc(a[0],a[1],Reroute.radius,0,2*Math.PI),this.linkIds.size===0&&(o.fillStyle=n??"#797979",o.fill(),o.globalAlpha=s*.33),o.fillStyle=this.colour,o.lineWidth=Reroute.radius*.1,o.strokeStyle="rgb(0,0,0,0.5)",o.fill(),o.stroke(),o.fillStyle="#ffffff55",o.strokeStyle="rgb(0,0,0,0.3)",o.beginPath(),o.arc(a[0],a[1],Reroute.radius*.8,0,2*Math.PI),o.fill(),o.stroke(),this.selected&&(o.strokeStyle="#fff",o.beginPath(),o.arc(a[0],a[1],Reroute.radius*1.2,0,2*Math.PI),o.stroke()),Reroute.drawIdBadge){const r=new LGraphBadge({text:this.id.toString()}),l=a[0]-r.getWidth(o)*.5,u=a[1]-r.height-Reroute.radius-2;r.draw(o,l,u)}o.globalAlpha=s}drawSlots(o){this.inputSlot.draw(o),this.outputSlot.draw(o)}drawHighlight(o,n){const{pos:s}=this,{strokeStyle:a,lineWidth:r}=o;o.strokeStyle=n,o.lineWidth=1,o.beginPath(),o.arc(s[0],s[1],Reroute.radius*1.5,0,2*Math.PI),o.stroke(),o.strokeStyle=a,o.lineWidth=r}updateVisibility(o){const n=this.inputSlot,s=this.outputSlot;n.dirty=!1,s.dirty=!1;const{firstFloatingLink:a}=this,r=!!this.firstLink,l=r||a?.isFloatingOutput,u=r||a?.isFloatingInput;if((l||u)&&isPointInRect(o,this.hoverArea)){const f=this.contains(o);l&&n.update(o,f),u&&s.update(o,f)}else this.hideSlots();return n.dirty||s.dirty}hideSlots(){this.inputSlot.hide(),this.outputSlot.hide()}containsPoint(o){return isPointInRect(o,this.hoverArea)&&this.contains(o)}contains(o){return distance(this.pos,o)<=Reroute.radius}asSerialisable(){const{id:o,parentId:n,pos:s,linkIds:a}=this;return{id:o,parentId:n,pos:[s[0],s[1]],linkIds:[...a],floating:this.floating?{slotType:this.floating.slotType}:void 0}}}class RerouteSlot{static{p(this,"RerouteSlot")}reroute;offsetMultiplier;get pos(){const[o,n]=this.reroute.pos;return[o+Reroute.slotOffset*this.offsetMultiplier,n]}dirty=!1;hoveringInternal=!1;get hovering(){return this.hoveringInternal}set hovering(o){Object.is(this.hoveringInternal,o)||(this.hoveringInternal=o,this.dirty=!0)}showOutlineInternal=!1;get showOutline(){return this.showOutlineInternal}set showOutline(o){Object.is(this.showOutlineInternal,o)||(this.showOutlineInternal=o,this.dirty=!0)}constructor(o,n){this.reroute=o,this.offsetMultiplier=n?-1:1}update(o,n){if(n)this.hovering=!1,this.showOutline=!0;else{const s=distance(this.pos,o);this.hovering=s<=2*Reroute.slotRadius,this.showOutline=s<=5*Reroute.slotRadius}}hide(){this.hovering=!1,this.showOutline=!1}draw(o){const{fillStyle:n,strokeStyle:s,lineWidth:a}=o,{showOutline:r,hovering:l,pos:[u,m]}=this;if(r)try{o.fillStyle=l?this.reroute.colour:"rgba(127,127,127,0.3)",o.strokeStyle="rgb(0,0,0,0.5)",o.lineWidth=1,o.beginPath(),o.arc(u,m,Reroute.slotRadius,0,2*Math.PI),o.fill(),o.stroke()}finally{o.fillStyle=n,o.strokeStyle=s,o.lineWidth=a}}}function getNextPos(i,o,n){if(!o)return;const s=LLink.findNextReroute(i,o,n)?.pos;if(s)return s;if(!(o.target_id===-1||o.target_slot===-1))return i.getNodeById(o.target_id)?.getInputPos(o.target_slot)}p(getNextPos,"getNextPos");function getDirection(i,o){return Math.atan2(o[1]-i[1],o[0]-i[0])}p(getDirection,"getDirection");function parseSlotTypes(i){return i==""||i=="0"?["*"]:String(i).toLowerCase().split(",")}p(parseSlotTypes,"parseSlotTypes");function nextUniqueName(i,o=[]){let n=1;const s=i;for(;o.includes(i);)i=`${s}_${n++}`;return i}p(nextUniqueName,"nextUniqueName");function getAllNestedItems(i){const o=new Set;if(i)for(const s of i)n(s,o);return o;function n(s,a){if(!(a.has(s)||s.pinned)&&(a.add(s),s.children))for(const r of s.children)n(r,a)}}p(getAllNestedItems,"getAllNestedItems");function findFirstNode(i){for(const o of i)if(o instanceof LGraphNode)return o}p(findFirstNode,"findFirstNode");function findFreeSlotOfType(i,o,n){if(!i?.length)return;let s,a,r;const l=parseSlotTypes(o);for(const[u,m]of i.entries()){const f=parseSlotTypes(m.type);for(const _ of l)for(const y of f)if(y===_){if(n(m))return{index:u,slot:m};s??={index:u,slot:m}}else!a&&(_==="*"||y==="*")&&(n(m)?a={index:u,slot:m}:r??={index:u,slot:m})}return a??s??r}p(findFreeSlotOfType,"findFreeSlotOfType");class CustomEventTarget extends EventTarget{static{p(this,"CustomEventTarget")}dispatch(o,n){const s=new CustomEvent(o,{detail:n,cancelable:!0});return super.dispatchEvent(s)}addEventListener(o,n,s){super.addEventListener(o,n,s)}removeEventListener(o,n,s){super.removeEventListener(o,n,s)}dispatchEvent(o){return super.dispatchEvent(o)}}class ConstrainedSize{static{p(this,"ConstrainedSize")}#e=0;#t=0;#o=0;#n=0;minWidth=0;minHeight=0;maxWidth=1/0;maxHeight=1/0;get width(){return this.#e}get height(){return this.#t}get desiredWidth(){return this.#o}set desiredWidth(o){this.#o=o,this.#e=clamp(o,this.minWidth,this.maxWidth)}get desiredHeight(){return this.#n}set desiredHeight(o){this.#n=o,this.#t=clamp(o,this.minHeight,this.maxHeight)}constructor(o,n){this.desiredWidth=o,this.desiredHeight=n}static fromSize(o){return new ConstrainedSize(o[0],o[1])}static fromRect(o){return new ConstrainedSize(o[2],o[3])}setSize(o){this.desiredWidth=o[0],this.desiredHeight=o[1]}setValues(o,n){this.desiredWidth=o,this.desiredHeight=n}toSize(){return[this.#e,this.#t]}}class SubgraphSlot extends SlotBase{static{p(this,"SubgraphSlot")}static get defaultHeight(){return LiteGraph.NODE_SLOT_HEIGHT}#e=[0,0];measurement=new ConstrainedSize(SubgraphSlot.defaultHeight,SubgraphSlot.defaultHeight);id;parent;type;linkIds=[];boundingRect=new Rectangle(0,0,0,SubgraphSlot.defaultHeight);get pos(){return this.#e}set pos(o){!o||o.length<2||(this.#e[0]=o[0],this.#e[1]=o[1])}get isConnected(){return this.linkIds.length>0}get displayName(){return this.label??this.localized_name??this.name}constructor(o,n){super(o.name,o.type),Object.assign(this,o),this.id=o.id??createUuidv4(),this.type=o.type,this.parent=n}isPointerOver=!1;containsPoint(o){return this.boundingRect.containsPoint(o)}onPointerMove(o){this.isPointerOver=this.boundingRect.containsXy(o.canvasX,o.canvasY)}getLinks(){const o=[],{subgraph:n}=this.parent;for(const s of this.linkIds){const a=n.getLink(s);a&&o.push(a)}return o}decrementSlots(o){const{links:n}=this.parent.subgraph,s=o==="inputs"?"origin_slot":"target_slot";for(const a of this.linkIds){const r=n.get(a);r?r[s]--:console.warn("decrementSlots: link ID not found",a)}}measure(){const o=LGraphCanvas._measureText?.(this.displayName)??0,{defaultHeight:n}=SubgraphSlot;return this.measurement.setValues(o+n,n),this.measurement.toSize()}disconnect(){const{subgraph:o}=this.parent;for(const n of this.linkIds)o.removeLink(n);this.linkIds.length=0}draw({ctx:o,colorContext:n,lowQuality:s,fromSlot:a,editorAlpha:r=1}){const l=this.shape,{isPointerOver:u,pos:[m,f]}=this,_=a?this.isValidTarget(a):!0,y=!a||_,b=y&&u,w=o.globalAlpha;o.globalAlpha=y?r:.4*r,o.beginPath();const k=this.renderingColor(n);if(s)o.fillStyle=k,o.rect(m-4,f-4,8,8),o.fill();else if(l===SlotShape.HollowCircle){o.lineWidth=3,o.strokeStyle=k;const S=b?4:3;o.arc(m,f,S,0,Math.PI*2),o.stroke()}else{o.fillStyle=k;const S=b?5:4;o.arc(m,f,S,0,Math.PI*2),o.fill()}if(this.displayName){const[S,C]=this.labelPos;o.fillStyle=b?"white":LiteGraph.NODE_TEXT_COLOR||"#AAA",o.fillText(this.displayName,S,C)}o.globalAlpha=w}asSerialisable(){const{id:o,name:n,type:s,linkIds:a,localized_name:r,label:l,dir:u,shape:m,color_off:f,color_on:_,pos:y}=this;return{id:o,name:n,type:s,linkIds:a,localized_name:r,label:l,dir:u,shape:m,color_off:f,color_on:_,pos:y}}}class SubgraphInput extends SubgraphSlot{static{p(this,"SubgraphInput")}events=new CustomEventTarget;#e;get _widget(){return this.#e?.deref()}set _widget(o){this.#e=o?new WeakRef(o):void 0}connect(o,n,s){const{subgraph:a}=this.parent,r=n.inputs.indexOf(o);if(n.onConnectInput?.(r,this.type,this,this.parent,-1)===!1)return;if(o.link!=null){a.beforeChange();const _=a.getLink(o.link);this.parent._disconnectNodeInput(n,o,_)}const l=n.getWidgetFromSlot(o);if(l){if(!this.matchesWidget(l)){console.warn("Target input has invalid widget.",o,n);return}this._widget??=l,this.events.dispatch("input-connected",{input:o,widget:l})}const u=new LLink(++a.state.lastLinkId,o.type,this.parent.id,this.parent.slots.indexOf(this),n.id,r,s);a._links.set(u.id,u),this.linkIds.push(u.id),o.link=u.id;const m=LLink.getReroutes(a,u);for(const _ of m)_.linkIds.add(u.id),_.floating&&delete _.floating,_._dragging=void 0;const f=m.at(-1);if(f)for(const _ of f.floatingLinkIds){const y=a.floatingLinks.get(_);y?.parentId===f.id&&a.removeFloatingLink(y)}return a._version++,n.onConnectionsChange?.(NodeSlotType.INPUT,r,!0,u,o),a.afterChange(),u}get labelPos(){const[o,n,,s]=this.boundingRect;return[o,n+s*.5]}getConnectedWidgets(){const{subgraph:o}=this.parent,n=[];for(const s of this.linkIds){const a=o.getLink(s);if(!a){console.error("Link not found",s);continue}const r=a.resolve(o);if(r.input&&r.inputNode?.widgets){const l=r.input.widget;if(!l)continue;if(!l.name){console.warn("Invalid widget name",l);continue}const u=r.inputNode.widgets.find(m=>m.name===l.name);if(!u){console.warn("Widget not found",l);continue}n.push(u)}}return n}matchesWidget(o){const n=this.#e?.deref();return n?!(o.type!==n.type||o.options.min!==n.options.min||o.options.max!==n.options.max||o.options.step!==n.options.step||o.options.step2!==n.options.step2||o.options.precision!==n.options.precision):!0}disconnect(){super.disconnect(),this.events.dispatch("input-disconnected",{input:this})}arrange(o){const[n,s,a,r]=o,{boundingRect:l,pos:u}=this;l[0]=n-a,l[1]=s,l[2]=a,l[3]=r,u[0]=n-r*.5,u[1]=s+r*.5}isValidTarget(o){return isNodeSlot(o)?"link"in o&&LiteGraph.isValidConnection(this.type,o.type):isSubgraphOutput(o)?LiteGraph.isValidConnection(this.type,o.type):!1}}class EmptySubgraphInput extends SubgraphInput{static{p(this,"EmptySubgraphInput")}constructor(o){super({id:zeroUuid,name:"",type:""},o)}connect(o,n,s){const{subgraph:a}=this.parent,r=a.inputs.map(m=>m.name),l=nextUniqueName(o.name,r);return a.addInput(l,String(o.type)).connect(o,n,s)}get labelPos(){const[o,n,,s]=this.boundingRect;return[o,n+s*.5]}}class SubgraphIONodeBase{static{p(this,"SubgraphIONodeBase")}constructor(o){this.subgraph=o}static margin=10;static minWidth=100;static roundedRadius=10;#e=new Rectangle;get boundingRect(){return this.#e}selected=!1;pinned=!1;removable=!1;isPointerOver=!1;get pos(){return this.boundingRect.pos}set pos(o){this.boundingRect.pos=o}get size(){return this.boundingRect.size}set size(o){this.boundingRect.size=o}get sideLineWidth(){return this.isPointerOver?2.5:2}get sideStrokeStyle(){return this.isPointerOver?"white":"#efefef"}move(o,n){this.pos[0]+=o,this.pos[1]+=n}snapToGrid(o){return this.pinned?!1:snapPoint(this.pos,o)}containsPoint(o){return this.boundingRect.containsPoint(o)}onPointerMove(o){const n=this.boundingRect.containsXy(o.canvasX,o.canvasY);let s=n?CanvasItem.SubgraphIoNode:CanvasItem.Nothing;if(n){this.isPointerOver||this.onPointerEnter();for(const a of this.allSlots)a.onPointerMove(o),a.isPointerOver&&(s|=CanvasItem.SubgraphIoSlot)}else this.isPointerOver&&this.onPointerLeave();return s}onPointerEnter(){this.isPointerOver=!0}onPointerLeave(){this.isPointerOver=!1;for(const o of this.slots)o.isPointerOver=!1}getSlotInPosition(o,n){for(const s of this.allSlots)if(s.boundingRect.containsXy(o,n))return s}handleSlotDoubleClick(o,n){o!==this.emptySlot&&this.#n(o,n)}showSlotContextMenu(o,n){const s=this.#t(o);s.length>0&&new LiteGraph.ContextMenu(s,{event:n,title:o.name||"Subgraph Output",callback:p(a=>{this.#o(a,o,n)},"callback")})}#t(o){const n=[];return o!==this.emptySlot&&o.linkIds.length>0&&n.push({content:"Disconnect Links",value:"disconnect"}),o!==this.emptySlot&&n.push({content:"Rename Slot",value:"rename"}),o!==this.emptySlot&&(n.push(null),n.push({content:"Remove Slot",value:"remove",className:"danger"})),n}#o(o,n,s){switch(o.value){case"disconnect":n.disconnect();break;case"remove":n!==this.emptySlot&&this.removeSlot(n);break;case"rename":n!==this.emptySlot&&this.#n(n,s);break}this.subgraph.setDirtyCanvas(!0)}#n(o,n){this.subgraph.canvasAction(s=>s.prompt("Slot name",o.displayName,a=>{a&&this.renameSlot(o,a)},n))}arrange(){const{minWidth:o,roundedRadius:n}=SubgraphIONodeBase,[,s]=this.boundingRect,a=this.slotAnchorX,{size:r}=this;let l=o,u=s+n;for(const m of this.allSlots){const[f,_]=m.measure();m.arrange([a,u,f,_]),u+=_,f>l&&(l=f)}r[0]=l+2*n,r[1]=u-s+n}draw(o,n,s,a){const{lineWidth:r,strokeStyle:l,fillStyle:u,font:m,textBaseline:f}=o;this.drawProtected(o,n,s,a),Object.assign(o,{lineWidth:r,strokeStyle:l,fillStyle:u,font:m,textBaseline:f})}drawSlots(o,n,s,a){o.fillStyle="#AAA",o.font="12px Arial",o.textBaseline="middle";for(const r of this.allSlots)r.draw({ctx:o,colorContext:n,fromSlot:s,editorAlpha:a})}configure(o){this.#e.set(o.bounding),this.pinned=o.pinned??!1}asSerialisable(){return{id:this.id,bounding:this.boundingRect.export(),pinned:this.pinned?!0:void 0}}}class SubgraphInputNode extends SubgraphIONodeBase{static{p(this,"SubgraphInputNode")}id=SUBGRAPH_INPUT_ID;emptySlot=new EmptySubgraphInput(this);get slots(){return this.subgraph.inputs}get allSlots(){return[...this.slots,this.emptySlot]}get slotAnchorX(){const[o,,n]=this.boundingRect;return o+n-SubgraphIONodeBase.roundedRadius}onPointerDown(o,n,s){if(o.button===0)for(const a of this.allSlots)a.boundingRect.containsXy(o.canvasX,o.canvasY)&&(n.onDragStart=()=>{s.dragNewFromSubgraphInput(this.subgraph,this,a)},n.onDragEnd=r=>{s.dropLinks(this.subgraph,r)},n.onDoubleClick=()=>{this.handleSlotDoubleClick(a,o)},n.finally=()=>{s.reset(!0)});else if(o.button===2){const a=this.getSlotInPosition(o.canvasX,o.canvasY);a&&this.showSlotContextMenu(a,o)}}renameSlot(o,n){this.subgraph.renameInput(o,n)}removeSlot(o){this.subgraph.removeInput(o)}canConnectTo(o,n,s){return o.canConnectTo(this,n,s)}connectSlots(o,n,s,a){const{subgraph:r}=this,l=this.slots.indexOf(o),u=n.inputs.indexOf(s);if(l===-1||u===-1)throw new Error("Invalid slot indices.");return new LLink(++r.state.lastLinkId,s.type||o.type,this.id,l,n.id,u,a)}connectByType(o,n,s,a){const r=n.findInputByType(s);if(r){if(o===-1){const l=this.subgraph.addInput(r.slot.name,String(r.slot.type??"")),u=this.slots.indexOf(l);if(u===-1){console.error("Could not find newly created subgraph input slot.");return}o=u}return this.slots[o].connect(r.slot,n,a?.afterRerouteId)}}findOutputSlot(o){return this.slots.find(n=>n.name===o)}findOutputByType(o){return findFreeSlotOfType(this.slots,o,n=>n.linkIds.length>0)?.slot}_disconnectNodeInput(o,n,s){const{subgraph:a}=this;if(n._floatingLinks?.size)for(const f of n._floatingLinks)a.removeFloatingLink(f);if(n.link=null,a.setDirtyCanvas(!1,!0),!s)return;const r=s.origin_slot;s.disconnect(a,"output"),a._version++;const l=this.slots.at(r);if(!l){console.warn("disconnectNodeInput: subgraphInput not found",this,r);return}const u=l.linkIds.indexOf(s.id);u!==-1?l.linkIds.splice(u,1):console.warn("disconnectNodeInput: link ID not found in subgraphInput linkIds",s.id);const m=o.inputs.findIndex(f=>f===n);m!==-1&&o.onConnectionsChange?.(NodeSlotType.INPUT,m,!1,s,l)}drawProtected(o,n,s,a){const{roundedRadius:r}=SubgraphIONodeBase,l=o.getTransform(),[u,m,f,_]=this.boundingRect;o.translate(u,m),o.strokeStyle=this.sideStrokeStyle,o.lineWidth=this.sideLineWidth,o.beginPath(),o.arc(f-r,r,r,Math.PI*1.5,0),o.moveTo(f,r),o.lineTo(f,_-r),o.arc(f-r,_-r,r,0,Math.PI*.5),o.stroke(),o.setTransform(l),this.drawSlots(o,n,s,a)}}class SubgraphOutput extends SubgraphSlot{static{p(this,"SubgraphOutput")}connect(o,n,s){const{subgraph:a}=this.parent;if(!LiteGraph.isValidConnection(o.type,this.type))return;const r=n.outputs.indexOf(o);if(r===-1)throw new Error("Slot is not an output of the given node");if(n.onConnectOutput?.(r,this.type,this,this.parent,-1)===!1)return;const l=this.getLinks().at(0);if(l!=null){a.beforeChange(),l.disconnect(a,"input");const y=l.resolve(a).output?.links;y&&pull(y,l.id)}const u=new LLink(++a.state.lastLinkId,o.type,n.id,r,this.parent.id,this.parent.slots.indexOf(this),s);a._links.set(u.id,u),this.linkIds[0]=u.id,o.links??=[],o.links.push(u.id);const m=LLink.getReroutes(a,u);for(const _ of m)_.linkIds.add(u.id),_.floating&&delete _.floating,_._dragging=void 0;const f=m.at(-1);if(f)for(const _ of f.floatingLinkIds){const y=a.floatingLinks.get(_);y?.parentId===f.id&&a.removeFloatingLink(y)}return a._version++,n.onConnectionsChange?.(NodeSlotType.OUTPUT,r,!0,u,o),a.afterChange(),u}get labelPos(){const[o,n,,s]=this.boundingRect;return[o+s,n+s*.5]}arrange(o){const[n,s,a,r]=o,{boundingRect:l,pos:u}=this;l[0]=n,l[1]=s,l[2]=a,l[3]=r,u[0]=n+r*.5,u[1]=s+r*.5}isValidTarget(o){return isNodeSlot(o)?"links"in o&&LiteGraph.isValidConnection(o.type,this.type):isSubgraphInput(o)?LiteGraph.isValidConnection(o.type,this.type):!1}disconnect(){const{subgraph:o}=this.parent;for(const n of this.linkIds){const s=o.links[n];if(!s)continue;o.removeLink(n);const{output:a,outputNode:r}=s.resolve(o);a&&(a.links=a.links?.filter(l=>l!==n)??null),r?.onConnectionsChange?.(NodeSlotType.OUTPUT,s.origin_slot,!1,s,this)}this.linkIds.length=0}}class EmptySubgraphOutput extends SubgraphOutput{static{p(this,"EmptySubgraphOutput")}constructor(o){super({id:zeroUuid,name:"",type:""},o)}connect(o,n,s){const{subgraph:a}=this.parent,r=a.outputs.map(m=>m.name),l=nextUniqueName(o.name,r);return a.addOutput(l,String(o.type)).connect(o,n,s)}get labelPos(){const[o,n,,s]=this.boundingRect;return[o,n+s*.5]}}class SubgraphOutputNode extends SubgraphIONodeBase{static{p(this,"SubgraphOutputNode")}id=SUBGRAPH_OUTPUT_ID;emptySlot=new EmptySubgraphOutput(this);get slots(){return this.subgraph.outputs}get allSlots(){return[...this.slots,this.emptySlot]}get slotAnchorX(){const[o]=this.boundingRect;return o+SubgraphIONodeBase.roundedRadius}onPointerDown(o,n,s){if(o.button===0)for(const a of this.allSlots)a.boundingRect.containsXy(o.canvasX,o.canvasY)&&(n.onDragStart=()=>{s.dragNewFromSubgraphOutput(this.subgraph,this,a)},n.onDragEnd=r=>{s.dropLinks(this.subgraph,r)},n.onDoubleClick=()=>{this.handleSlotDoubleClick(a,o)},n.finally=()=>{s.reset(!0)});else if(o.button===2){const a=this.getSlotInPosition(o.canvasX,o.canvasY);a&&this.showSlotContextMenu(a,o)}}renameSlot(o,n){this.subgraph.renameOutput(o,n)}removeSlot(o){this.subgraph.removeOutput(o)}canConnectTo(o,n,s){return o.canConnectTo(this,n,s)}connectByTypeOutput(o,n,s,a){const r=n.findOutputByType(s);if(r)return this.slots[o].connect(r.slot,n,a?.afterRerouteId)}findInputByType(o){return findFreeSlotOfType(this.slots,o,n=>n.linkIds.length>0)?.slot}drawProtected(o,n,s,a){const{roundedRadius:r}=SubgraphIONodeBase,l=o.getTransform(),[u,m,,f]=this.boundingRect;o.translate(u,m),o.strokeStyle=this.sideStrokeStyle,o.lineWidth=this.sideLineWidth,o.beginPath(),o.arc(r,r,r,Math.PI,Math.PI*1.5),o.moveTo(0,r),o.lineTo(0,f-r),o.arc(r,f-r,r,Math.PI,Math.PI*.5,!0),o.stroke(),o.setTransform(l),this.drawSlots(o,n,s,a)}}function splitPositionables(i){const o=new Set,n=new Set,s=new Set,a=new Set,r=new Set,l=new Set;for(const u of i)switch(!0){case u instanceof LGraphNode:o.add(u);break;case u instanceof LGraphGroup:s.add(u);break;case u instanceof Reroute:n.add(u);break;case u instanceof SubgraphInputNode:a.add(u);break;case u instanceof SubgraphOutputNode:r.add(u);break;default:l.add(u);break}return{nodes:o,reroutes:n,groups:s,subgraphInputNodes:a,subgraphOutputNodes:r,unknown:l}}p(splitPositionables,"splitPositionables");function getBoundaryLinks(i,o){const n=[],s=[],a=[],r=[],l=[],u=new WeakSet;for(const f of o)if(!u.has(f)){if(u.add(f),f instanceof LGraphNode){const _=f;if(_.inputs)for(const y of _.inputs){if(m(y._floatingLinks),y.link==null)continue;const b=LLink.resolve(y.link,i);if(!b){console.warn(`Failed to resolve link ID [${y.link}]`);continue}const{link:w,outputNode:k}=b;k?o.has(k)?n.push(w):a.push(w):w.origin_id===SUBGRAPH_INPUT_ID&&a.push(w)}if(_.outputs)for(const y of _.outputs){if(m(y._floatingLinks),!y.links)continue;const b=LLink.resolveMany(y.links,i);for(const{link:w,inputNode:k}of b)(w.target_id===SUBGRAPH_OUTPUT_ID||k&&!o.has(k))&&r.push(w)}}else if(f instanceof Reroute){const _=f,y=LLink.resolveMany(_.linkIds,i);for(const{link:b}of y){const k=LLink.getReroutes(i,b).filter(I=>!o.has(I)),{inputNode:S,outputNode:C}=b.resolve(i);(k.length||S&&!o.has(S)||C&&!o.has(C))&&s.push(b)}}}return{boundaryLinks:s,boundaryFloatingLinks:l,internalLinks:n,boundaryInputLinks:a,boundaryOutputLinks:r};function m(f){if(f)for(const _ of f)LLink.getReroutes(i,_).some(b=>!o.has(b))&&l.push(_)}}p(getBoundaryLinks,"getBoundaryLinks");function multiClone(i){const o=[];for(const n of i){const s=LiteGraph.createNode(n.type);if(!s){console.warn("Failed to create node",n.type);continue}const a=LiteGraph.cloneObject(n.serialize());s.configure(a),o.push(s.serialize())}return o}p(multiClone,"multiClone");function groupResolvedByOutput(i){const o=new Map;for(const n of i){const s=n.subgraphInput??n.output??{},a=o.get(s);a?a.push(n):o.set(s,[n])}return o}p(groupResolvedByOutput,"groupResolvedByOutput");function mapSubgraphInputsAndLinks(i,o){const n=groupResolvedByOutput(i),s=[];for(const[,a]of n){const r=[];for(const E of a){const{link:N,input:L}=E;if(!L)continue;const A=N.asSerialisable();A.origin_id=SUBGRAPH_INPUT_ID,A.origin_slot=s.length,o.push(A),r.push(A)}const{input:l}=a[0];if(!l)continue;const{color_off:u,color_on:m,dir:f,hasErrors:_,label:y,localized_name:b,name:w,shape:k,type:S}=l,C=nextUniqueName(w,s.map(E=>E.name)),I=b?nextUniqueName(b,s.map(E=>E.localized_name??"")):void 0,T={id:createUuidv4(),type:String(S),linkIds:r.map(E=>E.id),name:C,color_off:u,color_on:m,dir:f,label:y,localized_name:I,hasErrors:_,shape:k};s.push(T)}return s}p(mapSubgraphInputsAndLinks,"mapSubgraphInputsAndLinks");function mapSubgraphOutputsAndLinks(i,o){const n=groupResolvedByOutput(i),s=[];for(const[,a]of n){const r=[];for(const E of a){const{link:N,output:L}=E;if(!L)continue;const A=N.asSerialisable();A.target_id=SUBGRAPH_OUTPUT_ID,A.target_slot=s.length,o.push(A),r.push(A)}const{output:l}=a[0];if(!l)continue;const{color_off:u,color_on:m,dir:f,hasErrors:_,label:y,localized_name:b,name:w,shape:k,type:S}=l,C=nextUniqueName(w,s.map(E=>E.name)),I=b?nextUniqueName(b,s.map(E=>E.localized_name??"")):void 0,T={id:createUuidv4(),type:String(S),linkIds:r.map(E=>E.id),name:C,color_off:u,color_on:m,dir:f,label:y,localized_name:I,hasErrors:_,shape:k};s.push(structuredClone(T))}return s}p(mapSubgraphOutputsAndLinks,"mapSubgraphOutputsAndLinks");function getDirectSubgraphIds(i){const o=new Set;for(const n of i._nodes)n.isSubgraphNode()&&o.add(n.type);return o}p(getDirectSubgraphIds,"getDirectSubgraphIds");function findUsedSubgraphIds(i,o){const n=new Set,s=[i];for(;s.length>0;){const a=s.shift(),r=getDirectSubgraphIds(a);for(const l of r)if(!n.has(l)){n.add(l);const u=o.get(l);u&&s.push(u)}}return n}p(findUsedSubgraphIds,"findUsedSubgraphIds");function isSubgraphInput(i){return i!=null&&typeof i=="object"&&"parent"in i&&i.parent instanceof SubgraphInputNode}p(isSubgraphInput,"isSubgraphInput");function isSubgraphOutput(i){return i!=null&&typeof i=="object"&&"parent"in i&&i.parent instanceof SubgraphOutputNode}p(isSubgraphOutput,"isSubgraphOutput");function isNodeSlot(i){return i!=null&&typeof i=="object"&&("link"in i||"links"in i)}p(isNodeSlot,"isNodeSlot");class NodeInputSlot extends NodeSlot{static{p(this,"NodeInputSlot")}link;get isWidgetInputSlot(){return!!this.widget}#e;get _widget(){return this.#e?.deref()}set _widget(o){this.#e=o?new WeakRef(o):void 0}get collapsedPos(){return[0,LiteGraph.NODE_TITLE_HEIGHT*-.5]}constructor(o,n){super(o,n),this.link=o.link}get isConnected(){return this.link!=null}isValidTarget(o){return"links"in o?LiteGraph.isValidConnection(o.type,this.type):isSubgraphInput(o)?LiteGraph.isValidConnection(o.type,this.type):!1}draw(o,n){const{textAlign:s}=o;o.textAlign="left",super.draw(o,{...n,labelPosition:LabelPosition.Right,doStroke:!1}),o.textAlign=s}}class NodeOutputSlot extends NodeSlot{static{p(this,"NodeOutputSlot")}#e;links;_data;slot_index;get isWidgetInputSlot(){return!1}get collapsedPos(){return[this.#e._collapsed_width??LiteGraph.NODE_COLLAPSED_WIDTH,LiteGraph.NODE_TITLE_HEIGHT*-.5]}constructor(o,n){super(o,n),this.links=o.links,this._data=o._data,this.slot_index=o.slot_index,this.#e=n}isValidTarget(o){return"link"in o?LiteGraph.isValidConnection(this.type,o.type):isSubgraphOutput(o)?LiteGraph.isValidConnection(this.type,o.type):!1}get isConnected(){return this.links!=null&&this.links.length>0}draw(o,n){const{textAlign:s,strokeStyle:a}=o;o.textAlign="right",o.strokeStyle="black",super.draw(o,{...n,labelPosition:LabelPosition.Left,doStroke:!0}),o.textAlign=s,o.strokeStyle=a}}const UNIQUE_MESSAGE_LIMIT=1e4,sentWarnings=new Set;function warnDeprecated(i,o){if(!LiteGraph.alwaysRepeatWarnings){if(sentWarnings.has(i)||sentWarnings.size>UNIQUE_MESSAGE_LIMIT)return;sentWarnings.add(i)}for(const n of LiteGraph.onDeprecationWarning)n(i,o)}p(warnDeprecated,"warnDeprecated");function distributeSpace(i,o){if(o.length===0)return[];const n=o.reduce((r,l)=>r+l.minSize,0);if(i<n)return o.map(r=>r.minSize);let s=o.map(r=>({computedSize:r.minSize,maxSize:r.maxSize??1/0,remaining:(r.maxSize??1/0)-r.minSize})),a=i-n;for(;a>0&&s.some(r=>r.remaining>0);){const r=s.filter(m=>m.remaining>0).length;if(r===0)break;const l=a/r;let u=0;if(s=s.map(m=>{if(m.remaining<=0)return m;const f=Math.min(l,m.remaining);return u+=f,{...m,computedSize:m.computedSize+f,remaining:m.remaining-f}}),a-=u,u===0)break}return s.map(({computedSize:r})=>r)}p(distributeSpace,"distributeSpace");function truncateText(i,o,n,s="..."){if(i.measureText(o).width<=n||n<=0)return o;const r=i.measureText(s).width,l=n-r;if(l<=0)return s;let u=0,m=o.length,f=0;for(;u<=m;){const _=Math.floor((u+m)/2),y=o.substring(0,_);i.measureText(y).width<=l?(f=_,u=_+1):m=_-1}return o.substring(0,f)+s}p(truncateText,"truncateText");function toClass(i,...o){return o[0]instanceof i?o[0]:new i(...o)}p(toClass,"toClass");function isColorable(i){return typeof i=="object"&&i!==null&&"setColorOption"in i&&"getColorOption"in i}p(isColorable,"isColorable");class BaseWidget{static{p(this,"BaseWidget")}static margin=15;static arrowMargin=6;static arrowWidth=10;static minValueWidth=42;static labelValueGap=5;#e;get node(){return this.#e}linkedWidgets;name;options;label;type;y=0;last_y;width;disabled;computedDisabled;hidden;advanced;promoted;tooltip;element;#t;get value(){return this.#t}set value(o){this.#t=o}constructor(o,n){this.#e=n??o.node,this.name=o.name,this.options=o.options,this.type=o.type;const{node:s,outline_color:a,background_color:r,height:l,text_color:u,secondary_text_color:m,disabledTextColor:f,displayName:_,displayValue:y,labelBaseline:b,promoted:w,...k}=o;Object.assign(this,k)}get outline_color(){return this.promoted?LiteGraph.WIDGET_PROMOTED_OUTLINE_COLOR:this.advanced?LiteGraph.WIDGET_ADVANCED_OUTLINE_COLOR:LiteGraph.WIDGET_OUTLINE_COLOR}get background_color(){return LiteGraph.WIDGET_BGCOLOR}get height(){return LiteGraph.NODE_WIDGET_HEIGHT}get text_color(){return LiteGraph.WIDGET_TEXT_COLOR}get secondary_text_color(){return LiteGraph.WIDGET_SECONDARY_TEXT_COLOR}get disabledTextColor(){return LiteGraph.WIDGET_DISABLED_TEXT_COLOR}get displayName(){return this.label||this.name}get _displayValue(){return this.computedDisabled?"":String(this.value)}get labelBaseline(){return this.y+this.height*.7}drawWidgetShape(o,{width:n,showText:s}){const{height:a,y:r}=this,{margin:l}=BaseWidget;o.textAlign="left",o.strokeStyle=this.outline_color,o.fillStyle=this.background_color,o.beginPath(),s?o.roundRect(l,r,n-l*2,a,[a*.5]):o.rect(l,r,n-l*2,a),o.fill(),s&&!this.computedDisabled&&o.stroke()}drawTruncatingText({ctx:o,width:n,leftPadding:s=5,rightPadding:a=20}){const{height:r,y:l}=this,{margin:u}=BaseWidget,{displayName:m,_displayValue:f}=this,_=o.measureText(m).width,y=o.measureText(f).width,b=BaseWidget.labelValueGap,w=u*2+s,k=n-w-2*u-a,S=_+b+y,C=new Rectangle(w,l,k,r*.7);if(o.fillStyle=this.secondary_text_color,S<=k)drawTextInArea({ctx:o,text:m,area:C,align:"left"});else if(LiteGraph.truncateWidgetTextEvenly){const I=(k-b)/(S-b);C.width=_*I,drawTextInArea({ctx:o,text:m,area:C,align:"left"}),C.right=w+k,C.setWidthRightAnchored(y*I)}else if(LiteGraph.truncateWidgetValuesFirst){const I=Math.min(_,k);C.width=I,drawTextInArea({ctx:o,text:m,area:C,align:"left"}),C.right=w+k,C.setWidthRightAnchored(Math.max(k-b-I,0))}else{const I=Math.min(y,k);C.width=Math.max(k-b-I,0),drawTextInArea({ctx:o,text:m,area:C,align:"left"}),C.right=w+k,C.setWidthRightAnchored(I)}o.fillStyle=this.text_color,drawTextInArea({ctx:o,text:f,area:C,align:"right"})}setValue(o,{e:n,node:s,canvas:a}){const r=this.value;if(o===this.value)return;const l=this.type==="number"?Number(o):o;this.value=l,this.options?.property&&s.properties[this.options.property]!==void 0&&s.setProperty(this.options.property,l);const u=a.graph_mouse;this.callback?.(this.value,a,s,u,n),s.onWidgetChanged?.(this.name??"",l,r,this),s.graph&&s.graph._version++}createCopyForNode(o){const n=new this.constructor(this,o);return n.value=this.value,n}}class AssetWidget extends BaseWidget{static{p(this,"AssetWidget")}constructor(o,n){super(o,n),this.type??="asset",this.value=o.value?.toString()??""}set value(o){const n=this.value;if(super.value=o,n!==o&&this.node.graph?.list_of_graphcanvas)for(const s of this.node.graph.list_of_graphcanvas)s.setDirty(!0)}get value(){return super.value}get _displayValue(){return String(this.value)}drawWidget(o,{width:n,showText:s=!0}){const{fillStyle:a,strokeStyle:r,textAlign:l}=o;this.drawWidgetShape(o,{width:n,showText:s}),s&&this.drawTruncatingText({ctx:o,width:n,leftPadding:0,rightPadding:0}),Object.assign(o,{textAlign:l,strokeStyle:r,fillStyle:a})}onClick(){this.callback?.(this.value)}}let BooleanWidget$1=class extends BaseWidget{static{p(this,"BooleanWidget")}type="toggle";drawWidget(o,{width:n,showText:s=!0}){const{height:a,y:r}=this,{margin:l}=BaseWidget;this.drawWidgetShape(o,{width:n,showText:s}),o.fillStyle=this.value?"#89A":"#333",o.beginPath(),o.arc(n-l*2,r+a*.5,a*.36,0,Math.PI*2),o.fill(),s&&(this.drawLabel(o,l*2),this.drawValue(o,n-40))}drawLabel(o,n){o.fillStyle=this.secondary_text_color;const{displayName:s}=this;s&&o.fillText(s,n,this.labelBaseline)}drawValue(o,n){o.fillStyle=this.value?this.text_color:this.secondary_text_color,o.textAlign="right";const s=this.value?this.options.on||"true":this.options.off||"false";o.fillText(s,n,this.labelBaseline)}onClick(o){this.setValue(!this.value,o)}};class ButtonWidget extends BaseWidget{static{p(this,"ButtonWidget")}type="button";clicked;constructor(o,n){super(o,n),this.clicked??=!1}drawWidget(o,{width:n,showText:s=!0}){const{fillStyle:a,strokeStyle:r,textAlign:l}=o,{height:u,y:m}=this,{margin:f}=BaseWidget;o.fillStyle=this.background_color,this.clicked&&(o.fillStyle="#AAA",this.clicked=!1),o.fillRect(f,m,n-f*2,u),s&&!this.computedDisabled&&(o.strokeStyle=this.outline_color,o.strokeRect(f,m,n-f*2,u)),s&&this.drawLabel(o,n*.5),Object.assign(o,{textAlign:l,strokeStyle:r,fillStyle:a})}drawLabel(o,n){o.textAlign="center",o.fillStyle=this.text_color,o.fillText(this.displayName,n,this.y+this.height*.7)}onClick({e:o,node:n,canvas:s}){const a=s.graph_mouse;this.clicked=!0,s.setDirty(!0),this.callback?.(this,s,n,a,o)}}class ChartWidget extends BaseWidget{static{p(this,"ChartWidget")}type="chart";drawWidget(o,n){const{width:s}=n,{y:a,height:r}=this,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_}=o;o.fillStyle=this.background_color,o.fillRect(15,a,s-30,r),o.strokeStyle=this.outline_color,o.strokeRect(15,a,s-30,r),o.fillStyle=this.text_color,o.font="11px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("Chart: Vue-only",s/2,a+r/2),Object.assign(o,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_})}onClick(o){}}class ColorWidget extends BaseWidget{static{p(this,"ColorWidget")}type="color";drawWidget(o,n){const{width:s}=n,{y:a,height:r}=this,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_}=o;o.fillStyle=this.background_color,o.fillRect(15,a,s-30,r),o.strokeStyle=this.outline_color,o.strokeRect(15,a,s-30,r),o.fillStyle=this.text_color,o.font="11px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("Color: Vue-only",s/2,a+r/2),Object.assign(o,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_})}onClick(o){}}class BaseSteppedWidget extends BaseWidget{static{p(this,"BaseSteppedWidget")}drawArrowButtons(o,n){const{height:s,text_color:a,disabledTextColor:r,y:l}=this,{arrowMargin:u,arrowWidth:m,margin:f}=BaseWidget,_=f+u,y=_+m;o.fillStyle=this.canDecrement()?a:r,o.beginPath(),o.moveTo(y,l+5),o.lineTo(_,l+s*.5),o.lineTo(y,l+s-5),o.fill(),o.fillStyle=this.canIncrement()?a:r,o.beginPath(),o.moveTo(n-y,l+5),o.lineTo(n-_,l+s*.5),o.lineTo(n-y,l+s-5),o.fill()}drawWidget(o,n){const{fillStyle:s,strokeStyle:a,textAlign:r}=o;this.drawWidgetShape(o,n),n.showText&&(this.computedDisabled||this.drawArrowButtons(o,n.width),this.drawTruncatingText({ctx:o,width:n.width})),Object.assign(o,{textAlign:r,strokeStyle:a,fillStyle:s})}}function toArray(i){return Array.isArray(i)?i:Object.keys(i)}p(toArray,"toArray");class ComboWidget extends BaseSteppedWidget{static{p(this,"ComboWidget")}type="combo";get _displayValue(){if(this.computedDisabled)return"";if(this.options.getOptionLabel)try{return this.options.getOptionLabel(this.value?String(this.value):null)}catch(n){return console.error("Failed to map value:",n),this.value?String(this.value):""}const{values:o}=this.options;if(o){const n=typeof o=="function"?o():o;if(n&&!Array.isArray(n))return n[this.value]}return typeof this.value=="number"?String(this.value):this.value}getValues(o){const{values:n}=this.options;if(n==null)throw new Error("[ComboWidget]: values is required");return typeof n=="function"?n(this,o):n}canUseButton(o){const{values:n}=this.options;if(typeof n=="function")return!1;const s=toArray(n);if(!(s.length>1))return!1;const a=s.at(0),r=s.at(-1);return a===r?!0:this.value!==(o?r:a)}canIncrement(){return this.canUseButton(!0)}canDecrement(){return this.canUseButton(!1)}incrementValue(o){this.tryChangeValue(1,o)}decrementValue(o){this.tryChangeValue(-1,o)}tryChangeValue(o,n){const s=this.getValues(n.node),a=toArray(s);n.canvas.last_mouseclick=0;const r=typeof s=="object"?a.indexOf(String(this.value))+o:a.indexOf(this.value)+o,l=clamp(r,0,a.length-1),u=Array.isArray(s)?s[l]:l;this.setValue(u,n)}onClick({e:o,node:n,canvas:s}){const a=o.canvasX-n.pos[0],r=this.width||n.size[0];if(typeof this.options.values=="function"&&warnDeprecated("Using a function for values is deprecated. Use an array of unique values instead."),a<40)return this.decrementValue({e:o,node:n,canvas:s});if(a>r-40)return this.incrementValue({e:o,node:n,canvas:s});const l=this.getValues(n),u=toArray(l);if(this.options.getOptionLabel){const f={scale:Math.max(1,s.ds.scale),event:o,className:"dark",callback:p(y=>{this.setValue(y,{e:o,node:n,canvas:s})},"callback")},_=new LiteGraph.ContextMenu([],f);for(const y of u)try{const b=this.options.getOptionLabel(String(y));_.addItem(b,y,f)}catch(b){console.error("Failed to map value:",b),_.addItem(String(y),y,f)}return}const m=l!=u?Object.values(l):l;new LiteGraph.ContextMenu(m,{scale:Math.max(1,s.ds.scale),event:o,className:"dark",callback:p(f=>{this.setValue(l!=u?m.indexOf(f):f,{e:o,node:n,canvas:s})},"callback")})}}class FileUploadWidget extends BaseWidget{static{p(this,"FileUploadWidget")}type="fileupload";drawWidget(o,n){const{width:s}=n,{y:a,height:r}=this,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_}=o;o.fillStyle=this.background_color,o.fillRect(15,a,s-30,r),o.strokeStyle=this.outline_color,o.strokeRect(15,a,s-30,r),o.fillStyle=this.text_color,o.font="11px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("Fileupload: Vue-only",s/2,a+r/2),Object.assign(o,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_})}onClick(o){}}class GalleriaWidget extends BaseWidget{static{p(this,"GalleriaWidget")}type="galleria";drawWidget(o,n){const{width:s}=n,{y:a,height:r}=this,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_}=o;o.fillStyle=this.background_color,o.fillRect(15,a,s-30,r),o.strokeStyle=this.outline_color,o.strokeRect(15,a,s-30,r),o.fillStyle=this.text_color,o.font="11px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("Galleria: Vue-only",s/2,a+r/2),Object.assign(o,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_})}onClick(o){}}class ImageCompareWidget extends BaseWidget{static{p(this,"ImageCompareWidget")}type="imagecompare";drawWidget(o,n){const{width:s}=n,{y:a,height:r}=this,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_}=o;o.fillStyle=this.background_color,o.fillRect(15,a,s-30,r),o.strokeStyle=this.outline_color,o.strokeRect(15,a,s-30,r),o.fillStyle=this.text_color,o.font="11px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("ImageCompare: Vue-only",s/2,a+r/2),Object.assign(o,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_})}onClick(o){}}function getWidgetStep(i){return i.step2||(i.step||10)*.1}p(getWidgetStep,"getWidgetStep");class KnobWidget extends BaseWidget{static{p(this,"KnobWidget")}type="knob";computeLayoutSize(){return{minHeight:60,minWidth:20,maxHeight:1e6,maxWidth:1e6}}get height(){return this.computedHeight||super.height}drawWidget(o,{width:n,showText:s=!0}){const{fillStyle:a,strokeStyle:r,textAlign:l}=o,{y:u}=this,{margin:m}=BaseWidget,{gradient_stops:f="rgb(14, 182, 201); rgb(0, 216, 72)"}=this.options,_=this.computedHeight||this.height,y=Math.min(this.computedHeight||this.height,this.width||20)/20,b={x:n/2,y:_/2+u};o.lineWidth=(Math.min(n,_)-m*y)/6;const w=(Math.min(n,_)-m*y-o.lineWidth)/2;{const N=o.createRadialGradient(b.x,b.y,w+o.lineWidth,0,0,w+o.lineWidth);N.addColorStop(0,"rgb(29, 29, 29)"),N.addColorStop(1,"rgb(116, 116, 116)"),o.fillStyle=N}o.beginPath(),o.arc(b.x,b.y,w+o.lineWidth/2,0,Math.PI*2,!1),o.fill(),o.closePath();const k={start_angle:Math.PI*.6,end_angle:Math.PI*2.4};o.beginPath();{const N=o.createRadialGradient(b.x,b.y,w+o.lineWidth,0,0,w+o.lineWidth);N.addColorStop(0,"rgb(99, 99, 99)"),N.addColorStop(1,"rgb(36, 36, 36)"),o.strokeStyle=N}o.arc(b.x,b.y,w,k.start_angle,k.end_angle,!1),o.stroke(),o.closePath();const S=this.options.max-this.options.min;let C=(this.value-this.options.min)/S;C=clamp(C,0,1),o.beginPath();const I=o.createConicGradient(k.start_angle,b.x,b.y),T=f.split(";");for(const[N,L]of T.entries())I.addColorStop(N,L.trim());o.strokeStyle=I;const E=(k.end_angle-k.start_angle)*C+k.start_angle;if(o.arc(b.x,b.y,w,k.start_angle,E,!1),o.stroke(),o.closePath(),s&&!this.computedDisabled&&(o.strokeStyle=this.outline_color,o.beginPath(),o.strokeStyle=this.outline_color,o.arc(b.x,b.y,w+o.lineWidth/2,0,Math.PI*2,!1),o.lineWidth=1,o.stroke(),o.closePath()),s){o.textAlign="center",o.fillStyle=this.text_color;const N=Number(this.value).toFixed(this.options.precision??3);o.fillText(`${this.label||this.name}
${N}`,n*.5,u+_*.5)}Object.assign(o,{textAlign:l,strokeStyle:r,fillStyle:a})}onClick(){this.current_drag_offset=0}current_drag_offset=0;onDrag(o){if(this.options.read_only)return;const{e:n}=o,s=getWidgetStep(this.options),a=this.options.max-this.options.min,r=a/10,l=a/100,u={delta_x:s,shift:r>s?r-r%s:s,delta_y:l>s?l-l%s:s},m=Math.abs(n.movementY)>Math.abs(n.movementX),f=m?-n.movementY:n.movementX,_=15;this.current_drag_offset+=f;let y=0;this.current_drag_offset>_?(y+=1,this.current_drag_offset-=_):this.current_drag_offset<-_&&(y-=1,this.current_drag_offset+=_);const b=n.shiftKey?u.shift:m?u.delta_y:s,w=y*b,k=clamp(this.value+w,this.options.min,this.options.max);k!==this.value&&this.setValue(k,o)}}class LegacyWidget extends BaseWidget{static{p(this,"LegacyWidget")}drawWidget(o,n){const s=LiteGraph.NODE_WIDGET_HEIGHT;this.draw?.(o,this.node,n.width,this.y,s,!!n.showText)}onClick(){console.warn("Custom widget wrapper onClick was just called. Handling for third party widgets is done via LGraphCanvas - the mouse callback.")}}class MarkdownWidget extends BaseWidget{static{p(this,"MarkdownWidget")}type="markdown";drawWidget(o,n){const{width:s}=n,{y:a,height:r}=this,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_}=o;o.fillStyle=this.background_color,o.fillRect(15,a,s-30,r),o.strokeStyle=this.outline_color,o.strokeRect(15,a,s-30,r),o.fillStyle=this.text_color,o.font="11px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("Markdown: Vue-only",s/2,a+r/2),Object.assign(o,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_})}onClick(o){}}class MultiSelectWidget extends BaseWidget{static{p(this,"MultiSelectWidget")}type="multiselect";drawWidget(o,n){const{width:s}=n,{y:a,height:r}=this,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_}=o;o.fillStyle=this.background_color,o.fillRect(15,a,s-30,r),o.strokeStyle=this.outline_color,o.strokeRect(15,a,s-30,r),o.fillStyle=this.text_color,o.font="11px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("MultiSelect: Vue-only",s/2,a+r/2),Object.assign(o,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_})}onClick(o){}}class NumberWidget extends BaseSteppedWidget{static{p(this,"NumberWidget")}type="number";get _displayValue(){return this.computedDisabled?"":Number(this.value).toFixed(this.options.precision!==void 0?this.options.precision:3)}canIncrement(){const{max:i}=this.options;return i==null||this.value<i}canDecrement(){const{min:i}=this.options;return i==null||this.value>i}incrementValue(i){this.setValue(this.value+getWidgetStep(this.options),i)}decrementValue(i){this.setValue(this.value-getWidgetStep(this.options),i)}setValue(i,o){let n=i;this.options.min!=null&&n<this.options.min&&(n=this.options.min),this.options.max!=null&&n>this.options.max&&(n=this.options.max),super.setValue(n,o)}onClick({e,node,canvas}){const x=e.canvasX-node.pos[0],width=this.width||node.size[0],delta=x<40?-1:x>width-40?1:0;if(delta){this.setValue(this.value+delta*getWidgetStep(this.options),{e,node,canvas});return}canvas.prompt("Value",this.value,v=>{if(/^[\d\s()*+/-]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch{}const newValue=Number(v);isNaN(newValue)||this.setValue(newValue,{e,node,canvas})},e)}onDrag({e:i,node:o,canvas:n}){const s=this.width||o.width,a=i.canvasX-o.pos[0];(a<40||a>s-40)&&a>-3&&a<s+3||this.setValue(this.value+(i.deltaX??0)*getWidgetStep(this.options),{e:i,node:o,canvas:n})}}class SelectButtonWidget extends BaseWidget{static{p(this,"SelectButtonWidget")}type="selectbutton";drawWidget(o,n){const{width:s}=n,{y:a,height:r}=this,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_}=o;o.fillStyle=this.background_color,o.fillRect(15,a,s-30,r),o.strokeStyle=this.outline_color,o.strokeRect(15,a,s-30,r),o.fillStyle=this.text_color,o.font="11px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("SelectButton: Vue-only",s/2,a+r/2),Object.assign(o,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_})}onClick(o){}}class SliderWidget extends BaseWidget{static{p(this,"SliderWidget")}type="slider";marker;drawWidget(o,{width:n,showText:s=!0}){const{fillStyle:a,strokeStyle:r,textAlign:l}=o,{height:u,y:m}=this,{margin:f}=BaseWidget;o.fillStyle=this.background_color,o.fillRect(f,m,n-f*2,u);const _=this.options.max-this.options.min;let y=(this.value-this.options.min)/_;if(y=clamp(y,0,1),o.fillStyle=this.options.slider_color??"#678",o.fillRect(f,m,y*(n-f*2),u),s&&!this.computedDisabled&&(o.strokeStyle=this.outline_color,o.strokeRect(f,m,n-f*2,u)),this.marker!=null){let b=(this.marker-this.options.min)/_;b=clamp(b,0,1),o.fillStyle=this.options.marker_color??"#AA9",o.fillRect(f+b*(n-f*2),m,2,u)}if(s){o.textAlign="center",o.fillStyle=this.text_color;const b=Number(this.value).toFixed(this.options.precision??3);o.fillText(`${this.label||this.name}  ${b}`,n*.5,m+u*.7)}Object.assign(o,{textAlign:l,strokeStyle:r,fillStyle:a})}onClick(o){if(this.options.read_only)return;const{e:n,node:s}=o,a=this.width||s.size[0],r=n.canvasX-s.pos[0],l=clamp((r-15)/(a-30),0,1),u=this.options.min+(this.options.max-this.options.min)*l;u!==this.value&&this.setValue(u,o)}onDrag(o){if(this.options.read_only)return!1;const{e:n,node:s}=o,a=this.width||s.size[0],r=n.canvasX-s.pos[0],l=clamp((r-15)/(a-30),0,1),u=this.options.min+(this.options.max-this.options.min)*l;u!==this.value&&this.setValue(u,o)}}class TextWidget extends BaseWidget{static{p(this,"TextWidget")}constructor(o,n){super(o,n),this.type??="string",this.value=o.value?.toString()??""}drawWidget(o,{width:n,showText:s=!0}){const{fillStyle:a,strokeStyle:r,textAlign:l}=o;this.drawWidgetShape(o,{width:n,showText:s}),s&&this.drawTruncatingText({ctx:o,width:n,leftPadding:0,rightPadding:0}),Object.assign(o,{textAlign:l,strokeStyle:r,fillStyle:a})}onClick({e:o,node:n,canvas:s}){s.prompt("Value",this.value,a=>{a!==null&&this.setValue(a,{e:o,node:n,canvas:s})},o,this.options?.multiline??!1)}}class TextareaWidget extends BaseWidget{static{p(this,"TextareaWidget")}type="textarea";drawWidget(o,n){const{width:s}=n,{y:a,height:r}=this,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_}=o;o.fillStyle=this.background_color,o.fillRect(15,a,s-30,r),o.strokeStyle=this.outline_color,o.strokeRect(15,a,s-30,r),o.fillStyle=this.text_color,o.font="11px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("Textarea: Vue-only",s/2,a+r/2),Object.assign(o,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_})}onClick(o){}}class TreeSelectWidget extends BaseWidget{static{p(this,"TreeSelectWidget")}type="treeselect";drawWidget(o,n){const{width:s}=n,{y:a,height:r}=this,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_}=o;o.fillStyle=this.background_color,o.fillRect(15,a,s-30,r),o.strokeStyle=this.outline_color,o.strokeRect(15,a,s-30,r),o.fillStyle=this.text_color,o.font="11px monospace",o.textAlign="center",o.textBaseline="middle",o.fillText("TreeSelect: Vue-only",s/2,a+r/2),Object.assign(o,{fillStyle:l,strokeStyle:u,textAlign:m,textBaseline:f,font:_})}onClick(o){}}function toConcreteWidget(i,o,n=!0){if(i instanceof BaseWidget)return i;const s=i;switch(s.type){case"button":return toClass(ButtonWidget,s,o);case"toggle":return toClass(BooleanWidget$1,s,o);case"slider":return toClass(SliderWidget,s,o);case"knob":return toClass(KnobWidget,s,o);case"combo":return toClass(ComboWidget,s,o);case"number":return toClass(NumberWidget,s,o);case"string":return toClass(TextWidget,s,o);case"text":return toClass(TextWidget,s,o);case"fileupload":return toClass(FileUploadWidget,s,o);case"color":return toClass(ColorWidget,s,o);case"markdown":return toClass(MarkdownWidget,s,o);case"treeselect":return toClass(TreeSelectWidget,s,o);case"multiselect":return toClass(MultiSelectWidget,s,o);case"chart":return toClass(ChartWidget,s,o);case"galleria":return toClass(GalleriaWidget,s,o);case"imagecompare":return toClass(ImageCompareWidget,s,o);case"selectbutton":return toClass(SelectButtonWidget,s,o);case"textarea":return toClass(TextareaWidget,s,o);case"asset":return toClass(AssetWidget,s,o);default:if(n)return toClass(LegacyWidget,i,o)}}p(toConcreteWidget,"toConcreteWidget");function isComboWidget(i){return i.type==="combo"}p(isComboWidget,"isComboWidget");class LGraphNode{static{p(this,"LGraphNode")}static title;static MAX_CONSOLE;static type;static category;static description;static filter;static skip_list;static resizeHandleSize=15;static resizeEdgeSize=5;static keepAllLinksOnBypass=!1;title;get titleFontStyle(){return`${LiteGraph.NODE_TEXT_SIZE}px ${LiteGraph.NODE_FONT}`}get innerFontStyle(){return`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px ${LiteGraph.NODE_FONT}`}get displayType(){return this.type}graph=null;id;type="";inputs=[];outputs=[];#e=[];#t=[];properties={};properties_info=[];flags={};widgets;changeTracker;freeWidgetSpace;locked;order=0;mode=LGraphEventMode.ALWAYS;last_serialization;serialize_widgets;color;bgcolor;boxcolor;get renderingColor(){const o=this.color||this.constructor.color||LiteGraph.NODE_DEFAULT_COLOR;return adjustColor(o,{lightness:LiteGraph.nodeLightness})}get renderingBgColor(){const o=this.bgcolor||this.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR,n={opacity:LiteGraph.nodeOpacity,lightness:LiteGraph.nodeLightness};return adjustColor(this.mode===LGraphEventMode.BYPASS?LiteGraph.NODE_DEFAULT_BYPASS_COLOR:o,n)}get renderingBoxColor(){if(this.boxcolor)return this.boxcolor;if(LiteGraph.node_box_coloured_when_on){if(this.action_triggered)return"#FFF";if(this.execute_triggered)return"#AAA"}if(LiteGraph.node_box_coloured_by_mode){const o=LiteGraph.NODE_MODES_COLORS[this.mode??LGraphEventMode.ALWAYS];if(o)return o}return LiteGraph.NODE_DEFAULT_BOXCOLOR}setColorOption(o){o==null?(this.color=void 0,this.bgcolor=void 0):(this.color=o.color,this.bgcolor=o.bgcolor)}getColorOption(){return Object.values(LGraphCanvas.node_colors).find(o=>o.color===this.color&&o.bgcolor===this.bgcolor)??null}strokeStyles;progress;exec_version;action_call;execute_triggered;action_triggered;widgets_up;widgets_start_y;lostFocusAt;gotFocusAt;badges=[];title_buttons=[];badgePosition=BadgePosition.TopLeft;_collapsed_width;console;_level;_shape;mouseOver;redraw_on_mouse;resizable;clonable;_relative_id;clip_area;ignore_remove;has_errors;removable;block_delete;selected;showAdvanced;isSubgraphNode(){return!1}#o=new Rectangle;get renderArea(){return this.#o}#n=new Rectangle;get boundingRect(){return this.#n}get boundingOffset(){const{pos:[o,n],boundingRect:[s,a]}=this;return[o-s,n-a]}_posSize=new Rectangle;_pos=this._posSize.pos;_size=this._posSize.size;get pos(){return this._pos}set pos(o){!o||o.length<2||(this._pos[0]=o[0],this._pos[1]=o[1])}get size(){return this._size}set size(o){!o||o.length<2||(this._size[0]=o[0],this._size[1]=o[1])}get renderingSize(){return this.flags.collapsed?[this._collapsed_width??0,0]:this._size}get shape(){return this._shape}set shape(o){switch(o){case"default":this._shape=void 0;break;case"box":this._shape=RenderShape.BOX;break;case"round":this._shape=RenderShape.ROUND;break;case"circle":this._shape=RenderShape.CIRCLE;break;case"card":this._shape=RenderShape.CARD;break;default:this._shape=o}}get renderingShape(){return this._shape||this.constructor.shape||LiteGraph.NODE_DEFAULT_SHAPE}get is_selected(){return this.selected}set is_selected(o){this.selected=o}get title_mode(){return this.constructor.title_mode??TitleMode.NORMAL_TITLE}#s(){if(this.has_errors)return{padding:12,lineWidth:10,color:LiteGraph.NODE_ERROR_COLOUR}}#i(){if(this.selected)return{padding:this.has_errors?20:void 0}}constructor(o,n){this.id=LiteGraph.use_uuids?LiteGraph.uuidv4():-1,this.title=o||"Unnamed",this.type=n??"",this.size=[LiteGraph.NODE_WIDTH,60],this.pos=[10,10],this.strokeStyles={error:this.#s,selected:this.#i},this.changeTracker=new LGraphNodeProperties(this)}configure(o){this.graph&&this.graph._version++;for(const n in o){if(n=="properties"){for(const s in o.properties)this.properties[s]=o.properties[s],this.onPropertyChanged?.(s,o.properties[s]);continue}o[n]!=null&&(typeof o[n]=="object"?this[n]?.configure?this[n]?.configure(o[n]):this[n]=LiteGraph.cloneObject(o[n],this[n]):this[n]=o[n])}o.title||(this.title=this.constructor.title),this.inputs??=[],this.inputs=this.inputs.map(n=>toClass(NodeInputSlot,n,this));for(const[n,s]of this.inputs.entries()){const a=this.graph&&s.link!=null?this.graph._links.get(s.link):null;this.onConnectionsChange?.(NodeSlotType.INPUT,n,!0,a,s),this.onInputAdded?.(s)}this.outputs??=[],this.outputs=this.outputs.map(n=>toClass(NodeOutputSlot,n,this));for(const[n,s]of this.outputs.entries())if(s.links){for(const a of s.links){const r=this.graph?this.graph._links.get(a):null;this.onConnectionsChange?.(NodeSlotType.OUTPUT,n,!0,r,s)}this.onOutputAdded?.(s)}if(this._internalConfigureAfterSlots?.(),this.widgets){for(const n of this.widgets){if(!n)continue;const s=this.inputs.find(a=>a.widget?.name===n.name);s?.label&&(n.label=s.label),n.options?.property&&this.properties[n.options.property]!=null&&(n.value=JSON.parse(JSON.stringify(this.properties[n.options.property])))}o.widgets_values&&this.widgets.values().filter(s=>s.serialize!==!1).filter((s,a)=>a<o.widgets_values.length).forEach((s,a)=>s.value=o.widgets_values[a])}this.pinned&&(this.resizable=!1),this.onConfigure?.(o)}serialize(){const o={id:this.id,type:this.type,pos:[this.pos[0],this.pos[1]],size:[this.size[0],this.size[1]],flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode,showAdvanced:this.showAdvanced};if(this.constructor===LGraphNode&&this.last_serialization)return{...this.last_serialization,mode:o.mode,pos:o.pos};this.inputs&&(o.inputs=this.inputs.map(s=>inputAsSerialisable(s))),this.outputs&&(o.outputs=this.outputs.map(s=>outputAsSerialisable(s))),this.title&&this.title!=this.constructor.title&&(o.title=this.title),this.properties&&(o.properties=LiteGraph.cloneObject(this.properties));const{widgets:n}=this;if(n&&this.serialize_widgets){o.widgets_values=[];for(const[s,a]of n.entries())a.serialize!==!1&&(o.widgets_values[s]=a?a.value:null)}return!o.type&&this.constructor.type&&(o.type=this.constructor.type),this.color&&(o.color=this.color),this.bgcolor&&(o.bgcolor=this.bgcolor),this.boxcolor&&(o.boxcolor=this.boxcolor),this.shape&&(o.shape=this.shape),this.onSerialize?.(o)&&console.warn("node onSerialize shouldn't return anything, data should be stored in the object pass in the first parameter"),o}clone(){if(this.type==null)return null;const o=LiteGraph.createNode(this.type);if(!o)return null;const n=LiteGraph.cloneObject(this.serialize()),{inputs:s,outputs:a}=n;if(s)for(const r of s)r.link=null;if(a)for(const{links:r}of a)r&&(r.length=0);return n.id=void 0,LiteGraph.use_uuids&&(n.id=LiteGraph.uuidv4()),o.configure(n),o}toString(){return JSON.stringify(this.serialize())}getTitle(){return this.title||this.constructor.title}setProperty(o,n){if(this.properties||={},n===this.properties[o])return;const s=this.properties[o];if(this.properties[o]=n,this.onPropertyChanged?.(o,n,s)===!1&&(this.properties[o]=s),this.widgets){for(const a of this.widgets)if(a&&a.options.property==o){a.value=n;break}}}setOutputData(o,n){const{outputs:s}=this;if(!s||o==-1||o>=s.length)return;const a=s[o];if(!a)return;if(a._data=n,!this.graph)throw new NullGraphError;const{links:r}=s[o];if(r)for(const l of r){const u=this.graph._links.get(l);u&&(u.data=n)}}setOutputDataType(o,n){const{outputs:s}=this;if(!s||o==-1||o>=s.length)return;const a=s[o];if(!a)return;if(a.type=n,!this.graph)throw new NullGraphError;const{links:r}=s[o];if(r)for(const l of r){const u=this.graph._links.get(l);u&&(u.type=n)}}getInputData(o,n){if(!this.inputs||o>=this.inputs.length||this.inputs[o].link==null)return;if(!this.graph)throw new NullGraphError;const s=this.inputs[o].link,a=this.graph._links.get(s);if(!a)return null;if(!n)return a.data;const r=this.graph.getNodeById(a.origin_id);return r&&(r.updateOutputData?r.updateOutputData(a.origin_slot):r.onExecute?.()),a.data}getInputDataType(o){if(!this.inputs||o>=this.inputs.length||this.inputs[o].link==null)return null;if(!this.graph)throw new NullGraphError;const n=this.inputs[o].link,s=this.graph._links.get(n);if(!s)return null;const a=this.graph.getNodeById(s.origin_id);if(!a)return s.type;const r=a.outputs[s.origin_slot];return r?r.type:null}getInputDataByName(o,n){const s=this.findInputSlot(o);return s==-1?null:this.getInputData(s,n)}isInputConnected(o){return this.inputs?o<this.inputs.length&&this.inputs[o].link!=null:!1}getInputInfo(o){return!this.inputs||!(o<this.inputs.length)?null:this.inputs[o]}getInputLink(o){if(!this.inputs)return null;if(o<this.inputs.length){if(!this.graph)throw new NullGraphError;const n=this.inputs[o];if(n.link!=null)return this.graph._links.get(n.link)??null}return null}getInputNode(o){if(!this.inputs||o>=this.inputs.length)return null;const n=this.inputs[o];if(!n||n.link===null)return null;if(!this.graph)throw new NullGraphError;const s=this.graph._links.get(n.link);return s?this.graph.getNodeById(s.origin_id):null}getInputOrProperty(o){const{inputs:n}=this;if(!n?.length)return this.properties?this.properties[o]:null;if(!this.graph)throw new NullGraphError;for(const s of n)if(o==s.name&&s.link!=null){const a=this.graph._links.get(s.link);if(a)return a.data}return this.properties[o]}getOutputData(o){return!this.outputs||o>=this.outputs.length?null:this.outputs[o]._data}getOutputInfo(o){return!this.outputs||!(o<this.outputs.length)?null:this.outputs[o]}isOutputConnected(o){return this.outputs?o<this.outputs.length&&Number(this.outputs[o].links?.length)>0:!1}isAnyOutputConnected(){const{outputs:o}=this;if(!o)return!1;for(const n of o)if(n.links?.length)return!0;return!1}getOutputNodes(o){const{outputs:n}=this;if(!n||n.length==0||o>=n.length)return null;const{links:s}=n[o];if(!s||s.length==0)return null;if(!this.graph)throw new NullGraphError;const a=[];for(const r of s){const l=this.graph._links.get(r);if(l){const u=this.graph.getNodeById(l.target_id);u&&a.push(u)}}return a}addOnTriggerInput(){const o=this.findInputSlot("onTrigger");return o==-1?(this.addInput("onTrigger",LiteGraph.EVENT,{nameLocked:!0}),this.findInputSlot("onTrigger")):o}addOnExecutedOutput(){const o=this.findOutputSlot("onExecuted");return o==-1?(this.addOutput("onExecuted",LiteGraph.ACTION,{nameLocked:!0}),this.findOutputSlot("onExecuted")):o}onAfterExecuteNode(o,n){const s=this.findOutputSlot("onExecuted");s!=-1&&this.triggerSlot(s,o,null,n)}changeMode(o){switch(o){case LGraphEventMode.ON_EVENT:break;case LGraphEventMode.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LGraphEventMode.NEVER:break;case LGraphEventMode.ALWAYS:break;case LiteGraph.ON_REQUEST:break;default:return!1}return this.mode=o,!0}doExecute(o,n){if(n=n||{},this.onExecute){if(n.action_call||=`${this.id}_exec_${Math.floor(Math.random()*9999)}`,!this.graph)throw new NullGraphError;this.graph.nodes_executing[this.id]=!0,this.onExecute(o,n),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,n?.action_call&&(this.action_call=n.action_call,this.graph.nodes_executedAction[this.id]=n.action_call)}this.execute_triggered=2,this.onAfterExecuteNode?.(o,n)}actionDo(o,n,s){if(s=s||{},this.onAction){if(s.action_call||=`${this.id}_${o||"action"}_${Math.floor(Math.random()*9999)}`,!this.graph)throw new NullGraphError;this.graph.nodes_actioning[this.id]=o||"actioning",this.onAction(o,n,s),this.graph.nodes_actioning[this.id]=!1,s?.action_call&&(this.action_call=s.action_call,this.graph.nodes_executedAction[this.id]=s.action_call)}this.action_triggered=2,this.onAfterExecuteNode?.(n,s)}trigger(o,n,s){const{outputs:a}=this;if(!(!a||!a.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(const[r,l]of a.entries())!l||l.type!==LiteGraph.EVENT||o&&l.name!=o||this.triggerSlot(r,n,null,s)}}triggerSlot(o,n,s,a){if(a=a||{},!this.outputs)return;if(o==null){console.error("slot must be a number");return}typeof o!="number"&&console.warn("slot must be a number, use node.trigger('name') if you want to use a string");const r=this.outputs[o];if(!r)return;const l=r.links;if(!(!l||!l.length)){if(!this.graph)throw new NullGraphError;this.graph._last_trigger_time=LiteGraph.getTime();for(const u of l){if(s!=null&&s!=u)continue;const m=this.graph._links.get(u);if(!m)continue;m._last_time=LiteGraph.getTime();const f=this.graph.getNodeById(m.target_id);if(f){if(f.mode===LGraphEventMode.ON_TRIGGER)a.action_call||(a.action_call=`${this.id}_trigg_${Math.floor(Math.random()*9999)}`),f.doExecute?.(n,a);else if(f.onAction){a.action_call||(a.action_call=`${this.id}_act_${Math.floor(Math.random()*9999)}`);const _=f.inputs[m.target_slot];f.actionDo(_.name,n,a)}}}}}clearTriggeredSlot(o,n){if(!this.outputs)return;const s=this.outputs[o];if(!s)return;const a=s.links;if(!(!a||!a.length)){if(!this.graph)throw new NullGraphError;for(const r of a){if(n!=null&&n!=r)continue;const l=this.graph._links.get(r);l&&(l._last_time=0)}}}setSize(o){this.size=o,this.onResize?.(this.size)}expandToFitContent(){const o=this.computeSize();this.setSize([Math.max(this.size[0],o[0]),Math.max(this.size[1],o[1])])}addProperty(o,n,s,a){const r={name:o,type:s,default_value:n};return a&&Object.assign(r,a),this.properties_info||=[],this.properties_info.push(r),this.properties||={},this.properties[o]=n,r}addOutput(o,n,s){const a=Object.assign(new NodeOutputSlot({name:o,type:n,links:null},this),s);return this.outputs||=[],this.outputs.push(a),this.onOutputAdded?.(a),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,n,!0),this.expandToFitContent(),this.setDirtyCanvas(!0,!0),a}removeOutput(o){this.graph&&this.disconnectOutput(o);const{outputs:n}=this;n.splice(o,1);for(let s=o;s<n.length;++s){const a=n[s];if(!(!a||!a.links)&&this.graph)for(const r of a.links){const l=this.graph._links.get(r);l&&l.origin_slot--}}this.onOutputRemoved?.(o),this.setDirtyCanvas(!0,!0)}addInput(o,n,s){n||=0;const a=Object.assign(new NodeInputSlot({name:o,type:n,link:null},this),s);return this.inputs||=[],this.inputs.push(a),this.expandToFitContent(),this.onInputAdded?.(a),LiteGraph.registerNodeAndSlotType(this,n),this.setDirtyCanvas(!0,!0),a}removeInput(o){this.graph&&this.disconnectInput(o,!0);const{inputs:n}=this,s=n.splice(o,1);for(let a=o;a<n.length;++a){const r=n[a];if(r?.link&&this.graph){const l=this.graph._links.get(r.link);l&&l.target_slot--}}this.onInputRemoved?.(o,s[0]),this.setDirtyCanvas(!0,!0)}spliceInputs(o,n=-1,...s){if(n<0)return this.inputs.splice(o);const a=this.inputs.splice(o,n,...s);return this.inputs.slice(o).forEach((r,l)=>{const u=r.link&&this.graph?.links?.get(r.link);u&&(u.target_slot=o+l)}),a}computeSize(o){const n=this.constructor.size;if(n)return[n[0],n[1]];const{inputs:s,outputs:a,widgets:r}=this;let l=Math.max(s?s.filter(A=>!isWidgetInputSlot(A)).length:1,a?a.length:1);const u=o??[0,0];l=Math.max(l,1);const m=LiteGraph.NODE_TEXT_SIZE,f=LiteGraph.NODE_TITLE_HEIGHT,_=f*.33,y=f+L(this.title,this.titleFontStyle)+_;let b=0,w=0,k=0;if(s)for(const A of s){const D=A.label||A.localized_name||A.name||"",O=L(D,this.innerFontStyle);if(isWidgetInputSlot(A)){const M=this.getWidgetFromSlot(A);if(M&&!this.isWidgetVisible(M))continue;O>w&&(w=O)}else O>b&&(b=O)}if(a)for(const A of a){const D=A.label||A.localized_name||A.name||"",O=L(D,this.innerFontStyle);k<O&&(k=O)}const S=LiteGraph.NODE_WIDTH*(r?.length?1.5:1),C=b&&k?5:0,I=b+k+2*LiteGraph.NODE_SLOT_HEIGHT+C,T=BaseWidget.margin+BaseWidget.arrowMargin+BaseWidget.arrowWidth,E=BaseWidget.minValueWidth+2*T;w&&(w+=E),u[0]=Math.max(I,w,y,S),u[1]=(this.constructor.slot_start_y||0)+l*LiteGraph.NODE_SLOT_HEIGHT;let N=0;if(r?.length){for(const A of r){if(!this.isWidgetVisible(A))continue;let D=0;if(A.computeSize)D+=A.computeSize(u[0])[1];else if(A.computeLayoutSize){const{minHeight:O,minWidth:M}=A.computeLayoutSize(this),P=M+E;P>u[0]&&(u[0]=P),D+=O}else D+=LiteGraph.NODE_WIDGET_HEIGHT;N+=D+4}N+=8}this.widgets_up?u[1]=Math.max(u[1],N):this.widgets_start_y!=null?u[1]=Math.max(u[1],N+this.widgets_start_y):u[1]+=N;function L(A,D){return LGraphCanvas._measureText?.(A,D)??m*(A?.length??0)*.6}return p(L,"compute_text_size"),this.constructor.min_height&&u[1]<this.constructor.min_height&&(u[1]=this.constructor.min_height),u[1]+=6,u}inResizeCorner(o,n){const s=this.outputs?this.outputs.length:1,a=(this.constructor.slot_start_y||0)+s*LiteGraph.NODE_SLOT_HEIGHT;return isInRectangle(o,n,this.pos[0]+this.size[0]-15,this.pos[1]+Math.max(this.size[1]-15,a),20,20)}findResizeDirection(o,n){if(this.resizable===!1)return;const{boundingRect:s}=this;if(s.containsXy(o,n))return s.findContainingCorner(o,n,LGraphNode.resizeHandleSize)}getPropertyInfo(o){let n=null;const{properties_info:s}=this;if(s){for(const a of s)if(a.name==o){n=a;break}}return this.constructor[`@${o}`]&&(n=this.constructor[`@${o}`]),this.constructor.widgets_info?.[o]&&(n=this.constructor.widgets_info[o]),!n&&this.onGetPropertyInfo&&(n=this.onGetPropertyInfo(o)),n||={},n.type||=typeof this.properties[o],n.widget=="combo"&&(n.type="enum"),n}addWidget(o,n,s,a,r){this.widgets||=[],!r&&a&&typeof a=="object"&&(r=a,a=null),r||={},typeof r=="string"&&(r={property:r}),a&&typeof a=="string"&&(r.property=a,a=null);const l={type:o.toLowerCase(),name:n,value:s,callback:typeof a!="function"?void 0:a,options:r,y:0};if(l.options.y!==void 0&&(l.y=l.options.y),!a&&!l.options.callback&&!l.options.property&&console.warn("LiteGraph addWidget(...) without a callback or property assigned"),o=="combo"&&!l.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";const u=this.addCustomWidget(l);return this.expandToFitContent(),u}addCustomWidget(o){this.widgets||=[];const n=toConcreteWidget(o,this,!1)??o;return this.widgets.push(n),n}addTitleButton(o){this.title_buttons||=[];const n=new LGraphButton(o);return this.title_buttons.push(n),n}onTitleButtonClick(o,n){n.dispatch("litegraph:node-title-button-clicked",{node:this,button:o})}removeWidgetByName(o){const n=this.widgets?.find(s=>s.name===o);n&&this.removeWidget(n)}removeWidget(o){if(!this.widgets)throw new Error("removeWidget called on node without widgets");const n=this.widgets.indexOf(o);if(n===-1)throw new Error("Widget not found on this node");if(this.inputs)for(const s of this.inputs)s._widget===o&&(s._widget=void 0,s.widget=void 0);o.onRemove?.(),this.widgets.splice(n,1)}ensureWidgetRemoved(o){try{this.removeWidget(o)}catch(n){console.error("Failed to remove widget",n)}}move(o,n){this.pinned||LiteGraph.vueNodesMode||(this.pos[0]+=o,this.pos[1]+=n)}measure(o,n){const s=this.title_mode,r=s!=TitleMode.TRANSPARENT_TITLE&&s!=TitleMode.NO_TITLE?LiteGraph.NODE_TITLE_HEIGHT:0;o[0]=this.pos[0],o[1]=this.pos[1]+-r,this.flags?.collapsed?(n.font=this.innerFontStyle,this._collapsed_width=Math.min(this.size[0],n.measureText(this.getTitle()??"").width+LiteGraph.NODE_TITLE_HEIGHT*2),o[2]=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH,o[3]=LiteGraph.NODE_TITLE_HEIGHT):(o[2]=this.size[0],o[3]=this.size[1]+r)}getBounding(o,n){o||=[0,0,0,0];const s=n?this.renderArea:this.boundingRect;return o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3],o}updateArea(o){const n=this.#n;this.measure(n,o),this.onBounding?.(n);const s=this.#o;s.set(n),s[0]-=4,s[1]-=4,s[2]+=10,s[3]+=9}isPointInside(o,n){return isInRect(o,n,this.boundingRect)}isPointInCollapse(o,n){const s=LiteGraph.NODE_TITLE_HEIGHT;return isInRectangle(o,n,this.pos[0],this.pos[1]-s,s,s)}getInputOnPos(o){return getNodeInputOnPos(this,o[0],o[1])?.input}getOutputOnPos(o){return getNodeOutputOnPos(this,o[0],o[1])?.output}getSlotOnPos(o){if(isPointInRect(o,this.boundingRect))return this.getInputOnPos(o)??this.getOutputOnPos(o)}getSlotInPosition(o,n){const{inputs:s,outputs:a}=this;if(s)for(const[r,l]of s.entries()){const u=this.getInputPos(r);if(isInRectangle(o,n,u[0]-10,u[1]-10,20,20))return{input:l,slot:r,link_pos:u}}if(a)for(const[r,l]of a.entries()){const u=this.getOutputPos(r);if(isInRectangle(o,n,u[0]-10,u[1]-10,20,20))return{output:l,slot:r,link_pos:u}}return null}getWidgetOnPos(o,n,s=!1){const{widgets:a,pos:r,size:l}=this;if(!a?.length)return;const u=o-r[0],m=n-r[1],f=l[0];for(const _ of a){if(_.computedDisabled&&!s||!this.isWidgetVisible(_))continue;const y=_.computedHeight??_.computeSize?.(f)[1]??LiteGraph.NODE_WIDGET_HEIGHT,b=_,w=b.margin??-2,k=b.margin??2,S=b.margin??6,C=_.width||f;if(_.last_y!==void 0&&isInRectangle(u,m,S,_.last_y+w,C-2*S,y-w-k))return _}}findInputSlot(o,n=!1){const{inputs:s}=this;if(!s)return-1;for(const[a,r]of s.entries())if(o==r.name)return n?r:a;return-1}findOutputSlot(o,n=!1){const{outputs:s}=this;if(!s)return-1;for(const[a,r]of s.entries())if(o==r.name)return n?r:a;return-1}findInputSlotFree(o){return this.#c(this.inputs,o)}findOutputSlotFree(o){return this.#c(this.outputs,o)}#c(o,n){const a=Object.assign({returnObj:!1,typesNotAccepted:[]},n||{}),r=o?.length;if(!(r>0))return-1;for(let l=0;l<r;++l){const u=o[l];if(!(!u||u.link||u.links?.length)&&!a.typesNotAccepted?.includes?.(u.type))return a.returnObj?u:l}return-1}findInputSlotByType(o,n,s,a){return this.#l(this.inputs,o,n,s,a)}findOutputSlotByType(o,n,s,a){return this.#l(this.outputs,o,n,s,a)}findSlotByType(o,n,s,a,r){return o?this.#l(this.inputs,n,s,a,r):this.#l(this.outputs,n,s,a,r)}#l(o,n,s,a,r){const l=o?.length;if(!l)return-1;(n==""||n=="*")&&(n=0);const u=String(n).toLowerCase().split(",");let m=null;for(let f=0;f<l;++f){const _=o[f],y=_.type=="0"||_.type=="*"?["0"]:String(_.type).toLowerCase().split(",");for(const b of u){const w=b=="_event_"?LiteGraph.EVENT:b;for(const k of y){const S=k=="_event_"?LiteGraph.EVENT:k;if(w==S||w==="*"||S==="*"){if(a&&(_.links?.length||_.link!=null)){m??=s?_:f;continue}return s?_:f}}}}return r?-1:m??-1}findConnectByTypeSlot(o,n,s,a){a&&typeof a=="object"&&("firstFreeIfInputGeneralInCase"in a&&(a.wildcardToTyped=!!a.firstFreeIfInputGeneralInCase),"firstFreeIfOutputGeneralInCase"in a&&(a.wildcardToTyped=!!a.firstFreeIfOutputGeneralInCase),"generalTypeInCase"in a&&(a.typedToWildcard=!!a.generalTypeInCase));const l=Object.assign({createEventInCase:!0,wildcardToTyped:!0,typedToWildcard:!0},a);if(!this.graph)throw new NullGraphError;if(n&&typeof n=="number"){const m=this.graph.getNodeById(n);if(!m)return;n=m}const u=n.findSlotByType(o,s,!1,!0);if(u>=0&&u!==null)return u;if(l.createEventInCase&&s==LiteGraph.EVENT){if(o)return-1;if(LiteGraph.do_add_triggers_slots)return n.addOnExecutedOutput()}if(l.typedToWildcard){const m=n.findSlotByType(o,0,!1,!0,!0);if(m>=0)return m}if(l.wildcardToTyped&&(s==0||s=="*"||s=="")){const m={typesNotAccepted:[LiteGraph.EVENT]},f=o?n.findInputSlotFree(m):n.findOutputSlotFree(m);if(f>=0)return f}}findOutputByType(o){return findFreeSlotOfType(this.outputs,o,n=>!n.links?.length)}findInputByType(o){return findFreeSlotOfType(this.inputs,o,n=>n.link==null||!!this.graph?.getLink(n.link)?._dragging)}connectByType(o,n,s,a){const r=this.findConnectByTypeSlot(!0,n,s,a);return r!==void 0?this.connect(o,n,r,a?.afterRerouteId):null}connectByTypeOutput(o,n,s,a){typeof a=="object"&&("firstFreeIfInputGeneralInCase"in a&&(a.wildcardToTyped=!!a.firstFreeIfInputGeneralInCase),"generalTypeInCase"in a&&(a.typedToWildcard=!!a.generalTypeInCase));const r=this.findConnectByTypeSlot(!1,n,s,a);return r!==void 0?n.connect(r,this,o,a?.afterRerouteId):(console.error("[connectByType]: no way to connect type:",s,"to node:",n),null)}canConnectTo(o,n,s){return this.id!==o.id&&LiteGraph.isValidConnection(s.type,n.type)}connect(o,n,s,a){let r;const{graph:l,outputs:u}=this;if(!l)return console.error("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(typeof o=="string"){if(o=this.findOutputSlot(o),o==-1)return LiteGraph.debug&&console.error(`Connect: Error, no slot of name ${o}`),null}else if(!u||o>=u.length)return LiteGraph.debug&&console.error("Connect: Error, slot number not found"),null;if(n&&typeof n=="number"){const y=l.getNodeById(n);if(!y)throw"target node is null";n=y}if(!n)throw"target node is null";if(n==this)return null;if(typeof s=="string"){if(r=n.findInputSlot(s),r==-1)return LiteGraph.debug&&console.error(`Connect: Error, no slot of name ${r}`),null}else if(s===LiteGraph.EVENT)if(LiteGraph.do_add_triggers_slots)n.changeMode(LGraphEventMode.ON_TRIGGER),r=n.findInputSlot("onTrigger");else return null;else typeof s=="number"?r=s:r=0;if(n.onBeforeConnectInput){const y=n.onBeforeConnectInput(r,s);r=typeof y=="number"?y:null}if(r===null||!n.inputs||r>=n.inputs.length)return LiteGraph.debug&&console.error("Connect: Error, slot number not found"),null;const m=n.inputs[r],f=u[o];return f?(f.links?.length&&f.type===LiteGraph.EVENT&&!LiteGraph.allow_multi_output_for_events&&(l.beforeChange(),this.disconnectOutput(o,!1,{doProcessChange:!1})),this.connectSlots(f,n,m,a)??null):null}connectSlots(o,n,s,a){const{graph:r}=this;if(!r)throw new NullGraphError;const l=useLayoutMutations(),u=this.outputs.indexOf(o);if(u===-1){console.warn("connectSlots: output not found");return}const m=n.inputs.indexOf(s);if(m===-1){console.warn("connectSlots: input not found");return}if(!LiteGraph.isValidConnection(o.type,s.type))return this.setDirtyCanvas(!1,!0),null;if(n.onConnectInput?.(m,o.type,o,this,u)===!1||this.onConnectOutput?.(u,s.type,s,n,m)===!1)return null;n.inputs[m]?.link!=null&&(r.beforeChange(),n.disconnectInput(m,!0));const f=new LLink(++r.state.lastLinkId,s.type||o.type,this.id,u,n.id,m,a);r._links.set(f.id,f),l.setSource(LayoutSource.Canvas),l.createLink(f.id,this.id,u,n.id,m),o.links??=[],o.links.push(f.id);const _=n.inputs[m];_.link=f.id,_.widget&&r.trigger("node:slot-links:changed",{nodeId:n.id,slotType:NodeSlotType.INPUT,slotIndex:m,connected:!0,linkId:f.id});const y=LLink.getReroutes(r,f);for(const w of y)w.linkIds.add(f.id),w.floating&&(w.floating=void 0),w._dragging=void 0;const b=y.at(-1);if(b)for(const w of b.floatingLinkIds){const k=r.floatingLinks.get(w);k?.parentId===b.id&&r.removeFloatingLink(k)}return r._version++,this.onConnectionsChange?.(NodeSlotType.OUTPUT,u,!0,f,o),n.onConnectionsChange?.(NodeSlotType.INPUT,m,!0,f,s),this.setDirtyCanvas(!1,!0),r.afterChange(),f}connectFloatingReroute(o,n,s){const{graph:a,id:r}=this;if(!a)throw new NullGraphError;const l=this.inputs.indexOf(n),u=this.outputs.indexOf(n);if(l===-1&&u===-1)throw new Error("Invalid slot");const m=u===-1?"input":"output",f=a.setReroute({pos:o,parentId:s,linkIds:[],floating:{slotType:m}}),_=a.getReroute(s),y=_?.floating?.slotType==="output";if(s==null||!y){const w=new LLink(-1,n.type,u===-1?-1:r,u,l===-1?-1:r,l);return w.parentId=f.id,a.addFloatingLink(w),f}if(!_)throw new Error("[connectFloatingReroute] Parent reroute not found");const b=_.getFloatingLinks("output")?.[0];if(!b)throw new Error("[connectFloatingReroute] Floating link not found");return f.floatingLinkIds.add(b.id),b.parentId=f.id,_.floating=void 0,f}disconnectOutput(o,n){if(typeof o=="string"){if(o=this.findOutputSlot(o),o==-1)return LiteGraph.debug&&console.error(`Connect: Error, no slot of name ${o}`),!1}else if(!this.outputs||o>=this.outputs.length)return LiteGraph.debug&&console.error("Connect: Error, slot number not found"),!1;const s=this.outputs[o];if(!s)return!1;if(s._floatingLinks)for(const l of s._floatingLinks)l.hasOrigin(this.id,o)&&this.graph?.removeFloatingLink(l);if(!s.links||s.links.length==0)return!1;const{links:a}=s,r=this.graph;if(!r)throw new NullGraphError;if(n){const l=typeof n=="number"?r.getNodeById(n):n;if(!l)throw"Target Node not found";for(const[u,m]of a.entries()){const f=r._links.get(m);if(f?.target_id!=l.id)continue;a.splice(u,1);const _=l.inputs[f.target_slot];_.link=null,_.widget&&r.trigger("node:slot-links:changed",{nodeId:l.id,slotType:NodeSlotType.INPUT,slotIndex:f.target_slot,connected:!1,linkId:f.id}),f.disconnect(r,"input"),r._version++,l.onConnectionsChange?.(NodeSlotType.INPUT,f.target_slot,!1,f,_),this.onConnectionsChange?.(NodeSlotType.OUTPUT,o,!1,f,s);break}}else{for(const l of a){const u=r._links.get(l);if(!u)continue;if(u.target_id===SUBGRAPH_OUTPUT_ID&&r instanceof Subgraph){const f=r.outputNode.slots[u.target_slot];f?f.linkIds.length=0:console.error("Missing subgraphOutput slot when disconnecting link")}const m=r.getNodeById(u.target_id);if(r._version++,m){const f=m.inputs[u.target_slot];f.link=null,f.widget&&r.trigger("node:slot-links:changed",{nodeId:m.id,slotType:NodeSlotType.INPUT,slotIndex:u.target_slot,connected:!1,linkId:u.id}),m.onConnectionsChange?.(NodeSlotType.INPUT,u.target_slot,!1,u,f)}u.disconnect(r,"input"),this.onConnectionsChange?.(NodeSlotType.OUTPUT,o,!1,u,s)}s.links=null}return this.setDirtyCanvas(!1,!0),!0}disconnectInput(o,n){if(typeof o=="string"){if(o=this.findInputSlot(o),o==-1)return LiteGraph.debug&&console.error(`Connect: Error, no slot of name ${o}`),!1}else if(!this.inputs||o>=this.inputs.length)return LiteGraph.debug&&console.error("Connect: Error, slot number not found"),!1;const s=this.inputs[o];if(!s)return console.error("disconnectInput: input not found",o,this.inputs),!1;const{graph:a}=this;if(!a)throw new NullGraphError;if(s._floatingLinks?.size)for(const l of s._floatingLinks)a.removeFloatingLink(l);const r=this.inputs[o].link;if(r!=null){this.inputs[o].link=null,s.widget&&a.trigger("node:slot-links:changed",{nodeId:this.id,slotType:NodeSlotType.INPUT,slotIndex:o,connected:!1,linkId:r});const l=a._links.get(r);if(l){if(l.origin_id===-10&&"inputNode"in a)return a.inputNode._disconnectNodeInput(this,s,l),!0;const u=a.getNodeById(l.origin_id);if(!u)return console.error("disconnectInput: output not found",l.origin_slot),!1;const m=u.outputs[l.origin_slot];if(!m?.links?.length)return!1;let f=0;for(const _=m.links.length;f<_;f++)if(m.links[f]==r){m.links.splice(f,1);break}l.disconnect(a,n?"output":void 0),a&&a._version++,this.onConnectionsChange?.(NodeSlotType.INPUT,o,!1,l,s),u.onConnectionsChange?.(NodeSlotType.OUTPUT,f,!1,l,m)}}return this.setDirtyCanvas(!1,!0),!0}getConnectionPos(o,n,s){s||=[0,0];const{pos:[a,r],inputs:l,outputs:u}=this;if(this.flags.collapsed){const b=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return s[0]=o?a:a+b,s[1]=r-LiteGraph.NODE_TITLE_HEIGHT*.5,s}if(o&&n==-1)return s[0]=a+LiteGraph.NODE_TITLE_HEIGHT*.5,s[1]=r+LiteGraph.NODE_TITLE_HEIGHT*.5,s;const m=l?.[n]?.pos,f=u?.[n]?.pos;if(o&&m)return s[0]=a+m[0],s[1]=r+m[1],s;if(!o&&f)return s[0]=a+f[0],s[1]=r+f[1],s;const _=LiteGraph.NODE_SLOT_HEIGHT*.5,y=o?this.#f.indexOf(this.inputs[n]):this.#a.indexOf(this.outputs[n]);return s[0]=o?a+_:a+this.size[0]+1-_,s[1]=r+(y+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),s}get#f(){return this.inputs.filter(o=>!o.pos&&!(this.widgets?.length&&isWidgetInputSlot(o)))}get#a(){return this.outputs.filter(o=>!o.pos)}#r(){return{nodeX:this.pos[0],nodeY:this.pos[1],nodeWidth:this.size[0],nodeHeight:this.size[1],collapsed:this.flags.collapsed??!1,collapsedWidth:this._collapsed_width,slotStartY:this.constructor.slot_start_y,inputs:this.inputs,outputs:this.outputs,widgets:this.widgets}}getInputPos(o){return calculateInputSlotPos(this.#r(),o)}getInputSlotPos(o){return calculateInputSlotPosFromSlot(this.#r(),o)}getOutputPos(o){return calculateOutputSlotPos(this.#r(),o)}getSlotPosition(o,n){return getSlotPosition(this,o,n)}snapToGrid(o){return this.pinned?!1:snapPoint(this.pos,o)}alignToGrid(){this.snapToGrid(LiteGraph.CANVAS_GRID_SIZE)}trace(o){this.console||=[],this.console.push(o),this.console.length>LGraphNode.MAX_CONSOLE&&this.console.shift()}setDirtyCanvas(o,n){this.graph?.canvasAction(s=>s.setDirty(o,n))}loadImage(o){const n=new Image;n.src=LiteGraph.node_images_path+o,n.ready=!1;const s=p(()=>this.setDirtyCanvas(!0),"dirty");return n.addEventListener("load",function(){this.ready=!0,s()}),n}captureInput(o){if(warnDeprecated("[DEPRECATED] captureInput will be removed in a future version. Please use LGraphCanvas.pointer (CanvasPointer) instead."),!this.graph||!this.graph.list_of_graphcanvas)return;const n=this.graph.list_of_graphcanvas;for(const s of n)!o&&s.node_capturing_input!=this||(s.node_capturing_input=o?this:null)}get collapsed(){return!!this.flags.collapsed}get collapsible(){return!this.pinned&&this.constructor.collapsable!==!1}collapse(o){if(!(!this.collapsible&&!o)){if(!this.graph)throw new NullGraphError;this.graph._version++,this.flags.collapsed=!this.flags.collapsed,this.setDirtyCanvas(!0,!0)}}toggleAdvanced(){if(this.widgets?.some(o=>o.advanced)){if(!this.graph)throw new NullGraphError;this.graph._version++,this.showAdvanced=!this.showAdvanced,this.expandToFitContent(),this.setDirtyCanvas(!0,!0)}}get pinned(){return!!this.flags.pinned}pin(o){if(!this.graph)throw new NullGraphError;this.graph._version++,this.flags.pinned=o??!this.flags.pinned,this.resizable=!this.pinned,this.pinned||(this.flags.pinned=void 0)}unpin(){this.pin(!1)}localToScreen(o,n,s){return[(o+this.pos[0])*s.scale+s.offset[0],(n+this.pos[1])*s.scale+s.offset[1]]}get width(){return this.collapsed?this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH:this.size[0]}get height(){return LiteGraph.NODE_TITLE_HEIGHT+this.bodyHeight}get bodyHeight(){return this.collapsed?0:this.size[1]}drawBadges(o,{gap:n=2}={}){const s=this.badges.map(u=>u instanceof LGraphBadge?u:u());let r=this.badgePosition===BadgePosition.TopLeft?0:this.width-s.reduce((u,m)=>u+m.getWidth(o)+n,0);const l=-(LiteGraph.NODE_TITLE_HEIGHT+n);for(const u of s)u.draw(o,r,l-u.height),r+=u.getWidth(o)+n}drawTitleBarBackground(o,{scale:n,title_height:s=LiteGraph.NODE_TITLE_HEIGHT,low_quality:a=!1}){const r=this.renderingColor,l=this.renderingShape,u=this.renderingSize;if(this.onDrawTitleBar){this.onDrawTitleBar(o,s,u,n,r);return}this.title_mode!==TitleMode.TRANSPARENT_TITLE&&(this.collapsed&&(o.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),o.fillStyle=this.constructor.title_color||r,o.beginPath(),l==RenderShape.BOX||a?o.rect(0,-s,u[0],s):(l==RenderShape.ROUND||l==RenderShape.CARD)&&o.roundRect(0,-s,u[0],s,this.collapsed?[LiteGraph.ROUND_RADIUS]:[LiteGraph.ROUND_RADIUS,LiteGraph.ROUND_RADIUS,0,0]),o.fill(),o.shadowColor="transparent")}drawTitleBox(o,{scale:n,low_quality:s=!1,title_height:a=LiteGraph.NODE_TITLE_HEIGHT,box_size:r=10}){const l=this.renderingSize,u=this.renderingShape;if(this.onDrawTitleBox){this.onDrawTitleBox(o,a,l,n);return}[RenderShape.ROUND,RenderShape.CIRCLE,RenderShape.CARD].includes(u)?(s&&(o.fillStyle="black",o.beginPath(),o.arc(a*.5,a*-.5,r*.5+1,0,Math.PI*2),o.fill()),o.fillStyle=this.renderingBoxColor,s?o.fillRect(a*.5-r*.5,a*-.5-r*.5,r,r):(o.beginPath(),o.arc(a*.5,a*-.5,r*.5,0,Math.PI*2),o.fill())):(s&&(o.fillStyle="black",o.fillRect((a-r)*.5-1,(a+r)*-.5-1,r+2,r+2)),o.fillStyle=this.renderingBoxColor,o.fillRect((a-r)*.5,(a+r)*-.5,r,r))}drawTitleText(o,{scale:n,default_title_color:s,low_quality:a=!1,title_height:r=LiteGraph.NODE_TITLE_HEIGHT}){const l=this.renderingSize,u=this.selected;if(this.onDrawTitleText){this.onDrawTitleText(o,r,l,n,this.titleFontStyle,u);return}if(a)return;o.font=this.titleFontStyle;const m=this.getTitle()??`âŒ ${this.type}`,f=String(m)+(this.pinned?"ðŸ“Œ":"");if(f){u?o.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:o.fillStyle=this.constructor.title_text_color||s;let _=l[0]-r*2;if(this.title_buttons?.length>0){let b=0;const w=o.font;for(const k of this.title_buttons)k.visible&&(b+=k.getWidth(o)+2);o.font=w,b>0&&(b-=20,_-=b)}let y=f;this.collapsed?y=f.substr(0,20):_>0&&(y=truncateText(o,f,_)),o.textAlign="left",o.fillText(y,r,LiteGraph.NODE_TITLE_TEXT_Y-r)}}connectInputToOutput(){const{inputs:o,outputs:n,graph:s}=this;if(!o||!n)return;if(!s)throw new NullGraphError;const{_links:a}=s;let r=!1;for(const[u,m]of o.entries()){if(m.link==null)continue;const f=n[u];if(!f||!LiteGraph.isValidConnection(m.type,f.type))continue;const _=a.get(m.link);if(!_)continue;const y=s.getNodeById(_?.origin_id);y&&l(f,y,_,s)}if(!(this.flags.keepAllLinksOnBypass??LGraphNode.keepAllLinksOnBypass))return r;for(const u of o){if(u.link==null)continue;const m=a.get(u.link);if(!m)continue;const f=s.getNodeById(m?.origin_id);if(f){for(const _ of n)if(LiteGraph.isValidConnection(u.type,_.type)){l(_,f,m,s);break}}}return r;function l(u,m,f,_){const y=u.links?.map(b=>a.get(b)).filter(b=>!!b);if(y?.length)for(const b of y){const w=_.getNodeById(b.target_id);if(!w)continue;const k=m.connect(f.origin_slot,w,b.target_slot,f.parentId);r||=!!k}}}isWidgetVisible(o){return!(this.collapsed||o.hidden||o.advanced&&!this.showAdvanced)}updateComputedDisabled(){if(this.widgets)for(const o of this.widgets)o.computedDisabled=o.disabled||this.getSlotFromWidget(o)?.link!=null}drawWidgets(o,{lowQuality:n=!1,editorAlpha:s=1}){if(!this.widgets)return;const a=this.size[0],{widgets:r}=this,l=LiteGraph.NODE_WIDGET_HEIGHT,u=!n;o.save(),o.globalAlpha=s,this.updateComputedDisabled();for(const m of r){if(!this.isWidgetVisible(m))continue;const{y:f}=m,_=m.advanced?LiteGraph.WIDGET_ADVANCED_OUTLINE_COLOR:LiteGraph.WIDGET_OUTLINE_COLOR;m.last_y=f,o.strokeStyle=_,o.fillStyle="#222",o.textAlign="left",m.computedDisabled&&(o.globalAlpha*=.5);const y=m.width||a;typeof m.draw=="function"?m.draw(o,this,y,f,l,n):toConcreteWidget(m,this,!1)?.drawWidget(o,{width:y,showText:u}),o.globalAlpha=s}o.restore()}drawCollapsedSlots(o){for(const n of this.#e)if(n.link!=null){n.drawCollapsed(o);break}for(const n of this.#t)if(n.links?.length){n.drawCollapsed(o);break}}get slots(){return[...this.inputs,...this.outputs]}#d(o,n,s){const a=s?this.getInputPos(n):this.getOutputPos(n);o.boundingRect[0]=a[0]-LiteGraph.NODE_SLOT_HEIGHT*.5,o.boundingRect[1]=a[1]-LiteGraph.NODE_SLOT_HEIGHT*.5,o.boundingRect[2]=o.isWidgetInputSlot?BaseWidget.margin:LiteGraph.NODE_SLOT_HEIGHT,o.boundingRect[3]=LiteGraph.NODE_SLOT_HEIGHT}#g(){const o=[];for(const[n,s]of this.#e.entries())this.widgets?.length&&isWidgetInputSlot(s)||(this.#d(s,n,!0),o.push(s));for(const[n,s]of this.#t.entries())this.#d(s,n,!1),o.push(s);return o.length?createBounds(o,0):null}#u(o){const n=isINodeInputSlot(o),s=this.mouseOver?.[n?"inputId":"outputId"]??-1;return s===-1?null:n?this.inputs[s]:this.outputs[s]}#p(o){return this.#u(o)===o}#_(o){return o?this.mouseOver?.overWidget===o:!1}getSlotFromWidget(o){if(o)return this.inputs.find(n=>isWidgetInputSlot(n)&&n.widget.name===o.name)}getWidgetFromSlot(o){if(isWidgetInputSlot(o))return this.widgets?.find(n=>n.name===o.widget.name)}drawSlots(o,{fromSlot:n,colorContext:s,editorAlpha:a,lowQuality:r}){for(const l of[...this.#e,...this.#t]){const u=n&&l.isValidTarget(n),m=this.#p(l),f=!n||u,_=f&&m;(m||u||!l.isWidgetInputSlot||this.#_(this.getWidgetFromSlot(l))||l.isConnected)&&(o.globalAlpha=f?a:.4*a,l.draw(o,{colorContext:s,lowQuality:r,highlight:_}))}}#b(o){if(!this.widgets||!this.widgets.length)return;const n=this.bodyHeight,s=this.widgets_start_y??(this.widgets_up?0:o)+2;let a=n-s,r=0;const l=[];for(const _ of this.widgets)if(_.computeSize){const y=_.computeSize()[1]+4;_.computedHeight=y,r+=y}else if(_.computeLayoutSize){const{minHeight:y,maxHeight:b}=_.computeLayoutSize(this);l.push({minHeight:y,prefHeight:b,w:_})}else{const y=LiteGraph.NODE_WIDGET_HEIGHT+4;_.computedHeight=y,r+=y}a-=r,this.freeWidgetSpace=a;const u=l.map(_=>({minSize:_.minHeight,maxSize:_.prefHeight})),m=distributeSpace(Math.max(0,a),u);for(const[_,y]of l.entries())y.w.computedHeight=m[_];let f=s;for(const _ of this.widgets)_.y=f,f+=_.computedHeight??0;if(!this.graph)throw new NullGraphError;f>n&&(this.setSize([this.size[0],f]),this.graph.setDirtyCanvas(!1,!0))}#v(){if(!this.widgets)return;const o=new Map;for(const[n,s]of this.inputs.entries())isWidgetInputSlot(s)&&o.set(s.widget.name,{...s,index:n});if(o.size)if(LiteGraph.vueNodesMode)for(const n of this.widgets){const s=o.get(n.name);s&&this.#d(this.#e[s.index],s.index,!0)}else for(const n of this.widgets){const s=o.get(n.name);if(!s)continue;const a=this.#e[s.index],r=LiteGraph.NODE_SLOT_HEIGHT*.5;a.pos=[r,n.y+r],this.#d(a,s.index,!0)}}_setConcreteSlots(){this.#e=this.inputs.map(o=>toClass(NodeInputSlot,o,this)),this.#t=this.outputs.map(o=>toClass(NodeOutputSlot,o,this))}arrange(){const o=this.#g(),n=o?o[1]+o[3]-this.pos[1]:0;this.#b(n),this.#v()}drawProgressBar(o){if(!this.progress)return;const n=o.fillStyle;o.fillStyle="green",o.fillRect(0,0,this.width*this.progress,6),o.fillStyle=n}}class LGraphGroup{static{p(this,"LGraphGroup")}static minWidth=140;static minHeight=80;static resizeLength=10;static padding=4;static defaultColour="#335";id;color;title;font;font_size=LiteGraph.DEFAULT_GROUP_FONT||24;_bounding=new Rectangle(10,10,LGraphGroup.minWidth,LGraphGroup.minHeight);_pos=this._bounding.pos;_size=this._bounding.size;_nodes=[];_children=new Set;graph;flags={};selected;constructor(o,n){this.id=n??-1,this.title=o||"Group";const{pale_blue:s}=LGraphCanvas.node_colors;this.color=s?s.groupcolor:"#AAA"}setColorOption(o){o==null?delete this.color:this.color=o.groupcolor}getColorOption(){return Object.values(LGraphCanvas.node_colors).find(o=>o.groupcolor===this.color)??null}get pos(){return this._pos}set pos(o){!o||o.length<2||(this._pos[0]=o[0],this._pos[1]=o[1])}get size(){return this._size}set size(o){!o||o.length<2||(this._size[0]=Math.max(LGraphGroup.minWidth,o[0]),this._size[1]=Math.max(LGraphGroup.minHeight,o[1]))}get boundingRect(){return this._bounding}getBounding(){return this._bounding}get nodes(){return this._nodes}get titleHeight(){return this.font_size*1.4}get children(){return this._children}get pinned(){return!!this.flags.pinned}pin(o){(o===void 0?!this.pinned:o)?this.flags.pinned=!0:delete this.flags.pinned}unpin(){this.pin(!1)}configure(o){this.id=o.id,this.title=o.title,this._bounding.set(o.bounding),this.color=o.color,this.flags=o.flags||this.flags,o.font_size&&(this.font_size=o.font_size)}serialize(){const o=this._bounding;return{id:this.id,title:this.title,bounding:[...o],color:this.color,font_size:this.font_size,flags:this.flags}}draw(o,n){const{padding:s,resizeLength:a,defaultColour:r}=LGraphGroup,l=this.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE,[u,m]=this._pos,[f,_]=this._size,y=this.color||r;n.globalAlpha=.25*o.editor_alpha,n.fillStyle=y,n.strokeStyle=y,n.beginPath(),n.rect(u+.5,m+.5,f,l*1.4),n.fill(),n.fillStyle=y,n.strokeStyle=y,n.beginPath(),n.rect(u+.5,m+.5,f,_),n.fill(),n.globalAlpha=o.editor_alpha,n.stroke(),n.beginPath(),n.moveTo(u+f,m+_),n.lineTo(u+f-a,m+_),n.lineTo(u+f,m+_-a),n.fill(),n.font=`${l}px ${LiteGraph.GROUP_FONT}`,n.textAlign="left",n.fillText(this.title+(this.pinned?"ðŸ“Œ":""),u+s,m+l),LiteGraph.highlight_selected_group&&this.selected&&strokeShape(n,this._bounding,{title_height:this.titleHeight,padding:s})}resize(o,n){return this.pinned?!1:(this._size[0]=Math.max(LGraphGroup.minWidth,o),this._size[1]=Math.max(LGraphGroup.minHeight,n),!0)}move(o,n,s=!1){if(!this.pinned&&(this._pos[0]+=o,this._pos[1]+=n,s!==!0))for(const a of this._children)a.move(o,n)}snapToGrid(o){return this.pinned?!1:snapPoint(this.pos,o)}recomputeInsideNodes(){if(!this.graph)throw new NullGraphError;const{nodes:o,reroutes:n,groups:s}=this.graph,a=this._children;this._nodes.length=0,a.clear();for(const r of o)containsCentre(this._bounding,r.boundingRect)&&(this._nodes.push(r),a.add(r));for(const r of n.values())isPointInRect(r.pos,this._bounding)&&a.add(r);for(const r of s)containsRect(this._bounding,r._bounding)&&a.add(r);s.sort((r,l)=>r===this?a.has(l)?-1:0:l===this&&a.has(r)?1:0)}resizeTo(o,n=10){const s=createBounds(o,n);s!==null&&(this.pos[0]=s[0],this.pos[1]=s[1]-this.titleHeight,this.size[0]=s[2],this.size[1]=s[3]+this.titleHeight)}addNodes(o,n=10){!this._nodes&&o.length===0||this.resizeTo([...this.children,...this._nodes,...o],n)}getMenuOptions(){return[{content:this.pinned?"Unpin":"Pin",callback:p(()=>{this.pinned?this.unpin():this.pin(),this.setDirtyCanvas(!1,!0)},"callback")},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}]}isPointInTitlebar(o,n){const s=this.boundingRect;return isInRectangle(o,n,s[0],s[1],s[2],this.titleHeight)}isInResize(o,n){const s=this.boundingRect,a=s[0]+s[2],r=s[1]+s[3];return o<a&&n<r&&o-a+(n-r)>-LGraphGroup.resizeLength}isPointInside=LGraphNode.prototype.isPointInside;setDirtyCanvas=LGraphNode.prototype.setDirtyCanvas}class FloatingRenderLink{static{p(this,"FloatingRenderLink")}constructor(o,n,s,a,r=LinkDirection.CENTER){this.network=o,this.link=n,this.toType=s,this.fromReroute=a,this.dragDirection=r;const{origin_id:l,target_id:u,origin_slot:m,target_slot:f}=n;if(l!==-1){const _=o.getNodeById(l)??void 0;if(!_)throw new Error(`Creating DraggingRenderLink for link [${n.id}] failed: Output node [${l}] not found.`);const y=_?.outputs.at(m);if(!y)throw new Error(`Creating DraggingRenderLink for link [${n.id}] failed: Output slot [${m}] not found.`);this.outputNodeId=l,this.outputNode=_,this.outputSlot=y,this.outputIndex=m,this.outputPos=_.getOutputPos(m),this.node=_,this.fromSlot=y,this.fromPos=a?.pos??this.outputPos,this.fromDirection=LinkDirection.LEFT,this.dragDirection=LinkDirection.RIGHT,this.fromSlotIndex=m}else{const _=o.getNodeById(u)??void 0;if(!_)throw new Error(`Creating DraggingRenderLink for link [${n.id}] failed: Input node [${u}] not found.`);const y=_?.inputs.at(f);if(!y)throw new Error(`Creating DraggingRenderLink for link [${n.id}] failed: Input slot [${f}] not found.`);this.inputNodeId=u,this.inputNode=_,this.inputSlot=y,this.inputIndex=f,this.inputPos=_.getInputPos(f),this.node=_,this.fromSlot=y,this.fromDirection=LinkDirection.RIGHT,this.fromSlotIndex=f}this.fromPos=a.pos}node;fromSlot;fromPos;fromDirection;fromSlotIndex;outputNodeId=-1;outputNode;outputSlot;outputIndex=-1;outputPos;inputNodeId=-1;inputNode;inputSlot;inputIndex=-1;inputPos;canConnectToInput(){return this.toType==="input"}canConnectToOutput(){return this.toType==="output"}canConnectToReroute(o){if(this.toType==="input"){if(o.origin_id===this.inputNode?.id)return!1}else if(o.origin_id===this.outputNode?.id)return!1;return!0}canConnectToSubgraphInput(o){return this.toType==="output"&&o.isValidTarget(this.fromSlot)}connectToInput(o,n,s){const a=this.link;a.target_id=o.id,a.target_slot=o.inputs.indexOf(n),o.disconnectInput(o.inputs.indexOf(n)),this.fromSlot._floatingLinks?.delete(a),n._floatingLinks??=new Set,n._floatingLinks.add(a)}connectToOutput(o,n,s){const a=this.link;a.origin_id=o.id,a.origin_slot=o.outputs.indexOf(n),this.fromSlot._floatingLinks?.delete(a),n._floatingLinks??=new Set,n._floatingLinks.add(a)}connectToSubgraphInput(o,n){const s=this.link;s.origin_id=SUBGRAPH_INPUT_ID,s.origin_slot=o.parent.slots.indexOf(o),this.fromSlot._floatingLinks?.delete(s),o._floatingLinks??=new Set,o._floatingLinks.add(s)}connectToSubgraphOutput(o,n){const s=this.link;s.origin_id=SUBGRAPH_OUTPUT_ID,s.origin_slot=o.parent.slots.indexOf(o),this.fromSlot._floatingLinks?.delete(s),o._floatingLinks??=new Set,o._floatingLinks.add(s)}connectToRerouteInput(o,{node:n,input:s},a){const r=this.link;r.target_id=n.id,r.target_slot=n.inputs.indexOf(s),this.fromSlot._floatingLinks?.delete(r),s._floatingLinks??=new Set,s._floatingLinks.add(r),a.dispatch("input-moved",this)}connectToRerouteOutput(o,n,s,a){const r=this.link;r.origin_id=n.id,r.origin_slot=n.outputs.indexOf(s),this.fromSlot._floatingLinks?.delete(r),s._floatingLinks??=new Set,s._floatingLinks.add(r),a.dispatch("output-moved",this)}}class MovingLinkBase{static{p(this,"MovingLinkBase")}constructor(o,n,s,a,r=LinkDirection.CENTER){this.network=o,this.link=n,this.toType=s,this.fromReroute=a,this.dragDirection=r;const{origin_id:l,target_id:u,origin_slot:m,target_slot:f}=n,_=o.getNodeById(l)??void 0;if(!_)throw new Error(`Creating MovingRenderLink for link [${n.id}] failed: Output node [${l}] not found.`);const y=_.outputs.at(m);if(!y)throw new Error(`Creating MovingRenderLink for link [${n.id}] failed: Output slot [${m}] not found.`);this.outputNodeId=l,this.outputNode=_,this.outputSlot=y,this.outputIndex=m,this.outputPos=_.getOutputPos(m);const b=o.getNodeById(u)??void 0;if(!b)throw new Error(`Creating DraggingRenderLink for link [${n.id}] failed: Input node [${u}] not found.`);const w=b.inputs.at(f);if(!w)throw new Error(`Creating DraggingRenderLink for link [${n.id}] failed: Input slot [${f}] not found.`);this.inputNodeId=u,this.inputNode=b,this.inputSlot=w,this.inputIndex=f,this.inputPos=b.getInputPos(f)}outputNodeId;outputNode;outputSlot;outputIndex;outputPos;inputNodeId;inputNode;inputSlot;inputIndex;inputPos}class MovingInputLink extends MovingLinkBase{static{p(this,"MovingInputLink")}toType="input";node;fromSlot;fromPos;fromDirection;fromSlotIndex;constructor(o,n,s,a=LinkDirection.CENTER){super(o,n,"input",s,a),this.node=this.outputNode,this.fromSlot=this.outputSlot,this.fromPos=s?.pos??this.outputPos,this.fromDirection=LinkDirection.NONE,this.fromSlotIndex=this.outputIndex}canConnectToInput(o,n){return this.node.canConnectTo(o,n,this.outputSlot)}canConnectToOutput(){return!1}canConnectToReroute(o){return o.origin_id!==this.inputNode.id}connectToInput(o,n,s){if(n===this.inputSlot)return;this.inputNode.disconnectInput(this.inputIndex,!0);const a=this.outputNode.connectSlots(this.outputSlot,o,n,this.fromReroute?.id);return a&&s.dispatch("input-moved",this),a}connectToOutput(){throw new Error("MovingInputLink cannot connect to an output.")}connectToSubgraphInput(){throw new Error("MovingInputLink cannot connect to a subgraph input.")}connectToSubgraphOutput(o,n){const s=o.connect(this.fromSlot,this.node,this.fromReroute?.id);n?.dispatch("link-created",s)}connectToRerouteInput(o,{node:n,input:s,link:a},r,l){const{outputNode:u,outputSlot:m,fromReroute:f}=this;for(const y of l){if(y.id===this.link.parentId)break;y.totalLinks===1&&y.remove()}o.parentId=f?.id,u.connectSlots(m,n,s,a.parentId)&&r.dispatch("input-moved",this)}connectToRerouteOutput(){throw new Error("MovingInputLink cannot connect to an output.")}disconnect(){return this.inputNode.disconnectInput(this.inputIndex,!0)}}class MovingOutputLink extends MovingLinkBase{static{p(this,"MovingOutputLink")}toType="output";node;fromSlot;fromPos;fromDirection;fromSlotIndex;constructor(o,n,s,a=LinkDirection.CENTER){super(o,n,"output",s,a),this.node=this.inputNode,this.fromSlot=this.inputSlot,this.fromPos=s?.pos??this.inputPos,this.fromDirection=LinkDirection.LEFT,this.fromSlotIndex=this.inputIndex}canConnectToInput(){return!1}canConnectToOutput(o,n){return o.canConnectTo(this.node,this.inputSlot,n)}canConnectToReroute(o){return o.origin_id!==this.outputNode.id}canConnectToSubgraphInput(o){return o.isValidTarget(this.fromSlot)}connectToInput(){throw new Error("MovingOutputLink cannot connect to an input.")}connectToOutput(o,n,s){if(n===this.outputSlot)return;const a=o.connectSlots(n,this.inputNode,this.inputSlot,this.link.parentId);return a&&s.dispatch("output-moved",this),a}connectToSubgraphInput(o,n){const s=o.connect(this.fromSlot,this.node,this.fromReroute?.id);n?.dispatch("link-created",s)}connectToSubgraphOutput(){throw new Error("MovingOutputLink cannot connect to a subgraph output.")}connectToRerouteInput(){throw new Error("MovingOutputLink cannot connect to an input.")}connectToRerouteOutput(o,n,s,a){const{inputNode:r,inputSlot:l,fromReroute:u}=this,m=o?.floating?.slotType==="output";u?u.parentId=o.id:this.link.parentId=o.id,n.connectSlots(s,r,l,this.link.parentId),m&&o.removeAllFloatingLinks(),a.dispatch("output-moved",this)}disconnect(){return this.outputNode.disconnectOutput(this.outputIndex,this.inputNode)}}class ToInputFromIoNodeLink{static{p(this,"ToInputFromIoNodeLink")}constructor(o,n,s,a,r=LinkDirection.CENTER,l){this.network=o,this.node=n,this.fromSlot=s,this.fromReroute=a,this.dragDirection=r;const u=n.slots.indexOf(s);if(u===-1&&s!==n.emptySlot)throw new Error(`Creating render link for node [${this.node.id}] failed: Slot index not found.`);this.fromSlotIndex=u,this.fromPos=a?a.pos:s.pos,this.existingLink=l}toType="input";fromSlotIndex;fromPos;fromDirection=LinkDirection.RIGHT;existingLink;canConnectToInput(o,n){return this.node.canConnectTo(o,n,this.fromSlot)}canConnectToOutput(){return!1}connectToInput(o,n,s){const{fromSlot:a,fromReroute:r,existingLink:l}=this,u=a.connect(n,o,r?.id);if(l){const{input:m,inputNode:f}=l.resolve(this.network);f&&m&&this.node._disconnectNodeInput(f,m,l),s.dispatch("input-moved",this)}else s.dispatch("link-created",u)}connectToSubgraphOutput(){throw new Error("Not implemented")}connectToRerouteInput(o,{node:n,input:s,link:a},r,l){const{fromSlot:u,fromReroute:m}=this,f=m?.floating?.slotType==="output";o.parentId=m?.id;const _=u.connect(s,n,a.parentId);f&&m.removeAllFloatingLinks();for(const y of l){if(y.id===m?.id)break;if(y.removeLink(a),y.totalLinks===0)if(a.isFloating)y.remove();else{const b=a.toFloating("output",y.id);this.network.addFloatingLink(b),y.floating={slotType:"output"}}}this.existingLink?r.dispatch("input-moved",this):r.dispatch("link-created",_)}connectToOutput(){throw new Error("ToInputRenderLink cannot connect to an output.")}connectToSubgraphInput(){throw new Error("ToInputRenderLink cannot connect to a subgraph input.")}connectToRerouteOutput(){throw new Error("ToInputRenderLink cannot connect to an output.")}disconnect(){if(!this.existingLink)return!1;const{input:o,inputNode:n}=this.existingLink.resolve(this.network);return!n||!o?!1:(this.node._disconnectNodeInput(n,o,this.existingLink),!0)}}class ToInputRenderLink{static{p(this,"ToInputRenderLink")}constructor(o,n,s,a,r=LinkDirection.CENTER){this.network=o,this.node=n,this.fromSlot=s,this.fromReroute=a,this.dragDirection=r;const l=n.outputs.indexOf(s);if(l===-1)throw new Error(`Creating render link for node [${this.node.id}] failed: Slot index not found.`);this.fromSlotIndex=l,this.fromPos=a?a.pos:this.node.getOutputPos(l)}toType="input";fromPos;fromSlotIndex;fromDirection=LinkDirection.RIGHT;canConnectToInput(o,n){return this.node.canConnectTo(o,n,this.fromSlot)}canConnectToOutput(){return!1}connectToInput(o,n,s){const{node:a,fromSlot:r,fromReroute:l}=this;if(o===a)return;const u=a.connectSlots(r,o,n,l?.id);s.dispatch("link-created",u)}connectToSubgraphOutput(o,n){const s=o.connect(this.fromSlot,this.node,this.fromReroute?.id);n.dispatch("link-created",s)}connectToRerouteInput(o,{node:n,input:s,link:a},r,l){const{node:u,fromSlot:m,fromReroute:f}=this,_=f?.floating?.slotType==="output";o.parentId=f?.id;const y=u.connectSlots(m,n,s,a.parentId);_&&f.removeAllFloatingLinks();for(const b of l){if(b.id===f?.id)break;if(b.removeLink(a),b.totalLinks===0)if(a.isFloating)b.remove();else{const w=a.toFloating("output",b.id);this.network.addFloatingLink(w),b.floating={slotType:"output"}}}r.dispatch("link-created",y)}connectToOutput(){throw new Error("ToInputRenderLink cannot connect to an output.")}connectToSubgraphInput(){throw new Error("ToInputRenderLink cannot connect to a subgraph input.")}connectToRerouteOutput(){throw new Error("ToInputRenderLink cannot connect to an output.")}}class ToOutputFromIoNodeLink{static{p(this,"ToOutputFromIoNodeLink")}constructor(o,n,s,a,r=LinkDirection.CENTER){this.network=o,this.node=n,this.fromSlot=s,this.fromReroute=a,this.dragDirection=r;const l=n.slots.indexOf(s);if(l===-1&&s!==n.emptySlot)throw new Error(`Creating render link for node [${this.node.id}] failed: Slot index not found.`);this.fromSlotIndex=l,this.fromPos=a?a.pos:s.pos}toType="output";fromPos;fromSlotIndex;fromDirection=LinkDirection.LEFT;canConnectToInput(){return!1}canConnectToOutput(o,n){return this.node.canConnectTo(o,this.fromSlot,n)}canConnectToReroute(o){return o.origin_id!==this.node.id}connectToOutput(o,n,s){const{fromSlot:a,fromReroute:r}=this,l=a.connect(n,o,r?.id);s.dispatch("link-created",l)}connectToSubgraphInput(){throw new Error("Not implemented")}connectToRerouteOutput(o,n,s,a){const{fromSlot:r}=this,l=r.connect(s,n,o?.id);a.dispatch("link-created",l)}connectToInput(){throw new Error("ToOutputRenderLink cannot connect to an input.")}connectToSubgraphOutput(){throw new Error("ToOutputRenderLink cannot connect to a subgraph output.")}connectToRerouteInput(){throw new Error("ToOutputRenderLink cannot connect to an input.")}}class ToOutputRenderLink{static{p(this,"ToOutputRenderLink")}constructor(o,n,s,a,r=LinkDirection.CENTER){this.network=o,this.node=n,this.fromSlot=s,this.fromReroute=a,this.dragDirection=r;const l=n.inputs.indexOf(s);if(l===-1)throw new Error(`Creating render link for node [${this.node.id}] failed: Slot index not found.`);this.fromSlotIndex=l,this.fromPos=a?a.pos:this.node.getInputPos(l)}toType="output";fromPos;fromSlotIndex;fromDirection=LinkDirection.LEFT;canConnectToInput(){return!1}canConnectToOutput(o,n){return this.node.canConnectTo(o,this.fromSlot,n)}canConnectToReroute(o){return o.origin_id!==this.node.id}canConnectToSubgraphInput(o){return o.isValidTarget(this.fromSlot)}connectToOutput(o,n,s){const{node:a,fromSlot:r,fromReroute:l}=this;if(!a)return;const u=o.connectSlots(n,a,r,l?.id);s.dispatch("link-created",u)}connectToSubgraphInput(o,n){const s=o.connect(this.fromSlot,this.node,this.fromReroute?.id);n?.dispatch("link-created",s)}connectToRerouteOutput(o,n,s,a){const{node:r,fromSlot:l}=this,u=n.connectSlots(s,r,l,o?.id);a.dispatch("link-created",u)}connectToInput(){throw new Error("ToOutputRenderLink cannot connect to an input.")}connectToSubgraphOutput(){throw new Error("ToOutputRenderLink cannot connect to a subgraph output.")}connectToRerouteInput(){throw new Error("ToOutputRenderLink cannot connect to an input.")}}class ToOutputFromRerouteLink extends ToOutputRenderLink{static{p(this,"ToOutputFromRerouteLink")}constructor(o,n,s,a,r){super(o,n,s,a),this.fromReroute=a,this.linkConnector=r}canConnectToReroute(){return!1}connectToOutput(o,n){const s=new ToInputRenderLink(this.network,o,n);this.linkConnector._connectOutputToReroute(this.fromReroute,s)}}class LinkConnector{static{p(this,"LinkConnector")}state={connectingTo:void 0,multi:!1,draggingExistingLinks:!1,snapLinksPos:void 0};events=new CustomEventTarget;renderLinks=[];inputLinks=[];outputLinks=[];floatingLinks=[];hiddenReroutes=new Set;overWidget;overWidgetType;overReroute;#e;constructor(o){this.#e=o}get isConnecting(){return this.state.connectingTo!==void 0}get draggingExistingLinks(){return this.state.draggingExistingLinks}moveInputLink(o,n){if(this.isConnecting)throw new Error("Already dragging links.");const{state:s,inputLinks:a,renderLinks:r}=this,l=n.link;if(l==null){const u=n._floatingLinks?.values().next().value;if(u?.parentId==null)return;try{const m=o.reroutes.get(u.parentId);if(!m)throw new Error(`Invalid reroute id: [${u.parentId}] for floating link id: [${u.id}].`);const f=new FloatingRenderLink(o,u,"input",m);if(this.events.dispatch("before-move-input",f)===!1)return;r.push(f)}catch(m){console.warn(`Could not create render link for link id: [${u.id}].`,u,m)}u._dragging=!0,this.floatingLinks.push(u)}else{const u=o.links.get(l);if(!u)return;if(u.origin_id===SUBGRAPH_INPUT_ID){const m=o.inputNode?.slots[u.origin_slot];if(!m){console.warn(`Could not find subgraph input for slot [${u.origin_slot}]`);return}try{const f=o.getReroute(u.parentId),_=new ToInputFromIoNodeLink(o,o.inputNode,m,f,LinkDirection.CENTER,u);r.push(_),this.listenUntilReset("input-moved",()=>{u.disconnect(o,"input")})}catch(f){console.warn(`Could not create render link for subgraph input link id: [${u.id}].`,u,f);return}u._dragging=!0,a.push(u)}else{try{const m=o.getReroute(u.parentId),f=new MovingInputLink(o,u,m);if(this.events.dispatch("before-move-input",f)===!1)return;r.push(f),this.listenUntilReset("input-moved",y=>{"link"in y.detail&&y.detail.link&&y.detail.link.disconnect(o,"output")})}catch(m){console.warn(`Could not create render link for link id: [${u.id}].`,u,m);return}u._dragging=!0,a.push(u)}}s.connectingTo="input",s.draggingExistingLinks=!0,this.#n(!1)}moveOutputLink(o,n){if(this.isConnecting)throw new Error("Already dragging links.");const{state:s,renderLinks:a}=this;if(n._floatingLinks?.size)for(const r of n._floatingLinks.values())try{const l=LLink.getFirstReroute(o,r);if(!l)throw new Error(`Invalid reroute id: [${r.parentId}] for floating link id: [${r.id}].`);const u=new FloatingRenderLink(o,r,"output",l);if(this.events.dispatch("before-move-output",u)===!1)continue;a.push(u),this.floatingLinks.push(r)}catch(l){console.warn(`Could not create render link for link id: [${r.id}].`,r,l)}if(n.links?.length)for(const r of n.links){const l=o.links.get(r);if(!l)continue;const u=LLink.getFirstReroute(o,l);u?(u._dragging=!0,this.hiddenReroutes.add(u)):l._dragging=!0,this.outputLinks.push(l);try{if(l.target_id===SUBGRAPH_OUTPUT_ID){if(!(o instanceof Subgraph)){console.warn("Subgraph output link found in non-subgraph network.");continue}const _=o.outputs.at(l.target_slot);if(!_)throw new Error("No subgraph output found for link.");const y=new ToOutputFromIoNodeLink(o,o.outputNode,_);y.fromDirection=LinkDirection.NONE,a.push(y);continue}const m=new MovingOutputLink(o,l,u,LinkDirection.RIGHT);if(this.events.dispatch("before-move-output",m)===!1)continue;a.push(m)}catch(m){console.warn(`Could not create render link for link id: [${l.id}].`,l,m);continue}}a.length!==0&&(s.draggingExistingLinks=!0,s.multi=!0,s.connectingTo="output",this.#n(!0))}dragNewFromOutput(o,n,s,a){if(this.isConnecting)throw new Error("Already dragging links.");const{state:r}=this,l=new ToInputRenderLink(o,n,s,a);this.renderLinks.push(l),r.connectingTo="input",this.#n(!1)}dragNewFromInput(o,n,s,a){if(this.isConnecting)throw new Error("Already dragging links.");const{state:r}=this,l=new ToOutputRenderLink(o,n,s,a);this.renderLinks.push(l),r.connectingTo="output",this.#n(!0)}dragNewFromSubgraphInput(o,n,s,a){if(this.isConnecting)throw new Error("Already dragging links.");const r=new ToInputFromIoNodeLink(o,n,s,a);this.renderLinks.push(r),this.state.connectingTo="input",this.#n(!1)}dragNewFromSubgraphOutput(o,n,s,a){if(this.isConnecting)throw new Error("Already dragging links.");const r=new ToOutputFromIoNodeLink(o,n,s,a);this.renderLinks.push(r),this.state.connectingTo="output",this.#n(!0)}dragFromReroute(o,n){if(this.isConnecting)throw new Error("Already dragging links.");const s=n.firstLink??n.firstFloatingLink;if(!s){console.warn("No link found for reroute.");return}if(s.origin_id===SUBGRAPH_INPUT_ID){if(!(o instanceof Subgraph)){console.warn("Subgraph input link found in non-subgraph network.");return}const u=o.inputs.at(s.origin_slot);if(!u)throw new Error("No subgraph input found for link.");const m=new ToInputFromIoNodeLink(o,o.inputNode,u,n);m.fromDirection=LinkDirection.NONE,this.renderLinks.push(m),this.state.connectingTo="input",this.#n(!1);return}const a=o.getNodeById(s.origin_id);if(!a){console.warn("No output node found for link.",s);return}const r=a.outputs.at(s.origin_slot);if(!r){console.warn("No output slot found for link.",s);return}const l=new ToInputRenderLink(o,a,r,n);l.fromDirection=LinkDirection.NONE,this.renderLinks.push(l),this.state.connectingTo="input",this.#n(!1)}dragFromRerouteToOutput(o,n){if(this.isConnecting)throw new Error("Already dragging links.");const s=n.firstLink??n.firstFloatingLink;if(!s){console.warn("No link found for reroute.");return}if(s.target_id===SUBGRAPH_OUTPUT_ID){if(!(o instanceof Subgraph)){console.warn("Subgraph output link found in non-subgraph network.");return}const u=o.outputs.at(s.target_slot);if(!u)throw new Error("No subgraph output found for link.");const m=new ToOutputFromIoNodeLink(o,o.outputNode,u,n);m.fromDirection=LinkDirection.NONE,this.renderLinks.push(m),this.state.connectingTo="output",this.#n(!1);return}const a=o.getNodeById(s.target_id);if(!a){console.warn("No input node found for link.",s);return}const r=a.inputs.at(s.target_slot);if(!r){console.warn("No input slot found for link.",s);return}const l=new ToOutputFromRerouteLink(o,a,r,n,this);l.fromDirection=LinkDirection.LEFT,this.renderLinks.push(l),this.state.connectingTo="output",this.#n(!0)}dragFromLinkSegment(o,n){if(this.isConnecting)throw new Error("Already dragging links.");const{state:s}=this;if(n.origin_id==null||n.origin_slot==null)return;const a=o.getNodeById(n.origin_id);if(!a)return;const r=a.outputs.at(n.origin_slot);if(!r)return;const l=o.getReroute(n.parentId),u=new ToInputRenderLink(o,a,r,l);u.fromDirection=LinkDirection.NONE,this.renderLinks.push(u),s.connectingTo="input",this.#n(!1)}dropLinks(o,n){if(!(!this.isConnecting&&this.events.dispatch("before-drop-links",{renderLinks:this.renderLinks,event:n})===!1))try{const{canvasX:s,canvasY:a}=n,r=o.getIoNodeOnPos?.(s,a);if(r){this.dropOnIoNode(r,n);return}const l=o.getNodeOnPos(s,a)??void 0;if(l)this.dropOnNode(l,n);else{const u=o.getRerouteOnPos(s,a);u&&this.isRerouteValidDrop(u)?this.dropOnReroute(u,n):this.dropOnNothing(n)}}finally{this.events.dispatch("after-drop-links",{renderLinks:this.renderLinks,event:n})}}dropOnIoNode(o,n){const{renderLinks:s,state:a}=this,{connectingTo:r}=a,{canvasX:l,canvasY:u}=n;if(r==="input"&&o instanceof SubgraphOutputNode){const m=o.getSlotInPosition(l,u);if(!m){this.dropOnNothing(n);return}let f=m;for(const _ of s)if(_.connectToSubgraphOutput(f,this.events),m instanceof EmptySubgraphOutput&&o.slots.length>0){const y=o.slots[o.slots.length-1],b=s[s.indexOf(_)+1];b&&_.fromSlot.type===b.fromSlot.type?f=y:f=m}}else if(r==="output"&&o instanceof SubgraphInputNode){const m=o.getSlotInPosition(l,u);if(!m){this.dropOnNothing(n);return}let f=m;for(const _ of s){if("canConnectToSubgraphInput"in _&&!_.canConnectToSubgraphInput(f)){console.warn("Invalid connection type",_.fromSlot.type,"->",f.type);continue}if(_.connectToSubgraphInput(f,this.events),m instanceof EmptySubgraphInput&&o.slots.length>0){const y=o.slots[o.slots.length-1],b=s[s.indexOf(_)+1];b&&_.fromSlot.type===b.fromSlot.type?f=y:f=m}}}else console.error("Invalid connectingTo state &/ ioNode",r,o)}dropOnNode(o,n){const{renderLinks:s,state:a}=this,{connectingTo:r}=a,{canvasX:l,canvasY:u}=n;if(!s.every(m=>m.node===o)){if(r==="output"){const m=o.getOutputOnPos([l,u]);m?this.#o(o,m):this.connectToNode(o,n)}else if(r==="input"){const f=o.getInputOnPos([l,u])??o.getSlotFromWidget(this.overWidget);f?this.#t(o,f):this.connectToNode(o,n)}}}dropOnReroute(o,n){if(this.events.dispatch("dropped-on-reroute",{reroute:o,event:n})!==!1){if(this.state.connectingTo==="input"){if(this.renderLinks.length!==1)throw new Error(`Attempted to connect ${this.renderLinks.length} input links to a reroute.`);const a=this.renderLinks[0];this._connectOutputToReroute(o,a);return}for(const a of this.renderLinks){if(a.toType!=="output")continue;const r=o.findSourceOutput();if(!r)continue;const{node:l,output:u}=r;a.canConnectToOutput(l,u)&&a.connectToRerouteOutput(o,l,u,this.events)}}}_connectOutputToReroute(o,n){const s=o.findTargetInputs();if(!s?.length)return;const a=o.getReroutes();if(a===null)throw new Error("Reroute loop detected.");const r=a.slice(0,-1).reverse();if(n instanceof ToInputRenderLink){const{node:u,fromSlot:m,fromSlotIndex:f,fromReroute:_}=n;if(o.setFloatingLinkOrigin(u,m,f),_!=null)for(const y of r){if(y.id===_.id)break;for(const b of o.floatingLinkIds)y.floatingLinkIds.delete(b)}}const l=s.filter(u=>n.toType==="input"&&canConnectInputLinkToReroute(n,u.node,u.input,o));for(const u of l)n.connectToRerouteInput(o,u,this.events,r)}dropOnNothing(o){this.events.dispatch("dropped-on-canvas",o)!==!1&&this.disconnectLinks()}disconnectLinks(){for(const o of this.renderLinks)(o instanceof MovingLinkBase||o instanceof ToInputFromIoNodeLink)&&o.disconnect()}connectToNode(o,n){const{state:{connectingTo:s}}=this;if(this.events.dispatch("dropped-on-node",{node:o,event:n})===!1)return;const r=this.renderLinks[0];if(r){if(s==="output"){const l=o.findOutputByType(r.fromSlot.type)?.slot;if(l===void 0){console.warn(`Could not find slot for link type: [${r.fromSlot.type}].`);return}this.#o(o,l)}else if(s==="input"){const l=o.findInputByType(r.fromSlot.type)?.slot;if(l===void 0){console.warn(`Could not find slot for link type: [${r.fromSlot.type}].`);return}this.#t(o,l)}}}#t(o,n){for(const s of this.renderLinks)s.canConnectToInput(o,n)&&s.connectToInput(o,n,this.events)}#o(o,n){for(const s of this.renderLinks){if(!s.canConnectToOutput(o,n)){s instanceof MovingOutputLink&&s.link.parentId!==void 0&&s.outputNode.connectSlots(s.outputSlot,s.inputNode,s.inputSlot,void 0);continue}s.connectToOutput(o,n,this.events)}}isInputValidDrop(o,n){return this.renderLinks.some(s=>s.canConnectToInput(o,n))}isNodeValidDrop(o){return this.state.connectingTo==="output"?o.outputs.some(n=>this.renderLinks.some(s=>s.canConnectToOutput(o,n))):o.inputs.some(n=>this.renderLinks.some(s=>s.canConnectToInput(o,n)))}isSubgraphInputValidDrop(o){return this.renderLinks.some(n=>"canConnectToSubgraphInput"in n&&n.canConnectToSubgraphInput(o))}isRerouteValidDrop(o){if(this.state.connectingTo==="input"){const n=o.findTargetInputs();if(!n?.length)return!1;for(const{node:s,input:a}of n)for(const r of this.renderLinks)if(r.toType==="input"&&canConnectInputLinkToReroute(r,s,a,o))return!0}else{const n=o.findSourceOutput();if(!n)return!1;const{node:s,output:a}=n;for(const r of this.renderLinks)if(r.toType==="output"&&r.canConnectToReroute(o)&&r.canConnectToOutput(s,a))return!0}return!1}#n(o){const n=this.renderLinks.map(s=>{const a=o?s.fromSlot:null,r=o?null:s.fromSlot,l=s instanceof MovingLinkBase?s.link?.parentId:s.fromReroute?.id;return{node:s.node,slot:s.fromSlotIndex,input:a,output:r,pos:s.fromPos,afterRerouteId:l}});this.#e(n)}export(o){return{renderLinks:[...this.renderLinks],inputLinks:[...this.inputLinks],outputLinks:[...this.outputLinks],floatingLinks:[...this.floatingLinks],state:{...this.state},network:o}}listenUntilReset(o,n,s){this.events.addEventListener(o,n,s),this.events.addEventListener("reset",()=>this.events.removeEventListener(o,n),{once:!0})}reset(o=!1){if(this.events.dispatch("reset",o)===!1)return;const{state:s,outputLinks:a,inputLinks:r,hiddenReroutes:l,renderLinks:u,floatingLinks:m}=this;if(!(!o&&s.connectingTo===void 0)){s.connectingTo=void 0;for(const f of a)delete f._dragging;for(const f of r)delete f._dragging;for(const f of m)delete f._dragging;for(const f of l)delete f._dragging;u.length=0,r.length=0,a.length=0,m.length=0,l.clear(),s.multi=!1,s.draggingExistingLinks=!1,s.snapLinksPos=void 0}}}function canConnectInputLinkToReroute(i,o,n,s){const{fromReroute:a}=i;if(!i.canConnectToInput(o,n)||a?.id===s.id||a?.getReroutes()?.includes(s))return!1;if(i instanceof ToInputRenderLink){if(s.parentId==null){if(s.firstLink?.hasOrigin(i.node.id,i.fromSlotIndex))return!1}else if(i.fromReroute?.id===s.parentId)return!1}return!0}p(canConnectInputLinkToReroute,"canConnectInputLinkToReroute");class RecursionError extends Error{static{p(this,"RecursionError")}constructor(o){super(o),this.name="RecursionError"}}class InvalidLinkError extends Error{static{p(this,"InvalidLinkError")}constructor(o="Attempted to access a link that was invalid.",n){super(o,{cause:n}),this.name="InvalidLinkError"}}class SlotIndexError extends Error{static{p(this,"SlotIndexError")}constructor(o="Attempted to access a slot that was out of bounds.",n){super(o,{cause:n}),this.name="SlotIndexError"}}class ExecutableNodeDTO{static{p(this,"ExecutableNodeDTO")}constructor(o,n,s,a){if(this.node=o,this.subgraphNodePath=n,this.nodesByExecutionId=s,this.subgraphNode=a,!o.graph)throw new NullGraphError;this.#e=[...this.subgraphNodePath,this.node.id].join(":"),this.graph=o.graph,this.inputs=this.node.inputs.map(r=>({linkId:r.link,name:r.name,type:r.type})),this.node.applyToGraph&&(this.applyToGraph=(...r)=>this.node.applyToGraph?.(...r))}graph;inputs;#e;get id(){return this.#e}get type(){return this.node.type}get title(){return this.node.title}get mode(){return this.node.mode}get comfyClass(){return this.node.comfyClass}get isVirtualNode(){return this.node.isVirtualNode}get widgets(){return this.node.widgets}get subgraphId(){return this.subgraphNode?.subgraph.id}getInnerNodes(){return this.node.isSubgraphNode()?this.node.getInnerNodes(this.nodesByExecutionId,this.subgraphNodePath):[this]}resolveInput(o,n=new Set,s){const a=`${this.subgraphNode?.subgraph.id}:${this.node.id}[I]${o}`;if(n.has(a)){const y=`${this.node.id}${this.node.title?` (${this.node.title})`:""}`,b=this.subgraphNodePath.length>0?` at path ${this.subgraphNodePath.join(":")}`:"";throw new RecursionError(`Circular reference detected while resolving input ${o} of node ${y}${b}. This creates an infinite loop in link resolution. UniqueID: [${a}]`)}n.add(a);const r=this.inputs.at(o);if(!r)throw new SlotIndexError(`No input found for flattened id [${this.id}] slot [${o}]`);if(r.linkId==null)return;const l=this.graph.getLink(r.linkId);if(!l)throw new InvalidLinkError(`No link found in parent graph for id [${this.id}] slot [${o}] ${r.name}`);const{subgraphNode:u}=this;if(u&&l.originIsIoNode){const y=u.inputs.at(l.origin_slot);if(!y)throw new SlotIndexError(`No input found for slot [${l.origin_slot}] ${r.name}`);const b=y.link;if(b==null){const C=u.getWidgetFromSlot(y);return C?{node:this,origin_id:this.id,origin_slot:-1,widgetInfo:{value:C.value}}:void 0}const w=u.graph.getLink(b);if(!w)throw new InvalidLinkError(`No outer link found for slot [${l.origin_slot}] ${r.name}`);const k=this.subgraphNodePath.join(":"),S=this.nodesByExecutionId.get(k);if(!S)throw new Error(`No subgraph node DTO found for id [${k}]`);return S.resolveInput(w.target_slot,n)}const m=this.graph.getNodeById(l.origin_id);if(!m)throw new InvalidLinkError(`No input node found for id [${this.id}] slot [${o}] ${r.name}`);const f=[...this.subgraphNodePath,m.id].join(":"),_=this.nodesByExecutionId.get(f);if(!_)throw new Error(`No output node DTO found for id [${f}]`);return _.resolveOutput(l.origin_slot,s??r.type,n)}resolveOutput(o,n,s){const a=`${this.subgraphNode?.subgraph.id}:${this.node.id}[O]${o}`;if(s.has(a)){const l=`${this.node.id}${this.node.title?` (${this.node.title})`:""}`,u=this.subgraphNodePath.length>0?` at path ${this.subgraphNodePath.join(":")}`:"";throw new RecursionError(`Circular reference detected while resolving output ${o} of node ${l}${u}. This creates an infinite loop in link resolution. UniqueID: [${a}]`)}if(s.add(a),this.mode===LGraphEventMode.BYPASS){const l=this.#t(o,n);if(l===-1){console.warn(`[ExecutableNodeDTO.resolveOutput] No input types match type [${n}] for id [${this.id}] slot [${o}]`,this);return}return this.resolveInput(l,s)}const{node:r}=this;if(r.isSubgraphNode())return this.#o(o,n,s);if(r.isVirtualNode){const l=this.node.getInputLink(o);if(l){const{inputNode:u}=l.resolve(this.graph);if(!u)throw new InvalidLinkError(`Virtual node failed to resolve parent [${this.id}] slot [${o}]`);const m=[...this.subgraphNodePath,u.id].join(":"),f=this.nodesByExecutionId.get(m);if(!f)throw new Error(`No input node DTO found for id [${u.id}]`);return f.resolveInput(l.target_slot,s,n)}return}return{node:this,origin_id:this.id,origin_slot:o}}#t(o,n){const{inputs:s}=this,a=s[o],r=this.node.outputs[o].type;if(n==="*"||n==="")return s.length>o?o:0;if(a&&LiteGraph.isValidConnection(a.type,r)&&LiteGraph.isValidConnection(a.type,n))return o;const l=s.findIndex(u=>u.type===n);return l!==-1?l:s.findIndex(u=>LiteGraph.isValidConnection(u.type,r)&&LiteGraph.isValidConnection(u.type,n))}#o(o,n,s){const{node:a}=this,r=a.outputs.at(o);if(!r)throw new SlotIndexError(`No output found for flattened id [${this.id}] slot [${o}]`);if(!a.isSubgraphNode())throw new TypeError(`Node is not a subgraph node: ${a.id}`);const l=a.resolveSubgraphOutputLink(o);if(!l)return;const u=l.outputNode;if(!u)throw new Error(`No output node found for id [${this.id}] slot [${o}] ${r.name}`);const m=[...this.subgraphNodePath,a.id,u.id].join(":"),f=this.nodesByExecutionId.get(m);if(!f)throw new Error(`No inner node DTO found for id [${m}]`);return f.resolveOutput(l.link.origin_slot,n,s)}}const workflowSvg=new Image;workflowSvg.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' width='16' height='16'%3E%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 16 16'%3E%3Cpath stroke='white' stroke-linecap='round' stroke-width='1.3' d='M9.18613 3.09999H6.81377M9.18613 12.9H7.55288c-3.08678 0-5.35171-2.99581-4.60305-6.08843l.3054-1.26158M14.7486 2.1721l-.5931 2.45c-.132.54533-.6065.92789-1.1508.92789h-2.2993c-.77173 0-1.33797-.74895-1.1508-1.5221l.5931-2.45c.132-.54533.6065-.9279 1.1508-.9279h2.2993c.7717 0 1.3379.74896 1.1508 1.52211Zm-8.3033 0-.59309 2.45c-.13201.54533-.60646.92789-1.15076.92789H2.4021c-.7717 0-1.33793-.74895-1.15077-1.5221l.59309-2.45c.13201-.54533.60647-.9279 1.15077-.9279h2.29935c.77169 0 1.33792.74896 1.15076 1.52211Zm8.3033 9.8-.5931 2.45c-.132.5453-.6065.9279-1.1508.9279h-2.2993c-.77173 0-1.33797-.749-1.1508-1.5221l.5931-2.45c.132-.5453.6065-.9279 1.1508-.9279h2.2993c.7717 0 1.3379.7489 1.1508 1.5221Z'/%3E%3C/svg%3E %3C/svg%3E";class SubgraphNode extends LGraphNode{static{p(this,"SubgraphNode")}constructor(o,n,s){super(n.name,n.id),this.graph=o,this.subgraph=n;const a=this.subgraph.events,{signal:r}=this.#e;a.addEventListener("input-added",l=>{const u=l.detail.input,{name:m,type:f}=u,_=this.inputs.find(b=>b.name==m);if(_){const b=u.linkIds[0],{inputNode:w,input:k}=n.links[b].resolve(n),S=w?.widgets?.find?.(C=>C.name==m);S&&this.#o(u,_,S,k?.widget);return}const y=this.addInput(m,f);this.#t(u,y)},{signal:r}),a.addEventListener("removing-input",l=>{const u=l.detail.input._widget;u&&this.ensureWidgetRemoved(u),this.removeInput(l.detail.index),this.setDirtyCanvas(!0,!0)},{signal:r}),a.addEventListener("output-added",l=>{const{name:u,type:m}=l.detail.output;this.addOutput(u,m)},{signal:r}),a.addEventListener("removing-output",l=>{this.removeOutput(l.detail.index),this.setDirtyCanvas(!0,!0)},{signal:r}),a.addEventListener("renaming-input",l=>{const{index:u,newName:m}=l.detail,f=this.inputs.at(u);if(!f)throw new Error("Subgraph input not found");f.label=m,f._widget&&(f._widget.label=m)},{signal:r}),a.addEventListener("renaming-output",l=>{const{index:u,newName:m}=l.detail,f=this.outputs.at(u);if(!f)throw new Error("Subgraph output not found");f.label=m},{signal:r}),this.type=n.id,this.configure(s),this.addTitleButton({name:"enter_subgraph",text:"î¤»",yOffset:0,xOffset:-10,fontSize:16})}type;isVirtualNode=!0;get rootGraph(){return this.graph.rootGraph}get displayType(){return"Subgraph node"}isSubgraphNode(){return!0}widgets=[];#e=new AbortController;onTitleButtonClick(o,n){o.name==="enter_subgraph"?n.openSubgraph(this.subgraph,this):super.onTitleButtonClick(o,n)}#t(o,n){n._listenerController&&typeof n._listenerController.abort=="function"&&n._listenerController.abort(),n._listenerController=new AbortController;const{signal:s}=n._listenerController;o.events.addEventListener("input-connected",a=>{if(n._widget)return;const r=o._widget;if(!r)return;const l=a.detail.input.widget;this.#o(o,n,r,l)},{signal:s}),o.events.addEventListener("input-disconnected",()=>{o.getConnectedWidgets().length>0||(this.removeWidgetByName(n.name),delete n.pos,delete n.widget,n._widget=void 0)},{signal:s})}configure(o){for(const n of this.inputs)n._listenerController&&typeof n._listenerController.abort=="function"&&n._listenerController.abort();this.inputs.length=0,this.inputs.push(...this.subgraph.inputNode.slots.map(n=>new NodeInputSlot({name:n.name,localized_name:n.localized_name,label:n.label,type:n.type,link:null},this))),this.outputs.length=0,this.outputs.push(...this.subgraph.outputNode.slots.map(n=>new NodeOutputSlot({name:n.name,localized_name:n.localized_name,label:n.label,type:n.type,links:null},this))),super.configure(o)}_internalConfigureAfterSlots(){this.widgets.length=0;for(const o of this.inputs){const n=this.subgraph.inputNode.slots.find(s=>s.name===o.name);if(!n){console.warn(`[SubgraphNode.configure] No subgraph input found for input ${o.name}, skipping`);continue}this.#t(n,o);for(const s of n.linkIds){const a=this.subgraph.getLink(s);if(!a){console.warn(`[SubgraphNode.configure] No link found for link ID ${s}`,this);continue}const r=a.resolve(this.subgraph);if(!r.input||!r.inputNode){console.warn("Invalid resolved link",r,this);continue}const l=r.inputNode.getWidgetFromSlot(r.input);if(l){this.#o(n,o,l,r.input.widget);break}}}}#o(o,n,s,a){const r=toConcreteWidget(s,this).createCopyForNode(this);Object.assign(r,{get name(){return o.name},set name(u){console.warn("Promoted widget: setting name is not allowed",this,u)},get localized_name(){return o.localized_name},set localized_name(u){console.warn("Promoted widget: setting localized_name is not allowed",this,u)},get label(){return o.label},set label(u){console.warn("Promoted widget: setting label is not allowed",this,u)},get tooltip(){return s.tooltip},set tooltip(u){console.warn("Promoted widget: setting tooltip is not allowed",this,u)}});const l=this.inputs.filter(u=>u.widget).length;this.widgets.splice(l,0,r),this.subgraph.events.dispatch("widget-promoted",{widget:r,subgraphNode:this}),n.widget??={name:o.name},n.widget.name=o.name,a&&Object.setPrototypeOf(n.widget,a),n._widget=r}addInput(o,n,s={}){return super.addInput(o,n,s)}getInputLink(o){const n=this.subgraph.outputNode.slots[o].getLinks().at(0);if(!n)return console.warn(`SubgraphNode.getInputLink: no inner link found for slot ${o}`),null;const s=LLink.create(n);return s.origin_id=`${this.id}:${n.origin_id}`,s.origin_slot=n.origin_slot,s}resolveSubgraphInputLinks(o){const n=this.subgraph.inputNode.slots[o],s=n.getLinks();return s.length===0?(console.warn(`[SubgraphNode.resolveSubgraphInputLinks] No inner links found for input slot [${o}] ${n.name}`,this),[]):s.map(a=>a.resolve(this.subgraph))}resolveSubgraphOutputLink(o){const n=this.subgraph.outputNode.slots[o],s=n.getLinks().at(0);if(s)return s.resolve(this.subgraph);console.warn(`[SubgraphNode.resolveSubgraphOutputLink] No inner link found for output slot [${o}] ${n.name}`,this)}getInnerNodes(o,n=[],s=[],a=new Set){if(a.has(this)){const m=`${this.id}${this.title?` (${this.title})`:""}`,f=`'${this.subgraph.name||"Unnamed Subgraph"}'`,_=n.length;throw new RecursionError(`Circular reference detected at depth ${_} in node ${m} of subgraph ${f}. This creates an infinite loop in the subgraph hierarchy.`)}a.add(this);const r=[...n,this.id],l=this.graph.rootGraph.resolveSubgraphIdPath(n).at(-1),u=new ExecutableNodeDTO(this,n,o,l);o.set(u.id,u);for(const m of this.subgraph.nodes)if("getInnerNodes"in m&&m.getInnerNodes)m.getInnerNodes(o,r,s,new Set(a));else{const f=new ExecutableNodeDTO(m,r,o,this);o.set(f.id,f),s.push(f)}return s}removeWidgetByName(o){const n=this.widgets.find(s=>s.name===o);n&&this.subgraph.events.dispatch("widget-demoted",{widget:n,subgraphNode:this}),super.removeWidgetByName(o)}ensureWidgetRemoved(o){this.widgets.includes(o)&&this.subgraph.events.dispatch("widget-demoted",{widget:o,subgraphNode:this}),super.ensureWidgetRemoved(o)}onRemoved(){this.#e.abort();for(const o of this.widgets)"isProxyWidget"in o&&o.isProxyWidget||this.subgraph.events.dispatch("widget-demoted",{widget:o,subgraphNode:this});for(const o of this.inputs)o._listenerController&&typeof o._listenerController.abort=="function"&&o._listenerController.abort()}drawTitleBox(o,{scale:n,low_quality:s=!1,title_height:a=LiteGraph.NODE_TITLE_HEIGHT,box_size:r=10}){if(this.onDrawTitleBox){this.onDrawTitleBox(o,a,this.renderingSize,n);return}o.save(),o.fillStyle="#3b82f6",o.beginPath(),o.roundRect(6,-24.5,22,20,5),o.fill(),s||(o.translate(25,23),o.scale(-1.5,1.5),o.drawImage(workflowSvg,0,-a,r,r)),o.restore()}serialize(){for(let o=0;o<this.widgets.length;o++){const n=this.widgets[o],s=this.inputs.find(a=>a.name===n.name);if(s){const a=this.subgraph.inputNode.slots.find(r=>r.name===s.name);if(a){const r=a.getConnectedWidgets();for(const l of r)l.value=n.value}}}return super.serialize()}clone(){const o=super.clone();return this.properties.proxyWidgets=this.properties.proxyWidgets,o}}function getBoundaryNodes(i){const o=i?.find(l=>l);if(!o)return null;let n=o,s=o,a=o,r=o;for(const l of i){if(!l)continue;const[u,m]=l.pos,[f,_]=l.size;m<n.pos[1]&&(n=l),u+f>s.pos[0]+s.size[0]&&(s=l),m+_>a.pos[1]+a.size[1]&&(a=l),u<r.pos[0]&&(r=l)}return{top:n,right:s,bottom:a,left:r}}p(getBoundaryNodes,"getBoundaryNodes");function distributeNodes(i,o){const n=i?.length;if(!(n>1))return[];const s=o?0:1;let a=0,r=-1/0;for(const y of i){a+=y.size[s];const b=y.pos[s]+y.size[s];b>r&&(r=b)}const l=[...i].sort((y,b)=>y.pos[s]-b.pos[s]),u=l[0].pos[s],m=(r-u-a)/(n-1);let f=u;for(let y=0;y<n;y++){const b=l[y];b.pos[s]=f+m*y,f+=b.size[s]}return l.map(y=>({node:y,newPos:{x:y.pos[0],y:y.pos[1]}}))}p(distributeNodes,"distributeNodes");function alignNodes(i,o,n){if(!i)return[];const s=n===void 0?getBoundaryNodes(i):{top:n,right:n,bottom:n,left:n};if(s===null)return[];const a=i.map(r=>{switch(o){case"right":return{node:r,newPos:{x:s.right.pos[0]+s.right.size[0]-r.size[0],y:r.pos[1]}};case"left":return{node:r,newPos:{x:s.left.pos[0],y:r.pos[1]}};case"top":return{node:r,newPos:{x:r.pos[0],y:s.top.pos[1]}};case"bottom":return{node:r,newPos:{x:r.pos[0],y:s.bottom.pos[1]+s.bottom.size[1]-r.size[1]}}}});for(const{node:r,newPos:l}of a)r.pos[0]=l.x,r.pos[1]=l.y;return a}p(alignNodes,"alignNodes");function resolveConnectingLinkColor(i){return i===LiteGraph.EVENT?LiteGraph.EVENT_LINK_COLOR:LiteGraph.CONNECTING_LINK_COLOR}p(resolveConnectingLinkColor,"resolveConnectingLinkColor");const cursors={NE:"nesw-resize",SE:"nwse-resize",SW:"nesw-resize",NW:"nwse-resize"},temp=new Rectangle,temp_vec2=[0,0],tmp_area=new Rectangle,margin_area=new Rectangle,link_bounding=new Rectangle;class LGraphCanvas{static{p(this,"LGraphCanvas")}static DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=";static DEFAULT_EVENT_LINK_COLOR="#A86";static link_type_colors={"-1":LGraphCanvas.DEFAULT_EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"};static gradients={};static search_limit=-1;static node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}};static _measureText;state={draggingItems:!1,draggingCanvas:!1,readOnly:!1,hoveringOver:CanvasItem.Nothing,shouldSetCursor:!0,selectionChanged:!1};#e;get subgraph(){return this.#e}set subgraph(o){o!==this.#e&&(this.#e=o,o&&this.dispatch("litegraph:set-graph",{oldGraph:this.#e,newGraph:o}))}fpsInfoLocation;dispatch(o,n){const s=new CustomEvent(o,{detail:n,bubbles:!0});return this.canvas.dispatchEvent(s)}dispatchEvent(o,n){this.canvas.dispatchEvent(new CustomEvent(o,{detail:n}))}#t(){if(!this.state.shouldSetCursor)return;const o=CanvasItem.Node|CanvasItem.RerouteSlot|CanvasItem.SubgraphIoNode|CanvasItem.SubgraphIoSlot;let n="default";this.state.draggingCanvas?n="grabbing":this.state.readOnly?n="grab":this.pointer.resizeDirection?n=cursors[this.pointer.resizeDirection]??cursors.SE:this.state.hoveringOver&o?n="crosshair":this.state.hoveringOver&CanvasItem.Reroute&&(n="grab"),this.canvas.style.cursor=n}_previously_dragging_canvas=null;get read_only(){return this.state.readOnly}set read_only(o){this.state.readOnly=o,this.#t()}get isDragging(){return this.state.draggingItems}set isDragging(o){this.state.draggingItems=o}get hoveringOver(){return this.state.hoveringOver}set hoveringOver(o){this.state.hoveringOver=o,this.#t()}get pointer_is_down(){return this.pointer.isDown}get pointer_is_double(){return this.pointer.isDouble}get dragging_canvas(){return this.state.draggingCanvas}set dragging_canvas(o){this.state.draggingCanvas=o,this.#t()}get title_text_font(){return`${LiteGraph.NODE_TEXT_SIZE}px ${LiteGraph.NODE_FONT}`}get inner_text_font(){return`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px ${LiteGraph.NODE_FONT}`}#o=0;get maximumFps(){return this.#o>Number.EPSILON?this.#o/1e3:0}set maximumFps(o){this.#o=o>Number.EPSILON?1e3/o:0}get round_radius(){return LiteGraph.ROUND_RADIUS}set round_radius(o){LiteGraph.ROUND_RADIUS=o}_lowQualityZoomThreshold=0;_isLowQuality=!1;updateLowQualityThreshold(){if(this._min_font_size_for_lod===0){this._lowQualityZoomThreshold=0,this._isLowQuality=!1;return}const o=LiteGraph.NODE_TEXT_SIZE,n=Math.sqrt(window.devicePixelRatio||1);this._lowQualityZoomThreshold=this._min_font_size_for_lod/(o*n),this._isLowQuality=this.ds.scale<this._lowQualityZoomThreshold}get low_quality(){return this._isLowQuality}options;background_image;ds;pointer;zoom_modify_alpha;zoom_speed;node_title_color;default_link_color;default_connection_color;default_connection_color_byType;default_connection_color_byTypeOff;colourGetter={getConnectedColor:p(o=>this.default_connection_color_byType[o]||this.default_connection_color.output_on,"getConnectedColor"),getDisconnectedColor:p(o=>this.default_connection_color_byTypeOff[o]||this.default_connection_color_byType[o]||this.default_connection_color.output_off,"getDisconnectedColor")};highquality_render;use_gradients;editor_alpha;pause_rendering;clear_background;clear_background_color;render_only_selected;show_info;allow_dragcanvas;allow_dragnodes;allow_interaction;multi_select;allow_searchbox;allow_reconnect_links;align_to_grid;drag_mode;dragging_rectangle;filter;set_canvas_dirty_on_mouse_event;always_render_background;render_shadows;render_canvas_border;render_connections_shadows;render_connections_border;render_curved_connections;render_connection_arrows;render_collapsed_slots;render_execution_order;render_link_tooltip;linkMarkerShape=LinkMarkerShape.Circle;links_render_mode;_min_font_size_for_lod=8;get min_font_size_for_lod(){return this._min_font_size_for_lod}set min_font_size_for_lod(o){this._min_font_size_for_lod!==o&&(this._min_font_size_for_lod=o,this.updateLowQualityThreshold())}mouse;graph_mouse;canvas_mouse;onSearchBox;onSearchBoxSelection;onMouse;onDrawBackground;onDrawForeground;connections_width;current_node;node_widget;over_link_center;last_mouse_position;visible_area;renderedPaths=new Set;visible_links=[];connecting_links;linkConnector=new LinkConnector(o=>this.connecting_links=o);viewport;autoresize;static active_canvas;frame=0;last_draw_time=0;render_time=0;fps=0;selected_nodes={};selectedItems=new Set;resizingGroup=null;selected_group=null;visible_nodes=[];#n=new Set;node_over;node_capturing_input;highlighted_links={};#s=new Set;dirty_canvas=!0;dirty_bgcanvas=!0;dirty_nodes=new Map;dirty_area;node_in_panel;last_mouse=[0,0];last_mouseclick=0;graph;get _graph(){if(!this.graph)throw new NullGraphError;return this.graph}canvas;bgcanvas;ctx;_events_binded;bgctx;is_rendering;block_click;last_click_position;resizing_node;selected_group_resizing;last_mouse_dragging;onMouseDown;_highlight_pos;_highlight_input;node_panel;options_panel;_bg_img;_pattern;_pattern_img;bg_tint;prompt_box;search_box;SELECTED_NODE;NODEPANEL_IS_OPEN;#i;#c=!1;linkRenderer=null;dragZoomEnabled=!1;#l=null;static active_node;onClear;onNodeMoved;onSelectionChange;onDrawLinkTooltip;onDrawOverlay;onRenderBackground;onNodeDblClicked;onShowNodePanel;onNodeSelected;onNodeDeselected;onRender;constructor(o,n,s){s||={},this.options=s,this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,this.ds=new DragAndScale(o),this.pointer=new CanvasPointer(o),this.ds.onChanged=(a,r)=>{this._lowQualityZoomThreshold>0&&(this._isLowQuality=a<this._lowQualityZoomThreshold)},n&&(this.linkRenderer=new LitegraphLinkAdapter(!1)),this.linkConnector.events.addEventListener("link-created",()=>this.#a()),this.linkConnector.events.addEventListener("reset",()=>{this.connecting_links=null,this.dirty_bgcanvas=!0}),this.linkConnector.events.addEventListener("dropped-on-canvas",a=>{if(!this.connecting_links)return;const r=a.detail;this.emitEvent({subType:"empty-release",originalEvent:r,linkReleaseContext:{links:this.connecting_links}});const l=this.linkConnector.renderLinks[0];if(LiteGraph.release_link_on_empty_shows_menu){const u=this.linkConnector.state.connectingTo==="input"?{node_from:l.node,slot_from:l.fromSlot,type_filter_in:l.fromSlot.type}:{node_to:l.node,slot_to:l.fromSlot,type_filter_out:l.fromSlot.type},m=l.fromReroute?.id;"shiftKey"in r&&r.shiftKey?this.allow_searchbox&&this.showSearchBox(r,u):this.linkConnector.state.connectingTo==="input"?this.showConnectionMenu({nodeFrom:l.node,slotFrom:l.fromSlot,e:r,afterRerouteId:m}):this.showConnectionMenu({nodeTo:l.node,slotTo:l.fromSlot,e:r,afterRerouteId:m})}}),this.zoom_modify_alpha=!0,this.zoom_speed=1.1,this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.render_only_selected=!0,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.allow_reconnect_links=!0,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_link_tooltip=!0,this.links_render_mode=LinkRenderType.SPLINE_LINK,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.connections_width=3,this.current_node=null,this.node_widget=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.connecting_links=null,this.viewport=s.viewport||null,this.graph=n,n?.attachCanvas(this),this.canvas=void 0,this.bgcanvas=void 0,this.ctx=void 0,this.setCanvas(o,s.skip_events),this.clear(),LGraphCanvas._measureText=(a,r=this.inner_text_font)=>{const{ctx:l}=this,{font:u}=l;try{return l.font=r,l.measureText(a).width}finally{l.font=u}},s.skip_render||this.startRendering(),this.autoresize=s.autoresize,this.updateLowQualityThreshold()}static onGroupAdd(o,n,s){const a=LGraphCanvas.active_canvas,r=new LiteGraph.LGraphGroup;if(r.pos=a.convertEventToCanvasOffset(s),!a.graph)throw new NullGraphError;a.graph.add(r)}static getBoundaryNodes(o){const n=Array.isArray(o)?o:Object.values(o);return getBoundaryNodes(n)??{top:null,right:null,bottom:null,left:null}}static alignNodes(o,n,s){const a=alignNodes(Object.values(o),n,s);LGraphCanvas.active_canvas.repositionNodesVueMode(a),LGraphCanvas.active_canvas.setDirty(!0,!0)}static onNodeAlign(o,n,s,a,r){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:l,parentMenu:a});function l(u){const m=alignNodes(Object.values(LGraphCanvas.active_canvas.selected_nodes),u.toLowerCase(),r);LGraphCanvas.active_canvas.repositionNodesVueMode(m),LGraphCanvas.active_canvas.setDirty(!0,!0)}p(l,"inner_clicked")}static onGroupAlign(o,n,s,a){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:r,parentMenu:a});function r(l){const u=alignNodes(Object.values(LGraphCanvas.active_canvas.selected_nodes),l.toLowerCase());LGraphCanvas.active_canvas.repositionNodesVueMode(u),LGraphCanvas.active_canvas.setDirty(!0,!0)}p(r,"inner_clicked")}static createDistributeMenu(o,n,s,a){new LiteGraph.ContextMenu(["Vertically","Horizontally"],{event:s,callback:r,parentMenu:a});function r(l){const u=LGraphCanvas.active_canvas,m=distributeNodes(Object.values(u.selected_nodes),l==="Horizontally");u.repositionNodesVueMode(m),u.setDirty(!0,!0)}p(r,"inner_clicked")}static onMenuAdd(o,n,s,a,r){const l=LGraphCanvas.active_canvas,u=l.getCanvasWindow(),{graph:m}=l;if(!m)return;return f("",a),!1;function f(_,y){if(!m)return;const b=LiteGraph.getNodeTypesCategories(l.filter||m.filter).filter(S=>S.startsWith(_)),w=[];for(const S of b){if(!S)continue;const C=new RegExp(`^(${_})`),I=S.replace(C,"").split("/",1)[0],T=_===""?`${I}/`:`${_}${I}/`;let E=I;E.includes("::")&&(E=E.split("::",2)[1]),w.findIndex(L=>L.value===T)===-1&&w.push({value:T,content:E,has_submenu:!0,callback:p(function(L,A,D,O){f(L.value,O)},"callback")})}const k=LiteGraph.getNodeTypesInCategory(_.slice(0,-1),l.filter||m.filter);for(const S of k){if(S.skip_list)continue;const C={value:S.type,content:S.title,has_submenu:!1,callback:p(function(I,T,E,N){if(!l.graph)throw new NullGraphError;const L=N.getFirstEvent();l.graph.beforeChange();const A=LiteGraph.createNode(I.value);if(A){if(!L)throw new TypeError("Context menu event was null. This should not occur in normal usage.");A.pos=l.convertEventToCanvasOffset(L),l.graph.add(A)}else console.warn("Failed to create node of type:",I.value);r?.(A),l.graph.afterChange()},"callback")};w.push(C)}new LiteGraph.ContextMenu(w,{event:s,parentMenu:y},u)}p(f,"inner_onMenuAdded")}static onMenuCollapseAll(){}static onMenuNodeEdit(){}static showMenuNodeOptionalOutputs(o,n,s,a,r){if(!r)return;const l=LGraphCanvas.active_canvas;let u=[];LiteGraph.do_add_triggers_slots&&r.findOutputSlot("onExecuted")==-1&&u.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0}],className:"event"});const m=r.onMenuNodeOutputs?.(u);if(m&&(u=m),!u.length)return;new LiteGraph.ContextMenu(u,{event:s,callback:f,parentMenu:a,node:r});function f(_,y,b){if(!r||(_.callback&&_.callback.call(this,r,_,y,b),!_.value))return;const w=_.value[1];if(w&&(typeof w=="object"||Array.isArray(w))){const S=[];for(const C in w)S.push({content:C,value:w[C]});return new LiteGraph.ContextMenu(S,{event:y,callback:f,parentMenu:a,node:r}),!1}const{graph:k}=r;if(!k)throw new NullGraphError;k.beforeChange(),r.addOutput(_.value[0],_.value[1],_.value[2]),r.onNodeOutputAdd?.(_.value),l.setDirty(!0,!0),k.afterChange()}return p(f,"inner_clicked"),!1}static onShowMenuNodeProperties(o,n,s,a,r){if(!r||!r.properties)return;const l=LGraphCanvas.active_canvas,u=l.getCanvasWindow(),m=[];for(const _ in r.properties){o=r.properties[_]!==void 0?r.properties[_]:" ",typeof o=="object"&&(o=JSON.stringify(o));const y=r.getPropertyInfo(_);(y.type=="enum"||y.type=="combo")&&(o=LGraphCanvas.getPropertyPrintableValue(o,y.values)),o=LGraphCanvas.decodeHTML(toString(o)),m.push({content:`<span class='property_name'>${y.label||_}</span><span class='property_value'>${o}</span>`,value:_})}if(!m.length)return;new LiteGraph.ContextMenu(m,{event:s,callback:f,parentMenu:a,allow_html:!0,node:r},u);function f(_){if(!r)return;const y=this.getBoundingClientRect();l.showEditPropertyValue(r,_.value,{position:[y.left,y.top]})}return p(f,"inner_clicked"),!1}static decodeHTML(o){const n=document.createElement("div");return n.textContent=o,n.innerHTML}static onMenuResizeNode(o,n,s,a,r){if(!r)return;const l=p(function(m){m.setSize(m.computeSize())},"fApplyMultiNode"),u=LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)l(r);else for(const m in u.selected_nodes)l(u.selected_nodes[m]);u.setDirty(!0,!0)}static onShowPropertyEditor(o,n,s,a,r){const l=o.property||"title",u=r[l],m=document.createElement("span");m.className="name",m.textContent=l;const f=document.createElement("input");Object.assign(f,{type:"text",className:"value",autofocus:!0});const _=document.createElement("button");_.textContent="OK";const y=Object.assign(document.createElement("div"),{is_modified:!1,className:"graphdialog",close:p(()=>y.remove(),"close")});y.append(m,f,_),f.value=String(u),f.addEventListener("blur",function(){this.focus()}),f.addEventListener("keydown",N=>{if(y.is_modified=!0,N.key=="Escape")y.close();else if(N.key=="Enter")T();else if(!N.target||!("localName"in N.target)||N.target.localName!="textarea")return;N.preventDefault(),N.stopPropagation()});const b=LGraphCanvas.active_canvas,w=b.canvas,k=w.getBoundingClientRect(),S=k?-20-k.left:-20,C=k?-20-k.top:-20;if(s?(y.style.left=`${s.clientX+S}px`,y.style.top=`${s.clientY+C}px`):(y.style.left=`${w.width*.5+S}px`,y.style.top=`${w.height*.5+C}px`),_.addEventListener("click",T),w.parentNode==null)throw new TypeError("canvasEl.parentNode was null");w.parentNode.append(y),f.focus();let I;y.addEventListener("mouseleave",function(){LiteGraph.dialog_close_on_mouse_leave&&!y.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(I=setTimeout(y.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),y.addEventListener("mouseenter",function(){LiteGraph.dialog_close_on_mouse_leave&&I&&clearTimeout(I)});function T(){f&&E(f.value)}p(T,"inner");function E(N){o.type=="Number"?N=Number(N):o.type=="Boolean"&&(N=!!N),r[l]=N,y.remove(),b.setDirty(!0,!0)}p(E,"setValue")}static getPropertyPrintableValue(o,n){if(!n||Array.isArray(n))return String(o);if(typeof n=="object"){let s="";for(const a in n)if(n[a]==o){s=a;break}return`${String(o)} (${s})`}}static onMenuNodeCollapse(o,n,s,a,r){if(!r.graph)throw new NullGraphError;r.graph.beforeChange();const l=p(function(m){m.collapse()},"fApplyMultiNode"),u=LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)l(r);else for(const m in u.selected_nodes)l(u.selected_nodes[m]);r.graph.afterChange()}static onMenuToggleAdvanced(o,n,s,a,r){if(!r.graph)throw new NullGraphError;r.graph.beforeChange();const l=p(function(m){m.toggleAdvanced()},"fApplyMultiNode"),u=LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)l(r);else for(const m in u.selected_nodes)l(u.selected_nodes[m]);r.graph.afterChange()}static onMenuNodeMode(o,n,s,a,r){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:s,callback:l,parentMenu:a,node:r});function l(u){if(!r)return;const m=Object.values(LiteGraph.NODE_MODES).indexOf(u),f=p(function(y){m!==-1&&LiteGraph.NODE_MODES[m]?y.changeMode(m):(console.warn(`unexpected mode: ${u}`),y.changeMode(LGraphEventMode.ALWAYS))},"fApplyMultiNode"),_=LGraphCanvas.active_canvas;if(!_.selected_nodes||Object.keys(_.selected_nodes).length<=1)f(r);else for(const y in _.selected_nodes)f(_.selected_nodes[y])}return p(l,"inner_clicked"),!1}static onMenuNodeColors(o,n,s,a,r){if(!r)throw"no node for color";const l=[];l.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(const m in LGraphCanvas.node_colors){const f=LGraphCanvas.node_colors[m];o={value:m,content:`<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid ${f.color}; background-color:${f.bgcolor}'>${m}</span>`},l.push(o)}new LiteGraph.ContextMenu(l,{event:s,callback:u,parentMenu:a,node:r});function u(m){if(!r)return;const f=p(function(y){const b=m.value?LGraphCanvas.node_colors[m.value]:null;y.setColorOption(b)},"fApplyColor"),_=LGraphCanvas.active_canvas;if(!_.selected_nodes||Object.keys(_.selected_nodes).length<=1)f(r);else for(const y in _.selected_nodes)f(_.selected_nodes[y]);_.setDirty(!0,!0)}return p(u,"inner_clicked"),!1}static onMenuNodeShapes(o,n,s,a,r){if(!r)throw"no node passed";new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:s,callback:l,parentMenu:a,node:r});function l(u){if(!r)return;if(!r.graph)throw new NullGraphError;r.graph.beforeChange();const m=p(function(_){_.shape=u},"fApplyMultiNode"),f=LGraphCanvas.active_canvas;if(!f.selected_nodes||Object.keys(f.selected_nodes).length<=1)m(r);else for(const _ in f.selected_nodes)m(f.selected_nodes[_]);r.graph.afterChange(),f.setDirty(!0)}return p(l,"inner_clicked"),!1}static onMenuNodeRemove(){LGraphCanvas.active_canvas.deleteSelected()}static onMenuNodeClone(o,n,s,a,r){const l=LGraphCanvas.active_canvas,u=l.selectedItems.size?[...l.selectedItems]:[r];u.length&&LGraphCanvas.cloneNodes(u)}static cloneNodes(o){const n=LGraphCanvas.active_canvas;let s=1/0,a=1/0;for(const r of o){if(r.pos==null)throw new TypeError("Invalid node encountered on clone.  `pos` was null.");s=Math.min(s,r.pos[0]),a=Math.min(a,r.pos[1])}return n._deserializeItems(n._serializeItems(o),{position:[s+5,a+5]})}clear(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.selectedItems.clear(),this.state.selectionChanged=!0,this.onSelectionChange?.(this.selected_nodes),this.visible_nodes=[],this.node_over=void 0,this.node_capturing_input=null,this.connecting_links=null,this.highlighted_links={},this.dragging_canvas=!1,this.#a(),this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer.reset(),this.visible_area.set([0,0,0,0]),this.onClear?.()}setGraph(o){const{graph:n}=this;o!==n&&(this.clear(),o.attachCanvas(this),this.linkRenderer=new LitegraphLinkAdapter(!1),this.dispatch("litegraph:set-graph",{newGraph:o,oldGraph:n}),this.#a())}openSubgraph(o,n){const{graph:s}=this;if(!s)throw new NullGraphError;const a={bubbles:!0,detail:{subgraph:o,closingGraph:s,fromNode:n},cancelable:!0};this.canvas.dispatchEvent(new CustomEvent("subgraph-opening",a))&&(this.clear(),this.subgraph=o,this.setGraph(o),this.canvas.dispatchEvent(new CustomEvent("subgraph-opened",a)))}getCurrentGraph(){return this.graph}#f(o){if(typeof o=="string"){const n=document.getElementById(o);if(!(n instanceof HTMLCanvasElement))throw"Error validating LiteGraph canvas: Canvas element not found";return n}return o}setCanvas(o,n){const s=this.#f(o);if(s===this.canvas||(!s&&this.canvas&&!n&&this.unbindEvents(),this.canvas=s,this.ds.element=s,this.pointer.element=s,!s))return;s.className+=" lgraphcanvas",s.data=this,this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height;const a=s.getContext?.("2d");if(a==null)throw s.localName!="canvas"?`Element supplied for LGraphCanvas must be a <canvas> element, you passed a ${s.localName}`:"This browser doesn't support Canvas";this.ctx=a,n||this.bindEvents()}_doNothing(o){return o.preventDefault(),!1}_doReturnTrue(o){return o.preventDefault(),!0}bindEvents(){if(this._events_binded){console.warn("LGraphCanvas: events already bound");return}const{canvas:o}=this,{document:n}=this.getCanvasWindow();this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),this._mouseout_callback=this.processMouseOut.bind(this),this._mousecancel_callback=this.processMouseCancel.bind(this),o.addEventListener("pointerdown",this._mousedown_callback,!0),o.addEventListener("wheel",this._mousewheel_callback,!1),o.addEventListener("pointerup",this._mouseup_callback,!0),o.addEventListener("pointermove",this._mousemove_callback),o.addEventListener("pointerout",this._mouseout_callback),o.addEventListener("pointercancel",this._mousecancel_callback,!0),o.addEventListener("contextmenu",this._doNothing),this._key_callback=this.processKey.bind(this),o.addEventListener("keydown",this._key_callback,!0),n.addEventListener("keyup",this._key_callback,!0),o.addEventListener("dragover",this._doNothing,!1),o.addEventListener("dragend",this._doNothing,!1),o.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0}unbindEvents(){if(!this._events_binded){console.warn("LGraphCanvas: no events bound");return}const{document:o}=this.getCanvasWindow(),{canvas:n}=this;n.removeEventListener("pointercancel",this._mousecancel_callback),n.removeEventListener("pointerout",this._mouseout_callback),n.removeEventListener("pointermove",this._mousemove_callback),n.removeEventListener("pointerup",this._mouseup_callback),n.removeEventListener("pointerdown",this._mousedown_callback),n.removeEventListener("wheel",this._mousewheel_callback),n.removeEventListener("keydown",this._key_callback),o.removeEventListener("keyup",this._key_callback),n.removeEventListener("contextmenu",this._doNothing),n.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=void 0,this._mousewheel_callback=void 0,this._key_callback=void 0,this._events_binded=!1}setDirty(o,n){o&&(this.dirty_canvas=!0),n&&(this.dirty_bgcanvas=!0)}#a(){this.dirty_canvas=!0,this.dirty_bgcanvas=!0}#r(){const{graph:o,linkConnector:n,pointer:s}=this;if(!o)throw new NullGraphError;s.onDragEnd=a=>n.dropLinks(o,a),s.finally=()=>this.linkConnector.reset(!0)}getCanvasWindow(){if(!this.canvas)return window;const o=this.canvas.ownerDocument;return o.defaultView||o.parentWindow}startRendering(){if(this.is_rendering)return;this.is_rendering=!0,o.call(this);function o(){this.pause_rendering||this.draw();const n=this.getCanvasWindow();if(this.is_rendering)if(this.#o>0){const s=this.#o-(LiteGraph.getTime()-this.last_draw_time);setTimeout(o.bind(this),Math.max(1,s))}else n.requestAnimationFrame(o.bind(this))}p(o,"renderFrame")}stopRendering(){this.is_rendering=!1}blockClick(){this.block_click=!0,this.last_mouseclick=0}getWidgetAtCursor(o){return o??=this.node_over,o?.getWidgetOnPos(this.graph_mouse[0],this.graph_mouse[1],!0)}updateMouseOverNodes(o,n){if(!this.graph)throw new NullGraphError;const{pointer:s}=this,a=this.graph._nodes;for(const r of a)r.mouseOver&&o!=r&&(s.eDown||(s.resizeDirection=void 0),r.mouseOver=void 0,this._highlight_input=void 0,this._highlight_pos=void 0,this.linkConnector.overWidget=void 0,r.lostFocusAt=LiteGraph.getTime(),this.node_over?.onMouseLeave?.(n),this.node_over=void 0,this.dirty_canvas=!0)}processMouseDown(o){if(this.dragZoomEnabled&&o.ctrlKey&&o.shiftKey&&!o.altKey&&o.buttons){this.#l={pos:[o.x,o.y],scale:this.ds.scale,readOnly:this.read_only},this.read_only=!0;return}const{graph:n,pointer:s}=this;if(this.adjustMouseEvent(o),o.isPrimary&&s.down(o),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!n)return;const a=this.getCanvasWindow();LGraphCanvas.active_canvas=this;const r=o.clientX,l=o.clientY;if(this.ds.viewport=this.viewport,!(!this.viewport||isInRect(r,l,this.viewport)))return;const m=n.getNodeOnPos(o.canvasX,o.canvasY,this.visible_nodes)??void 0;if(this.mouse[0]=r,this.mouse[1]=l,this.graph_mouse[0]=o.canvasX,this.graph_mouse[1]=o.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],s.isDouble=s.isDown&&o.isPrimary,s.isDown=!0,this.canvas.focus(),LiteGraph.closeAllContextMenus(a),this.onMouse?.(o)!=!0){if(o.button===0&&!s.isDouble)this.#g(o,m);else if(o.button===1)this.#_(o,m);else if((o.button===2||s.isDouble)&&this.allow_interaction&&!this.read_only){const{linkConnector:f,subgraph:_}=this;if(_?.inputNode.containsPoint(this.graph_mouse))this.processSelect(_.inputNode,o,!0),_.inputNode.onPointerDown(o,s,f);else if(_?.outputNode.containsPoint(this.graph_mouse))this.processSelect(_.outputNode,o,!0),_.outputNode.onPointerDown(o,s,f);else{if(m)this.processSelect(m,o,!0);else if(this.links_render_mode!==LinkRenderType.HIDDEN_LINK){const y=layoutStore.queryRerouteAtPoint({x:o.canvasX,y:o.canvasY});let b;y?b=n.getReroute(y.id):b=n.getRerouteOnPos(o.canvasX,o.canvasY,this.#s),b&&(o.altKey?s.onClick=w=>{w.altKey&&(b.selected&&(this.deselect(b),this.onSelectionChange?.(this.selected_nodes)),b.remove())}:this.processSelect(b,o,!0))}s.onClick??=()=>this.processContextMenu(m,o)}}this.last_mouse=[r,l],this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,n.change(),(!a.document.activeElement||a.document.activeElement.nodeName.toLowerCase()!="input"&&a.document.activeElement.nodeName.toLowerCase()!="textarea")&&o.preventDefault(),o.stopPropagation(),this.onMouseDown?.(o)}}#d(o,n){const s=this.subgraph?.getIoNodeOnPos(o,n);if(s)return s;for(const a of this.#s)if(a.containsPoint([o,n]))return a;return this.graph?.getGroupTitlebarOnPos(o,n)}#g(o,n){const{pointer:s,graph:a,linkConnector:r,subgraph:l}=this;if(!a)throw new NullGraphError;const u=o.canvasX,m=o.canvasY,f=o.ctrlKey||o.metaKey;if(f&&!o.altKey&&LiteGraph.leftMouseClickBehavior==="panning"){this.#u(o,s,n);return}if(this.read_only){s.finally=()=>this.dragging_canvas=!1,this.dragging_canvas=!0;return}if(!LiteGraph.vueNodesMode&&LiteGraph.alt_drag_do_clone_nodes&&o.altKey&&!o.ctrlKey&&n&&this.allow_interaction){const y=this._deserializeItems(this._serializeItems([n]),{position:n.pos})?.created[0];if(!y)return;y.pos[0]+=5,y.pos[1]+=5,this.allow_dragnodes&&(s.onDragStart=b=>{this.#m(y,b)},s.onDragEnd=b=>this.#h(b));return}if(n&&(this.allow_interaction||n.flags.allow_interaction))this.#p(o,f,n);else{if(l){let k=p(function(I,T){return T.containsPoint([u,m])?(T.onPointerDown(o,s,r),s.onClick??=()=>I.processSelect(T,o),s.onDragStart??=()=>I.#m(T,s,!0),s.onDragEnd??=E=>I.#h(E),!0):!1},"processSubgraphIONode");const{inputNode:S,outputNode:C}=l;if(k(this,S)||k(this,C))return}if(this.links_render_mode!==LinkRenderType.HIDDEN_LINK){const k=layoutStore.queryRerouteAtPoint({x:u,y:m});let S;k&&(S=a.getReroute(k.id));for(const C of this.#s){const I=S===C||C.containsPoint([u,m]);if(!(!C.isSlotHovered&&!I)){I&&(s.onClick=()=>this.processSelect(C,o),o.shiftKey||(s.onDragStart=T=>this.#m(C,T,!0),s.onDragEnd=T=>this.#h(T))),(C.isOutputHovered||I&&o.shiftKey)&&(r.dragFromReroute(a,C),this.#r()),C.isInputHovered&&(r.dragFromRerouteToOutput(a,C),this.#r()),C.hideSlots(),this.dirty_bgcanvas=!0;return}}}const{lineWidth:_}=this.ctx;this.ctx.lineWidth=this.connections_width+7;const y=Math.max(window?.devicePixelRatio??1,1),b=layoutStore.queryLinkSegmentAtPoint({x:u,y:m},this.ctx);for(const k of this.renderedPaths){const S=k._pos;if(!S)continue;let C=b&&k.id===(k instanceof Reroute?b.rerouteId:b.linkId);if(!C&&k.path&&(C=this.ctx.isPointInStroke(k.path,u*y,m*y)),(o.shiftKey||o.altKey)&&C){if(this.ctx.lineWidth=_,o.shiftKey&&!o.altKey){r.dragFromLinkSegment(a,k),this.#r();return}else if(o.altKey&&!o.shiftKey){const I=a.createReroute([u,m],k);s.onDragStart=T=>this.#m(I,T),s.onDragEnd=T=>this.#h(T);return}}else if(this.linkMarkerShape!==LinkMarkerShape.None&&isInRectangle(u,m,S[0]-4,S[1]-4,8,8)){this.ctx.lineWidth=_,s.onClick=()=>this.showLinkMenu(k,o),s.onDragStart=()=>this.dragging_canvas=!0,s.finally=()=>this.dragging_canvas=!1,this.over_link_center=void 0;return}}this.ctx.lineWidth=_;const w=a.getGroupOnPos(u,m);if(this.selected_group=w??null,w){if(w.isInResize(u,m)){const k=w.boundingRect,S=u-(k[0]+k[2]),C=m-(k[1]+k[3]);s.onDragStart=()=>this.resizingGroup=w,s.onDrag=I=>{if(this.read_only)return;const T=[I.canvasX-w.pos[0]-S,I.canvasY-w.pos[1]-C];this.#i&&snapPoint(T,this.#i),w.resize(T[0],T[1])&&(this.dirty_bgcanvas=!0)},s.finally=()=>this.resizingGroup=null}else{const S=(w.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE)*1.4;isInRectangle(u,m,w.pos[0],w.pos[1],w.size[0],S)&&(s.onClick=()=>this.processSelect(w,o),s.onDragStart=C=>{w.recomputeInsideNodes(),this.#m(w,C,!0)},s.onDragEnd=C=>this.#h(C))}s.onDoubleClick=()=>{this.emitEvent({subType:"group-double-click",originalEvent:o,group:w})}}else s.onDoubleClick=()=>{this.allow_searchbox&&(this.showSearchBox(o),o.preventDefault()),this.emitEvent({subType:"empty-double-click",originalEvent:o})}}!s.onDragStart&&!s.onClick&&!s.onDrag&&this.allow_dragcanvas&&(LiteGraph.leftMouseClickBehavior==="panning"||this.read_only?(s.onClick=()=>this.processSelect(null,o),s.finally=()=>this.dragging_canvas=!1,this.dragging_canvas=!0):this.#u(o,s))}#u(o,n,s){const a=[0,0,0,0];a[0]=o.canvasX,a[1]=o.canvasY,a[2]=1,a[3]=1,n.onClick=r=>{const l=s??this.#d(r.canvasX,r.canvasY);this.processSelect(l,r)},n.onDragStart=()=>this.dragging_rectangle=a,n.onDragEnd=r=>this.#S(r,a),n.finally=()=>this.dragging_rectangle=null}#p(o,n,s){if(LiteGraph.vueNodesMode)return;const{pointer:a,graph:r,linkConnector:l}=this;if(!r)throw new NullGraphError;const u=o.canvasX,m=o.canvasY;a.onClick=()=>this.processSelect(s,o),s.flags.pinned||this.bringToFront(s);const f=s.isPointInCollapse(u,m);if(f)a.onClick=()=>{s.collapse(),this.setDirty(!0,!0)};else if(!s.flags.collapsed){let b=p(function(S,C){return[...S.links??[],...S._floatingLinks??new Set].some(T=>typeof T=="number"&&C.getLink(T)!==void 0)},"hasRelevantOutputLinks");const{inputs:w,outputs:k}=s;if(k)for(const[S,C]of k.entries()){const I=s.getOutputPos(S);if(isInRectangle(u,m,I[0]-15,I[1]-10,30,20)){if(o.shiftKey&&b(C,r)){l.moveOutputLink(r,C),this.#r();return}l.dragNewFromOutput(r,s,C),this.#r(),LiteGraph.shift_click_do_break_link_from?o.shiftKey&&s.disconnectOutput(S):LiteGraph.ctrl_alt_click_do_break_link&&n&&o.altKey&&!o.shiftKey&&s.disconnectOutput(S),a.onDoubleClick=()=>s.onOutputDblClick?.(S,o),a.onClick=()=>s.onOutputClick?.(S,o);return}}if(w)for(const[S,C]of w.entries()){const I=s.getInputPos(S);if(C instanceof NodeInputSlot?isInRect(u,m,C.boundingRect):isInRectangle(u,m,I[0]-15,I[1]-10,30,20)){a.onDoubleClick=()=>s.onInputDblClick?.(S,o),a.onClick=()=>s.onInputClick?.(S,o);const E=LiteGraph.ctrl_alt_click_do_break_link&&n&&o.altKey&&!o.shiftKey;(C.link!==null||C._floatingLinks?.size)&&(E||LiteGraph.click_do_break_link_to?s.disconnectInput(S,!0):(o.shiftKey||this.allow_reconnect_links)&&l.moveInputLink(r,C)),l.isConnecting||l.dragNewFromInput(r,s,C),this.#r(),this.dirty_bgcanvas=!0;return}}}const _=[u-s.pos[0],m-s.pos[1]],y=s.getWidgetOnPos(u,m);if(y)this.processWidgetClick(o,s,y),this.node_widget=[s,y];else{if(a.onDoubleClick=()=>{_[1]<0&&!f?s.onNodeTitleDblClick?.(o,_,this):s instanceof SubgraphNode&&this.openSubgraph(s.subgraph,s),s.onDblClick?.(o,_,this),this.emitEvent({subType:"node-double-click",originalEvent:o,node:s}),this.processNodeDblClicked(s)},s.title_buttons?.length&&!s.flags.collapsed){const b=_[0],w=_[1];for(let k=0;k<s.title_buttons.length;k++){const S=s.title_buttons[k];if(S.visible&&S.isPointInside(b,w)){s.onTitleButtonClick(S,this),a.onClick=()=>{};return}}}if(s.onMouseDown?.(o,_,this)){a.onClick=()=>{};return}if(!this.allow_dragnodes)return;if(!s.flags.collapsed){const b=s.findResizeDirection(u,m);if(b){a.resizeDirection=b;const w=new Rectangle(s.pos[0],s.pos[1],s.size[0],s.size[1]);a.onDragStart=()=>{r.beforeChange(),this.resizing_node=s},a.onDrag=k=>{if(this.read_only)return;const S=k.canvasX-u,C=k.canvasY-m,I=new Rectangle(w.x,w.y,w.width,w.height);switch(b){case"NE":I.y=w.y+C,I.width=w.width+S,I.height=w.height-C;break;case"SE":I.width=w.width+S,I.height=w.height+C;break;case"SW":I.x=w.x+S,I.width=w.width-S,I.height=w.height+C;break;case"NW":I.x=w.x+S,I.y=w.y+C,I.width=w.width-S,I.height=w.height-C;break}if(this.#i){if(b.includes("N")||b.includes("W")){const E=I.x,N=I.y;snapPoint(I.pos,this.#i),b.includes("N")&&(I.height+=N-I.y),b.includes("W")&&(I.width+=E-I.x)}snapPoint(I.size,this.#i)}const T=s.computeSize();I.width<T[0]&&(b.includes("W")&&(I.x=w.x+w.width-T[0]),I.width=T[0]),I.height<T[1]&&(b.includes("N")&&(I.y=w.y+w.height-T[1]),I.height=T[1]),s.pos=I.pos,s.setSize(I.size),this.#a()},a.onDragEnd=()=>{this.#a(),r.afterChange(s)},a.finally=()=>{this.resizing_node=null,a.resizeDirection=void 0},this.canvas.style.cursor=cursors[b];return}}a.onDragStart=b=>this.#m(s,b,!0),a.onDragEnd=b=>this.#h(b)}this.dirty_canvas=!0}processWidgetClick(o,n,s,a=this.pointer){if(typeof s.onPointerDown=="function"&&s.onPointerDown(a,n,this))return;const r=s.value,l=this.graph_mouse,u=l[0]-n.pos[0],m=l[1]-n.pos[1],f=toConcreteWidget(s,n,!1);if(f)a.onClick=()=>f.onClick({e:o,node:n,canvas:this}),a.onDrag=_=>f.onDrag?.({e:_,node:n,canvas:this});else if(s.mouse){const _=s.mouse(o,[u,m],n);_!=null&&(this.dirty_canvas=_)}if(r!=s.value){if(n.onWidgetChanged?.(s.name,s.value,r,s),!n.graph)throw new NullGraphError;n.graph._version++}a.finally=()=>{if(s.mouse){const{eUp:_}=a;if(!_)return;const{canvasX:y,canvasY:b}=_;s.mouse(_,[y-n.pos[0],b-n.pos[1]],n)}this.node_widget=null}}#_(o,n){const{pointer:s}=this;if(LiteGraph.middle_click_slot_add_default_node&&n&&this.allow_interaction&&!this.read_only&&!this.connecting_links&&!n.flags.collapsed){let a=!1,r=!1,l=!1;const{inputs:u,outputs:m}=n;if(m)for(const[f,_]of m.entries()){const y=n.getOutputPos(f);if(isInRectangle(o.canvasX,o.canvasY,y[0]-15,y[1]-10,30,20)){a=_,r=f,l=!0;break}}if(u)for(const[f,_]of u.entries()){const y=n.getInputPos(f);if(isInRectangle(o.canvasX,o.canvasY,y[0]-15,y[1]-10,30,20)){a=_,r=f,l=!1;break}}if(a&&r!==!1){const f=.5-(r+1)/(l?m.length:u.length),_=n.getBounding(),y=[l?_[0]+_[2]:_[0],o.canvasY-80];s.onClick=()=>this.createDefaultNodeForSlot({nodeFrom:l?n:null,slotFrom:l?r:null,nodeTo:l?null:n,slotTo:l?null:r,position:y,nodeType:"AUTO",posAdd:[l?30:-30,-f*130],posSizeFix:[l?0:-1,0]})}}this.allow_dragcanvas&&(s.onDragStart=()=>this.dragging_canvas=!0,s.finally=()=>this.dragging_canvas=!1)}#b(o){if(!o.buttons){this.#v();return}const n=this.#l;if(!n)throw new TypeError("Drag-zoom state object was null");if(!this.graph)throw new NullGraphError;const s=o.y-n.pos[1],r=n.scale-s/100;this.ds.changeScale(r,n.pos),this.graph.change()}#v(){const o=this.#l;o&&(this.#l=null,this.read_only=o.readOnly)}processMouseMove(o){if(this.dragZoomEnabled&&o.ctrlKey&&o.shiftKey&&this.#l){this.#b(o);return}this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0);const{graph:n,resizingGroup:s,linkConnector:a,pointer:r,subgraph:l}=this;if(!n)return;LGraphCanvas.active_canvas=this,this.adjustMouseEvent(o);const u=[o.clientX,o.clientY];this.mouse[0]=u[0],this.mouse[1]=u[1];const m=[u[0]-this.last_mouse[0],u[1]-this.last_mouse[1]];this.last_mouse=u;const{canvasX:f,canvasY:_}=o;this.graph_mouse[0]=f,this.graph_mouse[1]=_,o.isPrimary&&r.move(o);let y=CanvasItem.Nothing;if(l&&(y|=l.inputNode.onPointerMove(o),y|=l.outputNode.onPointerMove(o)),this.block_click){o.preventDefault();return}if(o.dragging=this.last_mouse_dragging,this.node_widget){const[k,S]=this.node_widget;if(S?.mouse){const C=f-k.pos[0],I=_-k.pos[1],T=S.mouse(o,[C,I],k);T!=null&&(this.dirty_canvas=T)}}const b=n.getNodeOnPos(f,_,this.visible_nodes),w=this.dragging_rectangle;if(w)w[2]=f-w[0],w[3]=_-w[1],this.dirty_canvas=!0;else if(s)y|=CanvasItem.Group,r.resizeDirection="SE";else if(this.dragging_canvas)this.ds.offset[0]+=m[0]/this.ds.scale,this.ds.offset[1]+=m[1]/this.ds.scale,this.#a();else if((this.allow_interaction||b?.flags.allow_interaction)&&!this.read_only){if(a.isConnecting&&(this.dirty_canvas=!0),this.updateMouseOverNodes(b,o),b){y|=CanvasItem.Node,b.redraw_on_mouse&&(this.dirty_canvas=!0);const k=[0,0];let S=-1,C=-1;const I=layoutStore.querySlotAtPoint({x:f,y:_});I&&I.nodeId===String(b.id)?I.type==="input"?(S=I.index,k[0]=I.position.x,k[1]=I.position.y):(C=I.index,k[0]=I.position.x,k[1]=I.position.y):(S=isOverNodeInput(b,f,_,k),C=isOverNodeOutput(b,f,_,k));const T=b.getWidgetOnPos(f,_,!0)??void 0;if(!b.mouseOver){b.mouseOver={},this.node_over=b,this.dirty_canvas=!0;for(const N of this.#s)N.hideSlots(),this.dirty_bgcanvas=!0;b.onMouseEnter?.(o)}b.onMouseMove?.(o,[f-b.pos[0],_-b.pos[1]],this);const{mouseOver:E}=b;if(E.inputId!==S||E.outputId!==C||E.overWidget!==T){if(E.inputId=S,E.outputId=C,E.overWidget=T,a.overWidget=void 0,a.isConnecting){const N=a.renderLinks.at(0);let L,A;if(!(!N||!a.isNodeValidDrop(b))){if(a.state.connectingTo==="input"){if(T){const D=b.getSlotFromWidget(T);if(D&&a.isInputValidDrop(b,D)){if(A=D,LiteGraph.vueNodesMode){const O=b.inputs.indexOf(D);L=O!==-1?getSlotPosition(b,O,!0):b.getInputSlotPos(D)}else L=b.getInputSlotPos(D);a.overWidget=T}}if(!a.overWidget){if(S===-1&&C===-1){const D=b.findInputByType(N.fromSlot.type);D&&(A=D.slot,L=LiteGraph.vueNodesMode?getSlotPosition(b,D.index,!0):b.getInputSlotPos(D.slot))}else S!=-1&&b.inputs[S]&&LiteGraph.isValidConnection(N.fromSlot.type,b.inputs[S].type)&&(L=k,A=b.inputs[S]);if(A){const D=b.getWidgetFromSlot(A);D&&(a.overWidget=D)}}}else if(a.state.connectingTo==="output")if(S===-1&&C===-1){const D=b.findOutputByType(N.fromSlot.type);D&&(L=LiteGraph.vueNodesMode?getSlotPosition(b,D.index,!1):b.getOutputPos(D.index))}else C!=-1&&b.outputs[C]&&LiteGraph.isValidConnection(N.fromSlot.type,b.outputs[C].type)&&(L=k)}this._highlight_pos=L,this._highlight_input=A}this.dirty_canvas=!0}r.eDown||(S===-1&&C===-1&&!T?r.resizeDirection=b.findResizeDirection(f,_):r.resizeDirection&&=void 0)}else{y=this.#k(y);const k=this.#C(o);if(this.over_link_center!==k&&(y|=CanvasItem.Link,this.over_link_center=k,this.dirty_bgcanvas=!0),this.canvas){const S=n.getGroupOnPos(f,_);S&&!o.ctrlKey&&!this.read_only&&S.isInResize(f,_)?r.resizeDirection="SE":r.resizeDirection&&=void 0}}if(this.node_capturing_input&&this.node_capturing_input!=b&&this.node_capturing_input.onMouseMove?.(o,[f-this.node_capturing_input.pos[0],_-this.node_capturing_input.pos[1]],this),this.isDragging){const k=this.selectedItems,S=o.ctrlKey?k:getAllNestedItems(k),C=m[0]/this.ds.scale,I=m[1]/this.ds.scale;if(LiteGraph.vueNodesMode)this.moveChildNodesInGroupVueMode(S,C,I);else for(const T of S)T.move(C,I,!0);this.#a()}}this.hoveringOver=y,o.preventDefault()}#k(o){const{graph:n,pointer:s,linkConnector:a}=this;if(!n)throw new NullGraphError;if(s.isDown){if(a.isConnecting){for(const r of this.#s)if(r.containsPoint(this.graph_mouse))return a.isRerouteValidDrop(r)&&(a.overReroute=r,this._highlight_pos=r.pos),o|=CanvasItem.RerouteSlot}}else{let r=!1;for(const l of this.#s)r||=l.updateVisibility(this.graph_mouse),l.isSlotHovered&&(o|=CanvasItem.RerouteSlot);r&&(this.dirty_bgcanvas=!0)}return this._highlight_pos&&=void 0,a.overReroute&&=void 0,o}#m(o,n,s=!1){this.emitBeforeChange(),this.graph?.beforeChange(),n.finally=()=>{this.isDragging=!1,this.graph?.afterChange(),this.emitAfterChange()},this.processSelect(o,n.eDown,s),this.isDragging=!0}#h(o){const{graph:n}=this;(o.shiftKey||LiteGraph.alwaysSnapToGrid)&&n?.snapToGrid(this.selectedItems),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.onNodeMoved?.(findFirstNode(this.selectedItems))}processMouseUp(o){if(o.isPrimary===!1)return;const{graph:n,pointer:s}=this;if(!n)return;this.#v(),LGraphCanvas.active_canvas=this,this.adjustMouseEvent(o);const a=LiteGraph.getTime();if(o.click_time=a-this.last_mouseclick,s.up(o)===!0){s.isDown=!1,s.isDouble=!1,this.connecting_links=null,this.dragging_canvas=!1,n.change(),o.stopPropagation(),o.preventDefault();return}if(this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&=!1,o.button===0){this.selected_group=null,this.isDragging=!1;const l=o.canvasX,u=o.canvasY;this.linkConnector.isConnecting||(this.dirty_canvas=!0,this.node_over?.onMouseUp?.(o,[l-this.node_over.pos[0],u-this.node_over.pos[1]],this),this.node_capturing_input?.onMouseUp?.(o,[l-this.node_capturing_input.pos[0],u-this.node_capturing_input.pos[1]]))}else o.button===1?(this.dirty_canvas=!0,this.dragging_canvas=!1):o.button===2&&(this.dirty_canvas=!0);s.isDown=!1,s.isDouble=!1,n.change(),o.stopPropagation(),o.preventDefault()}processMouseOut(o){this.adjustMouseEvent(o),this.updateMouseOverNodes(null,o)}processMouseCancel(){console.warn("Pointer cancel!"),this.pointer.reset()}processMouseWheel(o){if(!this.graph||!this.allow_dragcanvas)return;this.adjustMouseEvent(o);const n=[o.clientX,o.clientY];if(this.viewport&&!isPointInRect(n,this.viewport))return;let{scale:s}=this.ds;const a=this.pointer.isTrackpadGesture(o);if((o.ctrlKey||o.metaKey&&navigator.platform.includes("Mac"))&&!o.altKey&&!o.shiftKey||LiteGraph.mouseWheelScroll==="zoom")a?(s*=1+o.deltaY*(1-this.zoom_speed)*.18,this.ds.changeScale(s,[o.clientX,o.clientY],!1)):(o.deltaY<0?s*=this.zoom_speed:o.deltaY>0&&(s*=1/this.zoom_speed),this.ds.changeScale(s,[o.clientX,o.clientY]));else{const u=a?.18:.008333;!a&&o.shiftKey&&o.deltaX===0?this.ds.offset[0]-=o.deltaY*(1+u)*(1/s):(this.ds.offset[0]-=o.deltaX*(1+u)*(1/s),this.ds.offset[1]-=o.deltaY*(1+u)*(1/s))}this.graph.change(),o.preventDefault()}#w(){const o=new CustomEvent("litegraph:no-items-selected",{bubbles:!0});this.canvas.dispatchEvent(o)}processKey(o){this.#c=o.shiftKey;const{graph:n}=this;if(!n)return;let s=!1;if(o.target.localName!="input"){if(o.type=="keydown"){if(o.key===" ")this.read_only=!0,this._previously_dragging_canvas===null&&(this._previously_dragging_canvas=this.dragging_canvas),this.dragging_canvas=this.pointer.isDown,s=!0;else if(o.key==="Escape"){if(this.linkConnector.isConnecting){this.linkConnector.reset(),o.preventDefault();return}this.node_panel?.close(),this.options_panel?.close(),(this.node_panel||this.options_panel)&&(s=!0)}else if(o.keyCode===65&&o.ctrlKey)this.selectItems(),s=!0;else if(o.keyCode===67&&(o.metaKey||o.ctrlKey)&&!o.shiftKey)this.selected_nodes&&(this.copyToClipboard(),s=!0);else if(o.keyCode===86&&(o.metaKey||o.ctrlKey))this.pasteFromClipboard({connectInputs:o.shiftKey});else if((o.key==="Delete"||o.key==="Backspace")&&o.target.localName!="input"&&o.target.localName!="textarea"){if(this.selectedItems.size===0){this.#w();return}this.deleteSelected(),s=!0}for(const a of Object.values(this.selected_nodes))a.onKeyDown?.(o)}else if(o.type=="keyup"){o.key===" "&&(this.read_only=!1,this.dragging_canvas=(this._previously_dragging_canvas??!1)&&this.pointer.isDown,this._previously_dragging_canvas=null);for(const a of Object.values(this.selected_nodes))a.onKeyUp?.(o)}n.change(),s&&(o.preventDefault(),o.stopImmediatePropagation())}}_serializeItems(o){const n={nodes:[],groups:[],reroutes:[],links:[],subgraphs:[]},s=new Set;for(const a of o??this.selectedItems)if(a instanceof LGraphNode){if(a.clonable===!1)continue;const r=a.clone()?.serialize();if(!r)continue;if(r.id=a.id,n.nodes.push(r),a.inputs)for(const{link:l}of a.inputs){if(l==null)continue;const u=this.graph?._links.get(l)?.asSerialisable();u&&n.links.push(u)}a instanceof SubgraphNode&&s.add(a.subgraph)}else a instanceof LGraphGroup?n.groups.push(a.serialize()):a instanceof Reroute&&n.reroutes.push(a.asSerialisable());for(const a of s){for(const l of a.nodes)l instanceof SubgraphNode&&s.add(l.subgraph);const r=a.clone(!0).asSerialisable();n.subgraphs.push(r)}return n}copyToClipboard(o){const n=JSON.stringify(this._serializeItems(o));return localStorage.setItem("litegrapheditor_clipboard",n),n}emitEvent(o){this.canvas.dispatchEvent(new CustomEvent("litegraph:canvas",{bubbles:!0,detail:o}))}emitBeforeChange(){this.emitEvent({subType:"before-change"})}emitAfterChange(){this.emitEvent({subType:"after-change"})}_pasteFromClipboard(o={}){const n=localStorage.getItem("litegrapheditor_clipboard");if(n)return this._deserializeItems(JSON.parse(n),o)}_deserializeItems(o,n){const{connectInputs:s=!1,position:a=this.graph_mouse}=n;if(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&s)return;const{graph:r}=this;if(!r)throw new NullGraphError;r.beforeChange(),this.emitBeforeChange(),o.nodes??=[],o.groups??=[],o.reroutes??=[],o.links??=[],o.subgraphs??=[];let l=1/0,u=1/0;for(const C of[...o.nodes,...o.reroutes]){if(C.pos==null)throw new TypeError("Invalid node encountered on paste.  `pos` was null.");C.pos[0]<l&&(l=C.pos[0]),C.pos[1]<u&&(u=C.pos[1])}if(o.groups)for(const C of o.groups)C.bounding[0]<l&&(l=C.bounding[0]),C.bounding[1]<u&&(u=C.bounding[1]);const m={created:[],nodes:new Map,links:new Map,reroutes:new Map,subgraphs:new Map},{created:f,nodes:_,links:y,reroutes:b}=m,w={};for(const C of o.subgraphs)C.id=w[C.id]=createUuidv4();const k=[o.nodes?[o.nodes]:[],o.subgraphs?o.subgraphs.map(C=>C.nodes??[]):[]].flat(2);for(const C of k)C.type in w&&(C.type=w[C.type]);for(const C of o.subgraphs){const I=r.createSubgraph(C);m.subgraphs.set(C.id,I)}for(const C of o.subgraphs)m.subgraphs.get(C.id)?.configure(C);for(const C of o.groups){C.id=-1;const I=new LGraphGroup;I.configure(C),r.add(I),f.push(I)}for(const C of o.nodes){const I=C.type==null?null:LiteGraph.createNode(C.type);I&&(_.set(C.id,I),C.id=-1,I.configure(C),r.add(I),f.push(I))}for(const C of o.reroutes){const{id:I,...T}=C,E=r.setReroute(T);f.push(E),b.set(I,E)}for(const C of b.values()){if(C.parentId==null)continue;const I=b.get(C.parentId);I&&(C.parentId=I.id)}for(const C of o.links){let I=_.get(C.origin_id),T;C.parentId!=null&&(T=b.get(C.parentId)?.id),s&&LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&(I??=r.getNodeById(C.origin_id),T??=C.parentId);const E=_.get(C.target_id);if(E){const N=I?.connect(C.origin_slot,E,C.target_slot,T);N&&y.set(C.id,N)}}for(const C of b.values()){const I=[...C.linkIds].map(T=>y.get(T)?.id??T);C.update(C.parentId,void 0,I,C.floating),C.validateLinks(r.links,r.floatingLinks)||r.removeReroute(C.id)}for(const C of f)C.pos[0]+=a[0]-l,C.pos[1]+=a[1]-u;const S=f.filter(C=>C instanceof LGraphNode).map(C=>{const I=C.size?.[1]??200,T=LiteGraph.vueNodesMode?removeNodeTitleHeight(I):I;return{nodeId:String(C.id),bounds:{x:C.pos[0],y:C.pos[1],width:C.size?.[0]??100,height:T}}});return S.length&&layoutStore.setSource(LayoutSource.Canvas),layoutStore.batchUpdateNodeBounds(S),this.selectItems(f),r.afterChange(),this.emitAfterChange(),m}pasteFromClipboard(o={}){this.emitBeforeChange();try{this._pasteFromClipboard(o)}finally{this.emitAfterChange()}}processNodeDblClicked(o){this.onShowNodePanel?.(o),this.onNodeDblClicked?.(o),this.setDirty(!0)}#S(o,n){const{graph:s,selectedItems:a,subgraph:r}=this;if(!s)throw new NullGraphError;const l=Math.abs(n[2]),u=Math.abs(n[3]);n[2]<0&&(n[0]-=l),n[3]<0&&(n[1]-=u),n[2]=l,n[3]=u;const m=new Set,f=[];if(r){const{inputNode:y,outputNode:b}=r;overlapBounding(n,y.boundingRect)&&_(y),overlapBounding(n,b.boundingRect)&&_(b)}for(const y of s._nodes)overlapBounding(n,y.boundingRect)&&_(y);for(const y of s.groups)containsRect(n,y._bounding)&&(y.recomputeInsideNodes(),_(y));for(const y of s.reroutes.values())isPointInRect(y.pos,n)&&(a.add(y),y.selected=!0,_(y));if(o.shiftKey)for(const y of f)this.select(y);else if(o.altKey)for(const y of m)this.deselect(y);else{for(const y of a.values())m.has(y)||this.deselect(y);for(const y of f)this.select(y)}this.onSelectionChange?.(this.selected_nodes);function _(y){!y.selected||!a.has(y)?f.push(y):m.add(y)}p(_,"addPositionable")}processSelect(o,n,s=!1){const a=n?.shiftKey,r=n!=null&&(n.metaKey||n.ctrlKey),l=a||r,u=l||this.multi_select;if(!o)(!l||this.multi_select)&&this.deselectAll();else if(!o.selected||!this.selectedItems.has(o))u||this.deselectAll(o),this.select(o);else if(u&&!s)this.deselect(o);else if(!s)this.deselectAll(o);else return;this.onSelectionChange?.(this.selected_nodes),this.setDirty(!0)}select(o){if(!(o.selected&&this.selectedItems.has(o))&&(o.selected=!0,this.selectedItems.add(o),this.state.selectionChanged=!0,o instanceof LGraphNode)){if(o.onSelected?.(),this.selected_nodes[o.id]=o,this.onNodeSelected?.(o),o.inputs)for(const n of o.inputs)n.link!=null&&(this.highlighted_links[n.link]=!0);if(o.outputs)for(const n of o.outputs.flatMap(s=>s.links))n!=null&&(this.highlighted_links[n]=!0)}}deselect(o){if(!o.selected&&!this.selectedItems.has(o)||(o.selected=!1,this.selectedItems.delete(o),this.state.selectionChanged=!0,!(o instanceof LGraphNode)))return;o.onDeselected?.(),delete this.selected_nodes[o.id],this.onNodeDeselected?.(o);const{graph:n}=this;if(n){if(o.inputs)for(const s of o.inputs){if(s.link==null)continue;const a=LLink.getOriginNode(n,s.link);a&&this.selectedItems.has(a)||delete this.highlighted_links[s.link]}if(o.outputs)for(const s of o.outputs.flatMap(a=>a.links)){if(s==null)continue;const a=LLink.getTargetNode(n,s);a&&this.selectedItems.has(a)||delete this.highlighted_links[s]}}}processNodeSelected(o,n){this.processSelect(o,n,n&&(n.shiftKey||n.metaKey||n.ctrlKey||this.multi_select))}selectNode(o,n){o==null?this.deselectAll():this.selectNodes([o],n)}get empty(){if(!this.graph)throw new NullGraphError;return this.graph.empty}get positionableItems(){if(!this.graph)throw new NullGraphError;return this.graph.positionableItems()}selectItems(o,n){const s=o??this.positionableItems;n||this.deselectAll();for(const a of s)this.select(a);this.onSelectionChange?.(this.selected_nodes),this.setDirty(!0)}selectNodes(o,n){this.selectItems(o,n)}deselectNode(o){this.deselect(o)}deselectAll(o){if(!this.graph)return;const n=this.selectedItems;if(!n.size)return;const s=n.size;let a;for(const u of n){if(u===o){a=u;continue}u.onDeselected?.(),u.selected=!1}n.clear(),a&&n.add(a),this.setDirty(!0);const r=o?.id==null?null:this.selected_nodes[o.id];if(this.selected_nodes={},this.current_node=null,this.highlighted_links={},o instanceof LGraphNode){if(r&&(this.selected_nodes[r.id]=r),o.inputs)for(const u of o.inputs)u.link!=null&&(this.highlighted_links[u.link]=!0);if(o.outputs)for(const u of o.outputs.flatMap(m=>m.links))u!=null&&(this.highlighted_links[u]=!0)}const l=n.size;s!==l&&(this.state.selectionChanged=!0,this.onSelectionChange?.(this.selected_nodes))}deselectAllNodes(){this.deselectAll()}deleteSelected(){const{graph:o}=this;if(!o)throw new NullGraphError;this.emitBeforeChange(),o.beforeChange();for(const n of this.selectedItems)if(n instanceof LGraphNode){const s=n;if(s.block_delete)continue;s.connectInputToOutput(),o.remove(s),this.onNodeDeselected?.(s)}else n instanceof LGraphGroup?o.remove(n):n instanceof Reroute&&o.removeReroute(n.id);this.selected_nodes={},this.selectedItems.clear(),this.current_node=null,this.highlighted_links={},this.state.selectionChanged=!0,this.onSelectionChange?.(this.selected_nodes),this.setDirty(!0),o.afterChange(),this.emitAfterChange()}deleteSelectedNodes(){this.deleteSelected()}centerOnNode(o){const n=window?.devicePixelRatio||1;this.ds.offset[0]=-o.pos[0]-o.size[0]*.5+this.canvas.width*.5/(this.ds.scale*n),this.ds.offset[1]=-o.pos[1]-o.size[1]*.5+this.canvas.height*.5/(this.ds.scale*n),this.setDirty(!0,!0)}adjustMouseEvent(o){let n=o.clientX,s=o.clientY;if(this.canvas){const a=this.canvas.getBoundingClientRect();n-=a.left,s-=a.top}o.safeOffsetX=n,o.safeOffsetY=s,o.deltaX===void 0&&(o.deltaX=n-this.last_mouse_position[0]),o.deltaY===void 0&&(o.deltaY=s-this.last_mouse_position[1]),this.last_mouse_position[0]=n,this.last_mouse_position[1]=s,o.canvasX=n/this.ds.scale-this.ds.offset[0],o.canvasY=s/this.ds.scale-this.ds.offset[1]}setZoom(o,n){this.ds.changeScale(o,n),this.#a()}convertOffsetToCanvas(o,n){return this.ds.convertOffsetToCanvas(o,n)}convertCanvasToOffset(o,n){return this.ds.convertCanvasToOffset(o,n)}convertEventToCanvasOffset(o){const n=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([o.clientX-n.left,o.clientY-n.top])}bringToFront(o){const{graph:n}=this;if(!n)throw new NullGraphError;const s=n._nodes.indexOf(o);s!=-1&&(n._nodes.splice(s,1),n._nodes.push(o))}sendToBack(o){const{graph:n}=this;if(!n)throw new NullGraphError;const s=n._nodes.indexOf(o);s!=-1&&(n._nodes.splice(s,1),n._nodes.unshift(o))}computeVisibleNodes(o,n){const s=n||[];if(s.length=0,!this.graph)throw new NullGraphError;const a=o||this.graph._nodes;for(const r of a)r.updateArea(this.ctx),overlapBounding(this.visible_area,r.renderArea)&&s.push(r);return s}isNodeVisible(o){return this.#n.has(o.id)}draw(o,n){if(!this.canvas||this.canvas.width==0||this.canvas.height==0)return;const s=LiteGraph.getTime();if(this.render_time=(s-this.last_draw_time)*.001,this.last_draw_time=s,this.graph&&this.ds.computeVisibleArea(this.viewport),this.dirty_canvas||o){this.computeVisibleNodes(void 0,this.visible_nodes),this.#n=new Set(this.visible_nodes.map(r=>r.id));const{subgraph:a}=this;a&&(a.inputNode.arrange(),a.outputNode.arrange())}(this.dirty_bgcanvas||n||this.always_render_background||this.graph?._last_trigger_time&&s-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||o)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame++}drawFrontCanvas(){this.dirty_canvas=!1;const{ctx:o,canvas:n,graph:s,linkConnector:a}=this;o.start2D&&!this.viewport&&(o.start2D(),o.restore(),o.setTransform(1,0,0,1,0,0));const r=this.viewport||this.dirty_area;if(r&&(o.save(),o.beginPath(),o.rect(r[0],r[1],r[2],r[3]),o.clip()),this.#i=this.#c||LiteGraph.alwaysSnapToGrid?this.graph?.getSnapToGridSize():void 0,this.clear_background&&(r?o.clearRect(r[0],r[1],r[2],r[3]):o.clearRect(0,0,n.width,n.height)),this.bgcanvas==this.canvas)this.drawBackCanvas();else{const l=window.devicePixelRatio;o.drawImage(this.bgcanvas,0,0,this.bgcanvas.width/l,this.bgcanvas.height/l)}if(this.onRender?.(n,o),this.show_info){const l=this.fpsInfoLocation??r;this.renderInfo(o,l?.[0]??0,l?.[1]??0)}if(s){o.save(),this.ds.toCanvasContext(o);const{visible_nodes:l}=this,u=this.#i&&(this.isDragging||layoutStore.isDraggingVueNodes.value);for(const m of l)o.save(),u&&this.selectedItems.has(m)&&this.drawSnapGuide(o,m),o.translate(m.pos[0],m.pos[1]),this.drawNode(m,o),o.restore();if(this.subgraph?.draw(o,this.colourGetter,this.linkConnector.renderLinks[0]?.fromSlot,this.editor_alpha),this.render_execution_order&&this.drawExecutionOrder(o),s.config.links_ontop&&this.drawConnections(o),a.isConnecting){const{renderLinks:m}=a,f=this.#I();o.lineWidth=this.connections_width;for(const _ of m){const{fromSlot:y,fromPos:b,fromDirection:w,dragDirection:k}=_,S=y.shape,C=y.type,I=resolveConnectingLinkColor(C);this.linkRenderer&&this.linkRenderer.renderDraggingLink(o,b,f,I,w,k,{...this.buildLinkRenderContext(),linkMarkerShape:LinkMarkerShape.None}),o.fillStyle=I,o.beginPath(),C===LiteGraph.EVENT||S===RenderShape.BOX?(o.rect(b[0]-6+.5,b[1]-5+.5,14,10),o.rect(f[0]-6+.5,f[1]-5+.5,14,10)):S===RenderShape.ARROW?(o.moveTo(b[0]+8,b[1]+.5),o.lineTo(b[0]-4,b[1]+6+.5),o.lineTo(b[0]-4,b[1]-6+.5),o.closePath()):(o.arc(b[0],b[1],4,0,Math.PI*2),o.arc(f[0],f[1],4,0,Math.PI*2)),o.fill()}this.#T(o,f)}if(this.dragging_rectangle){const{eDown:m,eMove:f}=this.pointer;if(o.strokeStyle="#FFF",m&&f){const _=o.getTransform(),y=Math.max(1,window.devicePixelRatio);o.setTransform(y,0,0,y,0,0);const b=m.safeOffsetX,w=m.safeOffsetY;o.strokeRect(b,w,f.safeOffsetX-b,f.safeOffsetY-w),o.setTransform(_)}else{const[_,y,b,w]=this.dragging_rectangle;o.strokeRect(_,y,b,w)}}!this.isDragging&&this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(o,this.over_link_center):this.onDrawLinkTooltip?.(o,null),this.onDrawForeground?.(o,this.visible_area),o.restore()}this.onDrawOverlay?.(o),r&&o.restore()}#C(o){if(this.linkMarkerShape!==LinkMarkerShape.None)for(const n of this.renderedPaths){const s=n._pos;if(s&&isInRectangle(o.canvasX,o.canvasY,s[0]-4,s[1]-4,8,8))return n}}#I(){return LiteGraph.snaps_for_comfy?this.linkConnector.state.snapLinksPos??this._highlight_pos??this.graph_mouse:this.graph_mouse}#T(o,n){const s=!!this.linkConnector.state.snapLinksPos;if(!this._highlight_pos&&!s)return;o.fillStyle="#ffcc00",o.beginPath(),this._highlight_input?.shape===RenderShape.ARROW?(o.moveTo(n[0]+8,n[1]+.5),o.lineTo(n[0]-4,n[1]+6+.5),o.lineTo(n[0]-4,n[1]-6+.5),o.closePath()):o.arc(n[0],n[1],6,0,Math.PI*2),o.fill();const{linkConnector:r}=this,{overReroute:l,overWidget:u}=r;if(!LiteGraph.snap_highlights_node||!r.isConnecting||s)return;l?.drawHighlight(o,"#ffcc00aa");const m=this.node_over;if(!m)return;const{strokeStyle:f,lineWidth:_}=o,y=m.boundingRect,b=3,w=LiteGraph.ROUND_RADIUS+b,k=y[0]-b,S=y[1]-b,C=y[2]+b*2,I=y[3]+b*2;o.beginPath(),o.roundRect(k,S,C,I,w);const T=r.state.connectingTo==="output"?0:1,E=T?-1:1,N=n[0],L=n[1],A=C<I?C:C*Math.max(I/C,.5),D=o.createRadialGradient(N,L,0,N,L,A);D.addColorStop(1,"#00000000"),D.addColorStop(0,"#ffcc00aa");const O=o.createLinearGradient(k,S,k+C,S);if(O.addColorStop(.5,"#00000000"),O.addColorStop(T+.67*E,"#ddeeff33"),O.addColorStop(T+E,"#ffcc0055"),o.setLineDash([w,w*.001]),o.lineWidth=1,o.strokeStyle=O,o.stroke(),u){const{computedHeight:M}=u;o.beginPath();const{pos:[P,R]}=m,V=LiteGraph.NODE_WIDGET_HEIGHT;u.type.startsWith("custom")&&M!=null&&M>V*2?o.rect(P+9,R+u.y+9,(u.width??y[2])-18,M-18):o.roundRect(P+BaseWidget.margin,R+u.y,u.width??y[2],V,V*.5),o.stroke()}o.strokeStyle=D,o.stroke(),o.setLineDash([]),o.lineWidth=_,o.strokeStyle=f}renderInfo(o,n,s){n=n||10,s=s||this.canvas.offsetHeight-80,o.save(),o.translate(n,s),o.font=`10px ${LiteGraph.DEFAULT_FONT}`,o.fillStyle="#888",o.textAlign="left",this.graph?(o.fillText(`T: ${this.graph.globaltime.toFixed(2)}s`,5,13*1),o.fillText(`I: ${this.graph.iteration}`,5,13*2),o.fillText(`N: ${this.graph._nodes.length} [${this.visible_nodes.length}]`,5,13*3),o.fillText(`V: ${this.graph._version}`,5,13*4),o.fillText(`FPS:${this.fps.toFixed(2)}`,5,13*5)):o.fillText("No graph selected",5,13*1),o.restore()}drawBackCanvas(){const o=this.bgcanvas;(o.width!=this.canvas.width||o.height!=this.canvas.height)&&(o.width=this.canvas.width,o.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));const n=this.bgctx;if(!n)throw new TypeError("Background canvas context was null.");const s=this.viewport||[0,0,n.canvas.width,n.canvas.height];this.clear_background&&n.clearRect(s[0],s[1],s[2],s[3]);const a=this.onRenderBackground?this.onRenderBackground(o,n):!1;if(!this.viewport){const r=window.devicePixelRatio;n.restore(),n.setTransform(r,0,0,r,0,0)}if(this.graph){if(n.save(),this.ds.toCanvasContext(n),this.ds.scale<1.5&&!a&&this.clear_background_color&&(n.fillStyle=this.clear_background_color,n.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!a){this.zoom_modify_alpha?n.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:n.globalAlpha=this.editor_alpha,n.imageSmoothingEnabled=!1,(!this._bg_img||this._bg_img.name!=this.background_image)&&(this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image,this._bg_img.addEventListener("load",()=>{this.draw(!0,!0)}));let r=this._pattern;r==null&&this._bg_img.width>0&&(r=n.createPattern(this._bg_img,"repeat")??void 0,this._pattern_img=this._bg_img,this._pattern=r),r&&(n.fillStyle=r,n.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),n.fillStyle="transparent"),n.globalAlpha=1,n.imageSmoothingEnabled=!0}this.bg_tint&&(n.fillStyle=this.bg_tint,n.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),n.fillStyle="transparent"),this.graph._groups.length&&this.drawGroups(o,n),this.onDrawBackground?.(n,this.visible_area),this.render_canvas_border&&(n.strokeStyle="#235",n.strokeRect(0,0,o.width,o.height)),this.render_connections_shadows?(n.shadowColor="#000",n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=6):n.shadowColor="rgba(0,0,0,0)",this.drawConnections(n),n.shadowColor="rgba(0,0,0,0)",n.restore()}this.dirty_bgcanvas=!1,this.dirty_canvas=!0}drawNode(o,n){if(this.current_node=o,LiteGraph.vueNodesMode){o._setConcreteSlots(),o.collapsed||o.arrange();return}const s=o.renderingColor,a=o.renderingBgColor;if(n.globalAlpha=this.getNodeModeAlpha(o),this.render_shadows&&!this.low_quality?(n.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,n.shadowOffsetX=2*this.ds.scale,n.shadowOffsetY=2*this.ds.scale,n.shadowBlur=3*this.ds.scale):n.shadowColor="transparent",o.flags.collapsed&&o.onDrawCollapsed?.(n,this)==!0)return;const r=o._shape||RenderShape.BOX,l=temp_vec2;if(l[0]=o.renderingSize[0],l[1]=o.renderingSize[1],o.collapsed&&(n.font=this.inner_text_font),o.clip_area&&(n.save(),n.beginPath(),r==RenderShape.BOX?n.rect(0,0,l[0],l[1]):r==RenderShape.ROUND?n.roundRect(0,0,l[0],l[1],[10]):r==RenderShape.CIRCLE&&n.arc(l[0]*.5,l[1]*.5,l[0]*.5,0,Math.PI*2),n.clip()),this.drawNodeShape(o,n,l,s,a,!!o.selected),o.title_buttons&&!o.flags.collapsed){const u=LiteGraph.NODE_TITLE_HEIGHT;let m=l[0];for(let f=0;f<o.title_buttons.length;f++){const _=o.title_buttons[f];if(!_.visible)continue;const y=_.getWidth(n);m-=y;const b=-u+(u-_.height)/2;_.draw(n,m,b),m-=2}}this.low_quality||o.drawBadges(n),n.shadowColor="transparent",n.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,o.onDrawForeground?.(n,this,this.canvas),n.font=this.inner_text_font,o._setConcreteSlots(),o.collapsed?this.render_collapsed_slots&&o.drawCollapsedSlots(n):(o.arrange(),o.drawSlots(n,{fromSlot:this.linkConnector.renderLinks[0]?.fromSlot,colorContext:this.colourGetter,editorAlpha:this.editor_alpha,lowQuality:this.low_quality}),n.textAlign="left",n.globalAlpha=1,this.drawNodeWidgets(o,null,n)),o.clip_area&&n.restore(),n.globalAlpha=1}drawLinkTooltip(o,n){const s=n._pos;if(o.fillStyle="black",o.beginPath(),this.linkMarkerShape===LinkMarkerShape.Arrow){const f=o.getTransform();o.translate(s[0],s[1]),Number.isFinite(n._centreAngle)&&o.rotate(n._centreAngle),o.moveTo(-2,-3),o.lineTo(4,0),o.lineTo(-2,3),o.setTransform(f)}else(this.linkMarkerShape==null||this.linkMarkerShape===LinkMarkerShape.Circle)&&o.arc(s[0],s[1],3,0,Math.PI*2);o.fill();const{data:a}=n;if(a==null||this.onDrawLinkTooltip?.(o,n,this)==!0)return;let r=null;if(typeof a=="number"?r=a.toFixed(2):typeof a=="string"?r=`"${a}"`:typeof a=="boolean"?r=String(a):a.toToolTip?r=a.toToolTip():r=`[${a.constructor.name}]`,r==null)return;r=r.substring(0,30),o.font="14px Courier New";const u=o.measureText(r).width+20,m=24;o.shadowColor="black",o.shadowOffsetX=2,o.shadowOffsetY=2,o.shadowBlur=3,o.fillStyle="#454",o.beginPath(),o.roundRect(s[0]-u*.5,s[1]-15-m,u,m,[3]),o.moveTo(s[0]-10,s[1]-15),o.lineTo(s[0]+10,s[1]-15),o.lineTo(s[0],s[1]-5),o.fill(),o.shadowColor="transparent",o.textAlign="center",o.fillStyle="#CEC",o.fillText(r,s[0],s[1]-15-m*.3)}drawNodeShape(o,n,s,a,r,l){n.strokeStyle=a,n.fillStyle=r;const u=LiteGraph.NODE_TITLE_HEIGHT,{low_quality:m}=this,{collapsed:f}=o.flags,_=o.renderingShape,{title_mode:y}=o,b=!(y==TitleMode.TRANSPARENT_TITLE||y==TitleMode.NO_TITLE),w=tmp_area;w.set(o.boundingRect),w[0]-=o.pos[0],w[1]-=o.pos[1];const k=n.globalAlpha;n.beginPath(),_==RenderShape.BOX||m?n.rect(w[0],w[1],w[2],w[3]):_==RenderShape.ROUND||_==RenderShape.CARD?n.roundRect(w[0],w[1],w[2],w[3],_==RenderShape.CARD?[LiteGraph.ROUND_RADIUS,LiteGraph.ROUND_RADIUS,0,0]:[LiteGraph.ROUND_RADIUS]):_==RenderShape.CIRCLE&&n.arc(s[0]*.5,s[1]*.5,s[0]*.5,0,Math.PI*2),n.fill(),!f&&b&&(n.shadowColor="transparent",n.fillStyle="rgba(0,0,0,0.2)",n.fillRect(0,-1,w[2],2)),n.shadowColor="transparent",o.onDrawBackground?.(n),(b||y==TitleMode.TRANSPARENT_TITLE)&&(o.drawTitleBarBackground(n,{scale:this.ds.scale,low_quality:m}),o.drawTitleBox(n,{scale:this.ds.scale,low_quality:m,box_size:10}),n.globalAlpha=k,o.drawTitleText(n,{scale:this.ds.scale,default_title_color:this.node_title_color,low_quality:m}),o.onDrawTitle?.(n));for(const S of Object.values(o.strokeStyles)){const C=S.call(o);C&&strokeShape(n,w,{shape:_,title_height:u,title_mode:y,collapsed:f,...C})}o.drawProgressBar(n),o.execute_triggered!=null&&o.execute_triggered>0&&o.execute_triggered--,o.action_triggered!=null&&o.action_triggered>0&&o.action_triggered--}drawSnapGuide(o,n,s=RenderShape.ROUND){const a=temp;a.set(n.boundingRect);const{pos:r}=n,l=r[0]-a[0],u=r[1]-a[1];a[0]+=l,a[1]+=u,this.#i&&snapPoint(a,this.#i),a[0]-=l,a[1]-=u;const{globalAlpha:m}=o;o.globalAlpha=1,o.beginPath();const[f,_,y,b]=a;if(s===RenderShape.CIRCLE){const w=f+y*.5,k=_+b*.5,S=Math.min(y*.5,b*.5);o.arc(w,k,S,0,Math.PI*2)}else o.rect(f,_,y,b);o.lineWidth=.5,o.strokeStyle="#FFFFFF66",o.fillStyle="#FFFFFF22",o.fill(),o.stroke(),o.globalAlpha=m}drawConnections(o){if(this.renderedPaths.clear(),this.links_render_mode===LinkRenderType.HIDDEN_LINK)return;const{graph:n,subgraph:s}=this;if(!n)throw new NullGraphError;const a=[],r=LiteGraph.getTime(),{visible_area:l}=this;margin_area[0]=l[0]-20,margin_area[1]=l[1]-20,margin_area[2]=l[2]+40,margin_area[3]=l[3]+40,o.lineWidth=this.connections_width,o.fillStyle="#AAA",o.strokeStyle="#AAA",o.globalAlpha=this.editor_alpha;const u=n._nodes;for(const f of u){const{inputs:_}=f;if(_?.length)for(const[y,b]of _.entries()){if(!b||b.link==null)continue;const w=b.link,k=n._links.get(w);if(!k)continue;const S=LiteGraph.vueNodesMode?getSlotPosition(f,y,!0):f.getInputPos(y),C=n.getNodeById(k.origin_id);if(C==null)continue;const I=k.origin_slot,T=I===-1?[C.pos[0]+10,C.pos[1]+10]:LiteGraph.vueNodesMode?getSlotPosition(C,I,!1):C.getOutputPos(I),E=C.outputs[I];E&&this.#y(o,k,T,S,a,r,E.dir,b.dir)}}if(s){for(const f of s.inputNode.slots)if(f.linkIds.length)for(const _ of f.linkIds){const y=LLink.resolve(_,n);if(!y)continue;const{link:b,inputNode:w,input:k}=y;if(!w||!k)continue;const S=LiteGraph.vueNodesMode?getSlotPosition(w,b.target_slot,!0):w.getInputPos(b.target_slot);this.#y(o,b,f.pos,S,a,r,k.dir,k.dir)}for(const f of s.outputNode.slots){if(!f.linkIds.length)continue;const _=LLink.resolve(f.linkIds[0],n);if(!_)continue;const{link:y,outputNode:b,output:w}=_;if(!b||!w)continue;const k=LiteGraph.vueNodesMode?getSlotPosition(b,y.origin_slot,!1):b.getOutputPos(y.origin_slot);this.#y(o,y,k,f.pos,a,r,w.dir,f.dir)}}n.floatingLinks.size>0&&this.#E(o,n,a,r);const m=this.#s;m.clear(),a.sort((f,_)=>f.linkIds.size-_.linkIds.size);for(const f of a)m.add(f),this.#i&&this.isDragging&&this.selectedItems.has(f)&&this.drawSnapGuide(o,f,RenderShape.CIRCLE),f.draw(o,this._pattern),this.pointer.isDown||f.drawSlots(o);o.globalAlpha=1}getNodeModeAlpha(o){return o.mode===LGraphEventMode.BYPASS?.2:o.mode===LGraphEventMode.NEVER?.4:this.editor_alpha}#E(o,n,s,a){const{globalAlpha:r}=o;o.globalAlpha=r*.33;for(const l of n.floatingLinks.values()){const u=LLink.getReroutes(n,l),m=u[0],f=u.at(-1);if(!(!m||!f?.floating))if(f.floating.slotType==="input"){const _=n.getNodeById(l.target_id);if(!_)continue;const y=m.pos,b=LiteGraph.vueNodesMode?getSlotPosition(_,l.target_slot,!0):_.getInputPos(l.target_slot),w=_.inputs[l.target_slot]?.dir;m._dragging=!0,this.#y(o,l,y,b,s,a,LinkDirection.CENTER,w,!0)}else{const _=n.getNodeById(l.origin_id);if(!_)continue;const y=LiteGraph.vueNodesMode?getSlotPosition(_,l.origin_slot,!1):_.getOutputPos(l.origin_slot),b=f.pos,w=_.outputs[l.origin_slot]?.dir;l._dragging=!0,this.#y(o,l,y,b,s,a,w,LinkDirection.CENTER,!0)}}o.globalAlpha=r}#y(o,n,s,a,r,l,u,m,f=!1){const{graph:_,renderedPaths:y}=this;if(!_)return;const b=LLink.getReroutes(_,n),w=[s,...b.map(T=>T.pos),a],k=w.map(T=>T[0]),S=w.map(T=>T[1]);if(link_bounding[0]=Math.min(...k),link_bounding[1]=Math.min(...S),link_bounding[2]=Math.max(...k)-link_bounding[0],link_bounding[3]=Math.max(...S)-link_bounding[1],!overlapBounding(link_bounding,margin_area))return;const C=u||LinkDirection.RIGHT,I=m||LinkDirection.LEFT;if(b.length){let T;const E=b.length;for(let L=0;L<E;L++){const A=b[L];if(!y.has(A)){y.add(A),r.push(A),A._colour=n.color||LGraphCanvas.link_type_colors[n.type]||this.default_link_color;const O=_.getReroute(A.parentId)?.pos??s;A.calculateAngle(this.last_draw_time,_,O),A._dragging||this.renderLink(o,O,A.pos,n,!1,0,null,T===void 0?C:LinkDirection.CENTER,LinkDirection.CENTER,{startControl:T,endControl:A.controlPoint,reroute:A,disabled:f})}if(!T&&b.at(-1)?.floating?.slotType==="input")T=[0,0];else{const D=b[L+1]?.pos??a,O=Math.min(Reroute.maxSplineOffset,distance(A.pos,D)*.25);T=[O*A.cos,O*A.sin]}}if(n._dragging)return;const N=w.at(-2)??s;this.renderLink(o,N,a,n,!1,0,null,LinkDirection.CENTER,I,{startControl:T,disabled:f})}else n._dragging||this.renderLink(o,s,a,n,!1,0,null,C,I);if(y.add(n),n?._last_time&&l-n._last_time<1e3){const T=2-(l-n._last_time)*.002,E=o.globalAlpha;o.globalAlpha=E*T,this.renderLink(o,s,a,n,!0,T,"white",C,I),o.globalAlpha=E}}buildLinkRenderContext(){return{renderMode:this.links_render_mode,connectionWidth:this.connections_width,renderBorder:this.render_connections_border,lowQuality:this.low_quality,highQualityRender:this.highquality_render,scale:this.ds.scale,linkMarkerShape:this.linkMarkerShape,renderConnectionArrows:this.render_connection_arrows,highlightedLinks:new Set(Object.keys(this.highlighted_links)),defaultLinkColor:this.default_link_color,linkTypeColors:LGraphCanvas.link_type_colors,disabledPattern:this._pattern}}renderLink(o,n,s,a,r,l,u,m,f,{startControl:_,endControl:y,reroute:b,num_sublines:w=1,disabled:k=!1}={}){if(this.linkRenderer){const S=this.buildLinkRenderContext();this.linkRenderer.renderLinkDirect(o,n,s,a,r,l,u,m,f,S,{reroute:b,startControl:_,endControl:y,num_sublines:w,disabled:k})}}drawExecutionOrder(o){o.shadowColor="transparent",o.globalAlpha=.25,o.textAlign="center",o.strokeStyle="white",o.globalAlpha=.75;const{visible_nodes:n}=this;for(const s of n)o.fillStyle="black",o.fillRect(s.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,s.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),s.order==0&&o.strokeRect(s.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,s.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),o.fillStyle="#FFF",o.fillText(toString(s.order),s.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,s.pos[1]-6);o.globalAlpha=1}drawNodeWidgets(o,n,s){o.drawWidgets(s,{lowQuality:this.low_quality,editorAlpha:this.getNodeModeAlpha(o)})}drawGroups(o,n){if(!this.graph)return;const s=this.graph._groups;n.save(),n.globalAlpha=.5*this.editor_alpha;const a=this.#i&&(this.isDragging||layoutStore.isDraggingVueNodes.value);for(const r of s)overlapBounding(this.visible_area,r._bounding)&&(a&&this.selectedItems.has(r)&&this.drawSnapGuide(n,r),r.draw(this,n));n.restore()}resize(o,n){if(!o&&!n){const s=this.canvas.parentElement;if(!s)throw new TypeError("Attempted to resize canvas, but parent element was null.");o=s.offsetWidth,n=s.offsetHeight}this.canvas.width==o&&this.canvas.height==n||(this.canvas.width=o??0,this.canvas.height=n??0,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))}onNodeSelectionChange(){}boundaryNodesForSelection(){return LGraphCanvas.getBoundaryNodes(this.selected_nodes)}showLinkMenu(o,n){const{graph:s}=this;if(!s)throw new NullGraphError;const a="data"in o&&o.data!=null?o.data.constructor.name:void 0,{origin_id:r,origin_slot:l}=o;if(r==null||l==null)return new LiteGraph.ContextMenu(["Link has no origin"],{event:n,title:a}),!1;const u=s.getNodeById(r),m=u?.outputs?.[l]?.type,f=["Add Node","Add Reroute",null,"Delete",null],_=new LiteGraph.ContextMenu(f,{event:n,title:a,callback:y.bind(this)});return!1;function y(b,w,k){if(!s)throw new NullGraphError;switch(b){case"Add Node":LGraphCanvas.onMenuAdd(null,null,k,_,S=>{if(!S?.inputs?.length||!S?.outputs?.length||l==null)return;const C={afterRerouteId:o.parentId};u?.connectByType(l,S,m??"*",C)&&(S.pos[0]-=S.size[0]*.5)});break;case"Add Reroute":{try{this.emitBeforeChange(),this.adjustMouseEvent(k),s.createReroute(o._pos,o),this.setDirty(!1,!0)}catch(S){console.error(S)}finally{this.emitAfterChange()}break}case"Delete":{const S=o instanceof Reroute?o.linkIds.values().next().value:o.id;S!==void 0&&(s.removeLink(S),layoutStore.deleteLinkLayout(S));break}}}}createDefaultNodeForSlot(o){const n=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[0,0],nodeType:void 0,posAdd:[0,0],posSizeFix:[0,0]},o),{afterRerouteId:s}=n,a=n.nodeFrom&&n.slotFrom!==null,r=!a&&n.nodeTo&&n.slotTo!==null;if(!a&&!r)return console.warn("No data passed to createDefaultNodeForSlot",n.nodeFrom,n.slotFrom,n.nodeTo,n.slotTo),!1;if(!n.nodeType)return console.warn("No type to createDefaultNodeForSlot"),!1;const l=a?n.nodeFrom:n.nodeTo;if(!l)throw new TypeError("nodeX was null when creating default node for slot.");let u=a?n.slotFrom:n.slotTo,m=!1;if(l instanceof SubgraphIONodeBase){if(typeof u!="object"||!u)return console.warn("Cant get slot information",u),!1;const{name:y}=u;if(m=l.slots.findIndex(b=>b.name===y),u=l.slots[m],!u)return console.warn("Cant get slot information",u),!1}else switch(typeof u){case"string":m=a?l.findOutputSlot(u,!1):l.findInputSlot(u,!1),u=a?l.outputs[u]:l.inputs[u];break;case"object":if(u===null)return console.warn("Cant get slot information",u),!1;m=a?l.findOutputSlot(u.name):l.findInputSlot(u.name);break;case"number":m=u,u=a?l.outputs[u]:l.inputs[u];break;case"undefined":default:return console.warn("Cant get slot information",u),!1}const f=u.type==LiteGraph.EVENT?"_event_":u.type,_=a?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(_?.[f]){let y=!1;if(typeof _[f]=="object"){for(const b in _[f])if(n.nodeType==_[f][b]||n.nodeType=="AUTO"){y=_[f][b];break}}else(n.nodeType==_[f]||n.nodeType=="AUTO")&&(y=_[f]);if(y){let b=!1;typeof y=="object"&&y.node&&(b=y,y=y.node);const w=n.posSizeFix[0]*LiteGraph.NODE_WIDTH,k=n.posSizeFix[1]*LiteGraph.NODE_SLOT_HEIGHT,S=n.position[0]+n.posAdd[0]+w,C=n.position[1]+n.posAdd[1]+k,I=[S,C],T=LiteGraph.createNode(y,b.title,{pos:I});if(T){if(b){if(b.properties)for(const L in b.properties)T.addProperty(L,b.properties[L]);if(b.inputs){T.inputs=[];for(const L in b.inputs)T.addOutput(b.inputs[L][0],b.inputs[L][1])}if(b.outputs){T.outputs=[];for(const L in b.outputs)T.addOutput(b.outputs[L][0],b.outputs[L][1])}b.json&&T.configure(b.json)}if(!this.graph)throw new NullGraphError;this.graph.add(T);const E={node:T,opts:n};if(!this.canvas.dispatchEvent(new CustomEvent("connect-new-default-node",{detail:E,cancelable:!0})))return!0;if(a){if(!n.nodeFrom)throw new TypeError("createDefaultNodeForSlot - nodeFrom was null");n.nodeFrom.connectByType(m,T,f,{afterRerouteId:s})}else{if(!n.nodeTo)throw new TypeError("createDefaultNodeForSlot - nodeTo was null");n.nodeTo.connectByTypeOutput(m,T,f,{afterRerouteId:s})}return!0}console.error(`failed creating ${y}`)}}return!1}showConnectionMenu(o){const n=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:void 0,allow_searchbox:this.allow_searchbox,showSearchBox:this.showSearchBox},o||{}),s=p(()=>this.#a(),"dirty"),a=this,{graph:r}=this,{afterRerouteId:l}=n,u=n.nodeFrom&&n.slotFrom,m=!u&&n.nodeTo&&n.slotTo;if(!u&&!m){console.warn("No data passed to showConnectionMenu");return}const f=u?n.nodeFrom:n.nodeTo;if(!f)throw new TypeError("nodeX was null when creating default node for slot.");let _=u?n.slotFrom:n.slotTo,y;if(f instanceof SubgraphIONodeBase){if(typeof _!="object"||!_){console.warn("Cant get slot information",_);return}const{name:I}=_;if(y=f.slots.findIndex(T=>T.name===I),y!==-1&&(_=f.slots[y]),!_){console.warn("Cant get slot information",_);return}}else switch(typeof _){case"string":y=u?f.findOutputSlot(_,!1):f.findInputSlot(_,!1),_=u?f.outputs[_]:f.inputs[_];break;case"object":if(_===null){console.warn("Cant get slot information",_);return}y=u?f.findOutputSlot(_.name):f.findInputSlot(_.name);break;case"number":y=_,_=u?f.outputs[_]:f.inputs[_];break;default:console.warn("Cant get slot information",_);return}const b=["Add Node","Add Reroute",null];n.allow_searchbox&&b.push("Search",null);const w=_.type==LiteGraph.EVENT?"_event_":_.type,k=u?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(k?.[w])if(typeof k[w]=="object")for(const I in k[w])b.push(k[w][I]);else b.push(k[w]);const S=new LiteGraph.ContextMenu(b,{event:n.e,extra:_,title:(_&&_.name!=""?_.name+(w?" | ":""):"")+(_&&w?w:""),callback:C});return S;function C(I,T,E){switch(I){case"Add Node":LGraphCanvas.onMenuAdd(null,null,E,S,function(N){if(N)if(u){if(!n.nodeFrom)throw new TypeError("Cannot add node to SubgraphInputNode: nodeFrom was null");n.nodeFrom.connectByType(y,N,w,{afterRerouteId:l})||console.warn("Failed to make new connection.")}else{if(!n.nodeTo)throw new TypeError("Cannot add node to SubgraphInputNode: nodeTo was null");n.nodeTo.connectByTypeOutput(y,N,w,{afterRerouteId:l})}});break;case"Add Reroute":{const N=u?n.nodeFrom:n.nodeTo,L=T.extra;if(!r)throw new NullGraphError;if(!N)throw new TypeError("Cannot add reroute: node was null");if(!L)throw new TypeError("Cannot add reroute: slot was null");if(!n.e)throw new TypeError("Cannot add reroute: CanvasPointerEvent was null");if(N instanceof SubgraphIONodeBase)throw new TypeError("Cannot add floating reroute to Subgraph IO Nodes");if(!N.connectFloatingReroute([n.e.canvasX,n.e.canvasY],L,l))throw new Error("Failed to create reroute");s();break}case"Search":u?n.showSearchBox(E,{node_from:n.nodeFrom,slot_from:_,type_filter_in:w}):n.showSearchBox(E,{node_to:n.nodeTo,slot_from:_,type_filter_out:w});break;default:{const N={position:[n.e?.canvasX??0,n.e?.canvasY??0],nodeType:I,afterRerouteId:l},L=Object.assign(n,N);if(!a.createDefaultNodeForSlot(L))break}}}}prompt(o,n,s,a,r){const l=this;o=o||"";const u={is_modified:!1,className:"graphdialog rounded",innerHTML:r?"<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":"<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",close(){l.prompt_box=null,f.parentNode&&f.remove()}},m=document.createElement("div"),f=Object.assign(m,u),_=LGraphCanvas.active_canvas,{canvas:y}=_;if(!y.parentNode)throw new TypeError("canvas element parentNode was null when opening a prompt.");y.parentNode.append(f),this.ds.scale>1&&(f.style.transform=`scale(${this.ds.scale})`);let b,w=0;LiteGraph.pointerListenerAdd(f,"leave",function(){w||LiteGraph.dialog_close_on_mouse_leave&&!f.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(b=setTimeout(f.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),LiteGraph.pointerListenerAdd(f,"enter",function(){LiteGraph.dialog_close_on_mouse_leave&&b&&clearTimeout(b)});const k=f.querySelectorAll("select");if(k)for(const A of k)A.addEventListener("click",function(){w++}),A.addEventListener("blur",function(){w=0}),A.addEventListener("change",function(){w=-1});this.prompt_box?.close(),this.prompt_box=f;const S=f.querySelector(".name");if(!S)throw new TypeError("name_element was null");S.textContent=o;const C=f.querySelector(".value");if(!C)throw new TypeError("value_element was null");C.value=n,C.select();const I=C;I.addEventListener("keydown",function(A){if(f.is_modified=!0,A.key=="Escape")f.close();else if(A.key=="Enter"&&A.target.localName!="textarea")s&&s(this.value),f.close();else return;A.preventDefault(),A.stopPropagation()});const T=f.querySelector("button");if(!T)throw new TypeError("button was null when opening prompt");T.addEventListener("click",function(){s?.(I.value),l.setDirty(!0),f.close()});const E=y.getBoundingClientRect();let N=-20,L=-20;return E&&(N-=E.left,L-=E.top),a?(f.style.left=`${a.clientX+N}px`,f.style.top=`${a.clientY+L}px`):(f.style.left=`${y.width*.5+N}px`,f.style.top=`${y.height*.5+L}px`),setTimeout(function(){I.focus();const A=Date.now();function D(O){O.target===y&&Date.now()-A>256&&(f.close(),y.parentElement?.removeEventListener("click",D),y.parentElement?.removeEventListener("touchend",D))}p(D,"handleOutsideClick"),y.parentElement?.addEventListener("click",D),y.parentElement?.addEventListener("touchend",D)},10),f}showSearchBox(o,n){const s={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled,type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};Object.assign(s,n);const a=this,r=LGraphCanvas.active_canvas,{canvas:l}=r,u=l.ownerDocument||document,m=document.createElement("div"),f=Object.assign(m,{close(){a.search_box=void 0,this.blur(),l.focus(),u.body.style.overflow="",setTimeout(()=>l.focus(),20),f.remove()}});f.className="litegraph litesearchbox graphdialog rounded",f.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",s.do_type_filter&&(f.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",f.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>");const _=document.createElement("div");_.className="helper",f.append(_),u.fullscreenElement?u.fullscreenElement.append(f):(u.body.append(f),u.body.style.overflow="hidden");let y,b;if(s.do_type_filter&&(y=f.querySelector(".slot_in_type_filter"),b=f.querySelector(".slot_out_type_filter")),this.ds.scale>1&&(f.style.transform=`scale(${this.ds.scale})`),s.hide_on_mouse_leave){let M=!1,P=null;if(LiteGraph.pointerListenerAdd(f,"enter",function(){P&&(clearTimeout(P),P=null)}),f.addEventListener("pointerleave",function(){if(M)return;const R=s.hide_on_mouse_leave,V=typeof R=="number"?R:500;P=setTimeout(f.close,V)}),s.do_type_filter){if(!y)throw new TypeError("selIn was null when showing search box");if(!b)throw new TypeError("selOut was null when showing search box");y.addEventListener("click",function(){M++}),y.addEventListener("blur",function(){M=0}),y.addEventListener("change",function(){M=-1}),b.addEventListener("click",function(){M++}),b.addEventListener("blur",function(){M=0}),b.addEventListener("change",function(){M=-1})}}a.search_box?.close(),a.search_box=f;let w=null,k=null,S=null;const C=f.querySelector("input");if(!C)throw new TypeError("Could not create search input box.");const I=C;if(I&&(I.addEventListener("blur",function(){this.focus()}),I.addEventListener("keydown",function(M){if(M.key=="ArrowUp")D(!1);else if(M.key=="ArrowDown")D(!0);else if(M.key=="Escape")f.close();else if(M.key=="Enter")S instanceof HTMLElement?A(unescape(String(S.dataset.type))):w?A(w):f.close();else{k&&clearInterval(k),k=setTimeout(O,10);return}return M.preventDefault(),M.stopPropagation(),M.stopImmediatePropagation(),!0})),s.do_type_filter){if(y){const M=LiteGraph.slot_types_in,P=M.length;(s.type_filter_in==LiteGraph.EVENT||s.type_filter_in==LiteGraph.ACTION)&&(s.type_filter_in="_event_");for(let R=0;R<P;R++){const V=document.createElement("option");V.value=M[R],V.innerHTML=M[R],y.append(V),s.type_filter_in!==!1&&String(s.type_filter_in).toLowerCase()==String(M[R]).toLowerCase()&&(V.selected=!0)}y.addEventListener("change",function(){O()})}if(b){const M=LiteGraph.slot_types_out;(s.type_filter_out==LiteGraph.EVENT||s.type_filter_out==LiteGraph.ACTION)&&(s.type_filter_out="_event_");for(const P of M){const R=document.createElement("option");R.value=P,R.innerHTML=P,b.append(R),s.type_filter_out!==!1&&String(s.type_filter_out).toLowerCase()==String(P).toLowerCase()&&(R.selected=!0)}b.addEventListener("change",function(){O()})}}const T=l.getBoundingClientRect(),E=o??new MouseEvent("click",{clientX:T.left+T.width*.5,clientY:T.top+T.height*.5,layerY:T.top+T.height*.5}),N=E.clientX-80,L=E.clientY-20;f.style.left=`${N}px`,f.style.top=`${L}px`,E.layerY>T.height-200&&(_.style.maxHeight=`${T.height-E.layerY-20}px`),requestAnimationFrame(function(){I.focus()}),s.show_all_on_open&&O();function A(M){if(M)if(a.onSearchBoxSelection)a.onSearchBoxSelection(M,E,r);else{if(!r.graph)throw new NullGraphError;r.graph.beforeChange();const P=LiteGraph.createNode(M);if(P&&(P.pos=r.convertEventToCanvasOffset(E),r.graph.add(P,!1)),s.node_from){let R=!1;switch(typeof s.slot_from){case"string":R=s.node_from.findOutputSlot(s.slot_from);break;case"object":if(s.slot_from==null)throw new TypeError("options.slot_from was null when showing search box");R=s.slot_from.name?s.node_from.findOutputSlot(s.slot_from.name):-1,R==-1&&s.slot_from.slot_index!==void 0&&(R=s.slot_from.slot_index);break;case"number":R=s.slot_from;break;default:R=0}if(s.node_from.outputs[R]!==void 0&&R!==!1&&R>-1){if(P==null)throw new TypeError("options.slot_from was null when showing search box");s.node_from.connectByType(R,P,s.node_from.outputs[R].type)}}if(s.node_to){let R=!1;switch(typeof s.slot_from){case"string":R=s.node_to.findInputSlot(s.slot_from);break;case"object":if(s.slot_from==null)throw new TypeError("options.slot_from was null when showing search box");R=s.slot_from.name?s.node_to.findInputSlot(s.slot_from.name):-1,R==-1&&s.slot_from.slot_index!==void 0&&(R=s.slot_from.slot_index);break;case"number":R=s.slot_from;break;default:R=0}if(s.node_to.inputs[R]!==void 0&&R!==!1&&R>-1){if(P==null)throw new TypeError("options.slot_from was null when showing search box");s.node_to.connectByTypeOutput(R,P,s.node_to.inputs[R].type)}}r.graph.afterChange()}f.close()}p(A,"select");function D(M){const P=S;S?S instanceof Element&&(S.classList.remove("selected"),S=M?S.nextSibling:S.previousSibling,S||=P):S=M?_.childNodes[0]:_.childNodes[_.childNodes.length],S instanceof Element&&(S.classList.add("selected"),S.scrollIntoView({block:"end",behavior:"smooth"}))}p(D,"changeSelection");function O(){k=null;let M=I.value;if(w=null,_.innerHTML="",!M&&!s.show_all_if_empty)return;if(a.onSearchBox){const R=a.onSearchBox(_,M,r);if(R)for(const V of R)P(V)}else{let R=p(function(H,W){W=W||{};const Q=Object.assign({skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},W),q=LiteGraph.registered_node_types[H];if($&&q.filter!=$||(!s.show_all_if_empty||M)&&!H.toLowerCase().includes(M)&&(!q.title||!q.title.toLowerCase().includes(M)))return!1;if(s.do_type_filter&&!Q.skipFilter){const ee=H;let Y=Q.inTypeOverride!==!1?Q.inTypeOverride:F.value;if(F&&Y&&LiteGraph.registered_slot_in_types[Y]?.nodes&&LiteGraph.registered_slot_in_types[Y].nodes.includes(ee)===!1||(Y=j.value,Q.outTypeOverride!==!1&&(Y=Q.outTypeOverride),j&&Y&&LiteGraph.registered_slot_out_types[Y]?.nodes&&LiteGraph.registered_slot_out_types[Y].nodes.includes(ee)===!1))return!1}return!0},"inner_test_filter"),V=0;if(M=M.toLowerCase(),!r.graph)throw new NullGraphError;const $=r.filter||r.graph.filter;let F=!1,j=!1;s.do_type_filter&&a.search_box&&(F=a.search_box.querySelector(".slot_in_type_filter"),j=a.search_box.querySelector(".slot_out_type_filter"));const G=Object.keys(LiteGraph.registered_node_types).filter(H=>R(H));for(const H of G)if(P(H),LGraphCanvas.search_limit!==-1&&V++>LGraphCanvas.search_limit)break;if(s.show_general_after_typefiltered&&(F.value||j.value)){filtered_extra=[];for(const H in LiteGraph.registered_node_types)R(H,{inTypeOverride:F&&F.value?"*":!1,outTypeOverride:j&&j.value?"*":!1})&&filtered_extra.push(H);for(const H of filtered_extra)if(P(H,"generic_type"),LGraphCanvas.search_limit!==-1&&V++>LGraphCanvas.search_limit)break}if((F.value||j.value)&&_.childNodes.length==0&&s.show_general_if_none_on_typefilter){filtered_extra=[];for(const H in LiteGraph.registered_node_types)R(H,{skipFilter:!0})&&filtered_extra.push(H);for(const H of filtered_extra)if(P(H,"not_in_filter"),LGraphCanvas.search_limit!==-1&&V++>LGraphCanvas.search_limit)break}}function P(R,V){const $=document.createElement("div");w||=R;const F=LiteGraph.registered_node_types[R];if(F?.title){$.textContent=F?.title;const j=document.createElement("span");j.className="litegraph lite-search-item-type",j.textContent=R,$.append(j)}else $.textContent=R;$.dataset.type=escape(R),$.className="litegraph lite-search-item",V&&($.className+=` ${V}`),$.addEventListener("click",function(){A(unescape(String(this.dataset.type)))}),_.append($)}p(P,"addResult")}return p(O,"refreshHelper"),f}showEditPropertyValue(o,n,s){if(!o||o.properties[n]===void 0)return;s=s||{};const a=o.getPropertyInfo(n),{type:r}=a;let l="";if(r=="string"||r=="number"||r=="array"||r=="object")l="<input autofocus type='text' class='value'/>";else if((r=="enum"||r=="combo")&&a.values){l="<select autofocus type='text' class='value'>";for(const w in a.values){const k=Array.isArray(a.values)?a.values[w]:w,S=k==o.properties[n]?"selected":"";l+=`<option value='${k}' ${S}>${a.values[w]}</option>`}l+="</select>"}else if(r=="boolean"||r=="toggle")l=`<input autofocus type='checkbox' class='value' ${o.properties[n]?"checked":""}/>`;else{console.warn(`unknown type: ${r}`);return}const u=this.createDialog(`<span class='name'>${a.label||n}</span>${l}<button>OK</button>`,s);let m;if((r=="enum"||r=="combo")&&a.values)m=u.querySelector("select"),m?.addEventListener("change",function(w){u.modified(),b(w.target?.value)});else if(r=="boolean"||r=="toggle")m=u.querySelector("input"),m?.addEventListener("click",function(){u.modified(),b(!!m.checked)});else if(m=u.querySelector("input"),m){m.addEventListener("blur",function(){this.focus()});let w=o.properties[n]!==void 0?o.properties[n]:"";r!=="string"&&(w=JSON.stringify(w)),m.value=w,m.addEventListener("keydown",function(k){if(k.key=="Escape")u.close();else if(k.key=="Enter")_();else{u.modified();return}k.preventDefault(),k.stopPropagation()})}m?.focus();const f=u.querySelector("button");if(!f)throw new TypeError("Show edit property value button was null.");f.addEventListener("click",_);function _(){b(m?.value)}p(_,"inner");const y=p(()=>this.#a(),"dirty");function b(w){a?.values&&typeof a.values=="object"&&a.values[w]!=null&&(w=a.values[w]),typeof o.properties[n]=="number"&&(w=Number(w)),(r=="array"||r=="object")&&(w=JSON.parse(w)),o.properties[n]=w,o.graph&&o.graph._version++,o.onPropertyChanged?.(n,w),s.onclose?.(),u.close(),y()}return p(b,"setValue"),u}createDialog(o,n){n=Object.assign({checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0},n||{});const a={className:"graphdialog",innerHTML:o,is_modified:!1,modified(){this.is_modified=!0},close(){this.remove()}},r=document.createElement("div"),l=Object.assign(r,a),u=this.canvas.getBoundingClientRect();let m=-20,f=-20;if(u&&(m-=u.left,f-=u.top),n.position?(m+=n.position[0],f+=n.position[1]):n.event?(m+=n.event.clientX,f+=n.event.clientY):(m+=this.canvas.width*.5,f+=this.canvas.height*.5),l.style.left=`${m}px`,l.style.top=`${f}px`,!this.canvas.parentNode)throw new TypeError("Canvas parent element was null.");if(this.canvas.parentNode.append(l),n.checkForInput){const w=l.querySelectorAll("input");if(w)for(const k of w)k.addEventListener("keydown",function(S){if(l.modified(),S.key=="Escape")l.close();else if(S.key!="Enter")return;S.preventDefault(),S.stopPropagation()}),k.focus()}let _,y=0;l.addEventListener("mouseleave",function(){y||!l.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(_=setTimeout(l.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),l.addEventListener("mouseenter",function(){(n.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&_&&clearTimeout(_)});const b=l.querySelectorAll("select");if(b)for(const w of b)w.addEventListener("click",function(){y++}),w.addEventListener("blur",function(){y=0}),w.addEventListener("change",function(){y=-1});return l}createPanel(o,n){n=n||{};const s=n.window||window,a=document.createElement("div");if(a.className="litegraph dialog",a.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",a.header=a.querySelector(".dialog-header"),n.width&&(a.style.width=n.width+(typeof n.width=="number"?"px":"")),n.height&&(a.style.height=n.height+(typeof n.height=="number"?"px":"")),n.closable){const r=document.createElement("span");r.innerHTML="&#10005;",r.classList.add("close"),r.addEventListener("click",function(){a.close()}),a.header.append(r)}return a.title_element=a.querySelector(".dialog-title"),a.title_element.textContent=o,a.content=a.querySelector(".dialog-content"),a.alt_content=a.querySelector(".dialog-alt-content"),a.footer=a.querySelector(".dialog-footer"),a.footer.style.marginTop="-96px",a.close=function(){typeof a.onClose=="function"&&a.onClose(),a.remove(),this.remove()},a.toggleAltContent=function(r){let l,u;r!==void 0?(l=r?"block":"none",u=r?"none":"block"):(l=a.alt_content.style.display!="block"?"block":"none",u=a.alt_content.style.display!="block"?"none":"block"),a.alt_content.style.display=l,a.content.style.display=u},a.toggleFooterVisibility=function(r){let l;r!==void 0?l=r?"block":"none":l=a.footer.style.display!="block"?"block":"none",a.footer.style.display=l},a.clear=function(){this.content.innerHTML=""},a.addHTML=function(r,l,u){const m=document.createElement("div");return l&&(m.className=l),m.innerHTML=r,u?a.footer.append(m):a.content.append(m),m},a.addButton=function(r,l,u){const m=document.createElement("button");return m.textContent=r,m.options=u,m.classList.add("btn"),m.addEventListener("click",l),a.footer.append(m),m},a.addSeparator=function(){const r=document.createElement("div");r.className="separator",a.content.append(r)},a.addWidget=function(r,l,u,m,f){m=m||{};let _=String(u);r=r.toLowerCase(),r=="number"&&typeof u=="number"&&(_=u.toFixed(3));const y=document.createElement("div");y.className="property",y.innerHTML="<span class='property_name'></span><span class='property_value'></span>";const b=y.querySelector(".property_name");if(!b)throw new TypeError("Property name element was null.");b.textContent=m.label||l;const w=y.querySelector(".property_value");if(!w)throw new TypeError("Property name element was null.");if(w.textContent=_,y.dataset.property=l,y.dataset.type=m.type||r,y.options=m,y.value=u,r=="code")y.addEventListener("click",function(){a.inner_showCodePad(this.dataset.property)});else if(r=="boolean")y.classList.add("boolean"),u&&y.classList.add("bool-on"),y.addEventListener("click",()=>{const S=y.dataset.property;if(y.value=!y.value,y.classList.toggle("bool-on"),!w)throw new TypeError("Property name element was null.");w.textContent=y.value?"true":"false",k(S,y.value)});else if(r=="string"||r=="number"){if(!w)throw new TypeError("Property name element was null.");w.setAttribute("contenteditable","true"),w.addEventListener("keydown",function(S){S.code=="Enter"&&(r!="string"||!S.shiftKey)&&(S.preventDefault(),this.blur())}),w.addEventListener("blur",function(){let S=this.textContent;const C=this.parentElement?.dataset.property;this.parentElement?.dataset.type=="number"&&(S=Number(S)),k(C,S)})}else if(r=="enum"||r=="combo"){const S=LGraphCanvas.getPropertyPrintableValue(u,m.values);if(!w)throw new TypeError("Property name element was null.");w.textContent=S??"",w.addEventListener("click",function(C){const I=m.values||[],T=this.parentElement?.dataset.property,E=p(N=>(this.textContent=N,k(T,N),!1),"inner_clicked");new LiteGraph.ContextMenu(I,{event:C,className:"dark",callback:E},s)})}a.content.append(y);function k(S,C){m.callback?.(S,C,m),f?.(S,C,m)}return p(k,"innerChange"),y},typeof a.onOpen=="function"&&a.onOpen(),a}closePanels(){document.querySelector("#node-panel")?.close?.(),document.querySelector("#option-panel")?.close?.()}showShowNodePanel(o){this.SELECTED_NODE=o,this.closePanels();const n=this.getCanvasWindow(),s=this.createPanel(o.title||"",{closable:!0,window:n,onOpen:p(()=>{this.NODEPANEL_IS_OPEN=!0},"onOpen"),onClose:p(()=>{this.NODEPANEL_IS_OPEN=!1,this.node_panel=null},"onClose")});this.node_panel=s,s.id="node-panel",s.node=o,s.classList.add("settings"),s.style.position="absolute",s.style.top="96px",s.style.left="65px";const a=p(()=>{s.content.innerHTML="",s.addHTML(`<span class='node_type'>${o.type}</span><span class='node_desc'>${o.constructor.desc||""}</span><span class='separator'></span>`),s.addHTML("<h3>Properties</h3>");const r=p((m,f)=>{if(!this.graph)throw new NullGraphError;switch(this.graph.beforeChange(o),m){case"Title":if(typeof f!="string")throw new TypeError("Attempting to set title to non-string value.");o.title=f;break;case"Mode":{if(typeof f!="string")throw new TypeError("Attempting to set mode to non-string value.");const _=Object.values(LiteGraph.NODE_MODES).indexOf(f);_!==-1&&LiteGraph.NODE_MODES[_]?o.changeMode(_):console.warn(`unexpected mode: ${f}`);break}case"Color":if(typeof f!="string")throw new TypeError("Attempting to set colour to non-string value.");LGraphCanvas.node_colors[f]?(o.color=LGraphCanvas.node_colors[f].color,o.bgcolor=LGraphCanvas.node_colors[f].bgcolor):console.warn(`unexpected color: ${f}`);break;default:o.setProperty(m,f);break}this.graph.afterChange(),this.dirty_canvas=!0},"fUpdate");s.addWidget("string","Title",o.title,{},r);const l=o.mode==null?void 0:LiteGraph.NODE_MODES[o.mode];s.addWidget("combo","Mode",l,{values:LiteGraph.NODE_MODES},r);const u=o.color!==void 0?Object.keys(LGraphCanvas.node_colors).filter(function(m){return LGraphCanvas.node_colors[m].color==o.color}):"";s.addWidget("combo","Color",u,{values:Object.keys(LGraphCanvas.node_colors)},r);for(const m in o.properties){const f=o.properties[m],_=o.getPropertyInfo(m);o.onAddPropertyToPanel?.(m,s)||s.addWidget(_.widget||_.type,m,f,_,r)}s.addSeparator(),o.onShowCustomPanelInfo?.(s),s.footer.innerHTML="",s.addButton("Delete",function(){if(!o.block_delete){if(!o.graph)throw new NullGraphError;o.graph.remove(o),s.close()}}).classList.add("delete")},"inner_refresh");if(s.inner_showCodePad=function(r){s.classList.remove("settings"),s.classList.add("centered"),s.alt_content.innerHTML="<textarea class='code'></textarea>";const l=s.alt_content.querySelector("textarea"),u=p(function(){s.toggleAltContent(!1),s.toggleFooterVisibility(!0),l.remove(),s.classList.add("settings"),s.classList.remove("centered"),a()},"fDoneWith");l.value=String(o.properties[r]),l.addEventListener("keydown",function(_){_.code=="Enter"&&_.ctrlKey&&(o.setProperty(r,l.value),u())}),s.toggleAltContent(!0),s.toggleFooterVisibility(!1),l.style.height="calc(100% - 40px)";const m=s.addButton("Assign",function(){o.setProperty(r,l.value),u()});s.alt_content.append(m);const f=s.addButton("Close",u);f.style.float="right",s.alt_content.append(f)},a(),!this.canvas.parentNode)throw new TypeError("showNodePanel - this.canvas.parentNode was null");this.canvas.parentNode.append(s)}checkPanels(){if(!this.canvas)return;if(!this.canvas.parentNode)throw new TypeError("checkPanels - this.canvas.parentNode was null");const o=this.canvas.parentNode.querySelectorAll(".litegraph.dialog");for(const n of o)n.node&&(!n.node.graph||n.graph!=this.graph)&&n.close()}getCanvasMenuOptions(){let o;this.getMenuOptions?o=this.getMenuOptions():(o=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd},{content:"Paste",callback:p(()=>{this.pasteFromClipboard()},"callback")}],Object.keys(this.selected_nodes).length>1&&o.push({content:"Convert to Subgraph",callback:p(()=>{if(!this.selectedItems.size)throw new Error("Convert to Subgraph: Nothing selected.");this._graph.convertToSubgraph(this.selectedItems)},"callback")},{content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}));const n=this.getExtraMenuOptions?.(this,o);return Array.isArray(n)?o.concat(n):o}getNodeMenuOptions(o){let n;o.getMenuOptions?n=o.getMenuOptions(this):(n=[{content:"Convert to Subgraph",callback:p(()=>{if(this.selectedItems.size){let a=!1;for(const r of this.selectedItems){const l=r;if(typeof l.type=="string"&&l.type.startsWith(`${PREFIX}${SEPARATOR}`)&&l.convertToNodes){a=!0;const m=l.convertToNodes();requestAnimationFrame(()=>{if(this.selectItems(m,!0),!this.selectedItems.size)throw new Error("Convert to Subgraph: Nothing selected.");this._graph.convertToSubgraph(this.selectedItems)});return}}if(!a){if(!this.selectedItems.size)throw new Error("Convert to Subgraph: Nothing selected.");this._graph.convertToSubgraph(this.selectedItems)}}else throw new Error("Convert to Subgraph: Nothing selected.")},"callback")},{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},{content:"Properties Panel",callback:p(function(a,r,l,u,m){LGraphCanvas.active_canvas.showShowNodePanel(m)},"callback")},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],o.resizable!==!1&&n.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),o.collapsible&&n.push({content:o.collapsed?"Expand":"Collapse",callback:LGraphCanvas.onMenuNodeCollapse}),o.widgets?.some(a=>a.advanced)&&n.push({content:o.showAdvanced?"Hide Advanced":"Show Advanced",callback:LGraphCanvas.onMenuToggleAdvanced}),n.push({content:o.pinned?"Unpin":"Pin",callback:p(()=>{for(const a in this.selected_nodes)this.selected_nodes[a].pin();this.setDirty(!0,!0)},"callback")},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null));const s=o.getExtraMenuOptions?.(this,n);return Array.isArray(s)&&s.length>0&&(s.push(null),n=s.concat(n)),o.clonable!==!1&&n.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&n.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign},{content:"Distribute Nodes",has_submenu:!0,callback:LGraphCanvas.createDistributeMenu}),n.push(null,{content:"Remove",disabled:!(o.removable!==!1&&!o.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),o.graph?.onGetNodeMenuOptions?.(n,o),n}getGroupMenuOptions(o){return console.warn("LGraphCanvas.getGroupMenuOptions is deprecated, use LGraphGroup.getMenuOptions instead"),o.getMenuOptions()}processContextMenu(o,n){const a=LGraphCanvas.active_canvas.getCanvasWindow();let r;const l={event:n,callback:f,extra:o};if(o){l.title=o.displayType??o.type??void 0,LGraphCanvas.active_node=o;const _=o.getSlotInPosition(n.canvasX,n.canvasY);if(_){if(r=[],o.getSlotMenuOptions)r=o.getSlotMenuOptions(_);else{(_.output?.links?.length||_.input?.link!=null)&&r.push({content:"Disconnect Links",slot:_});const y=_.input||_.output;if(!y)throw new TypeError("Both in put and output slots were null when processing context menu.");!y.nameLocked&&!("link"in y&&y.widget)&&r.push({content:"Rename Slot",slot:_}),y.removable&&(r.push(null),r.push(y.locked?"Cannot remove":{content:"Remove Slot",slot:_,className:"danger"})),o.getExtraSlotMenuOptions&&r.push(...o.getExtraSlotMenuOptions(_))}l.title=(_.input?_.input.type:_.output.type)||"*",_.input&&_.input.type==LiteGraph.ACTION&&(l.title="Action"),_.output&&_.output.type==LiteGraph.EVENT&&(l.title="Event")}else r=this.getNodeMenuOptions(o)}else{if(r=this.getCanvasMenuOptions(),!this.graph)throw new NullGraphError;if(this.links_render_mode!==LinkRenderType.HIDDEN_LINK){const y=layoutStore.queryRerouteAtPoint({x:n.canvasX,y:n.canvasY});let b;y?b=this.graph.getReroute(y.id):b=this.graph.getRerouteOnPos(n.canvasX,n.canvasY,this.#s),b&&r.unshift({content:"Delete Reroute",callback:p(()=>{if(!this.graph)throw new NullGraphError;this.graph.removeReroute(b.id)},"callback")},null)}const _=this.graph.getGroupOnPos(n.canvasX,n.canvasY);_&&r.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:_,options:_.getMenuOptions()}})}if(!r)return;new LiteGraph.ContextMenu(r,l,a);const u=p(_=>this.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",_),"createDialog"),m=p(()=>this.setDirty(!0),"setDirty");function f(_,y){if(_){if(_.content=="Remove Slot"){if(!o?.graph)throw new NullGraphError;const b=_.slot;if(!b)throw new TypeError("Found-slot info was null when processing context menu.");o.graph.beforeChange(),b.input?o.removeInput(b.slot):b.output&&o.removeOutput(b.slot),o.graph.afterChange();return}else if(_.content=="Disconnect Links"){if(!o?.graph)throw new NullGraphError;const b=_.slot;if(!b)throw new TypeError("Found-slot info was null when processing context menu.");o.graph.beforeChange(),b.output?o.disconnectOutput(b.slot):b.input&&o.disconnectInput(b.slot,!0),o.graph.afterChange();return}else if(_.content=="Rename Slot"){if(!o)throw new TypeError("`node` was null when processing the context menu.");const b=_.slot;if(!b)throw new TypeError("Found-slot info was null when processing context menu.");const w=b.input?o.getInputInfo(b.slot):o.getOutputInfo(b.slot),k=u(y),S=k.querySelector("input");S&&w&&(S.value=w.label||"");const C=p(function(){if(!o.graph)throw new NullGraphError;o.graph.beforeChange(),S?.value&&(w&&(w.label=S.value),m()),k.close(),o.graph.afterChange()},"inner");if(k.querySelector("button")?.addEventListener("click",C),!S)throw new TypeError("Input element was null when processing context menu.");S.addEventListener("keydown",function(I){if(k.is_modified=!0,I.key=="Escape")k.close();else if(I.key=="Enter")C();else if(I.target.localName!="textarea")return;I.preventDefault(),I.stopPropagation()}),S.focus()}}}p(f,"inner_option_clicked")}animateToBounds(o,n={}){const s=p(()=>this.setDirty(!0,!0),"setDirty");this.ds.animateToBounds(o,s,n)}fitViewToSelectionAnimated(o={}){const n=this.selectedItems.size?Array.from(this.selectedItems):this.positionableItems,s=createBounds(n);if(!s)throw new TypeError("Attempted to fit to view but could not calculate bounds.");const a=p(()=>this.setDirty(!0,!0),"setDirty");this.ds.animateToBounds(s,a,o)}calculateNewPosition(o,n,s){return{x:o.pos[0]+n,y:o.pos[1]+s}}applyNodePositionUpdates(o,n){for(const{node:s,newPos:a}of o)s.pos[0]=a.x,s.pos[1]=a.y,n.moveNode(s.id,a)}initLayoutMutations(){const o=useLayoutMutations();return o.setSource(LayoutSource.Canvas),o}collectNodesInGroups(o){const n=new Set;for(const s of o)if(s instanceof LGraphGroup)for(const a of s._children)a instanceof LGraphNode&&n.add(a);return n}moveGroupChildren(o,n,s,a){for(const r of o._children)if(r instanceof LGraphNode){const l=r;a.push({node:l,newPos:this.calculateNewPosition(l,n,s)})}else r.move(n,s)}moveChildNodesInGroupVueMode(o,n,s){const a=this.initLayoutMutations(),r=this.collectNodesInGroups(o),l=[];for(const u of o)if(u instanceof LGraphNode){const f=u;if(r.has(f))continue;l.push({node:f,newPos:this.calculateNewPosition(f,n,s)})}else u instanceof LGraphGroup?(u.move(n,s,!0),this.moveGroupChildren(u,n,s,l)):u.move(n,s,!0);this.applyNodePositionUpdates(l,a)}repositionNodesVueMode(o){const n=this.initLayoutMutations();this.applyNodePositionUpdates(o,n)}}class MapProxyHandler{static{p(this,"MapProxyHandler")}getOwnPropertyDescriptor(o,n){const s=this.get(o,n);if(s)return{configurable:!0,enumerable:!0,value:s}}has(o,n){if(typeof n=="symbol")return!1;const s=parseInt(n,10);return o.has(isNaN(s)?n:s)}ownKeys(o){return[...o.keys()].map(String)}get(o,n){if(n in o)return Reflect.get(o,n,o);if(typeof n=="symbol")return;const s=parseInt(n,10);return o.get(isNaN(s)?n:s)}set(o,n,s){if(typeof n=="symbol")return!1;const a=parseInt(n,10);return o.set(isNaN(a)?n:a,s),!0}deleteProperty(o,n){return o.delete(n)}static bindAllMethods(o){o.clear=o.clear.bind(o),o.delete=o.delete.bind(o),o.forEach=o.forEach.bind(o),o.get=o.get.bind(o),o.has=o.has.bind(o),o.set=o.set.bind(o),o.entries=o.entries.bind(o),o.keys=o.keys.bind(o),o.values=o.values.bind(o),o[Symbol.iterator]=o[Symbol.iterator].bind(o)}}class LGraph{static{p(this,"LGraph")}static serialisedSchemaVersion=1;static STATUS_STOPPED=1;static STATUS_RUNNING=2;static ConfigureProperties=new Set(["nodes","groups","links","state","reroutes","floatingLinks","id","subgraphs","definitions","inputs","outputs","widgets","inputNode","outputNode","extra"]);id=zeroUuid;revision=0;_version=-1;_links=new Map;links;list_of_graphcanvas;status=LGraph.STATUS_STOPPED;state={lastGroupId:0,lastNodeId:0,lastLinkId:0,lastRerouteId:0};events=new CustomEventTarget;_subgraphs=new Map;_nodes=[];_nodes_by_id={};_nodes_in_order=[];_nodes_executable=null;_groups=[];iteration=0;globaltime=0;runningtime=0;fixedtime=0;fixedtime_lapse=.01;elapsed_time=.01;last_update_time=0;starttime=0;catch_errors=!0;execution_timer_id;errors_in_execution;execution_time;_last_trigger_time;filter;config={};vars={};nodes_executing=[];nodes_actioning=[];nodes_executedAction=[];extra={};version;get empty(){return this._nodes.length+this._groups.length+this.reroutes.size===0}*positionableItems(){for(const o of this._nodes)yield o;for(const o of this._groups)yield o;for(const o of this.reroutes.values())yield o}#e=0;floatingLinksInternal=new Map;get floatingLinks(){return this.floatingLinksInternal}reroutesInternal=new Map;get reroutes(){return this.reroutesInternal}get rootGraph(){return this}get isRootGraph(){return this.rootGraph===this}get last_node_id(){return this.state.lastNodeId}set last_node_id(o){this.state.lastNodeId=o}get last_link_id(){return this.state.lastLinkId}set last_link_id(o){this.state.lastLinkId=o}onTrigger;_input_nodes;constructor(o){const n=this._links;MapProxyHandler.bindAllMethods(n);const s=new MapProxyHandler;this.links=new Proxy(n,s),this.list_of_graphcanvas=null,this.clear(),o&&this.configure(o)}clear(){if(this.stop(),this.status=LGraph.STATUS_STOPPED,this.id=zeroUuid,this.revision=0,this.state={lastGroupId:0,lastNodeId:0,lastLinkId:0,lastRerouteId:0},this._version=-1,this._subgraphs.clear(),this._nodes)for(const o of this._nodes)o.onRemoved?.(),this.onNodeRemoved?.(o);this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._links.clear(),this.reroutes.clear(),this.floatingLinksInternal.clear(),this.#e=0,this._groups=[],this.iteration=0,this.config={},this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[],this.change(),this.canvasAction(o=>o.clear())}get subgraphs(){return this.rootGraph._subgraphs}get nodes(){return this._nodes}get groups(){return this._groups}attachCanvas(o){if(!(o instanceof LGraphCanvas))throw new TypeError("attachCanvas expects an LGraphCanvas instance");this.primaryCanvas=o,this.list_of_graphcanvas??=[],this.list_of_graphcanvas.includes(o)||this.list_of_graphcanvas.push(o),o.graph!==this&&(o.graph?.detachCanvas(o),o.graph=this,o.subgraph=void 0)}detachCanvas(o){o.graph=null;const n=this.list_of_graphcanvas;if(n){const s=n.indexOf(o);s!==-1&&n.splice(s,1)}}start(o){if(this.status!=LGraph.STATUS_RUNNING)if(this.status=LGraph.STATUS_RUNNING,this.onPlayEvent?.(),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime,o||=0,o==0&&typeof window<"u"&&window.requestAnimationFrame){const n=p(()=>{this.execution_timer_id==-1&&(window.requestAnimationFrame(n),this.onBeforeStep?.(),this.runStep(1,!this.catch_errors),this.onAfterStep?.())},"on_frame");this.execution_timer_id=-1,n()}else this.execution_timer_id=setInterval(()=>{this.onBeforeStep?.(),this.runStep(1,!this.catch_errors),this.onAfterStep?.()},o)}stop(){this.status!=LGraph.STATUS_STOPPED&&(this.status=LGraph.STATUS_STOPPED,this.onStopEvent?.(),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))}runStep(o,n,s){o=o||1;const a=LiteGraph.getTime();this.globaltime=.001*(a-this.starttime);const r=this._nodes_executable||this._nodes;if(!r)return;if(s=s||r.length,n){for(let m=0;m<o;m++){for(let f=0;f<s;++f){const _=r[f];_.mode==LGraphEventMode.ALWAYS&&_.onExecute&&_.doExecute?.()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep?.()}this.onAfterExecute?.()}else try{for(let m=0;m<o;m++){for(let f=0;f<s;++f){const _=r[f];_.mode==LGraphEventMode.ALWAYS&&_.onExecute?.()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep?.()}this.onAfterExecute?.(),this.errors_in_execution=!1}catch(m){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw m;LiteGraph.debug&&console.error("Error during execution:",m),this.stop()}const l=LiteGraph.getTime();let u=l-a;u==0&&(u=1),this.execution_time=.001*u,this.globaltime+=.001*u,this.iteration+=1,this.elapsed_time=(l-this.last_update_time)*.001,this.last_update_time=l,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[]}updateExecutionOrder(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(const o of this._nodes_in_order)o.onExecute&&this._nodes_executable.push(o)}computeExecutionOrder(o,n){const s=[],a=[],r={},l={},u={};for(const f of this._nodes){if(o&&!f.onExecute)continue;r[f.id]=f;let _=0;if(f.inputs)for(const y of f.inputs)y?.link!=null&&(_+=1);_==0?(a.push(f),n&&(f._level=1)):(n&&(f._level=0),u[f.id]=_)}for(;;){const f=a.shift();if(f===void 0)break;if(s.push(f),delete r[f.id],!!f.outputs){for(const _ of f.outputs)if(!(_?.links==null||_.links.length==0))for(const y of _.links){const b=this._links.get(y);if(!b||l[b.id])continue;const w=this.getNodeById(b.target_id);if(w==null){l[b.id]=!0;continue}n&&(f._level??=0,(!w._level||w._level<=f._level)&&(w._level=f._level+1)),l[b.id]=!0,u[w.id]-=1,u[w.id]==0&&a.push(w)}}}for(const f in r)s.push(r[f]);s.length!=this._nodes.length&&LiteGraph.debug&&console.warn("something went wrong, nodes missing");function m(f){const _=f.length;for(let y=0;y<_;++y)f[y].order=y}return p(m,"setOrder"),m(s),s.sort(function(f,_){const y=f.constructor.priority||f.priority||0,b=_.constructor.priority||_.priority||0;return y==b?f.order-_.order:y-b}),m(s),s}arrange(o,n){o=o||100;const s=this.computeExecutionOrder(!1,!0),a=[];for(const l of s){const u=l._level||1;a[u]||=[],a[u].push(l)}let r=o;for(const l of a){if(!l)continue;let u=100,m=o+LiteGraph.NODE_TITLE_HEIGHT;for(const f of l){f.pos[0]=n==LiteGraph.VERTICAL_LAYOUT?m:r,f.pos[1]=n==LiteGraph.VERTICAL_LAYOUT?r:m;const _=n==LiteGraph.VERTICAL_LAYOUT?1:0;f.size[_]>u&&(u=f.size[_]);const y=n==LiteGraph.VERTICAL_LAYOUT?0:1;m+=f.size[y]+o+LiteGraph.NODE_TITLE_HEIGHT}r+=u+o}this.setDirtyCanvas(!0,!0)}getTime(){return this.globaltime}getFixedTime(){return this.fixedtime}getElapsedTime(){return this.elapsed_time}sendEventToAllNodes(o,n,s){s=s||LGraphEventMode.ALWAYS;const a=this._nodes_in_order||this._nodes;if(a)for(const r of a)!r[o]||r.mode!=s||(n===void 0?r[o]():n&&n.constructor===Array?r[o].apply(r,n):r[o](n))}canvasAction(o){const n=this.list_of_graphcanvas;if(n)for(const s of n)o(s)}sendActionToCanvas(o,n){const{list_of_graphcanvas:s}=this;if(s)for(const a of s)a[o]?.apply(a,n)}add(o,n){if(!o)return;const{state:s}=this;if(LiteGraph.alwaysSnapToGrid){const a=this.getSnapToGridSize();a&&o.snapToGrid(a)}if(o instanceof LGraphGroup){(o.id==null||o.id===-1)&&(o.id=++s.lastGroupId),o.id>s.lastGroupId&&(s.lastGroupId=o.id),this._groups.push(o),this.setDirtyCanvas(!0),this.change(),o.graph=this,this._version++;return}if(o.id!=-1&&this._nodes_by_id[o.id]!=null&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),o.id=LiteGraph.use_uuids?LiteGraph.uuidv4():++s.lastNodeId),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return LiteGraph.use_uuids?(o.id==null||o.id==-1)&&(o.id=LiteGraph.uuidv4()):o.id==null||o.id==-1?o.id=++s.lastNodeId:typeof o.id=="number"&&s.lastNodeId<o.id&&(s.lastNodeId=o.id),o.graph=this,this._version++,this._nodes.push(o),this._nodes_by_id[o.id]=o,o.onAdded?.(this),this.config.align_to_grid&&o.alignToGrid(),n||this.updateExecutionOrder(),this.onNodeAdded?.(o),this.setDirtyCanvas(!0),this.change(),o}remove(o){if(o instanceof LGraphGroup){this.canvasAction(u=>u.deselect(o));const l=this._groups.indexOf(o);l!=-1&&this._groups.splice(l,1),o.graph=void 0,this._version++,this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[o.id]==null){console.warn("LiteGraph: node not found",o);return}if(o.ignore_remove){console.warn("LiteGraph: node cannot be removed",o);return}this.beforeChange();const{inputs:n,outputs:s}=o;if(n)for(const[l,u]of n.entries())u.link!=null&&o.disconnectInput(l,!0);if(s)for(const[l,u]of s.entries())u.links?.length&&o.disconnectOutput(l);for(const l of this.floatingLinks.values())(l.origin_id===o.id||l.target_id===o.id)&&this.removeFloatingLink(l);o.onRemoved?.(),o.graph=null,this._version++;const{list_of_graphcanvas:a}=this;if(a)for(const l of a)l.selected_nodes[o.id]&&delete l.selected_nodes[o.id],l.deselect(o);const r=this._nodes.indexOf(o);r!=-1&&this._nodes.splice(r,1),delete this._nodes_by_id[o.id],this.onNodeRemoved?.(o),this.canvasAction(l=>l.checkPanels()),this.setDirtyCanvas(!0,!0),this.afterChange(),this.change(),this.updateExecutionOrder()}getNodeById(o){return o!=null?this._nodes_by_id[o]:null}findNodesByClass(o,n){n=n||[],n.length=0;const{_nodes:s}=this;for(const a of s)a.constructor===o&&n.push(a);return n}findNodesByType(o,n){const s=o.toLowerCase();n=n||[],n.length=0;const{_nodes:a}=this;for(const r of a)r.type?.toLowerCase()==s&&n.push(r);return n}findNodeByTitle(o){const{_nodes:n}=this;for(const s of n)if(s.title==o)return s;return null}findNodesByTitle(o){const n=[],{_nodes:s}=this;for(const a of s)a.title==o&&n.push(a);return n}getNodeOnPos(o,n,s){const a=s||this._nodes;let r=a.length;for(;--r>=0;){const l=a[r];if(l.isPointInside(o,n))return l}return null}getGroupOnPos(o,n){for(let s=this._groups.length-1;s>=0;s--){const a=this._groups[s];if(a.isPointInside(o,n))return a}}getGroupTitlebarOnPos(o,n){for(let s=this._groups.length-1;s>=0;s--){const a=this._groups[s];if(a.isPointInTitlebar(o,n))return a}}getRerouteOnPos(o,n,s){for(const a of s??this.reroutes.values())if(a.containsPoint([o,n]))return a}snapToGrid(o){const n=this.getSnapToGridSize();if(n)for(const s of getAllNestedItems(o))s.pinned||s.snapToGrid(n)}getSnapToGridSize(){return LiteGraph.alwaysSnapToGrid?LiteGraph.CANVAS_GRID_SIZE||1:LiteGraph.CANVAS_GRID_SIZE}checkNodeTypes(){const{_nodes:o}=this;for(const[n,s]of o.entries()){const a=LiteGraph.registered_node_types[s.type];if(s.constructor==a)continue;console.warn("node being replaced by newer version:",s.type);const r=LiteGraph.createNode(s.type);r&&(o[n]=r,r.configure(s.serialize()),r.graph=this,this._nodes_by_id[r.id]=r,s.inputs&&(r.inputs=[...s.inputs]),s.outputs&&(r.outputs=[...s.outputs]))}this.updateExecutionOrder()}trigger(o,n){new Set(["node:slot-links:changed","node:slot-errors:changed","node:property:changed"]).has(o)&&n&&typeof n=="object"&&this.onTrigger?.({type:o,...n})}triggerInput(o,n){const s=this.findNodesByTitle(o);for(const a of s)a.onTrigger(n)}setCallback(o,n){const s=this.findNodesByTitle(o);for(const a of s)a.setTrigger(n)}beforeChange(o){this.onBeforeChange?.(this,o),this.canvasAction(n=>n.onBeforeChange?.(this))}afterChange(o){this.onAfterChange?.(this,o),this.canvasAction(n=>n.onAfterChange?.(this))}clearTriggeredSlots(){for(const o of this._links.values())o&&o._last_time&&(o._last_time=0)}change(){this.canvasAction(o=>o.setDirty(!0,!0)),this.on_change?.(this)}setDirtyCanvas(o,n){this.canvasAction(s=>s.setDirty(o,n))}addFloatingLink(o){o.id===-1&&(o.id=++this.#e),this.floatingLinksInternal.set(o.id,o);const n=o.target_id!==-1?this.getNodeById(o.target_id)?.inputs?.[o.target_slot]:this.getNodeById(o.origin_id)?.outputs?.[o.origin_slot];n?(n._floatingLinks??=new Set,n._floatingLinks.add(o)):console.warn(`Adding invalid floating link: target/slot: [${o.target_id}/${o.target_slot}] origin/slot: [${o.origin_id}/${o.origin_slot}]`);const s=LLink.getReroutes(this,o);for(const a of s)a.floatingLinkIds.add(o.id);return o}removeFloatingLink(o){this.floatingLinksInternal.delete(o.id);const n=o.target_id!==-1?this.getNodeById(o.target_id)?.inputs?.[o.target_slot]:this.getNodeById(o.origin_id)?.outputs?.[o.origin_slot];n&&n._floatingLinks?.delete(o);const s=LLink.getReroutes(this,o);for(const a of s)a.floatingLinkIds.delete(o.id),a.floatingLinkIds.size===0&&delete a.floating,a.totalLinks===0&&this.removeReroute(a.id)}getLink(o){return o==null?void 0:this._links.get(o)}getReroute(o){return o==null?void 0:this.reroutes.get(o)}setReroute({id:o,parentId:n,pos:s,linkIds:a,floating:r}){o??=++this.state.lastRerouteId,o>this.state.lastRerouteId&&(this.state.lastRerouteId=o);const l=this.reroutes.get(o)??new Reroute(o,this);return l.update(n,s,a,r),this.reroutes.set(o,l),l}createReroute(o,n){const s=useLayoutMutations(),a=++this.state.lastRerouteId,r=n instanceof Reroute?n.linkIds:[n.id],l=n instanceof Reroute?n.floatingLinkIds:[n.id],u=new Reroute(a,this,o,n.parentId,r,l);this.reroutes.set(a,u),s.setSource(LayoutSource.Canvas),s.createReroute(a,{x:o[0],y:o[1]},n.parentId,Array.from(r));for(const m of r){const f=this._links.get(m);if(!f)continue;f.parentId===n.parentId&&(f.parentId=a);const _=LLink.getReroutes(this,f);for(const y of _.filter(b=>b.parentId===n.parentId))y.parentId=a}for(const m of l){const f=this.floatingLinks.get(m);if(!f)continue;f.parentId===n.parentId&&(f.parentId=a);const _=LLink.getReroutes(this,f);for(const y of _.filter(b=>b.parentId===n.parentId))y.parentId=a}return u}removeReroute(o){const n=useLayoutMutations(),{reroutes:s}=this,a=s.get(o);if(!a)return;this.canvasAction(m=>m.deselect(a));const{parentId:r,linkIds:l,floatingLinkIds:u}=a;for(const m of s.values())m.parentId===o&&(m.parentId=r);for(const m of l){const f=this._links.get(m);f&&f.parentId===o&&(f.parentId=r)}for(const m of u){const f=this.floatingLinks.get(m);if(!f){console.warn(`Removed reroute had floating link ID that did not exist [${m}]`);continue}const _=LLink.getReroutes(this,f),y=_.at(-1),b=_.at(-2);a===y&&(b?.totalLinks!==1?this.removeFloatingLink(f):f.parentId===o&&(f.parentId=r,b.floating=a.floating))}s.delete(o),n.setSource(LayoutSource.Canvas),n.deleteReroute(o),this.setDirtyCanvas(!1,!0)}removeLink(o){const n=this._links.get(o);if(!n)return;this.getNodeById(n.target_id)?.disconnectInput(n.target_slot,!1),n.disconnect(this)}createSubgraph(o){const{id:n}=o,s=new Subgraph(this.rootGraph,o);return this.subgraphs.set(n,s),this.rootGraph.events.dispatch("subgraph-created",{subgraph:s,data:o}),s}convertToSubgraph(o){if(o.size===0)throw new Error("Cannot convert to subgraph: nothing to convert");const{state:n,revision:s,config:a}=this,r=[...o][0];o.size===1&&r instanceof LGraphGroup&&(o=new Set([r]),r.recomputeInsideNodes(),r.children.forEach($=>o.add($)));const{boundaryLinks:l,boundaryFloatingLinks:u,internalLinks:m,boundaryInputLinks:f,boundaryOutputLinks:_}=getBoundaryLinks(this,o),{nodes:y,reroutes:b,groups:w}=splitPositionables(o),k=createBounds(o);if(!k)throw new Error("Failed to create bounding rect for subgraph");const S=f.map($=>$.resolve(this)),C=_.map($=>$.resolve(this)),I=multiClone(y),T=m.map($=>$.asSerialisable()),E=mapSubgraphInputsAndLinks(S,T),N=mapSubgraphOutputsAndLinks(C,T),L={id:createUuidv4(),name:"New Subgraph",inputNode:{id:SUBGRAPH_INPUT_ID,bounding:[0,0,75,100]},outputNode:{id:SUBGRAPH_OUTPUT_ID,bounding:[0,0,75,100]},inputs:E,outputs:N,widgets:[],version:LGraph.serialisedSchemaVersion,state:n,revision:s,config:a,links:T,nodes:I,reroutes:structuredClone([...b].map($=>$.asSerialisable())),groups:structuredClone([...w].map($=>$.serialize()))},A=this.createSubgraph(L);A.configure(L);for(const $ of A.nodes)$.onGraphConfigured?.();for(const $ of A.nodes)$.onAfterGraphConfigured?.();A.inputNode.arrange(),A.outputNode.arrange();const{boundingRect:D}=A.inputNode,{boundingRect:O}=A.outputNode;alignOutsideContainer(D,Alignment.MidLeft,k,[50,0]),alignOutsideContainer(O,Alignment.MidRight,k,[50,0]);for(const $ of S)$.inputNode?.disconnectInput($.inputNode.inputs.indexOf($.input),!0);for(const $ of C)$.outputNode?.disconnectOutput($.outputNode.outputs.indexOf($.output),$.inputNode);for(const $ of y)this.remove($);for(const $ of b)this.removeReroute($.id);for(const $ of w)this.remove($);this.rootGraph.events.dispatch("convert-to-subgraph",{subgraph:A,bounds:k,exportedSubgraph:L,boundaryLinks:l,resolvedInputLinks:S,resolvedOutputLinks:C,boundaryFloatingLinks:u,internalLinks:m});const M=LiteGraph.createNode(A.id,A.name,{outputs:structuredClone(N)});if(!M)throw new Error("Failed to create subgraph node");for(let $=0;$<E.length;$++)Object.assign(M.inputs[$],E[$]);M.setSize(M.computeSize()),alignToContainer(M._posSize,Alignment.Centre|Alignment.Middle,k),M.pos[1]+=LiteGraph.NODE_TITLE_HEIGHT/2,this.add(M);const P=groupResolvedByOutput(S);let R=0;for(const[,$]of P.entries()){const[F,...j]=$,{output:U,outputNode:G,link:H,subgraphInput:W}=F;if(R++,H.origin_id===SUBGRAPH_INPUT_ID){if(H.target_id=M.id,H.target_slot=R-1,W instanceof SubgraphInput)W.connect(M.findInputSlotByType(H.type,!0,!0),M,H.parentId);else throw new TypeError("Subgraph input node is not a SubgraphInput");for(const Q of j)Q.link.disconnect(this);continue}if(!U||!G){console.warn("Convert to Subgraph reconnect: Failed to resolve input link",$[0]);continue}const X=M.inputs[R-1];G.connectSlots(U,M,X,H.parentId)}const V=groupResolvedByOutput(C);R=0;for(const[,$]of V.entries()){R++;for(const F of $){const{input:j,inputNode:U,link:G,subgraphOutput:H}=F;if(G.target_id===SUBGRAPH_OUTPUT_ID){if(G.origin_id=M.id,G.origin_slot=R-1,this.links.set(G.id,G),H instanceof SubgraphOutput)H.connect(M.findOutputSlotByType(G.type,!0,!0),M,G.parentId);else throw new TypeError("Subgraph input node is not a SubgraphInput");continue}if(!j||!U){console.warn("Convert to Subgraph reconnect: Failed to resolve output link",F);continue}const W=M.outputs[R-1];M.connectSlots(W,U,j,G.parentId)}}return M._setConcreteSlots(),M.arrange(),this.canvasAction($=>$.canvas.dispatchEvent(new CustomEvent("subgraph-converted",{bubbles:!0,detail:{subgraphNode:M}}))),{subgraph:A,node:M}}unpackSubgraph(o){if(!(o instanceof SubgraphNode))throw new Error("Can only unpack Subgraph Nodes");this.beforeChange();const n=[...o.subgraph.nodes,...o.subgraph.reroutes.values(),...o.subgraph.groups].map(k=>({boundingRect:[k.pos[0],k.pos[1],k.size?.[0]??0,k.size?.[1]??0]})),s=createBounds(n)??[0,0,0,0],a=[s[0]+s[2]/2,s[1]+s[3]/2],r=[],l=o.pos[0]-a[0]+o.size[0]/2,u=o.pos[1]-a[1]+o.size[1]/2,m=multiClone(o.subgraph.nodes),f=new Map;for(const k of m){const S=LiteGraph.createNode(String(k.type),k.title);if(!S)throw new Error("Node not found");f.set(k.id,++this.last_node_id),S.id=this.last_node_id,k.id=this.last_node_id,this.add(S,!0),S.configure(k),S.pos[0]+=l,S.pos[1]+=u;for(const C of S.inputs)C.link=null;for(const C of S.outputs)C.links=[];r.push(S)}const _=structuredClone([...o.subgraph.groups].map(k=>k.serialize()));for(const k of _){const S=new LGraphGroup(k.title,k.id);this.add(S,!0),S.configure(k),S.pos[0]+=l,S.pos[1]+=u,r.push(S)}for(const k of o.inputs){if(!k.link)continue;const S=this.links.get(k.link);if(!S){console.warn("Broken link",k,k.link);continue}for(const C of LLink.getReroutes(this,S))C.linkIds.delete(S.id)}for(const k of o.outputs)for(const S of k.links??[]){const C=this.links.get(S);if(!C){console.warn("Broken link",k,S);continue}for(const I of LLink.getReroutes(this,C))I.linkIds.delete(C.id)}const y=[];for(const[,k]of o.subgraph._links){let S;if(k.origin_id===SUBGRAPH_INPUT_ID){const C=o.inputs[k.origin_slot].link;if(!C){console.error("Missing Link ID when unpacking");continue}const I=this.links[C];k.origin_id=I.origin_id,k.origin_slot=I.origin_slot,S=I.parentId}else{const C=f.get(k.origin_id);if(!C){console.error("Missing Link ID when unpacking");continue}k.origin_id=C}if(k.target_id===SUBGRAPH_OUTPUT_ID){for(const C of o.outputs[k.target_slot].links??[]){const I=this.links[C];y.push({oid:k.origin_id,oslot:k.origin_slot,tid:I.target_id,tslot:I.target_slot,id:k.id,iparent:k.parentId,eparent:I.parentId,externalFirst:!0}),I.parentId=void 0}continue}else{const C=f.get(k.target_id);if(!C){console.error("Missing Link ID when unpacking");continue}k.target_id=C}y.push({oid:k.origin_id,oslot:k.origin_slot,tid:k.target_id,tslot:k.target_slot,id:k.id,iparent:k.parentId,eparent:S,externalFirst:!1})}this.remove(o),this.subgraphs.delete(o.subgraph.id);const b=new Map;for(const k of y){let S;if(k.oid==SUBGRAPH_INPUT_ID){if(!(this instanceof Subgraph)){console.error("Ignoring link to subgraph outside subgraph");continue}const I=this._nodes_by_id[k.tid];S=this.inputNode.slots[k.oslot].connect(I.inputs[k.tslot],I)}else if(k.tid==SUBGRAPH_OUTPUT_ID){if(!(this instanceof Subgraph)){console.error("Ignoring link to subgraph outside subgraph");continue}const I=this._nodes_by_id[k.oid];S=this.outputNode.slots[k.tslot].connect(I.outputs[k.oslot],I)}else S=this._nodes_by_id[k.oid].connect(k.oslot,this._nodes_by_id[k.tid],k.tslot);if(!S){console.error("Failed to create link");continue}const C=b.get(k.id)??[];C.push(S.id),b.has(k.id)||b.set(k.id,C),k.id=S.id}const w=new Map;for(const k of o.subgraph.reroutes.values()){k.parentId!==void 0&&w.get(k.parentId)===void 0&&console.error("Missing Parent ID");const S=new Reroute(++this.state.lastRerouteId,this,[k.pos[0]+l,k.pos[1]+u]);w.set(k.id,S.id),this.reroutes.set(S.id,S),r.push(S)}for(const k of y){const S=this.links.get(k.id);if(!S)continue;let C=S,I;if(k.externalFirst)for(I=k.eparent;I;){if(C.parentId=I,C=this.reroutes.get(I),!C)throw new Error("Broken Id link when unpacking");if(C.linkIds.has(S.id))throw new Error("Infinite parentId loop");C.linkIds.add(S.id),I=C.parentId}for(I=k.iparent;I;){const T=w.get(I);if(!T)throw new Error("Broken Id link when unpacking");if(C.parentId=T,C=this.reroutes.get(T),!C)throw new Error("Broken Id link when unpacking");if(C.linkIds.has(S.id))throw new Error("Infinite parentId loop");C.linkIds.add(S.id);const E=o.subgraph.reroutes.get(I);if(!E)throw new Error("Broken Id link when unpacking");I=E.parentId}if(!k.externalFirst)for(I=k.eparent;I;){if(C.parentId=I,C=this.reroutes.get(I),!C)throw new Error("Broken Id link when unpacking");if(C.linkIds.has(S.id))throw new Error("Infinite parentId loop");C.linkIds.add(S.id),I=C.parentId}}for(const k of f.values()){const S=this._nodes_by_id[k];S._setConcreteSlots(),S.arrange()}this.canvasAction(k=>k.selectItems(r)),this.afterChange()}resolveSubgraphIdPath(o){const n=[];let s=this.rootGraph;for(const a of o){const r=s.getNodeById(a);if(!r)throw new Error(`Node [${a}] not found.  ID Path: ${o.join(":")}`);if(!r.isSubgraphNode())throw new Error(`Node [${a}] is not a SubgraphNode.  ID Path: ${o.join(":")}`);n.push(r),s=r.subgraph}return n}serialize(o){const{config:n,state:s,groups:a,nodes:r,reroutes:l,extra:u,floatingLinks:m,definitions:f}=this.asSerialisable(o),_=[...this._links.values()],y=_.map(b=>b.serialize());return l?.length&&(u.linkExtensions=_.filter(b=>b.parentId!==void 0).map(b=>({id:b.id,parentId:b.parentId}))),u.reroutes=l?.length?l:void 0,{id:this.id,revision:this.revision,last_node_id:s.lastNodeId,last_link_id:s.lastLinkId,nodes:r,links:y,floatingLinks:m,groups:a,definitions:f,config:n,extra:u,version:LiteGraph.VERSION}}#t(){const o=this.list_of_graphcanvas?.at(0)?.ds;if(o)return{scale:o.scale,offset:o.offset}}asSerialisable(o){const{id:n,revision:s,config:a,state:r}=this,u=(!LiteGraph.use_uuids&&o?.sortNodes?[...this._nodes].sort((k,S)=>k.id-S.id):this._nodes).map(k=>k.serialize()),m=this._groups.map(k=>k.serialize()),f=this._links.size?[...this._links.values()].map(k=>k.asSerialisable()):void 0,_=this.floatingLinks.size?[...this.floatingLinks.values()].map(k=>k.asSerialisable()):void 0,y=this.reroutes.size?[...this.reroutes.values()].map(k=>k.asSerialisable()):void 0,b={...this.extra};LiteGraph.saveViewportWithGraph&&(b.ds=this.#t()),b.ds||delete b.ds;const w={id:n,revision:s,version:LGraph.serialisedSchemaVersion,config:a,state:r,groups:m,nodes:u,links:f,floatingLinks:_,reroutes:y,extra:b};if(this.isRootGraph&&this._subgraphs.size){const k=findUsedSubgraphIds(this,this._subgraphs),S=[...this._subgraphs.values()].filter(C=>k.has(C.id)).map(C=>C.asSerialisable());S.length>0&&(w.definitions={subgraphs:S})}return this.onSerialize?.(w),w}_configureBase(o){const{id:n,extra:s}=o;n?this.id=n:this.id===zeroUuid&&(this.id=createUuidv4()),this.extra=s?structuredClone(s):{},delete this.extra.linkExtensions}configure(o,n){const s=useLayoutMutations(),a={data:o,clearGraph:!n};if(this.events.dispatch("configuring",a))try{if(!o)return;a.clearGraph&&this.clear(),this._configureBase(o);let l;if(o.version===.4){const{extra:k}=o;if(Array.isArray(o.links))for(const S of o.links){const C=LLink.createFromArray(S);this._links.set(C.id,C)}if(Array.isArray(k?.linkExtensions))for(const S of k.linkExtensions){const C=this._links.get(S.id);C&&(C.parentId=S.parentId)}l=k?.reroutes}else{if(o.state){const{lastGroupId:k,lastLinkId:S,lastNodeId:C,lastRerouteId:I}=o.state,{state:T}=this;k!=null&&(T.lastGroupId=k),S!=null&&(T.lastLinkId=S),C!=null&&(T.lastNodeId=C),I!=null&&(T.lastRerouteId=I)}if(Array.isArray(o.links))for(const k of o.links){const S=LLink.create(k);this._links.set(S.id,S)}l=o.reroutes}if(Array.isArray(l))for(const k of l)this.setReroute(k);const u=o.nodes;for(const k in o)LGraph.ConfigureProperties.has(k)||(this[k]=o[k]);const m=o.definitions?.subgraphs;if(m){for(const k of m)this.createSubgraph(k);for(const k of m)this.subgraphs.get(k.id)?.configure(k)}let f=!1;const _=new Map;if(this._nodes=[],u){for(const k of u){let S=LiteGraph.createNode(String(k.type),k.title);S||(LiteGraph.debug&&console.warn("Node not found or has errors:",k.type),S=new LGraphNode(""),S.last_serialization=k,S.has_errors=!0,f=!0),S.id=k.id,this.add(S,!0),_.set(S.id,k)}for(const[k,S]of _)this.getNodeById(k)?.configure(S)}if(Array.isArray(o.floatingLinks))for(const k of o.floatingLinks){const S=LLink.create(k);this.addFloatingLink(S),S.id>this.#e&&(this.#e=S.id)}for(const k of this.reroutes.values())k.validateLinks(this._links,this.floatingLinks)||(this.reroutes.delete(k.id),s.setSource(LayoutSource.Canvas),s.deleteReroute(k.id));this._groups.length=0;const y=o.groups;if(y)for(const k of y){const S=new LiteGraph.LGraphGroup;S.configure(k),this.add(S)}this.updateExecutionOrder(),this.onConfigure?.(o),this._version++;const{primaryCanvas:b}=this,w=b?.subgraph?.id;if(w){const k=this.subgraphs.get(w);k?b.setGraph(k):b.setGraph(this)}return this.setDirtyCanvas(!0,!0),f}finally{this.events.dispatch("configured")}}#o;get primaryCanvas(){return this.rootGraph.#o}set primaryCanvas(o){this.rootGraph.#o=o}load(o,n){if(o instanceof Blob||o instanceof File){const a=new FileReader;a.addEventListener("load",r=>{const l=toString(r.target?.result),u=JSON.parse(l);this.configure(u),n?.()}),a.readAsText(o);return}const s=new XMLHttpRequest;s.open("GET",o,!0),s.send(null),s.addEventListener("load",()=>{if(s.status!==200){console.error("Error loading graph:",s.status,s.response);return}const a=JSON.parse(s.response);this.configure(a),n?.()}),s.addEventListener("error",a=>{console.error("Error loading graph:",a)})}}class Subgraph extends LGraph{static{p(this,"Subgraph")}events=new CustomEventTarget;static MAX_NESTED_SUBGRAPHS=1e3;name="Unnamed Subgraph";inputNode=new SubgraphInputNode(this);outputNode=new SubgraphOutputNode(this);inputs=[];outputs=[];widgets=[];#e;get rootGraph(){return this.#e}constructor(o,n){if(!o)throw new Error("Root graph is required");super(),this.#e=o;const s=structuredClone(n);this._configureBase(s),this.#t(s)}getIoNodeOnPos(o,n){const{inputNode:s,outputNode:a}=this;if(s.containsPoint([o,n]))return s;if(a.containsPoint([o,n]))return a}#t(o){const{name:n,inputs:s,outputs:a,widgets:r}=o;if(this.name=n,s){this.inputs.length=0;for(const l of s){const u=new SubgraphInput(l,this.inputNode);this.inputs.push(u),this.events.dispatch("input-added",{input:u})}}if(a){this.outputs.length=0;for(const l of a)this.outputs.push(new SubgraphOutput(l,this.outputNode))}if(r){this.widgets.length=0;for(const l of r)this.widgets.push(l)}this.inputNode.configure(o.inputNode),this.outputNode.configure(o.outputNode)}configure(o,n){const s=super.configure(o,n);return this.#t(o),s}attachCanvas(o){super.attachCanvas(o),o.subgraph=this}addInput(o,n){this.events.dispatch("adding-input",{name:o,type:n});const s=new SubgraphInput({id:createUuidv4(),name:o,type:n},this.inputNode);return this.inputs.push(s),this.events.dispatch("input-added",{input:s}),s}addOutput(o,n){this.events.dispatch("adding-output",{name:o,type:n});const s=new SubgraphOutput({id:createUuidv4(),name:o,type:n},this.outputNode);return this.outputs.push(s),this.events.dispatch("output-added",{output:s}),s}renameInput(o,n){const s=this.inputs.indexOf(o);if(s===-1)throw new Error("Input not found");const a=o.displayName;this.events.dispatch("renaming-input",{input:o,index:s,oldName:a,newName:n}),o.label=n}renameOutput(o,n){const s=this.outputs.indexOf(o);if(s===-1)throw new Error("Output not found");const a=o.displayName;this.events.dispatch("renaming-output",{output:o,index:s,oldName:a,newName:n}),o.label=n}removeInput(o){o.disconnect();const n=this.inputs.indexOf(o);if(n===-1)throw new Error("Input not found");if(!this.events.dispatch("removing-input",{input:o,index:n}))return;this.inputs.splice(n,1);const{length:a}=this.inputs;for(let r=n;r<a;r++)this.inputs[r].decrementSlots("inputs")}removeOutput(o){o.disconnect();const n=this.outputs.indexOf(o);if(n===-1)throw new Error("Output not found");if(!this.events.dispatch("removing-output",{output:o,index:n}))return;this.outputs.splice(n,1);const{length:a}=this.outputs;for(let r=n;r<a;r++)this.outputs[r].decrementSlots("outputs")}draw(o,n,s,a){this.inputNode.draw(o,n,s,a),this.outputNode.draw(o,n,s,a)}clone(o=!1){const n=this.asSerialisable();o||(n.id=createUuidv4());const s=new Subgraph(this.rootGraph,n);return s.configure(n),s}asSerialisable(){return{id:this.id,version:LGraph.serialisedSchemaVersion,state:this.state,revision:this.revision,config:this.config,name:this.name,inputNode:this.inputNode.asSerialisable(),outputNode:this.outputNode.asSerialisable(),inputs:this.inputs.map(o=>o.asSerialisable()),outputs:this.outputs.map(o=>o.asSerialisable()),widgets:[...this.widgets],nodes:this.nodes.map(o=>o.serialize()),groups:this.groups.map(o=>o.serialize()),links:[...this.links.values()].map(o=>o.asSerialisable()),reroutes:this.reroutes.size?[...this.reroutes.values()].map(o=>o.asSerialisable()):void 0,extra:this.extra}}}class InputIndicators{static{p(this,"InputIndicators")}constructor(o){this.canvas=o,this.controller=new AbortController;const{signal:n}=this.controller,s=o.canvas,a={capture:!0,signal:n};s.addEventListener("pointerdown",this.#e,a),s.addEventListener("pointermove",this.#e,a),s.addEventListener("pointerup",this.#t,a),s.addEventListener("keydown",this.#o,a),document.addEventListener("keyup",this.#o,a);const r=o.drawFrontCanvas.bind(o);n.addEventListener("abort",()=>{o.drawFrontCanvas=r}),o.drawFrontCanvas=()=>{r(),this.draw()}}radius=8;startAngle=0;endAngle=Math.PI*2;inactiveColour="#ffffff10";colour1="#ff5f00";colour2="#00ff7c";colour3="#dea7ff";fontString="bold 12px Arial";enabled=!0;shiftDown=!1;undoDown=!1;redoDown=!1;ctrlDown=!1;altDown=!1;mouse0Down=!1;mouse1Down=!1;mouse2Down=!1;x=0;y=0;controller;#e=this.onPointerDownOrMove.bind(this);onPointerDownOrMove(o){this.mouse0Down=(o.buttons&1)===1,this.mouse1Down=(o.buttons&4)===4,this.mouse2Down=(o.buttons&2)===2,this.x=o.clientX,this.y=o.clientY,this.canvas.setDirty(!0)}#t=this.onPointerUp.bind(this);onPointerUp(){this.mouse0Down=!1,this.mouse1Down=!1,this.mouse2Down=!1}#o=this.onKeyDownOrUp.bind(this);onKeyDownOrUp(o){this.ctrlDown=o.ctrlKey,this.altDown=o.altKey,this.shiftDown=o.shiftKey,this.undoDown=o.ctrlKey&&o.code==="KeyZ"&&o.type==="keydown",this.redoDown=o.ctrlKey&&o.code==="KeyY"&&o.type==="keydown"}draw(){const{canvas:{ctx:o},radius:n,startAngle:s,endAngle:a,x:r,y:l,inactiveColour:u,colour1:m,colour2:f,colour3:_,fontString:y}=this,{fillStyle:b,font:w}=o,k=r,S=l-80,C=k,I=S-15;o.font=y,L(C+0,I,"Shift",this.shiftDown?m:u),L(C+45,I+20,"Alt",this.altDown?f:u),L(C+30,I,"Control",this.ctrlDown?_:u),L(C-30,I,"â†©ï¸",this.undoDown?"#000":"transparent"),L(C+45,I,"â†ªï¸",this.redoDown?"#000":"transparent"),o.beginPath(),D(k,S),D(k+15,S),D(k+30,S),o.fillStyle=u,o.fill();const T=this.mouse0Down?m:u,E=this.mouse1Down?f:u,N=this.mouse2Down?_:u;this.mouse0Down&&A(k,S,T),this.mouse1Down&&A(k+15,S,E),this.mouse2Down&&A(k+30,S,N),o.fillStyle=b,o.font=w;function L(O,M,P,R){o.fillStyle=R,o.fillText(P,O,M)}p(L,"textMarker");function A(O,M,P){o.beginPath(),o.fillStyle=P,D(O,M),o.fill()}p(A,"mouseMarker");function D(O,M){o.arc(O,M,n,s,a)}p(D,"drawDot")}dispose(){this.controller?.abort(),this.controller=void 0}[Symbol.dispose](){this.dispose()}}class LiteGraphGlobal{static{p(this,"LiteGraphGlobal")}SlotShape=SlotShape;SlotDirection=SlotDirection;SlotType=SlotType;LabelPosition=LabelPosition;VERSION=.4;CANVAS_GRID_SIZE=10;NODE_TITLE_HEIGHT=30;NODE_TITLE_TEXT_Y=20;NODE_SLOT_HEIGHT=20;NODE_WIDGET_HEIGHT=20;NODE_WIDTH=140;NODE_MIN_WIDTH=50;NODE_COLLAPSED_RADIUS=10;NODE_COLLAPSED_WIDTH=80;NODE_TITLE_COLOR="#999";NODE_SELECTED_TITLE_COLOR="#FFF";NODE_TEXT_SIZE=14;NODE_TEXT_COLOR="#AAA";NODE_TEXT_HIGHLIGHT_COLOR="#EEE";NODE_SUBTEXT_SIZE=12;NODE_DEFAULT_COLOR="#333";NODE_DEFAULT_BGCOLOR="#353535";NODE_DEFAULT_BOXCOLOR="#666";NODE_DEFAULT_SHAPE=RenderShape.ROUND;NODE_BOX_OUTLINE_COLOR="#FFF";NODE_ERROR_COLOUR="#E00";NODE_FONT="Arial";NODE_DEFAULT_BYPASS_COLOR="#FF00FF";NODE_OPACITY=.9;DEFAULT_FONT="Arial";DEFAULT_SHADOW_COLOR="rgba(0,0,0,0.5)";DEFAULT_GROUP_FONT=24;DEFAULT_GROUP_FONT_SIZE;GROUP_FONT="Arial";WIDGET_BGCOLOR="#222";WIDGET_OUTLINE_COLOR="#666";WIDGET_PROMOTED_OUTLINE_COLOR="#BF00FF";WIDGET_ADVANCED_OUTLINE_COLOR="rgba(56, 139, 253, 0.8)";WIDGET_TEXT_COLOR="#DDD";WIDGET_SECONDARY_TEXT_COLOR="#999";WIDGET_DISABLED_TEXT_COLOR="#666";LINK_COLOR="#9A9";EVENT_LINK_COLOR="#A86";CONNECTING_LINK_COLOR="#AFA";MAX_NUMBER_OF_NODES=1e4;DEFAULT_POSITION=[100,100];VALID_SHAPES=["default","box","round","card"];ROUND_RADIUS=8;BOX_SHAPE=RenderShape.BOX;ROUND_SHAPE=RenderShape.ROUND;CIRCLE_SHAPE=RenderShape.CIRCLE;CARD_SHAPE=RenderShape.CARD;ARROW_SHAPE=RenderShape.ARROW;GRID_SHAPE=RenderShape.GRID;INPUT=NodeSlotType.INPUT;OUTPUT=NodeSlotType.OUTPUT;EVENT=-1;ACTION=-1;NODE_MODES=["Always","On Event","Never","On Trigger"];NODE_MODES_COLORS=["#666","#422","#333","#224","#626"];ALWAYS=LGraphEventMode.ALWAYS;ON_EVENT=LGraphEventMode.ON_EVENT;NEVER=LGraphEventMode.NEVER;ON_TRIGGER=LGraphEventMode.ON_TRIGGER;UP=LinkDirection.UP;DOWN=LinkDirection.DOWN;LEFT=LinkDirection.LEFT;RIGHT=LinkDirection.RIGHT;CENTER=LinkDirection.CENTER;LINK_RENDER_MODES=["Straight","Linear","Spline"];HIDDEN_LINK=LinkRenderType.HIDDEN_LINK;STRAIGHT_LINK=LinkRenderType.STRAIGHT_LINK;LINEAR_LINK=LinkRenderType.LINEAR_LINK;SPLINE_LINK=LinkRenderType.SPLINE_LINK;NORMAL_TITLE=TitleMode.NORMAL_TITLE;NO_TITLE=TitleMode.NO_TITLE;TRANSPARENT_TITLE=TitleMode.TRANSPARENT_TITLE;AUTOHIDE_TITLE=TitleMode.AUTOHIDE_TITLE;VERTICAL_LAYOUT="vertical";proxy=null;node_images_path="";debug=!1;catch_exceptions=!0;throw_errors=!0;allow_scripts=!1;registered_node_types={};node_types_by_file_extension={};Nodes={};Globals={};searchbox_extras={};node_box_coloured_when_on=!1;node_box_coloured_by_mode=!1;dialog_close_on_mouse_leave=!1;dialog_close_on_mouse_leave_delay=500;shift_click_do_break_link_from=!1;click_do_break_link_to=!1;ctrl_alt_click_do_break_link=!0;snaps_for_comfy=!0;snap_highlights_node=!0;alwaysSnapToGrid;snapToGrid;search_hide_on_mouse_leave=!0;search_filter_enabled=!1;search_show_all_on_open=!0;auto_load_slot_types=!1;registered_slot_in_types={};registered_slot_out_types={};slot_types_in=[];slot_types_out=[];slot_types_default_in={};slot_types_default_out={};alt_drag_do_clone_nodes=!1;do_add_triggers_slots=!1;allow_multi_output_for_events=!0;middle_click_slot_add_default_node=!1;release_link_on_empty_shows_menu=!1;pointerevents_method="pointer";ctrl_shift_v_paste_connect_unselected_outputs=!0;use_uuids=!1;highlight_selected_group=!0;context_menu_scaling=!1;alwaysRepeatWarnings=!1;onDeprecationWarning=[console.warn];macTrackpadGestures=!1;macGesturesRequireMac=!0;canvasNavigationMode="legacy";leftMouseClickBehavior="panning";mouseWheelScroll="panning";truncateWidgetTextEvenly=!1;truncateWidgetValuesFirst=!1;saveViewportWithGraph=!0;vueNodesMode=!1;nodeOpacity=1;nodeLightness=void 0;LGraph=LGraph;LLink=LLink;LGraphNode=LGraphNode;LGraphGroup=LGraphGroup;DragAndScale=DragAndScale;LGraphCanvas=LGraphCanvas;ContextMenu=ContextMenu;CurveEditor=CurveEditor;Reroute=Reroute;constructor(){Object.defineProperty(this,"Classes",{writable:!1})}Classes={get SubgraphSlot(){return SubgraphSlot},get SubgraphIONodeBase(){return SubgraphIONodeBase},get Rectangle(){return Rectangle},get InputIndicators(){return InputIndicators}};registerNodeType(o,n){if(!n.prototype)throw"Cannot register a simple object, it must be a class with a prototype";n.type=o;const s=n.name,a=o.lastIndexOf("/");n.category=o.substring(0,a),n.title||=s;for(const l in LGraphNode.prototype)n.prototype[l]||=LGraphNode.prototype[l];const r=this.registered_node_types[o];r&&this.debug&&console.warn("replacing node type:",o),this.registered_node_types[o]=n,n.constructor.name&&(this.Nodes[s]=n),this.onNodeTypeRegistered?.(o,n),r&&this.onNodeTypeReplaced?.(o,n,r),n.prototype.onPropertyChange&&console.warn(`LiteGraph node class ${o} has onPropertyChange method, it must be called onPropertyChanged with d at the end`),this.auto_load_slot_types&&new n(n.title||"tmpnode")}unregisterNodeType(o){const n=typeof o=="string"?this.registered_node_types[o]:o;if(!n)throw`node type not found: ${String(o)}`;delete this.registered_node_types[String(n.type)];const s=n.constructor.name;s&&delete this.Nodes[s]}registerNodeAndSlotType(o,n,s){s||=!1;const r=(typeof o=="string"&&this.registered_node_types[o]!=="anonymous"?this.registered_node_types[o]:o).constructor.type;let l=[];typeof n=="string"?l=n.split(","):n==this.EVENT||n==this.ACTION?l=["_event_"]:l=["*"];for(let u of l){u===""&&(u="*");const m=s?this.registered_slot_out_types:this.registered_slot_in_types;m[u]??={nodes:[]};const{nodes:f}=m[u];f.includes(r)||f.push(r);const _=s?this.slot_types_out:this.slot_types_in,y=u.toLowerCase();_.includes(y)||(_.push(y),_.sort())}}clearRegisteredTypes(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}}createNode(o,n,s){const a=this.registered_node_types[o];if(!a)return this.debug&&console.warn(`GraphNode type "${o}" not registered.`),null;n=n||a.title||o;let r=null;if(this.catch_exceptions)try{r=new a(n)}catch(l){return console.error(l),null}else r=new a(n);if(r.type=o,!r.title&&n&&(r.title=n),r.properties||={},r.properties_info||=[],r.flags||={},r.size||=r.computeSize(),r.pos||=[this.DEFAULT_POSITION[0],this.DEFAULT_POSITION[1]],r.mode||=LGraphEventMode.ALWAYS,s)for(const l in s)r[l]=s[l];return r.onNodeCreated?.(),r}getNodeType(o){return this.registered_node_types[o]}getNodeTypesInCategory(o,n){const s=[];for(const a in this.registered_node_types){const r=this.registered_node_types[a];r.filter==n&&(o==""?r.category==null&&s.push(r):r.category==o&&s.push(r))}return s}getNodeTypesCategories(o){const n={"":1};for(const a in this.registered_node_types){const r=this.registered_node_types[a];if(r.category&&!r.skip_list){if(r.filter!=o)continue;n[r.category]=1}}const s=[];for(const a in n)s.push(a);return s}reloadNodes(o){const n=document.getElementsByTagName("script"),s=[];for(const r of n)s.push(r);const a=document.getElementsByTagName("head")[0];o=document.location.href+o;for(const r of s){const l=r.src;if(!(!l||l.substr(0,o.length)!=o))try{const u=document.createElement("script");u.type="text/javascript",u.src=l,a.append(u),r.remove()}catch(u){if(this.throw_errors)throw u;this.debug&&console.error("Error while reloading",l)}}}cloneObject(o,n){if(o==null)return null;const s=JSON.parse(JSON.stringify(o));if(!n)return s;for(const a in s)n[a]=s[a];return n}uuidv4=createUuidv4;isValidConnection(o,n){if((o==""||o==="*")&&(o=0),(n==""||n==="*")&&(n=0),!o||!n||o==n||o==this.EVENT&&n==this.ACTION)return!0;if(o=String(o),n=String(n),o=o.toLowerCase(),n=n.toLowerCase(),!o.includes(",")&&!n.includes(","))return o==n;const s=o.split(","),a=n.split(",");for(const r of s)for(const l of a)if(this.isValidConnection(r,l))return!0;return!1}getParameterNames(o){return String(o).replaceAll(/\/\/.*$/gm,"").replaceAll(/\s+/g,"").replaceAll(/\/\*[^*/]*\*\//g,"").split("){",1)[0].replace(/^[^(]*\(/,"").replaceAll(/=[^,]+/g,"").split(",").filter(Boolean)}pointerListenerAdd(o,n,s,a=!1){if(!o||!o.addEventListener||!n||typeof s!="function")return;let r=this.pointerevents_method,l=n;if(r=="pointer"&&!window.PointerEvent)switch(console.warn("sMethod=='pointer' && !window.PointerEvent"),console.warn(`Converting pointer[${l}] : down move up cancel enter TO touchstart touchmove touchend, etc ..`),l){case"down":{r="touch",l="start";break}case"move":{r="touch";break}case"up":{r="touch",l="end";break}case"cancel":{r="touch";break}case"enter":break;default:console.warn(`PointerEvent not available in this browser ? The event ${l} would not be called`)}switch(l){case"down":case"up":case"move":case"over":case"out":case"enter":o.addEventListener(r+l,s,a);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(r!="mouse")return o.addEventListener(r+l,s,a);default:return o.addEventListener(l,s,a)}}pointerListenerRemove(o,n,s,a=!1){if(!(!o||!o.removeEventListener||!n||typeof s!="function"))switch(n){case"down":case"up":case"move":case"over":case"out":case"enter":(this.pointerevents_method=="pointer"||this.pointerevents_method=="mouse")&&o.removeEventListener(this.pointerevents_method+n,s,a);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(this.pointerevents_method=="pointer")return o.removeEventListener(this.pointerevents_method+n,s,a);default:return o.removeEventListener(n,s,a)}}getTime(){return performance.now()}distance=distance;colorToString(o){return`rgba(${Math.round(o[0]*255).toFixed()},${Math.round(o[1]*255).toFixed()},${Math.round(o[2]*255).toFixed()},${o.length==4?o[3].toFixed(2):"1.0"})`}isInsideRectangle=isInsideRectangle;growBounding(o,n,s){n<o[0]?o[0]=n:n>o[2]&&(o[2]=n),s<o[1]?o[1]=s:s>o[3]&&(o[3]=s)}overlapBounding=overlapBounding;isInsideBounding(o,n){return!(o[0]<n[0][0]||o[1]<n[0][1]||o[0]>n[1][0]||o[1]>n[1][1])}hex2num(o){o.charAt(0)=="#"&&(o=o.slice(1)),o=o.toUpperCase();const n="0123456789ABCDEF",s=new Array(3);let a=0,r,l;for(let u=0;u<6;u+=2)r=n.indexOf(o.charAt(u)),l=n.indexOf(o.charAt(u+1)),s[a]=r*16+l,a++;return s}num2hex(o){const n="0123456789ABCDEF";let s="#",a,r;for(let l=0;l<3;l++)a=o[l]/16,r=o[l]%16,s+=n.charAt(a)+n.charAt(r);return s}closeAllContextMenus(o=window){const n=[...o.document.querySelectorAll(".litecontextmenu")];if(n.length)for(const s of n)"close"in s&&typeof s.close=="function"?s.close():s.remove()}extendClass(o,n){for(const s in n)o.hasOwnProperty(s)||(o[s]=n[s]);if(n.prototype)for(const s in n.prototype)n.prototype.hasOwnProperty(s)&&(o.prototype.hasOwnProperty(s)||(n.prototype.__lookupGetter__(s)?o.prototype.__defineGetter__(s,n.prototype.__lookupGetter__(s)):o.prototype[s]=n.prototype[s],n.prototype.__lookupSetter__(s)&&o.prototype.__defineSetter__(s,n.prototype.__lookupSetter__(s))))}}Symbol.dispose??=Symbol("Symbol.dispose");Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");function loadPolyfills(){typeof window<"u"&&window.CanvasRenderingContext2D&&!window.CanvasRenderingContext2D.prototype.roundRect&&(window.CanvasRenderingContext2D.prototype.roundRect=function(i,o,n,s,a,r){let l=0,u=0,m=0,f=0;if(a===0){this.rect(i,o,n,s);return}if(r===void 0&&(r=a),Array.isArray(a))if(a.length==1)l=u=m=f=a[0];else if(a.length==2)l=f=a[0],u=m=a[1];else if(a.length==4)l=a[0],u=a[1],m=a[2],f=a[3];else return;else{l=a||0,u=a||0;const _=!Array.isArray(r)&&r?r:0;m=_,f=_}this.moveTo(i+l,o),this.lineTo(i+n-u,o),this.quadraticCurveTo(i+n,o,i+n,o+u),this.lineTo(i+n,o+s-f),this.quadraticCurveTo(i+n,o+s,i+n-f,o+s),this.lineTo(i+f,o+s),this.quadraticCurveTo(i,o+s,i,o+s-m),this.lineTo(i,o+m),this.quadraticCurveTo(i,o,i+l,o)}),typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(i){window.setTimeout(i,1e3/60)})}p(loadPolyfills,"loadPolyfills");const LiteGraph=new LiteGraphGlobal;loadPolyfills();function isNodeLocatorId(i){if(typeof i!="string")return!1;const o=i.split(":");return o.length===1?i.length>0:o.length!==2||!o[1]?!1:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(o[0])}p(isNodeLocatorId,"isNodeLocatorId");function isNodeExecutionId(i){return typeof i!="string"?!1:i.includes(":")}p(isNodeExecutionId,"isNodeExecutionId");function parseNodeLocatorId(i){if(!isNodeLocatorId(i))return null;const o=i.split(":");if(o.length===1)return{subgraphUuid:null,localNodeId:isNaN(Number(i))?i:Number(i)};const[n,s]=o;return{subgraphUuid:n,localNodeId:isNaN(Number(s))?s:Number(s)}}p(parseNodeLocatorId,"parseNodeLocatorId");function createNodeLocatorId(i,o){return`${i}:${o}`}p(createNodeLocatorId,"createNodeLocatorId");function parseNodeExecutionId(i){return isNodeExecutionId(i)?i.split(":").map(o=>isNaN(Number(o))?o:Number(o)):null}p(parseNodeExecutionId,"parseNodeExecutionId");function createNodeExecutionId(i){return i.join(":")}p(createNodeExecutionId,"createNodeExecutionId");const isAbortError=p(i=>i instanceof DOMException&&i.name==="AbortError","isAbortError"),isSubgraph=p(i=>i?.isRootGraph===!1,"isSubgraph"),isNonNullish=p(i=>i!=null,"isNonNullish"),isSubgraphIoNode=p(i=>{const o=i.constructor?.comfyClass;return o==="SubgraphInputNode"||o==="SubgraphOutputNode"},"isSubgraphIoNode"),isSlotObject=p(i=>i!==null&&typeof i=="object"&&"name"in i&&"type"in i&&"boundingRect"in i,"isSlotObject"),isResultItemType=p(i=>i==="input"||i==="output"||i==="temp","isResultItemType");function getLocatorIdFromNodeData(i){return i.subgraphId?`${i.subgraphId}:${String(i.id)}`:String(i.id)}p(getLocatorIdFromNodeData,"getLocatorIdFromNodeData");function parseExecutionId(i){return!i||typeof i!="string"?null:i.split(":").filter(o=>o.length>0)}p(parseExecutionId,"parseExecutionId");function getLocalNodeIdFromExecutionId(i){const o=parseExecutionId(i);return o?o[o.length-1]:null}p(getLocalNodeIdFromExecutionId,"getLocalNodeIdFromExecutionId");function getSubgraphPathFromExecutionId(i){const o=parseExecutionId(i);return o?o.slice(0,-1):[]}p(getSubgraphPathFromExecutionId,"getSubgraphPathFromExecutionId");function visitGraphNodes(i,o){for(const n of i.nodes)o(n)}p(visitGraphNodes,"visitGraphNodes");function traverseSubgraphPath(i,o){let n=i;for(const s of o){const a=n.getNodeById(s);if(!a?.isSubgraphNode?.()||!a.subgraph)return null;n=a.subgraph}return n}p(traverseSubgraphPath,"traverseSubgraphPath");function triggerCallbackOnAllNodes(i,o){forEachNode(i,n=>{const s=n[o];typeof s=="function"&&s.call(n)})}p(triggerCallbackOnAllNodes,"triggerCallbackOnAllNodes");function mapAllNodes(i,o){const n=[];return visitGraphNodes(i,s=>{s.isSubgraphNode?.()&&s.subgraph&&n.push(...mapAllNodes(s.subgraph,o));const a=o(s);a!==void 0&&n.push(a)}),n}p(mapAllNodes,"mapAllNodes");function forEachNode(i,o){visitGraphNodes(i,n=>{n.isSubgraphNode?.()&&n.subgraph&&forEachNode(n.subgraph,o),o(n)})}p(forEachNode,"forEachNode");function collectAllNodes(i,o){return mapAllNodes(i,n=>{if(!o||o(n))return n})}p(collectAllNodes,"collectAllNodes");function findSubgraphByUuid(i,o){for(const n of i.nodes)if(n.isSubgraphNode?.()&&n.subgraph){if(n.subgraph.id===o)return n.subgraph;const s=findSubgraphByUuid(n.subgraph,o);if(s)return s}return null}p(findSubgraphByUuid,"findSubgraphByUuid");function findSubgraphPathById(i,o){const n=[{graph:i,path:[]}];for(;n.length>0;){const{graph:s,path:a}=n.pop();if(!(!s||!s._nodes||!Array.isArray(s._nodes))){for(const r of s._nodes)if(r.isSubgraphNode?.()&&r.subgraph){const l=[...a,String(r.subgraph.id)];if(r.subgraph.id===o)return l;n.push({graph:r.subgraph,path:l})}}}return null}p(findSubgraphPathById,"findSubgraphPathById");function getNodeByExecutionId(i,o){if(!i)return null;const n=getLocalNodeIdFromExecutionId(o);if(!n)return null;const s=getSubgraphPathFromExecutionId(o);if(s.length===0)return i.getNodeById(n)||null;const a=traverseSubgraphPath(i,s);return a&&a.getNodeById(n)||null}p(getNodeByExecutionId,"getNodeByExecutionId");function getNodeByLocatorId(i,o){if(!i)return null;const n=parseNodeLocatorId(o);if(!n)return null;const{subgraphUuid:s,localNodeId:a}=n;if(!s)return i.getNodeById(a)||null;const r=findSubgraphByUuid(i,s);return r&&r.getNodeById(a)||null}p(getNodeByLocatorId,"getNodeByLocatorId");function forEachSubgraphNode(i,o,n){!i||!o||forEachNode(i,s=>{s.type===o&&n(s)})}p(forEachSubgraphNode,"forEachSubgraphNode");function getAllNonIoNodesInSubgraph(i){return i.nodes.filter(o=>!isSubgraphIoNode(o))}p(getAllNonIoNodesInSubgraph,"getAllNonIoNodesInSubgraph");function traverseNodesDepthFirst(i,o){const{visitor:n=p(()=>{},"visitor"),initialContext:s=void 0,expandSubgraphs:a=!0}=o||{},r=[];for(const l of i)r.push({node:l,context:s});for(;r.length>0;){const{node:l,context:u}=r.pop(),m=n(l,u);if(a&&l.isSubgraphNode?.()&&l.subgraph){const f=l.subgraph.nodes;for(let _=f.length-1;_>=0;_--)r.push({node:f[_],context:m})}}}p(traverseNodesDepthFirst,"traverseNodesDepthFirst");function collectFromNodes(i,o){const{collector:n=p(u=>u,"collector"),contextBuilder:s=p(()=>{},"contextBuilder"),initialContext:a=void 0,expandSubgraphs:r=!0}=o||{},l=[];return traverseNodesDepthFirst(i,{visitor:p((u,m)=>{const f=n(u,m);return f!==null&&l.push(f),s(u,m)},"visitor"),initialContext:a,expandSubgraphs:r}),l}p(collectFromNodes,"collectFromNodes");function getExecutionIdsForSelectedNodes(i,o=i[0]?.graph){if(!o)return[];const n=o.rootGraph,s=o.isRootGraph?"":findPartialExecutionPathToGraph(o,n);return s===void 0?[]:collectFromNodes(i,{collector:p((a,r)=>{const l=String(a.id);return r?`${r}:${l}`:l},"collector"),contextBuilder:p((a,r)=>{const l=String(a.id);return r?`${r}:${l}`:l},"contextBuilder"),initialContext:s,expandSubgraphs:!0})}p(getExecutionIdsForSelectedNodes,"getExecutionIdsForSelectedNodes");function findPartialExecutionPathToGraph(i,o){for(const n of o.nodes){if(!n.isSubgraphNode())continue;if(n.subgraph===i)return`${n.id}`;const s=findPartialExecutionPathToGraph(i,n.subgraph);if(s!==void 0)return n.id+":"+s}}p(findPartialExecutionPathToGraph,"findPartialExecutionPathToGraph");function useSelectedLiteGraphItems(){const i=useCanvasStore(),o=p(m=>m instanceof Reroute,"isIgnoredItem"),n=p(m=>{const f=new Set;for(const _ of m)o(_)||f.add(_);return f},"filterSelectableItems"),s=p(()=>{const{selectedItems:m}=i.getCanvas();return n(m)},"getSelectableItems");return{isIgnoredItem:o,filterSelectableItems:n,getSelectableItems:s,hasSelectableItems:p(()=>s().size>0,"hasSelectableItems"),hasMultipleSelectableItems:p(()=>s().size>1,"hasMultipleSelectableItems"),getSelectedNodes:p(()=>{const m=app$1.canvas.selected_nodes;if(!m)return[];const f=[];for(const y in m)f.push(m[y]);return f.some(y=>y.isSubgraphNode?.()&&y.subgraph)?collectFromNodes(f):f},"getSelectedNodes"),toggleSelectedNodesMode:p(m=>{const f=app$1.canvas.selected_nodes;if(!f)return;const _=[];for(const w in f)_.push(f[w]);const b=!_.some(w=>w.mode!==m)?LGraphEventMode.ALWAYS:m;_.forEach(w=>{w.mode=b,w.isSubgraphNode?.()&&w.subgraph&&traverseNodesDepthFirst([w],{visitor:p(k=>{k!==w&&(k.mode=b)},"visitor")})})},"toggleSelectedNodesMode")}}p(useSelectedLiteGraphItems,"useSelectedLiteGraphItems");function isMiddlePointerInput(i){return"button"in i&&i.button===1?!0:"buttons"in i&&typeof i.buttons=="number"?i.buttons===4:!1}p(isMiddlePointerInput,"isMiddlePointerInput");const getSettingInfo=p(i=>{const o=i.category||i.id.split(".");return{category:o[0]??"Other",subCategory:o[1]??"Other"}},"getSettingInfo");function tryMigrateDeprecatedValue(i,o){return i?.migrateDeprecatedValue?.(o)??o}p(tryMigrateDeprecatedValue,"tryMigrateDeprecatedValue");function onChange(i,o,n){i?.onChange&&i.onChange(o,n),i&&app$1.ui.settings.dispatchChange(i.id,o,n)}p(onChange,"onChange");const useSettingStore=defineStore("setting",()=>{const i=ref({}),o=ref({});function n(y){return i.value[y]!==void 0}p(n,"exists");async function s(y,b){const w=toolkit.cloneDeep(b),k=tryMigrateDeprecatedValue(o.value[y],w),S=a(y);k!==S&&(onChange(o.value[y],k,S),i.value[y]=k,await api.storeSetting(y,k))}p(s,"set");function a(y){return toolkit.cloneDeep(i.value[y]??l(y))}p(a,"get");function r(y){return o.value[y]}p(r,"getSettingById");function l(y){const b=r(y);if(b===void 0)return;const w=u(y,b);return w||(typeof b.defaultValue=="function"?b.defaultValue():b.defaultValue)}p(l,"getDefaultValue");function u(y,b){const w=b?.defaultsByInstallVersion;if(w&&y!=="Comfy.InstalledVersion"){const k=a("Comfy.InstalledVersion");if(k){const S=Object.keys(w).sort((C,I)=>semver.compare(I,C));for(const C of S)if(semver.valid(C)&&semver.compare(k,C)>=0){const I=w[C];if(I!==void 0)return typeof I=="function"?I():I}}}return null}p(u,"getVersionedDefaultValue");function m(y){if(!y.id)throw new Error("Settings must have an ID");if(y.id in o.value)throw new Error(`Setting ${y.id} must have a unique ID.`);o.value[y.id]=y,i.value[y.id]!==void 0&&(i.value[y.id]=tryMigrateDeprecatedValue(y,i.value[y.id])),onChange(y,a(y.id),void 0)}p(m,"addSetting");async function f(){if(Object.keys(o.value).length)throw new Error("Setting values must be loaded before any setting is registered.");i.value=await api.getSettings(),await _()}p(f,"loadSettingValues");async function _(){const y="LiteGraph.Canvas.LowQualityRenderingZoomThreshold",b="LiteGraph.Canvas.MinFontSizeForLOD";if(i.value[y]!==void 0&&i.value[b]===void 0){const w=i.value[y],k=Math.round(w*14),S=Math.max(1,Math.min(24,k));i.value[b]=S,delete i.value[y],await api.storeSetting(b,S),await api.storeSetting(y,void 0)}}return p(_,"migrateZoomThresholdToFontSize"),{settingValues:i,settingsById:o,addSetting:m,loadSettingValues:f,set:s,get:a,exists:n,getDefaultValue:l}});function useCanvasInteractions(){const i=useSettingStore(),o=useCanvasStore(),{getCanvas:n}=o,s=computed(()=>i.get("Comfy.Canvas.NavigationMode")==="standard"),a=computed(()=>!(o.canvas?.read_only??!1)),r=p(m=>{if(!m.target?.closest('[data-capture-wheel="true"]')){if(s.value&&(m.ctrlKey||m.metaKey)){u(m);return}if(!s.value){u(m);return}}},"handleWheel"),l=p(m=>{if(isMiddlePointerInput(m)){u(m);return}const f=n();if(!f)return;const _=f.read_only&&m.buttons===1,y=m.buttons===4;if(_||y){m.preventDefault(),m.stopPropagation(),u(m);return}},"handlePointer"),u=p(m=>{if(m.target?.closest('[data-capture-wheel="true"]'))return;const y=app$1.canvas?.canvas;if(!y)return;if(m.preventDefault(),m.stopPropagation(),m instanceof WheelEvent){const{clientX:k,clientY:S,deltaX:C,deltaY:I,ctrlKey:T,metaKey:E,shiftKey:N}=m;y.dispatchEvent(new WheelEvent("wheel",{clientX:k,clientY:S,deltaX:C,deltaY:I,ctrlKey:T,metaKey:E,shiftKey:N}));return}const b=m.constructor,w=new b(m.type,m);y.dispatchEvent(w)},"forwardEventToCanvas");return{handleWheel:r,handlePointer:l,forwardEventToCanvas:u,shouldHandleNodePointerEvents:a}}p(useCanvasInteractions,"useCanvasInteractions");const useChainCallback=p((i,...o)=>function(...n){i?.call(this,...n);for(const s of o)s.call(this,...n)},"useChainCallback"),useDomWidgetStore=defineStore("domWidget",()=>{const i=ref(new Map),o=computed(()=>[...i.value.values()].filter(f=>f.active)),n=computed(()=>[...i.value.values()].filter(f=>!f.active));return{widgetStates:i,activeWidgetStates:o,inactiveWidgetStates:n,registerWidget:p(f=>{i.value.set(f.id,{widget:markRaw(f),visible:!0,readonly:!1,zIndex:0,pos:[0,0],size:[0,0],active:!0})},"registerWidget"),unregisterWidget:p(f=>{i.value.delete(f)},"unregisterWidget"),activateWidget:p(f=>{const _=i.value.get(f);_&&(_.active=!0)},"activateWidget"),deactivateWidget:p(f=>{const _=i.value.get(f);_&&(_.active=!1)},"deactivateWidget"),setWidget:p(f=>{const _=i.value.get(f.id);_&&(_.active=!0,_.widget=f)},"setWidget"),clear:p(()=>{i.value.clear()},"clear")}});function appendJsonExt(i){return i.toLowerCase().endsWith(".json")||(i+=".json"),i}p(appendJsonExt,"appendJsonExt");function highlightQuery(i,o){if(!o)return i;const n=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(`(${n})`,"gi");return i.replace(s,'<span class="highlight">$1</span>')}p(highlightQuery,"highlightQuery");function formatNumberWithSuffix(i,{precision:o=1,roundToInt:n=!1}={}){const s=["","k","m","b","t"],a=Math.abs(i);if(a<1e3)return n?Math.round(i).toString():i.toFixed(o);const r=Math.min(Math.floor(Math.log10(a)/3),s.length-1);return`${(i/Math.pow(1e3,r)).toFixed(o)}${s[r]}`}p(formatNumberWithSuffix,"formatNumberWithSuffix");function formatSize(i){if(i==null)return"-";const o=i;if(o===0)return"0 B";const n=1024,s=["B","KB","MB","GB"],a=Math.floor(Math.log(o)/Math.log(n));return`${parseFloat((o/Math.pow(n,a)).toFixed(2))} ${s[a]}`}p(formatSize,"formatSize");function formatCommitHash(i){return/^[a-f0-9]{40}$/i.test(i)?i.slice(0,7):i}p(formatCommitHash,"formatCommitHash");function getFilenameDetails(i){return i.includes(".")?{filename:i.split(".").slice(0,-1).join("."),suffix:i.split(".").pop()??null}:{filename:i,suffix:null}}p(getFilenameDetails,"getFilenameDetails");function getPathDetails(i){const o=i.split("/").slice(0,-1).join("/"),n=i.split("/").pop()??i;return{directory:o,fullFilename:n,...getFilenameDetails(n)}}p(getPathDetails,"getPathDetails");function normalizeI18nKey(i){return typeof i=="string"?i.replace(/\./g,"_"):""}p(normalizeI18nKey,"normalizeI18nKey");function processDynamicPrompt(i){function o(l){return l.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,"")}p(o,"stripComments");let n=0,s="";i=o(i);const a=p(()=>"\\"+i[n++],"handleEscape");function r(){const l=[];let u="",m=0;for(;n<i.length;){const _=i[n++];if(_==="\\"){u+=a();continue}else if(_==="{")m++;else if(_==="}"){if(!m)break;m--}else if(_==="|"&&!m){l.push(u),u="";continue}u+=_}l.push(u);const f=l[Math.floor(Math.random()*l.length)];return processDynamicPrompt(f)}for(p(r,"parseChoiceBlock");n<i.length;){const l=i[n++];l==="\\"?s+=a():l==="{"?s+=r():s+=l}return s.replace(/\\([{}|])/g,"$1")}p(processDynamicPrompt,"processDynamicPrompt");function isValidUrl(i){try{return new URL(i),!0}catch{return!1}}p(isValidUrl,"isValidUrl");function parseFilePath(i){if(!i?.trim())return{filename:"",subfolder:""};const o=i.replace(/[\\/]+/g,"/").replace(/^\//,"").replace(/\/$/,""),n=o.lastIndexOf("/");return n===-1?{filename:o,subfolder:""}:{filename:o.slice(n+1),subfolder:o.slice(0,n)}}p(parseFilePath,"parseFilePath");const parts={d:p(i=>i.getDate(),"d"),M:p(i=>i.getMonth()+1,"M"),h:p(i=>i.getHours(),"h"),m:p(i=>i.getMinutes(),"m"),s:p(i=>i.getSeconds(),"s")},format=Object.keys(parts).map(i=>i+i+"?").join("|")+"|yyy?y?";function formatDate(i,o){return i.replace(new RegExp(format,"g"),n=>n==="yy"?(o.getFullYear()+"").substring(2):n==="yyyy"?o.getFullYear().toString():n[0]in parts?(parts[n[0]](o)+"").padStart(n.length,"0"):n)}p(formatDate,"formatDate");const paramsToCacheKey=p(i=>typeof i=="string"?i:typeof i=="object"&&i!==null?Object.keys(i).sort((o,n)=>o.localeCompare(n)).map(o=>`${o}:${i[o]}`).join("&"):String(i),"paramsToCacheKey"),generateUUID=p(()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const o=Math.random()*16|0;return(i==="x"?o:o&3|8).toString(16)}),"generateUUID"),isCivitaiModelUrl=p(i=>{if(!isValidUrl(i)||!i.includes("civitai.com"))return!1;const n=new URL(i).pathname;return/^\/api\/download\/models\/(\d+)$/.test(n)||/^\/api\/v1\/models\/(\d+)$/.test(n)||/^\/api\/v1\/models-versions\/(\d+)$/.test(n)},"isCivitaiModelUrl"),downloadUrlToHfRepoUrl=p(i=>{try{const n=new URL(i).pathname;return`https://huggingface.co/${/^(.*?)(?:\/resolve\/|\/blob\/|$)/.exec(n)?.[1]?.replace(/^\//,"")||""}`}catch{return i}},"downloadUrlToHfRepoUrl");function formatMetronomeCurrency(i,o){return o==="usd"?(i/100).toFixed(2):i.toString()}p(formatMetronomeCurrency,"formatMetronomeCurrency");function usdToMicros(i){return Math.round(i*1e6)}p(usdToMicros,"usdToMicros");function linkifyHtml(i){if(!i)return"";const o=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%?=~_|])|(\bwww\.[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%?=~_|])/gi;return i.replace(o,(n,s,a,r)=>{const l=s||r;return`<a href="${r?`http://${l}`:l}" target="_blank" rel="noopener noreferrer" class="text-primary-400 hover:underline">${l}</a>`})}p(linkifyHtml,"linkifyHtml");function nl2br(i){return i?i.replace(/\n/g,"<br />"):""}p(nl2br,"nl2br");function formatVersionAnchor(i){return`v${i.replace(/\./g,"-")}`}p(formatVersionAnchor,"formatVersionAnchor");function stringToLocale(i){return["en","es","fr","ja","ko","ru","zh"].includes(i)?i:"en"}p(stringToLocale,"stringToLocale");function formatDuration(i){if(!i||i<0)return"0s";const o=Math.floor(i/1e3),n=Math.floor(o/3600),s=Math.floor(o%3600/60),a=Math.floor(o%60),r=[];return n>0&&r.push(`${n}h`),s>0&&r.push(`${s}m`),(a>0||r.length===0)&&r.push(`${a}s`),r.join(" ")}p(formatDuration,"formatDuration");const IMAGE_EXTENSIONS=["png","jpg","jpeg","gif","webp","bmp"],VIDEO_EXTENSIONS=["mp4","webm","mov","avi"],AUDIO_EXTENSIONS=["mp3","wav","ogg","flac"],THREE_D_EXTENSIONS=["obj","fbx","gltf","glb"];function truncateFilename(i,o=20){if(!i||i.length<=o)return i;const n=i.lastIndexOf("."),s=n>-1?i.substring(0,n):i,a=n>-1?i.substring(n):"";if(s.length<=o)return i;const r=Math.floor((o-3)/2),l=s.substring(0,r),u=s.substring(s.length-r);return`${l}...${u}${a}`}p(truncateFilename,"truncateFilename");function getMediaTypeFromFilename(i){if(!i)return"image";const o=i.split(".").pop()?.toLowerCase();return!o||IMAGE_EXTENSIONS.includes(o)?"image":VIDEO_EXTENSIONS.includes(o)?"video":AUDIO_EXTENSIONS.includes(o)?"audio":THREE_D_EXTENSIONS.includes(o)?"3D":"image"}p(getMediaTypeFromFilename,"getMediaTypeFromFilename");const isDOMWidget=p(i=>"element"in i&&!!i.element,"isDOMWidget"),isComponentWidget=p(i=>"component"in i&&!!i.component,"isComponentWidget");class BaseDOMWidgetImpl extends LegacyWidget{static{p(this,"BaseDOMWidgetImpl")}static DEFAULT_MARGIN=10;id;constructor(o){const{node:n,name:s,type:a,options:r}=o;super({y:0,name:s,type:a,options:r},n),this.id=generateUUID()}get value(){return this.options.getValue?.()??""}set value(o){this.options.setValue?.(o),this.callback?.(this.value)}get margin(){return this.options.margin??BaseDOMWidgetImpl.DEFAULT_MARGIN}isVisible(){return!["hidden"].includes(this.type)&&this.node.isWidgetVisible(this)}draw(o,n,s,a,r,l){if(this.options.hideOnZoom&&l&&this.isVisible()){const u=o.fillStyle;o.beginPath(),o.fillStyle=LiteGraph.WIDGET_BGCOLOR,o.rect(this.margin,a+this.margin,s-this.margin*2,(this.computedHeight??r)-2*this.margin),o.fill(),o.fillStyle=u}else if(this.promoted&&this.isVisible()){o.save();const u=this.margin-1;o.beginPath(),o.strokeStyle=LiteGraph.WIDGET_PROMOTED_OUTLINE_COLOR,o.strokeRect(u,a+u,s-u*2,(this.computedHeight??r)-2*u),o.restore()}this.options.onDraw?.(this)}onRemove(){useDomWidgetStore().unregisterWidget(this.id)}createCopyForNode(o){const n=new this.constructor({node:o,name:this.name,type:this.type,options:this.options});return n.value=this.value,n.y=this.y,n}}class DOMWidgetImpl extends BaseDOMWidgetImpl{static{p(this,"DOMWidgetImpl")}element;constructor(o){super(o),this.element=o.element}createCopyForNode(o){const n=new this.constructor({node:o,name:this.name,type:this.type,element:this.element,options:this.options});return n.value=this.value,n.y=this.y,n}computeLayoutSize(o){if(this.type==="hidden")return{minHeight:0,maxHeight:0,minWidth:0};const n=getComputedStyle(this.element);let s=this.options.getMinHeight?.()??parseInt(n.getPropertyValue("--comfy-widget-min-height")),a=this.options.getMaxHeight?.()??parseInt(n.getPropertyValue("--comfy-widget-max-height")),r=this.options.getHeight?.()??n.getPropertyValue("--comfy-widget-height");return typeof r=="string"&&r.endsWith?.("%")?r=o.size[1]*(parseFloat(r.substring(0,r.length-1))/100):(r=typeof r=="number"?r:parseInt(r),isNaN(s)&&(s=r)),{minHeight:isNaN(s)?50:s,maxHeight:isNaN(a)?void 0:a,minWidth:0}}}class ComponentWidgetImpl extends BaseDOMWidgetImpl{static{p(this,"ComponentWidgetImpl")}component;inputSpec;props;constructor(o){super({type:"custom",...o}),this.component=o.component,this.inputSpec=o.inputSpec,this.props=o.props}computeLayoutSize(){const o=this.options.getMinHeight?.()??50,n=this.options.getMaxHeight?.();return{minHeight:o,maxHeight:n,minWidth:0}}serializeValue(){return toRaw(this.value)}}const addWidget=p((i,o)=>{i.addCustomWidget(o),i.graph&&useDomWidgetStore().registerWidget(o),i.onAdded=useChainCallback(i.onAdded,()=>{useDomWidgetStore().registerWidget(o)}),i.onRemoved=useChainCallback(i.onRemoved,()=>{o.onRemove?.()}),i.onResize=useChainCallback(i.onResize,()=>{o.options.beforeResize?.call(o,i),o.options.afterResize?.call(o,i)})},"addWidget");LGraphNode.prototype.addDOMWidget=function(i,o,n,s={}){const a=new DOMWidgetImpl({node:this,name:i,type:o,element:n,options:{hideOnZoom:!0,...s}});return addWidget(this,a),Object.defineProperty(a,"value",{get(){return this.options.getValue?.()??""},set(r){this.options.setValue?.(r),this.callback?.(this.value)}}),a};window.comfyAPI=window.comfyAPI||{};window.comfyAPI.domWidget=window.comfyAPI.domWidget||{};window.comfyAPI.domWidget.isDOMWidget=isDOMWidget;window.comfyAPI.domWidget.isComponentWidget=isComponentWidget;window.comfyAPI.domWidget.DOMWidgetImpl=DOMWidgetImpl;window.comfyAPI.domWidget.ComponentWidgetImpl=ComponentWidgetImpl;window.comfyAPI.domWidget.addWidget=addWidget;function useNodeAnimatedImage(){function i(n){if(!n.imgs?.length||!n.widgets)return;const s=n.widgets.findIndex(a=>a.name===ANIM_PREVIEW_WIDGET);if(n.imgs[0].classList.value="block size-full object-contain",s>-1){const a=n.widgets[s];if(!isDOMWidget(a))return;a.element.replaceChildren(n.imgs[0])}else{const a=document.createElement("div");a.appendChild(n.imgs[0]);const r=n.addDOMWidget(ANIM_PREVIEW_WIDGET,"img",a,{hideOnZoom:!1});n.overIndex=0;const{handleWheel:l,handlePointer:u,forwardEventToCanvas:m}=useCanvasInteractions();n.imgs[0].style.pointerEvents="none",a.addEventListener("wheel",l),a.addEventListener("pointermove",u),a.addEventListener("pointerup",u),a.addEventListener("pointerdown",f=>f.button!==2?u(f):m(f),!0),r.serialize=!1,r.serializeValue=()=>{}}}p(i,"showAnimatedPreview");function o(n){if(!n.widgets)return;const s=n.widgets.findIndex(a=>a.name===ANIM_PREVIEW_WIDGET);s>-1&&(n.widgets[s].onRemove?.(),n.widgets.splice(s,1))}return p(o,"removeAnimatedPreview"),{showAnimatedPreview:i,removeAnimatedPreview:o}}p(useNodeAnimatedImage,"useNodeAnimatedImage");const IMAGE_WORKFLOW_FORMATS={extensions:[".png",".webp",".svg",".avif"],mimeTypes:["image/png","image/webp","image/svg+xml","image/avif"]},AUDIO_WORKFLOW_FORMATS={extensions:[".mp3",".ogg",".flac"],mimeTypes:["audio/mpeg","audio/ogg","audio/flac","audio/x-flac"]},VIDEO_WORKFLOW_FORMATS={extensions:[".mp4",".mov",".m4v",".webm"],mimeTypes:["video/mp4","video/quicktime","video/x-m4v","video/webm"]},MODEL_WORKFLOW_FORMATS={extensions:[".glb"],mimeTypes:["model/gltf-binary"]},DATA_WORKFLOW_FORMATS={extensions:[".json",".latent",".safetensors"],mimeTypes:["application/json"]},ALL_WORKFLOW_FORMATS={extensions:[...IMAGE_WORKFLOW_FORMATS.extensions,...AUDIO_WORKFLOW_FORMATS.extensions,...VIDEO_WORKFLOW_FORMATS.extensions,...MODEL_WORKFLOW_FORMATS.extensions,...DATA_WORKFLOW_FORMATS.extensions],mimeTypes:[...IMAGE_WORKFLOW_FORMATS.mimeTypes,...AUDIO_WORKFLOW_FORMATS.mimeTypes,...VIDEO_WORKFLOW_FORMATS.mimeTypes,...MODEL_WORKFLOW_FORMATS.mimeTypes,...DATA_WORKFLOW_FORMATS.mimeTypes]},WORKFLOW_ACCEPT_STRING=[...ALL_WORKFLOW_FORMATS.extensions,...ALL_WORKFLOW_FORMATS.mimeTypes].join(","),zNodeId=z.union([z.number().int(),z.string()]),zNodeInputName=z.string(),zSlotIndex=z.union([z.number().int(),z.string().transform(i=>parseInt(i)).refine(i=>!isNaN(i),{message:"Invalid number"})]),zDataType=z.union([z.string(),z.array(z.string()),z.number()]),zVector2=z.union([z.object({0:z.number(),1:z.number()}).passthrough().transform(i=>[i[0],i[1]]),z.tuple([z.number(),z.number()])]),zModelFile=z.object({name:z.string(),url:z.string().url(),hash:z.string().optional(),hash_type:z.string().optional(),directory:z.string()}),zGraphState=z.object({lastGroupId:z.number(),lastNodeId:z.number(),lastLinkId:z.number(),lastRerouteId:z.number()}).passthrough(),zComfyLink=z.tuple([z.number(),zNodeId,zSlotIndex,zNodeId,zSlotIndex,zDataType]),zComfyLinkExtension=z.object({id:z.number(),parentId:z.number()}).passthrough(),zComfyLinkObject=z.object({id:z.number(),origin_id:zNodeId,origin_slot:zSlotIndex,target_id:zNodeId,target_slot:zSlotIndex,type:zDataType,parentId:z.number().optional()}).passthrough(),zReroute=z.object({id:z.number(),parentId:z.number().optional(),pos:zVector2,linkIds:z.array(z.number()).nullish(),floating:z.object({slotType:z.enum(["input","output"])}).optional()}).passthrough(),zNodeOutput=z.object({name:z.string(),type:zDataType,links:z.array(z.number()).nullable().optional(),slot_index:zSlotIndex.optional()}).passthrough(),zNodeInput=z.object({name:zNodeInputName,type:zDataType,link:z.number().nullable().optional(),slot_index:zSlotIndex.optional()}).passthrough(),zFlags=z.object({collapsed:z.boolean().optional(),pinned:z.boolean().optional(),allow_interaction:z.boolean().optional(),horizontal:z.boolean().optional(),skip_repeated_outputs:z.boolean().optional()}).passthrough(),repoLikeIdPattern=/^[a-zA-Z0-9](?:[a-zA-Z0-9._-]*[a-zA-Z0-9])?$/,githubUsernamePattern=/^(?!-)(?!.*--)[a-zA-Z0-9-]+(?<!-)$/,gitHashPattern=/^[0-9a-f]{4,40}$/i,semverPattern=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-([\da-z-]+(?:\.[\da-z-]+)*))?(?:\+([\da-z-]+(?:\.[\da-z-]+)*))?$/,zRepoLikeId=z.string().min(1).max(100).regex(repoLikeIdPattern,{message:"ID can only contain ASCII letters, digits, '_', '-', and '.'"}).refine(i=>!/^[_\-.]|[_\-.]$/.test(i),{message:"ID must not start or end with '_', '-', or '.'"}),zCnrId=zRepoLikeId,zGithubRepoName=zRepoLikeId,zGithubUsername=z.string().min(1).max(39).regex(githubUsernamePattern,"Invalid GitHub username/org"),zAuxId=z.string().regex(/^[^/]+\/[^/]+$/,"Invalid format. Must be 'github-user/repo-name'").transform(i=>i.split("/")).refine(([i,o])=>zGithubUsername.safeParse(i).success&&zGithubRepoName.safeParse(o).success,"Invalid aux_id: Must be valid 'github-username/github-repo-name'").transform(([i,o])=>`${i}/${o}`),zGitHash=z.string().superRefine((i,o)=>{gitHashPattern.test(i)||o.addIssue({code:z.ZodIssueCode.custom,message:`Node pack version has invalid Git commit hash: "${i}"`})}),zSemVer=z.string().superRefine((i,o)=>{semverPattern.test(i)||o.addIssue({code:z.ZodIssueCode.custom,message:`Node pack version has invalid semantic version: "${i}"`})}),zVersion=z.union([z.string().transform(i=>i.replace(/^v/,"")).pipe(z.union([zSemVer,zGitHash])),z.literal("unknown")]),zProperties=z.object({"Node name for S&R":z.string().optional(),cnr_id:zCnrId.optional(),aux_id:zAuxId.optional(),ver:zVersion.optional(),models:z.array(zModelFile).optional()}).passthrough(),zWidgetValues=z.union([z.array(z.any()),z.record(z.any())]),zComfyNode=z.object({id:zNodeId,type:z.string(),pos:zVector2,size:zVector2,flags:zFlags,order:z.number(),mode:z.number(),inputs:z.array(zNodeInput).optional(),outputs:z.array(zNodeOutput).optional(),properties:zProperties,widgets_values:zWidgetValues.optional(),color:z.string().optional(),bgcolor:z.string().optional()}).passthrough(),zSubgraphIO=zNodeInput.extend({id:z.string().uuid(),type:z.string(),linkIds:z.array(z.number()).optional()}),zSubgraphInstance=z.object({id:zNodeId,type:z.string().uuid(),pos:zVector2,size:zVector2,flags:zFlags,order:z.number(),mode:z.number(),inputs:z.array(zSubgraphIO).optional(),outputs:z.array(zSubgraphIO).optional(),widgets_values:zWidgetValues.optional(),color:z.string().optional(),bgcolor:z.string().optional()}).passthrough(),zGroup=z.object({id:z.number().optional(),title:z.string(),bounding:z.tuple([z.number(),z.number(),z.number(),z.number()]),color:z.string().optional(),font_size:z.number().optional(),locked:z.boolean().optional()}).passthrough(),zDS=z.object({scale:z.number(),offset:zVector2}).passthrough(),zConfig=z.object({links_ontop:z.boolean().optional(),align_to_grid:z.boolean().optional()}).passthrough(),zExtra=z.object({ds:zDS.optional(),frontendVersion:z.string().optional(),linkExtensions:z.array(zComfyLinkExtension).optional(),reroutes:z.array(zReroute).optional()}).passthrough(),zGraphDefinitions=z.object({subgraphs:z.lazy(()=>z.array(zSubgraphDefinition))}),zBaseExportableGraph=z.object({id:z.string().uuid().optional(),revision:z.number().optional(),config:zConfig.optional().nullable(),subgraphs:z.array(zSubgraphInstance).optional()}),zComfyWorkflow=zBaseExportableGraph.extend({id:z.string().uuid().optional(),revision:z.number().optional(),last_node_id:zNodeId,last_link_id:z.number(),nodes:z.array(zComfyNode),links:z.array(zComfyLink),floatingLinks:z.array(zComfyLinkObject).optional(),groups:z.array(zGroup).optional(),config:zConfig.optional().nullable(),extra:zExtra.optional().nullable(),version:z.number(),models:z.array(zModelFile).optional(),definitions:zGraphDefinitions.optional()}).passthrough(),zComfyWorkflow1=zBaseExportableGraph.extend({id:z.string().uuid().optional(),revision:z.number().optional(),version:z.literal(1),config:zConfig.optional().nullable(),state:zGraphState,groups:z.array(zGroup).optional(),nodes:z.array(zComfyNode),links:z.array(zComfyLinkObject).optional(),floatingLinks:z.array(zComfyLinkObject).optional(),reroutes:z.array(zReroute).optional(),extra:zExtra.optional().nullable(),models:z.array(zModelFile).optional(),definitions:z.object({subgraphs:z.lazy(()=>z.array(zSubgraphDefinition))}).optional()}).passthrough(),zExportedSubgraphIONode=z.object({id:zNodeId,bounding:z.tuple([z.number(),z.number(),z.number(),z.number()]),pinned:z.boolean().optional()}),zExposedWidget=z.object({id:z.string(),name:z.string()}),zSubgraphDefinition=zComfyWorkflow1.extend({id:z.string().uuid(),revision:z.number(),name:z.string(),inputNode:zExportedSubgraphIONode,outputNode:zExportedSubgraphIONode,inputs:z.array(zSubgraphIO).optional(),outputs:z.array(zSubgraphIO).optional(),widgets:z.array(zExposedWidget).optional(),definitions:z.object({subgraphs:z.lazy(()=>zSubgraphDefinition.array())}).optional()}).passthrough();function isSubgraphDefinition(i){return i&&typeof i=="object"&&"id"in i&&"name"in i&&"nodes"in i&&Array.isArray(i.nodes)&&"inputNode"in i&&"outputNode"in i}p(isSubgraphDefinition,"isSubgraphDefinition");const zWorkflowVersion=z.object({version:z.number()});async function validateComfyWorkflow(i,o=console.warn){const n=zWorkflowVersion.safeParse(i);let s;if(n.success)n.data.version===1?s=await zComfyWorkflow1.safeParseAsync(i):s=await zComfyWorkflow.safeParseAsync(i);else{const r=fromZodError(n.error);return o(`Workflow does not contain a valid version.  Zod error:
${r}`),null}if(s.success)return s.data;const a=fromZodError(s.error);return o(`Invalid workflow against zod schema:
${a}`),null}p(validateComfyWorkflow,"validateComfyWorkflow");const zNodeInputValue=z.union([z.any(),z.tuple([zNodeId,zSlotIndex])]),zNodeData=z.object({inputs:z.record(zNodeInputName,zNodeInputValue),class_type:z.string(),_meta:z.object({title:z.string()})});z.record(zNodeId,zNodeData);const nodeSlotSchema=z.object({CLIP:z.string(),CLIP_VISION:z.string(),CLIP_VISION_OUTPUT:z.string(),CONDITIONING:z.string(),CONTROL_NET:z.string(),IMAGE:z.string(),LATENT:z.string(),MASK:z.string(),MODEL:z.string(),STYLE_MODEL:z.string(),VAE:z.string(),NOISE:z.string(),GUIDER:z.string(),SAMPLER:z.string(),SIGMAS:z.string(),TAESD:z.string()}),litegraphBaseSchema=z.object({BACKGROUND_IMAGE:z.string(),CLEAR_BACKGROUND_COLOR:z.string(),NODE_TITLE_COLOR:z.string(),NODE_SELECTED_TITLE_COLOR:z.string(),NODE_TEXT_SIZE:z.number(),NODE_TEXT_COLOR:z.string(),NODE_TEXT_HIGHLIGHT_COLOR:z.string(),NODE_SUBTEXT_SIZE:z.number(),NODE_DEFAULT_COLOR:z.string(),NODE_DEFAULT_BGCOLOR:z.string(),NODE_DEFAULT_BOXCOLOR:z.string(),NODE_DEFAULT_SHAPE:z.union([z.literal(LiteGraph.BOX_SHAPE),z.literal(LiteGraph.ROUND_SHAPE),z.literal(LiteGraph.CARD_SHAPE),z.string()]),NODE_BOX_OUTLINE_COLOR:z.string(),NODE_BYPASS_BGCOLOR:z.string(),NODE_ERROR_COLOUR:z.string(),DEFAULT_SHADOW_COLOR:z.string(),DEFAULT_GROUP_FONT:z.number(),WIDGET_BGCOLOR:z.string(),WIDGET_OUTLINE_COLOR:z.string(),WIDGET_TEXT_COLOR:z.string(),WIDGET_SECONDARY_TEXT_COLOR:z.string(),WIDGET_DISABLED_TEXT_COLOR:z.string(),LINK_COLOR:z.string(),EVENT_LINK_COLOR:z.string(),CONNECTING_LINK_COLOR:z.string(),BADGE_FG_COLOR:z.string(),BADGE_BG_COLOR:z.string()}),comfyBaseSchema=z.object({"fg-color":z.string(),"bg-color":z.string(),"bg-img":z.string().optional(),"comfy-menu-bg":z.string(),"comfy-menu-secondary-bg":z.string(),"comfy-input-bg":z.string(),"input-text":z.string(),"descrip-text":z.string(),"drag-text":z.string(),"error-text":z.string(),"border-color":z.string(),"tr-even-bg-color":z.string(),"tr-odd-bg-color":z.string(),"content-bg":z.string(),"content-fg":z.string(),"content-hover-bg":z.string(),"content-hover-fg":z.string(),"bar-shadow":z.string(),"contrast-mix-color":z.string().optional(),"interface-stroke":z.string().optional(),"interface-panel-surface":z.string().optional(),"interface-panel-box-shadow":z.string().optional(),"interface-panel-drop-shadow":z.string().optional(),"interface-panel-hover-surface":z.string().optional(),"interface-panel-selected-surface":z.string().optional(),"interface-button-hover-surface":z.string().optional()}),colorsSchema=z.object({node_slot:nodeSlotSchema,litegraph_base:litegraphBaseSchema,comfy_base:comfyBaseSchema}),partialColorsSchema=z.object({node_slot:nodeSlotSchema.partial(),litegraph_base:litegraphBaseSchema.partial(),comfy_base:comfyBaseSchema.partial()}),paletteSchema=z.object({id:z.string(),name:z.string(),colors:partialColorsSchema,light_theme:z.boolean().optional()}).passthrough();z.object({id:z.string(),name:z.string(),colors:colorsSchema}).passthrough();const colorPalettesSchema=z.record(paletteSchema),zKeyCombo=z.object({key:z.string(),ctrl:z.boolean().optional(),alt:z.boolean().optional(),shift:z.boolean().optional(),meta:z.boolean().optional()}),zKeybinding=z.object({commandId:z.string(),combo:zKeyCombo,targetElementId:z.string().optional()});var NodeSourceType=(i=>(i.Core="core",i.CustomNodes="custom_nodes",i.Blueprint="blueprint",i.Unknown="unknown",i))(NodeSourceType||{});const UNKNOWN_NODE_SOURCE={type:"unknown",className:"comfy-unknown",displayText:"Unknown",badgeText:"?"},shortenNodeName=p(i=>i.replace(/^(ComfyUI-|ComfyUI_|Comfy-|Comfy_)/,"").replace(/(-ComfyUI|_ComfyUI|-Comfy|_Comfy)$/,""),"shortenNodeName"),getNodeSource=p(i=>{if(!i)return UNKNOWN_NODE_SOURCE;const o=i.split(".");if(["nodes","comfy_extras","comfy_api_nodes"].includes(o[0]))return{type:"core",className:"comfy-core",displayText:"Comfy Core",badgeText:"ðŸ¦Š"};if(o[0]==="blueprint")return{type:"blueprint",className:"blueprint",displayText:"Blueprint",badgeText:"bp"};if(o[0]==="custom_nodes"){const s=o[1].split("@")[0],a=shortenNodeName(s);return{type:"custom_nodes",className:"comfy-custom-nodes",displayText:a,badgeText:a}}else return UNKNOWN_NODE_SOURCE},"getNodeSource");var NodeBadgeMode=(i=>(i.None="None",i.ShowAll="Show all",i.HideBuiltIn="Hide built-in",i))(NodeBadgeMode||{}),LinkReleaseTriggerAction=(i=>(i.CONTEXT_MENU="context menu",i.SEARCH_BOX="search box",i.NO_ACTION="no action",i))(LinkReleaseTriggerAction||{});const zNodeType=z.string(),zQueueIndex=z.number(),zPromptId=z.string(),resultItemType=z.enum(["input","output","temp"]),zResultItem=z.object({filename:z.string().optional(),subfolder:z.string().optional(),type:resultItemType.optional()}),zOutputs=z.object({audio:z.array(zResultItem).optional(),images:z.array(zResultItem).optional(),video:z.array(zResultItem).optional(),animated:z.array(z.boolean()).optional()}).passthrough(),zStatusWsMessageStatus=z.object({exec_info:z.object({queue_remaining:z.number().int()})});z.object({status:zStatusWsMessageStatus.nullish(),sid:z.string().nullish()});z.object({value:z.number().int(),max:z.number().int(),prompt_id:zPromptId,node:zNodeId});const zNodeProgressState=z.object({value:z.number(),max:z.number(),state:z.enum(["pending","running","finished","error"]),node_id:zNodeId,prompt_id:zPromptId,display_node_id:zNodeId.optional(),parent_node_id:zNodeId.optional(),real_node_id:zNodeId.optional()});z.object({prompt_id:zPromptId,nodes:z.record(zNodeId,zNodeProgressState)});const zExecutingWsMessage=z.object({node:zNodeId,display_node:zNodeId,prompt_id:zPromptId});zExecutingWsMessage.extend({output:zOutputs,merge:z.boolean().optional()});const zExecutionWsMessageBase=z.object({prompt_id:zPromptId,timestamp:z.number().int()}),zExecutionStartWsMessage=zExecutionWsMessageBase,zExecutionSuccessWsMessage=zExecutionWsMessageBase,zExecutionCachedWsMessage=zExecutionWsMessageBase.extend({nodes:z.array(zNodeId)}),zExecutionInterruptedWsMessage=zExecutionWsMessageBase.extend({node_id:zNodeId,node_type:zNodeType,executed:z.array(zNodeId)}),zExecutionErrorWsMessage=zExecutionWsMessageBase.extend({node_id:zNodeId,node_type:zNodeType,executed:z.array(zNodeId),exception_message:z.string(),exception_type:z.string(),traceback:z.array(z.string()),current_inputs:z.any(),current_outputs:z.any()});z.object({nodeId:zNodeId,text:z.string()});z.object({value:z.string(),id:z.string().optional()});const zTerminalSize=z.object({cols:z.number(),row:z.number()}),zLogEntry=z.object({t:z.string(),m:z.string()});z.object({size:zTerminalSize.optional(),entries:z.array(zLogEntry)});z.object({size:zTerminalSize,entries:z.array(zLogEntry)});z.record(z.string(),z.any());const zPromptInputItem=z.object({inputs:z.record(z.string(),z.any()),class_type:zNodeType}),zPromptInputs=z.record(zPromptInputItem),zExtraPngInfo=z.object({workflow:zComfyWorkflow}).passthrough(),zExtraData=z.object({extra_pnginfo:zExtraPngInfo.optional(),client_id:z.string().optional(),create_time:z.number().int().optional()}).passthrough(),zOutputsToExecute=z.array(zNodeId),zExecutionStartMessage=z.tuple([z.literal("execution_start"),zExecutionStartWsMessage]),zExecutionSuccessMessage=z.tuple([z.literal("execution_success"),zExecutionSuccessWsMessage]),zExecutionCachedMessage=z.tuple([z.literal("execution_cached"),zExecutionCachedWsMessage]),zExecutionInterruptedMessage=z.tuple([z.literal("execution_interrupted"),zExecutionInterruptedWsMessage]),zExecutionErrorMessage=z.tuple([z.literal("execution_error"),zExecutionErrorWsMessage]),zStatusMessage=z.union([zExecutionStartMessage,zExecutionSuccessMessage,zExecutionCachedMessage,zExecutionInterruptedMessage,zExecutionErrorMessage]),zStatus=z.object({status_str:z.enum(["success","error"]),completed:z.boolean(),messages:z.array(zStatusMessage)}),zTaskPrompt=z.tuple([zQueueIndex,zPromptId,zPromptInputs,zExtraData,zOutputsToExecute]),zRunningTaskItem=z.object({taskType:z.literal("Running"),prompt:zTaskPrompt,remove:z.object({name:z.literal("Cancel"),cb:z.function()})}),zPendingTaskItem=z.object({taskType:z.literal("Pending"),prompt:zTaskPrompt}),zTaskOutput=z.record(zNodeId,zOutputs),zNodeOutputsMeta=z.object({node_id:zNodeId,display_node:zNodeId,prompt_id:zPromptId.optional(),read_node_id:zNodeId.optional()}),zTaskMeta=z.record(zNodeId,zNodeOutputsMeta),zHistoryTaskItem=z.object({taskType:z.literal("History"),prompt:zTaskPrompt,status:zStatus.optional(),outputs:zTaskOutput,meta:zTaskMeta.optional()});z.union([zRunningTaskItem,zPendingTaskItem,zHistoryTaskItem]);z.union([z.literal("Running"),z.literal("Pending"),z.literal("History")]);z.array(z.string());z.array(z.string());const zError=z.object({type:z.string(),message:z.string(),details:z.string(),extra_info:z.object({input_name:z.string().optional()}).passthrough().optional()}),zNodeError=z.object({errors:z.array(zError),class_type:z.string(),dependent_outputs:z.array(z.any())});z.object({node_errors:z.record(zNodeId,zNodeError).optional(),prompt_id:z.string().optional(),exec_info:z.object({queue_remaining:z.number().optional()}).optional(),error:z.union([z.string(),zError])});const zDeviceStats=z.object({name:z.string(),type:z.string(),index:z.number(),vram_total:z.number(),vram_free:z.number(),torch_vram_total:z.number(),torch_vram_free:z.number()});z.object({system:z.object({os:z.string(),python_version:z.string(),embedded_python:z.boolean(),comfyui_version:z.string(),pytorch_version:z.string(),required_frontend_version:z.string().optional(),argv:z.array(z.string()),ram_total:z.number(),ram_free:z.number(),cloud_version:z.string().optional(),comfyui_frontend_version:z.string().optional(),workflow_templates_version:z.string().optional()}),devices:z.array(zDeviceStats)});z.object({storage:z.enum(["server"]),migrated:z.boolean().optional(),users:z.record(z.string(),z.string()).optional()});z.array(z.array(z.string(),z.string()));z.object({path:z.string(),size:z.number(),modified:z.number()});const zBookmarkCustomization=z.object({icon:z.string().optional(),color:z.string().optional()}),zLinkReleaseTriggerAction=z.enum(Object.values(LinkReleaseTriggerAction)),zNodeBadgeMode=z.enum(Object.values(NodeBadgeMode));z.object({"Comfy.ColorPalette":z.string(),"Comfy.CustomColorPalettes":colorPalettesSchema,"Comfy.Canvas.BackgroundImage":z.string().optional(),"Comfy.ConfirmClear":z.boolean(),"Comfy.DevMode":z.boolean(),"Comfy.Workflow.ShowMissingNodesWarning":z.boolean(),"Comfy.Workflow.ShowMissingModelsWarning":z.boolean(),"Comfy.Workflow.WarnBlueprintOverwrite":z.boolean(),"Comfy.DisableFloatRounding":z.boolean(),"Comfy.DisableSliders":z.boolean(),"Comfy.DOMClippingEnabled":z.boolean(),"Comfy.EditAttention.Delta":z.number(),"Comfy.EnableTooltips":z.boolean(),"Comfy.EnableWorkflowViewRestore":z.boolean(),"Comfy.FloatRoundingPrecision":z.number(),"Comfy.Graph.CanvasInfo":z.boolean(),"Comfy.Graph.CanvasMenu":z.boolean(),"Comfy.Graph.CtrlShiftZoom":z.boolean(),"Comfy.Graph.LinkMarkers":z.nativeEnum(LinkMarkerShape),"Comfy.Graph.ZoomSpeed":z.number(),"Comfy.Group.DoubleClickTitleToEdit":z.boolean(),"Comfy.GroupSelectedNodes.Padding":z.number(),"Comfy.Locale":z.string(),"Comfy.NodeLibrary.Bookmarks":z.array(z.string()),"Comfy.NodeLibrary.Bookmarks.V2":z.array(z.string()),"Comfy.NodeLibrary.BookmarksCustomization":z.record(z.string(),zBookmarkCustomization),"Comfy.LinkRelease.Action":zLinkReleaseTriggerAction,"Comfy.LinkRelease.ActionShift":zLinkReleaseTriggerAction,"Comfy.ModelLibrary.AutoLoadAll":z.boolean(),"Comfy.ModelLibrary.NameFormat":z.enum(["filename","title"]),"Comfy.NodeSearchBoxImpl.NodePreview":z.boolean(),"Comfy.NodeSearchBoxImpl":z.enum(["default","simple"]),"Comfy.NodeSearchBoxImpl.ShowCategory":z.boolean(),"Comfy.NodeSearchBoxImpl.ShowIdName":z.boolean(),"Comfy.NodeSearchBoxImpl.ShowNodeFrequency":z.boolean(),"Comfy.NodeSuggestions.number":z.number(),"Comfy.Node.BypassAllLinksOnDelete":z.boolean(),"Comfy.Node.Opacity":z.number(),"Comfy.Node.MiddleClickRerouteNode":z.boolean(),"Comfy.Node.ShowDeprecated":z.boolean(),"Comfy.Node.ShowExperimental":z.boolean(),"Comfy.Pointer.ClickBufferTime":z.number(),"Comfy.Pointer.ClickDrift":z.number(),"Comfy.Pointer.DoubleClickTime":z.number(),"Comfy.PreviewFormat":z.string(),"Comfy.PromptFilename":z.boolean(),"Comfy.Sidebar.Location":z.enum(["left","right"]),"Comfy.Sidebar.Size":z.enum(["small","normal"]),"Comfy.Sidebar.UnifiedWidth":z.boolean(),"Comfy.Sidebar.Style":z.enum(["floating","connected"]),"Comfy.SnapToGrid.GridSize":z.number(),"Comfy.TextareaWidget.FontSize":z.number(),"Comfy.TextareaWidget.Spellcheck":z.boolean(),"Comfy.UseNewMenu":z.enum(["Disabled","Top"]),"Comfy.TreeExplorer.ItemPadding":z.number(),"Comfy.Validation.Workflows":z.boolean(),"Comfy.Workflow.SortNodeIdOnSave":z.boolean(),"Comfy.Queue.ImageFit":z.enum(["contain","cover"]),"Comfy.Workflow.WorkflowTabsPosition":z.enum(["Sidebar","Topbar"]),"Comfy.Node.DoubleClickTitleToEdit":z.boolean(),"Comfy.WidgetControlMode":z.enum(["before","after"]),"Comfy.Window.UnloadConfirmation":z.boolean(),"Comfy.NodeBadge.NodeSourceBadgeMode":zNodeBadgeMode,"Comfy.NodeBadge.NodeIdBadgeMode":zNodeBadgeMode,"Comfy.NodeBadge.NodeLifeCycleBadgeMode":zNodeBadgeMode,"Comfy.NodeBadge.ShowApiPricing":z.boolean(),"Comfy.Notification.ShowVersionUpdates":z.boolean(),"Comfy.QueueButton.BatchCountLimit":z.number(),"Comfy.Queue.MaxHistoryItems":z.number(),"Comfy.Keybinding.UnsetBindings":z.array(zKeybinding),"Comfy.Keybinding.NewBindings":z.array(zKeybinding),"Comfy.Extension.Disabled":z.array(z.string()),"Comfy.LinkRenderMode":z.number(),"Comfy.Node.AutoSnapLinkToSlot":z.boolean(),"Comfy.Node.SnapHighlightsNode":z.boolean(),"Comfy.Server.ServerConfigValues":z.record(z.string(),z.any()),"Comfy.Server.LaunchArgs":z.record(z.string(),z.string()),"LiteGraph.Canvas.MaximumFps":z.number(),"Comfy.Workflow.ConfirmDelete":z.boolean(),"Comfy.Workflow.AutoSaveDelay":z.number(),"Comfy.Workflow.AutoSave":z.enum(["off","after delay"]),"Comfy.RerouteBeta":z.boolean(),"LiteGraph.Canvas.MinFontSizeForLOD":z.number(),"Comfy.Canvas.SelectionToolbox":z.boolean(),"LiteGraph.Node.TooltipDelay":z.number(),"LiteGraph.ContextMenu.Scaling":z.boolean(),"LiteGraph.Reroute.SplineOffset":z.number(),"LiteGraph.Canvas.LowQualityRenderingZoomThreshold":z.number(),"Comfy.Toast.DisableReconnectingToast":z.boolean(),"Comfy.Workflow.Persist":z.boolean(),"Comfy.TutorialCompleted":z.boolean(),"Comfy.InstalledVersion":z.string().nullable(),"Comfy.Node.AllowImageSizeDraw":z.boolean(),"Comfy.Minimap.Visible":z.boolean(),"Comfy.Minimap.NodeColors":z.boolean(),"Comfy.Minimap.ShowLinks":z.boolean(),"Comfy.Minimap.ShowGroups":z.boolean(),"Comfy.Minimap.RenderBypassState":z.boolean(),"Comfy.Minimap.RenderErrorState":z.boolean(),"Comfy.Canvas.NavigationMode":z.string(),"Comfy.Canvas.LeftMouseClickBehavior":z.string(),"Comfy.Canvas.MouseWheelScroll":z.string(),"Comfy.VueNodes.Enabled":z.boolean(),"Comfy.VueNodes.AutoScaleLayout":z.boolean(),"Comfy.Assets.UseAssetAPI":z.boolean(),"Comfy-Desktop.AutoUpdate":z.boolean(),"Comfy-Desktop.SendStatistics":z.boolean(),"Comfy-Desktop.WindowStyle":z.string(),"Comfy-Desktop.UV.PythonInstallMirror":z.string(),"Comfy-Desktop.UV.PypiInstallMirror":z.string(),"Comfy-Desktop.UV.TorchInstallMirror":z.string(),"Comfy.MaskEditor.UseNewEditor":z.boolean(),"Comfy.MaskEditor.BrushAdjustmentSpeed":z.number(),"Comfy.MaskEditor.UseDominantAxis":z.boolean(),"Comfy.Load3D.ShowGrid":z.boolean(),"Comfy.Load3D.BackgroundColor":z.string(),"Comfy.Load3D.LightIntensity":z.number(),"Comfy.Load3D.LightIntensityMaximum":z.number(),"Comfy.Load3D.LightIntensityMinimum":z.number(),"Comfy.Load3D.LightAdjustmentIncrement":z.number(),"Comfy.Load3D.CameraType":z.enum(["perspective","orthographic"]),"Comfy.Load3D.3DViewerEnable":z.boolean(),"Comfy.Memory.AllowManualUnload":z.boolean(),"pysssss.SnapToGrid":z.boolean(),"VHS.AdvancedPreviews":z.string(),"Comfy.Release.Version":z.string(),"Comfy.Release.Status":z.enum(["skipped","changelog seen","what's new seen"]),"Comfy.Release.Timestamp":z.number(),"Comfy.Templates.SelectedModels":z.array(z.string()),"Comfy.Templates.SelectedUseCases":z.array(z.string()),"Comfy.Templates.SelectedRunsOn":z.array(z.string()),"Comfy.Templates.SortBy":z.enum(["default","alphabetical","newest","vram-low-to-high","model-size-low-to-high"]),"test.setting":z.any(),"main.sub.setting.name":z.any(),"single.setting":z.any(),"LiteGraph.Node.DefaultPadding":z.boolean(),"LiteGraph.Pointer.TrackpadGestures":z.boolean()});function useErrorHandling(){const i=useToastStore(),o=p(a=>{i.add({severity:"error",summary:t("g.error"),detail:a instanceof Error?a.message:t("g.unknownError")}),console.error(a)},"toastErrorHandler");return{wrapWithErrorHandling:p((a,r,l)=>(...u)=>{try{return a(...u)}catch(m){(r??o)(m)}finally{l?.()}},"wrapWithErrorHandling"),wrapWithErrorHandlingAsync:p((a,r,l,u=[])=>async(...m)=>{try{return await a(...m)}catch(f){for(const _ of u)if(_.shouldHandle(f))try{await _.recover(f,a,m);return}catch(y){console.error("Recovery strategy failed:",y)}(r??o)(f)}finally{l?.()}},"wrapWithErrorHandlingAsync"),toastErrorHandler:o}}p(useErrorHandling,"useErrorHandling");const PROD_API_BASE_URL="https://api.comfy.org",PROD_PLATFORM_BASE_URL="https://platform.comfy.org",BUILD_TIME_API_BASE_URL=PROD_API_BASE_URL,BUILD_TIME_PLATFORM_BASE_URL=PROD_PLATFORM_BASE_URL;function getComfyApiBaseUrl(){return BUILD_TIME_API_BASE_URL}p(getComfyApiBaseUrl,"getComfyApiBaseUrl");function getComfyPlatformBaseUrl(){return BUILD_TIME_PLATFORM_BASE_URL}p(getComfyPlatformBaseUrl,"getComfyPlatformBaseUrl");const MONTHLY_SUBSCRIPTION_PRICE=20,STORAGE_KEY$1="comfy_api_key",useApiKeyAuthStore=defineStore("apiKeyAuth",()=>{const i=useFirebaseAuthStore(),o=useLocalStorage(STORAGE_KEY$1,null),n=useToastStore(),{wrapWithErrorHandlingAsync:s,toastErrorHandler:a}=useErrorHandling(),r=ref(null),l=computed(()=>!!r.value),u=p(async()=>{const w=await i.createCustomer().catch(k=>{console.error(k)});if(!w)throw o.value=null,new Error(t("auth.login.noAssociatedUser"));r.value=w},"initializeUserFromApiKey");watch(o,()=>{o.value?u():r.value=null},{immediate:!0});const m=p(w=>{w instanceof Error&&w.message==="STORAGE_FAILED"?n.add({severity:"error",summary:t("auth.apiKey.storageFailed"),detail:t("auth.apiKey.storageFailedDetail")}):a(w)},"reportError"),f=s(async w=>(o.value=w,n.add({severity:"success",summary:t("auth.apiKey.stored"),detail:t("auth.apiKey.storedDetail"),life:5e3}),!0),m),_=s(async()=>(o.value=null,n.add({severity:"success",summary:t("auth.apiKey.cleared"),detail:t("auth.apiKey.clearedDetail"),life:5e3}),!0),m),y=p(()=>o.value,"getApiKey");return{currentUser:r,isAuthenticated:l,storeApiKey:f,clearStoredApiKey:_,getAuthHeader:p(()=>{const w=y();return w?{"X-API-KEY":w}:null},"getAuthHeader"),getApiKey:y}});class FirebaseAuthStoreError extends Error{static{p(this,"FirebaseAuthStoreError")}constructor(o){super(o),this.name="FirebaseAuthStoreError"}}const useFirebaseAuthStore=defineStore("firebaseAuth",()=>{const i=ref(!1),o=ref(null),n=ref(!1),s=ref(!1),a=ref(!1),r=ref(null),l=ref(null),u=ref(0),m=ref(null),f=p(U=>`${getComfyApiBaseUrl()}${U}`,"buildApiUrl"),_=new GoogleAuthProvider;_.addScope("email"),_.setCustomParameters({prompt:"select_account"});const y=new GithubAuthProvider;y.addScope("user:email"),y.setCustomParameters({prompt:"select_account"});const b=computed(()=>!!o.value),w=computed(()=>o.value?.email),k=computed(()=>o.value?.uid),S=useFirebaseAuth();setPersistence(S,browserLocalPersistence),onAuthStateChanged(S,U=>{o.value=U,n.value=!0,U===null&&(m.value=null),r.value=null,l.value=null}),onIdTokenChanged(S,U=>{if(U&&isCloud){if(m.value!==U.uid){m.value=U.uid;return}u.value++}});const C=p(async()=>{if(o.value)try{return await o.value.getIdToken()}catch(U){if(U instanceof FirebaseError&&U.code===AUTH_ERROR_CODES_MAP_DO_NOT_USE_INTERNALLY.NETWORK_REQUEST_FAILED){console.warn("Could not authenticate with Firebase. Features requiring authentication might not work.");return}useDialogService().showErrorDialog(U,{title:t("errorDialog.defaultTitle"),reportType:"authenticationError"}),console.error(U)}},"getIdToken"),I=p(async()=>{const U=await C();return U?{Authorization:`Bearer ${U}`}:useApiKeyAuthStore().getAuthHeader()},"getAuthHeader"),T=p(async()=>{a.value=!0;try{const U=await I();if(!U)throw new FirebaseAuthStoreError(t("toastMessages.userNotAuthenticated"));const G=await fetch(f("/customers/balance"),{headers:{...U,"Content-Type":"application/json"}});if(!G.ok){if(G.status===404)return null;const W=await G.json();throw new FirebaseAuthStoreError(t("toastMessages.failedToFetchBalance",{error:W.message}))}const H=await G.json();return l.value=new Date,r.value=H,H}finally{a.value=!1}},"fetchBalance"),E=p(async()=>{const U=await I();if(!U)throw new FirebaseAuthStoreError(t("toastMessages.userNotAuthenticated"));const G=await fetch(f("/customers"),{method:"POST",headers:{...U,"Content-Type":"application/json"}});if(!G.ok)throw new FirebaseAuthStoreError(t("toastMessages.failedToCreateCustomer",{error:G.statusText}));const H=await G.json();if(!H?.id)throw new FirebaseAuthStoreError(t("toastMessages.failedToCreateCustomer",{error:"No customer ID returned"}));return H},"createCustomer"),N=p(async(U,G={})=>{i.value=!0;try{const H=await U(S);if(G?.createCustomer){if(!await C())throw new Error("Cannot create customer: User not authenticated");await E()}return H}finally{i.value=!1}},"executeAuthAction"),L=p(async(U,G)=>await N(W=>signInWithEmailAndPassword(W,U,G),{createCustomer:!0}),"login"),A=p(async(U,G)=>await N(W=>createUserWithEmailAndPassword(W,U,G),{createCustomer:!0}),"register"),D=p(async()=>await N(G=>signInWithPopup(G,_),{createCustomer:!0}),"loginWithGoogle"),O=p(async()=>await N(G=>signInWithPopup(G,y),{createCustomer:!0}),"loginWithGithub"),M=p(async()=>N(U=>signOut(U)),"logout"),P=p(async U=>N(G=>sendPasswordResetEmail(G,U)),"sendPasswordReset"),R=p(async U=>{if(!o.value)throw new FirebaseAuthStoreError(t("toastMessages.userNotAuthenticated"));await updatePassword(o.value,U)},"_updatePassword"),V=p(async()=>{if(!o.value)throw new FirebaseAuthStoreError(t("toastMessages.userNotAuthenticated"));await deleteUser(o.value)},"_deleteAccount"),$=p(async U=>{const G=await I();if(!G)throw new FirebaseAuthStoreError(t("toastMessages.userNotAuthenticated"));s.value||(await E(),s.value=!0);const H=await fetch(f("/customers/credit"),{method:"POST",headers:{...G,"Content-Type":"application/json"},body:JSON.stringify(U)});if(!H.ok){const W=await H.json();throw new FirebaseAuthStoreError(t("toastMessages.failedToInitiateCreditPurchase",{error:W.message}))}return H.json()},"addCredits");return{loading:i,currentUser:o,isInitialized:n,balance:r,lastBalanceUpdateTime:l,isFetchingBalance:a,tokenRefreshTrigger:u,isAuthenticated:b,userEmail:w,userId:k,login:L,register:A,logout:M,createCustomer:E,getIdToken:C,loginWithGoogle:D,loginWithGithub:O,initiateCreditPurchase:p(async U=>N(G=>$(U)),"initiateCreditPurchase"),fetchBalance:T,accessBillingPortal:p(async U=>{const G=await I();if(!G)throw new FirebaseAuthStoreError(t("toastMessages.userNotAuthenticated"));const H=await fetch(f("/customers/billing"),{method:"POST",headers:{...G,"Content-Type":"application/json"},...U&&{body:JSON.stringify(U)}});if(!H.ok){const W=await H.json();throw new FirebaseAuthStoreError(t("toastMessages.failedToAccessBillingPortal",{error:W.message}))}return H.json()},"accessBillingPortal"),sendPasswordReset:P,updatePassword:R,deleteAccount:V,getAuthHeader:I}}),MAX_CANCELLATION_ATTEMPTS=4,CANCELLATION_BASE_DELAY_MS=5e3,CANCELLATION_BACKOFF_MULTIPLIER=3;function useSubscriptionCancellationWatcher({fetchStatus:i,isActiveSubscription:o,subscriptionStatus:n,telemetry:s,shouldWatchCancellation:a}){const r=ref(!1),l=ref(0),u=ref(!1),m=ref(!1),f=ref(CANCELLATION_BASE_DELAY_MS);let _=null;const{start:y,stop:b}=useTimeoutFn(()=>{S()},f,{immediate:!1}),w=p(()=>{r.value=!1,b(),l.value=0,m.value=!1,_&&(_(),_=null)},"stopCancellationWatcher"),k=p(()=>{if(r.value){if(l.value>=MAX_CANCELLATION_ATTEMPTS){w();return}f.value=CANCELLATION_BASE_DELAY_MS*CANCELLATION_BACKOFF_MULTIPLIER**l.value,l.value+=1,y()}},"scheduleNextCancellationCheck"),S=p(async(I=!1)=>{if(!(!r.value||m.value)){m.value=!0;try{if(await i(),!o.value){if(!u.value){u.value=!0;try{s?.trackMonthlySubscriptionCancelled()}catch(T){console.error("[Subscription] Failed to track cancellation telemetry:",T)}}w();return}I||k()}catch(T){console.error("[Subscription] Error checking cancellation status:",T),k()}finally{m.value=!1}}},"checkForCancellation"),C=p(()=>{!a()||!n.value?.is_active||(w(),r.value=!0,u.value=!1,l.value=0,!_&&defaultWindow&&(_=useEventListener(defaultWindow,"focus",()=>{r.value&&S(!0)})),k())},"startCancellationWatcher");return onScopeDispose(()=>{w()}),{startCancellationWatcher:C,stopCancellationWatcher:w}}p(useSubscriptionCancellationWatcher,"useSubscriptionCancellationWatcher");function useSubscriptionInternal(){const i=ref(null),o=useTelemetry(),n=computed(()=>!0),{reportError:s,accessBillingPortal:a}=useFirebaseAuthActions(),r=useDialogService(),{getAuthHeader:l}=useFirebaseAuthStore(),{wrapWithErrorHandlingAsync:u}=useErrorHandling(),{isLoggedIn:m}=useCurrentUser(),f=computed(()=>!!i.value?.end_date),_=computed(()=>i.value?.renewal_date?new Date(i.value.renewal_date).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):""),y=computed(()=>i.value?.end_date?new Date(i.value.end_date).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):""),b=computed(()=>`$${MONTHLY_SUBSCRIPTION_PRICE.toFixed(0)}`),w=p(R=>`${getComfyApiBaseUrl()}${R}`,"buildApiUrl"),k=u(M,s),S=u(async()=>{const R=await P();if(!R.checkout_url)throw new Error(t("toastMessages.failedToInitiateSubscription",{error:"No checkout URL returned"}));window.open(R.checkout_url,"_blank")},s),C=p(()=>{r.showSubscriptionRequiredDialog()},"showSubscriptionDialog"),I=p(()=>!!isCloud,"shouldWatchCancellation"),{startCancellationWatcher:T,stopCancellationWatcher:E}=useSubscriptionCancellationWatcher({fetchStatus:k,isActiveSubscription:n,subscriptionStatus:i,telemetry:o,shouldWatchCancellation:I}),N=p(async()=>{await a(),T()},"manageSubscription"),L=p(async()=>{await M(),n.value||C()},"requireActiveSubscription"),A=p(()=>{window.open(`${getComfyPlatformBaseUrl()}/profile/usage`,"_blank")},"handleViewUsageHistory"),D=p(()=>{window.open("https://docs.comfy.org","_blank")},"handleLearnMore"),O=p(async()=>{await a()},"handleInvoiceHistory");async function M(){const R=await l();if(!R)throw new FirebaseAuthStoreError(t("toastMessages.userNotAuthenticated"));const V=await fetch(w("/customers/cloud-subscription-status"),{headers:{...R,"Content-Type":"application/json"}});if(!V.ok){const F=await V.json();throw new FirebaseAuthStoreError(t("toastMessages.failedToFetchSubscription",{error:F.message}))}const $=await V.json();return i.value=$,$}p(M,"fetchSubscriptionStatus"),watch(()=>m.value,async R=>{R?await M():(i.value=null,E())},{immediate:!0});const P=p(async()=>{const R=await l();if(!R)throw new FirebaseAuthStoreError(t("toastMessages.userNotAuthenticated"));const V=await fetch(w("/customers/cloud-subscription-checkout"),{method:"POST",headers:{...R,"Content-Type":"application/json"}});if(!V.ok){const $=await V.json();throw new FirebaseAuthStoreError(t("toastMessages.failedToInitiateSubscription",{error:$.message}))}return V.json()},"initiateSubscriptionCheckout");return{isActiveSubscription:n,isCancelled:f,formattedRenewalDate:_,formattedEndDate:y,formattedMonthlyPrice:b,subscribe:S,fetchStatus:k,showSubscriptionDialog:C,manageSubscription:N,requireActiveSubscription:L,handleViewUsageHistory:A,handleLearnMore:D,handleInvoiceHistory:O}}p(useSubscriptionInternal,"useSubscriptionInternal");const useSubscription=createSharedComposable(useSubscriptionInternal),useFirebaseAuthActions=p(()=>{const i=useFirebaseAuthStore(),o=useToastStore(),{wrapWithErrorHandlingAsync:n,toastErrorHandler:s}=useErrorHandling(),a=ref(!1),r=p(T=>{T instanceof FirebaseError&&["auth/unauthorized-domain","auth/invalid-dynamic-link-domain","auth/unauthorized-continue-uri"].includes(T.code)?(a.value=!0,o.add({severity:"error",summary:t("g.error"),detail:t("toastMessages.unauthorizedDomain",{domain:window.location.hostname,email:"support@comfy.org"})})):s(T)},"reportError"),l=n(async()=>{await i.logout(),o.add({severity:"success",summary:t("auth.signOut.success"),detail:t("auth.signOut.successDetail"),life:5e3})},r),u=n(async T=>{await i.sendPasswordReset(T),o.add({severity:"success",summary:t("auth.login.passwordResetSent"),detail:t("auth.login.passwordResetSentDetail"),life:5e3})},r),m=n(async T=>{const{isActiveSubscription:E}=useSubscription();if(!E.value)return;const N=await i.initiateCreditPurchase({amount_micros:usdToMicros(T),currency:"usd"});if(!N.checkout_url)throw new Error(t("toastMessages.failedToPurchaseCredits",{error:"No checkout URL returned"}));window.open(N.checkout_url,"_blank")},r),f=n(async()=>{const T=await i.accessBillingPortal();if(!T.billing_portal_url)throw new Error(t("toastMessages.failedToAccessBillingPortal",{error:"No billing portal URL returned"}));window.open(T.billing_portal_url,"_blank")},r),_=n(async()=>await i.fetchBalance(),r),y=n(async()=>await i.loginWithGoogle(),r),b=n(async()=>await i.loginWithGithub(),r),w=n(async(T,E)=>await i.login(T,E),r),k=n(async(T,E)=>await i.register(T,E),r),S=p(()=>{const T=useDialogService();return{shouldHandle:p(E=>E instanceof FirebaseError&&E.code===AUTH_ERROR_CODES_MAP_DO_NOT_USE_INTERNALLY.CREDENTIAL_TOO_OLD_LOGIN_AGAIN,"shouldHandle"),recover:p(async(E,N,L)=>{if(!await T.confirm({title:t("auth.reauthRequired.title"),message:t("auth.reauthRequired.message"),type:"default"}))return;await i.logout(),await T.showSignInDialog()&&await N(...L)},"recover")}},"createReauthenticationRecovery"),C=n(async T=>{await i.updatePassword(T),o.add({severity:"success",summary:t("auth.passwordUpdate.success"),detail:t("auth.passwordUpdate.successDetail"),life:5e3})},r,void 0,[S()]),I=n(async()=>{await i.deleteAccount(),o.add({severity:"success",summary:t("auth.deleteAccount.success"),detail:t("auth.deleteAccount.successDetail"),life:5e3})},r,void 0,[S()]);return{logout:l,sendPasswordReset:u,purchaseCredits:m,accessBillingPortal:f,fetchBalance:_,signInWithGoogle:y,signInWithGithub:b,signInWithEmail:w,signUpWithEmail:k,updatePassword:C,deleteAccount:I,accessError:a,reportError:r}},"useFirebaseAuthActions"),RESERVED_BY_TEXT_INPUT=new Set(["Ctrl + a","Ctrl + c","Ctrl + v","Ctrl + x","Ctrl + z","Ctrl + y","Ctrl + p","Enter","Shift + Enter","Ctrl + Backspace","Ctrl + Delete","Home","Ctrl + Home","Ctrl + Shift + Home","End","Ctrl + End","Ctrl + Shift + End","PageUp","PageDown","Shift + PageUp","Shift + PageDown","ArrowLeft","Ctrl + ArrowLeft","Shift + ArrowLeft","Ctrl + Shift + ArrowLeft","ArrowRight","Ctrl + ArrowRight","Shift + ArrowRight","Ctrl + Shift + ArrowRight","ArrowUp","Shift + ArrowUp","ArrowDown","Shift + ArrowDown"]);class KeybindingImpl{static{p(this,"KeybindingImpl")}commandId;combo;targetElementId;constructor(o){this.commandId=o.commandId,this.combo=new KeyComboImpl(o.combo),this.targetElementId=o.targetElementId}equals(o){const n=toRaw(o);return n instanceof KeybindingImpl?this.commandId===n.commandId&&this.combo.equals(n.combo)&&this.targetElementId===n.targetElementId:!1}}class KeyComboImpl{static{p(this,"KeyComboImpl")}key;ctrl;alt;shift;constructor(o){this.key=o.key,this.ctrl=o.ctrl??!1,this.alt=o.alt??!1,this.shift=o.shift??!1}static fromEvent(o){return new KeyComboImpl({key:o.key,ctrl:o.ctrlKey||o.metaKey,alt:o.altKey,shift:o.shiftKey})}equals(o){const n=toRaw(o);return n instanceof KeyComboImpl?this.key.toUpperCase()===n.key.toUpperCase()&&this.ctrl===n.ctrl&&this.alt===n.alt&&this.shift===n.shift:!1}serialize(){return`${this.key.toUpperCase()}:${this.ctrl}:${this.alt}:${this.shift}`}toString(){return this.getKeySequences().join(" + ")}get hasModifier(){return this.ctrl||this.alt||this.shift}get isModifier(){return["Control","Meta","Alt","Shift"].includes(this.key)}get modifierCount(){return[this.ctrl,this.alt,this.shift].reduce((n,s)=>n+Number(s),0)}get isShiftOnly(){return this.shift&&this.modifierCount===1}get isReservedByTextInput(){return!this.hasModifier||this.isShiftOnly||RESERVED_BY_TEXT_INPUT.has(this.toString())}getKeySequences(){const o=[];return this.ctrl&&o.push("Ctrl"),this.alt&&o.push("Alt"),this.shift&&o.push("Shift"),o.push(this.key),o}}const useKeybindingStore=defineStore("keybinding",()=>{const i=ref({}),o=ref({}),n=ref({});function s(){return o.value}p(s,"getUserKeybindings");function a(){return n.value}p(a,"getUserUnsetKeybindings");const r=computed(()=>{const N={...i.value};for(const L of Object.values(n.value)){const A=L.combo.serialize();N[A]?.equals(L)&&delete N[A]}return{...N,...o.value}}),l=computed(()=>Object.values(r.value));function u(N){return r.value[N.serialize()]}p(u,"getKeybinding");const m=computed(()=>toolkit.groupBy(l.value,"commandId"));function f(N){return m.value[N]??[]}p(f,"getKeybindingsByCommandId");const _=computed(()=>toolkit.groupBy(Object.values(i.value),"commandId"));function y(N){return f(N)[0]}p(y,"getKeybindingByCommandId");function b(N,L,{existOk:A=!1}){if(!A&&L.combo.serialize()in N.value)throw new Error(`Keybinding on ${L.combo} already exists on ${N.value[L.combo.serialize()].commandId}`);N.value[L.combo.serialize()]=L}p(b,"addKeybinding");function w(N){b(i,N,{existOk:!1})}p(w,"addDefaultKeybinding");function k(N){const L=i.value[N.combo.serialize()],A=n.value[N.combo.serialize()];if(N.equals(L)&&N.equals(A)){delete n.value[N.combo.serialize()];return}L&&!L.equals(A)&&S(L),b(o,N,{existOk:!0})}p(k,"addUserKeybinding");function S(N){const L=N.combo.serialize();if(!(L in r.value)){console.warn(`Trying to unset non-exist keybinding: ${JSON.stringify(N)}`);return}if(o.value[L]?.equals(N)){delete o.value[L];return}if(i.value[L]?.equals(N)){b(n,N,{existOk:!1});return}console.warn(`Unset unknown keybinding: ${JSON.stringify(N)}`)}p(S,"unsetKeybinding");function C(N){const L=y(N.commandId);return L?.equals(N)?!1:(L&&S(L),k(N),!0)}p(C,"updateKeybindingOnCommand");function I(){o.value={},n.value={}}p(I,"resetAllKeybindings");function T(N){const L=y(N),A=_.value[N]?.[0];if(!A)return L?(S(L),!0):!1;if(L?.equals(A))return!1;L&&S(L);const D=A.combo.serialize();return n.value[D]?.equals(A)&&delete n.value[D],!0}p(T,"resetKeybindingForCommand");function E(N){const L=y(N),A=_.value[N]?.[0];return!(L===void 0&&A===void 0||L?.equals(A))}return p(E,"isCommandKeybindingModified"),{keybindings:l,getUserKeybindings:s,getUserUnsetKeybindings:a,getKeybinding:u,getKeybindingsByCommandId:f,getKeybindingByCommandId:y,addDefaultKeybinding:w,addUserKeybinding:k,unsetKeybinding:S,updateKeybindingOnCommand:C,resetAllKeybindings:I,resetKeybindingForCommand:T,isCommandKeybindingModified:E}});class ComfyCommandImpl{static{p(this,"ComfyCommandImpl")}id;function;_label;_icon;_tooltip;_menubarLabel;versionAdded;confirmation;source;active;category;constructor(o){this.id=o.id,this.function=o.function,this._label=o.label,this._icon=o.icon,this._tooltip=o.tooltip,this._menubarLabel=o.menubarLabel??o.label,this.versionAdded=o.versionAdded,this.confirmation=o.confirmation,this.source=o.source,this.active=o.active,this.category=o.category}get label(){return typeof this._label=="function"?this._label():this._label}get icon(){return typeof this._icon=="function"?this._icon():this._icon}get tooltip(){return typeof this._tooltip=="function"?this._tooltip():this._tooltip}get menubarLabel(){return typeof this._menubarLabel=="function"?this._menubarLabel():this._menubarLabel}get keybinding(){return useKeybindingStore().getKeybindingByCommandId(this.id)}}const useCommandStore=defineStore("command",()=>{const i=ref({}),o=computed(()=>Object.values(i.value)),n=p(_=>{i.value[_.id]&&console.warn(`Command ${_.id} already registered`),i.value[_.id]=new ComfyCommandImpl(_)},"registerCommand"),s=p(_=>{for(const y of _)n(y)},"registerCommands"),a=p(_=>i.value[_],"getCommand"),{wrapWithErrorHandlingAsync:r}=useErrorHandling();return{commands:o,execute:p(async(_,y)=>{const b=a(_);if(b)await r(()=>b.function(y?.metadata),y?.errorHandler)();else throw new Error(`Command ${_} not found`)},"execute"),getCommand:a,registerCommand:n,registerCommands:s,isRegistered:p(_=>!!i.value[_],"isRegistered"),loadExtensionCommands:p(_=>{if(_.commands)for(const y of _.commands)n({...y,source:_.name})},"loadExtensionCommands"),formatKeySequence:p(_=>(_.keybinding?.combo.getKeySequences()||[]).map(b=>b.replace(/Control/g,"Ctrl").replace(/Shift/g,"Shift")).join(" + "),"formatKeySequence")}}),useCurrentUser=p(()=>{const i=useFirebaseAuthStore(),o=useCommandStore(),n=useApiKeyAuthStore(),s=useDialogService(),{deleteAccount:a}=useFirebaseAuthActions(),r=computed(()=>i.currentUser),l=computed(()=>n.isAuthenticated),u=computed(()=>!!l.value||r.value!==null),m=computed(()=>l.value&&n.currentUser?{id:n.currentUser.id}:r.value?{id:r.value.uid}:null),f=p(L=>whenever(m,L,{immediate:!0}),"onUserResolved"),_=p(L=>whenever(()=>i.tokenRefreshTrigger,L),"onTokenRefreshed"),y=p(L=>{watch(m,A=>{A||L()})},"onUserLogout"),b=computed(()=>l.value?n.currentUser?.name:r.value?.displayName),w=computed(()=>l.value?n.currentUser?.email:r.value?.email),k=computed(()=>{if(l.value)return"Comfy API Key";const L=r.value?.providerData[0]?.providerId;return L?.includes("google")?"Google":L?.includes("github")?"GitHub":L}),S=computed(()=>{if(l.value)return"pi pi-key";const L=r.value?.providerData[0]?.providerId;return L?.includes("google")?"pi pi-google":L?.includes("github")?"pi pi-github":"pi pi-user"}),C=computed(()=>l.value?!1:r.value?.providerData[0]?.providerId==="password"),I=computed(()=>l.value?null:r.value?.photoURL),T=p(async()=>{l.value?await n.clearStoredApiKey():await o.execute("Comfy.User.SignOut")},"handleSignOut"),E=p(async()=>{await o.execute("Comfy.User.OpenSignInDialog")},"handleSignIn"),N=p(async()=>{await s.confirm({title:t("auth.deleteAccount.confirmTitle"),message:t("auth.deleteAccount.confirmMessage"),type:"delete"})&&await a()},"handleDeleteAccount");return{loading:i.loading,isLoggedIn:u,isApiKeyLogin:l,isEmailProvider:C,userDisplayName:b,userEmail:w,userPhotoUrl:I,providerName:k,providerIcon:S,resolvedUserInfo:m,handleSignOut:T,handleSignIn:E,handleDeleteAccount:N,onUserResolved:f,onTokenRefreshed:_,onUserLogout:y}},"useCurrentUser"),zComboOption=z.union([z.string(),z.number()]),zRemoteWidgetConfig=z.object({route:z.string().url().or(z.string().startsWith("/")),refresh:z.number().gte(128).safe().or(z.number().lte(0).safe()).optional(),response_key:z.string().optional(),query_params:z.record(z.string(),z.string()).optional(),refresh_button:z.boolean().optional(),control_after_refresh:z.enum(["first","last"]).optional(),timeout:z.number().gte(0).optional(),max_retries:z.number().gte(0).optional()}),zWidgetTemplate=z.object({template_id:z.string(),allowed_types:z.string().optional()}),zMultiSelectOption=z.object({placeholder:z.string().optional(),chip:z.boolean().optional()}),zBaseInputOptions=z.object({default:z.any().optional(),defaultInput:z.boolean().optional(),display_name:z.string().optional(),forceInput:z.boolean().optional(),tooltip:z.string().optional(),socketless:z.boolean().optional(),hidden:z.boolean().optional(),advanced:z.boolean().optional(),widgetType:z.string().optional(),template:zWidgetTemplate.optional(),rawLink:z.boolean().optional(),lazy:z.boolean().optional()}).passthrough(),zNumericInputOptions=zBaseInputOptions.extend({min:z.number().optional(),max:z.number().optional(),step:z.number().optional(),default:z.union([z.number(),z.array(z.number())]).optional(),display:z.enum(["slider","number","knob"]).optional()}),zIntInputOptions=zNumericInputOptions.extend({control_after_generate:z.boolean().optional()}),zFloatInputOptions=zNumericInputOptions.extend({round:z.union([z.number(),z.literal(!1)]).optional()}),zBooleanInputOptions=zBaseInputOptions.extend({label_on:z.string().optional(),label_off:z.string().optional(),default:z.boolean().optional()}),zStringInputOptions=zBaseInputOptions.extend({default:z.string().optional(),multiline:z.boolean().optional(),dynamicPrompts:z.boolean().optional(),defaultVal:z.string().optional(),placeholder:z.string().optional()}),zComboInputOptions=zBaseInputOptions.extend({control_after_generate:z.boolean().optional(),image_upload:z.boolean().optional(),image_folder:resultItemType.optional(),allow_batch:z.boolean().optional(),video_upload:z.boolean().optional(),audio_upload:z.boolean().optional(),animated_image_upload:z.boolean().optional(),options:z.array(zComboOption).optional(),remote:zRemoteWidgetConfig.optional(),multi_select:zMultiSelectOption.optional()}),zIntInputSpec$1=z.tuple([z.literal("INT"),zIntInputOptions.optional()]),zFloatInputSpec$1=z.tuple([z.literal("FLOAT"),zFloatInputOptions.optional()]),zBooleanInputSpec$1=z.tuple([z.literal("BOOLEAN"),zBooleanInputOptions.optional()]),zStringInputSpec$1=z.tuple([z.literal("STRING"),zStringInputOptions.optional()]),zComboInputSpec$1=z.tuple([z.array(zComboOption),zComboInputOptions.optional()]),zComboInputSpecV2=z.tuple([z.literal("COMBO"),zComboInputOptions.optional()]);function isComboInputSpecV1(i){return Array.isArray(i[0])}p(isComboInputSpecV1,"isComboInputSpecV1");function isIntInputSpec$1(i){return i[0]==="INT"}p(isIntInputSpec$1,"isIntInputSpec$1");function isFloatInputSpec$1(i){return i[0]==="FLOAT"}p(isFloatInputSpec$1,"isFloatInputSpec$1");function isComboInputSpecV2(i){return i[0]==="COMBO"}p(isComboInputSpecV2,"isComboInputSpecV2");function isComboInputSpec$1(i){return isComboInputSpecV1(i)||isComboInputSpecV2(i)}p(isComboInputSpec$1,"isComboInputSpec$1");function getInputSpecType(i){return isComboInputSpec$1(i)?"COMBO":i[0]}p(getInputSpecType,"getInputSpecType");function getComboSpecComboOptions(i){return(isComboInputSpecV2(i)?i[1]?.options:i[0])??[]}p(getComboSpecComboOptions,"getComboSpecComboOptions");const excludedLiterals=new Set(["INT","FLOAT","BOOLEAN","STRING","COMBO"]),zCustomInputSpec$1=z.tuple([z.string().refine(i=>!excludedLiterals.has(i)),zBaseInputOptions.optional()]),zInputSpec$1=z.union([zIntInputSpec$1,zFloatInputSpec$1,zBooleanInputSpec$1,zStringInputSpec$1,zComboInputSpec$1,zComboInputSpecV2,zCustomInputSpec$1]),zComfyInputsSpec=z.object({required:z.record(zInputSpec$1).optional(),optional:z.record(zInputSpec$1).optional(),hidden:z.record(z.any()).optional()}),zComfyNodeDataType=z.string(),zComfyComboOutput=z.array(zComboOption),zComfyOutputTypesSpec=z.array(z.union([zComfyNodeDataType,zComfyComboOutput]));z.object({input:zComfyInputsSpec.optional(),output:zComfyOutputTypesSpec.optional(),output_is_list:z.array(z.boolean()).optional(),output_name:z.array(z.string()).optional(),output_tooltips:z.array(z.string()).optional(),output_matchtypes:z.array(z.string().optional()).optional(),name:z.string(),display_name:z.string(),description:z.string(),help:z.string().optional(),category:z.string(),output_node:z.boolean(),python_module:z.string(),deprecated:z.boolean().optional(),experimental:z.boolean().optional(),api_node:z.boolean().optional(),input_order:z.record(z.array(z.string())).optional()});const zDynamicComboInputSpec=z.tuple([z.literal("COMFY_DYNAMICCOMBO_V3"),zComboInputOptions.extend({options:z.array(z.object({inputs:zComfyInputsSpec,key:z.string()}))})]);function transformNodeDefV1ToV2(i){const o={};i.input?.required&&Object.entries(i.input.required).forEach(([s,a])=>{o[s]=transformInputSpecV1ToV2(a,{name:s,isOptional:!1})}),i.input?.optional&&Object.entries(i.input.optional).forEach(([s,a])=>{o[s]=transformInputSpecV1ToV2(a,{name:s,isOptional:!0})});const n=[];return i.output&&(Array.isArray(i.output)?i.output.forEach((s,a)=>{const r={index:a,name:i.output_name?.[a]||`output_${a}`,type:Array.isArray(s)?"COMBO":s,is_list:i.output_is_list?.[a]||!1,tooltip:i.output_tooltips?.[a]};Array.isArray(s)&&(r.options=s),n.push(r)}):console.warn("nodeDefV1.output is not an array:",i.output)),{inputs:o,outputs:n,hidden:i.input?.hidden,name:i.name,display_name:i.display_name,description:i.description,category:i.category,output_node:i.output_node,python_module:i.python_module,deprecated:i.deprecated,experimental:i.experimental}}p(transformNodeDefV1ToV2,"transformNodeDefV1ToV2");function transformInputSpecV1ToV2(i,o){const{name:n,isOptional:s=!1}=o,a=i[1]||{},r={name:n,isOptional:s,...a};return isComboInputSpec$1(i)?{type:"COMBO",...r,options:isComboInputSpecV1(i)?i[0]:getComboSpecComboOptions(i)}:typeof i[0]=="string"?{type:i[0],...r}:{type:"UNKNOWN",...r}}p(transformInputSpecV1ToV2,"transformInputSpecV1ToV2");function transformInputSpecV2ToV1(i){return[i.type,i]}p(transformInputSpecV2ToV1,"transformInputSpecV2ToV1");class FuseFilter{static{p(this,"FuseFilter")}fuseSearch;id;name;invokeSequence;getItemOptions;constructor(o,n){this.id=n.id,this.name=n.name,this.invokeSequence=n.invokeSequence,this.getItemOptions=n.getItemOptions,this.fuseSearch=new FuseSearch(this.getAllNodeOptions(o),{fuseOptions:n.fuseOptions})}getAllNodeOptions(o){const n=new Set;for(const s of o)for(const a of this.getItemOptions(s))n.add(a);return Array.from(n)}matches(o,n,s={}){const{wildcard:a}=s;if(a&&n===a)return!0;const r=this.getItemOptions(o);return a?r.some(l=>l===a):r.includes(n)}}function isFuseSearchable(i){return"postProcessSearchScores"in i}p(isFuseSearchable,"isFuseSearchable");class FuseSearch{static{p(this,"FuseSearch")}fuse;keys;data;advancedScoring;constructor(o,n){const{fuseOptions:s,createIndex:a=!0,advancedScoring:r=!1}=n;this.data=o,this.keys=s?.keys??[],this.advancedScoring=r;const l=a&&this.keys.length?Fuse.createIndex(this.keys,o):void 0;this.fuse=new Fuse(o,s,l)}search(o,n){const s=o?this.fuse.search(o,n):this.data.map(r=>({item:r,score:0}));return this.advancedScoring?s.map(r=>({item:r.item,scores:this.calcAuxScores(o.toLocaleLowerCase(),r.item,r.score??0)})).sort((r,l)=>this.compareAux(r.scores,l.scores)).map(r=>r.item):s.map(r=>r.item)}calcAuxScores(o,n,s){let a=[];typeof n=="string"?a=[n]:typeof n=="object"&&n!==null&&(a=this.keys.map(m=>n[m]).filter(m=>typeof m=="string"));let l=a.map(m=>this.calcAuxSingle(o,m,s)).sort(this.compareAux)[0];const u=a.some(m=>m.toLocaleLowerCase().includes("deprecated"));return l[0]+=u&&l[0]!==0?5:0,isFuseSearchable(n)&&(l=n.postProcessSearchScores(l)),l}calcAuxSingle(o,n,s){const a=n.split(/ |\b|(?<=[a-z])(?=[A-Z])|(?=[A-Z][a-z])/).map(_=>_.toLocaleLowerCase()),r=o.split(" ");n=n.toLocaleLowerCase();let l=9,u=0,m=0;if(n==o)l=0;else if(n.startsWith(o))l=1,m=n.length;else if(a.includes(o))l=2,u=n.indexOf(o)+n.length*.5,m=n.length;else if(n.includes(o))l=3,u=n.indexOf(o)+n.length*.5,m=n.length;else if(r.every(_=>a.includes(_))){const _=r.map(w=>a.indexOf(w)),y=Math.min(..._),b=Math.max(..._);l=4,u=b-y+b*.5+n.length*.5,m=n.length}else if(r.every(_=>n.includes(_))){const _=Math.min(...r.map(b=>n.indexOf(b))),y=Math.max(...r.map(b=>n.indexOf(b)+b.length));l=5,u=y-_+y*.5+n.length*.5,m=n.length}const f=.2*(1-Math.min(n.length,o.length)/Math.max(n.length,o.length));return[l,u,m,s+f]}compareAux(o,n){for(let s=0;s<Math.min(o.length,n.length);s++)if(o[s]!==n[s])return o[s]-n[s];return o.length-n.length}}class NodeSearchService{static{p(this,"NodeSearchService")}nodeFuseSearch;inputTypeFilter;outputTypeFilter;nodeCategoryFilter;nodeSourceFilter;constructor(o){this.nodeFuseSearch=new FuseSearch(o,{fuseOptions:{keys:["name","display_name"],includeScore:!0,threshold:.3,shouldSort:!1,useExtendedSearch:!0},createIndex:!0,advancedScoring:!0});const n={includeScore:!0,threshold:.3,shouldSort:!0};this.inputTypeFilter=new FuseFilter(o,{id:"input",name:"Input Type",invokeSequence:"i",getItemOptions:p(s=>Object.values(s.inputs??[]).map(a=>a.type),"getItemOptions"),fuseOptions:n}),this.outputTypeFilter=new FuseFilter(o,{id:"output",name:"Output Type",invokeSequence:"o",getItemOptions:p(s=>s.outputs.map(a=>a.type),"getItemOptions"),fuseOptions:n}),this.nodeCategoryFilter=new FuseFilter(o,{id:"category",name:"Category",invokeSequence:"c",getItemOptions:p(s=>[s.category],"getItemOptions"),fuseOptions:n}),this.nodeSourceFilter=new FuseFilter(o,{id:"source",name:"Source",invokeSequence:"s",getItemOptions:p(s=>[s.nodeSource.displayText],"getItemOptions"),fuseOptions:n})}searchNode(o,n=[],s,a={}){const{matchWildcards:r=!0}=a,l=r?"*":void 0,u=this.nodeFuseSearch.search(o),m=u.filter(f=>n.every(_=>{const{filterDef:y,value:b}=_;return y.matches(f,b)}));if(r){const f=new Set(m.map(_=>_.name));m.push(...u.filter(_=>!f.has(_.name)).filter(_=>n.every(y=>{const{filterDef:b,value:w}=y;return b.matches(_,w,{wildcard:l})})))}return s?.limit?m.slice(0,s.limit):m}get nodeFilters(){return[this.inputTypeFilter,this.outputTypeFilter,this.nodeCategoryFilter,this.nodeSourceFilter]}}function calculateNodeBounds(i){if(!i||i.length===0)return null;let o=1/0,n=1/0,s=-1/0,a=-1/0;for(const r of i){const l=r.pos[0],u=r.pos[1],m=r.size[0],f=r.size[1];o=Math.min(o,l),n=Math.min(n,u),s=Math.max(s,l+m),a=Math.max(a,u+f)}return{minX:o,minY:n,maxX:s,maxY:a,width:s-o,height:a-n}}p(calculateNodeBounds,"calculateNodeBounds");function enforceMinimumBounds(i,o=2500,n=2e3){let{minX:s,minY:a,maxX:r,maxY:l,width:u,height:m}=i;if(u<o){const f=(o-u)/2;s-=f,r+=f,u=o}if(m<n){const f=(n-m)/2;a-=f,l+=f,m=n}return{minX:s,minY:a,maxX:r,maxY:l,width:u,height:m}}p(enforceMinimumBounds,"enforceMinimumBounds");function calculateMinimapScale(i,o,n,s=.9){if(i.width===0||i.height===0)return 1;const a=o/i.width,r=n/i.height;return Math.min(a,r)*s}p(calculateMinimapScale,"calculateMinimapScale");const id$5="arc",name$5="Arc",colors$5={node_slot:{BOOLEAN:"",CLIP:"#eacb8b",CLIP_VISION:"#A8DADC",CLIP_VISION_OUTPUT:"#ad7452",CONDITIONING:"#cf876f",CONTROL_NET:"#00d78d",CONTROL_NET_WEIGHTS:"",FLOAT:"",GLIGEN:"",IMAGE:"#80a1c0",IMAGEUPLOAD:"",INT:"",LATENT:"#b38ead",LATENT_KEYFRAME:"",MASK:"#a3bd8d",MODEL:"#8978a7",SAMPLER:"",SIGMAS:"",STRING:"",STYLE_MODEL:"#C2FFAE",T2I_ADAPTER_WEIGHTS:"",TAESD:"#DCC274",TIMESTEP_KEYFRAME:"",UPSCALE_MODEL:"",VAE:"#be616b"},litegraph_base:{BACKGROUND_IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcklEQVR4nO3YMUoDARgF4RfxBqZI6/0vZqFn0MYtrLIQMFN8U6V4LAtD+Jm9XG/v30OGl2e/AP7yevz4+vx45nvgF/+QGITEICQGITEIiUFIjNNC3q43u3/YnRJyPOzeQ+0e220nhRzReC8e7R7bbdvl+Jal1Bs46jEIiUFIDEJiEBKDkBhKPbZT6qHdptRTu02p53DUYxASg5AYhMQgJAYhMZR6bKfUQ7tNqad2m1LP4ajHICQGITEIiUFIDEJiKPXYTqmHdptST+02pZ7DUY9BSAxCYhASg5AYhMRQ6rGdUg/tNqWe2m1KPYejHoOQGITEICQGITEIiaHUYzulHtptSj2125R6Dkc9BiExCIlBSAxCYhASQ6nHdko9tNuUemq3KfUcjnoMQmIQEoOQGITEICSGUo/tlHpotyn11G5T6jkc9RiExCAkBiExCIlBSAylHtsp9dBuU+qp3abUczjqMQiJQUgMQmIQEoOQGITE+AHFISNQrFTGuwAAAABJRU5ErkJggg==",CLEAR_BACKGROUND_COLOR:"#2b2f38",NODE_TITLE_COLOR:"#b2b7bd",NODE_SELECTED_TITLE_COLOR:"#FFF",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#2b2f38",NODE_DEFAULT_BGCOLOR:"#242730",NODE_DEFAULT_BOXCOLOR:"#6e7581",NODE_DEFAULT_SHAPE:2,NODE_BOX_OUTLINE_COLOR:"#FFF",NODE_BYPASS_BGCOLOR:"#FF00FF",NODE_ERROR_COLOUR:"#E00",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:22,WIDGET_BGCOLOR:"#2b2f38",WIDGET_OUTLINE_COLOR:"#6e7581",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#b2b7bd",WIDGET_DISABLED_TEXT_COLOR:"#5c626d",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA"},comfy_base:{"fg-color":"#fff","bg-color":"#2b2f38","comfy-menu-bg":"#242730","comfy-menu-secondary-bg":"#22252E","comfy-input-bg":"#2b2f38","input-text":"#ddd","descrip-text":"#b2b7bd","drag-text":"#ccc","error-text":"#ff4444","border-color":"#6e7581","tr-even-bg-color":"#2b2f38","tr-odd-bg-color":"#242730","content-bg":"#6e7581","content-fg":"#fff","content-hover-bg":"#2b2f38","content-hover-fg":"#fff","bar-shadow":"rgba(8, 8, 8, 0.75) 0 0 0.5rem"}},arc={id:id$5,name:name$5,colors:colors$5},id$4="dark",name$4="Dark (Default)",colors$4={node_slot:{CLIP:"#FFD500",CLIP_VISION:"#A8DADC",CLIP_VISION_OUTPUT:"#ad7452",CONDITIONING:"#FFA931",CONTROL_NET:"#6EE7B7",IMAGE:"#64B5F6",LATENT:"#FF9CF9",MASK:"#81C784",MODEL:"#B39DDB",STYLE_MODEL:"#C2FFAE",VAE:"#FF6E6E",NOISE:"#B0B0B0",GUIDER:"#66FFFF",SAMPLER:"#ECB4B4",SIGMAS:"#CDFFCD",TAESD:"#DCC274"},litegraph_base:{BACKGROUND_IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",CLEAR_BACKGROUND_COLOR:"#141414",NODE_TITLE_COLOR:"#999",NODE_SELECTED_TITLE_COLOR:"#FFF",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#AAA",NODE_TEXT_HIGHLIGHT_COLOR:"#FFF",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:2,NODE_BOX_OUTLINE_COLOR:"#FFF",NODE_BYPASS_BGCOLOR:"#FF00FF",NODE_ERROR_COLOUR:"#E00",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",WIDGET_DISABLED_TEXT_COLOR:"#666",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",BADGE_FG_COLOR:"#FFF",BADGE_BG_COLOR:"#0F1F0F"},comfy_base:{"fg-color":"#fff","bg-color":"#202020","comfy-menu-bg":"#171718","comfy-menu-secondary-bg":"#303030","comfy-input-bg":"#222","input-text":"#ddd","descrip-text":"#999","drag-text":"#ccc","error-text":"#ff4444","border-color":"#4e4e4e","tr-even-bg-color":"#222","tr-odd-bg-color":"#353535","content-bg":"#4e4e4e","content-fg":"#fff","content-hover-bg":"#222","content-hover-fg":"#fff","bar-shadow":"rgba(16, 16, 16, 0.5) 0 0 0.5rem"}},dark={id:id$4,name:name$4,colors:colors$4},id$3="github",name$3="Github",colors$3={node_slot:{BOOLEAN:"",CLIP:"#eacb8b",CLIP_VISION:"#A8DADC",CLIP_VISION_OUTPUT:"#ad7452",CONDITIONING:"#cf876f",CONTROL_NET:"#00d78d",CONTROL_NET_WEIGHTS:"",FLOAT:"",GLIGEN:"",IMAGE:"#80a1c0",IMAGEUPLOAD:"",INT:"",LATENT:"#b38ead",LATENT_KEYFRAME:"",MASK:"#a3bd8d",MODEL:"#8978a7",SAMPLER:"",SIGMAS:"",STRING:"",STYLE_MODEL:"#C2FFAE",T2I_ADAPTER_WEIGHTS:"",TAESD:"#DCC274",TIMESTEP_KEYFRAME:"",UPSCALE_MODEL:"",VAE:"#be616b"},litegraph_base:{BACKGROUND_IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGlmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDEgNzkuMTQ2Mjg5OSwgMjAyMy8wNi8yNS0yMDowMTo1NSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI1LjEgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0xMS0xM1QwMDoxODowMiswMTowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMTEtMTVUMDI6MDQ6NTkrMDE6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMTEtMTVUMDI6MDQ6NTkrMDE6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmIyYzRhNjA5LWJmYTctYTg0MC1iOGFlLTk3MzE2ZjM1ZGIyNyIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjk0ZmNlZGU4LTE1MTctZmQ0MC04ZGU3LWYzOTgxM2E3ODk5ZiIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjIzMWIxMGIwLWI0ZmItMDI0ZS1iMTJlLTMwNTMwM2NkMDdjOCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MjMxYjEwYjAtYjRmYi0wMjRlLWIxMmUtMzA1MzAzY2QwN2M4IiBzdEV2dDp3aGVuPSIyMDIzLTExLTEzVDAwOjE4OjAyKzAxOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjUuMSAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjQ4OWY1NzlmLTJkNjUtZWQ0Zi04OTg0LTA4NGE2MGE1ZTMzNSIgc3RFdnQ6d2hlbj0iMjAyMy0xMS0xNVQwMjowNDo1OSswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI1LjEgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiMmM0YTYwOS1iZmE3LWE4NDAtYjhhZS05NzMxNmYzNWRiMjciIHN0RXZ0OndoZW49IjIwMjMtMTEtMTVUMDI6MDQ6NTkrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyNS4xIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4OTe6GAAAAx0lEQVR42u3WMQoAIQxFwRzJys77X8vSLiRgITif7bYbgrwYc/mKXyBoY4VVBgsWLFiwYFmOlTv+9jfDOjHmr8u6eVkGCxYsWLBgmc5S8ApewXvgYRksWLBgKXidpeBdloL3wMOCBctgwVLwCl7BuyyDBQsWLFiwTGcpeAWv4D3wsAwWLFiwFLzOUvAuS8F74GHBgmWwYCl4Ba/gXZbBggULFixYprMUvIJX8B54WAYLFixYCl5nKXiXpeA98LBgwTJYsGC9tg1o8f4TTtqzNQAAAABJRU5ErkJggg==",CLEAR_BACKGROUND_COLOR:"#040506",NODE_TITLE_COLOR:"#999",NODE_SELECTED_TITLE_COLOR:"#e5eaf0",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#bcc2c8",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#161b22",NODE_DEFAULT_BGCOLOR:"#13171d",NODE_DEFAULT_BOXCOLOR:"#30363d",NODE_DEFAULT_SHAPE:2,NODE_BOX_OUTLINE_COLOR:"#e5eaf0",NODE_BYPASS_BGCOLOR:"#FF00FF",NODE_ERROR_COLOUR:"#E00",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#161b22",WIDGET_OUTLINE_COLOR:"#30363d",WIDGET_TEXT_COLOR:"#bcc2c8",WIDGET_SECONDARY_TEXT_COLOR:"#999",WIDGET_DISABLED_TEXT_COLOR:"#30363d",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA"},comfy_base:{"fg-color":"#e5eaf0","bg-color":"#161b22","comfy-menu-bg":"#13171d","comfy-menu-secondary-bg":"#11141A","comfy-input-bg":"#161b22","input-text":"#bcc2c8","descrip-text":"#999","drag-text":"#ccc","error-text":"#ff4444","border-color":"#30363d","tr-even-bg-color":"#161b22","tr-odd-bg-color":"#13171d","content-bg":"#30363d","content-fg":"#e5eaf0","content-hover-bg":"#161b22","content-hover-fg":"#e5eaf0","bar-shadow":"rgba(0, 0, 0, 1) 0 0 0.5rem"}},github={id:id$3,name:name$3,colors:colors$3},id$2="light",name$2="Light",light_theme=!0,colors$2={node_slot:{CLIP:"#FFA726",CLIP_VISION:"#5C6BC0",CLIP_VISION_OUTPUT:"#8D6E63",CONDITIONING:"#EF5350",CONTROL_NET:"#66BB6A",IMAGE:"#42A5F5",LATENT:"#AB47BC",MASK:"#9CCC65",MODEL:"#7E57C2",STYLE_MODEL:"#D4E157",VAE:"#FF7043",NOISE:"#B0B0B0",GUIDER:"#66FFFF",SAMPLER:"#ECB4B4",SIGMAS:"#CDFFCD",TAESD:"#DCC274"},litegraph_base:{BACKGROUND_IMAGE:"data:image/gif;base64,R0lGODlhZABkALMAAAAAAP///+vr6+rq6ujo6Ofn5+bm5uXl5d3d3f///wAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAkALAAAAABkAGQAAAT/UMhJq7046827HkcoHkYxjgZhnGG6si5LqnIM0/fL4qwwIMAg0CAsEovBIxKhRDaNy2GUOX0KfVFrssrNdpdaqTeKBX+dZ+jYvEaTf+y4W66mC8PUdrE879f9d2mBeoNLfH+IhYBbhIx2jkiHiomQlGKPl4uZe3CaeZifnnijgkESBqipqqusra6vsLGys62SlZO4t7qbuby7CLa+wqGWxL3Gv3jByMOkjc2lw8vOoNSi0czAncXW3Njdx9Pf48/Z4Kbbx+fQ5evZ4u3k1fKR6cn03vHlp7T9/v8A/8Gbp4+gwXoFryXMB2qgwoMMHyKEqA5fxX322FG8tzBcRnMW/zlulPbRncmQGidKjMjyYsOSKEF2FBlJQMCbOHP6c9iSZs+UnGYCdbnSo1CZI5F64kn0p1KnTH02nSoV3dGTV7FFHVqVq1dtWcMmVQZTbNGu72zqXMuW7danVL+6e4t1bEy6MeueBYLXrNO5Ze36jQtWsOG97wIj1vt3St/DjTEORss4nNq2mDP3e7w4r1bFkSET5hy6s2TRlD2/mSxXtSHQhCunXo26NevCpmvD/UU6tuullzULH76q92zdZG/Ltv1a+W+osI/nRmyc+fRi1Xdbh+68+0vv10dH3+77KD/i6IdnX669/frn5Zsjh4/2PXju8+8bzc9/6fj27LFnX11/+IUnXWl7BJfegm79FyB9JOl3oHgSklefgxAC+FmFGpqHIYcCfkhgfCohSKKJVo044YUMttggiBkmp6KFXw1oII24oYhjiDByaKOOHcp3Y5BD/njikSkO+eBREQAAOw==",CLEAR_BACKGROUND_COLOR:"lightgray",NODE_TITLE_COLOR:"#222",NODE_SELECTED_TITLE_COLOR:"#000",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#444",NODE_TEXT_HIGHLIGHT_COLOR:"#1e293b",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#F7F7F7",NODE_DEFAULT_BGCOLOR:"#F5F5F5",NODE_DEFAULT_BOXCOLOR:"#CCC",NODE_DEFAULT_SHAPE:2,NODE_BOX_OUTLINE_COLOR:"#000",NODE_BYPASS_BGCOLOR:"#FF00FF",NODE_ERROR_COLOUR:"#E00",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.1)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#D4D4D4",WIDGET_OUTLINE_COLOR:"#999",WIDGET_TEXT_COLOR:"#222",WIDGET_SECONDARY_TEXT_COLOR:"#555",WIDGET_DISABLED_TEXT_COLOR:"#999",LINK_COLOR:"#4CAF50",EVENT_LINK_COLOR:"#FF9800",CONNECTING_LINK_COLOR:"#2196F3",BADGE_FG_COLOR:"#000",BADGE_BG_COLOR:"#FFF"},comfy_base:{"fg-color":"#222","bg-color":"#DDD","comfy-menu-bg":"#FFFFFF","comfy-menu-hover-bg":"#ccc","comfy-menu-secondary-bg":"#EEE","comfy-input-bg":"#C9C9C9","input-text":"#222","descrip-text":"#444","drag-text":"#555","error-text":"#F44336","border-color":"#888","tr-even-bg-color":"#f9f9f9","tr-odd-bg-color":"#fff","content-bg":"#e0e0e0","content-fg":"#222","content-hover-bg":"#adadad","content-hover-fg":"#222","bar-shadow":"rgba(16, 16, 16, 0.25) 0 0 0.5rem","interface-panel-box-shadow":"1px 1px 8px 0 rgba(0, 0, 0, 0.2)","interface-panel-drop-shadow":"1px 1px 4px rgba(0, 0, 0, 0.4)","interface-panel-hover-surface":"var(--color-gray-200)","interface-panel-selected-surface":"color-mix(in srgb, var(--interface-panel-surface) 78%, var(--contrast-mix-color))","contrast-mix-color":"#000"}},light={id:id$2,name:name$2,light_theme,colors:colors$2},id$1="nord",name$1="Nord",colors$1={node_slot:{BOOLEAN:"",CLIP:"#eacb8b",CLIP_VISION:"#A8DADC",CLIP_VISION_OUTPUT:"#ad7452",CONDITIONING:"#cf876f",CONTROL_NET:"#00d78d",CONTROL_NET_WEIGHTS:"",FLOAT:"",GLIGEN:"",IMAGE:"#80a1c0",IMAGEUPLOAD:"",INT:"",LATENT:"#b38ead",LATENT_KEYFRAME:"",MASK:"#a3bd8d",MODEL:"#8978a7",SAMPLER:"",SIGMAS:"",STRING:"",STYLE_MODEL:"#C2FFAE",T2I_ADAPTER_WEIGHTS:"",TAESD:"#DCC274",TIMESTEP_KEYFRAME:"",UPSCALE_MODEL:"",VAE:"#be616b"},litegraph_base:{BACKGROUND_IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFu2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDEgNzkuMTQ2Mjg5OSwgMjAyMy8wNi8yNS0yMDowMTo1NSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI1LjEgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0xMS0xM1QwMDoxODowMiswMTowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMTEtMTVUMDE6MjA6NDUrMDE6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMTEtMTVUMDE6MjA6NDUrMDE6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjUwNDFhMmZjLTEzNzQtMTk0ZC1hZWY4LTYxMzM1MTVmNjUwMCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyMzFiMTBiMC1iNGZiLTAyNGUtYjEyZS0zMDUzMDNjZDA3YzgiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyMzFiMTBiMC1iNGZiLTAyNGUtYjEyZS0zMDUzMDNjZDA3YzgiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjIzMWIxMGIwLWI0ZmItMDI0ZS1iMTJlLTMwNTMwM2NkMDdjOCIgc3RFdnQ6d2hlbj0iMjAyMy0xMS0xM1QwMDoxODowMiswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI1LjEgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo1MDQxYTJmYy0xMzc0LTE5NGQtYWVmOC02MTMzNTE1ZjY1MDAiIHN0RXZ0OndoZW49IjIwMjMtMTEtMTVUMDE6MjA6NDUrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyNS4xIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz73jWg/AAAAyUlEQVR42u3WKwoAIBRFQRdiMb1idv9Lsxn9gEFw4Dbb8JCTojbbXEJwjJVL2HKwYMGCBQuWLbDmjr+9zrBGjHl1WVcvy2DBggULFizTWQpewSt4HzwsgwULFiwFr7MUvMtS8D54WLBgGSxYCl7BK3iXZbBgwYIFC5bpLAWv4BW8Dx6WwYIFC5aC11kK3mUpeB88LFiwDBYsBa/gFbzLMliwYMGCBct0loJX8AreBw/LYMGCBUvB6ywF77IUvA8eFixYBgsWrNfWAZPltufdad+1AAAAAElFTkSuQmCC",CLEAR_BACKGROUND_COLOR:"#212732",NODE_TITLE_COLOR:"#999",NODE_SELECTED_TITLE_COLOR:"#e5eaf0",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#bcc2c8",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#2e3440",NODE_DEFAULT_BGCOLOR:"#161b22",NODE_DEFAULT_BOXCOLOR:"#545d70",NODE_DEFAULT_SHAPE:2,NODE_BOX_OUTLINE_COLOR:"#e5eaf0",NODE_BYPASS_BGCOLOR:"#FF00FF",NODE_ERROR_COLOUR:"#E00",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#2e3440",WIDGET_OUTLINE_COLOR:"#545d70",WIDGET_TEXT_COLOR:"#bcc2c8",WIDGET_SECONDARY_TEXT_COLOR:"#999",WIDGET_DISABLED_TEXT_COLOR:"#545d70",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA"},comfy_base:{"fg-color":"#e5eaf0","bg-color":"#2e3440","comfy-menu-bg":"#161b22","comfy-menu-secondary-bg":"#14181F","comfy-input-bg":"#2e3440","input-text":"#bcc2c8","descrip-text":"#999","drag-text":"#ccc","error-text":"#ff4444","border-color":"#545d70","tr-even-bg-color":"#2e3440","tr-odd-bg-color":"#161b22","content-bg":"#545d70","content-fg":"#e5eaf0","content-hover-bg":"#2e3440","content-hover-fg":"#e5eaf0","bar-shadow":"rgba(0, 0, 0, 0.75) 0 0 0.5rem"}},nord={id:id$1,name:name$1,colors:colors$1},id="solarized",name="Solarized",colors={node_slot:{CLIP:"#2AB7CA",CLIP_VISION:"#6c71c4",CLIP_VISION_OUTPUT:"#859900",CONDITIONING:"#d33682",CONTROL_NET:"#d1ffd7",IMAGE:"#5940bb",LATENT:"#268bd2",MASK:"#CCC9E7",MODEL:"#dc322f",STYLE_MODEL:"#1a998a",UPSCALE_MODEL:"#054A29",VAE:"#facfad"},litegraph_base:{NODE_TITLE_COLOR:"#fdf6e3",NODE_SELECTED_TITLE_COLOR:"#A9D400",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#657b83",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#094656",NODE_DEFAULT_BGCOLOR:"#073642",NODE_DEFAULT_BOXCOLOR:"#839496",NODE_DEFAULT_SHAPE:2,NODE_BOX_OUTLINE_COLOR:"#fdf6e3",NODE_BYPASS_BGCOLOR:"#FF00FF",NODE_ERROR_COLOUR:"#E00",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#002b36",WIDGET_OUTLINE_COLOR:"#839496",WIDGET_TEXT_COLOR:"#fdf6e3",WIDGET_SECONDARY_TEXT_COLOR:"#93a1a1",WIDGET_DISABLED_TEXT_COLOR:"#657b83",LINK_COLOR:"#2aa198",EVENT_LINK_COLOR:"#268bd2",CONNECTING_LINK_COLOR:"#859900"},comfy_base:{"fg-color":"#fdf6e3","bg-color":"#002b36","comfy-menu-bg":"#073642","comfy-menu-secondary-bg":"#06323D","comfy-input-bg":"#002b36","input-text":"#93a1a1","descrip-text":"#586e75","drag-text":"#839496","error-text":"#dc322f","border-color":"#657b83","tr-even-bg-color":"#002b36","tr-odd-bg-color":"#073642","content-bg":"#657b83","content-fg":"#fdf6e3","content-hover-bg":"#002b36","content-hover-fg":"#fdf6e3","bar-shadow":"rgba(16, 16, 16, 0.5) 0 0 0.5rem"}},solarized={id,name,colors},CORE_COLOR_PALETTES={dark,light,solarized,arc,nord,github},DEFAULT_COLOR_PALETTE=dark,DEFAULT_DARK_COLOR_PALETTE=dark,DEFAULT_LIGHT_COLOR_PALETTE=light,useColorPaletteStore=defineStore("colorPalette",()=>{const i=ref({}),o=ref(DEFAULT_COLOR_PALETTE.id),n=computed(()=>({...CORE_COLOR_PALETTES,...i.value})),s=computed(()=>Object.values(n.value)),a=computed(()=>m(n.value[o.value])),r=p(f=>{if(f.id in n.value)throw new Error(`Palette with id ${f.id} already exists`);i.value[f.id]=f,o.value=f.id},"addCustomPalette"),l=p(f=>{if(!(f in i.value))throw new Error(`Palette with id ${f} does not exist`);delete i.value[f],o.value=CORE_COLOR_PALETTES.dark.id},"deleteCustomPalette"),u=p(f=>f in i.value,"isCustomPalette"),m=p(f=>{f.colors.comfy_base["comfy-menu-bg"]&&!f.colors.comfy_base["comfy-menu-secondary-bg"]&&(f.colors.comfy_base["comfy-menu-secondary-bg"]=f.colors.comfy_base["comfy-menu-bg"]);const _=f.light_theme?DEFAULT_LIGHT_COLOR_PALETTE:DEFAULT_DARK_COLOR_PALETTE;return{...f,colors:{...f.colors,node_slot:{..._.colors.node_slot,...f.colors.node_slot},litegraph_base:{..._.colors.litegraph_base,...f.colors.litegraph_base},comfy_base:{..._.colors.comfy_base,...f.colors.comfy_base}}}},"completePalette");return{customPalettes:i,activePaletteId:o,palettesLookup:n,palettes:s,completedActivePalette:a,isCustomPalette:u,addCustomPalette:r,deleteCustomPalette:l,completePalette:m}});class AbstractMinimapDataSource{static{p(this,"AbstractMinimapDataSource")}constructor(o){this.graph=o}getBounds(){const o=this.getNodes();if(o.length===0)return{minX:0,minY:0,maxX:100,maxY:100,width:100,height:100};const n=o.map(a=>({pos:[a.x,a.y],size:[a.width,a.height]})),s=calculateNodeBounds(n);return s||{minX:0,minY:0,maxX:100,maxY:100,width:100,height:100}}getGroups(){return this.graph?._groups?this.graph._groups.map(o=>({x:o.pos[0],y:o.pos[1],width:o.size[0],height:o.size[1],color:o.color})):[]}getLinks(){return this.graph?this.extractLinksFromGraph(this.graph):[]}extractLinksFromGraph(o){const n=[],s=new Map(this.getNodes().map(a=>[a.id,a]));for(const a of o._nodes){if(!a.outputs)continue;const r=s.get(String(a.id));if(r){for(const l of a.outputs)if(l.links)for(const u of l.links){const m=o.links[u];if(!m)continue;const f=s.get(String(m.target_id));f&&n.push({sourceNode:r,targetNode:f,sourceSlot:m.origin_slot,targetSlot:m.target_slot})}}}return n}}class LayoutStoreDataSource extends AbstractMinimapDataSource{static{p(this,"LayoutStoreDataSource")}getNodes(){const o=layoutStore.getAllNodes().value;if(o.size===0)return[];const n=[];for(const[s,a]of o){const r=this.graph?._nodes?.find(l=>String(l.id)===s);n.push({id:s,x:a.position.x,y:a.position.y,width:a.size.width,height:a.size.height,bgcolor:r?.bgcolor,mode:r?.mode,hasErrors:r?.has_errors})}return n}getNodeCount(){return layoutStore.getAllNodes().value.size}hasData(){return this.getNodeCount()>0}}class LiteGraphDataSource extends AbstractMinimapDataSource{static{p(this,"LiteGraphDataSource")}getNodes(){return this.graph?._nodes?this.graph._nodes.map(o=>({id:String(o.id),x:o.pos[0],y:o.pos[1],width:o.size[0],height:o.size[1],bgcolor:o.bgcolor,mode:o.mode,hasErrors:o.has_errors})):[]}getNodeCount(){return this.graph?._nodes?.length??0}hasData(){return this.getNodeCount()>0}}class MinimapDataSourceFactory{static{p(this,"MinimapDataSourceFactory")}static create(o){return layoutStore.getAllNodes().value.size>0?new LayoutStoreDataSource(o):new LiteGraphDataSource(o)}}function getMinimapColors(){const o=useColorPaletteStore().completedActivePalette.light_theme;return{nodeColor:o?"#3DA8E099":"#0B8CE999",nodeColorDefault:o?"#D9D9D9":"#353535",linkColor:o?"#616161":"#B3B3B3",slotColor:o?"#616161":"#B3B3B3",groupColor:o?"#A2D3EC":"#1F547A",groupColorDefault:o?"#283640":"#B3C1CB",bypassColor:o?"#DBDBDB":"#4B184B",errorColor:"#FF0000",isLightTheme:o}}p(getMinimapColors,"getMinimapColors");function getNodeColor(i,o,n){return o.renderBypass&&i.mode===LGraphEventMode.BYPASS?n.bypassColor:o.nodeColors?i.bgcolor?n.isLightTheme?adjustColor(i.bgcolor,{lightness:.5}):i.bgcolor:n.nodeColorDefault:n.nodeColor}p(getNodeColor,"getNodeColor");function renderGroups(i,o,n,s,a,r){const l=o.getGroups();if(l.length!==0)for(const u of l){const m=(u.x-a.bounds.minX)*a.scale+n,f=(u.y-a.bounds.minY)*a.scale+s,_=u.width*a.scale,y=u.height*a.scale;let b=r.groupColor;a.settings.nodeColors&&(b=u.color??r.groupColorDefault,r.isLightTheme&&(b=adjustColor(b,{opacity:.5}))),i.fillStyle=b,i.fillRect(m,f,_,y)}}p(renderGroups,"renderGroups");function renderNodes(i,o,n,s,a,r){const l=o.getNodes();if(l.length===0)return;const u=new Map;for(const m of l){const f=(m.x-a.bounds.minX)*a.scale+n,_=(m.y-a.bounds.minY)*a.scale+s,y=m.width*a.scale,b=m.height*a.scale,w=getNodeColor(m,a.settings,r);u.has(w)||u.set(w,[]),u.get(w).push({x:f,y:_,w:y,h:b,hasErrors:m.hasErrors})}for(const[m,f]of u){i.fillStyle=m;for(const _ of f)i.fillRect(_.x,_.y,_.w,_.h)}if(a.settings.renderError){i.strokeStyle=r.errorColor,i.lineWidth=.3;for(const m of u.values())for(const f of m)f.hasErrors&&i.strokeRect(f.x,f.y,f.w,f.h)}}p(renderNodes,"renderNodes");function renderConnections(i,o,n,s,a,r){const l=o.getLinks();if(l.length===0)return;i.strokeStyle=r.linkColor,i.lineWidth=.3;const u=Math.max(a.scale,.5),m=[];for(const f of l){const _=(f.sourceNode.x-a.bounds.minX)*a.scale+n,y=(f.sourceNode.y-a.bounds.minY)*a.scale+s,b=(f.targetNode.x-a.bounds.minX)*a.scale+n,w=(f.targetNode.y-a.bounds.minY)*a.scale+s,k=_+f.sourceNode.width*a.scale,S=y+f.sourceNode.height*a.scale*.2,C=b,I=w+f.targetNode.height*a.scale*.2;i.beginPath(),i.moveTo(k,S),i.lineTo(C,I),i.stroke(),m.push({x1:k,y1:S,x2:C,y2:I})}i.fillStyle=r.slotColor;for(const f of m)i.beginPath(),i.arc(f.x1,f.y1,u,0,Math.PI*2),i.fill(),i.beginPath(),i.arc(f.x2,f.y2,u,0,Math.PI*2),i.fill()}p(renderConnections,"renderConnections");function renderMinimapToCanvas(i,o,n){const s=i.getContext("2d");if(!s)return;s.clearRect(0,0,n.width,n.height);const a=MinimapDataSourceFactory.create(o);if(!a.hasData())return;const r=getMinimapColors(),l=(n.width-n.bounds.width*n.scale)/2,u=(n.height-n.bounds.height*n.scale)/2;n.settings.showGroups&&renderGroups(s,a,l,u,n,r),n.settings.showLinks&&renderConnections(s,a,l,u,n,r),renderNodes(s,a,l,u,n,r)}p(renderMinimapToCanvas,"renderMinimapToCanvas");function createGraphThumbnail(){const i=useCanvasStore(),n=useWorkflowStore().activeSubgraph||i.canvas?.graph;if(!n||!n._nodes||n._nodes.length===0)return null;const s=250,a=200,r=calculateNodeBounds(n._nodes);if(!r)return null;const l=calculateMinimapScale(r,s,a),u=document.createElement("canvas");u.width=s,u.height=a,renderMinimapToCanvas(u,n,{bounds:r,scale:l,settings:{nodeColors:!0,showLinks:!1,showGroups:!0,renderBypass:!1,renderError:!1},width:s,height:a});const m=u.toDataURL(),f=u.getContext("2d");return f&&f.clearRect(0,0,s,a),m}p(createGraphThumbnail,"createGraphThumbnail");const workflowThumbnails=ref(new Map),useWorkflowThumbnail=p(()=>{const i=p(()=>{try{const l=createGraphThumbnail();return Promise.resolve(l)}catch(l){return console.error("Failed to capture canvas thumbnail:",l),Promise.resolve(null)}},"createMinimapPreview");return{createMinimapPreview:i,storeThumbnail:p(async l=>{const u=await i();if(u){const m=workflowThumbnails.value.get(l.key);m&&URL.revokeObjectURL(m),workflowThumbnails.value.set(l.key,u)}},"storeThumbnail"),getThumbnail:p(l=>workflowThumbnails.value.get(l),"getThumbnail"),clearThumbnail:p(l=>{const u=workflowThumbnails.value.get(l);u&&URL.revokeObjectURL(u),workflowThumbnails.value.delete(l)},"clearThumbnail"),clearAllThumbnails:p(()=>{for(const l of workflowThumbnails.value.values())URL.revokeObjectURL(l);workflowThumbnails.value.clear()},"clearAllThumbnails"),moveWorkflowThumbnail:p((l,u)=>{if(l===u)return;const m=workflowThumbnails.value.get(l);m&&(workflowThumbnails.value.set(u,m),workflowThumbnails.value.delete(l))},"moveWorkflowThumbnail"),workflowThumbnails}},"useWorkflowThumbnail"),defaultGraph={last_node_id:9,last_link_id:9,nodes:[{id:7,type:"CLIPTextEncode",pos:[413,389],size:[425.27801513671875,180.6060791015625],flags:{},order:3,mode:0,inputs:[{name:"clip",type:"CLIP",link:5}],outputs:[{name:"CONDITIONING",type:"CONDITIONING",links:[6],slot_index:0}],properties:{},widgets_values:["text, watermark"]},{id:6,type:"CLIPTextEncode",pos:[415,186],size:[422.84503173828125,164.31304931640625],flags:{},order:2,mode:0,inputs:[{name:"clip",type:"CLIP",link:3}],outputs:[{name:"CONDITIONING",type:"CONDITIONING",links:[4],slot_index:0}],properties:{},widgets_values:["beautiful scenery nature glass bottle landscape, , purple galaxy bottle,"]},{id:5,type:"EmptyLatentImage",pos:[473,609],size:[315,106],flags:{},order:1,mode:0,outputs:[{name:"LATENT",type:"LATENT",links:[2],slot_index:0}],properties:{},widgets_values:[512,512,1]},{id:3,type:"KSampler",pos:[863,186],size:[315,262],flags:{},order:4,mode:0,inputs:[{name:"model",type:"MODEL",link:1},{name:"positive",type:"CONDITIONING",link:4},{name:"negative",type:"CONDITIONING",link:6},{name:"latent_image",type:"LATENT",link:2}],outputs:[{name:"LATENT",type:"LATENT",links:[7],slot_index:0}],properties:{},widgets_values:[0x8e7ff42ed37e,!0,20,8,"euler","normal",1]},{id:8,type:"VAEDecode",pos:[1209,188],size:[210,46],flags:{},order:5,mode:0,inputs:[{name:"samples",type:"LATENT",link:7},{name:"vae",type:"VAE",link:8}],outputs:[{name:"IMAGE",type:"IMAGE",links:[9],slot_index:0}],properties:{}},{id:9,type:"SaveImage",pos:[1451,189],size:[210,26],flags:{},order:6,mode:0,inputs:[{name:"images",type:"IMAGE",link:9}],properties:{}},{id:4,type:"CheckpointLoaderSimple",pos:[26,474],size:[315,98],flags:{},order:0,mode:0,outputs:[{name:"MODEL",type:"MODEL",links:[1],slot_index:0},{name:"CLIP",type:"CLIP",links:[3,5],slot_index:1},{name:"VAE",type:"VAE",links:[8],slot_index:2}],properties:{},widgets_values:["v1-5-pruned-emaonly-fp16.safetensors"]}],links:[[1,4,0,3,0,"MODEL"],[2,5,0,3,3,"LATENT"],[3,4,1,6,0,"CLIP"],[4,6,0,3,1,"CONDITIONING"],[5,4,1,7,0,"CLIP"],[6,7,0,3,2,"CONDITIONING"],[7,3,0,8,0,"LATENT"],[8,4,2,8,1,"VAE"],[9,8,0,9,0,"IMAGE"]],groups:[],config:{},extra:{ds:{offset:[0,0],scale:1}},version:.4},defaultGraphJSON=JSON.stringify(defaultGraph),blankGraph={last_node_id:0,last_link_id:0,nodes:[],links:[],groups:[],config:{},extra:{},version:.4};window.comfyAPI=window.comfyAPI||{};window.comfyAPI.defaultGraph=window.comfyAPI.defaultGraph||{};window.comfyAPI.defaultGraph.defaultGraph=defaultGraph;window.comfyAPI.defaultGraph.defaultGraphJSON=defaultGraphJSON;window.comfyAPI.defaultGraph.blankGraph=blankGraph;function applyTextReplacements$1(i,o){const n=collectAllNodes(i);return o.replace(/%([^%]+)%/g,function(s,a){const r=a.split(".");if(r.length!==2)return r[0].startsWith("date:")?formatDate(r[0].substring(5),new Date):(a!=="width"&&a!=="height"&&console.warn("Invalid replacement pattern",a),s);let l=n.filter(f=>f.properties?.["Node name for S&R"]===r[0]);if(l.length||(l=n.filter(f=>f.title===r[0])),!l.length)return console.warn("Unable to find node",r[0]),s;l.length>1&&console.warn("Multiple nodes matched",r[0],"using first match");const u=l[0],m=u.widgets?.find(f=>f.name===r[1]);return m?((m.value??"")+"").replaceAll(/[/?<>\\:*|"\x00-\x1F\x7F]/g,"_"):(console.warn("Unable to find widget",r[1],"on node",r[0],u),s)})}p(applyTextReplacements$1,"applyTextReplacements$1");function clone$1(i){try{if(typeof structuredClone<"u")return structuredClone(i)}catch{}return JSON.parse(JSON.stringify(i))}p(clone$1,"clone$1");function applyTextReplacements(i,o){return applyTextReplacements$1(i.graph,o)}p(applyTextReplacements,"applyTextReplacements");async function addStylesheet(i,o){return new Promise((n,s)=>{let a;i.endsWith(".js")?a=i.substr(0,i.length-2)+"css":a=new URL(i,o??`${window.location.protocol}//${window.location.host}`).toString(),$el("link",{parent:document.head,rel:"stylesheet",type:"text/css",href:a,onload:n,onerror:s})})}p(addStylesheet,"addStylesheet");function uploadFile$1(i){return new Promise((o,n)=>{const s=document.createElement("input");s.type="file",s.accept=i,s.onchange=a=>{const r=a.target.files?.[0];if(!r)return n(new Error("No file selected"));o(r)},s.click()})}p(uploadFile$1,"uploadFile$1");function prop(i,o,n,s){let a;return Object.defineProperty(i,o,{get(){return a},set(r){const l=a;a=r,s?.(a,l,i,o)}}),n}p(prop,"prop");function getStorageValue(i){const o=api.clientId??api.initialClientId;return(o&&sessionStorage.getItem(`${i}:${o}`))??localStorage.getItem(i)}p(getStorageValue,"getStorageValue");function setStorageValue(i,o){const n=api.clientId??api.initialClientId;n&&sessionStorage.setItem(`${i}:${n}`,o),localStorage.setItem(i,o)}p(setStorageValue,"setStorageValue");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.utils=window.comfyAPI.utils||{};window.comfyAPI.utils.clone=clone$1;window.comfyAPI.utils.applyTextReplacements=applyTextReplacements;window.comfyAPI.utils.addStylesheet=addStylesheet;window.comfyAPI.utils.uploadFile=uploadFile$1;window.comfyAPI.utils.prop=prop;window.comfyAPI.utils.getStorageValue=getStorageValue;window.comfyAPI.utils.setStorageValue=setStorageValue;const THEME_PROPERTY_MAP={NODE_BOX_OUTLINE_COLOR:"component-node-border",NODE_DEFAULT_BGCOLOR:"component-node-background",NODE_DEFAULT_BOXCOLOR:"node-component-header-icon",NODE_DEFAULT_COLOR:"node-component-header-surface",NODE_TITLE_COLOR:"node-component-header",WIDGET_BGCOLOR:"component-node-widget-background",WIDGET_TEXT_COLOR:"component-node-foreground"},useColorPaletteService=p(()=>{const i=useColorPaletteStore(),o=useSettingStore(),n=useNodeDefStore(),{wrapWithErrorHandling:s,wrapWithErrorHandlingAsync:a}=useErrorHandling(),r=p(N=>{const L=paletteSchema.safeParse(N);if(L.success)return L.data;const A=fromZodError(L.error);throw new Error(`Invalid color palette against zod schema:
${A}`)},"validateColorPalette"),l=p(async()=>{await o.set("Comfy.CustomColorPalettes",i.customPalettes)},"persistCustomColorPalettes"),u=p(async N=>{i.deleteCustomPalette(N),await l()},"deleteCustomColorPalette"),m=p(async N=>{r(N),i.addCustomPalette(N),await l()},"addCustomColorPalette"),f=p(N=>{const L=Object.fromEntries(Array.from(n.nodeDataTypes).map(A=>[A,""]));Object.assign(app$1.canvas.default_connection_color_byType,L,N),Object.assign(LGraphCanvas.link_type_colors,L,N)},"loadLinkColorPalette");function _(N){return N in THEME_PROPERTY_MAP}p(_,"validThemeProp");function y(N){if(!N)return;const L=document.body?.style;if(L)for(const A of n.nodeDataTypes){const D=`color-datatype-${A}`,O=N[A];O?L.setProperty(`--${D}`,O):L.removeProperty(`--${D}`)}}p(y,"loadLinkColorPaletteForVueNodes");function b(N,L){if(!N)return;const A=document.body?.style;if(A)for(const D of Object.keys(THEME_PROPERTY_MAP)){if(!_(D))continue;const O=THEME_PROPERTY_MAP[D];if(L==="dark"||L==="light"){A.removeProperty(`--${O}`);continue}const M=N[D];M?A.setProperty(`--${O}`,M):A.removeProperty(`--${O}`)}}p(b,"loadLitegraphForVueNodes");const w=p(N=>{app$1.canvas.node_title_color=N.NODE_TITLE_COLOR,app$1.canvas.default_link_color=N.LINK_COLOR,o.get("Comfy.Canvas.BackgroundImage")?app$1.canvas.clear_background_color="transparent":(app$1.canvas.background_image=N.BACKGROUND_IMAGE,app$1.canvas.clear_background_color=N.CLEAR_BACKGROUND_COLOR),app$1.canvas._pattern=void 0;for(const[A,D]of Object.entries(N))Object.prototype.hasOwnProperty.call(LiteGraph,A)&&(A==="NODE_DEFAULT_SHAPE"&&typeof D=="string"?(console.warn(`litegraph_base.NODE_DEFAULT_SHAPE only accepts [${[LiteGraph.BOX_SHAPE,LiteGraph.ROUND_SHAPE,LiteGraph.CARD_SHAPE].join(", ")}] but got ${D}`),LiteGraph.NODE_DEFAULT_SHAPE=LiteGraph.ROUND_SHAPE):LiteGraph[A]=D)},"loadLiteGraphColorPalette"),S=p(N=>{const L=[],A=N.shape;for(const[D,O]of Object.entries(A))(O instanceof z.ZodOptional||O instanceof z.ZodDefault)&&L.push(D);return L},"getOptionalKeys")(comfyBaseSchema),C=p(N=>{if(!N)return;const L=document.documentElement.style;for(const[D,O]of Object.entries(N))L.setProperty("--"+D,O);for(const D of S)D in N||L.setProperty("--"+D,`var(--palette-${D})`);const A=o.get("Comfy.Canvas.BackgroundImage");A?L.setProperty("--bg-img",`url('${A}') no-repeat center /cover`):L.removeProperty("--bg-img")},"loadComfyColorPalette"),I=p(async N=>{const L=i.palettesLookup[N];if(!L)throw new Error(`Color palette ${N} not found`);const A=i.completePalette(L);f(A.colors.node_slot),w(A.colors.litegraph_base),b(A.colors.litegraph_base,N),y(A.colors.node_slot),C(A.colors.comfy_base),app$1.canvas.setDirty(!0,!0),i.activePaletteId=N},"loadColorPalette"),T=p(N=>{const L=i.palettesLookup[N];if(!L)throw new Error(`Color palette ${N} not found`);downloadBlob(L.id+".json",new Blob([JSON.stringify(toRaw(L),null,2)],{type:"application/json"}))},"exportColorPalette"),E=p(async()=>{const L=await(await uploadFile$1("application/json")).text(),A=JSON.parse(L);return await m(A),A},"importColorPalette");return{getActiveColorPalette:p(()=>i.completedActivePalette,"getActiveColorPalette"),addCustomColorPalette:a(m),deleteCustomColorPalette:a(u),loadColorPalette:a(I),exportColorPalette:s(T),importColorPalette:a(E)}},"useColorPaletteService");function reconcileHistoryV1(i,o,n,s){const a=i.sort((m,f)=>f.prompt[0]-m.prompt[0]),r=new Set(a.map(m=>m.prompt[1])),l=s===void 0?a:a.filter(m=>m.prompt[0]>s),u=o.filter(m=>r.has(m.prompt[1]));return[...l,...u].sort((m,f)=>f.prompt[0]-m.prompt[0]).slice(0,n)}p(reconcileHistoryV1,"reconcileHistoryV1");function reconcileHistory(i,o,n,s){return reconcileHistoryV1(i,o,n,s)}p(reconcileHistory,"reconcileHistory");class LegacyMenuCompat{static{p(this,"LegacyMenuCompat")}originalMethods=new Map;hasWarned=new Set;currentExtension=null;isExtracting=!1;wrapperMethods=new Map;preWrapperMethods=new Map;wrapperInstalled=new Map;setCurrentExtension(o){this.currentExtension=o}registerWrapper(o,n,s,a){this.wrapperMethods.set(o,n),this.preWrapperMethods.set(o,s);const r=a&&a[o]===n;this.wrapperInstalled.set(o,!!r)}install(o,n){const s=o[n];this.originalMethods.set(n,s);let a=s;Object.defineProperty(o,n,{get(){return a},set:p(r=>{const l=`${n}:${r.toString().slice(0,100)}`;!this.hasWarned.has(l)&&this.currentExtension&&(this.hasWarned.add(l),console.warn(`%c[DEPRECATED]%c Monkey-patching ${n} is deprecated. (Extension: "${this.currentExtension}")
Please use the new context menu API instead.

See: https://docs.comfy.org/custom-nodes/js/context-menu-migration`,"color: orange; font-weight: bold","color: inherit")),a=r},"set")})}extractLegacyItems(o,n,...s){if(this.isExtracting)return[];const a=this.originalMethods.get(o);if(!a)return[];try{this.isExtracting=!0;const r=a.apply(n,s);if(!r)return[];const l=n.constructor.prototype[o];if(!l||l===a)return[];const u=this.wrapperMethods.get(o);if(u&&l===u)return[];const m=this.preWrapperMethods.get(o),f=this.wrapperInstalled.get(o),b=(m&&f&&l!==m?m:l).apply(n,s);return b?b.length>r.length?b.slice(r.length):[]:[]}catch(r){return console.error("[Context Menu Compat] Failed to extract legacy items:",r),[]}finally{this.isExtracting=!1}}}const legacyMenuCompat=new LegacyMenuCompat,ALWAYS_ENABLED_EXTENSIONS=[],ALWAYS_DISABLED_EXTENSIONS=["pysssss.Locking","pysssss.SnapToGrid","pysssss.FaviconStatus","KJNodes.browserstatus"],useExtensionStore=defineStore("extension",()=>{const i=ref({}),o=computed(()=>Object.values(i.value)),n=ref(new Set),s=computed(()=>Array.from(n.value).filter(k=>!(k in i.value))),a=p(k=>k in i.value,"isExtensionInstalled"),r=p(k=>!n.value.has(k),"isExtensionEnabled"),l=computed(()=>o.value.filter(k=>r(k.name)));function u(k){return ALWAYS_DISABLED_EXTENSIONS.includes(k)||ALWAYS_ENABLED_EXTENSIONS.includes(k)}p(u,"isExtensionReadOnly");function m(k){if(!k.name)throw new Error("Extensions must have a 'name' property.");if(i.value[k.name])throw new Error(`Extension named '${k.name}' already registered.`);n.value.has(k.name)&&console.warn(`Extension ${k.name} is disabled.`),i.value[k.name]=markRaw(k)}p(m,"registerExtension");function f(k){n.value=new Set(k);for(const S of ALWAYS_DISABLED_EXTENSIONS)n.value.add(S);for(const S of ALWAYS_ENABLED_EXTENSIONS)n.value.delete(S)}p(f,"loadDisabledExtensionNames");const _=ref([]);function y(){_.value=o.value.map(k=>k.name)}p(y,"captureCoreExtensions");function b(k){return _.value.includes(k)}p(b,"isCoreExtension");const w=computed(()=>o.value.some(k=>!b(k.name)));return{extensions:o,enabledExtensions:l,inactiveDisabledExtensionNames:s,isExtensionInstalled:a,isExtensionEnabled:r,isExtensionReadOnly:u,registerExtension:m,loadDisabledExtensionNames:f,captureCoreExtensions:y,isCoreExtension:b,hasThirdPartyExtensions:w}}),CORE_MENU_COMMANDS=[[[],["Comfy.NewBlankWorkflow"]],[[],[]],[["File"],["Comfy.OpenWorkflow"]],[["File"],["Comfy.SaveWorkflow","Comfy.SaveWorkflowAs","Comfy.ExportWorkflow","Comfy.ExportWorkflowAPI"]],[["Edit"],["Comfy.Undo","Comfy.Redo"]],[["Edit"],["Comfy.ClearWorkflow"]],[["Edit"],["Comfy.OpenClipspace"]],[["Edit"],["Comfy.RefreshNodeDefinitions","Comfy.Memory.UnloadModels","Comfy.Memory.UnloadModelsAndExecutionCache"]],[["View"],[]],[["Help"],["Comfy.Help.OpenComfyUIIssues","Comfy.Help.OpenComfyUIDocs","Comfy.Help.OpenComfyOrgDiscord","Comfy.Help.OpenComfyUIForum"]],[["Help"],["Comfy.Help.AboutComfyUI","Comfy.ContactSupport"]]],useMenuItemStore=defineStore("menuItem",()=>{const i=useCommandStore(),o=ref([]),n=ref({}),s=p((u,m)=>{let f=o.value;for(let y=0;y<u.length;y++){const b=u[y];let w=f.find(k=>k.label===b);w||(w={label:b,key:b,items:[]},f.push(w)),w.items||(w.items=[]),f=w.items}f.length>0&&f.push({separator:!0}),f.push(...m);const _=u.join(".");n.value[_]||(n.value[_]=m.some(y=>y.comfyCommand?.active))},"registerMenuGroup"),a=p((u,m)=>{const f=m.map(_=>i.getCommand(_)).map(_=>({command:p(()=>i.execute(_.id),"command"),label:_.menubarLabel,icon:_.icon,tooltip:_.tooltip,comfyCommand:_,parentPath:u.join(".")}));s(u,f)},"registerCommands");return{menuItems:o,registerMenuGroup:s,registerCommands:a,loadExtensionMenuCommands:p(u=>{if(!u.menuCommands)return;const m=new Set(u.commands?.map(f=>f.id)??[]);u.menuCommands.forEach(f=>{const _=f.commands.filter(y=>m.has(y));_.length&&a(f.path,_)})},"loadExtensionMenuCommands"),registerCoreMenuCommands:p(()=>{for(const[u,m]of CORE_MENU_COMMANDS)a(u,m)},"registerCoreMenuCommands"),menuItemHasActiveStateChildren:n}});function dynamicComboWidget(i,o,n,s,a){const{addNodeInput:r}=useLitegraphService(),l=zDynamicComboInputSpec.safeParse(n);if(!l.success)throw new Error("invalid DynamicCombo spec");const u=l.data,m=Object.fromEntries(u[1].options.map(({key:C,inputs:I})=>[C,I])),f=[Object.keys(m),{}],{widget:_,minWidth:y,minHeight:b}=app$1.widgets.COMBO(i,o,f,s,a);let w=[];const k=p(C=>{if(!i.widgets)throw new Error("Not Reachable");const I=C?m[C]:void 0;for(const M of w){const P=i.inputs.findIndex(V=>V.name===M);P!==-1&&i.removeInput(P);const R=i.widgets.findIndex(V=>V.name===M);R!==-1&&(i.widgets[R].value=void 0,i.widgets.splice(R,1))}if(w=[],!I)return;const T=i.widgets.findIndex(M=>M===_)+1,E=i.widgets.length,N=i.inputs.findIndex(M=>M.name===_.name)+1,L=i.inputs.length;if(T===0)throw new Error("Dynamic widget doesn't exist on node");const A=[[I.required,!1],[I.optional,!0]];for(const[M,P]of A)for(const R in M??{})r(i,transformInputSpecV1ToV2(M[R],{name:R,isOptional:P})),w.push(R);const D=i.widgets.splice(E);if(i.widgets.splice(T,0,...D),N===0){if(D.length===0&&i.inputs.length!==L)throw new Error("Failed to find input socket for "+_.name);return}const O=i.spliceInputs(L).map(M=>{const P=i.inputs.findIndex(R=>M.name===R.name);return P===-1?M:i.spliceInputs(P,1)[0]});i.spliceInputs(N,0,...O),i.size[1]=i.computeSize([...i.size])[1]},"updateWidgets");let S=_.value;return Object.defineProperty(_,"value",{get(){return S},set(C){S=C,k(C)}}),_.value=S,{widget:_,minWidth:y,minHeight:b}}p(dynamicComboWidget,"dynamicComboWidget");const dynamicWidgets={COMFY_DYNAMICCOMBO_V3:dynamicComboWidget},zIntInputSpec=zIntInputOptions.extend({type:z.literal("INT"),name:z.string(),isOptional:z.boolean().optional()}),zFloatInputSpec=zFloatInputOptions.extend({type:z.literal("FLOAT"),name:z.string(),isOptional:z.boolean().optional()}),zBooleanInputSpec=zBooleanInputOptions.extend({type:z.literal("BOOLEAN"),name:z.string(),isOptional:z.boolean().optional()}),zStringInputSpec=zStringInputOptions.extend({type:z.literal("STRING"),name:z.string(),isOptional:z.boolean().optional()}),zComboInputSpec=zComboInputOptions.extend({type:z.literal("COMBO"),name:z.string(),isOptional:z.boolean().optional()}),zColorInputSpec=zBaseInputOptions.extend({type:z.literal("COLOR"),name:z.string(),isOptional:z.boolean().optional(),options:z.object({default:z.string().optional()}).optional()}),zImageInputSpec=zBaseInputOptions.extend({type:z.literal("IMAGE"),name:z.string(),isOptional:z.boolean().optional(),options:z.record(z.unknown()).optional()}),zImageCompareInputSpec=zBaseInputOptions.extend({type:z.literal("IMAGECOMPARE"),name:z.string(),isOptional:z.boolean().optional(),options:z.record(z.unknown()).optional()}),zMarkdownInputSpec=zBaseInputOptions.extend({type:z.literal("MARKDOWN"),name:z.string(),isOptional:z.boolean().optional(),options:z.object({content:z.string().optional()}).optional()}),zChartInputSpec=zBaseInputOptions.extend({type:z.literal("CHART"),name:z.string(),isOptional:z.boolean().optional(),options:z.object({type:z.enum(["bar","line"]).optional(),data:z.object({}).optional()}).optional()}),zGalleriaInputSpec=zBaseInputOptions.extend({type:z.literal("GALLERIA"),name:z.string(),isOptional:z.boolean().optional(),options:z.object({images:z.array(z.string()).optional()}).optional()}),zTextareaInputSpec=zBaseInputOptions.extend({type:z.literal("TEXTAREA"),name:z.string(),isOptional:z.boolean().optional(),options:z.object({rows:z.number().optional(),cols:z.number().optional(),default:z.string().optional()}).optional()}),zCustomInputSpec=zBaseInputOptions.extend({type:z.string(),name:z.string(),isOptional:z.boolean().optional()}),zInputSpec=z.union([zIntInputSpec,zFloatInputSpec,zBooleanInputSpec,zStringInputSpec,zComboInputSpec,zColorInputSpec,zImageInputSpec,zImageCompareInputSpec,zMarkdownInputSpec,zChartInputSpec,zGalleriaInputSpec,zTextareaInputSpec,zCustomInputSpec]),zOutputSpec=z.object({index:z.number(),name:z.string(),type:z.string(),is_list:z.boolean(),options:z.array(z.any()).optional(),tooltip:z.string().optional()});z.object({inputs:z.record(zInputSpec),outputs:z.array(zOutputSpec),hidden:z.record(z.any()).optional(),name:z.string(),display_name:z.string(),description:z.string(),help:z.string().optional(),category:z.string(),output_node:z.boolean(),python_module:z.string(),deprecated:z.boolean().optional(),experimental:z.boolean().optional(),api_node:z.boolean().optional()});const isIntInputSpec=p(i=>i.type==="INT","isIntInputSpec"),isFloatInputSpec=p(i=>i.type==="FLOAT","isFloatInputSpec"),isBooleanInputSpec=p(i=>i.type==="BOOLEAN","isBooleanInputSpec"),isStringInputSpec=p(i=>i.type==="STRING","isStringInputSpec"),isComboInputSpec=p(i=>i.type==="COMBO","isComboInputSpec"),isChartInputSpec=p(i=>i.type==="CHART","isChartInputSpec"),useBooleanWidget=p(()=>p((o,n)=>{if(!isBooleanInputSpec(n))throw new Error(`Invalid input data: ${n}`);const s=n.default??!1,a={on:n.label_on,off:n.label_off};return o.addWidget("toggle",n.name,s,()=>{},a)},"widgetConstructor"),"useBooleanWidget"),useChartWidget=p(()=>(i,o)=>{if(!isChartInputSpec(o))throw new Error("Invalid input spec for chart widget");const{name:n,options:s={}}=o,a=s.type||"line";return i.addWidget("chart",n,s.data||{},()=>{},{serialize:!0,type:a,...s})},"useChartWidget"),useColorWidget=p(()=>(i,o)=>{const{name:n,options:s}=o,a=s?.default||"#000000";return i.addWidget("color",n,a,()=>{},{serialize:!0})},"useColorWidget"),_sfc_main$2E=defineComponent({__name:"MultiSelectWidget",props:mergeModels({widget:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const o=useModel(i,"modelValue"),n=i.widget.inputSpec,s=n.options??[],a=n.multi_select?.placeholder??"Select items",r=n.multi_select?.chip?"chip":"comma";return(l,u)=>(openBlock(),createElementBlock("div",null,[createVNode(unref(script$2),{modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=m=>o.value=m),options:unref(s),filter:"",placeholder:unref(a),"max-selected-labels":3,display:unref(r),class:"w-full",pt:{dropdownIcon:"text-button-icon"}},null,8,["modelValue","options","placeholder","display"])]))}});function cn(...i){return twMerge(clsx(i))}p(cn,"cn");const getButtonSizeClasses=p((i="md")=>({"fit-content":"",sm:"px-2 py-1.5 text-xs",md:"px-4 py-2 text-sm"})[i],"getButtonSizeClasses"),getButtonTypeClasses=p((i="primary")=>({primary:"bg-neutral-900 border-none text-white dark-theme:bg-white dark-theme:text-neutral-900",secondary:cn("bg-secondary-background border-none text-base-foreground hover:bg-secondary-background-hover"),transparent:cn("bg-transparent border-none text-muted-foreground hover:bg-secondary-background-hover"),accent:"bg-primary-background hover:bg-primary-background-hover border-none text-white font-bold"})[i],"getButtonTypeClasses"),getBorderButtonTypeClasses=p((i="primary")=>{const o={primary:"bg-neutral-900 text-white dark-theme:bg-white dark-theme:text-neutral-900",secondary:"bg-white text-neutral-950 dark-theme:bg-zinc-700 dark-theme:text-white",transparent:cn("bg-transparent text-base-foreground hover:bg-secondary-background-hover"),accent:"bg-primary-background hover:bg-primary-background-hover text-white font-bold"},n={primary:"border border-solid border-white dark-theme:border-neutral-900",secondary:"border border-solid border-neutral-950 dark-theme:border-white",transparent:"border border-solid border-neutral-950 dark-theme:border-white",accent:"border border-solid border-primary-background"};return`${o[i]} ${n[i]}`},"getBorderButtonTypeClasses"),getIconButtonSizeClasses=p((i="md")=>({"fit-content":"w-auto h-auto",sm:"size-8 text-xs !rounded-md",md:"size-10 text-sm"})[i],"getIconButtonSizeClasses"),getBaseButtonClasses=p(()=>["flex items-center justify-center shrink-0","outline-hidden rounded-lg cursor-pointer transition-all duration-200","disabled:opacity-50 disabled:pointer-events-none"].join(" "),"getBaseButtonClasses"),_sfc_main$2D=defineComponent({inheritAttrs:!1,__name:"IconTextButton",props:{iconPosition:{default:"left"},label:{},onClick:{type:Function},size:{default:"md"},type:{default:"primary"},border:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},class:{}},setup(i){const o=computed(()=>{const n=`${getBaseButtonClasses()} justify-start gap-2`,s=getButtonSizeClasses(i.size),a=i.border?getBorderButtonTypeClasses(i.type):getButtonTypeClasses(i.type);return cn(n,s,a,i.class)});return(n,s)=>(openBlock(),createBlock(unref(script),mergeProps(n.$attrs,{unstyled:"",class:o.value,disabled:n.disabled,onClick:n.onClick}),{default:withCtx(()=>[n.iconPosition!=="right"?renderSlot(n.$slots,"icon",{key:0}):createCommentVNode("",!0),createBaseVNode("span",null,toDisplayString(n.label),1),n.iconPosition==="right"?renderSlot(n.$slots,"icon",{key:1}):createCommentVNode("",!0)]),_:3},16,["class","disabled","onClick"]))}}),SEARCH_DEBOUNCE_DELAY_MS=300,_sfc_main$2C=defineComponent({__name:"SearchBox",props:mergeModels({autofocus:{type:Boolean,default:!1},placeholder:{},showBorder:{type:Boolean,default:!1},size:{default:"md"}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const o=useModel(i,"modelValue"),n=ref(o.value??""),s=useDebounceFn(u=>{o.value=u},SEARCH_DEBOUNCE_DELAY_MS);watch(n,u=>{s(u)}),watch(o,u=>{u!==n.value&&(n.value=u||"")});const a=ref(),r=p(()=>{a.value&&a.value.$el&&a.value.$el.focus()},"focusInput");onMounted(()=>i.autofocus&&r());const l=computed(()=>{const u="relative flex w-full items-center gap-2 bg-secondary-background cursor-text";if(i.showBorder)return cn(u,"rounded p-2 border border-solid border-border-default");const m={md:"h-8 px-2 py-1.5",lg:"h-10 px-4 py-2"}[i.size];return cn(u,"rounded-lg",m)});return(u,m)=>(openBlock(),createElementBlock("div",{class:normalizeClass(l.value),onClick:r},[m[1]||(m[1]=createBaseVNode("i",{class:"icon-[lucide--search] text-muted-foreground"},null,-1)),createVNode(unref(script$3),{ref_key:"input",ref:a,modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=f=>n.value=f),"aria-label":u.placeholder||unref(t)("templateWidgets.sort.searchPlaceholder","Search..."),placeholder:u.placeholder||unref(t)("templateWidgets.sort.searchPlaceholder","Search..."),type:"text",unstyled:"",class:"absolute inset-0 size-full pl-11 border-none outline-none bg-transparent text-sm text-base-foreground"},null,8,["modelValue","aria-label","placeholder"])],2))}}),_sfc_main$2B=defineComponent({inheritAttrs:!1,__name:"IconButton",props:{onClick:{type:Function},size:{default:"md"},type:{default:"secondary"},border:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},class:{}},setup(i){const o=computed(()=>{const n=`${getBaseButtonClasses()} p-0`,s=getIconButtonSizeClasses(i.size),a=i.border?getBorderButtonTypeClasses(i.type):getButtonTypeClasses(i.type);return cn(n,s,a,i.class)});return(n,s)=>(openBlock(),createBlock(unref(script),mergeProps(n.$attrs,{unstyled:"",class:o.value,disabled:n.disabled,onClick:n.onClick}),{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},16,["class","disabled","onClick"]))}}),_export_sfc=p((i,o)=>{const n=i.__vccOpts||i;for(const[s,a]of o)n[s]=a;return n},"_export_sfc"),_sfc_main$2A=defineComponent({inheritAttrs:!1,__name:"TextButton",props:{label:{},onClick:{type:Function},size:{default:"md"},type:{default:"primary"},border:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},class:{}},setup(i){const o=computed(()=>{const n=getBaseButtonClasses(),s=getButtonSizeClasses(i.size),a=i.border?getBorderButtonTypeClasses(i.type):getButtonTypeClasses(i.type);return cn(n,s,a,i.class)});return(n,s)=>(openBlock(),createBlock(unref(script),mergeProps(n.$attrs,{unstyled:"",class:o.value,disabled:n.disabled,onClick:n.onClick}),{default:withCtx(()=>[createBaseVNode("span",null,toDisplayString(n.label),1)]),_:1},16,["class","disabled","onClick"]))}}),zAsset=z.object({id:z.string(),name:z.string(),asset_hash:z.string().nullish(),size:z.number().optional(),mime_type:z.string().nullish(),tags:z.array(z.string()).optional().default([]),preview_id:z.string().nullable().optional(),preview_url:z.string().optional(),created_at:z.string(),updated_at:z.string().optional(),last_access_time:z.string().optional(),user_metadata:z.record(z.unknown()).optional()}),zAssetResponse=z.object({assets:z.array(zAsset).optional(),total:z.number().optional(),has_more:z.boolean().optional()});z.object({name:z.string(),folders:z.array(z.string())});z.object({name:z.string(),pathIndex:z.number()});const zValidationError=z.object({code:z.string(),message:z.string(),field:z.string()}),zValidationResult=z.object({is_valid:z.boolean(),errors:z.array(zValidationError).optional(),warnings:z.array(zValidationError).optional()});z.object({content_length:z.number(),final_url:z.string(),content_type:z.string().optional(),filename:z.string().optional(),name:z.string().optional(),tags:z.array(z.string()).optional(),preview_url:z.string().optional(),validation:zValidationResult.optional()});z.string().min(1,"Filename cannot be empty").regex(/^[^\\:*?"<>|]+$/,"Invalid filename characters").regex(/^(?!\/|.*\.\.)/,"Path must not start with / or contain ..").trim();const assetItemSchema=zAsset,assetResponseSchema=zAssetResponse;class ModelNodeProvider{static{p(this,"ModelNodeProvider")}nodeDef;key;constructor(o,n){this.nodeDef=o,this.key=n}}const useModelToNodeStore=defineStore("modelToNode",()=>{const i=ref({}),o=useNodeDefStore(),n=ref(!1),s=computed(()=>Object.fromEntries(Object.values(i.value).flat().filter(b=>!!b.nodeDef).map(b=>[b.nodeDef.name,b.key]))),a=computed(()=>{const b={};for(const[w,k]of Object.entries(i.value))for(const S of k)S.nodeDef&&(b[S.nodeDef.name]||(b[S.nodeDef.name]=w));return b});function r(){return y(),s.value}p(r,"getRegisteredNodeTypes");function l(b){if(y(),!(!b||typeof b!="string"))return a.value[b]}p(l,"getCategoryForNodeType");function u(b){return y(),i.value[b]?.[0]}p(u,"getNodeProvider");function m(b){return y(),i.value[b]??[]}p(m,"getAllNodeProviders");function f(b,w){y(),w.nodeDef&&(i.value[b]||(i.value[b]=[]),i.value[b].push(w))}p(f,"registerNodeProvider");function _(b,w,k){f(b,new ModelNodeProvider(o.nodeDefsByName[w],k))}p(_,"quickRegister");function y(){n.value||Object.keys(o.nodeDefsByName).length!==0&&(n.value=!0,_("checkpoints","CheckpointLoaderSimple","ckpt_name"),_("checkpoints","ImageOnlyCheckpointLoader","ckpt_name"),_("loras","LoraLoader","lora_name"),_("loras","LoraLoaderModelOnly","lora_name"),_("vae","VAELoader","vae_name"),_("controlnet","ControlNetLoader","control_net_name"),_("diffusion_models","UNETLoader","unet_name"),_("upscale_models","UpscaleModelLoader","model_name"),_("style_models","StyleModelLoader","style_model_name"),_("gligen","GLIGENLoader","gligen_name"),_("clip_vision","CLIPVisionLoader","clip_name"),_("text_encoders","CLIPLoader","clip_name"),_("audio_encoders","AudioEncoderLoader","audio_encoder_name"),_("model_patches","ModelPatchLoader","name"),_("animatediff_models","ADE_LoadAnimateDiffModel","model_name"),_("animatediff_motion_lora","ADE_AnimateDiffLoRALoader","name"))}return p(y,"registerDefaults"),{modelToNodeMap:i,getRegisteredNodeTypes:r,getCategoryForNodeType:l,getNodeProvider:u,getAllNodeProviders:m,registerNodeProvider:f,quickRegister:_,registerDefaults:y}});function getLocalizedErrorMessage(i){return{FILE_TOO_LARGE:st("assetBrowser.errorFileTooLarge","File too large"),FORMAT_NOT_ALLOWED:st("assetBrowser.errorFormatNotAllowed","Format not allowed"),UNSAFE_PICKLE_SCAN:st("assetBrowser.errorUnsafePickleScan","Unsafe pickle scan"),UNSAFE_VIRUS_SCAN:st("assetBrowser.errorUnsafeVirusScan","Unsafe virus scan"),MODEL_TYPE_NOT_SUPPORTED:st("assetBrowser.errorModelTypeNotSupported","Model type not supported")}[i]||st("assetBrowser.errorUnknown","Unknown error")||"Unknown error"}p(getLocalizedErrorMessage,"getLocalizedErrorMessage");const ASSETS_ENDPOINT="/assets",EXPERIMENTAL_WARNING=`EXPERIMENTAL: If you are seeing this please make sure "Comfy.Assets.UseAssetAPI" is set to "false" in your ComfyUI Settings.
`,DEFAULT_LIMIT=500,MODELS_TAG="models",MISSING_TAG="missing";function validateAssetResponse(i){const o=assetResponseSchema.safeParse(i);if(o.success)return o.data;const n=fromZodError(o.error);throw new Error(`${EXPERIMENTAL_WARNING}Invalid asset response against zod schema:
${n}`)}p(validateAssetResponse,"validateAssetResponse");function createAssetService(){async function i(_,y){const b=await api.fetchApi(_);if(!b.ok)throw new Error(`${EXPERIMENTAL_WARNING}Unable to load ${y}: Server returned ${b.status}. Please try again.`);const w=await b.json();return validateAssetResponse(w)}p(i,"handleAssetRequest");async function o(){const _=await i(`${ASSETS_ENDPOINT}?include_tags=${MODELS_TAG}&limit=${DEFAULT_LIMIT}`,"model folders"),y=new Set(["configs"]),b=new Set(_?.assets?.filter(k=>!k.tags.includes(MISSING_TAG))?.flatMap(k=>k.tags)?.filter(k=>k!==MODELS_TAG&&!y.has(k))??[]);return Array.from(b).toSorted().map(k=>({name:k,folders:[]}))}p(o,"getAssetModelFolders");async function n(_){return(await i(`${ASSETS_ENDPOINT}?include_tags=${MODELS_TAG},${_}&limit=${DEFAULT_LIMIT}`,`models for ${_}`))?.assets?.filter(b=>!b.tags.includes(MISSING_TAG)&&b.tags.includes(_))?.map(b=>({name:b.name,pathIndex:0}))??[]}p(n,"getAssetModels");function s(_,y){return!_||!y?!1:useModelToNodeStore().getRegisteredNodeTypes()[_]===y}p(s,"isAssetBrowserEligible");async function a(_){if(!_||typeof _!="string")return[];const b=useModelToNodeStore().getCategoryForNodeType(_);return b?(await i(`${ASSETS_ENDPOINT}?include_tags=${MODELS_TAG},${b}&limit=${DEFAULT_LIMIT}`,`assets for ${_}`))?.assets?.filter(k=>!k.tags.includes(MISSING_TAG)&&k.tags.includes(b))??[]:[]}p(a,"getAssetsForNodeType");async function r(_){const y=await api.fetchApi(`${ASSETS_ENDPOINT}/${_}`);if(!y.ok)throw new Error(`${EXPERIMENTAL_WARNING}Unable to load asset details for ${_}: Server returned ${y.status}. Please try again.`);const b=await y.json(),w=assetResponseSchema.safeParse({assets:[b]});if(w.success&&w.data.assets?.[0])return w.data.assets[0];const k=w.error?fromZodError(w.error):"Unknown validation error";throw new Error(`${EXPERIMENTAL_WARNING}Invalid asset response against zod schema:
${k}`)}p(r,"getAssetDetails");async function l(_,y=!0,{limit:b=DEFAULT_LIMIT,offset:w=0}={}){const k=new URLSearchParams({include_tags:_,limit:b.toString(),include_public:y?"true":"false"});return w>0&&k.set("offset",w.toString()),(await i(`${ASSETS_ENDPOINT}?${k.toString()}`,`assets for tag ${_}`))?.assets?.filter(C=>!C.tags.includes(MISSING_TAG))??[]}p(l,"getAssetsByTag");async function u(_){const y=await api.fetchApi(`${ASSETS_ENDPOINT}/${_}`,{method:"DELETE"});if(!y.ok)throw new Error(`Unable to delete asset ${_}: Server returned ${y.status}`)}p(u,"deleteAsset");async function m(_){const y=encodeURIComponent(_),b=await api.fetchApi(`${ASSETS_ENDPOINT}/remote-metadata?url=${y}`);if(!b.ok){const k=await b.json().catch(()=>({}));throw new Error(getLocalizedErrorMessage(k.code||"UNKNOWN_ERROR"))}const w=await b.json();if(w.validation?.is_valid===!1)throw new Error(getLocalizedErrorMessage(w.validation?.errors?.[0]?.code||"UNKNOWN_ERROR"));return w}p(m,"getAssetMetadata");async function f(_){const y=await api.fetchApi(ASSETS_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});if(!y.ok)throw new Error(st("assetBrowser.errorUploadFailed","Failed to upload asset. Please try again."));return await y.json()}return p(f,"uploadAssetFromUrl"),{getAssetModelFolders:o,getAssetModels:n,isAssetBrowserEligible:s,getAssetsForNodeType:a,getAssetDetails:r,getAssetsByTag:l,deleteAsset:u,getAssetMetadata:m,uploadAssetFromUrl:f}}p(createAssetService,"createAssetService");const assetService=createAssetService(),useDialogStore=defineStore("dialog",()=>{const i=ref([]),o=ref(null),n=p(()=>`dialog-${Math.random().toString(36).slice(2,9)}`,"genDialogKey");function s(y){const b=i.value.findIndex(w=>w.priority<=y.priority);i.value.splice(b===-1?i.value.length:b,0,y)}p(s,"insertDialogByPriority");function a(y){const b=y.key,w=i.value.findIndex(k=>k.key===b);if(w!==-1){const[k]=i.value.splice(w,1);s(k),o.value=b,u()}}p(a,"riseDialog");function r(y){const b=y?i.value.find(k=>k.key===y.key):i.value.find(k=>k.key===o.value);if(!b)return;b.dialogComponentProps?.onClose?.();const w=i.value.indexOf(b);i.value.splice(w,1),o.value=i.value.length>0?i.value[i.value.length-1].key:null,u()}p(r,"closeDialog");function l(y){i.value.length>=10&&i.value.shift();const b={key:y.key,visible:!0,title:y.title,headerComponent:y.headerComponent?markRaw(y.headerComponent):void 0,footerComponent:y.footerComponent?markRaw(y.footerComponent):void 0,component:markRaw(y.component),contentProps:{...y.props},footerProps:{...y.footerProps},priority:y.priority??1,dialogComponentProps:{maximizable:!1,modal:!0,closable:!0,closeOnEscape:!0,dismissableMask:!0,...y.dialogComponentProps,maximized:!1,onMaximize:p(()=>{b.dialogComponentProps.maximized=!0},"onMaximize"),onUnmaximize:p(()=>{b.dialogComponentProps.maximized=!1},"onUnmaximize"),onAfterHide:p(()=>{r(b)},"onAfterHide"),pt:merge(y.dialogComponentProps?.pt||{},{root:{onMousedown:p(()=>{a(b)},"onMousedown")}})}};return s(b),o.value=y.key,u(),b}p(l,"createDialog");function u(){const y=i.value.find(w=>w.key===o.value),b=y?.dialogComponentProps.closable;i.value.forEach(w=>{w.dialogComponentProps={...w.dialogComponentProps,closeOnEscape:w===y&&!!b}})}p(u,"updateCloseOnEscapeStates");function m(y){const b=y.key||n();let w=i.value.find(k=>k.key===b);return w?(w.visible=!0,a(w)):w=l({...y,key:b}),w}p(m,"showDialog");function f(y){const{key:b}=y;if(!b){console.error("Extension dialog key is required");return}const w=b.startsWith("extension-")?b:`extension-${b}`,k=i.value.find(S=>S.key===w);return k?(k.visible=!0,a(k),k):l({...y,key:w})}p(f,"showExtensionDialog");function _(y){return i.value.some(b=>b.key===y)}return p(_,"isDialogOpen"),{dialogStack:i,riseDialog:a,showDialog:m,closeDialog:r,showExtensionDialog:f,isDialogOpen:_,activeKey:o}});function getAssetType$1(i){return i?.[0]==="output"?"output":"input"}p(getAssetType$1,"getAssetType$1");function mapTaskOutputToAssetItem(i,o){const n={promptId:i.promptId,nodeId:o.nodeId,subfolder:o.subfolder,executionTimeInSeconds:i.executionTimeInSeconds,format:o.format,workflow:i.workflow,create_time:i.createTime};return{id:i.promptId,name:o.filename,size:0,created_at:i.executionStartTimestamp?new Date(i.executionStartTimestamp).toISOString():new Date().toISOString(),tags:["output"],preview_url:o.url,user_metadata:n}}p(mapTaskOutputToAssetItem,"mapTaskOutputToAssetItem");function mapInputFileToAssetItem(i,o,n="input"){return{id:`${n}-${o}-${i}`,name:i,size:0,created_at:new Date().toISOString(),tags:[n],preview_url:api.apiURL(`/view?filename=${encodeURIComponent(i)}&type=${n}`)}}p(mapInputFileToAssetItem,"mapInputFileToAssetItem");async function fetchInputFilesFromAPI(){const i=await fetch(api.internalURL("/files/input"),{headers:{"Comfy-User":api.user}});if(!i.ok)throw new Error("Failed to fetch input files");return(await i.json()).map((n,s)=>mapInputFileToAssetItem(n,s,"input"))}p(fetchInputFilesFromAPI,"fetchInputFilesFromAPI");function mapHistoryToAssets(i){const o=[];for(const n of i){if(n.taskType!=="History"||!n.outputs||!n.status||n.status?.status_str==="error")continue;const s=new TaskItemImpl("History",n.prompt,n.status,n.outputs);if(!s.previewOutput)continue;const a=mapTaskOutputToAssetItem(s,s.previewOutput),r=s.flatOutputs.filter(l=>l.supportsPreview);a.user_metadata={...a.user_metadata,outputCount:r.length,allOutputs:r},o.push(a)}return o.sort((n,s)=>new Date(s.created_at).getTime()-new Date(n.created_at).getTime())}p(mapHistoryToAssets,"mapHistoryToAssets");const BATCH_SIZE=200,MAX_HISTORY_ITEMS=1e3,useAssetsStore=defineStore("assets",()=>{const i=ref(0),o=ref(!0),n=ref(!1),s=ref([]),a=shallowReactive(new Set),r=fetchInputFilesFromAPI,{state:l,isLoading:u,error:m,execute:f}=useAsyncState(r,[],{immediate:!1,resetOnExecute:!1,onError:p(D=>{console.error("Error fetching input assets:",D)},"onError")}),_=p(async(D=!1)=>{D||(i.value=0,o.value=!0,s.value=[],a.clear());const O=await api.getHistory(BATCH_SIZE,{offset:i.value}),M=mapHistoryToAssets(O.History);if(D)for(const P of M){if(a.has(P.id))continue;a.add(P.id);const R=new Date(P.created_at).getTime(),V=s.value.findIndex($=>new Date($.created_at).getTime()<R);V===-1?s.value.push(P):s.value.splice(V,0,P)}else s.value=M,M.forEach(P=>a.add(P.id));if(i.value+=BATCH_SIZE,o.value=O.History.length===BATCH_SIZE,s.value.length>MAX_HISTORY_ITEMS){const P=s.value.slice(MAX_HISTORY_ITEMS);s.value=s.value.slice(0,MAX_HISTORY_ITEMS),P.forEach(R=>a.delete(R.id))}return s.value},"fetchHistoryAssets"),y=ref([]),b=ref(!1),w=ref(null),k=p(async()=>{b.value=!0,w.value=null;try{await _(!1),y.value=s.value}catch(D){console.error("Error fetching history assets:",D),w.value=D,y.value.length||(y.value=[])}finally{b.value=!1}},"updateHistory"),S=p(async()=>{if(!(!o.value||n.value)){n.value=!0,w.value=null;try{await _(!0),y.value=s.value}catch(D){console.error("Error loading more history:",D),w.value=D,y.value.length||(y.value=[])}finally{n.value=!1}}},"loadMoreHistory"),C=computed(()=>{const D=new Map;for(const O of l.value)O.asset_hash&&D.set(O.asset_hash,O);return D});function I(D){return C.value.get(D)?.name??D}p(I,"getInputName");const T=p(()=>({modelAssetsByNodeType:shallowReactive(new Map),modelLoadingByNodeType:shallowReactive(new Map),modelErrorByNodeType:shallowReactive(new Map),updateModelsForNodeType:p(async()=>[],"updateModelsForNodeType")}),"getModelState"),{modelAssetsByNodeType:E,modelLoadingByNodeType:N,modelErrorByNodeType:L,updateModelsForNodeType:A}=T();return{inputAssets:l,historyAssets:y,inputLoading:u,historyLoading:b,inputError:m,historyError:w,hasMoreHistory:o,isLoadingMore:n,updateInputs:f,updateHistory:k,loadMoreHistory:S,inputAssetsByFilename:C,getInputName:I,modelAssetsByNodeType:E,modelLoadingByNodeType:N,modelErrorByNodeType:L,updateModelsForNodeType:A}}),MAX_RETRIES$1=5,TIMEOUT=4096;async function getAuthHeaders(){return{}}p(getAuthHeaders,"getAuthHeaders");const dataCache=new Map,createCacheKey=p(i=>{const{route:o,query_params:n={},refresh:s=0}=i,a=Object.entries(n).sort(([r],[l])=>r.localeCompare(l)).map(([r,l])=>`${r}=${l}`).join("&");return[o,`r=${s}`,a].join(";")},"createCacheKey"),getBackoff=p(i=>Math.min(1e3*Math.pow(2,i),512),"getBackoff"),isInitialized=p(i=>i?.data&&i?.timestamp&&i.timestamp>0,"isInitialized"),isStale=p((i,o)=>i?.timestamp&&Date.now()-i.timestamp>=o,"isStale"),isFetching=p(i=>i?.fetchPromise!==void 0,"isFetching"),isFailed=p(i=>i?.failed===!0,"isFailed"),isBackingOff=p(i=>i?.error&&i?.lastErrorTime&&Date.now()-i.lastErrorTime<getBackoff(i.retryCount||0),"isBackingOff"),fetchData=p(async(i,o)=>{const{route:n,response_key:s,query_params:a,timeout:r=TIMEOUT}=i,l=await getAuthHeaders(),u=await axios.get(n,{params:a,signal:o.signal,timeout:r,...l});return s?u.data[s]:u.data},"fetchData");function useRemoteWidget(i){const{remoteConfig:o,defaultValue:n,node:s,widget:a}=i,{refresh:r=0,max_retries:l=MAX_RETRIES$1}=o,u=r<=0,m=createCacheKey(o);let f=!1,_=!1;const y=p((D,O)=>{D.retryCount=0,D.lastErrorTime=0,D.error=null,D.timestamp=Date.now(),D.data=O??n},"setSuccess"),b=p((D,O)=>{D.retryCount=(D.retryCount||0)+1,D.lastErrorTime=Date.now(),D.error=O instanceof Error?O:new Error(String(O)),D.data??=n,D.fetchPromise=void 0,D.retryCount>=l&&w(D)},"setError"),w=p(D=>{dataCache.set(m,{data:D.data??n,failed:!0})},"setFailed"),k=p(()=>!f&&isInitialized(dataCache.get(m)),"isFirstLoad"),S=p(D=>{f=!0,a.value=D[0],a.callback?.(a.value),s.graph?.setDirtyCanvas(!0)},"onFirstLoad"),C=p(async()=>{const D=dataCache.get(m);if(isFailed(D)||isInitialized(D)&&(u||!isStale(D,r))||isBackingOff(D)||isFetching(D))return D.data;const M=D||{data:n};dataCache.set(m,M);try{M.controller=new AbortController,M.fetchPromise=fetchData(o,M.controller);const P=await M.fetchPromise;return y(M,P),M.data}catch(P){return b(M,P),M.data}finally{M.fetchPromise=void 0,M.controller=void 0}},"fetchValue"),I=p(()=>{if(o.control_after_refresh){const D=E();if(!Array.isArray(D))return;switch(o.control_after_refresh){case"first":a.value=D[0]??n;break;case"last":a.value=D.at(-1)??n;break}a.callback?.(a.value),s.graph?.setDirtyCanvas(!0)}},"onRefresh"),T=p(()=>{const D=dataCache.get(m);D&&(D.fetchPromise&&D.controller?.abort(),dataCache.delete(m))},"clearCachedValue");function E(){return dataCache.get(m)?.data}p(E,"getCachedValue");function N(D){return C().then(O=>{k()&&S(O),_&&O!==n&&(I(),_=!1),D?.()}).catch(O=>{console.error(O)}),E()??n}p(N,"getValue"),a.refresh=function(){_=!0,T(),N()};function L(){s.addWidget("button","refresh","refresh",a.refresh)}p(L,"addRefreshButton");function A(){let D=!1;const O=p(()=>{D&&a.refresh&&a.refresh()},"handleExecutionSuccess"),M=s.addWidget("toggle","Auto-refresh after generation",!1,P=>{D=P},{serialize:!1});return api.addEventListener("execution_success",O),s.onRemoved=useChainCallback(s.onRemoved,function(){api.removeEventListener("execution_success",O)}),M}return p(A,"addAutoRefreshToggle"),A(),{getCachedValue:E,getValue:N,refreshValue:a.refresh,addRefreshButton:L,getCacheEntry:p(()=>dataCache.get(m),"getCacheEntry"),cacheKey:m}}p(useRemoteWidget,"useRemoteWidget");const getDefaultValue=p(i=>{if(i.default)return i.default;if(i.options?.length)return i.options[0];if(i.remote)return"Loading..."},"getDefaultValue"),addMultiSelectWidget=p((i,o)=>{const n=ref([]),s=new ComponentWidgetImpl({node:i,name:o.name,component:_sfc_main$2E,inputSpec:o,options:{getValue:p(()=>n.value,"getValue"),setValue:p(a=>{n.value=a},"setValue")}});return addWidget(i,s),s},"addMultiSelectWidget"),addComboWidget=p((i,o)=>{const n=getDefaultValue(o),s=i.addWidget("combo",o.name,n,()=>{},{values:o.options??[]});if(o.remote){if(!isComboWidget(s))throw new Error(`Expected combo widget but received ${s.type}`);const a=useRemoteWidget({remoteConfig:o.remote,defaultValue:n,node:i,widget:s});o.remote.refresh_button&&a.addRefreshButton();const r=s.options;s.options=new Proxy(r,{get(l,u){return u!=="values"?l[u]:a.getValue()}})}if(o.control_after_generate){if(!isComboWidget(s))throw new Error(`Expected combo widget but received ${s.type}`);s.linkedWidgets=addValueControlWidgets(i,s,void 0,void 0,transformInputSpecV2ToV1(o))}return s},"addComboWidget"),useComboWidget=p(()=>p((o,n)=>{if(!isComboInputSpec(n))throw new Error(`Invalid input data: ${n}`);return n.multi_select?addMultiSelectWidget(o,n):addComboWidget(o,n)},"widgetConstructor"),"useComboWidget");function onFloatValueChange(i){const o=this.options.round;if(o){const n=this.options.precision??Math.max(0,-Math.floor(Math.log10(o))),s=Math.round(i/o)*o;this.value=clamp(Number(s.toFixed(n)),this.options.min??-1/0,this.options.max??1/0)}else this.value=i}p(onFloatValueChange,"onFloatValueChange");const useFloatWidget=p(()=>p((o,n)=>{if(!isFloatInputSpec(n))throw new Error(`Invalid input data: ${n}`);const s=useSettingStore(),a=!s.get("Comfy.DisableSliders"),r=n.display,l=a&&r=="slider"?"slider":r=="knob"?"knob":"number",u=n.step??.5,m=s.get("Comfy.FloatRoundingPrecision")||Math.max(0,-Math.floor(Math.log10(u))),f=!s.get("Comfy.DisableFloatRounding"),_=n.default??0;return o.addWidget(l,n.name,_,onFloatValueChange,{min:n.min??0,max:n.max??2048,round:f&&m&&!n.round?Math.pow(10,-m):n.round,step:u*10,step2:u,precision:m})},"widgetConstructor"),"useFloatWidget"),useGalleriaWidget=p(()=>(i,o)=>{const{name:n,options:s={}}=o;return i.addWidget("galleria",n,s.images||[],()=>{},{serialize:!0,...s})},"useGalleriaWidget"),useImageCompareWidget=p(()=>(i,o)=>{const{name:n,options:s={}}=o;return i.addWidget("imagecompare",n,["",""],()=>{},{serialize:!0,...s})},"useImageCompareWidget"),_hoisted_1$27={class:"relative max-h-[200px] min-h-[28px] w-full overflow-y-auto rounded-lg px-4 py-2 text-xs"},_hoisted_2$1C={class:"flex items-center gap-2"},_hoisted_3$16={class:"flex flex-1 items-center gap-2 break-all"},_hoisted_4$N=["innerHTML"],_sfc_main$2z=defineComponent({__name:"TextPreviewWidget",props:mergeModels({widget:{},nodeId:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const o=useModel(i,"modelValue"),n=i,s=useExecutionStore(),a=ref(!0),r=computed(()=>{const m=o.value,f=[],_=m.replace(/\[\[([^|\]]+)\|([^\]]+)\]\]/g,(b,w,k)=>(f.push({label:String(w),url:String(k)}),`__LNK${f.length-1}__`));let y=nl2br(linkifyHtml(_));return y=y.replace(/__LNK(\d+)__/g,(b,w)=>{const{label:k,url:S}=f[+w],C=S.replace(/"/g,"&quot;"),I=k.replace(/</g,"&lt;").replace(/>/g,"&gt;");return/^https?:\/\//i.test(S)?`<a href="${C}" target="_blank" rel="noopener noreferrer">${I}</a>`:I}),y});let l=null;onMounted(()=>{l=n.nodeId});const u=watch([()=>s.executingNodeIds,()=>s.isIdle],()=>{if(s.isIdle){a.value=!1,u();return}l&&!s.executingNodeIds.includes(l)&&(a.value=!1,u()),!l&&s.executingNodeIds.length>0&&(l=s.executingNodeIds[0])});return(m,f)=>(openBlock(),createElementBlock("div",_hoisted_1$27,[createBaseVNode("div",_hoisted_2$1C,[createBaseVNode("div",_hoisted_3$16,[createBaseVNode("span",{innerHTML:r.value},null,8,_hoisted_4$N),a.value?(openBlock(),createBlock(unref(script$4),{key:0,class:"h-4! flex-1!"})):createCommentVNode("",!0)])])]))}}),PADDING=16;function useTextPreviewWidget(i={}){function o(n,s){const a=ref(""),r=new ComponentWidgetImpl({node:n,name:s.name,component:_sfc_main$2z,inputSpec:s,props:{nodeId:n.id},options:{getValue:p(()=>a.value,"getValue"),setValue:p(l=>{a.value=typeof l=="string"?l:String(l)},"setValue"),getMinHeight:p(()=>i.minHeight??42+PADDING,"getMinHeight"),serialize:!1,read_only:!0},type:s.type});return addWidget(n,r),r}return p(o,"widgetConstructor"),o}p(useTextPreviewWidget,"useTextPreviewWidget");const TEXT_PREVIEW_WIDGET_NAME="$$node-text-preview";function useNodeProgressText(){const i=useTextPreviewWidget(),o=p(r=>r.widgets?.find(l=>l.name===TEXT_PREVIEW_WIDGET_NAME),"findTextPreviewWidget"),n=p(r=>i(r,{name:TEXT_PREVIEW_WIDGET_NAME,type:"progressText"}),"addTextPreviewWidget");function s(r,l){const u=o(r)??n(r);u.value=l,r.setDirtyCanvas?.(!0)}p(s,"showTextPreview");function a(r){if(!r.widgets)return;const l=r.widgets.findIndex(u=>u.name===TEXT_PREVIEW_WIDGET_NAME);l>-1&&(r.widgets[l].onRemove?.(),r.widgets.splice(l,1))}return p(a,"removeTextPreview"),{showTextPreview:s,removeTextPreview:a}}p(useNodeProgressText,"useNodeProgressText");const subgraphNodeIdToSubgraph=p((i,o)=>{const n=o.getNodeById(i);if(n?.isSubgraphNode())return n.subgraph},"subgraphNodeIdToSubgraph");function getSubgraphsFromInstanceIds(i,o,n=[]){if(o.length===1)return n;const s=o.shift();if(s===void 0)return n;const a=subgraphNodeIdToSubgraph(s,i);if(!a){console.warn(`Subgraph not found: ${s}`);return}return n.push(a),getSubgraphsFromInstanceIds(a,o,n)}p(getSubgraphsFromInstanceIds,"getSubgraphsFromInstanceIds");function executionIdToNodeLocatorId(i){const o=String(i);if(!o.includes(":"))return o;const n=o.split(":"),s=n[n.length-1],a=getSubgraphsFromInstanceIds(app$1.graph,n);return a?createNodeLocatorId(a.at(-1).id,s):void 0}p(executionIdToNodeLocatorId,"executionIdToNodeLocatorId");const useExecutionStore=defineStore("execution",()=>{const i=useWorkflowStore(),o=useCanvasStore(),n=ref(null),s=ref(null),a=ref({}),r=ref(null),l=ref(null),u=ref({}),m=ref({}),f=ref(new Map),_=ref(new Set),y=p((oe,se)=>{if(oe===void 0)return se;const he={...oe};if(he.state==="error")return he;if(se.state==="running"){const be=se.max>0?se.value/se.max:0,Se=he.max>0?he.value/he.max:0;(he.state!=="running"||Se===0||be<Se)&&(he.value=se.value,he.max=se.max),he.state="running"}return he},"mergeExecutionProgressStates"),b=computed(()=>{const oe={},se=u.value;for(const he of Object.values(se)){const be=String(he.display_node_id).split(":");for(let Se=0;Se<be.length;Se++){const me=be.slice(0,Se+1).join(":"),fe=executionIdToNodeLocatorId(me);fe&&(oe[fe]=y(oe[fe],he))}}return oe}),w=computed(()=>Object.entries(u.value).filter(([oe,se])=>se.state==="running").map(([oe,se])=>oe)),k=computed(()=>w.value[0]??null),S=computed(()=>new Set(w.value.map(String))),C=computed(()=>{if(!k.value)return null;const oe=E.value?.workflow;if(!oe)return null;const se=oe.changeTracker?.activeState??null;return se?se.nodes.find(he=>String(he.id)===k.value)??null:null}),I=ref(null),T=computed(()=>I.value?I.value.value/I.value.max:null),E=computed(()=>a.value[s.value??""]),N=computed(()=>E.value?Object.values(E.value.nodes).length:0),L=computed(()=>!s.value),A=computed(()=>E.value?Object.values(E.value.nodes).filter(Boolean).length:0),D=computed(()=>{if(!E.value)return 0;const oe=N.value,se=A.value;return oe>0?se/oe:0}),O=computed(()=>{const oe=l.value;return oe?executionIdToNodeLocatorId(String(oe.node_id)):null}),M=computed(()=>{const oe=O.value;if(!oe)return null;const se=i.nodeLocatorIdToNodeId(oe);return se!=null?String(se):null});function P(){api.addEventListener("notification",q),api.addEventListener("execution_start",V),api.addEventListener("execution_cached",$),api.addEventListener("execution_interrupted",F),api.addEventListener("execution_success",U),api.addEventListener("executed",j),api.addEventListener("executing",G),api.addEventListener("progress",W),api.addEventListener("progress_state",H),api.addEventListener("status",X),api.addEventListener("execution_error",Q),api.addEventListener("progress_text",ue)}p(P,"bindExecutionEvents");function R(){api.removeEventListener("notification",q),api.removeEventListener("execution_start",V),api.removeEventListener("execution_cached",$),api.removeEventListener("execution_interrupted",F),api.removeEventListener("execution_success",U),api.removeEventListener("executed",j),api.removeEventListener("executing",G),api.removeEventListener("progress",W),api.removeEventListener("progress_state",H),api.removeEventListener("status",X),api.removeEventListener("execution_error",Q),api.removeEventListener("progress_text",ue)}p(R,"unbindExecutionEvents");function V(oe){l.value=null,s.value=oe.detail.prompt_id,a.value[s.value]??={nodes:{}},ee(s.value)}p(V,"handleExecutionStart");function $(oe){if(E.value)for(const se of oe.detail.nodes)E.value.nodes[se]=!0}p($,"handleExecutionCached");function F(oe){const se=oe.detail.prompt_id;s.value&&ee(s.value),ae(se)}p(F,"handleExecutionInterrupted");function j(oe){E.value&&(E.value.nodes[oe.detail.node]=!0)}p(j,"handleExecuted");function U(oe){const se=oe.detail.prompt_id;ae(se)}p(U,"handleExecutionSuccess");function G(oe){I.value=null,E.value&&typeof oe.detail!="string"&&(s.value&&delete a.value[s.value],s.value=null)}p(G,"handleExecuting");function H(oe){const{nodes:se,prompt_id:he}=oe.detail,be=m.value[he]||{};for(const Se in se)if(se[Se].state==="running"&&!be[Se]){const{revokePreviewsByExecutionId:fe}=useNodeOutputStore();fe(Se)}if(m.value={...m.value,[he]:se},u.value=se,k.value&&se[k.value]){const Se=se[k.value];I.value={value:Se.value,max:Se.max,prompt_id:Se.prompt_id,node:Se.display_node_id||Se.node_id}}}p(H,"handleProgressState");function W(oe){I.value=oe.detail}p(W,"handleProgress");function X(){api.clientId&&(n.value=api.clientId,api.removeEventListener("status",X))}p(X,"handleStatus");function Q(oe){l.value=oe.detail;const se=oe.detail?.prompt_id;oe.detail?.prompt_id&&ee(oe.detail.prompt_id),ae(se)}p(Q,"handleExecutionError");function q(oe){const se=oe.detail,he=se?.value||"",be=se?.id?se.id:"";if(be&&he.includes("Waiting for a machine")){const Se=new Set(_.value);Se.add(be),_.value=Se}}p(q,"handleNotification");function ee(oe){if(!oe||!_.value.has(oe))return;const se=new Set(_.value);se.delete(oe),_.value=se}p(ee,"clearInitializationByPromptId");function Y(oe){return oe?_.value.has(String(oe)):!1}p(Y,"isPromptInitializing");function ae(oe){u.value={};const se=oe??s.value??null;if(se){const he={...m.value};delete he[se],m.value=he}s.value&&delete a.value[s.value],s.value=null,I.value=null}p(ae,"resetExecutionState");function re(oe){const se=String(oe);return se.includes(":")?i.executionIdToCurrentId(se):se}p(re,"getNodeIdIfExecuting");function ue(oe){const{nodeId:se,text:he}=oe.detail;if(!he||!se)return;const be=re(se),Se=o.getCanvas().graph?.getNodeById(be);Se&&useNodeProgressText().showTextPreview(Se,he)}p(ue,"handleProgressText");function K({nodes:oe,id:se,workflow:he}){a.value[se]??={nodes:{}};const be=a.value[se];be.nodes={...oe.reduce((me,fe)=>(me[fe]=!1,me),{}),...be.nodes},be.workflow=he;const Se=he?.activeState?.id??he?.initialState?.id;Se&&f.value.set(String(se),String(Se))}p(K,"storePrompt");function ne(oe,se){!oe||!se||f.value.set(String(oe),String(se))}p(ne,"registerPromptWorkflowIdMapping");const de=p(oe=>i.nodeLocatorIdToNodeExecutionId(oe),"nodeLocatorIdToExecutionId"),ve=computed(()=>{const oe=[];for(const[se,he]of Object.entries(m.value))Object.values(he).some(be=>be.state==="running")&&oe.push(se);return oe}),_e=computed(()=>ve.value.length);return{isIdle:L,clientId:n,activePromptId:s,queuedPrompts:a,lastNodeErrors:r,lastExecutionError:l,lastExecutionErrorNodeId:M,executingNodeId:k,executingNodeIds:w,activePrompt:E,totalNodesToExecute:N,nodesExecuted:A,executionProgress:D,executingNode:C,executingNodeProgress:T,nodeProgressStates:u,nodeLocationProgressStates:b,nodeProgressStatesByPrompt:m,runningPromptIds:ve,runningWorkflowCount:_e,initializingPromptIds:_,isPromptInitializing:Y,bindExecutionEvents:P,unbindExecutionEvents:R,storePrompt:K,registerPromptWorkflowIdMapping:ne,uniqueExecutingNodeIdStrings:S,_executingNodeProgress:I,executionIdToNodeLocatorId,nodeLocatorIdToExecutionId:de,promptIdToWorkflowId:f}});function isImageNode(i){return i?i.previewMediaType==="image"||i.previewMediaType!=="video"&&!!i.imgs?.length:!1}p(isImageNode,"isImageNode");function isVideoNode(i){return i?i.previewMediaType==="video"||!!i.videoContainer:!1}p(isVideoNode,"isVideoNode");function isAudioNode(i){return!!i&&i.previewMediaType==="audio"}p(isAudioNode,"isAudioNode");function addToComboValues(i,o){i.options||(i.options={values:[]}),i.options.values||(i.options.values=[]),i.options.values.includes(o)||i.options.values.push(o)}p(addToComboValues,"addToComboValues");const isLGraphNode=p(i=>i instanceof LGraphNode,"isLGraphNode"),isLGraphGroup=p(i=>i instanceof LGraphGroup,"isLGraphGroup"),isReroute=p(i=>i instanceof Reroute,"isReroute"),getItemsColorOption=p(i=>{const o=toolkit.filter(i,isColorable);if(toolkit.isEmpty(o))return null;const n=toolkit.map(o,s=>s.getColorOption());return toolkit.every(n,s=>toolkit.isEqual(s,toolkit.head(n)))?toolkit.head(n):null},"getItemsColorOption");function executeWidgetsCallback(i,o){for(const n of i)for(const s of n.widgets??[])s[o]?.()}p(executeWidgetsCallback,"executeWidgetsCallback");function migrateWidgetsValues(i,o,n){const s=new Set(o.map(l=>l.name)),a=Object.values(i).filter(l=>s.has(l.name)||l.forceInput);return toolkit.sum(a.map(l=>l.control_after_generate||["seed","noise_seed"].includes(l.name)?2:1))===n?.length?toolkit.zip(a,n).filter(([l])=>!l?.forceInput).map(([l,u])=>u):n}p(migrateWidgetsValues,"migrateWidgetsValues");function fixLinkInputSlots(i){for(const o of i.nodes){for(const[n,s]of o.inputs.entries()){const a=s.link;if(!a)continue;const r=i.links.get(a);r&&(r.target_slot=n)}o.isSubgraphNode?.()&&o.subgraph&&fixLinkInputSlots(o.subgraph)}}p(fixLinkInputSlots,"fixLinkInputSlots");function compressWidgetInputSlots(i){for(const o of i.nodes){o.inputs=o.inputs?.filter(matchesLegacyApi);for(const[n,s]of o.inputs?.entries()??[])if(s.link){const a=i.links.find(r=>r[0]===s.link);a&&(a[4]=n)}}compressSubgraphWidgetInputSlots(i.definitions?.subgraphs)}p(compressWidgetInputSlots,"compressWidgetInputSlots");function matchesLegacyApi(i){return!(i.widget&&i.link===null&&!i.label)}p(matchesLegacyApi,"matchesLegacyApi");function compressSubgraphWidgetInputSlots(i,o=new WeakSet){if(i)for(const n of i){if(o.has(n))throw new Error("Infinite loop detected");if(o.add(n),n.nodes){for(const s of n.nodes)if(s.inputs=s.inputs?.filter(matchesLegacyApi),!!n.links){for(const[a,r]of s.inputs?.entries()??[])if(r.link){const l=n.links.find(u=>u.id===r.link);l&&(l.target_slot=a)}}}compressSubgraphWidgetInputSlots(n.definitions?.subgraphs,o)}}p(compressSubgraphWidgetInputSlots,"compressSubgraphWidgetInputSlots");function isLoad3dNode(i){return i&&i.type&&(i.type==="Load3D"||i.type==="Load3DAnimation")}p(isLoad3dNode,"isLoad3dNode");const PREVIEW_REVOKE_DELAY_MS=400,createOutputs=p((i,o,n)=>({images:i.map(s=>({type:o,...parseFilePath(s)})),animated:i.map(s=>n&&(s.endsWith(".webp")||s.endsWith(".png")))}),"createOutputs"),useNodeOutputStore=defineStore("nodeOutput",()=>{const{nodeIdToNodeLocatorId:i,nodeToNodeLocatorId:o}=useWorkflowStore(),{executionIdToNodeLocatorId:n}=useExecutionStore(),s={},a=ref([]);function r(P,R){s[P]?.stop();const{stop:V}=useTimeoutFn(()=>{delete s[P],R()},PREVIEW_REVOKE_DELAY_MS);s[P]={stop:V}}p(r,"scheduleRevoke");const l=ref({}),u=ref(app$1.nodePreviewImages||{});function m(P){return app$1.nodeOutputs[o(P)]}p(m,"getNodeOutputs");function f(P){return app$1.nodePreviewImages[o(P)]}p(f,"getNodePreviews");const _=p((P,R)=>!(P.animatedImages||isVideoNode(P)||!R?.images?.length||R.images.some(V=>V.filename?.endsWith("svg"))),"isImageOutputs");function y(P,R){return _(P,R)?app$1.getPreviewFormatParam():""}p(y,"getPreviewParam");function b(P){const R=f(P);if(R?.length)return R;const V=m(P);if(!V?.images?.length)return;const $=app$1.getRandParam(),F=y(P,V);return V.images.map(j=>{const U=new URLSearchParams(j);return api.apiURL(`/view?${U}${F}${$}`)})}p(b,"getNodeImageUrls");function w(P,R,V={}){if(V.merge){const $=app$1.nodeOutputs[P];if($&&R){for(const F in R){const j=$[F],U=R[F];Array.isArray(j)&&Array.isArray(U)?$[F]=j.concat(U):$[F]=U}return}}a.value=R?.images?.map($=>{const F=new URLSearchParams($),j=app$1.getRandParam();return api.apiURL(`/view?${F}${j}`)})??[],app$1.nodeOutputs[P]=R,l.value[P]=R}p(w,"setOutputsByLocatorId");function k(P,R,{folder:V="input",isAnimated:$=!1}={}){if(!R||!P)return;const F=o(P);if(F)if(typeof R=="string")w(F,createOutputs([R],V,$));else if(!Array.isArray(R))w(F,R);else{const j=createOutputs(R,V,$);if(!j?.images?.length)return;w(F,j)}}p(k,"setNodeOutputs");function S(P,R,V={}){const $=n(P);$&&w($,R,V)}p(S,"setNodeOutputsByExecutionId");function C(P,R){const V=n(P);V&&(s[V]&&(s[V].stop(),delete s[V]),a.value=R,app$1.nodePreviewImages[V]=R,u.value[V]=R)}p(C,"setNodePreviewsByExecutionId");function I(P,R){const V=i(P);s[V]&&(s[V].stop(),delete s[V]),app$1.nodePreviewImages[V]=R,u.value[V]=R}p(I,"setNodePreviewsByNodeId");function T(P){const R=n(P);R&&r(R,()=>E(R))}p(T,"revokePreviewsByExecutionId");function E(P){const R=app$1.nodePreviewImages[P];if(R?.[Symbol.iterator]){for(const V of R)URL.revokeObjectURL(V);delete app$1.nodePreviewImages[P],delete u.value[P]}}p(E,"revokePreviewsByLocatorId");function N(){for(const P of Object.keys(app$1.nodePreviewImages)){const R=app$1.nodePreviewImages[P];if(R?.[Symbol.iterator])for(const V of R)URL.revokeObjectURL(V)}app$1.nodePreviewImages={},u.value={}}p(N,"revokeAllPreviews");function L(P){const R=P.graph.isRootGraph?"":P.graph.id+":";E(R+P.id);for(const V of P.subgraph.nodes)E(P.subgraph.id+V.id)}p(L,"revokeSubgraphPreviews");function A(P){const R=i(Number(P));if(!R)return!1;const V=!!app$1.nodeOutputs[R];return delete app$1.nodeOutputs[R],delete l.value[R],app$1.nodePreviewImages[R]&&(delete app$1.nodePreviewImages[R],delete u.value[R]),V}p(A,"removeNodeOutputs");function D(P){app$1.nodeOutputs=P,l.value=P}p(D,"restoreOutputs");function O(P){if(!P.images?.length)return;const R=i(P.id);if(R){const V=app$1.nodeOutputs[R];if(V){const $={...V,images:P.images};app$1.nodeOutputs[R]=$,l.value[R]=$}}}p(O,"updateNodeImages");function M(){app$1.nodeOutputs={},l.value={},N()}return p(M,"resetAllOutputsAndPreviews"),{getNodeOutputs:m,getNodeImageUrls:b,getNodePreviews:f,getPreviewParam:y,setNodeOutputs:k,setNodeOutputsByExecutionId:S,setNodePreviewsByExecutionId:C,setNodePreviewsByNodeId:I,updateNodeImages:O,revokePreviewsByExecutionId:T,revokeAllPreviews:N,revokeSubgraphPreviews:L,removeNodeOutputs:A,restoreOutputs:D,resetAllOutputsAndPreviews:M,nodeOutputs:l,nodePreviewImages:u,latestOutput:a}}),is_all_same_aspect_ratio=p(i=>{if(!i.length||i.length===1)return!0;const o=i[0].naturalWidth/i[0].naturalHeight;for(let n=1;n<i.length;n++){const s=i[n].naturalWidth/i[n].naturalHeight;if(o!=s)return!1}return!0},"is_all_same_aspect_ratio"),fitDimensionsToNodeWidth=p((i,o,n,s=64)=>{const a=i/o;if(!a||isNaN(a))return{minHeight:0,minWidth:0};const r=n;return{minHeight:Math.max(r/a,s),minWidth:r}},"fitDimensionsToNodeWidth"),VIDEO_WIDGET_NAME="video-preview",VIDEO_DEFAULT_OPTIONS={playsInline:!0,controls:!0,loop:!0},MEDIA_LOAD_TIMEOUT=8192,MAX_RETRIES=1,DEFAULT_VIDEO_SIZE=256,createContainer=p(()=>{const i=document.createElement("div");return i.classList.add("comfy-img-preview"),i},"createContainer"),createTimeout=p(i=>new Promise(o=>setTimeout(()=>o(null),i)),"createTimeout"),useNodePreview=p((i,o)=>{const{loadElement:n,onLoaded:s,onFailedLoading:a}=o,r=useNodeOutputStore(),l=p(async(f,_=0)=>{const y=await Promise.race([n(f),createTimeout(MEDIA_LOAD_TIMEOUT)]);return y===null&&_<MAX_RETRIES?l(f,_+1):y},"loadElementWithTimeout"),u=p(async f=>Promise.all(f.map(_=>l(_))),"loadElements");function m(f={}){if(i.isLoading)return;const _=r.getNodeImageUrls(i);_?.length&&(f?.block&&(i.isLoading=!0),u(_).then(y=>{const b=y.filter(w=>w!==null);b.length&&(s?.(b),i.graph?.setDirtyCanvas(!0))}).catch(()=>{a?.()}).finally(()=>{i.isLoading=!1}))}return p(m,"showPreview"),{showPreview:m}},"useNodePreview"),useNodeImage=p((i,o)=>(i.previewMediaType="image",useNodePreview(i,{loadElement:p(a=>new Promise(r=>{const l=new Image;l.onload=()=>r(l),l.onerror=()=>r(null),l.src=a}),"loadElement"),onLoaded:p(a=>{i.imageIndex=null,i.imgs=a,o?.()},"onLoaded"),onFailedLoading:p(()=>{i.imgs=void 0},"onFailedLoading")})),"useNodeImage"),useNodeVideo=p((i,o)=>{i.previewMediaType="video";let n=DEFAULT_VIDEO_SIZE,s=DEFAULT_VIDEO_SIZE;const{handleWheel:a,handlePointer:r}=useCanvasInteractions(),l=p(_=>{const{minHeight:y,minWidth:b}=fitDimensionsToNodeWidth(_.videoWidth,_.videoHeight,i.size?.[0]||DEFAULT_VIDEO_SIZE);s=b,n=y},"setMinDimensions"),u=p(_=>new Promise(y=>{const b=document.createElement("video");Object.assign(b,VIDEO_DEFAULT_OPTIONS),b.addEventListener("wheel",a),b.addEventListener("pointermove",r),b.addEventListener("pointerdown",r),b.onloadeddata=()=>{l(b),y(b)},b.onerror=()=>y(null),b.src=_}),"loadElement"),m=p(_=>{if(!i.widgets?.some(b=>b.name===VIDEO_WIDGET_NAME)){const b=i.addDOMWidget(VIDEO_WIDGET_NAME,"video",_,{canvasOnly:!0,hideOnZoom:!1});b.serialize=!1,b.computeLayoutSize=()=>({minHeight:n,minWidth:s})}},"addVideoDomWidget");return useNodePreview(i,{loadElement:u,onLoaded:p(_=>{const y=_[0];y&&(i.videoContainer||(i.videoContainer=createContainer(),m(i.videoContainer)),i.videoContainer.replaceChildren(y),o?.())},"onLoaded"),onFailedLoading:p(()=>{i.videoContainer=void 0},"onFailedLoading")})},"useNodeVideo"),useNodeDragAndDrop=p((i,o)=>{const{onDragOver:n,onDrop:s,fileFilter:a=p(()=>!0,"fileFilter")}=o,r=p(_=>!!Array.from(_).find(y=>y.kind==="file"),"hasFiles"),l=p(_=>Array.from(_).filter(a),"filterFiles"),u=p(_=>l(_).length>0,"hasValidFiles"),m=p(_=>_?.dataTransfer?.items?n?.(_)??r(_.dataTransfer.items):!1,"isDraggingFiles"),f=p(_=>_?.dataTransfer?.files?u(_.dataTransfer.files):!1,"isDraggingValidFiles");i.onDragOver=m,i.onDragDrop=function(_){if(!f(_))return!1;const y=l(_.dataTransfer.files);return s(y),!0}},"useNodeDragAndDrop");function useNodeFileInput(i,o){const{accept:n,allow_batch:s=!1,fileFilter:a=p(()=>!0,"fileFilter"),onSelect:r}=o;let l=document.createElement("input");return l.type="file",l.accept=n??"*",l.multiple=s,l.onchange=()=>{if(l?.files?.length){const u=Array.from(l.files).filter(a);u.length&&r(u)}},i.onRemoved=useChainCallback(i.onRemoved,()=>{l&&(l.onchange=null,l=null)}),{openFileSelection:p(()=>l?.click(),"openFileSelection")}}p(useNodeFileInput,"useNodeFileInput");const useNodePaste=p((i,o)=>{const{onPaste:n,fileFilter:s=p(()=>!0,"fileFilter"),allow_batch:a=!1}=o;i.pasteFiles=function(r){const l=Array.from(r).filter(s);if(!l.length)return!1;const u=a?l:l.slice(0,1);return n(u),!0}},"useNodePaste"),PASTED_IMAGE_EXPIRY_MS=2e3,uploadFile=p(async(i,o,n={})=>{const s=new FormData;s.append("image",i),o&&s.append("subfolder","pasted"),n.type&&s.append("type",n.type);const a=await api.fetchApi("/upload/image",{method:"POST",body:s});if(a.status!==200){useToastStore().addAlert(a.status+" - "+a.statusText);return}const r=await a.json();return(n.type==="input"||!n.type&&!o)&&await useAssetsStore().updateInputs(),r.subfolder?`${r.subfolder}/${r.name}`:r.name},"uploadFile"),useNodeImageUpload=p((i,o)=>{const{fileFilter:n,onUploadComplete:s,allow_batch:a,accept:r}=o,l=p(_=>_.name==="image.png"&&_.lastModified-Date.now()<PASTED_IMAGE_EXPIRY_MS,"isPastedFile"),u=p(async _=>{try{const y=await uploadFile(_,l(_),{type:o.folder});return y||void 0}catch(y){useToastStore().addAlert(String(y))}},"handleUpload"),m=p(async _=>{const b=(await Promise.all(_.map(u))).filter(w=>!!w);return b.length&&s(b),b},"handleUploadBatch");useNodeDragAndDrop(i,{fileFilter:n,onDrop:m}),useNodePaste(i,{fileFilter:n,allow_batch:a,onPaste:m});const{openFileSelection:f}=useNodeFileInput(i,{fileFilter:n,allow_batch:a,accept:r,onSelect:m});return{openFileSelection:f,handleUpload:u}},"useNodeImageUpload");function useValueTransform(i,o){let n=o,s=i(o),a=!1;return{get:p(()=>(a&&(s=i(n)),s),"get"),set:p(r=>{a=!0,n=r},"set")}}p(useValueTransform,"useValueTransform");function isImageUploadInput(i){const o=i[1];return o!==void 0&&typeof o=="object"&&"imageInputName"in o&&typeof o.imageInputName=="string"}p(isImageUploadInput,"isImageUploadInput");const hasAnnotation=p(i=>/\[(input|output|temp)\]/i.test(i),"hasAnnotation"),createAnnotation=p((i,o="input")=>!hasAnnotation(i)&&o!=="input"?` [${o}]`:"","createAnnotation"),createPath=p((i,o="")=>o?`${o}/${i}`:i,"createPath");function createAnnotatedPath(i,o={}){const{rootFolder:n="input",subfolder:s}=o;return typeof i=="string"?`${createPath(i,s)}${createAnnotation(i,n)}`:`${createPath(i.filename??"",i.subfolder)}${i.type?createAnnotation(i.type,n):""}`}p(createAnnotatedPath,"createAnnotatedPath");const ACCEPTED_IMAGE_TYPES="image/png,image/jpeg,image/webp",ACCEPTED_VIDEO_TYPES="video/webm,video/mp4",isImageFile=p(i=>i.type.startsWith("image/"),"isImageFile"),isVideoFile=p(i=>i.type.startsWith("video/"),"isVideoFile"),findFileComboWidget=p((i,o)=>i.widgets.find(n=>n.name===o),"findFileComboWidget"),useImageUploadWidget=p(()=>p((o,n,s)=>{if(!isImageUploadInput(s))throw new Error("Image upload widget requires imageInputName augmentation");const a=s[1],{imageInputName:r,allow_batch:l,image_folder:u="input"}=a,m=u,f=useNodeOutputStore(),_=!!a.animated_image_upload,y=!!a.video_upload,b=y?ACCEPTED_VIDEO_TYPES:ACCEPTED_IMAGE_TYPES,{showPreview:w}=y?useNodeVideo(o):useNodeImage(o),k=y?isVideoFile:isImageFile,S=findFileComboWidget(o,r),C=`${S.value}`,I=p(L=>createAnnotatedPath(L,{rootFolder:u}),"formatPath");Object.defineProperty(S,"value",useValueTransform(p(L=>L?Array.isArray(L)?l?L.map(I):I(L[0]):I(L):C,"transform"),C));const{openFileSelection:E}=useNodeImageUpload(o,{allow_batch:l,fileFilter:k,accept:b,folder:m,onUploadComplete:p(L=>{L.forEach(D=>addToComboValues(S,D));const A=l?[...L]:L[0];S.value=A,S.callback?.(A)},"onUploadComplete")}),N=o.addWidget("button",n,"image",()=>E(),{serialize:!1,canvasOnly:!0});return N.label=t("g.choose_file_to_upload"),S.callback=function(){f.setNodeOutputs(o,S.value,{isAnimated:_}),o.graph?.setDirtyCanvas(!0)},requestAnimationFrame(()=>{f.setNodeOutputs(o,S.value,{isAnimated:_}),w({block:!1})}),{widget:N}},"widgetConstructor"),"useImageUploadWidget");function onValueChange(i){const o=this.options.step2||1;if(o===1)this.value=Math.round(i);else{const s=(this.options.min??0)%o;this.value=Math.round((i-s)/o)*o+s}}p(onValueChange,"onValueChange");const useIntWidget=p(()=>p((o,n)=>{if(!isIntInputSpec(n))throw new Error(`Invalid input data: ${n}`);const a=!useSettingStore().get("Comfy.DisableSliders"),r=n.display,l=a&&r=="slider"?"slider":r=="knob"?"knob":"number",u=n.step??1,m=n.default??0,f=o.addWidget(l,n.name,m,onValueChange,{min:n.min??0,max:n.max??2048,step:u*10,step2:u,precision:0});if(n.control_after_generate??["seed","noise_seed"].includes(n.name)){const y=addValueControlWidget(o,f,"randomize",void 0,void 0,transformInputSpecV2ToV1(n));f.linkedWidgets=[y]}return f},"widgetConstructor"),"useIntWidget");function addMarkdownWidget(i,o,n){Markdown.configure({html:!1,breaks:!0,transformPastedText:!0});const s=new Editor({extensions:[StarterKit,Markdown,Link,Table,TableCell,TableHeader,TableRow],content:n.defaultVal,editable:!1}),a=s.options.element;a.classList.add("comfy-markdown");const r=document.createElement("textarea");a.append(r);const l=i.addDOMWidget(o,"MARKDOWN",a,{getValue(){return r.value},setValue(u){r.value=u,s.commands.setContent(u)}});return l.inputEl=a,l.options.minNodeSize=[400,200],a.addEventListener("dblclick",()=>{a.classList.add("editing"),setTimeout(()=>{r.focus()},0)}),r.addEventListener("blur",()=>{a.classList.remove("editing")}),r.addEventListener("change",()=>{s.commands.setContent(r.value),l.callback?.(l.value)}),a.addEventListener("keydown",u=>{u.stopPropagation()}),a.addEventListener("pointerdown",u=>{u.button===1&&app$1.canvas.processMouseDown(u)}),a.addEventListener("pointermove",u=>{(u.buttons&4)===4&&app$1.canvas.processMouseMove(u)}),a.addEventListener("pointerup",u=>{u.button===1&&app$1.canvas.processMouseUp(u)}),l}p(addMarkdownWidget,"addMarkdownWidget");const useMarkdownWidget=p(()=>p((o,n)=>addMarkdownWidget(o,n.name,{defaultVal:n.default??""}),"widgetConstructor"),"useMarkdownWidget"),TRACKPAD_DETECTION_THRESHOLD=50;function addMultilineWidget(i,o,n){const s=document.createElement("textarea");s.className="comfy-multiline-input",s.value=n.defaultVal,s.placeholder=n.placeholder||o,s.spellcheck=useSettingStore().get("Comfy.TextareaWidget.Spellcheck");const a=i.addDOMWidget(o,"customtext",s,{getValue(){return s.value},setValue(r){s.value=r}});return a.inputEl=s,a.options.minNodeSize=[400,200],s.addEventListener("input",()=>{a.callback?.(a.value)}),s.addEventListener("pointerdown",r=>{r.button===1&&app$1.canvas.processMouseDown(r)}),s.addEventListener("pointermove",r=>{(r.buttons&4)===4&&app$1.canvas.processMouseMove(r)}),s.addEventListener("pointerup",r=>{r.button===1&&app$1.canvas.processMouseUp(r)}),s.addEventListener("wheel",r=>{const l=useSettingStore().get("LiteGraph.Pointer.TrackpadGestures"),u=r.deltaX,m=r.deltaY,f=s.scrollHeight>s.clientHeight,_=Math.abs(u)>Math.abs(m);if(r.ctrlKey){r.preventDefault(),r.stopPropagation(),app$1.canvas.processMouseWheel(r);return}const y=Math.abs(u)>0||Math.abs(m)<TRACKPAD_DETECTION_THRESHOLD;if(l&&y){r.preventDefault(),r.stopPropagation(),app$1.canvas.processMouseWheel(r);return}if(_){r.preventDefault(),r.stopPropagation(),app$1.canvas.processMouseWheel(r);return}if(f){r.stopPropagation();return}r.preventDefault(),app$1.canvas.processMouseWheel(r)}),a}p(addMultilineWidget,"addMultilineWidget");const useStringWidget=p(()=>p((o,n)=>{if(!isStringInputSpec(n))throw new Error(`Invalid input data: ${n}`);const s=n.default??"",r=n.multiline?addMultilineWidget(o,n.name,{defaultVal:s,placeholder:n.placeholder}):o.addWidget("text",n.name,s,()=>{},{});return typeof n.dynamicPrompts=="boolean"&&(r.dynamicPrompts=n.dynamicPrompts),r},"widgetConstructor"),"useStringWidget"),useTextareaWidget=p(()=>(i,o)=>{const{name:n,options:s={}}=o;return i.addWidget("textarea",n,s.default||"",()=>{},{serialize:!0,rows:s.rows||5,cols:s.cols||50,...s})},"useTextareaWidget"),StringWidget=useStringWidget(),FloatWidget=useFloatWidget(),BooleanWidget=useBooleanWidget();function addWidgetFromValue(i,o){let n;if(typeof o=="string")n=StringWidget(i,{type:"STRING",name:"UNKNOWN",multiline:o.length>20});else if(typeof o=="number")n=FloatWidget(i,{type:"FLOAT",name:"UNKNOWN"});else if(typeof o=="boolean")n=BooleanWidget(i,{type:"BOOLEAN",name:"UNKNOWN"});else{n=StringWidget(i,{type:"STRING",name:"UNKNOWN",multiline:!0}),n.value=JSON.stringify(o);return}n.value=o}p(addWidgetFromValue,"addWidgetFromValue");LGraphNode.prototype.onConfigure=useChainCallback(LGraphNode.prototype.onConfigure,function(i){if(!(!this.has_errors||!i.widgets_values)){for(let o=0;o<i.widgets_values.length;o++){const n=i.widgets_values[o];addWidgetFromValue(this,n)}this.serialize_widgets=!0}});const transformWidgetConstructorV2ToV1=p(i=>(o,n,s)=>{const a=transformInputSpecV1ToV2(s,{name:n}),r=i(o,a);return{widget:r,minWidth:r.options.minNodeSize?.[0],minHeight:r.options.minNodeSize?.[1]}},"transformWidgetConstructorV2ToV1");function controlValueRunBefore(){return useSettingStore().get("Comfy.WidgetControlMode")==="before"}p(controlValueRunBefore,"controlValueRunBefore");function updateControlWidgetLabel(i){controlValueRunBefore()?i.label=t("g.control_before_generate"):i.label=t("g.control_after_generate")}p(updateControlWidgetLabel,"updateControlWidgetLabel");const IS_CONTROL_WIDGET=Symbol(),HAS_EXECUTED=Symbol();function addValueControlWidget(i,o,n,s,a,r){let l=r?.[1]?.control_after_generate;return typeof l!="string"&&(l=a),addValueControlWidgets(i,o,n??"randomize",{addFilterList:!1,controlAfterGenerateName:l},r)[0]}p(addValueControlWidget,"addValueControlWidget");function addValueControlWidgets(i,o,n,s,a){n||(n="randomize"),s||(s={});const r=p((y,b)=>{let w=y;return s[b]?w=s[b]:typeof a?.[1]?.[y]=="string"?w=a?.[1]?.[y]:a?.[1]?.control_prefix&&(w=a?.[1]?.control_prefix+" "+w),w},"getName"),l=i.addWidget("combo",r("control_after_generate","controlAfterGenerateName"),n,function(){},{values:["fixed","increment","decrement","randomize"],serialize:!1,canvasOnly:!0});l.tooltip="Allows the linked widget to be changed automatically, for example randomizing the noise seed.",l[IS_CONTROL_WIDGET]=!0,updateControlWidgetLabel(l);const u=[l],m=isComboWidget(o);let f;m&&l.options.values&&l.options.values.push("increment-wrap"),m&&s.addFilterList!==!1&&(f=i.addWidget("string",r("control_filter_list","controlFilterListName"),"",function(){},{serialize:!1}),updateControlWidgetLabel(f),f.tooltip="Allows for filtering the list of values when changing the value via the control generate mode. Allows for RegEx matches in the format /abc/ to only filter to values containing 'abc'.",u.push(f));const _=p(()=>{var y=l.value;if(m&&y!=="fixed"){let b=o.options.values??[];const w=f?.value;if(w){let C;if(w.startsWith("/")&&w.endsWith("/"))try{const I=new RegExp(w.substring(1,w.length-1));C=p(T=>I.test(T),"check")}catch(I){console.error("Error constructing RegExp filter for node "+i.id,w,I)}if(!C){const I=w.toLocaleLowerCase();C=p(T=>T.toLocaleLowerCase().includes(I),"check")}b=b.filter(I=>C(I)),!b.length&&o.options.values?.length&&console.warn("Filter for node "+i.id+" has filtered out all items",w)}let k=b.indexOf(o.value),S=b.length;switch(y){case"increment":k+=1;break;case"increment-wrap":k+=1,k>=S&&(k=0);break;case"decrement":k-=1;break;case"randomize":k=Math.floor(Math.random()*S);break}if(k=Math.max(0,k),k=Math.min(S-1,k),k>=0){let C=b[k];o.value=C,o.callback?.(C)}}else{let{min:b=0,max:w=1,step2:k=1}=o.options;w=Math.min(0x4000000000000,w),b=Math.max(-0x4000000000000,b);let S=(w-b)/k;switch(y){case"fixed":break;case"increment":o.value+=k;break;case"decrement":o.value-=k;break;case"randomize":o.value=Math.floor(Math.random()*S)*k+b;break}o.value<b&&(o.value=b),o.value>w&&(o.value=w),o.callback?.(o.value)}},"applyWidgetControl");return l.beforeQueued=()=>{controlValueRunBefore()&&l[HAS_EXECUTED]&&_(),l[HAS_EXECUTED]=!0},l.afterQueued=()=>{controlValueRunBefore()||_()},u}p(addValueControlWidgets,"addValueControlWidgets");const ComfyWidgets={INT:transformWidgetConstructorV2ToV1(useIntWidget()),FLOAT:transformWidgetConstructorV2ToV1(useFloatWidget()),BOOLEAN:transformWidgetConstructorV2ToV1(useBooleanWidget()),STRING:transformWidgetConstructorV2ToV1(useStringWidget()),MARKDOWN:transformWidgetConstructorV2ToV1(useMarkdownWidget()),COMBO:transformWidgetConstructorV2ToV1(useComboWidget()),IMAGEUPLOAD:useImageUploadWidget(),COLOR:transformWidgetConstructorV2ToV1(useColorWidget()),IMAGECOMPARE:transformWidgetConstructorV2ToV1(useImageCompareWidget()),CHART:transformWidgetConstructorV2ToV1(useChartWidget()),GALLERIA:transformWidgetConstructorV2ToV1(useGalleriaWidget()),TEXTAREA:transformWidgetConstructorV2ToV1(useTextareaWidget()),...dynamicWidgets};window.comfyAPI=window.comfyAPI||{};window.comfyAPI.widgets=window.comfyAPI.widgets||{};window.comfyAPI.widgets.updateControlWidgetLabel=updateControlWidgetLabel;window.comfyAPI.widgets.IS_CONTROL_WIDGET=IS_CONTROL_WIDGET;window.comfyAPI.widgets.addValueControlWidget=addValueControlWidget;window.comfyAPI.widgets.addValueControlWidgets=addValueControlWidgets;window.comfyAPI.widgets.ComfyWidgets=ComfyWidgets;const useWidgetStore=defineStore("widget",()=>{const i=ComfyWidgets,o=ref(new Map),n=computed(()=>new Map([...o.value,...Object.entries(i)]));function s(r){const l=Array.isArray(r)?getInputSpecType(r):r.type;return n.value.has(l)}p(s,"inputIsWidget");function a(r){for(const[l,u]of Object.entries(r))o.value.set(l,u)}return p(a,"registerCustomWidgets"),{widgets:n,inputIsWidget:s,registerCustomWidgets:a}});function useCommandSubcategories(i,o){return{subcategories:computed(()=>{const s={};for(const a of i.value){let r=o.defaultSubcategory;for(const l of o.rules)if(typeof l.pattern=="string"?a.id.includes(l.pattern):l.pattern.test(a.id)){r=l.subcategory;break}s[r]||(s[r]=[]),s[r].push(a)}return s})}}p(useCommandSubcategories,"useCommandSubcategories");const VIEW_CONTROLS_CONFIG={defaultSubcategory:"view",rules:[{pattern:"Zoom",subcategory:"view"},{pattern:"Fit",subcategory:"view"},{pattern:"Panel",subcategory:"panel-controls"},{pattern:"Sidebar",subcategory:"panel-controls"}]},ESSENTIALS_CONFIG={defaultSubcategory:"workflow",rules:[{pattern:"Workflow",subcategory:"workflow"},{pattern:"Node",subcategory:"node"},{pattern:"Queue",subcategory:"queue"}]},_hoisted_1$26={class:"shortcuts-list flex justify-center"},_hoisted_2$1B={class:"grid h-full w-[90%] grid-cols-1 gap-4 md:grid-cols-3 md:gap-24"},_hoisted_3$15={class:"subcategory-title mb-4 text-xs font-bold tracking-wide text-text-secondary uppercase"},_hoisted_4$M={class:"flex flex-col gap-1"},_hoisted_5$G={class:"shortcut-info grow pr-4"},_hoisted_6$u={class:"shortcut-name text-sm font-medium"},_hoisted_7$q={class:"keybinding-display shrink-0"},_hoisted_8$k=["aria-label"],_sfc_main$2y=defineComponent({__name:"ShortcutsList",props:{commands:{},subcategories:{}},setup(i){const{t:o}=useI18n(),n=computed(()=>{const r={};for(const[l,u]of Object.entries(i.subcategories))r[l]=u.filter(m=>!!m.keybinding);return r}),s=p(r=>({workflow:o("shortcuts.subcategories.workflow"),node:o("shortcuts.subcategories.node"),queue:o("shortcuts.subcategories.queue"),view:o("shortcuts.subcategories.view"),"panel-controls":o("shortcuts.subcategories.panelControls")})[r]||r,"getSubcategoryTitle"),a=p(r=>({Control:"Ctrl",Meta:"Cmd",ArrowUp:"â†‘",ArrowDown:"â†“",ArrowLeft:"â†",ArrowRight:"â†’",Backspace:"âŒ«",Delete:"âŒ¦",Enter:"â†µ",Escape:"Esc",Tab:"â‡¥"," ":"Space"})[r]||r,"formatKey");return(r,l)=>(openBlock(),createElementBlock("div",_hoisted_1$26,[createBaseVNode("div",_hoisted_2$1B,[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,(u,m)=>(openBlock(),createElementBlock("div",{key:m,class:"flex flex-col"},[createBaseVNode("h3",_hoisted_3$15,toDisplayString(s(m)),1),createBaseVNode("div",_hoisted_4$M,[(openBlock(!0),createElementBlock(Fragment,null,renderList(u,f=>(openBlock(),createElementBlock("div",{key:f.id,class:"shortcut-item flex items-center justify-between rounded py-2 transition-colors duration-200"},[createBaseVNode("div",_hoisted_5$G,[createBaseVNode("div",_hoisted_6$u,toDisplayString(unref(o)(`commands.${unref(normalizeI18nKey)(f.id)}.label`)),1)]),createBaseVNode("div",_hoisted_7$q,[createBaseVNode("div",{class:"keybinding-combo flex gap-1","aria-label":`Keyboard shortcut: ${f.keybinding.combo.getKeySequences().join(" + ")}`},[(openBlock(!0),createElementBlock(Fragment,null,renderList(f.keybinding.combo.getKeySequences(),_=>(openBlock(),createElementBlock("span",{key:_,class:"key-badge min-w-6 rounded bg-muted-background px-2 py-1 text-center font-mono text-xs"},toDisplayString(a(_)),1))),128))],8,_hoisted_8$k)])]))),128))])]))),128))])]))}}),_hoisted_1$25={class:"flex h-full flex-col p-4"},_hoisted_2$1A={class:"min-h-0 flex-1 overflow-auto"},_sfc_main$2x=defineComponent({__name:"EssentialsPanel",setup(i){const o=useCommandStore(),n=computed(()=>o.commands.filter(a=>a.category==="essentials")),{subcategories:s}=useCommandSubcategories(n,ESSENTIALS_CONFIG);return(a,r)=>(openBlock(),createElementBlock("div",_hoisted_1$25,[createBaseVNode("div",_hoisted_2$1A,[createVNode(_sfc_main$2y,{commands:n.value,subcategories:unref(s)},null,8,["commands","subcategories"])])]))}}),_hoisted_1$24={class:"flex h-full flex-col p-4"},_hoisted_2$1z={class:"min-h-0 flex-1 overflow-auto"},_sfc_main$2w=defineComponent({__name:"ViewControlsPanel",setup(i){const o=useCommandStore(),n=computed(()=>o.commands.filter(a=>a.category==="view-controls")),{subcategories:s}=useCommandSubcategories(n,VIEW_CONTROLS_CONFIG);return(a,r)=>(openBlock(),createElementBlock("div",_hoisted_1$24,[createBaseVNode("div",_hoisted_2$1z,[createVNode(_sfc_main$2y,{commands:n.value,subcategories:unref(s)},null,8,["commands","subcategories"])])]))}}),useShortcutsTab=p(()=>{const{t:i}=useI18n();return[{id:"shortcuts-essentials",title:i("shortcuts.essentials"),titleKey:"shortcuts.essentials",component:markRaw(_sfc_main$2x),type:"vue",targetPanel:"shortcuts"},{id:"shortcuts-view-controls",title:i("shortcuts.viewControls"),titleKey:"shortcuts.viewControls",component:markRaw(_sfc_main$2w),type:"vue",targetPanel:"shortcuts"}]},"useShortcutsTab");function useTerminal(i){const o=new addonFitExports.FitAddon,n=markRaw(new xtermExports.Terminal({convertEol:!0,theme:isDesktop?{background:"#171717"}:void 0}));return n.loadAddon(o),n.attachCustomKeyEventHandler(s=>!(s.type==="keydown"&&(s.ctrlKey||s.metaKey)&&(s.key==="c"&&n.hasSelection()||s.key==="v"))),onMounted(async()=>{i.value&&n.open(i.value)}),onUnmounted(()=>{n.dispose()}),{terminal:n,useAutoSize({root:s,autoRows:a=!0,autoCols:r=!0,minCols:l=Number.NEGATIVE_INFINITY,minRows:u=Number.NEGATIVE_INFINITY,onResize:m}){const f=p(w=>w==null||isNaN(w)?(s.value?.clientHeight??80)/20:w,"ensureValidRows"),_=p(w=>w==null||isNaN(w)?(s.value?.clientWidth??80)/8:w,"ensureValidCols"),y=p(()=>{const w=o.proposeDimensions();n.resize(Math.max(r?_(w?.cols):n.cols,l),Math.max(a?f(w?.rows):n.rows,u)),m?.()},"resize"),b=new ResizeObserver(debounce(y,25));return onMounted(async()=>{s.value&&(b.observe(s.value),y())}),onUnmounted(()=>{b.disconnect()}),{resize:y}}}}p(useTerminal,"useTerminal");const _hoisted_1$23={class:"p-terminal h-full w-full rounded-none p-2"},_sfc_main$2v=defineComponent({__name:"BaseTerminal",emits:["created","unmounted"],setup(i,{emit:o}){const{t:n}=useI18n(),s=o,a=ref(),r=ref(),l=ref(!1),u=useElementHover(r),m=useTerminal(a);s("created",m,ref(r));const{terminal:f}=m;let _;const y=computed(()=>l.value?n("serverStart.copySelectionTooltip"):n("serverStart.copyAllTooltip")),b=p(async()=>{const k=f.getSelection(),S=!k;S&&f.selectAll();const C=S?f.getSelection():k;C&&(await navigator.clipboard.writeText(C),S&&f.clearSelection())},"handleCopy"),w=p(k=>{k.preventDefault(),electronAPI()?.showContextMenu({type:"text"})},"showContextMenu");return isElectron()&&useEventListener(a,"contextmenu",w),onMounted(()=>{_=f.onSelectionChange(()=>{l.value=f.hasSelection()})}),onUnmounted(()=>{_?.dispose(),s("unmounted")}),(k,S)=>{const C=resolveDirective("tooltip");return openBlock(),createElementBlock("div",{ref_key:"rootEl",ref:r,class:"relative h-full w-full overflow-hidden bg-neutral-900"},[createBaseVNode("div",_hoisted_1$23,[createBaseVNode("div",{ref_key:"terminalEl",ref:a,class:"terminal-host h-full"},null,512)]),withDirectives(createVNode(unref(script),{icon:"pi pi-copy",severity:"secondary",size:"small",class:normalizeClass(unref(cn)("absolute top-2 right-8 transition-opacity",{"opacity-0 pointer-events-none select-none":!unref(u)})),"aria-label":y.value,onClick:b},null,8,["class","aria-label"]),[[C,{value:y.value,showDelay:300},void 0,{left:!0}]])],512)}}}),BaseTerminal=_export_sfc(_sfc_main$2v,[["__scopeId","data-v-7680843d"]]),_sfc_main$2u=defineComponent({__name:"CommandTerminal",setup(i){const o=p(({terminal:n,useAutoSize:s},a)=>{const r=electronAPI().Terminal;let l,u;s({root:a,autoRows:!0,autoCols:!0,onResize:p(async()=>{n.element?.offsetParent&&await r.resize(n.cols,n.rows)},"onResize")}),onMounted(async()=>{l=n.onData(async f=>{await r.write(f)}),u=r.onOutput(f=>{n.write(f)});const m=await r.restore();setTimeout(()=>{m.buffer.length&&(n.resize(m.size.cols,m.size.rows),n.write(m.buffer.join("")))},500)}),onUnmounted(()=>{l?.dispose(),u?.()})},"terminalCreated");return(n,s)=>(openBlock(),createBlock(BaseTerminal,{onCreated:o}))}}),CommandTerminal=_export_sfc(_sfc_main$2u,[["__scopeId","data-v-49782f06"]]),_hoisted_1$22={class:"h-full w-full bg-transparent"},_hoisted_2$1y={key:0,class:"p-4 text-center"},_sfc_main$2t=defineComponent({__name:"LogsTerminal",setup(i){const o=ref(""),n=ref(!0),s=p(({terminal:a,useAutoSize:r},l)=>{r({root:l,autoRows:!0,autoCols:!0,minCols:80});const u=p(y=>{a.write(y.map(b=>b.m).join(""))},"update"),m=p(y=>{u(y.detail.entries)},"logReceived"),f=p(async()=>{const y=await api.getRawLogs();u(y.entries)},"loadLogEntries"),_=p(async()=>{const{clientId:y}=storeToRefs(useExecutionStore());y.value||await until(y).not.toBeNull(),await api.subscribeLogs(!0),api.addEventListener("logs",m)},"watchLogs");onMounted(async()=>{try{await f()}catch(y){console.error("Error loading logs",y),o.value="Unable to load logs, please ensure you have updated your ComfyUI backend.";return}await _(),n.value=!1}),onUnmounted(async()=>{api.clientId&&await api.subscribeLogs(!1),api.removeEventListener("logs",m)})},"terminalCreated");return(a,r)=>(openBlock(),createElementBlock("div",_hoisted_1$22,[o.value?(openBlock(),createElementBlock("p",_hoisted_2$1y,toDisplayString(o.value),1)):n.value?(openBlock(),createBlock(unref(script$5),{key:1,class:"relative inset-0 z-10 flex h-full items-center justify-center"})):createCommentVNode("",!0),withDirectives(createVNode(BaseTerminal,{onCreated:s},null,512),[[vShow,!n.value]])]))}}),LogsTerminal=_export_sfc(_sfc_main$2t,[["__scopeId","data-v-c03d3536"]]),useLogsTerminalTab=p(()=>{const{t:i}=useI18n();return{id:"logs-terminal",title:i("g.logs"),titleKey:"g.logs",component:markRaw(LogsTerminal),type:"vue"}},"useLogsTerminalTab"),useCommandTerminalTab=p(()=>{const{t:i}=useI18n();return{id:"command-terminal",title:i("g.terminal"),titleKey:"g.terminal",component:markRaw(CommandTerminal),type:"vue"}},"useCommandTerminalTab"),useBottomPanelStore=defineStore("bottomPanel",()=>{const i=ref({terminal:{tabs:[],activeTabId:"",visible:!1},shortcuts:{tabs:[],activeTabId:"",visible:!1}}),o=ref(null),n=computed(()=>o.value?i.value[o.value]:null),s=computed(()=>{const k=n.value;return k?k.tabs.find(S=>S.id===k.activeTabId)??null:null}),a=computed({get:p(()=>!!o.value,"get"),set:p(k=>{k||(o.value=null)},"set")}),r=computed(()=>n.value?.tabs??[]),l=computed({get:p(()=>n.value?.activeTabId??"","get"),set:p(k=>{const S=n.value;S&&(S.activeTabId=k)},"set")}),u=p(k=>{const S=i.value[k];S.tabs.length!==0&&(o.value===k?o.value=null:(o.value=k,!S.activeTabId&&S.tabs.length>0&&(S.activeTabId=S.tabs[0].id)))},"togglePanel"),m=p(()=>{u("terminal")},"toggleBottomPanel"),f=p(k=>{const S=n.value;S&&(S.activeTabId=k)},"setActiveTab"),_=p(k=>{for(const[S,C]of Object.entries(i.value))if(C.tabs.find(T=>T.id===k)){o.value===S&&C.activeTabId===k?o.value=null:(o.value=S,C.activeTabId=k);return}},"toggleBottomPanelTab"),y=p(k=>{const S=k.targetPanel??"terminal",C=i.value[S];C.tabs=[...C.tabs,k],C.tabs.length===1&&(C.activeTabId=k.id);const I=k.title||k.titleKey||k.id;useCommandStore().registerCommand({id:`Workspace.ToggleBottomPanelTab.${k.id}`,icon:"pi pi-list",label:`Toggle ${I} Bottom Panel`,category:"view-controls",function:p(()=>_(k.id),"function"),source:"System"})},"registerBottomPanelTab");return{panels:i,activePanel:o,togglePanel:u,bottomPanelVisible:a,toggleBottomPanel:m,bottomPanelTabs:r,activeBottomPanelTab:s,activeBottomPanelTabId:l,setActiveTab:f,toggleBottomPanelTab:_,registerBottomPanelTab:y,registerCoreBottomPanelTabs:p(()=>{y(useLogsTerminalTab()),isElectron()&&y(useCommandTerminalTab()),useShortcutsTab().forEach(y)},"registerCoreBottomPanelTabs"),registerExtensionBottomPanelTabs:p(k=>{k.bottomPanelTabs&&k.bottomPanelTabs.forEach(y)},"registerExtensionBottomPanelTabs")}}),useExtensionService=p(()=>{const i=useExtensionStore(),o=useSettingStore(),n=useKeybindingStore(),{wrapWithErrorHandling:s,wrapWithErrorHandlingAsync:a,toastErrorHandler:r}=useErrorHandling();return{loadExtensions:p(async()=>{i.loadDisabledExtensionNames(o.get("Comfy.Extension.Disabled"));const _=await api.getExtensions();await __vitePreload(()=>import("./index-B4KuK9HZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url),i.captureCoreExtensions(),await Promise.all(_.filter(y=>!y.includes("extensions/core")).map(async y=>{try{await import(api.fileURL(y))}catch(b){console.error("Error loading extension",y,b)}}))},"loadExtensions"),registerExtension:p(_=>{i.registerExtension(_);const y=s(n.addDefaultKeybinding),b=s(o.addSetting);if(_.keybindings?.forEach(w=>{y(new KeybindingImpl(w))}),useCommandStore().loadExtensionCommands(_),useMenuItemStore().loadExtensionMenuCommands(_),_.settings?.forEach(b),useBottomPanelStore().registerExtensionBottomPanelTabs(_),_.getCustomWidgets&&(async()=>{if(_.getCustomWidgets){const w=await _.getCustomWidgets(app$1);useWidgetStore().registerCustomWidgets(w)}})(),_.onAuthUserResolved){const{onUserResolved:w}=useCurrentUser(),k=a(S=>_.onAuthUserResolved?.(S,app$1),S=>{console.error("[Extension Auth Hook Error]",{extension:_.name,hook:"onAuthUserResolved",error:S}),r(S)});w(S=>{k(S)})}if(_.onAuthTokenRefreshed){const{onTokenRefreshed:w}=useCurrentUser(),k=a(()=>_.onAuthTokenRefreshed?.(),S=>{console.error("[Extension Auth Hook Error]",{extension:_.name,hook:"onAuthTokenRefreshed",error:S}),r(S)});w(()=>{k()})}if(_.onAuthUserLogout){const{onUserLogout:w}=useCurrentUser(),k=a(()=>_.onAuthUserLogout?.(),S=>{console.error("[Extension Auth Hook Error]",{extension:_.name,hook:"onAuthUserLogout",error:S}),r(S)});w(()=>{k()})}},"registerExtension"),invokeExtensions:p((_,...y)=>{const b=[];for(const w of i.enabledExtensions)if(_ in w)try{b.push(w[_](...y,app$1))}catch(k){console.error(`Error calling extension '${w.name}' method '${_}'`,{error:k},{extension:w},{args:y})}return b},"invokeExtensions"),invokeExtensionsAsync:p(async(_,...y)=>await Promise.all(i.enabledExtensions.map(async b=>{if(_ in b)try{_==="setup"&&legacyMenuCompat.setCurrentExtension(b.name);const w=await b[_](...y,app$1);return _==="setup"&&legacyMenuCompat.setCurrentExtension(null),w}catch(w){_==="setup"&&legacyMenuCompat.setCurrentExtension(null),console.error(`Error calling extension '${b.name}' method '${_}'`,{error:w},{extension:b},{args:y})}})),"invokeExtensionsAsync")}},"useExtensionService");class ResultItemImpl{static{p(this,"ResultItemImpl")}filename;subfolder;type;nodeId;mediaType;format;frame_rate;constructor(o){this.filename=o.filename??"",this.subfolder=o.subfolder??"",this.type=o.type??"",this.nodeId=o.nodeId,this.mediaType=o.mediaType,this.format=o.format,this.frame_rate=o.frame_rate}get urlParams(){const o=new URLSearchParams;return o.set("filename",this.filename),o.set("type",this.type),o.set("subfolder",this.subfolder),this.format&&o.set("format",this.format),this.frame_rate&&o.set("frame_rate",this.frame_rate.toString()),o}get vhsAdvancedPreviewUrl(){return api.apiURL("/viewvideo?"+this.urlParams)}get url(){return api.apiURL("/view?"+this.urlParams)}get urlWithTimestamp(){return`${this.url}&t=${+new Date}`}get isVhsFormat(){return!!this.format&&!!this.frame_rate}get htmlVideoType(){if(this.isWebm)return"video/webm";if(this.isMp4)return"video/mp4";if(this.isVhsFormat){if(this.format?.endsWith("webm"))return"video/webm";if(this.format?.endsWith("mp4"))return"video/mp4"}}get htmlAudioType(){if(this.isMp3)return"audio/mpeg";if(this.isWav)return"audio/wav";if(this.isOgg)return"audio/ogg";if(this.isFlac)return"audio/flac"}get isGif(){return this.filename.endsWith(".gif")}get isWebp(){return this.filename.endsWith(".webp")}get isWebm(){return this.filename.endsWith(".webm")}get isMp4(){return this.filename.endsWith(".mp4")}get isVideoBySuffix(){return this.isWebm||this.isMp4}get isImageBySuffix(){return this.isGif||this.isWebp}get isMp3(){return this.filename.endsWith(".mp3")}get isWav(){return this.filename.endsWith(".wav")}get isOgg(){return this.filename.endsWith(".ogg")}get isFlac(){return this.filename.endsWith(".flac")}get isAudioBySuffix(){return this.isMp3||this.isWav||this.isOgg||this.isFlac}get isVideo(){const o=this.mediaType==="video"||!!this.format?.startsWith("video/");return this.isVideoBySuffix||o&&!this.isImageBySuffix&&!this.isAudioBySuffix}get isImage(){return this.isImageBySuffix||this.mediaType==="images"&&!this.isVideoBySuffix&&!this.isAudioBySuffix}get isAudio(){const o=this.mediaType==="audio"||!!this.format?.startsWith("audio/");return this.isAudioBySuffix||o&&!this.isImageBySuffix&&!this.isVideoBySuffix}get is3D(){return getMediaTypeFromFilename(this.filename)==="3D"}get supportsPreview(){return this.isImage||this.isVideo||this.isAudio||this.is3D}}class TaskItemImpl{static{p(this,"TaskItemImpl")}taskType;prompt;status;outputs;flatOutputs;constructor(o,n,s,a,r){this.taskType=o,this.prompt=n,this.status=s,this.outputs=toolkit.mapValues(a??{},l=>toolkit.omit(l,"animated")),this.flatOutputs=r??this.calculateFlatOutputs()}calculateFlatOutputs(){return this.outputs?Object.entries(this.outputs).flatMap(([o,n])=>Object.entries(n).flatMap(([s,a])=>a.map(r=>new ResultItemImpl({...r,nodeId:o,mediaType:s})))):[]}get previewOutput(){return this.flatOutputs.find(o=>o.type==="output"&&o.supportsPreview)??this.flatOutputs.find(o=>o.supportsPreview)}get apiTaskType(){switch(this.taskType){case"Running":case"Pending":return"queue";case"History":return"history"}}get key(){return this.promptId+this.displayStatus}get queueIndex(){return this.prompt[0]}get promptId(){return this.prompt[1]}get promptInputs(){return this.prompt[2]}get extraData(){return this.prompt[3]}get outputsToExecute(){return this.prompt[4]}get extraPngInfo(){return this.extraData.extra_pnginfo}get clientId(){return this.extraData.client_id}get workflow(){return this.extraPngInfo?.workflow}get messages(){return this.status?.messages||[]}get createTime(){const o=this.extraData||{},n=typeof o.create_time=="number"?o.create_time:void 0;if(typeof n=="number")return n}get interrupted(){return toolkit.some(this.messages,o=>o[0]==="execution_interrupted")}get isHistory(){return this.taskType==="History"}get isRunning(){return this.taskType==="Running"}get displayStatus(){switch(this.taskType){case"Running":return"Running";case"Pending":return"Pending";case"History":if(this.interrupted)return"Cancelled";switch(this.status.status_str){case"success":return"Completed";case"error":return"Failed"}}}get executionStartTimestamp(){const o=this.messages.find(n=>n[0]==="execution_start");return o?o[1].timestamp:void 0}get executionEndTimestamp(){const o=this.messages.filter(n=>["execution_success","execution_interrupted","execution_error"].includes(n[0]));if(o.length)return toolkit.max(o.map(n=>n[1].timestamp))}get executionTime(){if(!(!this.executionStartTimestamp||!this.executionEndTimestamp))return this.executionEndTimestamp-this.executionStartTimestamp}get executionTimeInSeconds(){return this.executionTime!==void 0?this.executionTime/1e3:void 0}async loadWorkflow(o){let n=this.workflow;if(!n||(await o.loadGraphData(toRaw(n)),!this.outputs))return;const s=useNodeOutputStore(),a=toRaw(this.outputs);for(const r in a)s.setNodeOutputsByExecutionId(r,a[r]);useExtensionService().invokeExtensions("onNodeOutputsUpdated",o.nodeOutputs)}flatten(){return this.displayStatus!=="Completed"?[this]:this.flatOutputs.map((o,n)=>new TaskItemImpl(this.taskType,[this.queueIndex,`${this.promptId}-${n}`,this.promptInputs,this.extraData,this.outputsToExecute],this.status,{[o.nodeId]:{[o.mediaType]:[o]}},[o]))}toTaskItem(){return{taskType:"History",prompt:this.prompt,status:this.status,outputs:this.outputs}}}const sortNewestFirst=p((i,o)=>o.queueIndex-i.queueIndex,"sortNewestFirst"),toTaskItemImpls=p(i=>i.map(o=>new TaskItemImpl(o.taskType,o.prompt,"status"in o?o.status:void 0,"outputs"in o?o.outputs:void 0)),"toTaskItemImpls"),useQueueStore=defineStore("queue",()=>{const i=shallowRef([]),o=shallowRef([]),n=shallowRef([]),s=ref(64),a=ref(!1),r=computed(()=>[...o.value,...i.value,...n.value]),l=computed(()=>r.value.flatMap(b=>b.flatten())),u=computed(()=>n.value.length?n.value[0].queueIndex:-1),m=computed(()=>o.value.length>0),f=p(async()=>{a.value=!0;try{const[b,w]=await Promise.all([api.getQueue(),api.getHistory(s.value)]);i.value=toTaskItemImpls(b.Running).sort(sortNewestFirst),o.value=toTaskItemImpls(b.Pending).sort(sortNewestFirst);const k=toValue(n),S=[...o.value,...i.value],C=useExecutionStore();S.forEach(E=>{const N=String(E.promptId),L=E.workflow?.id;L&&N&&C.registerPromptWorkflowIdMapping(N,L)});const I=reconcileHistory(w.History,k.map(E=>E.toTaskItem()),toValue(s),toValue(u)),T=new Map(k.map(E=>[E.promptId,E]));n.value=I.map(E=>T.get(E.prompt[1])??toTaskItemImpls([E])[0])}finally{a.value=!1}},"update");return{runningTasks:i,pendingTasks:o,historyTasks:n,maxHistoryItems:s,isLoading:a,tasks:r,flatTasks:l,lastHistoryQueueIndex:u,hasPendingTasks:m,update:f,clear:p(async(b=["queue","history"])=>{b.length!==0&&(await Promise.all(b.map(w=>api.clearItems(w))),await f())},"clear"),delete:p(async b=>{await api.deleteItem(b.apiTaskType,b.promptId),await f()},"deleteTask")}}),useQueuePendingTaskCountStore=defineStore("queuePendingTaskCount",{state:p(()=>({count:0}),"state"),actions:{update(i){this.count=i.detail?.exec_info?.queue_remaining||0}}}),useQueueSettingsStore=defineStore("queueSettingsStore",{state:p(()=>({mode:"disabled",batchCount:1}),"state")}),_hoisted_1$21={class:"flex flex-col items-center"},_sfc_main$2s=defineComponent({__name:"NoResultsPlaceholder",props:{class:{},icon:{},title:{},message:{},textClass:{},buttonLabel:{}},emits:["action"],setup(i){const o=i;return(n,s)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["no-results-placeholder h-full p-8",o.class])},[createVNode(unref(script$6),null,{content:withCtx(()=>[createBaseVNode("div",_hoisted_1$21,[createBaseVNode("i",{class:normalizeClass(n.icon),style:{"font-size":"3rem","margin-bottom":"1rem"}},null,2),createBaseVNode("h3",null,toDisplayString(n.title),1),createBaseVNode("p",{class:normalizeClass([n.textClass,"text-center whitespace-pre-line"])},toDisplayString(n.message),3),n.buttonLabel?(openBlock(),createBlock(unref(script),{key:0,label:n.buttonLabel,class:"p-button-text",onClick:s[0]||(s[0]=a=>n.$emit("action"))},null,8,["label"])):createCommentVNode("",!0)])]),_:1})],2))}}),NoResultsPlaceholder=_export_sfc(_sfc_main$2s,[["__scopeId","data-v-57ffa913"]]),_sfc_main$2r=defineComponent({__name:"VirtualGrid",props:{items:{},gridStyle:{},bufferRows:{default:1},scrollThrottle:{default:64},resizeDebounce:{default:64},defaultItemHeight:{default:200},defaultItemWidth:{default:200}},emits:["approach-end"],setup(i,{emit:o}){const n=o,s=ref(i.defaultItemHeight),a=ref(i.defaultItemWidth),r=ref(null),{width:l,height:u}=useElementSize(r),{y:m}=useScroll(r,{throttle:i.scrollThrottle,eventListenerOptions:{passive:!0}}),f=computed(()=>Math.floor(l.value/a.value)||1),_=computed(()=>Math.ceil(u.value/s.value)),y=computed(()=>Math.floor(m.value/s.value)),b=computed(()=>u.value&&l.value&&i.items?.length),w=computed(()=>{const I=y.value-i.bufferRows,T=y.value+i.bufferRows+_.value,E=I*f.value,N=T*f.value,L=i.items.length-N,A=L>=0;return{start:clamp(E,0,i.items?.length),end:clamp(N,E,i.items?.length),isNearEnd:A&&L<=f.value*i.bufferRows}}),k=computed(()=>b.value?i.items.slice(w.value.start,w.value.end):[]);whenever(()=>w.value.isNearEnd,()=>{n("approach-end")});const S=p(()=>{if(r.value){const I=r.value.querySelector("[data-virtual-grid-item]");if(!I?.clientHeight||!I?.clientWidth)return;s.value!==I.clientHeight&&(s.value=I.clientHeight),a.value!==I.clientWidth&&(a.value=I.clientWidth)}},"updateItemSize"),C=debounce(S,i.resizeDebounce);return watch([l,u],C,{flush:"post"}),whenever(()=>i.items,S,{flush:"post"}),onBeforeUnmount(()=>{C.cancel()}),(I,T)=>(openBlock(),createElementBlock("div",{ref_key:"container",ref:r,class:"scroll-container"},[createBaseVNode("div",{style:normalizeStyle({height:`${w.value.start/f.value*s.value}px`})},null,4),createBaseVNode("div",{style:normalizeStyle(I.gridStyle)},[(openBlock(!0),createElementBlock(Fragment,null,renderList(k.value,E=>(openBlock(),createElementBlock("div",{key:E.key,"data-virtual-grid-item":""},[renderSlot(I.$slots,"item",{item:E},void 0,!0)]))),128))],4),createBaseVNode("div",{style:normalizeStyle({height:`${(I.items.length-w.value.end)/f.value*s.value}px`})},null,4)],512))}}),VirtualGrid=_export_sfc(_sfc_main$2r,[["__scopeId","data-v-591f5536"]]),_hoisted_1$20={class:"space-y-4"},_hoisted_2$1x={class:"space-y-4"},_hoisted_3$14={key:0,class:"space-y-4"},_sfc_main$2q=defineComponent({__name:"ViewerCameraControls",props:{cameraType:{},cameraTypeModifiers:{},fov:{},fovModifiers:{}},emits:["update:cameraType","update:fov"],setup(i){const o=[{title:t("load3d.cameraType.perspective"),value:"perspective"},{title:t("load3d.cameraType.orthographic"),value:"orthographic"}],n=useModel(i,"cameraType"),s=useModel(i,"fov"),a=computed(()=>n.value==="perspective");return(r,l)=>(openBlock(),createElementBlock("div",_hoisted_1$20,[createBaseVNode("div",_hoisted_2$1x,[createBaseVNode("label",null,toDisplayString(unref(t)("load3d.viewer.cameraType")),1),createVNode(unref(script$7),{modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=u=>n.value=u),options:o,"option-label":"title","option-value":"value"},null,8,["modelValue"])]),a.value?(openBlock(),createElementBlock("div",_hoisted_3$14,[createBaseVNode("label",null,toDisplayString(unref(t)("load3d.fov")),1),createVNode(unref(script$8),{modelValue:s.value,"onUpdate:modelValue":l[1]||(l[1]=u=>s.value=u),min:10,max:150,step:1,"aria-label":unref(t)("load3d.fov")},null,8,["modelValue","aria-label"])])):createCommentVNode("",!0)]))}}),_hoisted_1$1$={class:"space-y-4"},_sfc_main$2p=defineComponent({__name:"ViewerExportControls",emits:["exportModel"],setup(i,{emit:o}){const n=o,s=[{label:"GLB",value:"glb"},{label:"OBJ",value:"obj"},{label:"STL",value:"stl"}],a=ref("obj"),r=p(l=>{n("exportModel",l)},"exportModel");return(l,u)=>(openBlock(),createElementBlock("div",_hoisted_1$1$,[createVNode(unref(script$7),{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=m=>a.value=m),options:s,"option-label":"label","option-value":"value"},null,8,["modelValue"]),createVNode(unref(script),{severity:"secondary",text:"",rounded:"",onClick:u[1]||(u[1]=m=>r(a.value))},{default:withCtx(()=>[createTextVNode(toDisplayString(l.$t("load3d.export")),1)]),_:1})]))}}),_hoisted_1$1_={class:"space-y-4"},_sfc_main$2o=defineComponent({__name:"ViewerLightControls",props:{lightIntensity:{},lightIntensityModifiers:{}},emits:["update:lightIntensity"],setup(i){const o=useModel(i,"lightIntensity"),n=useSettingStore().get("Comfy.Load3D.LightIntensityMaximum"),s=useSettingStore().get("Comfy.Load3D.LightIntensityMinimum"),a=useSettingStore().get("Comfy.Load3D.LightAdjustmentIncrement");return(r,l)=>(openBlock(),createElementBlock("div",_hoisted_1$1_,[createBaseVNode("label",null,toDisplayString(r.$t("load3d.lightIntensity")),1),createVNode(unref(script$8),{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=u=>o.value=u),class:"w-full",min:unref(s),max:unref(n),step:unref(a)},null,8,["modelValue","min","max","step"])]))}}),_hoisted_1$1Z={class:"space-y-4"},_sfc_main$2n=defineComponent({__name:"ViewerModelControls",props:{upDirection:{},upDirectionModifiers:{},materialMode:{},materialModeModifiers:{}},emits:["update:upDirection","update:materialMode"],setup(i){const o=useModel(i,"upDirection"),n=useModel(i,"materialMode"),s=[{label:t("load3d.upDirections.original"),value:"original"},{label:"-X",value:"-x"},{label:"+X",value:"+x"},{label:"-Y",value:"-y"},{label:"+Y",value:"+y"},{label:"-Z",value:"-z"},{label:"+Z",value:"+z"}],a=computed(()=>[{label:t("load3d.materialModes.original"),value:"original"},{label:t("load3d.materialModes.normal"),value:"normal"},{label:t("load3d.materialModes.wireframe"),value:"wireframe"}]);return(r,l)=>(openBlock(),createElementBlock("div",_hoisted_1$1Z,[createBaseVNode("div",null,[createBaseVNode("label",null,toDisplayString(r.$t("load3d.upDirection")),1),createVNode(unref(script$7),{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=u=>o.value=u),options:s,"option-label":"label","option-value":"value"},null,8,["modelValue"])]),createBaseVNode("div",null,[createBaseVNode("label",null,toDisplayString(r.$t("load3d.materialMode")),1),createVNode(unref(script$7),{modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=u=>n.value=u),options:a.value,"option-label":"label","option-value":"value"},null,8,["modelValue","options"])])]))}}),_hoisted_1$1Y={class:"space-y-4"},_hoisted_2$1w={key:0},_hoisted_3$13={for:"showGrid",class:"pl-2"},_hoisted_4$L={key:1},_hoisted_5$F={key:2,class:"space-y-2"},_hoisted_6$t={class:"flex gap-2"},_sfc_main$2m=defineComponent({__name:"ViewerSceneControls",props:mergeModels({hasBackgroundImage:{type:Boolean},disableBackgroundUpload:{type:Boolean}},{backgroundColor:{},backgroundColorModifiers:{},showGrid:{type:Boolean},showGridModifiers:{},backgroundRenderMode:{},backgroundRenderModeModifiers:{}}),emits:mergeModels(["updateBackgroundImage"],["update:backgroundColor","update:showGrid","update:backgroundRenderMode"]),setup(i,{emit:o}){const n=useModel(i,"backgroundColor"),s=useModel(i,"showGrid"),a=useModel(i,"backgroundRenderMode"),r=o,l=ref(null),u=p(()=>{l.value?.click()},"openImagePicker"),m=p(y=>{const b=y.target;b.files&&b.files[0]&&r("updateBackgroundImage",b.files[0]),b.value=""},"handleImageUpload"),f=p(()=>{r("updateBackgroundImage",null)},"removeBackgroundImage"),_=p(y=>{a.value=y},"setBackgroundRenderMode");return(y,b)=>(openBlock(),createElementBlock("div",_hoisted_1$1Y,[y.hasBackgroundImage?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_2$1w,[createBaseVNode("label",null,toDisplayString(y.$t("load3d.backgroundColor")),1),withDirectives(createBaseVNode("input",{"onUpdate:modelValue":b[0]||(b[0]=w=>n.value=w),type:"color",class:"w-full"},null,512),[[vModelText,n.value]])])),createBaseVNode("div",null,[createVNode(unref(script$9),{modelValue:s.value,"onUpdate:modelValue":b[1]||(b[1]=w=>s.value=w),"input-id":"showGrid",binary:"",name:"showGrid"},null,8,["modelValue"]),createBaseVNode("label",_hoisted_3$13,toDisplayString(y.$t("load3d.showGrid")),1)]),!y.hasBackgroundImage&&!y.disableBackgroundUpload?(openBlock(),createElementBlock("div",_hoisted_4$L,[createVNode(unref(script),{severity:"secondary",label:y.$t("load3d.uploadBackgroundImage"),icon:"pi pi-image",class:"w-full",onClick:u},null,8,["label"]),createBaseVNode("input",{ref_key:"imagePickerRef",ref:l,type:"file",accept:"image/*",class:"hidden",onChange:m},null,544)])):createCommentVNode("",!0),y.hasBackgroundImage?(openBlock(),createElementBlock("div",_hoisted_5$F,[createBaseVNode("div",_hoisted_6$t,[createVNode(unref(script),{severity:a.value==="tiled"?"primary":"secondary",label:y.$t("load3d.tiledMode"),icon:"pi pi-th-large",class:"flex-1",onClick:b[2]||(b[2]=w=>_("tiled"))},null,8,["severity","label"]),createVNode(unref(script),{severity:a.value==="panorama"?"primary":"secondary",label:y.$t("load3d.panoramaMode"),icon:"pi pi-globe",class:"flex-1",onClick:b[3]||(b[3]=w=>_("panorama"))},null,8,["severity","label"])]),createVNode(unref(script),{severity:"secondary",label:y.$t("load3d.removeBackgroundImage"),icon:"pi pi-times",class:"w-full",onClick:f},null,8,["label"])])):createCommentVNode("",!0)]))}}),SUPPORTED_EXTENSIONS=new Set([".gltf",".glb",".obj",".fbx",".stl"]);window.comfyAPI=window.comfyAPI||{};window.comfyAPI.interfaces=window.comfyAPI.interfaces||{};window.comfyAPI.interfaces.SUPPORTED_EXTENSIONS=SUPPORTED_EXTENSIONS;function useLoad3dDrag(i){const o=ref(!1),n=ref(""),s=computed(()=>toValue(i.disabled)??!1);function a(m){const f=m.name.toLowerCase(),_=f.substring(f.lastIndexOf("."));return SUPPORTED_EXTENSIONS.has(_)}p(a,"isValidModelFile");function r(m){s.value||!m.dataTransfer||!m.dataTransfer.types.includes("Files")||(o.value=!0,m.dataTransfer.dropEffect="copy",n.value=t("load3d.dropToLoad"))}p(r,"handleDragOver");function l(){o.value=!1}p(l,"handleDragLeave");async function u(m){if(o.value=!1,s.value||!m.dataTransfer)return;const f=Array.from(m.dataTransfer.files);if(f.length===0)return;const _=f.find(a);_?await i.onModelDrop(_):useToastStore().addAlert(t("load3d.unsupportedFileType"))}return p(u,"handleDrop"),{isDragging:o,dragMessage:n,handleDragOver:r,handleDragLeave:l,handleDrop:u}}p(useLoad3dDrag,"useLoad3dDrag");class AnimationManager{static{p(this,"AnimationManager")}currentAnimation=null;animationActions=[];animationClips=[];selectedAnimationIndex=0;isAnimationPlaying=!1;animationSpeed=1;eventManager;constructor(o){this.eventManager=o}init(){}dispose(){this.currentAnimation&&(this.animationActions.forEach(o=>{o.stop()}),this.currentAnimation=null),this.animationActions=[],this.animationClips=[],this.selectedAnimationIndex=0,this.isAnimationPlaying=!1,this.animationSpeed=1,this.eventManager.emitEvent("animationListChange",[])}setupModelAnimations(o,n){this.currentAnimation&&(this.currentAnimation.stopAllAction(),this.animationActions=[]);let s=[];o.animations?.length>0?s=o.animations:n&&"animations"in n&&Array.isArray(n.animations)&&(s=n.animations),s.length>0?(this.animationClips=s,this.currentAnimation=new AnimationMixer(o),this.animationClips.length>0&&this.updateSelectedAnimation(0)):this.animationClips=[],this.updateAnimationList()}updateAnimationList(){let o=[];this.animationClips.length>0&&(o=this.animationClips.map((n,s)=>({name:n.name||`Animation ${s+1}`,index:s}))),this.eventManager.emitEvent("animationListChange",o)}setAnimationSpeed(o){this.animationSpeed=o,this.animationActions.forEach(n=>{n.setEffectiveTimeScale(o)})}updateSelectedAnimation(o){if(!this.currentAnimation||!this.animationClips||o>=this.animationClips.length){console.warn("Invalid animation update request");return}this.animationActions.forEach(a=>{a.stop()}),this.currentAnimation.stopAllAction(),this.animationActions=[],this.selectedAnimationIndex=o;const n=this.animationClips[o],s=this.currentAnimation.clipAction(n);s.setEffectiveTimeScale(this.animationSpeed),s.reset(),s.clampWhenFinished=!1,s.loop=LoopRepeat,this.isAnimationPlaying?s.play():(s.play(),s.paused=!0),this.animationActions=[s]}toggleAnimation(o){if(!this.currentAnimation||this.animationActions.length===0){console.warn("No animation to toggle");return}this.isAnimationPlaying=o??!this.isAnimationPlaying,this.animationActions.forEach(n=>{this.isAnimationPlaying?(n.paused=!1,(n.time===0||n.time===n.getClip().duration)&&n.reset()):n.paused=!0})}update(o){this.currentAnimation&&this.isAnimationPlaying&&this.currentAnimation.update(o)}reset(){}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.AnimationManager=window.comfyAPI.AnimationManager||{};window.comfyAPI.AnimationManager.AnimationManager=AnimationManager;class CameraManager{static{p(this,"CameraManager")}perspectiveCamera;orthographicCamera;activeCamera;renderer;eventManager;controls=null;DEFAULT_DISTANCE=10;DEFAULT_LOOK_AT=0;DEFAULT_CAMERA={near:.01,far:1e4};DEFAULT_PERSPECTIVE_CAMERA={fov:35,aspect:1};DEFAULT_FRUSTUM_SIZE=10;DEFAULT_ORTHOGRAPHIC_CAMERA={left:-this.DEFAULT_FRUSTUM_SIZE/2,right:this.DEFAULT_FRUSTUM_SIZE/2,top:this.DEFAULT_FRUSTUM_SIZE/2,bottom:-this.DEFAULT_FRUSTUM_SIZE/2};constructor(o,n){this.renderer=o,this.eventManager=n,this.perspectiveCamera=new PerspectiveCamera(this.DEFAULT_PERSPECTIVE_CAMERA.fov,this.DEFAULT_PERSPECTIVE_CAMERA.aspect,this.DEFAULT_CAMERA.near,this.DEFAULT_CAMERA.far),this.orthographicCamera=new OrthographicCamera(this.DEFAULT_ORTHOGRAPHIC_CAMERA.left,this.DEFAULT_ORTHOGRAPHIC_CAMERA.right,this.DEFAULT_ORTHOGRAPHIC_CAMERA.top,this.DEFAULT_ORTHOGRAPHIC_CAMERA.bottom,this.DEFAULT_CAMERA.near,this.DEFAULT_CAMERA.far),this.reset(),this.activeCamera=this.perspectiveCamera}init(){}dispose(){}setControls(o){this.controls=o,this.controls&&this.controls.addEventListener("end",()=>{this.eventManager.emitEvent("cameraChanged",this.getCameraState())})}getCurrentCameraType(){return this.activeCamera===this.perspectiveCamera?"perspective":"orthographic"}toggleCamera(o){const n=this.activeCamera,s=n.position.clone(),a=n.rotation.clone(),r=this.controls?.target.clone()||new Vector3,l=(n instanceof OrthographicCamera,n.zoom);if(!o)this.activeCamera=n===this.perspectiveCamera?this.orthographicCamera:this.perspectiveCamera;else if(this.activeCamera=o==="perspective"?this.perspectiveCamera:this.orthographicCamera,n===this.activeCamera)return;this.activeCamera.position.copy(s),this.activeCamera.rotation.copy(a),this.activeCamera instanceof OrthographicCamera?(this.activeCamera.zoom=l,this.activeCamera.updateProjectionMatrix()):this.activeCamera instanceof PerspectiveCamera&&(this.activeCamera.zoom=l,this.activeCamera.updateProjectionMatrix()),this.controls&&(this.controls.object=this.activeCamera,this.controls.target.copy(r),this.controls.update()),this.eventManager.emitEvent("cameraTypeChange",o)}setFOV(o){this.activeCamera===this.perspectiveCamera&&(this.perspectiveCamera.fov=o,this.perspectiveCamera.updateProjectionMatrix()),this.eventManager.emitEvent("fovChange",o)}getCameraState(){return{position:this.activeCamera.position.clone(),target:this.controls?.target.clone()||new Vector3,zoom:this.activeCamera instanceof OrthographicCamera?this.activeCamera.zoom:this.activeCamera.zoom,cameraType:this.getCurrentCameraType()}}setCameraState(o){this.activeCamera.position.copy(o.position),this.controls?.target.copy(o.target),this.activeCamera instanceof OrthographicCamera?(this.activeCamera.zoom=o.zoom,this.activeCamera.updateProjectionMatrix()):this.activeCamera instanceof PerspectiveCamera&&(this.activeCamera.zoom=o.zoom,this.activeCamera.updateProjectionMatrix()),this.controls?.update()}handleResize(o,n){const s=o/n;this.updateAspectRatio(s)}updateAspectRatio(o){this.activeCamera===this.perspectiveCamera?(this.perspectiveCamera.aspect=o,this.perspectiveCamera.updateProjectionMatrix()):(this.orthographicCamera.left=-10*o/2,this.orthographicCamera.right=10*o/2,this.orthographicCamera.top=10/2,this.orthographicCamera.bottom=-10/2,this.orthographicCamera.updateProjectionMatrix())}setupForModel(o){const n=Math.max(o.x,o.z)*2,s=o.y*2;if(this.perspectiveCamera.position.set(n,s,n),this.orthographicCamera.position.set(n,s,n),this.activeCamera===this.perspectiveCamera)this.perspectiveCamera.lookAt(0,o.y/2,0),this.perspectiveCamera.updateProjectionMatrix();else{const a=Math.max(o.x,o.y,o.z)*2,r=this.perspectiveCamera.aspect;this.orthographicCamera.left=-a*r/2,this.orthographicCamera.right=a*r/2,this.orthographicCamera.top=a/2,this.orthographicCamera.bottom=-a/2,this.orthographicCamera.lookAt(0,o.y/2,0),this.orthographicCamera.updateProjectionMatrix()}this.controls?.target.set(0,o.y/2,0),this.controls?.update()}reset(){this.perspectiveCamera.position.set(this.DEFAULT_DISTANCE,this.DEFAULT_DISTANCE,this.DEFAULT_DISTANCE),this.orthographicCamera.position.set(this.DEFAULT_DISTANCE,this.DEFAULT_DISTANCE,this.DEFAULT_DISTANCE),this.perspectiveCamera.lookAt(this.DEFAULT_LOOK_AT,this.DEFAULT_LOOK_AT,this.DEFAULT_LOOK_AT),this.orthographicCamera.lookAt(this.DEFAULT_LOOK_AT,this.DEFAULT_LOOK_AT,this.DEFAULT_LOOK_AT),this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.updateProjectionMatrix()}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.CameraManager=window.comfyAPI.CameraManager||{};window.comfyAPI.CameraManager.CameraManager=CameraManager;class ControlsManager{static{p(this,"ControlsManager")}controls;eventManager;camera;constructor(o,n,s){this.eventManager=s,this.camera=n;const a=o.domElement.parentElement||o.domElement;this.controls=new OrbitControls(n,a),this.controls.enableDamping=!0}init(){this.controls.addEventListener("end",()=>{const o={position:this.camera.position.clone(),target:this.controls.target.clone(),zoom:this.camera instanceof OrthographicCamera?this.camera.zoom:this.camera.zoom,cameraType:this.camera instanceof PerspectiveCamera?"perspective":"orthographic"};this.eventManager.emitEvent("cameraChanged",o)})}dispose(){this.controls.dispose()}handleResize(){}update(){this.controls.update()}updateCamera(o){const n=this.controls.object.position.clone(),s=this.controls.target.clone();this.camera=o,this.controls.object=o,this.controls.target=s,o.position.copy(n),this.controls.update()}reset(){this.controls.target.set(0,0,0),this.controls.update()}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.ControlsManager=window.comfyAPI.ControlsManager||{};window.comfyAPI.ControlsManager.ControlsManager=ControlsManager;class EventManager{static{p(this,"EventManager")}listeners={};addEventListener(o,n){this.listeners[o]||(this.listeners[o]=[]),this.listeners[o].push(n)}removeEventListener(o,n){this.listeners[o]&&(this.listeners[o]=this.listeners[o].filter(s=>s!==n))}emitEvent(o,n){this.listeners[o]&&this.listeners[o].forEach(s=>s(n))}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.EventManager=window.comfyAPI.EventManager||{};window.comfyAPI.EventManager.EventManager=EventManager;class LightingManager{static{p(this,"LightingManager")}lights=[];currentIntensity=3;scene;eventManager;constructor(o,n){this.scene=o,this.eventManager=n}init(){this.setupLights()}dispose(){this.lights.forEach(o=>{this.scene.remove(o)}),this.lights=[]}setupLights(){const o=new AmbientLight(16777215,.5);this.scene.add(o),this.lights.push(o);const n=new DirectionalLight(16777215,.8);n.position.set(0,10,10),this.scene.add(n),this.lights.push(n);const s=new DirectionalLight(16777215,.5);s.position.set(0,10,-10),this.scene.add(s),this.lights.push(s);const a=new DirectionalLight(16777215,.3);a.position.set(-10,0,0),this.scene.add(a),this.lights.push(a);const r=new DirectionalLight(16777215,.3);r.position.set(10,0,0),this.scene.add(r),this.lights.push(r);const l=new DirectionalLight(16777215,.2);l.position.set(0,-10,0),this.scene.add(l),this.lights.push(l)}setLightIntensity(o){this.currentIntensity=o,this.lights.forEach(n=>{n instanceof DirectionalLight?n===this.lights[1]?n.intensity=o*.8:n===this.lights[2]?n.intensity=o*.5:n===this.lights[5]?n.intensity=o*.2:n.intensity=o*.3:n instanceof AmbientLight&&(n.intensity=o*.5)}),this.eventManager.emitEvent("lightIntensityChange",o)}reset(){}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.LightingManager=window.comfyAPI.LightingManager||{};window.comfyAPI.LightingManager.LightingManager=LightingManager;class LoaderManager{static{p(this,"LoaderManager")}gltfLoader;objLoader;mtlLoader;fbxLoader;stlLoader;modelManager;eventManager;constructor(o,n){this.modelManager=o,this.eventManager=n,this.gltfLoader=new GLTFLoader,this.objLoader=new OBJLoader,this.mtlLoader=new MTLLoader,this.fbxLoader=new FBXLoader,this.stlLoader=new STLLoader}init(){}dispose(){}async loadModel(o,n){try{this.eventManager.emitEvent("modelLoadingStart",null),this.modelManager.clearModel(),this.modelManager.originalURL=o;let s;if(n)s=n.split(".").pop()?.toLowerCase(),this.modelManager.originalFileName=n.split("/").pop()?.split(".")[0]||"model";else{const r=new URLSearchParams(o.split("?")[1]).get("filename");s=r?.split(".").pop()?.toLowerCase(),r?this.modelManager.originalFileName=r.split(".")[0]||"model":this.modelManager.originalFileName="model"}if(!s){useToastStore().addAlert(t("toastMessages.couldNotDetermineFileType"));return}let a=await this.loadModelInternal(o,s);a&&await this.modelManager.setupModel(a),this.eventManager.emitEvent("modelLoadingEnd",null)}catch(s){this.eventManager.emitEvent("modelLoadingEnd",null),console.error("Error loading model:",s),useToastStore().addAlert(t("toastMessages.errorLoadingModel"))}}async loadModelInternal(o,n){let s=null;const a=new URLSearchParams(o.split("?")[1]),r=a.get("filename");if(!r)return console.error("Missing filename in URL:",o),null;const l=a.get("type")==="output"?"output":"input",u=a.get("subfolder")??"",m="api/view?type="+l+"&subfolder="+encodeURIComponent(u)+"&filename=";switch(n){case"stl":this.stlLoader.setPath(m);const f=await this.stlLoader.loadAsync(r);this.modelManager.setOriginalModel(f),f.computeVertexNormals();const _=new Mesh(f,this.modelManager.standardMaterial),y=new Group;y.add(_),s=y;break;case"fbx":this.fbxLoader.setPath(m);const b=await this.fbxLoader.loadAsync(r);this.modelManager.setOriginalModel(b),s=b,b.traverse(k=>{k instanceof Mesh&&this.modelManager.originalMaterials.set(k,k.material)});break;case"obj":if(this.modelManager.materialMode==="original")try{this.mtlLoader.setPath(m);const k=r.replace(/\.obj$/,".mtl"),S=await this.mtlLoader.loadAsync(k);S.preload(),this.objLoader.setMaterials(S)}catch{}this.objLoader.setPath(m),s=await this.objLoader.loadAsync(r),s.traverse(k=>{k instanceof Mesh&&this.modelManager.originalMaterials.set(k,k.material)});break;case"gltf":case"glb":this.gltfLoader.setPath(m);const w=await this.gltfLoader.loadAsync(r);this.modelManager.setOriginalModel(w),s=w.scene,w.scene.traverse(k=>{k instanceof Mesh&&(k.geometry.computeVertexNormals(),this.modelManager.originalMaterials.set(k,k.material))});break}return s}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.LoaderManager=window.comfyAPI.LoaderManager||{};window.comfyAPI.LoaderManager.LoaderManager=LoaderManager;class ModelExporter{static{p(this,"ModelExporter")}static detectFormatFromURL(o){try{const n=new URLSearchParams(o.split("?")[1]).get("filename");if(n)return n.split(".").pop()?.toLowerCase()||null}catch(n){console.error("Error parsing URL:",n)}return null}static canUseDirectURL(o,n){if(!o)return!1;const s=ModelExporter.detectFormatFromURL(o);return s?s.toLowerCase()===n.toLowerCase():!1}static async downloadFromURL(o,n){try{const a=await(await fetch(o)).blob();downloadBlob(n,a)}catch(s){throw console.error("Error downloading from URL:",s),useToastStore().addAlert(t("toastMessages.failedToDownloadFile")),s}}static async exportGLB(o,n="model.glb",s){if(s&&ModelExporter.canUseDirectURL(s,"glb"))return ModelExporter.downloadFromURL(s,n);const a=new GLTFExporter;try{await new Promise(l=>setTimeout(l,50));const r=await new Promise((l,u)=>{a.parse(o,m=>{l(m)},m=>{u(m)},{binary:!0})});await new Promise(l=>setTimeout(l,50)),ModelExporter.saveArrayBuffer(r,n)}catch(r){throw console.error("Error exporting GLB:",r),useToastStore().addAlert(t("toastMessages.failedToExportModel",{format:"GLB"})),r}}static async exportOBJ(o,n="model.obj",s){if(s&&ModelExporter.canUseDirectURL(s,"obj"))return ModelExporter.downloadFromURL(s,n);const a=new OBJExporter;try{await new Promise(l=>setTimeout(l,50));const r=a.parse(o);await new Promise(l=>setTimeout(l,50)),ModelExporter.saveString(r,n)}catch(r){throw console.error("Error exporting OBJ:",r),useToastStore().addAlert(t("toastMessages.failedToExportModel",{format:"OBJ"})),r}}static async exportSTL(o,n="model.stl",s){if(s&&ModelExporter.canUseDirectURL(s,"stl"))return ModelExporter.downloadFromURL(s,n);const a=new STLExporter;try{await new Promise(l=>setTimeout(l,50));const r=a.parse(o);await new Promise(l=>setTimeout(l,50)),ModelExporter.saveString(r,n)}catch(r){throw console.error("Error exporting STL:",r),useToastStore().addAlert(t("toastMessages.failedToExportModel",{format:"STL"})),r}}static saveArrayBuffer(o,n){const s=new Blob([o],{type:"application/octet-stream"});downloadBlob(n,s)}static saveString(o,n){const s=new Blob([o],{type:"text/plain"});downloadBlob(n,s)}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.ModelExporter=window.comfyAPI.ModelExporter||{};window.comfyAPI.ModelExporter.ModelExporter=ModelExporter;class RecordingManager{static{p(this,"RecordingManager")}mediaRecorder=null;recordedChunks=[];isRecording=!1;recordingStream=null;recordingIndicator=null;scene;renderer;eventManager;recordingStartTime=0;recordingDuration=0;recordingCanvas=null;recordingContext=null;animationFrameId=null;constructor(o,n,s){this.scene=o,this.renderer=n,this.eventManager=s,this.setupRecordingIndicator()}setupRecordingIndicator(){const o=new TextureLoader().load("data:image/svg+xml;base64,"+btoa(`<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64">
        <circle cx="32" cy="32" r="24" fill="#4CAF50" opacity="0.8" />
        <circle cx="32" cy="32" r="16" fill="#2E7D32" opacity="0.8" />
      </svg>`)),n=new SpriteMaterial({map:o,transparent:!0,depthTest:!1,depthWrite:!1});this.recordingIndicator=new Sprite(n),this.recordingIndicator.scale.set(.5,.5,.5),this.recordingIndicator.position.set(-.8,.8,0),this.recordingIndicator.visible=!1,this.scene.add(this.recordingIndicator)}async startRecording(o,n){if(!this.isRecording)try{const s=this.renderer.domElement,a=s.width,r=s.height,l=o||a,u=n||r;if(this.recordingCanvas=document.createElement("canvas"),this.recordingCanvas.width=l,this.recordingCanvas.height=u,this.recordingContext=this.recordingCanvas.getContext("2d",{alpha:!1}),!this.recordingContext)throw new Error("Failed to get 2D context for recording canvas");const m=a/r,f=l/u;let _=0,y=0,b=a,w=r;Math.abs(m-f)>.01&&(m>f?(b=r*f,_=(a-b)/2):(w=a/f,y=(r-w)/2));const k=p(()=>{!this.isRecording||!this.recordingContext||(this.recordingContext.drawImage(s,_,y,b,w,0,0,l,u),this.animationFrameId=requestAnimationFrame(k))},"captureFrame");if(this.recordingStream=this.recordingCanvas.captureStream(30),!this.recordingStream)throw new Error("Failed to capture stream from canvas");this.mediaRecorder=new MediaRecorder(this.recordingStream,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:5e6}),this.recordedChunks=[],this.mediaRecorder.ondataavailable=S=>{S.data.size>0&&this.recordedChunks.push(S.data)},this.mediaRecorder.onstop=()=>{this.recordingIndicator.visible=!1,this.isRecording=!1,this.recordingStream=null,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.eventManager.emitEvent("recordingStopped",{duration:this.recordingDuration,hasRecording:this.recordedChunks.length>0})},this.recordingIndicator&&(this.recordingIndicator.visible=!0),this.mediaRecorder.start(100),this.isRecording=!0,this.recordingStartTime=Date.now(),k(),this.eventManager.emitEvent("recordingStarted",null)}catch(s){console.error("Error starting recording:",s),this.eventManager.emitEvent("recordingError",s)}}stopRecording(){!this.isRecording||!this.mediaRecorder||(this.recordingDuration=(Date.now()-this.recordingStartTime)/1e3,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.mediaRecorder.stop(),this.recordingStream&&this.recordingStream.getTracks().forEach(o=>o.stop()),this.recordingCanvas=null,this.recordingContext=null)}getIsRecording(){return this.isRecording}hasRecording(){return this.recordedChunks.length>0}getRecordingDuration(){return this.recordingDuration}getRecordingData(){if(this.recordedChunks.length!==0){const o=new Blob(this.recordedChunks,{type:"video/webm"});return URL.createObjectURL(o)}return null}exportRecording(o="scene-recording.mp4"){if(this.recordedChunks.length===0){this.eventManager.emitEvent("recordingError",new Error("No recording available to export"));return}this.eventManager.emitEvent("exportingRecording",null);try{const n=new Blob(this.recordedChunks,{type:"video/webm"});downloadBlob(o,n),this.eventManager.emitEvent("recordingExported",null)}catch(n){console.error("Error exporting recording:",n),this.eventManager.emitEvent("recordingError",n)}}clearRecording(){this.recordedChunks=[],this.recordingDuration=0,this.eventManager.emitEvent("recordingCleared",null)}dispose(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.stopRecording(),this.clearRecording(),this.recordingCanvas=null,this.recordingContext=null,this.recordingIndicator&&(this.scene.remove(this.recordingIndicator),this.recordingIndicator.material.map?.dispose(),this.recordingIndicator.material.dispose())}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.RecordingManager=window.comfyAPI.RecordingManager||{};window.comfyAPI.RecordingManager.RecordingManager=RecordingManager;class Load3dUtils{static{p(this,"Load3dUtils")}static async uploadTempImage(o,n,s="png"){const a=await fetch(o).then(f=>f.blob()),r=`${n}_${Date.now()}.${s}`,l=new File([a],r,{type:s==="mp4"?"video/mp4":"image/png"}),u=new FormData;u.append("image",l),u.append("subfolder","threed"),u.append("type","temp");const m=await api.fetchApi("/upload/image",{method:"POST",body:u});if(m.status!==200){const f=`Error uploading temp file: ${m.status} - ${m.statusText}`;throw useToastStore().addAlert(f),new Error(f)}return await m.json()}static async uploadFile(o,n){let s;try{const a=new FormData;a.append("image",o),a.append("subfolder",n);const r=await api.fetchApi("/upload/image",{method:"POST",body:a});if(r.status===200){const l=await r.json();let u=l.name;l.subfolder&&(u=l.subfolder+"/"+u),s=u}else useToastStore().addAlert(r.status+" - "+r.statusText)}catch(a){console.error("Upload error:",a),useToastStore().addAlert(a instanceof Error?a.message:t("toastMessages.fileUploadFailed"))}return s}static splitFilePath(o){const n=o.lastIndexOf("/");return n===-1?["",o]:[o.substring(0,n),o.substring(n+1)]}static getResourceURL(o,n,s="input"){return`/view?${["filename="+encodeURIComponent(n),"type="+s,"subfolder="+o,app$1.getRandParam().substring(1)].join("&")}`}static async uploadMultipleFiles(o,n="3d"){const s=Array.from(o).map(a=>this.uploadFile(a,n));await Promise.all(s)}}class SceneManager{static{p(this,"SceneManager")}scene;gridHelper;backgroundScene;backgroundCamera;backgroundMesh=null;backgroundTexture=null;backgroundRenderMode="tiled";backgroundColorMaterial=null;currentBackgroundType="color";currentBackgroundColor="#282828";eventManager;renderer;getActiveCamera;getControls;constructor(o,n,s,a){this.renderer=o,this.eventManager=a,this.scene=new Scene,this.getActiveCamera=n,this.getControls=s,this.gridHelper=new GridHelper(20,20),this.gridHelper.position.set(0,0,0),this.scene.add(this.gridHelper),this.backgroundScene=new Scene,this.backgroundCamera=new OrthographicCamera(-1,1,1,-1,-1,1),this.initBackgroundScene()}initBackgroundScene(){const o=new PlaneGeometry(2,2);this.backgroundColorMaterial=new MeshBasicMaterial({color:new Color(this.currentBackgroundColor),transparent:!1,depthWrite:!1,depthTest:!1,side:DoubleSide}),this.backgroundMesh=new Mesh(o,this.backgroundColorMaterial),this.backgroundMesh.position.set(0,0,0),this.backgroundScene.add(this.backgroundMesh),this.renderer.setClearColor(0,0)}init(){}dispose(){this.backgroundTexture&&this.backgroundTexture.dispose(),this.backgroundColorMaterial&&this.backgroundColorMaterial.dispose(),this.backgroundMesh&&(this.backgroundMesh.geometry.dispose(),this.backgroundMesh.material instanceof Material&&this.backgroundMesh.material.dispose()),this.scene.background&&(this.scene.background=null),this.scene.clear()}toggleGrid(o){this.gridHelper&&(this.gridHelper.visible=o),this.eventManager.emitEvent("showGridChange",o)}setBackgroundColor(o){this.currentBackgroundColor=o,this.currentBackgroundType="color",this.scene.background instanceof Texture&&(this.scene.background=null),this.backgroundRenderMode==="panorama"&&(this.backgroundRenderMode="tiled",this.eventManager.emitEvent("backgroundRenderModeChange","tiled")),(!this.backgroundMesh||!this.backgroundColorMaterial)&&this.initBackgroundScene(),this.backgroundColorMaterial.color.set(o),this.backgroundColorMaterial.map=null,this.backgroundColorMaterial.transparent=!1,this.backgroundColorMaterial.needsUpdate=!0,this.backgroundMesh&&(this.backgroundMesh.material=this.backgroundColorMaterial),this.backgroundTexture&&(this.backgroundTexture.dispose(),this.backgroundTexture=null),this.eventManager.emitEvent("backgroundColorChange",o)}async setBackgroundImage(o){if(o===""){this.setBackgroundColor(this.currentBackgroundColor);return}this.eventManager.emitEvent("backgroundImageLoadingStart",null);let n="input",s=Load3dUtils.splitFilePath(o),a=s[0],r=s[1];a==="temp"?(n="temp",s=["",r]):a==="output"&&(n="output",s=["",r]);let l=Load3dUtils.getResourceURL(...s,n);l.startsWith("/api")||(l="/api"+l);try{const u=new TextureLoader,m=await new Promise((f,_)=>{u.load(l,f,void 0,_)});if(this.backgroundTexture&&this.backgroundTexture.dispose(),m.colorSpace=SRGBColorSpace,this.backgroundTexture=m,this.currentBackgroundType="image",this.backgroundRenderMode==="panorama")m.mapping=EquirectangularReflectionMapping,this.scene.background=m;else{this.backgroundMesh||this.initBackgroundScene();const f=new MeshBasicMaterial({map:m,transparent:!0,depthWrite:!1,depthTest:!1,side:DoubleSide});this.backgroundMesh&&(this.backgroundMesh.material!==this.backgroundColorMaterial&&this.backgroundMesh.material instanceof Material&&this.backgroundMesh.material.dispose(),this.backgroundMesh.material=f,this.backgroundMesh.position.set(0,0,0)),this.updateBackgroundSize(this.backgroundTexture,this.backgroundMesh,this.renderer.domElement.clientWidth,this.renderer.domElement.clientHeight)}this.eventManager.emitEvent("backgroundImageChange",o),this.eventManager.emitEvent("backgroundImageLoadingEnd",null)}catch(u){this.eventManager.emitEvent("backgroundImageLoadingEnd",null),console.error("Error loading background image:",u),this.setBackgroundColor(this.currentBackgroundColor)}}removeBackgroundImage(){this.setBackgroundColor(this.currentBackgroundColor),this.eventManager.emitEvent("backgroundImageLoadingEnd",null)}setBackgroundRenderMode(o){if(this.backgroundRenderMode!==o){if(this.backgroundRenderMode=o,this.currentBackgroundType==="image"&&this.backgroundTexture)try{o==="panorama"?(this.backgroundTexture.mapping=EquirectangularReflectionMapping,this.scene.background=this.backgroundTexture):(this.scene.background=null,this.backgroundMesh&&this.backgroundMesh.material instanceof MeshBasicMaterial&&(this.backgroundMesh.material.map=this.backgroundTexture,this.backgroundMesh.material.needsUpdate=!0))}catch(n){console.error("Error set background render mode:",n)}this.eventManager.emitEvent("backgroundRenderModeChange",o)}}updateBackgroundSize(o,n,s,a){if(!o||!n)return;const r=n.material;if(!r.map)return;const l=o.image.width/o.image.height,u=s/a;l>u?n.scale.set(l/u,1,1):n.scale.set(1,u/l,1),r.needsUpdate=!0}handleResize(o,n){this.backgroundTexture&&this.backgroundMesh&&this.currentBackgroundType==="image"&&this.updateBackgroundSize(this.backgroundTexture,this.backgroundMesh,o,n)}renderBackground(){if((this.backgroundRenderMode==="tiled"||this.currentBackgroundType==="color")&&this.backgroundMesh){const o=this.renderer.toneMapping,n=this.renderer.toneMappingExposure;this.renderer.toneMapping=NoToneMapping,this.renderer.render(this.backgroundScene,this.backgroundCamera),this.renderer.toneMapping=o,this.renderer.toneMappingExposure=n}}getCurrentBackgroundInfo(){return{type:this.currentBackgroundType,value:this.currentBackgroundType==="color"?this.currentBackgroundColor:""}}captureScene(o,n){return new Promise(async(s,a)=>{try{const r=this.renderer.domElement.width,l=this.renderer.domElement.height,u=this.renderer.getClearColor(new Color),m=this.renderer.getClearAlpha(),f=this.renderer.outputColorSpace;if(this.renderer.setSize(o,n),this.getActiveCamera()instanceof PerspectiveCamera){const S=this.getActiveCamera();S.aspect=o/n,S.updateProjectionMatrix()}else{const S=this.getActiveCamera(),C=10,I=o/n;S.left=-C*I/2,S.right=C*I/2,S.top=C/2,S.bottom=-C/2,S.updateProjectionMatrix()}this.backgroundTexture&&this.backgroundMesh&&this.currentBackgroundType==="image"&&this.updateBackgroundSize(this.backgroundTexture,this.backgroundMesh,o,n);const _=new Map;this.renderer.clear(),this.renderBackground(),this.renderer.render(this.scene,this.getActiveCamera());const y=this.renderer.domElement.toDataURL("image/png");this.renderer.setClearColor(0,0),this.renderer.clear(),this.renderer.render(this.scene,this.getActiveCamera());const b=this.renderer.domElement.toDataURL("image/png");this.scene.traverse(S=>{S instanceof Mesh&&(_.set(S,S.material),S.material=new MeshNormalMaterial({flatShading:!1,side:DoubleSide,normalScale:new Vector2(1,1)}))});const w=this.gridHelper.visible;this.gridHelper.visible=!1,this.renderer.setClearColor(0,1),this.renderer.clear(),this.renderer.render(this.scene,this.getActiveCamera());const k=this.renderer.domElement.toDataURL("image/png");this.scene.traverse(S=>{if(S instanceof Mesh){const C=_.get(S);C&&(S.material=C)}}),this.renderer.setClearColor(16777215,1),this.renderer.clear(),this.gridHelper.visible=w,this.renderer.setClearColor(u,m),this.renderer.setSize(r,l),this.renderer.outputColorSpace=f,this.handleResize(r,l),s({scene:y,mask:b,normal:k})}catch(r){a(r)}})}reset(){}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.SceneManager=window.comfyAPI.SceneManager||{};window.comfyAPI.SceneManager.SceneManager=SceneManager;class SceneModelManager{static{p(this,"SceneModelManager")}currentModel=null;originalModel=null;originalRotation=null;currentUpDirection="original";materialMode="original";originalMaterials=new WeakMap;normalMaterial;standardMaterial;wireframeMaterial;depthMaterial;originalFileName=null;originalURL=null;appliedTexture=null;textureLoader;scene;renderer;eventManager;activeCamera;setupCamera;constructor(o,n,s,a,r){this.scene=o,this.renderer=n,this.eventManager=s,this.activeCamera=a(),this.setupCamera=r,this.textureLoader=new TextureLoader,this.normalMaterial=new MeshNormalMaterial({flatShading:!1,side:DoubleSide,normalScale:new Vector2(1,1),transparent:!1,opacity:1}),this.wireframeMaterial=new MeshBasicMaterial({color:16777215,wireframe:!0,transparent:!1,opacity:1}),this.depthMaterial=new MeshDepthMaterial({depthPacking:BasicDepthPacking,side:DoubleSide}),this.standardMaterial=this.createSTLMaterial()}init(){}dispose(){this.clearModel(),this.normalMaterial.dispose(),this.standardMaterial.dispose(),this.wireframeMaterial.dispose(),this.depthMaterial.dispose(),this.appliedTexture&&(this.appliedTexture.dispose(),this.appliedTexture=null)}createSTLMaterial(){return new MeshStandardMaterial({color:8421504,metalness:.1,roughness:.8,flatShading:!1,side:DoubleSide})}setMaterialMode(o){!this.currentModel||o===this.materialMode||(this.materialMode=o,o==="depth"?this.renderer.outputColorSpace=LinearSRGBColorSpace:this.renderer.outputColorSpace=SRGBColorSpace,this.currentModel&&(this.currentModel.visible=!0),this.currentModel.traverse(n=>{if(n instanceof Mesh)switch(o){case"depth":this.originalMaterials.has(n)||this.originalMaterials.set(n,n.material);const s=new MeshDepthMaterial({depthPacking:BasicDepthPacking,side:DoubleSide});s.onBeforeCompile=r=>{r.uniforms.cameraType={value:this.activeCamera instanceof OrthographicCamera?1:0},r.fragmentShader=`
                uniform float cameraType;
                ${r.fragmentShader}
              `,r.fragmentShader=r.fragmentShader.replace(/gl_FragColor\s*=\s*vec4\(\s*vec3\(\s*1.0\s*-\s*fragCoordZ\s*\)\s*,\s*opacity\s*\)\s*;/,`
                  float depth = 1.0 - fragCoordZ;
                  if (cameraType > 0.5) {
                    depth = pow(depth, 400.0);
                  } else {
                    depth = pow(depth, 0.6);
                  }
                  gl_FragColor = vec4(vec3(depth), opacity);
                `)},s.customProgramCacheKey=()=>this.activeCamera instanceof OrthographicCamera?"ortho":"persp",n.material=s;break;case"normal":this.originalMaterials.has(n)||this.originalMaterials.set(n,n.material),n.material=new MeshNormalMaterial({flatShading:!1,side:DoubleSide,normalScale:new Vector2(1,1),transparent:!1,opacity:1});break;case"wireframe":this.originalMaterials.has(n)||this.originalMaterials.set(n,n.material),n.material=new MeshBasicMaterial({color:16777215,wireframe:!0,transparent:!1,opacity:1});break;case"original":const a=this.originalMaterials.get(n);a?n.material=a:this.appliedTexture?n.material=new MeshStandardMaterial({map:this.appliedTexture,metalness:.1,roughness:.8,side:DoubleSide}):n.material=this.standardMaterial;break}}),this.eventManager.emitEvent("materialModeChange",o))}setupModelMaterials(o){o.traverse(n=>{n instanceof Mesh&&this.originalMaterials.set(n,n.material)}),this.setMaterialMode("original")}clearModel(){const o=[];this.scene.traverse(n=>{n instanceof GridHelper||n instanceof Light||n instanceof Camera||o.push(n)}),o.forEach(n=>{n.parent&&n.parent!==this.scene?n.parent.remove(n):this.scene.remove(n),n instanceof Mesh&&(n.geometry?.dispose(),Array.isArray(n.material)?n.material.forEach(s=>s.dispose()):n.material?.dispose())}),this.reset()}reset(){this.currentModel=null,this.originalModel=null,this.originalRotation=null,this.currentUpDirection="original",this.setMaterialMode("original"),this.originalFileName=null,this.originalURL=null,this.appliedTexture&&(this.appliedTexture.dispose(),this.appliedTexture=null),this.originalMaterials=new WeakMap}addModelToScene(o){this.currentModel=o,this.scene.add(this.currentModel)}async setupModel(o){this.currentModel=o;const n=new Box3().setFromObject(o),s=n.getSize(new Vector3),a=n.getCenter(new Vector3),u=5/Math.max(s.x,s.y,s.z);o.scale.multiplyScalar(u),n.setFromObject(o),n.getCenter(a),n.getSize(s),o.position.set(-a.x,-n.min.y,-a.z),this.scene.add(o),this.materialMode!=="original"&&this.setMaterialMode(this.materialMode),this.currentUpDirection!=="original"&&this.setUpDirection(this.currentUpDirection),this.setupModelMaterials(o),this.setupCamera(s)}setOriginalModel(o){this.originalModel=o}setUpDirection(o){if(this.currentModel){switch(!this.originalRotation&&this.currentModel.rotation&&(this.originalRotation=this.currentModel.rotation.clone()),this.currentUpDirection=o,this.originalRotation&&this.currentModel.rotation.copy(this.originalRotation),o){case"original":break;case"-x":this.currentModel.rotation.z=Math.PI/2;break;case"+x":this.currentModel.rotation.z=-Math.PI/2;break;case"-y":this.currentModel.rotation.x=Math.PI;break;case"+y":break;case"-z":this.currentModel.rotation.x=Math.PI/2;break;case"+z":this.currentModel.rotation.x=-Math.PI/2;break}this.eventManager.emitEvent("upDirectionChange",o)}}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.SceneModelManager=window.comfyAPI.SceneModelManager||{};window.comfyAPI.SceneModelManager.SceneModelManager=SceneModelManager;class ViewHelperManager{static{p(this,"ViewHelperManager")}viewHelper={};viewHelperContainer={};getActiveCamera;getControls;eventManager;renderer;constructor(o,n,s,a){this.renderer=o,this.getActiveCamera=n,this.getControls=s,this.eventManager=a}init(){}dispose(){this.viewHelper&&this.viewHelper.dispose(),this.viewHelperContainer&&this.viewHelperContainer.parentNode&&this.viewHelperContainer.parentNode.removeChild(this.viewHelperContainer)}createViewHelper(o){this.viewHelperContainer=document.createElement("div"),this.viewHelperContainer.style.position="absolute",this.viewHelperContainer.style.bottom="0",this.viewHelperContainer.style.left="0",this.viewHelperContainer.style.width="128px",this.viewHelperContainer.style.height="128px",this.viewHelperContainer.addEventListener("pointerup",n=>{n.stopPropagation(),this.viewHelper.handleClick(n)}),this.viewHelperContainer.addEventListener("pointerdown",n=>{n.stopPropagation()}),o.appendChild(this.viewHelperContainer),this.viewHelper=new ViewHelper(this.getActiveCamera(),this.viewHelperContainer),this.viewHelper.center=this.getControls().target}update(o){if(this.viewHelper.animating&&(this.viewHelper.update(o),!this.viewHelper.animating)){const n={position:this.getActiveCamera().position.clone(),target:this.getControls().target.clone(),zoom:this.getActiveCamera()instanceof OrthographicCamera?this.getActiveCamera().zoom:this.getActiveCamera().zoom,cameraType:this.getActiveCamera()instanceof PerspectiveCamera?"perspective":"orthographic"};this.eventManager.emitEvent("cameraChanged",n)}}handleResize(){}visibleViewHelper(o){o?(this.viewHelper.visible=!0,this.viewHelperContainer.style.display="block"):(this.viewHelper.visible=!1,this.viewHelperContainer.style.display="none")}recreateViewHelper(){this.viewHelper&&this.viewHelper.dispose(),this.viewHelper=new ViewHelper(this.getActiveCamera(),this.viewHelperContainer),this.viewHelper.center=this.getControls().target}reset(){}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.ViewHelperManager=window.comfyAPI.ViewHelperManager||{};window.comfyAPI.ViewHelperManager.ViewHelperManager=ViewHelperManager;class Load3d{static{p(this,"Load3d")}renderer;clock;animationFrameId=null;loadingPromise=null;onContextMenuCallback;getDimensionsCallback;eventManager;sceneManager;cameraManager;controlsManager;lightingManager;viewHelperManager;loaderManager;modelManager;recordingManager;animationManager;STATUS_MOUSE_ON_NODE;STATUS_MOUSE_ON_SCENE;STATUS_MOUSE_ON_VIEWER;INITIAL_RENDER_DONE=!1;targetWidth=512;targetHeight=512;targetAspectRatio=1;isViewerMode=!1;rightMouseDownX=0;rightMouseDownY=0;rightMouseMoved=!1;dragThreshold=5;contextMenuAbortController=null;constructor(o,n={}){this.clock=new Clock,this.isViewerMode=n.isViewerMode||!1,this.onContextMenuCallback=n.onContextMenu,this.getDimensionsCallback=n.getDimensions,n.width&&n.height&&(this.targetWidth=n.width,this.targetHeight=n.height,this.targetAspectRatio=n.width/n.height),this.renderer=new WebGLRenderer({alpha:!0,antialias:!0}),this.renderer.setSize(300,300),this.renderer.setClearColor(2631720),this.renderer.autoClear=!1,this.renderer.outputColorSpace=SRGBColorSpace,this.renderer.domElement.classList.add("flex","!h-full","!w-full"),o.appendChild(this.renderer.domElement),this.eventManager=new EventManager,this.sceneManager=new SceneManager(this.renderer,this.getActiveCamera.bind(this),this.getControls.bind(this),this.eventManager),this.cameraManager=new CameraManager(this.renderer,this.eventManager),this.controlsManager=new ControlsManager(this.renderer,this.cameraManager.activeCamera,this.eventManager),this.cameraManager.setControls(this.controlsManager.controls),this.lightingManager=new LightingManager(this.sceneManager.scene,this.eventManager),this.viewHelperManager=new ViewHelperManager(this.renderer,this.getActiveCamera.bind(this),this.getControls.bind(this),this.eventManager),this.modelManager=new SceneModelManager(this.sceneManager.scene,this.renderer,this.eventManager,this.getActiveCamera.bind(this),this.setupCamera.bind(this)),this.loaderManager=new LoaderManager(this.modelManager,this.eventManager),this.recordingManager=new RecordingManager(this.sceneManager.scene,this.renderer,this.eventManager),this.animationManager=new AnimationManager(this.eventManager),this.sceneManager.init(),this.cameraManager.init(),this.controlsManager.init(),this.lightingManager.init(),this.loaderManager.init(),this.animationManager.init(),this.viewHelperManager.createViewHelper(o),this.viewHelperManager.init(),this.STATUS_MOUSE_ON_NODE=!1,this.STATUS_MOUSE_ON_SCENE=!1,this.STATUS_MOUSE_ON_VIEWER=!1,this.initContextMenu(),this.handleResize(),this.startAnimation(),setTimeout(()=>{this.forceRender()},100)}initContextMenu(){const o=this.renderer.domElement;this.contextMenuAbortController=new AbortController;const{signal:n}=this.contextMenuAbortController,s=p(l=>{l.button===2&&(this.rightMouseDownX=l.clientX,this.rightMouseDownY=l.clientY,this.rightMouseMoved=!1)},"mousedownHandler"),a=p(l=>{if(l.buttons===2){const u=Math.abs(l.clientX-this.rightMouseDownX),m=Math.abs(l.clientY-this.rightMouseDownY);(u>this.dragThreshold||m>this.dragThreshold)&&(this.rightMouseMoved=!0)}},"mousemoveHandler"),r=p(l=>{if(this.isViewerMode)return;const u=Math.abs(l.clientX-this.rightMouseDownX),m=Math.abs(l.clientY-this.rightMouseDownY),f=this.rightMouseMoved||u>this.dragThreshold||m>this.dragThreshold;this.rightMouseMoved=!1,!f&&(l.preventDefault(),l.stopPropagation(),this.showNodeContextMenu(l))},"contextmenuHandler");o.addEventListener("mousedown",s,{signal:n}),o.addEventListener("mousemove",a,{signal:n}),o.addEventListener("contextmenu",r,{signal:n})}showNodeContextMenu(o){this.onContextMenuCallback&&this.onContextMenuCallback(o)}getEventManager(){return this.eventManager}getSceneManager(){return this.sceneManager}getCameraManager(){return this.cameraManager}getControlsManager(){return this.controlsManager}getLightingManager(){return this.lightingManager}getViewHelperManager(){return this.viewHelperManager}getLoaderManager(){return this.loaderManager}getModelManager(){return this.modelManager}getRecordingManager(){return this.recordingManager}getTargetSize(){return{width:this.targetWidth,height:this.targetHeight}}shouldMaintainAspectRatio(){return this.isViewerMode||this.targetWidth>0&&this.targetHeight>0}forceRender(){const o=this.clock.getDelta();this.animationManager.update(o),this.viewHelperManager.update(o),this.controlsManager.update(),this.renderMainScene(),this.resetViewport(),this.viewHelperManager.viewHelper.render&&this.viewHelperManager.viewHelper.render(this.renderer),this.INITIAL_RENDER_DONE=!0}renderMainScene(){const o=this.renderer.domElement.clientWidth,n=this.renderer.domElement.clientHeight;if(this.getDimensionsCallback){const s=this.getDimensionsCallback();s&&(this.targetWidth=s.width,this.targetHeight=s.height,this.targetAspectRatio=s.width/s.height)}if(this.shouldMaintainAspectRatio()){const s=o/n;let a,r,l=0,u=0;s>this.targetAspectRatio?(r=n,a=r*this.targetAspectRatio,l=(o-a)/2):(a=o,r=a/this.targetAspectRatio,u=(n-r)/2),this.renderer.setViewport(0,0,o,n),this.renderer.setScissor(0,0,o,n),this.renderer.setScissorTest(!0),this.renderer.setClearColor(657930),this.renderer.clear(),this.renderer.setViewport(l,u,a,r),this.renderer.setScissor(l,u,a,r);const m=a/r;this.cameraManager.updateAspectRatio(m)}else this.renderer.setViewport(0,0,o,n),this.renderer.setScissor(0,0,o,n),this.renderer.setScissorTest(!0);this.sceneManager.renderBackground(),this.renderer.render(this.sceneManager.scene,this.cameraManager.activeCamera)}resetViewport(){const o=this.renderer.domElement.clientWidth,n=this.renderer.domElement.clientHeight;this.renderer.setViewport(0,0,o,n),this.renderer.setScissor(0,0,o,n),this.renderer.setScissorTest(!1)}getActiveCamera(){return this.cameraManager.activeCamera}getControls(){return this.controlsManager.controls}setupCamera(o){this.cameraManager.setupForModel(o)}startAnimation(){const o=p(()=>{if(this.animationFrameId=requestAnimationFrame(o),!this.isActive())return;const n=this.clock.getDelta();this.animationManager.update(n),this.viewHelperManager.update(n),this.controlsManager.update(),this.renderMainScene(),this.resetViewport(),this.viewHelperManager.viewHelper.render&&this.viewHelperManager.viewHelper.render(this.renderer)},"animate");o()}updateStatusMouseOnNode(o){this.STATUS_MOUSE_ON_NODE=o}updateStatusMouseOnScene(o){this.STATUS_MOUSE_ON_SCENE=o}updateStatusMouseOnViewer(o){this.STATUS_MOUSE_ON_VIEWER=o}isActive(){return this.STATUS_MOUSE_ON_NODE||this.STATUS_MOUSE_ON_SCENE||this.STATUS_MOUSE_ON_VIEWER||this.isRecording()||!this.INITIAL_RENDER_DONE}async exportModel(o){if(!this.modelManager.currentModel)throw new Error("No model to export");const n=`Exporting as ${o.toUpperCase()}...`;this.eventManager.emitEvent("exportLoadingStart",n);try{const s=this.modelManager.currentModel.clone(),r=`${this.modelManager.originalFileName||"model"}.${o}`,l=this.modelManager.originalURL;switch(await new Promise(u=>setTimeout(u,10)),o){case"glb":await ModelExporter.exportGLB(s,r,l);break;case"obj":await ModelExporter.exportOBJ(s,r,l);break;case"stl":await ModelExporter.exportSTL(s,r);break;default:throw new Error(`Unsupported export format: ${o}`)}await new Promise(u=>setTimeout(u,10))}catch(s){throw console.error(`Error exporting model as ${o}:`,s),s}finally{this.eventManager.emitEvent("exportLoadingEnd",null)}}setBackgroundColor(o){this.sceneManager.setBackgroundColor(o),this.forceRender()}async setBackgroundImage(o){if(await this.sceneManager.setBackgroundImage(o),this.sceneManager.backgroundTexture&&this.sceneManager.backgroundMesh){const n=this.renderer.domElement.clientWidth,s=this.renderer.domElement.clientHeight;if(this.shouldMaintainAspectRatio()){const a=n/s;let r,l;a>this.targetAspectRatio?(l=s,r=l*this.targetAspectRatio):(r=n,l=r/this.targetAspectRatio),this.sceneManager.updateBackgroundSize(this.sceneManager.backgroundTexture,this.sceneManager.backgroundMesh,r,l)}else this.sceneManager.updateBackgroundSize(this.sceneManager.backgroundTexture,this.sceneManager.backgroundMesh,n,s)}this.forceRender()}removeBackgroundImage(){this.sceneManager.removeBackgroundImage(),this.forceRender()}toggleGrid(o){this.sceneManager.toggleGrid(o),this.forceRender()}setBackgroundRenderMode(o){this.sceneManager.setBackgroundRenderMode(o),this.forceRender()}toggleCamera(o){this.cameraManager.toggleCamera(o),this.controlsManager.updateCamera(this.cameraManager.activeCamera),this.viewHelperManager.recreateViewHelper(),this.handleResize(),this.forceRender()}getCurrentCameraType(){return this.cameraManager.getCurrentCameraType()}getCurrentModel(){return this.modelManager.currentModel}setCameraState(o){this.cameraManager.setCameraState(o),this.forceRender()}getCameraState(){return this.cameraManager.getCameraState()}setFOV(o){this.cameraManager.setFOV(o),this.forceRender()}setMaterialMode(o){this.modelManager.setMaterialMode(o),this.forceRender()}async loadModel(o,n){if(this.loadingPromise)try{await this.loadingPromise}catch{}return this.loadingPromise=this._loadModelInternal(o,n),this.loadingPromise}async _loadModelInternal(o,n){this.cameraManager.reset(),this.controlsManager.reset(),this.modelManager.clearModel(),this.animationManager.dispose(),await this.loaderManager.loadModel(o,n),this.modelManager.currentModel&&this.animationManager.setupModelAnimations(this.modelManager.currentModel,this.modelManager.originalModel),this.handleResize(),this.forceRender(),this.loadingPromise=null}clearModel(){this.animationManager.dispose(),this.modelManager.clearModel(),this.forceRender()}setUpDirection(o){this.modelManager.setUpDirection(o),this.forceRender()}setLightIntensity(o){this.lightingManager.setLightIntensity(o),this.forceRender()}setTargetSize(o,n){this.targetWidth=o,this.targetHeight=n,this.targetAspectRatio=o/n,this.handleResize(),this.forceRender()}addEventListener(o,n){this.eventManager.addEventListener(o,n)}removeEventListener(o,n){this.eventManager.removeEventListener(o,n)}refreshViewport(){this.handleResize(),this.forceRender()}handleResize(){const o=this.renderer?.domElement;if(!o){console.warn("Parent element not found");return}const n=o.clientWidth,s=o.clientHeight;if(this.getDimensionsCallback){const a=this.getDimensionsCallback();a&&(this.targetWidth=a.width,this.targetHeight=a.height,this.targetAspectRatio=a.width/a.height)}if(this.shouldMaintainAspectRatio()){const a=n/s;let r,l;a>this.targetAspectRatio?(l=s,r=l*this.targetAspectRatio):(r=n,l=r/this.targetAspectRatio),this.renderer.setSize(n,s),this.cameraManager.handleResize(r,l),this.sceneManager.handleResize(r,l)}else this.renderer.setSize(n,s),this.cameraManager.handleResize(n,s),this.sceneManager.handleResize(n,s);this.forceRender()}captureScene(o,n){return this.sceneManager.captureScene(o,n)}async startRecording(){return this.viewHelperManager.visibleViewHelper(!1),this.recordingManager.startRecording(this.targetWidth,this.targetHeight)}stopRecording(){this.viewHelperManager.visibleViewHelper(!0),this.recordingManager.stopRecording(),this.eventManager.emitEvent("recordingStatusChange",!1)}isRecording(){return this.recordingManager.getIsRecording()}getRecordingDuration(){return this.recordingManager.getRecordingDuration()}getRecordingData(){return this.recordingManager.getRecordingData()}exportRecording(o){this.recordingManager.exportRecording(o)}clearRecording(){this.recordingManager.clearRecording()}setAnimationSpeed(o){this.animationManager.setAnimationSpeed(o)}updateSelectedAnimation(o){this.animationManager.updateSelectedAnimation(o)}toggleAnimation(o){this.animationManager.toggleAnimation(o)}hasAnimations(){return this.animationManager.animationClips.length>0}remove(){this.contextMenuAbortController&&(this.contextMenuAbortController.abort(),this.contextMenuAbortController=null),this.renderer.forceContextLoss();const o=this.renderer.domElement,n=new Event("webglcontextlost",{bubbles:!0,cancelable:!0});o.dispatchEvent(n),this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId),this.sceneManager.dispose(),this.cameraManager.dispose(),this.controlsManager.dispose(),this.lightingManager.dispose(),this.viewHelperManager.dispose(),this.loaderManager.dispose(),this.modelManager.dispose(),this.recordingManager.dispose(),this.animationManager.dispose(),this.renderer.dispose(),this.renderer.domElement.remove()}}const nodeToLoad3dMap=new Map,pendingCallbacks=new Map,useLoad3d=p(i=>{const o=toRef$1(i);let n=null;const s=ref({showGrid:!0,backgroundColor:"#000000",backgroundImage:"",backgroundRenderMode:"tiled"}),a=ref({upDirection:"original",materialMode:"original"}),r=ref({cameraType:"perspective",fov:75}),l=ref({intensity:5}),u=ref(!1),m=ref(!1),f=ref(0),_=ref([]),y=ref(!1),b=ref(1),w=ref(0),k=ref(!1),S=ref(""),C=ref(!1),I=p(async G=>{const H=toRaw(o.value);if(!G||!H)return;const W=H;try{const X=W.widgets?.find(ee=>ee.name==="width"),Q=W.widgets?.find(ee=>ee.name==="height");X&&Q||(C.value=!0),n=new Load3d(G,{width:X?.value,height:Q?.value,getDimensions:X&&Q?()=>({width:X.value,height:Q.value}):void 0,onContextMenu:p(ee=>{const Y=app$1.canvas.getNodeMenuOptions(W);new LiteGraph.ContextMenu(Y,{event:ee,title:W.type,extra:W})},"onContextMenu")}),await T(W),W.onMouseEnter=function(){n?.refreshViewport(),n?.updateStatusMouseOnNode(!0)},W.onMouseLeave=function(){n?.updateStatusMouseOnNode(!1)},W.onResize=function(){n?.handleResize()},W.onDrawBackground=function(){n&&(n.renderer.domElement.hidden=this.flags.collapsed??!1)},W.onRemoved=function(){useLoad3dService().removeLoad3d(W),pendingCallbacks.delete(W)},nodeToLoad3dMap.set(W,n);const q=pendingCallbacks.get(W);q&&n&&(q.forEach(ee=>{n&&ee(n)}),pendingCallbacks.delete(W)),j("add")}catch(X){console.error("Error initializing Load3d:",X),useToastStore().addAlert(t("toastMessages.failedToInitializeLoad3d"))}},"initializeLoad3d"),T=p(async G=>{if(!n)return;const H=G.properties["Scene Config"];H&&(s.value={...s.value,...H,backgroundRenderMode:H.backgroundRenderMode||"tiled"});const W=G.properties["Model Config"];W&&(a.value=W);const X=G.properties["Camera Config"],Q=X?.state;X&&(r.value=X);const q=G.properties["Light Config"];q&&(l.value=q);const ee=G.widgets?.find(Y=>Y.name==="model_file");if(ee?.value){const Y=E(ee.value);if(Y){k.value=!0,S.value=t("load3d.reloadingModel");try{await n.loadModel(Y),Q&&(await nextTick(),n.setCameraState(Q))}catch(ae){console.error("Failed to reload model:",ae),useToastStore().addAlert(t("toastMessages.failedToLoadModel"))}finally{k.value=!1,S.value=""}}}else Q&&n.setCameraState(Q)},"restoreConfigurationsFromNode"),E=p(G=>{if(!G)return null;try{if(G.startsWith("http"))return G;const[H,W]=Load3dUtils.splitFilePath(G);return api.apiURL(Load3dUtils.getResourceURL(H,W,C.value?"output":"input"))}catch(H){return console.error("Failed to construct model URL:",H),null}},"getModelUrl"),N=p(G=>{const H=toRaw(o.value);if(!H)return;const W=H,X=nodeToLoad3dMap.get(W);if(X){G(X);return}pendingCallbacks.has(W)||pendingCallbacks.set(W,[]),pendingCallbacks.get(W).push(G)},"waitForLoad3d");watch(s,async G=>{n&&o.value&&(o.value.properties["Scene Config"]=G,n.toggleGrid(G.showGrid),n.setBackgroundColor(G.backgroundColor),await n.setBackgroundImage(G.backgroundImage||""),G.backgroundRenderMode&&n.setBackgroundRenderMode(G.backgroundRenderMode))},{deep:!0}),watch(a,G=>{n&&o.value&&(o.value.properties["Model Config"]=G,n.setUpDirection(G.upDirection),n.setMaterialMode(G.materialMode))},{deep:!0}),watch(r,G=>{n&&o.value&&(o.value.properties["Camera Config"]=G,n.toggleCamera(G.cameraType),n.setFOV(G.fov))},{deep:!0}),watch(l,G=>{n&&o.value&&(o.value.properties["Light Config"]=G,n.setLightIntensity(G.intensity))},{deep:!0}),watch(y,G=>{n&&n.toggleAnimation(G)}),watch(b,G=>{n&&G&&n.setAnimationSpeed(G)}),watch(w,G=>{n&&G!==void 0&&n.updateSelectedAnimation(G)});const L=p(()=>{n?.updateStatusMouseOnScene(!0)},"handleMouseEnter"),A=p(()=>{n?.updateStatusMouseOnScene(!1)},"handleMouseLeave"),D=p(async()=>{n&&(await n.startRecording(),u.value=!0)},"handleStartRecording"),O=p(()=>{n&&(n.stopRecording(),u.value=!1,f.value=n.getRecordingDuration(),m.value=f.value>0)},"handleStopRecording"),M=p(()=>{if(n){const H=`${new Date().toISOString().replace(/[:.]/g,"-")}-scene-recording.mp4`;n.exportRecording(H)}},"handleExportRecording"),P=p(()=>{n&&(n.clearRecording(),m.value=!1,f.value=0)},"handleClearRecording"),R=p(async G=>{if(!G){s.value.backgroundImage="",await n?.setBackgroundImage("");return}const H=o.value?.properties["Resource Folder"]||"",W=H.trim()?`3d/${H.trim()}`:"3d",X=await Load3dUtils.uploadFile(G,W);s.value.backgroundImage=X,await n?.setBackgroundImage(X)},"handleBackgroundImageUpdate"),V=p(async G=>{if(!n){useToastStore().addAlert(t("toastMessages.no3dSceneToExport"));return}try{await n.exportModel(G)}catch(H){console.error("Error exporting model:",H),useToastStore().addAlert(t("toastMessages.failedToExportModel",{format:G.toUpperCase()}))}},"handleExportModel"),$=p(async G=>{if(!n){useToastStore().addAlert(t("toastMessages.no3dScene"));return}const H=toRaw(o.value);if(H)try{const W=H.properties["Resource Folder"]||"",X=W.trim()?`3d/${W.trim()}`:"3d";k.value=!0,S.value=t("load3d.uploadingModel");const Q=await Load3dUtils.uploadFile(G,X);if(!Q){useToastStore().addAlert(t("toastMessages.fileUploadFailed"));return}const q=api.apiURL(Load3dUtils.getResourceURL(...Load3dUtils.splitFilePath(Q),C.value?"output":"input"));S.value=t("load3d.loadingModel"),await n.loadModel(q);const ee=H.widgets?.find(Y=>Y.name==="model_file");if(ee){const Y=ee.options;Y?.values&&!Y.values.includes(Q)&&Y.values.push(Q),ee.value=Q}}catch(W){console.error("Model drop failed:",W),useToastStore().addAlert(t("toastMessages.failedToLoadModel"))}finally{k.value=!1,S.value=""}},"handleModelDrop"),F={materialModeChange:p(G=>{a.value.materialMode=G},"materialModeChange"),backgroundColorChange:p(G=>{s.value.backgroundColor=G},"backgroundColorChange"),backgroundRenderModeChange:p(G=>{s.value.backgroundRenderMode=G},"backgroundRenderModeChange"),lightIntensityChange:p(G=>{l.value.intensity=G},"lightIntensityChange"),fovChange:p(G=>{r.value.fov=G},"fovChange"),cameraTypeChange:p(G=>{r.value.cameraType=G},"cameraTypeChange"),showGridChange:p(G=>{s.value.showGrid=G},"showGridChange"),upDirectionChange:p(G=>{a.value.upDirection=G},"upDirectionChange"),backgroundImageChange:p(G=>{s.value.backgroundImage=G},"backgroundImageChange"),backgroundImageLoadingStart:p(()=>{S.value=t("load3d.loadingBackgroundImage"),k.value=!0},"backgroundImageLoadingStart"),backgroundImageLoadingEnd:p(()=>{S.value="",k.value=!1},"backgroundImageLoadingEnd"),modelLoadingStart:p(()=>{S.value=t("load3d.loadingModel"),k.value=!0},"modelLoadingStart"),modelLoadingEnd:p(()=>{S.value="",k.value=!1},"modelLoadingEnd"),exportLoadingStart:p(G=>{S.value=G||t("load3d.exportingModel"),k.value=!0},"exportLoadingStart"),exportLoadingEnd:p(()=>{S.value="",k.value=!1},"exportLoadingEnd"),recordingStatusChange:p(G=>{u.value=G,!G&&n&&(f.value=n.getRecordingDuration(),m.value=f.value>0)},"recordingStatusChange"),animationListChange:p(G=>{_.value=G},"animationListChange"),cameraChanged:p(G=>{const H=toRaw(o.value);if(H){const W=H;W.properties||(W.properties={});const X=W.properties["Camera Config"];X?X.state=G:W.properties["Camera Config"]={cameraType:r.value.cameraType,fov:r.value.fov,state:G}}},"cameraChanged")},j=p(G=>{Object.entries(F).forEach(([H,W])=>{const X=`${G}EventListener`;n?.[X](H,W)})},"handleEvents");return{load3d:n,sceneConfig:s,modelConfig:a,cameraConfig:r,lightConfig:l,isRecording:u,isPreview:C,hasRecording:m,recordingDuration:f,animations:_,playing:y,selectedSpeed:b,selectedAnimation:w,loading:k,loadingMessage:S,initializeLoad3d:I,waitForLoad3d:N,handleMouseEnter:L,handleMouseLeave:A,handleStartRecording:D,handleStopRecording:O,handleExportRecording:M,handleClearRecording:P,handleBackgroundImageUpdate:R,handleExportModel:V,handleModelDrop:$,cleanup:p(()=>{j("remove");const G=toRaw(o.value);if(!G)return;const H=G;nodeToLoad3dMap.get(H)===n&&nodeToLoad3dMap.delete(H),n?.remove(),n=null},"cleanup")}},"useLoad3d"),viewerInstances=new Map;class Load3dService{static{p(this,"Load3dService")}static instance;constructor(){}static getInstance(){return Load3dService.instance||(Load3dService.instance=new Load3dService),Load3dService.instance}getLoad3d(o){const n=toRaw(o);return nodeToLoad3dMap.get(n)||null}getNodeByLoad3d(o){for(const[n,s]of nodeToLoad3dMap)if(s===o)return n;return null}removeLoad3d(o){const n=toRaw(o),s=nodeToLoad3dMap.get(n);s&&(s.remove(),nodeToLoad3dMap.delete(n))}clear(){for(const[o]of nodeToLoad3dMap)this.removeLoad3d(o)}getOrCreateViewer(o){return viewerInstances.has(o.id)||viewerInstances.set(o.id,useLoad3dViewer(o)),viewerInstances.get(o.id)}removeViewer(o){const n=viewerInstances.get(o.id);n&&n.cleanup(),viewerInstances.delete(o.id)}async copyLoad3dState(o,n){const s=o.modelManager.currentModel;if(s){const u=s.clone();n.getModelManager().currentModel=u,n.getSceneManager().scene.add(u),n.getModelManager().materialMode=o.getModelManager().materialMode,n.getModelManager().currentUpDirection=o.getModelManager().currentUpDirection,n.setMaterialMode(o.getModelManager().materialMode),n.setUpDirection(o.getModelManager().currentUpDirection),o.getModelManager().appliedTexture&&(n.getModelManager().appliedTexture=o.getModelManager().appliedTexture)}const a=o.getCurrentCameraType(),r=o.getCameraState();if(n.toggleCamera(a),n.setCameraState(r),n.setBackgroundColor(o.getSceneManager().currentBackgroundColor),n.toggleGrid(o.getSceneManager().gridHelper.visible),o.getSceneManager().getCurrentBackgroundInfo().type==="image"){const f=this.getNodeByLoad3d(o)?.properties?.["Scene Config"]?.backgroundImage;f&&await n.setBackgroundImage(f)}else await n.setBackgroundImage("");n.setLightIntensity(o.getLightingManager().lights[1]?.intensity||1),a==="perspective"&&n.setFOV(o.getCameraManager().perspectiveCamera.fov)}handleViewportRefresh(o){if(!o)return;o.handleResize();const n=o.getCurrentCameraType();o.toggleCamera(n==="perspective"?"orthographic":"perspective"),o.toggleCamera(n),o.getControlsManager().controls.update()}async handleViewerClose(o){const n=useLoad3dService().getOrCreateViewer(o);n.needApplyChanges.value&&(await n.applyChanges(),o.syncLoad3dConfig&&o.syncLoad3dConfig()),useLoad3dService().removeViewer(o)}}const useLoad3dService=p(()=>Load3dService.getInstance(),"useLoad3dService"),useLoad3dViewer=p(i=>{const o=ref(""),n=ref(!0),s=ref("perspective"),a=ref(75),r=ref(1),l=ref(""),u=ref(!1),m=ref("tiled"),f=ref("original"),_=ref("original"),y=ref(!0),b=ref(!1),w=ref(!1);let k=null,S=null;const C=ref({backgroundColor:"#282828",showGrid:!0,cameraType:"perspective",fov:75,lightIntensity:1,cameraState:null,backgroundImage:"",backgroundRenderMode:"tiled",upDirection:"original",materialMode:"original"});return watch(o,$=>{if(k)try{k.setBackgroundColor($)}catch(F){console.error("Error updating background color:",F),useToastStore().addAlert(t("toastMessages.failedToUpdateBackgroundColor",{color:$}))}}),watch(n,$=>{if(k)try{k.toggleGrid($)}catch(F){console.error("Error toggling grid:",F),useToastStore().addAlert(t("toastMessages.failedToToggleGrid",{show:$?"on":"off"}))}}),watch(s,$=>{if(k)try{k.toggleCamera($)}catch(F){console.error("Error toggling camera:",F),useToastStore().addAlert(t("toastMessages.failedToToggleCamera",{camera:$}))}}),watch(a,$=>{if(k)try{k.setFOV(Number($))}catch(F){console.error("Error updating FOV:",F),useToastStore().addAlert(t("toastMessages.failedToUpdateFOV",{fov:$}))}}),watch(r,$=>{if(k)try{k.setLightIntensity(Number($))}catch(F){console.error("Error updating light intensity:",F),useToastStore().addAlert(t("toastMessages.failedToUpdateLightIntensity",{intensity:$}))}}),watch(l,async $=>{if(k)try{await k.setBackgroundImage($),u.value=!!$}catch(F){console.error("Error updating background image:",F),useToastStore().addAlert(t("toastMessages.failedToUpdateBackgroundImage"))}}),watch(m,$=>{if(k)try{k.setBackgroundRenderMode($)}catch(F){console.error("Error updating background render mode:",F),useToastStore().addAlert(t("toastMessages.failedToUpdateBackgroundRenderMode",{mode:$}))}}),watch(f,$=>{if(k)try{k.setUpDirection($)}catch(F){console.error("Error updating up direction:",F),useToastStore().addAlert(t("toastMessages.failedToUpdateUpDirection",{direction:$}))}}),watch(_,$=>{if(k)try{k.setMaterialMode($)}catch(F){console.error("Error updating material mode:",F),useToastStore().addAlert(t("toastMessages.failedToUpdateMaterialMode",{mode:$}))}}),{backgroundColor:o,showGrid:n,cameraType:s,fov:a,lightIntensity:r,backgroundImage:l,hasBackgroundImage:u,backgroundRenderMode:m,upDirection:f,materialMode:_,needApplyChanges:y,isPreview:b,isStandaloneMode:w,initializeViewer:p(async($,F)=>{if(!(!$||!i)){S=F;try{const j=i.widgets?.find(q=>q.name==="width"),U=i.widgets?.find(q=>q.name==="height");k=new Load3d($,{width:j?toRaw(j).value:void 0,height:U?toRaw(U).value:void 0,getDimensions:j&&U?()=>({width:j.value,height:U.value}):void 0,isViewerMode:!0}),await useLoad3dService().copyLoad3dState(F,k);const G=F.getCameraState(),H=i.properties["Scene Config"],W=i.properties["Model Config"],X=i.properties["Camera Config"],Q=i.properties["Light Config"];b.value=i.type==="Preview3D",H&&(o.value=H.backgroundColor||F.sceneManager.currentBackgroundColor,n.value=H.showGrid??F.sceneManager.gridHelper.visible,m.value=H.backgroundRenderMode||F.sceneManager.backgroundRenderMode||"tiled",F.sceneManager.getCurrentBackgroundInfo().type==="image"&&H.backgroundImage?(l.value=H.backgroundImage,u.value=!0):(l.value="",u.value=!1)),X&&(s.value=X.cameraType||F.getCurrentCameraType(),a.value=X.fov||F.cameraManager.perspectiveCamera.fov),Q?r.value=Q.intensity||1:r.value=1,W&&(f.value=W.upDirection||F.modelManager.currentUpDirection,_.value=W.materialMode||F.modelManager.materialMode),C.value={backgroundColor:o.value,showGrid:n.value,cameraType:s.value,fov:a.value,lightIntensity:r.value,cameraState:G,backgroundImage:l.value,backgroundRenderMode:m.value,upDirection:f.value,materialMode:_.value}}catch(j){console.error("Error initializing Load3d viewer:",j),useToastStore().addAlert(t("toastMessages.failedToInitializeLoad3dViewer"))}}},"initializeViewer"),initializeStandaloneViewer:p(async($,F)=>{if($)try{w.value=!0,k=new Load3d($,{width:800,height:600,isViewerMode:!0}),await k.loadModel(F),o.value="#282828",n.value=!0,s.value="perspective",a.value=75,r.value=1,m.value="tiled",f.value="original",_.value="original",b.value=!0}catch(j){console.error("Error initializing standalone 3D viewer:",j),useToastStore().addAlert("Failed to load 3D model")}},"initializeStandaloneViewer"),exportModel:p(async $=>{if(k)try{await k.exportModel($)}catch(F){console.error("Error exporting model:",F),useToastStore().addAlert(t("toastMessages.failedToExportModel",{format:$.toUpperCase()}))}},"exportModel"),handleResize:p(()=>{k?.handleResize()},"handleResize"),handleMouseEnter:p(()=>{k?.updateStatusMouseOnViewer(!0)},"handleMouseEnter"),handleMouseLeave:p(()=>{k?.updateStatusMouseOnViewer(!1)},"handleMouseLeave"),restoreInitialState:p(()=>{if(!i)return;const $=i;if(y.value=!1,$.properties){$.properties["Scene Config"]={showGrid:C.value.showGrid,backgroundColor:C.value.backgroundColor,backgroundImage:C.value.backgroundImage,backgroundRenderMode:C.value.backgroundRenderMode},$.properties["Camera Config"]={cameraType:C.value.cameraType,fov:C.value.fov},$.properties["Light Config"]={intensity:C.value.lightIntensity},$.properties["Model Config"]={upDirection:C.value.upDirection,materialMode:C.value.materialMode};const F=$.properties["Camera Config"];$.properties["Camera Config"]={...F,state:C.value.cameraState}}},"restoreInitialState"),applyChanges:p(async()=>{if(!i||!S||!k)return!1;const $=k.getCameraState(),F=i;return F.properties&&(F.properties["Scene Config"]={showGrid:n.value,backgroundColor:o.value,backgroundImage:l.value,backgroundRenderMode:m.value},F.properties["Camera Config"]={cameraType:s.value,fov:a.value,state:$},F.properties["Light Config"]={intensity:r.value},F.properties["Model Config"]={upDirection:f.value,materialMode:_.value}),await useLoad3dService().copyLoad3dState(k,S),await S.setBackgroundImage(l.value),S.setBackgroundRenderMode(m.value),S.forceRender(),F.graph&&F.graph.setDirtyCanvas(!0,!0),!0},"applyChanges"),refreshViewport:p(()=>{useLoad3dService().handleViewportRefresh(k)},"refreshViewport"),handleBackgroundImageUpdate:p(async $=>{if(!$){l.value="",u.value=!1;return}if(i)try{const F=i.properties["Resource Folder"]||"",j=F.trim()?`3d/${F.trim()}`:"3d",U=await Load3dUtils.uploadFile($,j);U&&(l.value=U,u.value=!0)}catch(F){console.error("Error uploading background image:",F),useToastStore().addAlert(t("toastMessages.failedToUploadBackgroundImage"))}},"handleBackgroundImageUpdate"),handleModelDrop:p(async $=>{if(!k){useToastStore().addAlert(t("toastMessages.no3dScene"));return}if(i)try{const F=i.properties["Resource Folder"]||"",j=F.trim()?`3d/${F.trim()}`:"3d",U=await Load3dUtils.uploadFile($,j);if(!U){useToastStore().addAlert(t("toastMessages.fileUploadFailed"));return}const G=api.apiURL(Load3dUtils.getResourceURL(...Load3dUtils.splitFilePath(U),"input"));await k.loadModel(G);const H=i.widgets?.find(W=>W.name==="model_file");if(H){const W=H.options;W?.values&&!W.values.includes(U)&&W.values.push(U),H.value=U}}catch(F){console.error("Model drop failed:",F),useToastStore().addAlert(t("toastMessages.failedToLoadModel"))}},"handleModelDrop"),cleanup:p(()=>{k?.remove(),k=null,S=null},"cleanup")}},"useLoad3dViewer"),_hoisted_1$1X={key:0,class:"pointer-events-none absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm"},_hoisted_2$1v={class:"rounded-lg border-2 border-dashed border-blue-400 bg-blue-500/20 px-6 py-4 text-lg font-medium text-blue-100"},_hoisted_3$12={class:"flex w-72 flex-col"},_hoisted_4$K={class:"flex-1 overflow-y-auto p-4"},_hoisted_5$E={class:"space-y-2"},_hoisted_6$s={class:"space-y-4 p-2"},_hoisted_7$p={class:"space-y-4 p-2"},_hoisted_8$j={class:"space-y-4 p-2"},_hoisted_9$f={class:"space-y-4 p-2"},_hoisted_10$d={class:"space-y-4 p-2"},_hoisted_11$8={class:"p-4"},_hoisted_12$5={class:"flex gap-2"},_sfc_main$2l=defineComponent({__name:"Load3dViewerContent",props:{node:{},modelUrl:{}},setup(i){const o=i,n=ref(),s=ref(),a=ref(),r=ref(!1),l=ref(null),u=!o.node&&o.modelUrl,m=o.node?useLoad3dService().getOrCreateViewer(toRaw(o.node)):useLoad3dViewer(),{isDragging:f,dragMessage:_,handleDragOver:y,handleDragLeave:b,handleDrop:w}=useLoad3dDrag({onModelDrop:p(async S=>{await m.handleModelDrop(S)},"onModelDrop"),disabled:m.isPreview.value||u});onMounted(async()=>{if(s.value){if(u&&o.modelUrl)await m.initializeStandaloneViewer(s.value,o.modelUrl);else if(o.node){const S=useLoad3dService().getLoad3d(o.node);S&&await m.initializeViewer(s.value,S)}n.value&&(l.value=new MutationObserver(S=>{S.forEach(C=>{C.type==="attributes"&&C.attributeName==="maximized"&&(r.value=C.target.getAttribute("maximized")==="true",setTimeout(()=>{m.refreshViewport()},0))})}),l.value.observe(n.value,{attributes:!0,attributeFilter:["maximized"]})),window.addEventListener("resize",m.handleResize)}});const k=p(()=>{u||m.restoreInitialState(),useDialogStore().closeDialog()},"handleCancel");return onBeforeUnmount(()=>{window.removeEventListener("resize",m.handleResize),l.value&&(l.value.disconnect(),l.value=null)}),(S,C)=>(openBlock(),createElementBlock("div",{ref_key:"viewerContentRef",ref:n,class:normalizeClass(["flex w-full",[r.value?"h-full":"h-[70vh]"]]),onMouseenter:C[13]||(C[13]=(...I)=>unref(m).handleMouseEnter&&unref(m).handleMouseEnter(...I)),onMouseleave:C[14]||(C[14]=(...I)=>unref(m).handleMouseLeave&&unref(m).handleMouseLeave(...I))},[createBaseVNode("div",{ref_key:"mainContentRef",ref:a,class:"relative flex-1"},[createBaseVNode("div",{ref_key:"containerRef",ref:s,class:"absolute h-full w-full",onResize:C[0]||(C[0]=(...I)=>unref(m).handleResize&&unref(m).handleResize(...I)),onDragover:C[1]||(C[1]=withModifiers((...I)=>unref(y)&&unref(y)(...I),["prevent","stop"])),onDragleave:C[2]||(C[2]=withModifiers((...I)=>unref(b)&&unref(b)(...I),["stop"])),onDrop:C[3]||(C[3]=withModifiers((...I)=>unref(w)&&unref(w)(...I),["prevent","stop"]))},null,544),unref(f)?(openBlock(),createElementBlock("div",_hoisted_1$1X,[createBaseVNode("div",_hoisted_2$1v,toDisplayString(unref(_)),1)])):createCommentVNode("",!0)],512),createBaseVNode("div",_hoisted_3$12,[createBaseVNode("div",_hoisted_4$K,[createBaseVNode("div",_hoisted_5$E,[createBaseVNode("div",_hoisted_6$s,[createVNode(_sfc_main$2m,{"background-color":unref(m).backgroundColor.value,"onUpdate:backgroundColor":C[4]||(C[4]=I=>unref(m).backgroundColor.value=I),"show-grid":unref(m).showGrid.value,"onUpdate:showGrid":C[5]||(C[5]=I=>unref(m).showGrid.value=I),"background-render-mode":unref(m).backgroundRenderMode.value,"onUpdate:backgroundRenderMode":C[6]||(C[6]=I=>unref(m).backgroundRenderMode.value=I),fov:unref(m).fov.value,"onUpdate:fov":C[7]||(C[7]=I=>unref(m).fov.value=I),"has-background-image":unref(m).hasBackgroundImage.value,"disable-background-upload":unref(m).isStandaloneMode.value,onUpdateBackgroundImage:unref(m).handleBackgroundImageUpdate},null,8,["background-color","show-grid","background-render-mode","fov","has-background-image","disable-background-upload","onUpdateBackgroundImage"])]),createBaseVNode("div",_hoisted_7$p,[createVNode(_sfc_main$2n,{"up-direction":unref(m).upDirection.value,"onUpdate:upDirection":C[8]||(C[8]=I=>unref(m).upDirection.value=I),"material-mode":unref(m).materialMode.value,"onUpdate:materialMode":C[9]||(C[9]=I=>unref(m).materialMode.value=I)},null,8,["up-direction","material-mode"])]),createBaseVNode("div",_hoisted_8$j,[createVNode(_sfc_main$2q,{"camera-type":unref(m).cameraType.value,"onUpdate:cameraType":C[10]||(C[10]=I=>unref(m).cameraType.value=I),fov:unref(m).fov.value,"onUpdate:fov":C[11]||(C[11]=I=>unref(m).fov.value=I)},null,8,["camera-type","fov"])]),createBaseVNode("div",_hoisted_9$f,[createVNode(_sfc_main$2o,{"light-intensity":unref(m).lightIntensity.value,"onUpdate:lightIntensity":C[12]||(C[12]=I=>unref(m).lightIntensity.value=I)},null,8,["light-intensity"])]),createBaseVNode("div",_hoisted_10$d,[createVNode(_sfc_main$2p,{onExportModel:unref(m).exportModel},null,8,["onExportModel"])])])]),createBaseVNode("div",_hoisted_11$8,[createBaseVNode("div",_hoisted_12$5,[createVNode(unref(script),{icon:"pi pi-times",severity:"secondary",label:unref(t)("g.cancel"),onClick:k},null,8,["label"])])])])],34))}}),Load3DViewerContent=_export_sfc(_sfc_main$2l,[["__scopeId","data-v-c4e9c4d8"]]),_hoisted_1$1W=["src","data-test","alt"],_hoisted_2$1u=["src","alt"],_hoisted_3$11={key:1,class:"broken-image-placeholder"},_sfc_main$2k=defineComponent({__name:"ComfyImage",props:{src:{},class:{},contain:{type:Boolean,default:!1},alt:{default:"Image content"}},setup(i){const o=ref(!1),n=p(()=>{o.value=!0},"handleImageError");return(s,a)=>(openBlock(),createElementBlock(Fragment,null,[o.value?createCommentVNode("",!0):(openBlock(),createElementBlock("span",{key:0,class:normalizeClass(["comfy-image-wrap",[{contain:s.contain}]])},[s.contain?(openBlock(),createElementBlock("img",{key:0,src:s.src,"data-test":s.src,class:"comfy-image-blur",style:normalizeStyle({"background-image":`url(${s.src})`}),alt:s.alt,onError:n},null,44,_hoisted_1$1W)):createCommentVNode("",!0),createBaseVNode("img",{src:s.src,class:normalizeClass(["comfy-image-main",i.class]),alt:s.alt,onError:n},null,42,_hoisted_2$1u)],2)),o.value?(openBlock(),createElementBlock("div",_hoisted_3$11,[a[0]||(a[0]=createBaseVNode("i",{class:"pi pi-image"},null,-1)),createBaseVNode("span",null,toDisplayString(s.$t("g.imageFailedToLoad")),1)])):createCommentVNode("",!0)],64))}}),ComfyImage=_export_sfc(_sfc_main$2k,[["__scopeId","data-v-8b2eb5c8"]]),_hoisted_1$1V={controls:"",width:"100%",height:"100%"},_hoisted_2$1t=["src","type"],_sfc_main$2j=defineComponent({__name:"ResultAudio",props:{result:{}},setup(i){const o=computed(()=>i.result.url),n=computed(()=>i.result.htmlAudioType);return(s,a)=>(openBlock(),createElementBlock("audio",_hoisted_1$1V,[createBaseVNode("source",{src:o.value,type:n.value},null,8,_hoisted_2$1t),createTextVNode(" "+toDisplayString(s.$t("g.audioFailedToLoad")),1)]))}}),_hoisted_1$1U={controls:"",width:"100%",height:"100%"},_hoisted_2$1s=["src","type"],_sfc_main$2i=defineComponent({__name:"ResultVideo",props:{result:{}},setup(i){const o=i,n=useSettingStore(),{isExtensionInstalled:s,isExtensionEnabled:a}=useExtensionStore(),r=computed(()=>s("VideoHelperSuite.Core")&&a("VideoHelperSuite.Core")&&n.get("VHS.AdvancedPreviews")&&n.get("VHS.AdvancedPreviews")!=="Never"),l=computed(()=>r.value?o.result.vhsAdvancedPreviewUrl:o.result.url),u=computed(()=>r.value?"video/webm":o.result.htmlVideoType);return(m,f)=>(openBlock(),createElementBlock("video",_hoisted_1$1U,[createBaseVNode("source",{src:l.value,type:u.value},null,8,_hoisted_2$1s),createTextVNode(" "+toDisplayString(m.$t("g.videoFailedToLoad")),1)]))}}),_sfc_main$2h=defineComponent({__name:"ResultGallery",props:{allGalleryItems:{},activeIndex:{}},emits:["update:activeIndex"],setup(i,{emit:o}){const n=ref(!1),s=o,a=i,r=computed(()=>a.allGalleryItems.length>1);let l=null;const u=p(w=>{l=w.target},"onMaskMouseDown"),m=p(w=>{const k=document.querySelector("[data-mask]");n.value&&l===w.target&&l===k&&(n.value=!1,f(!1))},"onMaskMouseUp");watch(()=>a.activeIndex,w=>{w!==-1&&(n.value=!0)});const f=p(w=>{w||s("update:activeIndex",-1)},"handleVisibilityChange"),_=p(w=>{s("update:activeIndex",w)},"handleActiveIndexChange"),y=p(w=>{if(n.value)switch(w.key){case"ArrowLeft":b(-1);break;case"ArrowRight":b(1);break;case"Escape":n.value=!1,f(!1);break}},"handleKeyDown"),b=p(w=>{const k=(a.activeIndex+w+a.allGalleryItems.length)%a.allGalleryItems.length;s("update:activeIndex",k)},"navigateImage");return onMounted(()=>{window.addEventListener("keydown",y)}),onUnmounted(()=>{window.removeEventListener("keydown",y)}),(w,k)=>(openBlock(),createBlock(unref(script$a),{visible:n.value,"onUpdate:visible":[k[0]||(k[0]=S=>n.value=S),f],"active-index":w.activeIndex,value:w.allGalleryItems,"show-indicators":!1,"change-item-on-indicator-hover":"","show-item-navigators":r.value,"full-screen":"",circular:r.value,"show-thumbnails":!1,pt:{mask:{onMousedown:u,onMouseup:m,"data-mask":!0},prevButton:{style:"position: fixed !important"},nextButton:{style:"position: fixed !important"}},"onUpdate:activeIndex":_},{item:withCtx(({item:S})=>[S.isImage?(openBlock(),createBlock(ComfyImage,{key:S.url,src:S.url,contain:!1,alt:S.filename,class:"galleria-image"},null,8,["src","alt"])):S.isVideo?(openBlock(),createBlock(_sfc_main$2i,{key:1,result:S},null,8,["result"])):S.isAudio?(openBlock(),createBlock(_sfc_main$2j,{key:2,result:S},null,8,["result"])):createCommentVNode("",!0)]),_:1},8,["visible","active-index","value","show-item-navigators","circular","pt"]))}}),_hoisted_1$1T=["id","aria-selected","aria-controls"],_sfc_main$2g=defineComponent({__name:"Tab",props:{value:{},panelId:{}},setup(i){const o=inject("tabs-value"),n=inject("tabs-update"),s=computed(()=>`tab-${i.value}`),a=computed(()=>o?.value===i.value),r=computed(()=>cn("flex items-center justify-center shrink-0","px-2.5 py-2 text-sm rounded-lg cursor-pointer transition-all duration-200","outline-hidden border-none",a.value?"bg-interface-menu-component-surface-hovered text-text-primary text-bold":"bg-transparent text-text-secondary hover:bg-button-hover-surface focus:bg-button-hover-surface")),l=p(()=>{n?.(i.value)},"handleClick");return(u,m)=>(openBlock(),createElementBlock("button",{id:s.value,class:normalizeClass(r.value),role:"tab","aria-selected":a.value,"aria-controls":u.panelId,tabindex:0,onClick:l},[renderSlot(u.$slots,"default")],10,_hoisted_1$1T))}}),_hoisted_1$1S={role:"tablist",class:"flex w-full items-center gap-2 pb-1"},_sfc_main$2f=defineComponent({__name:"TabList",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(i){const o=useModel(i,"modelValue");return provide("tabs-value",o),provide("tabs-update",n=>{o.value=n}),(n,s)=>(openBlock(),createElementBlock("div",_hoisted_1$1S,[renderSlot(n.$slots,"default")]))}}),_sfc_main$2e=defineComponent({__name:"IconGroup",setup(i){const o=cn("flex justify-center items-center shrink-0","outline-hidden border-none p-0 rounded-lg","bg-secondary-background shadow-sm","transition-all duration-200","cursor-pointer");return(n,s)=>(openBlock(),createElementBlock("div",{class:normalizeClass(unref(o))},[renderSlot(n.$slots,"default")],2))}}),_hoisted_1$1R={class:"relative inline-flex items-center"},_hoisted_2$1r={key:0,class:"icon-[lucide--ellipsis] text-sm"},_hoisted_3$10={key:1,class:"icon-[lucide--more-vertical] text-sm"},_hoisted_4$J={class:"flex min-w-40 flex-col gap-2 p-2"},_sfc_main$2d=defineComponent({__name:"MoreButton",props:{isVertical:{type:Boolean,default:!1},size:{default:"md"},type:{default:"secondary"},border:{type:Boolean},disabled:{type:Boolean},class:{}},emits:["menuOpened","menuClosed"],setup(i,{expose:o}){const n=ref(),s=p(r=>{n.value?.toggle(r)},"toggle"),a=p(()=>{n.value?.hide()},"hide");return o({hide:a}),(r,l)=>(openBlock(),createElementBlock("div",_hoisted_1$1R,[createVNode(_sfc_main$2B,{size:r.size,type:r.type,onClick:s},{default:withCtx(()=>[r.isVertical?(openBlock(),createElementBlock("i",_hoisted_3$10)):(openBlock(),createElementBlock("i",_hoisted_2$1r))]),_:1},8,["size","type"]),createVNode(unref(script$b),{ref_key:"popover",ref:n,"append-to":"body","auto-z-index":"",dismissable:"","close-on-escape":"",unstyled:"","base-z-index":1e3,pt:{root:{class:unref(cn)("absolute z-50")},content:{class:unref(cn)("mt-1 rounded-lg","bg-secondary-background text-base-foreground","shadow-lg")}},onShow:l[0]||(l[0]=u=>r.$emit("menuOpened")),onHide:l[1]||(l[1]=u=>r.$emit("menuClosed"))},{default:withCtx(()=>[createBaseVNode("div",_hoisted_4$J,[renderSlot(r.$slots,"default",{close:a})])]),_:3},8,["pt"])]))}}),_sfc_main$2c=defineComponent({__name:"CardBottom",props:{fullHeight:{type:Boolean,default:!0}},setup(i){const o=computed(()=>cn("flex-1 w-full",i.fullHeight&&"h-full"));return(n,s)=>(openBlock(),createElementBlock("div",{class:normalizeClass(o.value)},[renderSlot(n.$slots,"default")],2))}}),structureClasses="flex flex-col overflow-hidden",_sfc_main$2b=defineComponent({__name:"CardContainer",props:{size:{default:"regular"},variant:{default:"default"},rounded:{default:"md"},customAspectRatio:{},hasBorder:{type:Boolean,default:!0},hasBackground:{type:Boolean,default:!0},hasShadow:{type:Boolean,default:!0},hasCursor:{type:Boolean,default:!0},class:{default:""}},setup(i){const o={none:"rounded-none",md:"rounded",lg:"rounded-lg",xl:"rounded-xl"},n=computed(()=>{const s={default:cn(i.hasBackground&&"bg-modal-card-background",i.hasBorder&&"border border-border-default",i.hasShadow&&"shadow-sm",i.hasCursor&&"cursor-pointer"),ghost:cn(i.hasCursor&&"cursor-pointer","p-2 transition-colors duration-200"),outline:cn(i.hasBorder&&"border-2 border-border-subtle",i.hasCursor&&"cursor-pointer","hover:border-border-subtle/50 transition-colors")},a=i.customAspectRatio?`aspect-[${i.customAspectRatio}]`:{mini:"aspect-100/120",compact:"aspect-240/311",regular:"aspect-256/308",portrait:"aspect-256/325",tall:"aspect-256/353"}[i.size];return cn(structureClasses,o[i.rounded],s[i.variant],a,i.class)});return(s,a)=>(openBlock(),createElementBlock("div",{class:normalizeClass(n.value)},[renderSlot(s.$slots,"top"),renderSlot(s.$slots,"bottom")],2))}}),_sfc_main$2a=defineComponent({__name:"CardTop",props:{ratio:{default:"square"},topLeftClass:{},topRightClass:{},centerLeftClass:{},centerRightClass:{},bottomLeftClass:{},bottomRightClass:{}},setup(i){const o=useSlots(),n=computed(()=>`relative p-0 overflow-hidden ${{square:"aspect-square",landscape:"aspect-48/27"}[i.ratio]}`),s={"top-left":"absolute top-2 left-2 flex flex-wrap justify-start gap-2","top-right":"absolute top-2 right-2 flex flex-wrap justify-end gap-2","center-left":"absolute top-1/2 left-2 flex -translate-y-1/2 flex-wrap justify-start gap-2","center-right":"absolute top-1/2 right-2 flex -translate-y-1/2 flex-wrap justify-end gap-2","bottom-left":"absolute bottom-2 left-2 flex flex-wrap justify-start gap-2","bottom-right":"absolute right-2 bottom-2 flex flex-wrap justify-end gap-2"},a=computed(()=>({"top-left":cn(s["top-left"],i.topLeftClass),"top-right":cn(s["top-right"],i.topRightClass),"center-left":cn(s["center-left"],i.centerLeftClass),"center-right":cn(s["center-right"],i.centerRightClass),"bottom-left":cn(s["bottom-left"],i.bottomLeftClass),"bottom-right":cn(s["bottom-right"],i.bottomRightClass)}));return(r,l)=>(openBlock(),createElementBlock("div",{class:normalizeClass(n.value)},[renderSlot(r.$slots,"default",{class:"absolute top-0 left-0 h-full w-full"}),unref(o)["top-left"]?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(a.value["top-left"])},[renderSlot(r.$slots,"top-left")],2)):createCommentVNode("",!0),unref(o)["top-right"]?(openBlock(),createElementBlock("div",{key:1,class:normalizeClass(a.value["top-right"])},[renderSlot(r.$slots,"top-right")],2)):createCommentVNode("",!0),unref(o)["center-left"]?(openBlock(),createElementBlock("div",{key:2,class:normalizeClass(a.value["center-left"])},[renderSlot(r.$slots,"center-left")],2)):createCommentVNode("",!0),unref(o)["center-right"]?(openBlock(),createElementBlock("div",{key:3,class:normalizeClass(a.value["center-right"])},[renderSlot(r.$slots,"center-right")],2)):createCommentVNode("",!0),unref(o)["bottom-left"]?(openBlock(),createElementBlock("div",{key:4,class:normalizeClass(a.value["bottom-left"])},[renderSlot(r.$slots,"bottom-left")],2)):createCommentVNode("",!0),unref(o)["bottom-right"]?(openBlock(),createElementBlock("div",{key:5,class:normalizeClass(a.value["bottom-right"])},[renderSlot(r.$slots,"bottom-right")],2)):createCommentVNode("",!0)],2))}}),baseClasses="inline-flex shrink-0 items-center justify-center gap-1 rounded px-2 py-1 text-xs font-bold",_sfc_main$29=defineComponent({__name:"SquareChip",props:{label:{},variant:{default:"dark"}},setup(i){const o={dark:"bg-zinc-500/40 text-white/90",light:cn("backdrop-blur-[2px] bg-base-background/50 text-base-foreground"),gray:cn("backdrop-blur-[2px] bg-modal-card-tag-background text-base-foreground")},n=computed(()=>cn(baseClasses,o[i.variant]));return(s,a)=>(openBlock(),createElementBlock("div",{class:normalizeClass(n.value)},[renderSlot(s.$slots,"icon"),createBaseVNode("span",null,toDisplayString(s.label),1)],2))}}),_hoisted_1$1Q={class:"prompt-dialog-content m-2 mt-4 flex flex-col gap-6"},_hoisted_2$1q={key:0,class:"m-0 flex flex-col gap-2 pl-4"},_hoisted_3$$={class:"flex justify-end gap-4"},_hoisted_4$I={key:0,class:"flex justify-start gap-4"},_hoisted_5$D={for:"doNotAskAgain",severity:"secondary"},_sfc_main$28=defineComponent({__name:"ConfirmationDialogContent",props:{message:{},type:{},onConfirm:{type:Function},itemList:{},hint:{}},setup(i){const o=i,{t:n}=useI18n(),s=p(()=>useDialogStore().closeDialog(),"onCancel"),a=ref(!1),r=p(()=>{o.onConfirm(!1),useDialogStore().closeDialog()},"onDeny"),l=p(()=>{o.type==="overwriteBlueprint"&&a.value&&useSettingStore().set("Comfy.Workflow.WarnBlueprintOverwrite",!1),o.onConfirm(!0),useDialogStore().closeDialog()},"onConfirm");return(u,m)=>(openBlock(),createElementBlock("section",_hoisted_1$1Q,[createBaseVNode("span",null,toDisplayString(u.message),1),u.itemList?.length?(openBlock(),createElementBlock("ul",_hoisted_2$1q,[(openBlock(!0),createElementBlock(Fragment,null,renderList(u.itemList,f=>(openBlock(),createElementBlock("li",{key:f},toDisplayString(f),1))),128))])):createCommentVNode("",!0),u.hint?(openBlock(),createBlock(unref(script$1),{key:1,icon:"pi pi-info-circle",severity:"secondary",size:"small",variant:"simple"},{default:withCtx(()=>[createTextVNode(toDisplayString(u.hint),1)]),_:1})):createCommentVNode("",!0),createBaseVNode("div",_hoisted_3$$,[u.type==="overwriteBlueprint"?(openBlock(),createElementBlock("div",_hoisted_4$I,[createVNode(unref(script$9),{modelValue:a.value,"onUpdate:modelValue":m[0]||(m[0]=f=>a.value=f),class:"flex justify-start gap-4","input-id":"doNotAskAgain",binary:""},null,8,["modelValue"]),createBaseVNode("label",_hoisted_5$D,toDisplayString(unref(n)("missingModelsDialog.doNotAskAgain")),1)])):createCommentVNode("",!0),createVNode(unref(script),{label:u.$t("g.cancel"),icon:"pi pi-undo",severity:"secondary",autofocus:"",onClick:s},null,8,["label"]),u.type==="default"?(openBlock(),createBlock(unref(script),{key:1,label:u.$t("g.confirm"),severity:"primary",icon:"pi pi-check",onClick:l},null,8,["label"])):u.type==="delete"?(openBlock(),createBlock(unref(script),{key:2,label:u.$t("g.delete"),severity:"danger",icon:"pi pi-trash",onClick:l},null,8,["label"])):u.type==="overwrite"||u.type==="overwriteBlueprint"?(openBlock(),createBlock(unref(script),{key:3,label:u.$t("g.overwrite"),severity:"warn",icon:"pi pi-save",onClick:l},null,8,["label"])):u.type==="dirtyClose"?(openBlock(),createElementBlock(Fragment,{key:4},[createVNode(unref(script),{label:u.$t("g.no"),severity:"secondary",icon:"pi pi-times",onClick:r},null,8,["label"]),createVNode(unref(script),{label:u.$t("g.save"),icon:"pi pi-save",onClick:l},null,8,["label"])],64)):u.type==="reinstall"?(openBlock(),createBlock(unref(script),{key:5,label:u.$t("desktopMenu.reinstall"),severity:"warn",icon:"pi pi-eraser",onClick:l},null,8,["label"])):(openBlock(),createBlock(unref(script),{key:6,label:u.$t("g.close"),severity:"primary",icon:"pi pi-times",onClick:s},null,8,["label"]))])]))}}),ConfirmationDialogContent=_export_sfc(_sfc_main$28,[["__scopeId","data-v-28d16eab"]]);function useCopyToClipboard(){const{copy:i,copied:o}=useClipboard(),n=useToast(),s=p(()=>{n.add({severity:"success",summary:t("g.success"),detail:t("clipboard.successMessage"),life:3e3})},"showSuccessToast"),a=p(()=>{n.add({severity:"error",summary:t("g.error"),detail:t("clipboard.errorMessage")})},"showErrorToast");function r(u){const m=document.createElement("textarea");m.setAttribute("readonly",""),m.value=u,m.style.position="absolute",m.style.left="-9999px",m.setAttribute("aria-hidden","true"),m.setAttribute("tabindex","-1"),m.style.width="1px",m.style.height="1px",document.body.appendChild(m),m.select();try{document.execCommand("copy")?s():a()}catch{a()}finally{m.remove()}}return p(r,"fallbackCopy"),{copyToClipboard:p(async u=>{try{await i(u),o.value?s():r(u)}catch{r(u)}},"copyToClipboard")}}p(useCopyToClipboard,"useCopyToClipboard");function useWorkflowActionsService(){const i=useWorkflowStore(),o=useWorkflowService(),n=useSettingStore(),s=useDialogService();return{exportWorkflowAction:p(async(l,u)=>{if(!l)return{success:!1,error:"No workflow data available"};try{let m=u;if(n.get("Comfy.PromptFilename")){const y=await s.prompt({title:t("workflowService.exportWorkflow"),message:t("workflowService.enterFilename")+":",defaultValue:m});if(!y)return{success:!1};m=appendJsonExt(y)}const f=JSON.stringify(l,null,2),_=new Blob([f],{type:"application/json"});return downloadBlob(m,_),{success:!0}}catch(m){return{success:!1,error:m instanceof Error?m.message:"Failed to export workflow"}}},"exportWorkflowAction"),openWorkflowAction:p(async(l,u)=>{if(!l)return{success:!1,error:"No workflow data available"};try{const m=i.createTemporary(u,l);return await o.openWorkflow(m),{success:!0}}catch(m){return{success:!1,error:m instanceof Error?m.message:"Failed to open workflow"}}},"openWorkflowAction")}}p(useWorkflowActionsService,"useWorkflowActionsService");function isOutputAssetMetadata(i){return i?typeof i.promptId=="string"&&(typeof i.nodeId=="string"||typeof i.nodeId=="number"):!1}p(isOutputAssetMetadata,"isOutputAssetMetadata");function getOutputAssetMetadata(i){return isOutputAssetMetadata(i)?i:null}p(getOutputAssetMetadata,"getOutputAssetMetadata");function getAssetType(i,o="output"){return i.tags?.[0]||o}p(getAssetType,"getAssetType");function getAssetUrl(i,o="output"){const n=getAssetType(i,o);return api.apiURL(`/view?filename=${encodeURIComponent(i.name)}&type=${n}`)}p(getAssetUrl,"getAssetUrl");var ComfyMetadataTags=(i=>(i.PROMPT="PROMPT",i.WORKFLOW="WORKFLOW",i))(ComfyMetadataTags||{}),ASCII$1=(i=>(i[i.GLTF=1179937895]="GLTF",i[i.JSON=1313821514]="JSON",i[i.OPEN_BRACE=123]="OPEN_BRACE",i))(ASCII$1||{}),GltfSizeBytes=(i=>(i[i.HEADER=12]="HEADER",i[i.CHUNK_HEADER=8]="CHUNK_HEADER",i))(GltfSizeBytes||{});const WEBM_SIGNATURE=[26,69,223,163],MAX_READ_BYTES$2=2*1024*1024,EBML_ID={SIMPLE_TAG:new Uint8Array([103,200]),TAG_NAME:new Uint8Array([69,163]),TAG_VALUE:new Uint8Array([68,135])},ASCII={OPEN_BRACE:123,NULL:0,PRINTABLE_MIN:32,PRINTABLE_MAX:126},MASK={MSB:128,ALL_BITS_SET:-1},hasWebmSignature=p(i=>WEBM_SIGNATURE.every((o,n)=>i[n]===o),"hasWebmSignature"),readVint=p((i,o)=>{if(o>=i.length)return null;const n=i[o];if((n&MASK.MSB)===MASK.MSB)return{value:n&~MASK.MSB,length:1};const s=findFirstSetBitPosition(n);return s===0||o+s>i.length?null:{value:calculateVintValue(i,o,s),length:s}},"readVint"),calculateVintValue=p((i,o,n)=>{let s=i[o]&255>>n;for(let r=1;r<n;r++)s=s<<8|i[o+r];const a=Math.pow(2,7*n)-1;return s===a?MASK.ALL_BITS_SET:s},"calculateVintValue"),findFirstSetBitPosition=p(i=>{for(let o=MASK.MSB,n=1;o!==0;o>>=1,n++)if(i&o)return n;return 0},"findFirstSetBitPosition"),matchesId=p((i,o,n)=>{if(o+n.length>i.length)return!1;for(let s=0;s<n.length;s++)if(i[o+s]!==n[s])return!1;return!0},"matchesId"),findNextTag=p((i,o)=>{if(!matchesId(i,o,EBML_ID.SIMPLE_TAG))return null;const n=readVint(i,o+2);if(!n||n.value<=0)return null;const s=o+2+n.length+n.value;if(s>i.length)return null;const a=extractTagContents(i,o+2+n.length,s);return{tagEnd:s,contents:a}},"findNextTag"),extractTagContents=p((i,o,n)=>{const s=findElementsInTag(i,o,n,EBML_ID.TAG_NAME),a=findElementsInTag(i,o,n,EBML_ID.TAG_VALUE);return!s||!a?null:{name:s,value:a}},"extractTagContents"),findElementsInTag=p((i,o,n,s)=>{for(let a=o;a<n-1;){if(matchesId(i,a,s)){const r=readVint(i,a+2);if(r&&r.value>0)return{pos:a+2+r.length,len:r.value}}a++}return null},"findElementsInTag"),processTagContents=p((i,o,n)=>{try{const s=extractEbmlTagName(i,o.name.pos,o.name.len);if(!s)return;const a=extractEbmlTagValue(i,s,o.value.pos,o.value.len);a!==null&&(n[s.toLowerCase()]=a)}catch{}},"processTagContents"),extractEbmlTagValue=p((i,o,n,s)=>o===ComfyMetadataTags.PROMPT||o===ComfyMetadataTags.WORKFLOW?readJson(i,n,s):ebmlToString(i,n,s),"extractEbmlTagValue"),extractEbmlTagName=p((i,o,n)=>{if(n<=0)return null;const s=findReadableTextRange(i,o,n);return s?new TextDecoder().decode(i.subarray(s.start,s.end)).trim():null},"extractEbmlTagName"),findReadableTextRange=p((i,o,n)=>{const s=p(l=>l>=ASCII.PRINTABLE_MIN&&l<=ASCII.PRINTABLE_MAX,"isPrintableAscii");let a=o;for(;a<o+n&&!s(i[a]);)a++;if(a>=o+n)return null;let r=a;for(;r<o+n&&i[r]!==ASCII.NULL;)r++;return{start:a,end:r}},"findReadableTextRange"),readJson=p((i,o,n)=>{if(n<=0)return null;const s=findNullTerminator(i,o,n),a=findJsonStart(i,o,s-o);if(a===null)return null;const r=decodeJsonText(i,a,s);return parseJsonText(r)},"readJson"),decodeJsonText=p((i,o,n)=>new TextDecoder().decode(i.subarray(o,n)),"decodeJsonText"),parseJsonText=p(i=>{const o=findJsonEnd(i);if(o===null)return null;try{return JSON.parse(i.substring(0,o))}catch{return null}},"parseJsonText"),findNullTerminator=p((i,o,n)=>{const s=Math.min(o+n,i.length);for(let a=o;a<s;a++)if(i[a]===ASCII.NULL)return a;return s},"findNullTerminator"),findJsonStart=p((i,o,n)=>{for(let s=o;s<o+n;s++)if(i[s]===ASCII.OPEN_BRACE)return s;return null},"findJsonStart"),findJsonEnd=p(i=>{let o=1,n=1;for(;o>0&&n<i.length;)i[n]==="{"&&o++,i[n]==="}"&&o--,n++;return o===0?n:null},"findJsonEnd"),ebmlToString=p((i,o,n)=>{if(n<=0)return"";const s=findNullTerminator(i,o,n);return new TextDecoder().decode(i.subarray(o,s)).trim()},"ebmlToString"),parseMetadata=p(i=>{const o={};for(let n=0;n<i.length-2;){const s=findNextTag(i,n);if(!s){n++;continue}const{tagEnd:a,contents:r}=s;r&&processTagContents(i,r,o),n=a}return o},"parseMetadata"),handleFileLoad=p((i,o)=>{if(!i.target?.result){o({});return}try{const n=new Uint8Array(i.target.result);if(n.length<4||!hasWebmSignature(n)){o({});return}o(parseMetadata(n))}catch{o({})}},"handleFileLoad");function getFromWebmFile(i){return new Promise(o=>{const n=new FileReader;n.onload=s=>handleFileLoad(s,o),n.onerror=()=>o({}),n.readAsArrayBuffer(i.slice(0,MAX_READ_BYTES$2))})}p(getFromWebmFile,"getFromWebmFile");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.ebml=window.comfyAPI.ebml||{};window.comfyAPI.ebml.getFromWebmFile=getFromWebmFile;const MAX_READ_BYTES$1=1<<20,isJsonChunk=p(i=>!!i&&i.chunkTypeIdentifier===ASCII$1.JSON,"isJsonChunk"),isValidChunkRange=p((i,o,n)=>i+o<=n,"isValidChunkRange"),byteArrayToString=p(i=>new TextDecoder().decode(i),"byteArrayToString"),parseGltfBinaryHeader=p(i=>{if(i.byteLength<GltfSizeBytes.HEADER)return null;const o=i.getUint32(0,!0);return o!==ASCII$1.GLTF?null:{magicNumber:o,gltfFormatVersion:i.getUint32(4,!0),totalLengthBytes:i.getUint32(8,!0)}},"parseGltfBinaryHeader"),parseChunkHeaderAtOffset=p((i,o)=>o+GltfSizeBytes.CHUNK_HEADER>i.byteLength?null:{chunkLengthBytes:i.getUint32(o,!0),chunkTypeIdentifier:i.getUint32(o+4,!0)},"parseChunkHeaderAtOffset"),extractJsonChunk=p(i=>{const o=new DataView(i);if(!parseGltfBinaryHeader(o))return null;const s=GltfSizeBytes.HEADER,a=parseChunkHeaderAtOffset(o,s);if(!a||!isJsonChunk(a))return null;const r=s+GltfSizeBytes.CHUNK_HEADER;return isValidChunkRange(r,a.chunkLengthBytes,o.byteLength)?{start:r,length:a.chunkLengthBytes}:null},"extractJsonChunk"),extractJsonChunkData=p(i=>{const o=extractJsonChunk(i);return o?new Uint8Array(i,o.start,o.length):null},"extractJsonChunkData"),parseJson=p(i=>{try{return JSON.parse(i)}catch{return null}},"parseJson"),parseJsonBytes=p(i=>{const o=byteArrayToString(i);return parseJson(o)},"parseJsonBytes"),parseMetadataValue=p(i=>{if(typeof i!="string")return i;const o=parseJson(i);if(o)return o},"parseMetadataValue"),extractComfyMetadata=p(i=>{const o={};if(!i?.asset?.extras)return o;const{extras:n}=i.asset;if(n.workflow){const s=parseMetadataValue(n.workflow);s&&(o[ComfyMetadataTags.WORKFLOW.toLowerCase()]=s)}if(n.prompt){const s=parseMetadataValue(n.prompt);s&&(o[ComfyMetadataTags.PROMPT.toLowerCase()]=s)}return o},"extractComfyMetadata"),processGltfFileBuffer=p(i=>{const o=extractJsonChunkData(i);if(!o)return{};const n=parseJsonBytes(o);return n?extractComfyMetadata(n):{}},"processGltfFileBuffer");function getGltfBinaryMetadata(i){return new Promise(o=>{if(!i)return Promise.resolve({});const n=Math.min(i.size,MAX_READ_BYTES$1),s=new FileReader;s.onload=a=>{try{if(!a.target?.result){o({});return}o(processGltfFileBuffer(a.target.result))}catch{o({})}},s.onerror=()=>o({}),s.readAsArrayBuffer(i.slice(0,n))})}p(getGltfBinaryMetadata,"getGltfBinaryMetadata");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.gltf=window.comfyAPI.gltf||{};window.comfyAPI.gltf.getGltfBinaryMetadata=getGltfBinaryMetadata;const MAX_READ_BYTES=64*1024*1024,BOX_TYPES={USER_DATA:[117,100,116,97],META_DATA:[109,101,116,97],ITEM_LIST:[105,108,115,116],KEYS:[107,101,121,115],DATA:[100,97,116,97],MOVIE:[109,111,111,118]},SIZES={HEADER:8,VERSION:4,LOCALE:4,ITEM_MIN:8},bufferMatchesBoxType=p((i,o,n)=>{if(o+4>i.length)return!1;for(let s=0;s<4;s++)if(i[o+s]!==n[s])return!1;return!0},"bufferMatchesBoxType"),readUint32=p((i,o)=>o+4>i.length?0:i[o]<<24|i[o+1]<<16|i[o+2]<<8|i[o+3],"readUint32"),findIsobmffBoxByType=p((i,o,n,s)=>{for(let a=o;a<n-8;a++){const r=readUint32(i,a);if(!(r<SIZES.ITEM_MIN)){if(bufferMatchesBoxType(i,a+4,s))return{start:a+SIZES.HEADER,end:a+r};if(a+r>n)return null;a+=r-1}}return null},"findIsobmffBoxByType"),extractJson=p((i,o,n)=>{let s=o;for(;s<n&&i[s]!==ASCII$1.OPEN_BRACE;)s++;if(s>=n)return null;try{const a=new TextDecoder().decode(i.slice(s,n));return JSON.parse(a)}catch{return null}},"extractJson"),readUtf8String=p((i,o,n)=>new TextDecoder().decode(i.slice(o,n)),"readUtf8String"),parseKeysBox=p((i,o,n)=>{const s=new Map;let a=o+4;if(a+4>n)return s;const r=readUint32(i,a);a+=4;for(let l=1;l<=r&&!(a+SIZES.HEADER>n);l++){const u=readUint32(i,a);a+=SIZES.HEADER;const m=a+u-SIZES.HEADER;if(u<SIZES.ITEM_MIN||m>n)break;const f=readUtf8String(i,a,m);s.set(l,f),a=m}return s},"parseKeysBox"),extractMetadataValueFromDataBox=p((i,o,n,s)=>{const a=o+SIZES.VERSION+SIZES.LOCALE;if(a>=n)return null;const r=s.toLowerCase();return(r===ComfyMetadataTags.PROMPT.toLowerCase()||r===ComfyMetadataTags.WORKFLOW.toLowerCase())&&extractJson(i,a,n)||null},"extractMetadataValueFromDataBox"),parseIlstItem=p((i,o,n,s,a)=>{if(o+SIZES.HEADER>n)return;const r=readUint32(i,o+4),l=s.get(r);if(!l)return;const u=findIsobmffBoxByType(i,o+SIZES.HEADER,n,BOX_TYPES.DATA);if(u){const m=extractMetadataValueFromDataBox(i,u.start,u.end,l);m!==null&&(a[l.toLowerCase()]=m)}},"parseIlstItem"),parseIlstBox=p((i,o,n,s,a)=>{let r=o;for(;r<n-SIZES.HEADER;){const l=readUint32(i,r);if(l<=SIZES.HEADER||r+l>n)break;parseIlstItem(i,r,r+l,s,a),r+=l}},"parseIlstBox"),findUserDataBox=p(i=>{let o=null;if(o=findIsobmffBoxByType(i,0,i.length,BOX_TYPES.USER_DATA),!o){const n=findIsobmffBoxByType(i,0,i.length,BOX_TYPES.MOVIE);n&&(o=findIsobmffBoxByType(i,n.start,n.end,BOX_TYPES.USER_DATA))}return o},"findUserDataBox"),parseIsobmffMetadata=p(i=>{const o={},n=findUserDataBox(i);if(!n)return o;const s=findIsobmffBoxByType(i,n.start,n.end,BOX_TYPES.META_DATA);if(!s)return o;const a=s.start+SIZES.VERSION,r=findIsobmffBoxByType(i,a,s.end,BOX_TYPES.KEYS);if(!r)return o;const l=parseKeysBox(i,r.start,r.end);if(l.size===0)return o;const u=findIsobmffBoxByType(i,a,s.end,BOX_TYPES.ITEM_LIST);return u&&parseIlstBox(i,u.start,u.end,l,o),o},"parseIsobmffMetadata");function getFromIsobmffFile(i){return new Promise(o=>{const n=new FileReader;n.onload=s=>{if(!s.target?.result){o({});return}try{const a=new Uint8Array(s.target.result);o(parseIsobmffMetadata(a))}catch(a){console.error("Parser: Error parsing ISOBMFF metadata:",a),o({})}},n.onerror=s=>{console.error("FileReader: Error reading ISOBMFF file:",s),o({})},n.readAsArrayBuffer(i.slice(0,MAX_READ_BYTES))})}p(getFromIsobmffFile,"getFromIsobmffFile");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.isobmff=window.comfyAPI.isobmff||{};window.comfyAPI.isobmff.getFromIsobmffFile=getFromIsobmffFile;function getDataFromJSON(i){return new Promise(o=>{const n=new FileReader;n.onload=async()=>{const s=n.result,a=JSON.parse(s);if(a?.templates){o({templates:a.templates});return}if(isApiJson(a)){o({prompt:a});return}o({workflow:a})},n.readAsText(i)})}p(getDataFromJSON,"getDataFromJSON");function isApiJson(i){return isObject(i)&&Object.values(i).every(o=>o.class_type)}p(isApiJson,"isApiJson");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.json=window.comfyAPI.json||{};window.comfyAPI.json.getDataFromJSON=getDataFromJSON;async function getMp3Metadata(i){const o=new FileReader,n=new Promise(_=>o.onload=y=>_(y?.target?.result));o.readAsArrayBuffer(i);const s=await n,a=new Uint8Array(s,0,3);(a[0]!=255&&a[1]!=251||a[0]!=73&&a[1]!=68&&a[2]!=51)&&console.error("Invalid file signature.");let r="";for(;r.length<s.byteLength;){const _=String.fromCharCode(...new Uint8Array(s,r.length,r.length+4096));if(r+=_,_.match("Ã¿Ã»"))break}let l,u,m=r.match(/prompt\u0000(\{.*?\})\u0000/s)?.[1];m&&(u=JSON.parse(m));let f=r.match(/workflow\u0000(\{.*?\})\u0000/s)?.[1];return f&&(l=JSON.parse(f)),{prompt:u,workflow:l}}p(getMp3Metadata,"getMp3Metadata");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.mp3=window.comfyAPI.mp3||{};window.comfyAPI.mp3.getMp3Metadata=getMp3Metadata;async function getOggMetadata(i){const o=new FileReader,n=new Promise(y=>o.onload=b=>y(b?.target?.result));o.readAsArrayBuffer(i);const s=await n;String.fromCharCode(...new Uint8Array(s,0,4))!=="OggS"&&console.error("Invalid file signature.");let r=0,l="";for(;l.length<s.byteLength;){const y=String.fromCharCode(...new Uint8Array(s,l.length,l.length+4096));if(y.match("OggS\0")&&r++,l+=y,r>1)break}let u,m,f=l.match(/prompt=(\{.*?(\}.*?\u0000))/s)?.[1]?.match(/\{.*\}/)?.[0];f&&(m=JSON.parse(f));let _=l.match(/workflow=(\{.*?(\}.*?\u0000))/s)?.[1]?.match(/\{.*\}/)?.[0];return _&&(u=JSON.parse(_)),{prompt:m,workflow:u}}p(getOggMetadata,"getOggMetadata");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.ogg=window.comfyAPI.ogg||{};window.comfyAPI.ogg.getOggMetadata=getOggMetadata;async function getSvgMetadata(i){const o=await i.text(),n=/<metadata>\s*<!\[CDATA\[([\s\S]*?)\]\]>\s*<\/metadata>/i.exec(o);if(n&&n[1])try{return JSON.parse(n[1].trim())}catch(s){return console.error("Error parsing SVG metadata:",s),{}}return{}}p(getSvgMetadata,"getSvgMetadata");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.svg=window.comfyAPI.svg||{};window.comfyAPI.svg.getSvgMetadata=getSvgMetadata;const readNullTerminatedString=p((i,o,n)=>{let s=0;for(;o+s<n&&i.getUint8(o+s)!==0;)s++;return{str:new TextDecoder("utf-8").decode(new Uint8Array(i.buffer,i.byteOffset+o,s)),length:s+1}},"readNullTerminatedString"),parseInfeBox=p((i,o)=>{const n=i.getUint8(o),s=i.getUint32(o)&16777215;let a=o+4,r,l,u;if(n>=2){n===2?(r=i.getUint16(a),a+=2):(r=i.getUint32(a),a+=4),l=i.getUint16(a),a+=2,u=String.fromCharCode(...new Uint8Array(i.buffer,i.byteOffset+a,4)),a+=4;const{str:m,length:f}=readNullTerminatedString(i,a,i.byteLength);a+=f;const _=readNullTerminatedString(i,a,i.byteLength).str;return{box_header:{size:0,type:"infe"},version:n,flags:s,item_ID:r,item_protection_index:l,item_type:u,item_name:m,content_type:_}}throw new Error(`Unsupported infe box version: ${n}`)},"parseInfeBox"),parseIinfBox=p((i,o)=>{if(!o)throw new Error("iinf box not found");const n=i.getUint8(o.start),s=i.getUint32(o.start)&16777215;let a=o.start+4;const r=n===0?i.getUint16(a):i.getUint32(a);a+=n===0?2:4;const l=[];for(let u=0;u<r;u++){const m=i.getUint32(a);if(String.fromCharCode(...new Uint8Array(i.buffer,i.byteOffset+a+4,4))==="infe"){const _=parseInfeBox(i,a+8);_.box_header.size=m,l.push(_)}a+=m}return{box_header:{size:o.end-o.start+8,type:"iinf"},version:n,flags:s,entry_count:r,entries:l}},"parseIinfBox"),parseIlocBox=p((i,o)=>{if(!o)throw new Error("iloc box not found");const n=i.getUint8(o.start),s=i.getUint32(o.start)&16777215;let a=o.start+4;const r=i.getUint8(a++),l=r>>4&15,u=r&15,m=i.getUint8(a)>>4&15,f=n===1||n===2?i.getUint8(a)&15:0;a++;const _=n<2?i.getUint16(a):i.getUint32(a);a+=n<2?2:4;const y=[];for(let b=0;b<_;b++){const w=n<2?i.getUint16(a):i.getUint32(a);a+=n<2?2:4,(n===1||n===2)&&(a+=2);const k=i.getUint16(a);a+=2;const S=m>0?i.getUint32(a):0;a+=m;const C=i.getUint16(a);a+=2;const I=[];for(let T=0;T<C;T++){(n===1||n===2)&&f>0&&(a+=f);const E=i.getUint32(a);a+=l;const N=i.getUint32(a);a+=u,I.push({extent_offset:E,extent_length:N})}y.push({item_ID:w,data_reference_index:k,base_offset:S,extent_count:C,extents:I})}return{box_header:{size:o.end-o.start+8,type:"iloc"},version:n,flags:s,offset_size:l,length_size:u,base_offset_size:m,index_size:f,item_count:_,items:y}},"parseIlocBox");function findBox(i,o,n,s){let a=o;for(;a<n&&!(a+8>n);){const r=i.getUint32(a),l=String.fromCharCode(...new Uint8Array(i.buffer,i.byteOffset+a+4,4));if(r===0)break;if(l===s)return{start:a+8,end:a+r};if(a+r>n)break;a+=r}return null}p(findBox,"findBox");function parseAvifMetadata(i){const o={},n=new DataView(i);if(n.getUint32(4)!==1718909296||n.getUint32(8)!==1635150182)return console.error("Not a valid AVIF file"),{};const s=findBox(n,0,n.byteLength,"meta");if(!s)return{};const a=s.start+4,r=findBox(n,a,s.end,"iinf"),u=parseIinfBox(n,r).entries.find(k=>k.item_type==="Exif");if(!u)return{};const m=findBox(n,a,s.end,"iloc"),_=parseIlocBox(n,m).items.find(k=>k.item_ID===u.item_ID);if(!_||_.extents.length===0)return{};const y=_.extents[0],b=new Uint8Array(i,y.extent_offset,y.extent_length);let w=-1;for(let k=0;k<b.length-4;k++)if(b[k]===77&&b[k+1]===77&&b[k+2]===0&&b[k+3]===42||b[k]===73&&b[k+1]===73&&b[k+2]===42&&b[k+3]===0){w=k;break}if(w!==-1){const k=b.subarray(w),S=parseExifData$1(k);for(const C in S){const I=S[C];if(typeof I=="string")if(C==="usercomment")try{const T=JSON.parse(I);T.prompt&&(o[ComfyMetadataTags.PROMPT]=T.prompt),T.workflow&&(o[ComfyMetadataTags.WORKFLOW]=T.workflow)}catch(T){console.error("Failed to parse usercomment JSON",T)}else{const[T,...E]=I.split(":"),N=E.join(":").trim();if(T.toLowerCase()===ComfyMetadataTags.PROMPT.toLowerCase()||T.toLowerCase()===ComfyMetadataTags.WORKFLOW.toLowerCase())try{const L=JSON.parse(N);o[T.toLowerCase()]=L}catch(L){console.error(`Failed to parse JSON for ${T}`,L)}}}}return o}p(parseAvifMetadata,"parseAvifMetadata");function parseExifData$1(i){const o=String.fromCharCode(...i.slice(0,2))==="II";function n(l,u,m){let f=i.slice(l,l+m);if(m===2)return new DataView(f.buffer,f.byteOffset,f.byteLength).getUint16(0,u);if(m===4)return new DataView(f.buffer,f.byteOffset,f.byteLength).getUint32(0,u)}p(n,"readInt");const s=n(4,o,4);function a(l){const u=n(l,o,2),m={};for(let f=0;f<u;f++){const _=l+2+f*12,y=n(_,o,2),b=n(_+2,o,2),w=n(_+4,o,4),k=n(_+8,o,4);let S;b===2&&(S=new TextDecoder("utf-8").decode(i.subarray(k,k+w-1))),m[y]=S}return m}return p(a,"parseIFD"),a(s)}p(parseExifData$1,"parseExifData$1");function getFromAvifFile(i){return new Promise(o=>{const n=new FileReader;n.onload=s=>{const a=s.target?.result;if(!a){o({});return}try{const r=parseAvifMetadata(a),l={};r.prompt&&(l.prompt=JSON.stringify(r.prompt)),r.workflow&&(l.workflow=JSON.stringify(r.workflow)),o(l)}catch(r){console.error("Parser: Error parsing AVIF metadata:",r),o({})}},n.onerror=s=>{console.error("FileReader: Error reading AVIF file:",s),o({})},n.readAsArrayBuffer(i)})}p(getFromAvifFile,"getFromAvifFile");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.avif=window.comfyAPI.avif||{};window.comfyAPI.avif.getFromAvifFile=getFromAvifFile;function getFromFlacBuffer(i){const o=new DataView(i);if(String.fromCharCode(...new Uint8Array(i,0,4))!=="fLaC"){console.error("Not a valid FLAC file");return}let s=4,a=null;for(;s<o.byteLength;){const r=o.getUint8(s)&128,l=o.getUint8(s)&127,u=o.getUint32(s,!1)&16777215;if(s+=4,l===4&&(a=parseVorbisComment(new DataView(i,s,u))),s+=u,r)break}return a}p(getFromFlacBuffer,"getFromFlacBuffer");function getFromFlacFile(i){return new Promise(o=>{const n=new FileReader;n.onload=function(s){const a=s.target.result;o(getFromFlacBuffer(a))},n.readAsArrayBuffer(i)})}p(getFromFlacFile,"getFromFlacFile");function parseVorbisComment(i){let o=0;const n=i.getUint32(o,!0);o+=4,getString(i,o,n),o+=n;const s=i.getUint32(o,!0);o+=4;const a={};for(let r=0;r<s;r++){const l=i.getUint32(o,!0);o+=4;const u=getString(i,o,l);o+=l;const m=u.indexOf("="),f=u.substring(0,m);a[f]=u.substring(m+1)}return a}p(parseVorbisComment,"parseVorbisComment");function getString(i,o,n){let s="";for(let a=0;a<n;a++)s+=String.fromCharCode(i.getUint8(o+a));return s}p(getString,"getString");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.flac=window.comfyAPI.flac||{};window.comfyAPI.flac.getFromFlacBuffer=getFromFlacBuffer;window.comfyAPI.flac.getFromFlacFile=getFromFlacFile;function getFromPngBuffer(i){const o=new Uint8Array(i),n=new DataView(o.buffer);if(n.getUint32(0)!==2303741511)return console.error("Not a valid PNG file"),{};let s=8,a={};for(;s<o.length;){const r=n.getUint32(s),l=String.fromCharCode(...o.slice(s+4,s+8));if(l==="tEXt"||l=="comf"||l==="iTXt"){let u=s+8;for(;o[u]!==0;)u++;const m=String.fromCharCode(...o.slice(s+8,u)),f=o.slice(u+1,s+8+r),_=new TextDecoder("utf-8").decode(f);a[m]=_}s+=12+r}return a}p(getFromPngBuffer,"getFromPngBuffer");function getFromPngFile(i){return new Promise(o=>{const n=new FileReader;n.onload=s=>{o(getFromPngBuffer(s.target.result))},n.readAsArrayBuffer(i)})}p(getFromPngFile,"getFromPngFile");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.png=window.comfyAPI.png||{};window.comfyAPI.png.getFromPngBuffer=getFromPngBuffer;window.comfyAPI.png.getFromPngFile=getFromPngFile;function getPngMetadata(i){return getFromPngFile(i)}p(getPngMetadata,"getPngMetadata");function getFlacMetadata(i){return getFromFlacFile(i)}p(getFlacMetadata,"getFlacMetadata");function getAvifMetadata(i){return getFromAvifFile(i)}p(getAvifMetadata,"getAvifMetadata");function parseExifData(i){const o=String.fromCharCode(...i.slice(0,2))==="II";function n(l,u,m){let f=i.slice(l,l+m);if(m===2)return new DataView(f.buffer,f.byteOffset,f.byteLength).getUint16(0,u);if(m===4)return new DataView(f.buffer,f.byteOffset,f.byteLength).getUint32(0,u)}p(n,"readInt");const s=n(4,o,4);function a(l){const u=n(l,o,2),m={};for(let f=0;f<u;f++){const _=l+2+f*12,y=n(_,o,2),b=n(_+2,o,2),w=n(_+4,o,4),k=n(_+8,o,4);let S;b===2&&(S=new TextDecoder("utf-8").decode(i.subarray(k,k+w-1))),m[y]=S}return m}return p(a,"parseIFD"),a(s)}p(parseExifData,"parseExifData");function getWebpMetadata(i){return new Promise(o=>{const n=new FileReader;n.onload=s=>{const a=new Uint8Array(s.target.result),r=new DataView(a.buffer);if(r.getUint32(0)!==1380533830||r.getUint32(8)!==1464156752){console.error("Not a valid WEBP file"),o({});return}let l=12,u={};for(;l<a.length;){const f=r.getUint32(l+4,!0);if(String.fromCharCode(...a.slice(l,l+4))==="EXIF"){String.fromCharCode(...a.slice(l+8,l+8+6))=="Exif\0\0"&&(l+=6);let y=parseExifData(a.slice(l+8,l+8+f));for(var m in y){const b=y[m];if(typeof b=="string"){const w=b.indexOf(":");u[b.slice(0,w)]=b.slice(w+1)}}break}l+=8+f}o(u)},n.readAsArrayBuffer(i)})}p(getWebpMetadata,"getWebpMetadata");function getLatentMetadata(i){return new Promise(o=>{const n=new FileReader;n.onload=a=>{const r=new Uint8Array(a.target?.result);let u=new DataView(r.buffer).getUint32(0,!0),m=8,f=JSON.parse(new TextDecoder().decode(r.slice(m,m+u)));o(f.__metadata__)};var s=i.slice(0,1024*1024*4);n.readAsArrayBuffer(s)})}p(getLatentMetadata,"getLatentMetadata");async function importA1111(i,o){const n=o.lastIndexOf(`
Steps:`);if(n>-1){const s=await api.getEmbeddings(),a=o.substr(n).split(`
`)[1].match(new RegExp('\\s*([^:]+:\\s*([^"\\{].*?|".*?"|\\{.*?\\}))\\s*(,|$)',"g")).reduce((l,u)=>{const m=u.split(":");return m[1].endsWith(",")&&(m[1]=m[1].substr(0,m[1].length-1)),l[m[0].trim().toLowerCase()]=m[1].trim(),l},{}),r=o.lastIndexOf(`
Negative prompt:`,n);if(r>-1){let l=o.substr(0,r).trim(),u=o.substring(r+18,n).trim();const m=LiteGraph.createNode("CheckpointLoaderSimple"),f=LiteGraph.createNode("CLIPSetLastLayer"),_=LiteGraph.createNode("CLIPTextEncode"),y=LiteGraph.createNode("CLIPTextEncode"),b=LiteGraph.createNode("KSampler"),w=LiteGraph.createNode("EmptyLatentImage"),k=LiteGraph.createNode("VAEDecode"),S=LiteGraph.createNode("SaveImage");let C=null,I=null;const T=p(P=>Math.ceil(P/64)*64,"ceil64"),E=p((P,R)=>P.widgets.find(V=>V.name===R),"getWidget"),N=p((P,R,V,$)=>{const F=E(P,R);if($){const j=F.options.values.find(U=>U.startsWith(V));j?F.value=j:(console.warn(`Unknown value '${V}' for widget '${R}'`,P),F.value=V)}else F.value=V},"setWidgetValue"),L=p((P,R,V,$)=>{const F=[];R=R.replace(/<lora:([^:]+:[^>]+)>/g,function(j,U){const G=U.split(":"),H=parseFloat(G[1]);return isNaN(H)?console.warn("Invalid LORA",j):F.push({name:G[0],weight:H}),""});for(const j of F){const U=LiteGraph.createNode("LoraLoader");i.add(U),N(U,"lora_name",j.name,!0),N(U,"strength_model",j.weight),N(U,"strength_clip",j.weight),$.node.connect($.index,U,0),V.node.connect(V.index,U,1),$={node:U,index:0},V={node:U,index:1}}return V.node.connect(1,P,0),$.node.connect(0,b,0),C&&$.node.connect(0,C,0),{text:R,prevModel:$,prevClip:V}},"createLoraNodes"),A=p(P=>s.length?P.replaceAll(new RegExp("\\b("+s.map(R=>R.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("\\b|\\b")+")\\b","ig"),"embedding:$1"):P,"replaceEmbeddings"),D=p(P=>{const R=a[P];return delete a[P],R},"popOpt");i.clear(),i.add(m),i.add(f),i.add(_),i.add(y),i.add(b),i.add(w),i.add(k),i.add(S),m.connect(1,f,0),f.connect(0,_,0),f.connect(0,y,0),m.connect(0,b,0),_.connect(0,b,1),y.connect(0,b,2),w.connect(0,b,3),k.connect(0,S,0),b.connect(0,k,0),m.connect(2,k,1);const O={model(P){N(m,"ckpt_name",P,!0)},vae(){},"cfg scale"(P){N(b,"cfg",+P)},"clip skip"(P){N(f,"stop_at_clip_layer",-P)},sampler(P){let R=P.toLowerCase().replace("++","pp").replaceAll(" ","_");R.includes("karras")?(R=R.replace("karras","").replace(/_+$/,""),N(b,"scheduler","karras")):N(b,"scheduler","normal");const $=E(b,"sampler_name").options.values.find(F=>F===R||F==="sample_"+R);$&&N(b,"sampler_name",$)},size(P){const R=P.split("x"),V=T(+R[0]),$=T(+R[1]),F=D("hires upscale"),j=D("hires resize");I=D("hires steps");let U=D("hires upscaler");if(N(w,"width",V),N(w,"height",$),F||j){let G,H;if(F)G=V*F,H=$*F;else{const Q=j.split("x");G=+Q[0],H=+Q[1]}let W,X;if(U.startsWith("Latent")){switch(X=W=LiteGraph.createNode("LatentUpscale"),i.add(W),b.connect(0,W,0),U){case"Latent (nearest-exact)":U="nearest-exact";break}N(W,"upscale_method",U,!0)}else{const Q=LiteGraph.createNode("VAEDecodeTiled");i.add(Q),b.connect(0,Q,0),m.connect(2,Q,1);const q=LiteGraph.createNode("UpscaleModelLoader");i.add(q),N(q,"model_name",U,!0);const ee=LiteGraph.createNode("ImageUpscaleWithModel");i.add(ee),Q.connect(0,ee,1),q.connect(0,ee,0),W=LiteGraph.createNode("ImageScale"),i.add(W),ee.connect(0,W,0);const Y=X=LiteGraph.createNode("VAEEncodeTiled");i.add(Y),W.connect(0,Y,0),m.connect(2,Y,1)}N(W,"width",T(G)),N(W,"height",T(H)),C=LiteGraph.createNode("KSampler"),i.add(C),m.connect(0,C,0),_.connect(0,C,1),y.connect(0,C,2),X.connect(0,C,3),C.connect(0,k,0)}},steps(P){N(b,"steps",+P)},seed(P){N(b,"seed",+P)}};for(const P in a)P in O&&O[P](D(P));C&&(N(C,"steps",I?+I:E(b,"steps").value),N(C,"cfg",E(b,"cfg").value),N(C,"scheduler",E(b,"scheduler").value),N(C,"sampler_name",E(b,"sampler_name").value),N(C,"denoise",+(D("denoising strength")||"1")));let M=L(_,l,{node:f,index:0},{node:m,index:0});l=M.text,M=L(y,u,M.prevClip,M.prevModel),u=M.text,N(_,"text",A(l)),N(y,"text",A(u)),i.arrange();for(const P of["model hash","ensd","version","vae hash","ti hashes","lora hashes","hashes"])delete a[P];console.warn("Unhandled parameters:",a)}}}p(importA1111,"importA1111");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.pnginfo=window.comfyAPI.pnginfo||{};window.comfyAPI.pnginfo.getPngMetadata=getPngMetadata;window.comfyAPI.pnginfo.getFlacMetadata=getFlacMetadata;window.comfyAPI.pnginfo.getAvifMetadata=getAvifMetadata;window.comfyAPI.pnginfo.getWebpMetadata=getWebpMetadata;window.comfyAPI.pnginfo.getLatentMetadata=getLatentMetadata;window.comfyAPI.pnginfo.importA1111=importA1111;async function getWorkflowDataFromFile(i){if(i.type==="image/png")return await getPngMetadata(i);if(i.type==="image/avif")return await getAvifMetadata(i);if(i.type==="image/webp"){const o=await getWebpMetadata(i),n=o?.workflow||o?.Workflow,s=o?.prompt||o?.Prompt;return{workflow:n,prompt:s}}if(i.type==="audio/mpeg")return await getMp3Metadata(i);if(i.type==="audio/ogg")return await getOggMetadata(i);if(i.type==="audio/flac"||i.type==="audio/x-flac"){const o=await getFlacMetadata(i),n=o?.workflow||o?.Workflow,s=o?.prompt||o?.Prompt;return{workflow:n,prompt:s}}if(i.type==="video/webm")return await getFromWebmFile(i);if(i.name?.endsWith(".mp4")||i.name?.endsWith(".mov")||i.name?.endsWith(".m4v")||i.type==="video/mp4"||i.type==="video/quicktime"||i.type==="video/x-m4v")return await getFromIsobmffFile(i);if(i.type==="image/svg+xml"||i.name?.endsWith(".svg"))return await getSvgMetadata(i);if(i.type==="model/gltf-binary"||i.name?.endsWith(".glb"))return await getGltfBinaryMetadata(i);if(i.name?.endsWith(".latent")||i.name?.endsWith(".safetensors"))return await getLatentMetadata(i);if(i.type==="application/json"||i.name?.endsWith(".json"))return getDataFromJSON(i)}p(getWorkflowDataFromFile,"getWorkflowDataFromFile");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.parser=window.comfyAPI.parser||{};window.comfyAPI.parser.getWorkflowDataFromFile=getWorkflowDataFromFile;async function extractWorkflowFromAsset(i){const o=i.name.replace(/\.[^/.]+$/,".json"),n=getOutputAssetMetadata(i.user_metadata);if(n?.workflow)return{workflow:n.workflow,filename:o};try{const s=getAssetUrl(i),a=await fetch(s);if(!a.ok)return{workflow:null,filename:o};const r=await a.blob(),l=new File([r],i.name,{type:r.type}),u=await getWorkflowDataFromFile(l);if(u?.workflow)return{workflow:typeof u.workflow=="string"?JSON.parse(u.workflow):u.workflow,filename:o}}catch(s){console.error("Failed to extract workflow from asset:",s)}return{workflow:null,filename:o}}p(extractWorkflowFromAsset,"extractWorkflowFromAsset");function supportsWorkflowMetadata(i){const o=i.toLowerCase();return o.endsWith(".png")||o.endsWith(".webp")||o.endsWith(".flac")||o.endsWith(".json")}p(supportsWorkflowMetadata,"supportsWorkflowMetadata");function detectNodeTypeFromFilename(i){switch(getMediaTypeFromFilename(i)){case"image":return{nodeType:"LoadImage",widgetName:"image"};case"video":return{nodeType:"LoadVideo",widgetName:"file"};case"audio":return{nodeType:"LoadAudio",widgetName:"audio"};default:return{nodeType:null,widgetName:null}}}p(detectNodeTypeFromFilename,"detectNodeTypeFromFilename");const zMediaKindSchema=z.enum(["video","audio","image","3D"]),zDimensionsSchema=z.object({width:z.number().positive(),height:z.number().positive()});assetItemSchema.extend({kind:zMediaKindSchema,src:z.string().url(),duration:z.number().nonnegative().optional(),dimensions:zDimensionsSchema.optional()});z.object({type:z.enum(["input","output"]),outputCount:z.number().positive().optional()});const MediaAssetKey=Symbol("mediaAsset");function useMediaAssetActions(){const i=useToast(),o=useDialogStore(),n=inject(MediaAssetKey,null),{copyToClipboard:s}=useCopyToClipboard(),a=useWorkflowActionsService(),r=useLitegraphService(),l=useNodeDefStore(),u=p(async(I,T)=>{if(T==="output"){const E=I.id||getOutputAssetMetadata(I.user_metadata)?.promptId;if(!E)throw new Error("Unable to extract prompt ID from asset");await api.deleteItem("history",E)}else throw new Error(t("mediaAsset.deletingImportedFilesCloudOnly"))},"deleteAssetApi"),m=p(()=>{const I=n?.asset.value;if(I)try{const T=I.name;let E;isCloud&&I.preview_url||(E=getAssetUrl(I)),downloadFile(E,T),i.add({severity:"success",summary:t("g.success"),detail:t("g.downloadStarted"),life:2e3})}catch{i.add({severity:"error",summary:t("g.error"),detail:t("g.failedToDownloadImage"),life:3e3})}},"downloadAsset"),f=p(I=>{if(!(!I||I.length===0))try{I.forEach(T=>{const E=T.name;let N;isCloud&&T.preview_url||(N=getAssetUrl(T)),downloadFile(N,E)}),i.add({severity:"success",summary:t("g.success"),detail:t("mediaAsset.selection.downloadsStarted",{count:I.length}),life:2e3})}catch(T){console.error("Failed to download assets:",T),i.add({severity:"error",summary:t("g.error"),detail:t("g.failedToDownloadImage"),life:3e3})}},"downloadMultipleAssets"),_=p(async I=>{const T=getAssetType(I);return new Promise(E=>{o.showDialog({key:"delete-asset-confirmation",title:t("mediaAsset.deleteAssetTitle"),component:ConfirmationDialogContent,props:{message:t("mediaAsset.deleteAssetDescription"),type:"delete",itemList:[I.name],onConfirm:p(async()=>{const N=await y(I,T);E(N)},"onConfirm"),onCancel:p(()=>{E(!1)},"onCancel")}})})},"confirmDelete"),y=p(async(I,T)=>{const E=useAssetsStore();try{return await u(I,T),T==="output"?await E.updateHistory():await E.updateInputs(),i.add({severity:"success",summary:t("g.success"),detail:t("mediaAsset.assetDeletedSuccessfully"),life:2e3}),!0}catch(N){console.error("Failed to delete asset:",N);const L=N instanceof Error?N.message:"",A=L.includes("Cloud");return i.add({severity:A?"warn":"error",summary:t(A?"g.warning":"g.error"),detail:L||t("mediaAsset.failedToDeleteAsset"),life:3e3}),!1}},"deleteAsset");return{downloadAsset:m,downloadMultipleAssets:f,confirmDelete:_,deleteAsset:y,deleteMultipleAssets:p(async I=>{if(!I||I.length===0)return;const T=useAssetsStore();return new Promise(E=>{o.showDialog({key:"delete-multiple-assets-confirmation",title:t("mediaAsset.deleteSelectedTitle"),component:ConfirmationDialogContent,props:{message:t("mediaAsset.deleteSelectedDescription",{count:I.length}),type:"delete",itemList:I.map(N=>N.name),onConfirm:p(async()=>{try{const N=await Promise.allSettled(I.map(M=>u(M,getAssetType(M)))),L=N.filter(M=>M.status==="fulfilled").length,A=N.filter(M=>M.status==="rejected");A.forEach((M,P)=>{console.warn(`Failed to delete asset ${I[P].name}:`,M.reason)});const D=I.some(M=>getAssetType(M)==="output"),O=I.some(M=>getAssetType(M)==="input");D&&await T.updateHistory(),O&&await T.updateInputs(),A.length===0?i.add({severity:"success",summary:t("g.success"),detail:t("mediaAsset.selection.assetsDeletedSuccessfully",{count:L}),life:2e3}):L===0?i.add({severity:"error",summary:t("g.error"),detail:t("mediaAsset.selection.failedToDeleteAssets"),life:3e3}):i.add({severity:"warn",summary:t("g.warning"),detail:t("mediaAsset.selection.partialDeleteSuccess",{succeeded:L,failed:A.length}),life:3e3})}catch(N){console.error("Failed to delete assets:",N),i.add({severity:"error",summary:t("g.error"),detail:t("mediaAsset.selection.failedToDeleteAssets"),life:3e3})}E()},"onConfirm"),onCancel:p(()=>{E()},"onCancel")}})})},"deleteMultipleAssets"),copyJobId:p(async()=>{const I=n?.asset.value;if(!I)return;const T=getOutputAssetMetadata(I.user_metadata),E=I.id||T?.promptId;if(!E){i.add({severity:"warn",summary:t("g.warning"),detail:t("mediaAsset.noJobIdFound"),life:2e3});return}await s(E)},"copyJobId"),addWorkflow:p(async()=>{const I=n?.asset.value;if(!I)return;const{nodeType:T,widgetName:E}=detectNodeTypeFromFilename(I.name);if(!T||!E){i.add({severity:"warn",summary:t("g.warning"),detail:t("mediaAsset.unsupportedFileType"),life:2e3});return}const N=l.nodeDefsByName[T];if(!N){i.add({severity:"error",summary:t("g.error"),detail:t("mediaAsset.nodeTypeNotFound",{nodeType:T}),life:3e3});return}const L=r.addNodeOnGraph(N,{pos:r.getCanvasCenter()});if(!L){i.add({severity:"error",summary:t("g.error"),detail:t("mediaAsset.failedToCreateNode"),life:3e3});return}const A=getOutputAssetMetadata(I.user_metadata),D=getAssetType(I,"input"),O=createAnnotatedPath({filename:I.name,subfolder:A?.subfolder||"",type:isResultItemType(D)?D:void 0},{rootFolder:isResultItemType(D)?D:void 0}),M=L.widgets?.find(P=>P.name===E);M&&(M.value=O,M.callback?.(O)),L.graph?.setDirtyCanvas(!0,!0),i.add({severity:"success",summary:t("g.success"),detail:t("mediaAsset.nodeAddedToWorkflow",{nodeType:T}),life:2e3})},"addWorkflow"),openWorkflow:p(async()=>{const I=n?.asset.value;if(!I)return;const{workflow:T,filename:E}=await extractWorkflowFromAsset(I),N=await a.openWorkflowAction(T,E);N.success?i.add({severity:"success",summary:t("g.success"),detail:t("mediaAsset.workflowOpenedInNewTab"),life:2e3}):i.add({severity:"warn",summary:t("g.warning"),detail:N.error||t("mediaAsset.noWorkflowDataFound"),life:2e3})},"openWorkflow"),exportWorkflow:p(async()=>{const I=n?.asset.value;if(!I)return;const{workflow:T,filename:E}=await extractWorkflowFromAsset(I),N=await a.exportWorkflowAction(T,E);if(N.success)i.add({severity:"success",summary:t("g.success"),detail:t("mediaAsset.workflowExportedSuccessfully"),life:2e3});else{const L=N.error?.includes("No workflow");i.add({severity:L?"warn":"error",summary:t(L?"g.warning":"g.error"),detail:N.error||t("mediaAsset.failedToExportWorkflow"),life:3e3})}},"exportWorkflow")}}p(useMediaAssetActions,"useMediaAssetActions");const _sfc_main$27={},_hoisted_1$1P={class:"h-px bg-border-default"};function _sfc_render$3(i,o){return openBlock(),createElementBlock("div",_hoisted_1$1P)}p(_sfc_render$3,"_sfc_render$3");const MediaAssetButtonDivider=_export_sfc(_sfc_main$27,[["render",_sfc_render$3]]),_hoisted_1$1O={class:"flex flex-col"},_sfc_main$26=defineComponent({__name:"MediaAssetMoreMenu",props:{close:{type:Function},showDeleteButton:{type:Boolean}},emits:["inspect","asset-deleted"],setup(i,{emit:o}){const n=o,{asset:s,context:a}=inject(MediaAssetKey),r=useMediaAssetActions(),l=computed(()=>s.value?.tags?.[0]||a.value?.type||"output"),u=computed(()=>{if(l.value==="output")return!0;if(l.value==="input"&&s.value?.name){const{nodeType:T}=detectNodeTypeFromFilename(s.value.name);return T!==null}return!1}),m=computed(()=>l.value==="output"?!0:l.value==="input"&&s.value?.name?supportsWorkflowMetadata(s.value.name):!1),f=computed(()=>l.value!=="input"),_=computed(()=>{const T=i.showDeleteButton??!0,E=l.value==="output"||l.value==="input"&&isCloud;return T&&E}),y=p(()=>{n("inspect"),i.close()},"handleInspect"),b=p(()=>{s.value&&r.addWorkflow(),i.close()},"handleAddToWorkflow"),w=p(()=>{s.value&&r.downloadAsset(),i.close()},"handleDownload"),k=p(()=>{s.value&&r.openWorkflow(),i.close()},"handleOpenWorkflow"),S=p(()=>{s.value&&r.exportWorkflow(),i.close()},"handleExportWorkflow"),C=p(async()=>{s.value&&await r.copyJobId(),i.close()},"handleCopyJobId"),I=p(async()=>{if(!s.value)return;i.close(),await r.confirmDelete(s.value)&&n("asset-deleted")},"handleDelete");return(T,E)=>(openBlock(),createElementBlock("div",_hoisted_1$1O,[unref(s)?.kind!=="3D"?(openBlock(),createBlock(_sfc_main$2D,{key:0,type:"transparent",label:T.$t("queue.jobMenu.inspectAsset"),onClick:y},{icon:withCtx(()=>E[0]||(E[0]=[createBaseVNode("i",{class:"icon-[lucide--zoom-in] size-4"},null,-1)])),_:1},8,["label"])):createCommentVNode("",!0),u.value?(openBlock(),createBlock(_sfc_main$2D,{key:1,type:"transparent",label:T.$t("queue.jobMenu.addToCurrentWorkflow"),onClick:b},{icon:withCtx(()=>E[1]||(E[1]=[createBaseVNode("i",{class:"icon-[comfy--node] size-4"},null,-1)])),_:1},8,["label"])):createCommentVNode("",!0),createVNode(_sfc_main$2D,{type:"transparent",label:T.$t("queue.jobMenu.download"),onClick:w},{icon:withCtx(()=>E[2]||(E[2]=[createBaseVNode("i",{class:"icon-[lucide--download] size-4"},null,-1)])),_:1},8,["label"]),u.value||m.value?(openBlock(),createBlock(MediaAssetButtonDivider,{key:2})):createCommentVNode("",!0),m.value?(openBlock(),createBlock(_sfc_main$2D,{key:3,type:"transparent",label:T.$t("queue.jobMenu.openAsWorkflowNewTab"),onClick:k},{icon:withCtx(()=>E[3]||(E[3]=[createBaseVNode("i",{class:"icon-[comfy--workflow] size-4"},null,-1)])),_:1},8,["label"])):createCommentVNode("",!0),m.value?(openBlock(),createBlock(_sfc_main$2D,{key:4,type:"transparent",label:T.$t("queue.jobMenu.exportWorkflow"),onClick:S},{icon:withCtx(()=>E[4]||(E[4]=[createBaseVNode("i",{class:"icon-[lucide--file-output] size-4"},null,-1)])),_:1},8,["label"])):createCommentVNode("",!0),m.value&&f.value?(openBlock(),createBlock(MediaAssetButtonDivider,{key:5})):createCommentVNode("",!0),f.value?(openBlock(),createBlock(_sfc_main$2D,{key:6,type:"transparent",label:T.$t("queue.jobMenu.copyJobId"),onClick:C},{icon:withCtx(()=>E[5]||(E[5]=[createBaseVNode("i",{class:"icon-[lucide--copy] size-4"},null,-1)])),_:1},8,["label"])):createCommentVNode("",!0),f.value&&_.value?(openBlock(),createBlock(MediaAssetButtonDivider,{key:7})):createCommentVNode("",!0),_.value?(openBlock(),createBlock(_sfc_main$2D,{key:8,type:"transparent",label:T.$t("queue.jobMenu.delete"),onClick:I},{icon:withCtx(()=>E[6]||(E[6]=[createBaseVNode("i",{class:"icon-[lucide--trash-2] size-4"},null,-1)])),_:1},8,["label"])):createCommentVNode("",!0)]))}}),_hoisted_1$1N={key:0,class:"size-full animate-pulse rounded-lg bg-modal-card-placeholder-background"},_hoisted_2$1p={key:0,class:"flex flex-wrap items-center gap-1"},_hoisted_3$_={key:0,class:"flex flex-col items-center justify-between gap-1"},_sfc_main$25=defineComponent({__name:"MediaAssetCard",props:{asset:{},loading:{type:Boolean},selected:{type:Boolean},showOutputCount:{type:Boolean},outputCount:{},showDeleteButton:{type:Boolean},openPopoverId:{}},emits:["zoom","output-count-click","asset-deleted","popover-opened","popover-closed"],setup(i,{emit:o}){const n={top:{video:defineAsyncComponent(()=>__vitePreload(()=>import("./MediaVideoTop-B0UjJO0j.js"),__vite__mapDeps([15,1,2]),import.meta.url)),audio:defineAsyncComponent(()=>__vitePreload(()=>import("./MediaAudioTop-CtxDam9S.js"),__vite__mapDeps([16,1,2]),import.meta.url)),image:defineAsyncComponent(()=>__vitePreload(()=>import("./MediaImageTop-DxVgiUyl.js"),__vite__mapDeps([17,1,2]),import.meta.url)),"3D":defineAsyncComponent(()=>__vitePreload(()=>import("./Media3DTop-BoCKM1fD.js"),__vite__mapDeps([18,1,2,5,9,10,11,12,13]),import.meta.url))},bottom:{video:defineAsyncComponent(()=>__vitePreload(()=>import("./MediaVideoBottom-MWtP2JCQ.js"),__vite__mapDeps([19,20,1,2,5,9,10,11,12,13]),import.meta.url)),audio:defineAsyncComponent(()=>__vitePreload(()=>import("./MediaAudioBottom-CC2UhLc7.js"),__vite__mapDeps([21,20,1,2,5,9,10,11,12,13]),import.meta.url)),image:defineAsyncComponent(()=>__vitePreload(()=>import("./MediaImageBottom-RZ8HpVO7.js"),__vite__mapDeps([22,20,1,2,5,9,10,11,12,13]),import.meta.url)),"3D":defineAsyncComponent(()=>__vitePreload(()=>import("./Media3DBottom-BcH17akl.js"),__vite__mapDeps([23,20,1,2,5,9,10,11,12,13]),import.meta.url))}};function s(F){return n.top[F]||n.top.image}p(s,"getTopComponent");function a(F){return n.bottom[F]||n.bottom.image}p(a,"getBottomComponent");const r=o,l=ref(),u=ref(),m=ref(!1),f=ref(!1),_=ref(!1),y=ref(),b=useElementHover(l),w=useMediaAssetActions(),k=computed(()=>getAssetType$1(i.asset?.tags)),S=computed(()=>getMediaTypeFromFilename(i.asset?.name||"")),C=computed(()=>{if(i.asset)return{id:i.asset.id,name:i.asset.name,kind:S.value,src:i.asset.preview_url||"",size:i.asset.size,tags:i.asset.tags||[],created_at:i.asset.created_at,duration:i.asset.user_metadata?.duration?Number(i.asset.user_metadata.duration):void 0,dimensions:y.value}});provide(MediaAssetKey,{asset:toRef$2(()=>C.value),context:toRef$2(()=>({type:k.value})),isVideoPlaying:m,showVideoControls:_});const I=computed(()=>cn("gap-1 select-none group",i.selected?"ring-3 ring-inset ring-modal-card-border-highlighted":"hover:bg-modal-card-background-hovered")),T=computed(()=>{const F=i.asset?.user_metadata?.executionTimeInSeconds;if(F!=null)return`${Number(F).toFixed(2)}s`;const j=i.asset?.user_metadata?.duration;return j?formatDuration(Number(j)):""}),E=computed(()=>{if(!i.asset?.name)return"";const F=i.asset.name.split(".");return F.length>1?F[F.length-1].toUpperCase():""}),N=computed(()=>S.value==="audio"?"-translate-y-11":S.value==="video"&&_.value?"-translate-y-16":""),L=computed(()=>b.value||f.value),A=computed(()=>!i.loading&&!!i.asset&&!L.value&&!m.value&&(T.value||E.value)),D=computed(()=>!i.loading&&!!i.asset&&(L.value||m.value)),O=p(()=>{i.asset&&r("zoom",i.asset)},"handleZoomClick"),M=p((F,j)=>{y.value={width:F,height:j}},"handleImageLoaded"),P=p(()=>{r("output-count-click")},"handleOutputCountClick"),R=p(()=>{r("asset-deleted")},"handleAssetDelete"),V=p(()=>{f.value=!0,r("popover-opened")},"handleMenuOpened"),$=p(()=>{f.value=!1,r("popover-closed")},"handleMenuClosed");return whenever(()=>i.openPopoverId&&i.openPopoverId!==i.asset?.id&&f.value,()=>{u.value?.hide()}),(F,j)=>{const U=resolveDirective("tooltip");return openBlock(),createBlock(_sfc_main$2b,{ref_key:"cardContainerRef",ref:l,role:"button","aria-label":F.asset?F.$t("assetBrowser.ariaLabel.assetCard",{name:F.asset.name,type:S.value}):F.$t("assetBrowser.ariaLabel.loadingAsset"),tabindex:F.loading?-1:0,size:"mini",variant:"ghost",rounded:"lg",class:normalizeClass(I.value),"data-selected":F.selected,onClick:j[3]||(j[3]=withModifiers(()=>{},["stop"]))},{top:withCtx(()=>[createVNode(_sfc_main$2a,{ratio:"square","bottom-left-class":N.value,"bottom-right-class":N.value},createSlots({"top-left":withCtx(()=>[A.value?(openBlock(),createElementBlock("div",_hoisted_2$1p,[T.value?(openBlock(),createBlock(_sfc_main$29,{key:0,variant:"gray",label:T.value},null,8,["label"])):createCommentVNode("",!0),E.value?(openBlock(),createBlock(_sfc_main$29,{key:1,variant:"gray",label:E.value},null,8,["label"])):createCommentVNode("",!0)])):D.value?(openBlock(),createBlock(_sfc_main$2e,{key:1},{default:withCtx(()=>[withDirectives((openBlock(),createBlock(_sfc_main$2B,{size:"sm",onClick:withModifiers(O,["stop"])},{default:withCtx(()=>j[4]||(j[4]=[createBaseVNode("i",{class:"icon-[lucide--zoom-in] size-4"},null,-1)])),_:1})),[[U,F.$t("mediaAsset.actions.inspect"),void 0,{top:!0}]]),withDirectives((openBlock(),createBlock(_sfc_main$2d,{ref_key:"moreButtonRef",ref:u,size:"sm",onMenuOpened:V,onMenuClosed:$},{default:withCtx(({close:G})=>[createVNode(_sfc_main$26,{close:G,"show-delete-button":F.showDeleteButton,onInspect:O,onAssetDeleted:R},null,8,["close","show-delete-button"])]),_:1})),[[U,F.$t("mediaAsset.actions.more"),void 0,{top:!0}]])]),_:1})):createCommentVNode("",!0)]),default:withCtx(()=>[F.loading?(openBlock(),createElementBlock("div",_hoisted_1$1N)):F.asset&&C.value?(openBlock(),createBlock(resolveDynamicComponent(s(S.value)),{key:1,asset:C.value,context:{type:k.value},onView:O,onDownload:j[0]||(j[0]=G=>unref(w).downloadAsset()),onVideoPlayingStateChanged:j[1]||(j[1]=G=>m.value=G),onVideoControlsChanged:j[2]||(j[2]=G=>_.value=G),onImageLoaded:M},null,40,["asset","context"])):createCommentVNode("",!0)]),_:2},[F.showOutputCount?{name:"top-right",fn:withCtx(()=>[withDirectives((openBlock(),createBlock(_sfc_main$2D,{type:"secondary",size:"sm",label:String(F.outputCount),onClick:withModifiers(P,["stop"])},{icon:withCtx(()=>j[5]||(j[5]=[createBaseVNode("i",{class:"icon-[lucide--layers] size-4"},null,-1)])),_:1},8,["label"])),[[U,F.$t("mediaAsset.actions.seeMoreOutputs"),void 0,{top:!0,"pt:pointer-events-none":!0}]])]),key:"0"}:void 0]),1032,["bottom-left-class","bottom-right-class"])]),bottom:withCtx(()=>[createVNode(_sfc_main$2c,null,{default:withCtx(()=>[F.loading?(openBlock(),createElementBlock("div",_hoisted_3$_,j[6]||(j[6]=[createBaseVNode("div",{class:"h-4 w-2/3 animate-pulse rounded bg-modal-card-background"},null,-1),createBaseVNode("div",{class:"h-3 w-1/2 animate-pulse rounded bg-modal-card-background"},null,-1)]))):F.asset&&C.value?(openBlock(),createBlock(resolveDynamicComponent(a(S.value)),{key:1,asset:C.value,context:{type:k.value}},null,8,["asset","context"])):createCommentVNode("",!0)]),_:1})]),_:1},8,["aria-label","tabindex","class","data-selected"])}}}),_hoisted_1$1M={class:"relative inline-flex items-center"},_hoisted_2$1o={class:"flex min-w-40 flex-col gap-2 p-2"},_sfc_main$24=defineComponent({__name:"MediaAssetFilterButton",props:{size:{default:"md"},type:{default:"secondary"},border:{type:Boolean},disabled:{type:Boolean},class:{}},emits:["menuOpened","menuClosed"],setup(i){const o=ref(),n=p(r=>{o.value?.toggle(r)},"toggle"),s=p(()=>{o.value?.hide()},"hide"),a=computed(()=>({root:{class:cn("absolute z-50")},content:{class:cn("mt-1 rounded-lg","bg-base-background text-base-foreground border border-border-default","shadow-lg")}}));return(r,l)=>(openBlock(),createElementBlock("div",_hoisted_1$1M,[createVNode(_sfc_main$2B,{size:r.size,type:r.type,onClick:n},{default:withCtx(()=>l[2]||(l[2]=[createBaseVNode("i",{class:"icon-[lucide--list-filter] text-sm"},null,-1)])),_:1},8,["size","type"]),createVNode(unref(script$b),{ref_key:"popover",ref:o,"append-to":"#vue-app","auto-z-index":"","base-z-index":1e3,dismissable:"","close-on-escape":"",unstyled:"",pt:a.value,onShow:l[0]||(l[0]=u=>r.$emit("menuOpened")),onHide:l[1]||(l[1]=u=>r.$emit("menuClosed"))},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$1o,[renderSlot(r.$slots,"default",{close:s})])]),_:3},8,["pt"])]))}}),_hoisted_1$1L={class:"flex flex-col gap-0 p-0 m-0"},_hoisted_2$1n=["aria-checked","onClick","onKeydown"],_hoisted_3$Z={key:0,class:"icon-[lucide--check] text-xs font-bold text-white"},_hoisted_4$H={class:"text-sm"},_sfc_main$23=defineComponent({__name:"MediaAssetFilterMenu",props:{mediaTypeFilters:{},close:{type:Function}},emits:["update:mediaTypeFilters"],setup(i,{emit:o}){const n=o,s=[{type:"image",label:"sideToolbar.mediaAssets.filterImage"},{type:"video",label:"sideToolbar.mediaAssets.filterVideo"},{type:"audio",label:"sideToolbar.mediaAssets.filterAudio"},{type:"3d",label:"sideToolbar.mediaAssets.filter3D"}],a=p(r=>{i.mediaTypeFilters.includes(r)?n("update:mediaTypeFilters",i.mediaTypeFilters.filter(u=>u!==r)):n("update:mediaTypeFilters",[...i.mediaTypeFilters,r])},"toggleMediaType");return(r,l)=>(openBlock(),createElementBlock("div",_hoisted_1$1L,[(openBlock(),createElementBlock(Fragment,null,renderList(s,u=>createBaseVNode("div",{key:u.type,class:"flex h-10 cursor-pointer items-center gap-2 rounded-lg px-2 hover:bg-secondary-background-hover",tabindex:"0",role:"checkbox","aria-checked":r.mediaTypeFilters.includes(u.type),onClick:p(m=>a(u.type),"onClick"),onKeydown:[withKeys(withModifiers(m=>a(u.type),["prevent"]),["enter"]),withKeys(withModifiers(m=>a(u.type),["prevent"]),["space"])]},[createBaseVNode("div",{class:normalizeClass(["flex h-4 w-4 shrink-0 items-center justify-center rounded p-0.5 transition-all duration-200",r.mediaTypeFilters.includes(u.type)?"bg-primary-background border-primary-background":"bg-secondary-background"])},[r.mediaTypeFilters.includes(u.type)?(openBlock(),createElementBlock("i",_hoisted_3$Z)):createCommentVNode("",!0)],2),createBaseVNode("span",_hoisted_4$H,toDisplayString(r.$t(u.label)),1)],40,_hoisted_2$1n)),64))]))}}),_hoisted_1$1K={class:"relative inline-flex items-center"},_hoisted_2$1m={class:"flex min-w-40 flex-col gap-2 p-2"},_sfc_main$22=defineComponent({__name:"MediaAssetSortButton",props:{size:{default:"md"},type:{default:"secondary"},border:{type:Boolean},disabled:{type:Boolean},class:{}},emits:["menuOpened","menuClosed"],setup(i){const o=ref(),n=p(r=>{o.value?.toggle(r)},"toggle"),s=p(()=>{o.value?.hide()},"hide"),a=computed(()=>({root:{class:cn("absolute z-50")},content:{class:cn("mt-1 rounded-lg","bg-base-background text-base-foreground border border-border-default","shadow-lg")}}));return(r,l)=>(openBlock(),createElementBlock("div",_hoisted_1$1K,[createVNode(_sfc_main$2B,{size:r.size,type:r.type,onClick:n},{default:withCtx(()=>l[2]||(l[2]=[createBaseVNode("i",{class:"icon-[lucide--arrow-up-down] text-sm"},null,-1)])),_:1},8,["size","type"]),createVNode(unref(script$b),{ref_key:"popover",ref:o,"append-to":"body","auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:a.value,onShow:l[0]||(l[0]=u=>r.$emit("menuOpened")),onHide:l[1]||(l[1]=u=>r.$emit("menuClosed"))},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$1m,[renderSlot(r.$slots,"default",{close:s})])]),_:3},8,["pt"])]))}}),_hoisted_1$1J={class:"flex flex-col"},_hoisted_2$1l={key:0,class:"icon-[lucide--check] size-4"},_hoisted_3$Y={key:0,class:"icon-[lucide--check] size-4"},_hoisted_4$G={key:0,class:"icon-[lucide--check] size-4"},_hoisted_5$C={key:0,class:"icon-[lucide--check] size-4"},_sfc_main$21=defineComponent({__name:"MediaAssetSortMenu",props:{sortBy:{},close:{type:Function},showGenerationTimeSort:{type:Boolean,default:!1}},emits:["update:sortBy"],setup(i,{emit:o}){const n=o,s=p(a=>{n("update:sortBy",a),i.close()},"handleSortChange");return(a,r)=>(openBlock(),createElementBlock("div",_hoisted_1$1J,[createVNode(_sfc_main$2D,{type:"transparent","icon-position":"right",label:a.$t("sideToolbar.mediaAssets.sortNewestFirst"),onClick:r[0]||(r[0]=l=>s("newest"))},{icon:withCtx(()=>[a.sortBy==="newest"?(openBlock(),createElementBlock("i",_hoisted_2$1l)):createCommentVNode("",!0)]),_:1},8,["label"]),createVNode(_sfc_main$2D,{type:"transparent","icon-position":"right",label:a.$t("sideToolbar.mediaAssets.sortOldestFirst"),onClick:r[1]||(r[1]=l=>s("oldest"))},{icon:withCtx(()=>[a.sortBy==="oldest"?(openBlock(),createElementBlock("i",_hoisted_3$Y)):createCommentVNode("",!0)]),_:1},8,["label"]),a.showGenerationTimeSort?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(_sfc_main$2D,{type:"transparent","icon-position":"right",label:a.$t("sideToolbar.mediaAssets.sortLongestFirst"),onClick:r[2]||(r[2]=l=>s("longest"))},{icon:withCtx(()=>[a.sortBy==="longest"?(openBlock(),createElementBlock("i",_hoisted_4$G)):createCommentVNode("",!0)]),_:1},8,["label"]),createVNode(_sfc_main$2D,{type:"transparent","icon-position":"right",label:a.$t("sideToolbar.mediaAssets.sortFastestFirst"),onClick:r[3]||(r[3]=l=>s("fastest"))},{icon:withCtx(()=>[a.sortBy==="fastest"?(openBlock(),createElementBlock("i",_hoisted_5$C)):createCommentVNode("",!0)]),_:1},8,["label"])],64)):createCommentVNode("",!0)]))}}),_hoisted_1$1I={class:"flex gap-3 pt-2"},_sfc_main$20=defineComponent({__name:"MediaAssetFilterBar",props:{searchQuery:{},sortBy:{},showGenerationTimeSort:{type:Boolean,default:!1},mediaTypeFilters:{}},emits:["update:searchQuery","update:sortBy","update:mediaTypeFilters"],setup(i,{emit:o}){const n=o,s=p(l=>{n("update:searchQuery",l??"")},"handleSearchChange"),a=p(l=>{n("update:sortBy",l)},"handleSortChange"),r=p(l=>{n("update:mediaTypeFilters",l)},"handleMediaTypeFiltersChange");return(l,u)=>{const m=resolveDirective("tooltip");return openBlock(),createElementBlock("div",_hoisted_1$1I,[createVNode(_sfc_main$2C,{"model-value":l.searchQuery,placeholder:l.$t("sideToolbar.searchAssets"),size:"lg","onUpdate:modelValue":s},null,8,["model-value","placeholder"]),unref(isCloud)?withDirectives((openBlock(),createBlock(_sfc_main$24,{key:0,size:"md"},{default:withCtx(({close:f})=>[createVNode(_sfc_main$23,{"media-type-filters":l.mediaTypeFilters,close:f,"onUpdate:mediaTypeFilters":r},null,8,["media-type-filters","close"])]),_:1})),[[m,{value:l.$t("assetBrowser.filterBy")},void 0,{top:!0}]]):createCommentVNode("",!0),unref(isCloud)?withDirectives((openBlock(),createBlock(_sfc_main$22,{key:1,size:"md"},{default:withCtx(({close:f})=>[createVNode(_sfc_main$21,{"sort-by":l.sortBy,"show-generation-time-sort":l.showGenerationTimeSort,close:f,"onUpdate:sortBy":a},null,8,["sort-by","show-generation-time-sort","close"])]),_:1})),[[m,{value:l.$t("assetBrowser.sortBy")},void 0,{top:!0}]]):createCommentVNode("",!0)])}}});function useInternalFilesApi(i){const o=useAssetsStore(),n=computed(()=>i==="input"?o.inputAssets:o.historyAssets),s=computed(()=>i==="input"?o.inputLoading:o.historyLoading),a=computed(()=>i==="input"?o.inputError:o.historyError),r=p(async()=>i==="input"?(await o.updateInputs(),o.inputAssets):(await o.updateHistory(),o.historyAssets),"fetchMediaList"),l=p(()=>r(),"refresh"),u=p(async()=>{i==="output"&&await o.loadMoreHistory()},"loadMore"),m=computed(()=>i==="output"?o.hasMoreHistory:!1),f=computed(()=>i==="output"?o.isLoadingMore:!1);return{media:n,loading:s,error:a,fetchMediaList:r,refresh:l,loadMore:u,hasMore:m,isLoadingMore:f}}p(useInternalFilesApi,"useInternalFilesApi");function useMediaAssets(i){return useInternalFilesApi(i)}p(useMediaAssets,"useMediaAssets");const useAssetSelectionStore=defineStore("assetSelection",()=>{const i=ref(new Set),o=ref(-1),n=computed(()=>i.value.size),s=computed(()=>i.value.size>0),a=computed(()=>Array.from(i.value));function r(w){i.value.add(w)}p(r,"addToSelection");function l(w){i.value.delete(w)}p(l,"removeFromSelection");function u(w){const k=new Set(w);(k.size!==i.value.size||!w.every(S=>i.value.has(S)))&&(i.value=k)}p(u,"setSelection");function m(){i.value.clear(),o.value=-1}p(m,"clearSelection");function f(w){_(w)?l(w):r(w)}p(f,"toggleSelection");function _(w){return i.value.has(w)}p(_,"isSelected");function y(w){o.value=w}p(y,"setLastSelectedIndex");function b(){i.value.clear(),o.value=-1}return p(b,"reset"),{selectedAssetIds:computed(()=>i.value),lastSelectedIndex:computed(()=>o.value),selectedCount:n,hasSelection:s,selectedIdsArray:a,addToSelection:r,removeFromSelection:l,setSelection:u,clearSelection:m,toggleSelection:f,isSelected:_,setLastSelectedIndex:y,reset:b}});function useAssetSelection(){const i=useAssetSelectionStore(),o=ref(!0),n=useKeyModifier("Shift"),s=useKeyModifier("Control"),a=useKeyModifier("Meta"),r=computed(()=>o.value&&n.value),l=computed(()=>o.value&&s.value),u=computed(()=>o.value&&a.value),m=computed(()=>l.value||u.value);function f(k,S,C){if(!k?.id||S<0||S>=C.length){console.warn("Invalid asset selection parameters");return}const I=k.id;if(r.value&&i.lastSelectedIndex>=0){const T=Math.min(i.lastSelectedIndex,S),E=Math.max(i.lastSelectedIndex,S),N=C.slice(T,E+1).map(D=>D.id),L=Array.from(i.selectedAssetIds),A=[...new Set([...L,...N])];i.setSelection(A);return}if(m.value){i.toggleSelection(I),i.setLastSelectedIndex(S);return}i.clearSelection(),i.addToSelection(I),i.setLastSelectedIndex(S)}p(f,"handleAssetClick");function _(k){const S=k.map(C=>C.id);i.setSelection(S),k.length>0&&i.setLastSelectedIndex(k.length-1)}p(_,"selectAll");function y(k){return k.filter(S=>i.isSelected(S.id))}p(y,"getSelectedAssets");function b(){o.value=!0}p(b,"activate");function w(){o.value=!1,i.reset()}return p(w,"deactivate"),{selectedIds:computed(()=>i.selectedAssetIds),selectedCount:computed(()=>i.selectedCount),hasSelection:computed(()=>i.hasSelection),isSelected:p(k=>i.isSelected(k),"isSelected"),handleAssetClick:f,selectAll:_,clearSelection:p(()=>i.clearSelection(),"clearSelection"),getSelectedAssets:y,reset:p(()=>i.reset(),"reset"),activate:b,deactivate:w,shiftKey:r,cmdOrCtrlKey:m}}p(useAssetSelection,"useAssetSelection");const getAssetTime=p(i=>i.user_metadata?.create_time??(i.created_at?new Date(i.created_at).getTime():0),"getAssetTime"),getAssetExecutionTime=p(i=>i.user_metadata?.executionTimeInSeconds??0,"getAssetExecutionTime");function useMediaAssetFiltering(i){const o=ref(""),n=refDebounced(o,50),s=ref("newest"),a=ref([]),r={keys:["name"],threshold:.4,includeScore:!0},l=computed(()=>new Fuse(i.value,r)),u=computed(()=>n.value.trim()?l.value.search(n.value).map(y=>y.item):i.value),m=computed(()=>a.value.length===0?u.value:u.value.filter(_=>{const b=getMediaTypeFromFilename(_.name).toLowerCase();return a.value.includes(b)})),f=computed(()=>{switch(s.value){case"oldest":return sortBy(m.value,[getAssetTime]);case"longest":return sortBy(m.value,[_=>-getAssetExecutionTime(_)]);case"fastest":return sortBy(m.value,[getAssetExecutionTime]);case"newest":default:return sortBy(m.value,[_=>-getAssetTime(_)])}});return{searchQuery:o,sortBy:s,mediaTypeFilters:a,filteredAssets:f}}p(useMediaAssetFiltering,"useMediaAssetFiltering");const _hoisted_1$1H={key:0,class:"flex min-h-12 items-center border-b border-interface-stroke px-4 py-2"},_hoisted_2$1k={key:1,class:"px-4 pb-4"},_hoisted_3$X={key:0},_sfc_main$1$=defineComponent({__name:"AssetSidebarTemplate",props:{class:{}},setup(i){const o=i,n=useSlots();return(s,a)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["flex h-full flex-col bg-interface-panel-surface",o.class])},[createBaseVNode("div",null,[unref(n).top?(openBlock(),createElementBlock("div",_hoisted_1$1H,[renderSlot(s.$slots,"top")])):createCommentVNode("",!0),unref(n).header?(openBlock(),createElementBlock("div",_hoisted_2$1k,[renderSlot(s.$slots,"header")])):createCommentVNode("",!0)]),createVNode(unref(script$c),{class:"min-h-0 grow"},{default:withCtx(()=>[renderSlot(s.$slots,"body")]),_:3}),unref(n).footer?(openBlock(),createElementBlock("div",_hoisted_3$X,[renderSlot(s.$slots,"footer")])):createCommentVNode("",!0)],2))}}),_hoisted_1$1G={key:0,class:"font-bold"},_hoisted_2$1j={key:1,class:"flex w-full items-center justify-between gap-2"},_hoisted_3$W={class:"flex items-center gap-2"},_hoisted_4$F={class:"font-bold"},_hoisted_5$B={class:"text-sm"},_hoisted_6$r={key:0,class:"pt-4 pb-2"},_hoisted_7$o={key:0},_hoisted_8$i={key:1},_hoisted_9$e={class:"flex-1 pl-4"},_hoisted_10$c={class:"flex gap-2 pr-4"},_sfc_main$1_=defineComponent({__name:"AssetsSidebarTab",setup(i){const o=ref("output"),n=ref(null),s=ref(void 0),a=computed(()=>n.value!==null),r=ref(null),l=computed(()=>!(o.value==="input"&&!isCloud)),u=p(me=>{const fe=me.user_metadata?.outputCount;return typeof fe=="number"&&fe>0?fe:1},"getOutputCount"),m=p(me=>o.value!=="output"||a.value?!1:u(me)>1,"shouldShowOutputCount"),f=computed(()=>s.value?formatDuration(s.value*1e3):""),_=useToast(),y=useMediaAssets("input"),b=useMediaAssets("output"),{isSelected:w,handleAssetClick:k,hasSelection:S,clearSelection:C,getSelectedAssets:I,activate:T,deactivate:E}=useAssetSelection(),{downloadMultipleAssets:N,deleteMultipleAssets:L}=useMediaAssetActions(),A=ref(null),D=ref(0);useResizeObserver(A,me=>{const fe=me[0];D.value=fe.contentRect.width});const O=computed(()=>D.value>0&&D.value<=350),M=ref(null),P=useElementHover(M),R=computed(()=>I(Y.value).reduce((fe,Z)=>fe+u(Z),0)),V=computed(()=>o.value==="input"?y:b),$=computed(()=>V.value.loading.value),F=computed(()=>V.value.error.value),j=computed(()=>V.value.media.value),U=ref(-1),G=ref(null),H=ref([]),W=computed(()=>a.value?H.value:j.value),{searchQuery:X,sortBy:Q,mediaTypeFilters:q,filteredAssets:ee}=useMediaAssetFiltering(W),Y=computed(()=>ee.value);watch(Y,me=>{if(G.value&&U.value!==-1){const fe=me.findIndex(Z=>Z.id===G.value);fe!==-1&&(U.value=fe)}}),watch(U,me=>{me===-1&&(G.value=null)});const ae=computed(()=>Y.value.map(me=>{const fe=getMediaTypeFromFilename(me.name),Z=new ResultItemImpl({filename:me.name,subfolder:"",type:"output",nodeId:"0",mediaType:fe==="image"?"images":fe});return Object.defineProperty(Z,"url",{get(){return me.preview_url||""},configurable:!0}),Z})),re=computed(()=>Y.value.map(me=>({...me,key:me.id}))),ue=p(async()=>{await V.value.fetchMediaList(),F.value&&console.error("Failed to refresh assets:",F.value)},"refreshAssets");watch(o,()=>{C(),X.value="",ue()},{immediate:!0});const K=p(me=>{const fe=Y.value.findIndex(Z=>Z.id===me.id);k(me,fe,Y.value)},"handleAssetSelect"),ne=p(me=>{if(getMediaTypeFromFilename(me.name)==="3D"){useDialogStore().showDialog({key:"asset-3d-viewer",title:me.name,component:Load3DViewerContent,props:{modelUrl:me.preview_url||""},dialogComponentProps:{style:"width: 80vw; height: 80vh;",maximizable:!0}});return}G.value=me.id;const Z=Y.value.findIndex(J=>J.id===me.id);Z!==-1&&(U.value=Z)},"handleZoomClick"),de=p(me=>{const fe=getOutputAssetMetadata(me.user_metadata);if(!fe){console.warn("Invalid output asset metadata");return}const{promptId:Z,allOutputs:J,executionTimeInSeconds:le}=fe;if(!Z||!Array.isArray(J)||J.length===0){console.warn("Missing required folder view data");return}n.value=Z,s.value=le,H.value=J.map(ce=>({id:`${ce.nodeId}-${ce.filename}`,name:ce.filename,size:0,created_at:me.created_at,tags:["output"],preview_url:ce.url,user_metadata:{promptId:Z,nodeId:ce.nodeId,subfolder:ce.subfolder,executionTimeInSeconds:le,workflow:fe.workflow}}))},"enterFolderView"),ve=p(()=>{n.value=null,s.value=void 0,H.value=[],X.value=""},"exitFolderView");onMounted(()=>{T()}),onUnmounted(()=>{E()});const _e=p(()=>{C()},"handleDeselectAll"),oe=p(()=>{S&&C()},"handleEmptySpaceClick"),se=p(async()=>{if(n.value)try{await navigator.clipboard.writeText(n.value),_.add({severity:"success",summary:t("mediaAsset.jobIdToast.copied"),detail:t("mediaAsset.jobIdToast.jobIdCopied"),life:2e3})}catch{_.add({severity:"error",summary:t("mediaAsset.jobIdToast.error"),detail:t("mediaAsset.jobIdToast.jobIdCopyFailed"),life:3e3})}},"copyJobId"),he=p(()=>{const me=I(Y.value);N(me),C()},"handleDownloadSelected"),be=p(async()=>{const me=I(Y.value);await L(me),C()},"handleDeleteSelected"),Se=useDebounceFn(async()=>{o.value==="output"&&!a.value&&b.hasMore.value&&!b.isLoadingMore.value&&await b.loadMore()},300);return(me,fe)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(_sfc_main$1$,null,{top:withCtx(()=>[a.value?(openBlock(),createElementBlock("div",_hoisted_2$1j,[createBaseVNode("div",_hoisted_3$W,[createBaseVNode("span",_hoisted_4$F,toDisplayString(me.$t("Job ID"))+":",1),createBaseVNode("span",_hoisted_5$B,toDisplayString(n.value?.substring(0,8)),1),createBaseVNode("button",{class:"m-0 cursor-pointer border-0 bg-transparent p-0 outline-0",role:"button",onClick:se},fe[6]||(fe[6]=[createBaseVNode("i",{class:"mb-1 icon-[lucide--copy] text-sm"},null,-1)]))]),createBaseVNode("div",null,[createBaseVNode("span",null,toDisplayString(f.value),1)])])):(openBlock(),createElementBlock("span",_hoisted_1$1G,toDisplayString(me.$t("sideToolbar.mediaAssets.title")),1))]),header:withCtx(()=>[a.value?(openBlock(),createElementBlock("div",_hoisted_6$r,[createVNode(_sfc_main$2D,{label:me.$t("sideToolbar.backToAssets"),type:"secondary",onClick:ve},{icon:withCtx(()=>fe[7]||(fe[7]=[createBaseVNode("i",{class:"icon-[lucide--arrow-left] size-4"},null,-1)])),_:1},8,["label"])])):(openBlock(),createBlock(_sfc_main$2f,{key:1,modelValue:o.value,"onUpdate:modelValue":fe[0]||(fe[0]=Z=>o.value=Z),class:"pt-4 pb-1"},{default:withCtx(()=>[createVNode(_sfc_main$2g,{value:"output"},{default:withCtx(()=>[createTextVNode(toDisplayString(me.$t("sideToolbar.labels.generated")),1)]),_:1}),createVNode(_sfc_main$2g,{value:"input"},{default:withCtx(()=>[createTextVNode(toDisplayString(me.$t("sideToolbar.labels.imported")),1)]),_:1})]),_:1},8,["modelValue"])),createVNode(_sfc_main$20,{"search-query":unref(X),"onUpdate:searchQuery":fe[1]||(fe[1]=Z=>isRef(X)?X.value=Z:null),"sort-by":unref(Q),"onUpdate:sortBy":fe[2]||(fe[2]=Z=>isRef(Q)?Q.value=Z:null),"media-type-filters":unref(q),"onUpdate:mediaTypeFilters":fe[3]||(fe[3]=Z=>isRef(q)?q.value=Z:null),"show-generation-time-sort":o.value==="output"},null,8,["search-query","sort-by","media-type-filters","show-generation-time-sort"])]),body:withCtx(()=>[$.value?(openBlock(),createElementBlock("div",_hoisted_7$o,[createVNode(unref(script$5),{class:"absolute left-1/2 w-[50px] -translate-x-1/2"})])):Y.value.length?(openBlock(),createElementBlock("div",{key:2,class:"relative size-full",onClick:oe},[createVNode(VirtualGrid,{items:re.value,"grid-style":{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",padding:"0 0.5rem",gap:"0.5rem"},onApproachEnd:unref(Se)},{item:withCtx(({item:Z})=>[createVNode(_sfc_main$25,{asset:Z,selected:unref(w)(Z.id),"show-output-count":m(Z),"output-count":u(Z),"show-delete-button":l.value,"open-popover-id":r.value,onClick:p(J=>K(Z),"onClick"),onZoom:p(J=>ne(Z),"onZoom"),onOutputCountClick:p(J=>de(Z),"onOutputCountClick"),onAssetDeleted:ue,onPopoverOpened:p(J=>r.value=Z.id,"onPopoverOpened"),onPopoverClosed:fe[4]||(fe[4]=J=>r.value=null)},null,8,["asset","selected","show-output-count","output-count","show-delete-button","open-popover-id","onClick","onZoom","onOutputCountClick","onPopoverOpened"])]),_:1},8,["items","onApproachEnd"])])):(openBlock(),createElementBlock("div",_hoisted_8$i,[createVNode(NoResultsPlaceholder,{icon:"pi pi-info-circle",title:me.$t(o.value==="input"?"sideToolbar.noImportedFiles":"sideToolbar.noGeneratedFiles"),message:me.$t("sideToolbar.noFilesFoundMessage")},null,8,["title","message"])]))]),footer:withCtx(()=>[unref(S)?(openBlock(),createElementBlock("div",{key:0,ref_key:"footerRef",ref:A,class:"flex gap-1 h-18 w-full items-center justify-between"},[createBaseVNode("div",_hoisted_9$e,[createBaseVNode("div",{ref_key:"selectionCountButtonRef",ref:M,class:"inline-flex w-48"},[createVNode(_sfc_main$2A,{label:unref(P)?me.$t("mediaAsset.selection.deselectAll"):me.$t("mediaAsset.selection.selectedCount",{count:R.value}),type:"transparent",class:normalizeClass(O.value?"text-left":""),onClick:_e},null,8,["label","class"])],512)]),createBaseVNode("div",_hoisted_10$c,[O.value?(openBlock(),createElementBlock(Fragment,{key:0},[l.value?(openBlock(),createBlock(_sfc_main$2B,{key:0,onClick:be},{default:withCtx(()=>fe[8]||(fe[8]=[createBaseVNode("i",{class:"icon-[lucide--trash-2] size-4"},null,-1)])),_:1})):createCommentVNode("",!0),createVNode(_sfc_main$2B,{onClick:he},{default:withCtx(()=>fe[9]||(fe[9]=[createBaseVNode("i",{class:"icon-[lucide--download] size-4"},null,-1)])),_:1})],64)):(openBlock(),createElementBlock(Fragment,{key:1},[l.value?(openBlock(),createBlock(_sfc_main$2D,{key:0,label:me.$t("mediaAsset.selection.deleteSelected"),type:"secondary","icon-position":"right",onClick:be},{icon:withCtx(()=>fe[10]||(fe[10]=[createBaseVNode("i",{class:"icon-[lucide--trash-2] size-4"},null,-1)])),_:1},8,["label"])):createCommentVNode("",!0),createVNode(_sfc_main$2D,{label:me.$t("mediaAsset.selection.downloadSelected"),type:"secondary","icon-position":"right",onClick:he},{icon:withCtx(()=>fe[11]||(fe[11]=[createBaseVNode("i",{class:"icon-[lucide--download] size-4"},null,-1)])),_:1},8,["label"])],64))])],512)):createCommentVNode("",!0)]),_:1}),createVNode(_sfc_main$2h,{"active-index":U.value,"onUpdate:activeIndex":fe[5]||(fe[5]=Z=>U.value=Z),"all-gallery-items":ae.value},null,8,["active-index","all-gallery-items"])],64))}}),useAssetsSidebarTab=p(()=>({id:"assets",icon:"icon-[comfy--image-ai-edit]",title:"sideToolbar.assets",tooltip:"sideToolbar.assets",label:"sideToolbar.labels.assets",component:markRaw(_sfc_main$1_),type:"vue"}),"useAssetsSidebarTab"),_sfc_main$1Z=defineComponent({__name:"SearchFilterChip",props:{text:{},badge:{},badgeClass:{}},emits:["remove"],setup(i){return(o,n)=>(openBlock(),createBlock(unref(script$e),{removable:"",onRemove:n[0]||(n[0]=s=>o.$emit("remove",s))},{default:withCtx(()=>[createVNode(unref(script$d),{size:"small",class:normalizeClass(o.badgeClass)},{default:withCtx(()=>[createTextVNode(toDisplayString(o.badge),1)]),_:1},8,["class"]),createTextVNode(" "+toDisplayString(o.text),1)]),_:1}))}}),SearchFilterChip=_export_sfc(_sfc_main$1Z,[["__scopeId","data-v-1adce2e7"]]),_hoisted_1$1F={key:0,class:"search-filters flex flex-wrap gap-2 pt-2"},_sfc_main$1Y=defineComponent({__name:"SearchBox",props:{modelValue:{},placeholder:{default:"Search..."},icon:{default:"pi pi-search"},debounceTime:{default:300},filterIcon:{},filters:{default:p(()=>[],"default")},autofocus:{type:Boolean,default:!1}},emits:["update:modelValue","search","showFilter","removeFilter"],setup(i,{emit:o}){const n=o,s=debounce(l=>{n("search",l,i.filters)},i.debounceTime),a=p(l=>{const u=l.target;n("update:modelValue",u.value),s(u.value)},"handleInput"),r=p(()=>{n("update:modelValue",""),s("")},"clearSearch");return(l,u)=>(openBlock(),createElementBlock("div",null,[createVNode(unref(script$g),null,{default:withCtx(()=>[l.filterIcon?(openBlock(),createBlock(unref(script),{key:0,class:"p-inputicon filter-button",icon:l.filterIcon,text:"",severity:"contrast",onClick:u[0]||(u[0]=m=>l.$emit("showFilter",m))},null,8,["icon"])):createCommentVNode("",!0),createVNode(unref(script$3),{class:"search-box-input w-full","model-value":l.modelValue,placeholder:l.placeholder,autofocus:l.autofocus,onInput:a},null,8,["model-value","placeholder","autofocus"]),l.modelValue?createCommentVNode("",!0):(openBlock(),createBlock(unref(script$f),{key:1,class:normalizeClass(l.icon)},null,8,["class"])),l.modelValue?(openBlock(),createBlock(unref(script),{key:2,class:"p-inputicon clear-button",icon:"pi pi-times",text:"",severity:"contrast",onClick:r})):createCommentVNode("",!0)]),_:1}),l.filters?.length?(openBlock(),createElementBlock("div",_hoisted_1$1F,[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.filters,m=>(openBlock(),createBlock(SearchFilterChip,{key:m.id,text:m.text,badge:m.badge,"badge-class":m.badgeClass,onRemove:p(f=>l.$emit("removeFilter",m),"onRemove")},null,8,["text","badge","badge-class","onRemove"]))),128))])):createCommentVNode("",!0)]))}}),SearchBox=_export_sfc(_sfc_main$1Y,[["__scopeId","data-v-5616a8b3"]]),_hoisted_1$1E={class:"editable-text"},_hoisted_2$1i={key:0},_sfc_main$1X=defineComponent({__name:"EditableText",props:{modelValue:{},isEditing:{type:Boolean,default:!1},inputAttrs:{default:p(()=>({}),"default")}},emits:["update:modelValue","edit","cancel"],setup(i,{emit:o}){const n=o,s=ref(i.modelValue),a=ref(),r=ref(!1),l=p(()=>{a.value?.$el.blur()},"blurInputElement"),u=p(()=>{r.value||n("edit",s.value),r.value=!1},"finishEditing"),m=p(()=>{r.value=!0,s.value=i.modelValue,n("cancel"),l()},"cancelEditing");watch(()=>i.isEditing,async _=>{_&&(s.value=i.modelValue,await nextTick(()=>{if(!a.value)return;const y=s.value.includes(".")?s.value.split(".").slice(0,-1).join("."):s.value,b=0,w=y.length;a.value.$el.setSelectionRange?.(b,w)}))},{immediate:!0});const f={mounted:p(_=>_.focus(),"mounted")};return(_,y)=>(openBlock(),createElementBlock("div",_hoisted_1$1E,[_.isEditing?withDirectives((openBlock(),createBlock(unref(script$3),{key:1,ref_key:"inputRef",ref:a,"model-value":s.value,"onUpdate:modelValue":y[0]||(y[0]=b=>s.value=b),type:"text",size:"small",fluid:"",pt:{root:{onBlur:u,..._.inputAttrs}},onKeyup:[withKeys(l,["enter"]),withKeys(m,["escape"])],onClick:y[1]||(y[1]=withModifiers(()=>{},["stop"])),onPointerdownCapture:y[2]||(y[2]=withModifiers(()=>{},["stop"])),onPointermoveCapture:y[3]||(y[3]=withModifiers(()=>{},["stop"]))},null,8,["model-value","pt"])),[[f]]):(openBlock(),createElementBlock("span",_hoisted_2$1i,toDisplayString(_.modelValue),1))]))}}),EditableText=_export_sfc(_sfc_main$1X,[["__scopeId","data-v-16874178"]]);function usePragmaticDroppable(i,o){let n=p(()=>{},"cleanup");onMounted(()=>{const s=toValue(i);s&&(n=dropTargetForElements({element:s,...o}))}),onBeforeUnmount(()=>{n()})}p(usePragmaticDroppable,"usePragmaticDroppable");function usePragmaticDraggable(i,o){let n=p(()=>{},"cleanup");onMounted(()=>{const s=toValue(i);s&&(n=draggable({element:s,...o}))}),onBeforeUnmount(()=>{n()})}p(usePragmaticDraggable,"usePragmaticDraggable");const InjectKeyHandleEditLabelFunction=Symbol(),InjectKeyExpandedKeys=Symbol(),_hoisted_1$1D={class:"node-content"},_hoisted_2$1h={class:"node-label"},_hoisted_3$V={class:"node-actions motion-safe:opacity-0 motion-safe:group-hover/tree-node:opacity-100"},_sfc_main$1W=defineComponent({__name:"TreeExplorerTreeNode",props:{node:{}},emits:["itemDropped","dragStart","dragEnd"],setup(i,{emit:o}){const n=i,s=o,a=computed(()=>n.node.leaf?"":n.node.badgeText!==void 0&&n.node.badgeText!==null?n.node.badgeText:n.node.totalLeaves.toString()),r=computed(()=>a.value!==""),l=computed(()=>n.node.isEditingLabel??!1),u=inject(InjectKeyHandleEditLabelFunction),m=p(b=>{u?.(n.node,b)},"handleRename"),f=ref(null),_=ref(!1),y=p(()=>f.value?.closest(".p-tree-node-content"),"treeNodeElementGetter");return n.node.draggable&&usePragmaticDraggable(y,{getInitialData:p(()=>({type:"tree-explorer-node",data:n.node}),"getInitialData"),onDragStart:p(()=>s("dragStart",n.node),"onDragStart"),onDrop:p(()=>s("dragEnd",n.node),"onDrop"),onGenerateDragPreview:n.node.renderDragPreview?({nativeSetDragImage:b})=>{setCustomNativeDragPreview({render:p(({container:w})=>n.node.renderDragPreview?.(w),"render"),nativeSetDragImage:b})}:void 0}),n.node.droppable&&usePragmaticDroppable(y,{onDrop:p(async b=>{const w=b.source.data;w.type==="tree-explorer-node"&&(await n.node.handleDrop?.(w),_.value=!1,s("itemDropped",n.node,w.data))},"onDrop"),onDragEnter:p(b=>{b.source.data.type==="tree-explorer-node"&&(_.value=!0)},"onDragEnter"),onDragLeave:p(()=>{_.value=!1},"onDragLeave")}),(b,w)=>(openBlock(),createElementBlock("div",{ref_key:"container",ref:f,class:normalizeClass(["tree-node",{"can-drop":_.value,"tree-folder":!n.node.leaf,"tree-leaf":n.node.leaf}])},[createBaseVNode("div",_hoisted_1$1D,[createBaseVNode("span",_hoisted_2$1h,[renderSlot(b.$slots,"before-label",{node:n.node},void 0,!0),createVNode(EditableText,{"model-value":b.node.label,"is-editing":l.value,onEdit:m},null,8,["model-value","is-editing"]),renderSlot(b.$slots,"after-label",{node:n.node},void 0,!0)]),r.value?(openBlock(),createBlock(unref(script$d),{key:0,value:a.value,severity:"secondary",class:"leaf-count-badge"},null,8,["value"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_3$V,[renderSlot(b.$slots,"actions",{node:n.node},void 0,!0)])],2))}}),TreeExplorerTreeNode=_export_sfc(_sfc_main$1W,[["__scopeId","data-v-b10ac6ce"]]);function useTreeFolderOperations(i){const{t:o}=useI18n(),n=ref(null),s=ref(null),a=p(m=>`${m}/new_folder_${Date.now()}`,"generateTempKey"),r=p(async m=>{if(!(!n.value||!s.value))try{await s.value?.handleAddFolder?.(m)}finally{n.value=null,s.value=null}},"handleFolderCreation"),l=p(m=>{i(m),n.value={key:a(m.key),label:"",leaf:!1,children:[],icon:"pi pi-folder",type:"folder",totalLeaves:0,badgeText:"",isEditingLabel:!0},s.value=m},"addFolderCommand");return{newFolderNode:n,addFolderCommand:l,getAddFolderMenuItem:p(m=>({label:o("g.newFolder"),icon:"pi pi-folder-plus",command:p(()=>{m&&l(m)},"command"),visible:!!m&&!m.leaf&&!!m.handleAddFolder,isAsync:!1}),"getAddFolderMenuItem"),handleFolderCreation:r}}p(useTreeFolderOperations,"useTreeFolderOperations");function buildTree(i,o){const n={key:"root",label:"root",children:[]},s={root:n};for(const a of i){const r=o(a);let l=n;for(let u=0;u<r.length;u++){const m=r[u];if(m===""&&u===r.length-1)break;const f=l.key+"/"+m;if(!s[f]){const _={key:f,label:m,leaf:!1,children:[]};s[f]=_,l.children?.push(_)}l=s[f]}l.leaf=r[r.length-1]!=="",l.data=a}return n}p(buildTree,"buildTree");function flattenTree(i){const o=[],n=[i];for(;n.length;){const s=n.pop();s.leaf&&s.data&&o.push(s.data),n.push(...s.children??[])}return o}p(flattenTree,"flattenTree");function sortedTree(i,{groupLeaf:o=!1}={}){const n={...i};if(i.children)if(o){const s=i.children.filter(u=>!u.leaf),a=i.children.filter(u=>u.leaf),r=s.sort((u,m)=>(u.label??"").localeCompare(m.label??"")),l=a.sort((u,m)=>(u.label??"").localeCompare(m.label??""));n.children=[...r.map(u=>sortedTree(u,{groupLeaf:!0})),...l]}else{const s=[...i.children].sort((a,r)=>(a.label??"").localeCompare(r.label??""));n.children=[...s.map(a=>sortedTree(a,{groupLeaf:!1}))]}return n}p(sortedTree,"sortedTree");const findNodeByKey=p((i,o)=>{if(i.key===o)return i;if(!i.children)return null;for(const n of i.children){const s=findNodeByKey(n,o);if(s)return s}return null},"findNodeByKey");function cloneTree(i){const o={...i};return i.children&&i.children.length>0&&(o.children=i.children.map(n=>cloneTree(n))),o}p(cloneTree,"cloneTree");const combineTrees=p((i,o)=>{const n=cloneTree(i),s=o.key.slice(0,o.key.lastIndexOf("/")),a=findNodeByKey(n,s);return a&&(a.children??=[],a.children.push(cloneTree(o))),n},"combineTrees"),_sfc_main$1V=defineComponent({__name:"TreeExplorer",props:mergeModels({root:{},class:{}},{expandedKeys:{required:!0},expandedKeysModifiers:{},selectionKeys:{},selectionKeysModifiers:{}}),emits:mergeModels(["nodeClick","nodeDelete","contextMenu"],["update:expandedKeys","update:selectionKeys"]),setup(i,{expose:o,emit:n}){const s=useModel(i,"expandedKeys");provide(InjectKeyExpandedKeys,s);const a=useModel(i,"selectionKeys"),r=a.value!==void 0,l=i,u=n,{newFolderNode:m,getAddFolderMenuItem:f,handleFolderCreation:_,addFolderCommand:y}=useTreeFolderOperations(V=>{s.value[V.key]=!0}),b=computed(()=>{const V=k(l.root);return m.value?combineTrees(V,m.value):V}),w=p(V=>{if(V.getIcon){const F=V.getIcon();if(F)return F}else if(V.icon)return V.icon;return V.leaf?"pi pi-file":s.value?.[V.key]??!1?"pi pi-folder-open":"pi pi-folder"},"getTreeNodeIcon"),k=p(V=>{const $=V.children?.map(k)??[],F=V.leaf?1:$.reduce((j,U)=>j+U.totalLeaves,0);return{...V,icon:w(V),children:$,type:V.leaf?"node":"folder",totalLeaves:F,badgeText:V.getBadgeText?V.getBadgeText():void 0,isEditingLabel:V.key===E.value?.key}},"fillNodeInfo"),S=p(async(V,$)=>{r||(a.value={}),$.handleClick&&await $.handleClick(V),u("nodeClick",$,V)},"onNodeContentClick"),C=ref(null),I=ref(null),T=computed(()=>I.value?.contextMenuItems?typeof I.value.contextMenuItems=="function"?I.value.contextMenuItems(I.value):I.value.contextMenuItems:[]),E=ref(null),N=useErrorHandling();provide(InjectKeyHandleEditLabelFunction,p(async(V,$)=>{await N.wrapWithErrorHandlingAsync(async()=>{V.key===m.value?.key?await _($):await V.handleRename?.($)},V.handleError,()=>{E.value=null})()},"handleNodeLabelEdit"));const{t:A}=useI18n(),D=p(V=>{E.value=V},"renameCommand"),O=p(async V=>{await V.handleDelete?.(),u("nodeDelete",V)},"deleteCommand"),M=computed(()=>[f(I.value),{label:A("g.rename"),icon:"pi pi-file-edit",command:p(()=>{I.value&&D(I.value)},"command"),visible:I.value?.handleRename!==void 0},{label:A("g.delete"),icon:"pi pi-trash",command:p(async()=>{I.value&&await O(I.value)},"command"),visible:I.value?.handleDelete!==void 0,isAsync:!0},...T.value].map(V=>({...V,command:V.command?R(V.command,{isAsync:V.isAsync??!1}):void 0}))),P=p((V,$)=>{I.value=$,u("contextMenu",$,V),M.value.filter(F=>F.visible).length>0&&C.value?.show(V)},"handleContextMenu"),R=p((V,{isAsync:$=!1})=>$?N.wrapWithErrorHandlingAsync(V,I.value?.handleError):N.wrapWithErrorHandling(V,I.value?.handleError),"wrapCommandWithErrorHandler");return o({addFolderCommand:p(V=>{const $=findNodeByKey(b.value,V);$&&y($)},"addFolderCommand")}),(V,$)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(unref(script$h),{"expanded-keys":s.value,"onUpdate:expandedKeys":$[0]||($[0]=F=>s.value=F),"selection-keys":a.value,"onUpdate:selectionKeys":$[1]||($[1]=F=>a.value=F),class:normalizeClass(["tree-explorer px-2 py-0 2xl:px-4",l.class]),value:b.value.children,"selection-mode":"single",pt:{nodeLabel:"tree-explorer-node-label",nodeContent:p(({context:F})=>({class:"group/tree-node",onClick:p(j=>S(j,F.node),"onClick"),onContextmenu:p(j=>P(j,F.node),"onContextmenu")}),"nodeContent"),nodeToggleButton:p(()=>({onClick:p(F=>{F.stopImmediatePropagation()},"onClick")}),"nodeToggleButton")}},{folder:withCtx(({node:F})=>[renderSlot(V.$slots,"folder",{node:F},()=>[createVNode(TreeExplorerTreeNode,{node:F},null,8,["node"])],!0)]),node:withCtx(({node:F})=>[renderSlot(V.$slots,"node",{node:F},()=>[createVNode(TreeExplorerTreeNode,{node:F},null,8,["node"])],!0)]),_:3},8,["expanded-keys","selection-keys","class","value","pt"]),createVNode(unref(script$i),{ref_key:"menu",ref:C,model:M.value},null,8,["model"])],64))}}),TreeExplorer=_export_sfc(_sfc_main$1V,[["__scopeId","data-v-d499b1d7"]]),_hoisted_1$1C={class:"comfy-vue-side-bar-header"},_hoisted_2$1g=["title"],_hoisted_3$U={class:"touch:w-auto touch:opacity-100 flex flex-row transition-all duration-200 motion-safe:w-0 motion-safe:opacity-0 motion-safe:group-focus-within/sidebar-tab:w-auto motion-safe:group-focus-within/sidebar-tab:opacity-100 motion-safe:group-hover/sidebar-tab:w-auto motion-safe:group-hover/sidebar-tab:opacity-100"},_sfc_main$1U=defineComponent({__name:"SidebarTabTemplate",props:{title:{},class:{}},setup(i){const o=i;return(n,s)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["comfy-vue-side-bar-container group/sidebar-tab flex h-full flex-col",o.class])},[createBaseVNode("div",_hoisted_1$1C,[createVNode(unref(script$j),{class:"min-h-8 rounded-none border-x-0 border-t-0 px-2 py-1"},{start:withCtx(()=>[createBaseVNode("span",{class:"truncate text-xs 2xl:text-sm",title:o.title},toDisplayString(o.title.toUpperCase()),9,_hoisted_2$1g)]),end:withCtx(()=>[createBaseVNode("div",_hoisted_3$U,[renderSlot(n.$slots,"tool-buttons",{},void 0,!0)])]),_:3}),renderSlot(n.$slots,"header",{},void 0,!0)]),createVNode(unref(script$c),{class:"comfy-vue-side-bar-body h-0 grow"},{default:withCtx(()=>[renderSlot(n.$slots,"body",{},void 0,!0)]),_:3})],2))}}),SidebarTabTemplate=_export_sfc(_sfc_main$1U,[["__scopeId","data-v-e32afccd"]]),useElectronDownloadStore=defineStore("downloads",()=>{const i=ref([]),{DownloadManager:o}=electronAPI(),n=p(m=>i.value.find(f=>m===f.url),"findByUrl"),s=p(async()=>{if(isElectron()){const m=await o.getAllDownloads();for(const f of m)i.value.push(f);o.onDownloadProgress(f=>{n(f.url)||i.value.push(f);const _=n(f.url);_&&(_.progress=f.progress,_.status=f.status,_.filename=f.filename,_.savePath=f.savePath)})}},"initialize");return s(),{downloads:i,start:p(({url:m,savePath:f,filename:_})=>o.startDownload(m,f,_),"start"),pause:p(m=>o.pauseDownload(m),"pause"),resume:p(m=>o.resumeDownload(m),"resume"),cancel:p(m=>o.cancelDownload(m),"cancel"),findByUrl:n,initialize:s,inProgressDownloads:computed(()=>i.value.filter(({status:m})=>m!==DownloadStatus.COMPLETED))}}),_hoisted_1$1B={class:"flex flex-col"},_hoisted_2$1f={key:0},_hoisted_3$T={key:1,class:"mt-2 flex flex-row items-center gap-2"},_sfc_main$1T=defineComponent({__name:"DownloadItem",props:{download:{}},setup(i){const{t:o}=useI18n(),n=useElectronDownloadStore(),s=i,a=p(f=>{let _=f.split("/");_=_.length===1?_[0].split("\\"):_;const y=_.pop();return`${_.pop()}/${y}`},"getDownloadLabel"),r=p(()=>n.cancel(s.download.url),"triggerCancelDownload"),l=p(()=>n.pause(s.download.url),"triggerPauseDownload"),u=p(()=>n.resume(s.download.url),"triggerResumeDownload"),m=p(()=>{n.$patch(f=>{f.downloads=f.downloads.filter(({url:_})=>_!==s.download.url)})},"handleRemoveDownload");return(f,_)=>{const y=resolveDirective("tooltip");return openBlock(),createElementBlock("div",_hoisted_1$1B,[createBaseVNode("div",null,toDisplayString(a(f.download.savePath??"")),1),["cancelled","error"].includes(f.download.status??"")?(openBlock(),createElementBlock("div",_hoisted_2$1f,[createVNode(unref(script$e),{class:"mt-2 h-6 bg-red-700 text-sm font-light",removable:"",onRemove:m},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(o)("electronFileDownload.cancelled")),1)]),_:1})])):createCommentVNode("",!0),["in_progress","paused","completed"].includes(f.download.status??"")?(openBlock(),createElementBlock("div",_hoisted_3$T,[createVNode(unref(script$k),{class:"flex-1",value:Number(((f.download.progress??0)*100).toFixed(1)),"show-value":(f.download.progress??0)>.1},null,8,["value","show-value"]),f.download.status==="in_progress"?withDirectives((openBlock(),createBlock(unref(script),{key:0,class:"file-action-button h-[22px] w-[22px]",size:"small",rounded:"",icon:"pi pi-pause",onClick:l},null,512)),[[y,unref(o)("electronFileDownload.pause"),void 0,{top:!0}]]):createCommentVNode("",!0),f.download.status==="paused"?withDirectives((openBlock(),createBlock(unref(script),{key:1,class:"file-action-button h-[22px] w-[22px]",size:"small",rounded:"",icon:"pi pi-play",onClick:u},null,512)),[[y,unref(o)("electronFileDownload.resume"),void 0,{top:!0}]]):createCommentVNode("",!0),["in_progress","paused"].includes(f.download.status??"")?withDirectives((openBlock(),createBlock(unref(script),{key:2,class:"file-action-button p-red h-[22px] w-[22px]",size:"small",rounded:"",severity:"danger",icon:"pi pi-times-circle",onClick:r},null,512)),[[y,unref(o)("electronFileDownload.cancel"),void 0,{top:!0}]]):createCommentVNode("",!0)])):createCommentVNode("",!0)])}}}),_hoisted_1$1A={key:0,class:"mx-6 mb-4"},_hoisted_2$1e={class:"my-4 text-lg"},_sfc_main$1S=defineComponent({__name:"ElectronDownloadItems",setup(i){const o=useElectronDownloadStore(),{inProgressDownloads:n}=storeToRefs(o);return(s,a)=>unref(n).length>0?(openBlock(),createElementBlock("div",_hoisted_1$1A,[createBaseVNode("div",_hoisted_2$1e,toDisplayString(s.$t("electronFileDownload.inProgress")),1),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(n),r=>(openBlock(),createBlock(_sfc_main$1T,{key:r.url,download:r},null,8,["download"]))),128))])):createCommentVNode("",!0)}});function _findInMetadata(i,...o){for(const n of o){if(n in i)return i[n];for(const s in i)if(s.endsWith(n))return i[s]}return null}p(_findInMetadata,"_findInMetadata");class ComfyModelDef{static{p(this,"ComfyModelDef")}path_index;file_name;normalized_file_name;directory;simplified_file_name;key;title;architecture_id="";author="";resolution="";description="";usage_hint="";trigger_phrase="";tags=[];image="";has_loaded_metadata=!1;is_load_requested=!1;searchable="";constructor(o,n,s){this.path_index=s,this.file_name=o,this.normalized_file_name=o.replaceAll("\\","/"),this.simplified_file_name=this.normalized_file_name.split("/").pop()??"",this.simplified_file_name.endsWith(".safetensors")&&(this.simplified_file_name=this.simplified_file_name.slice(0,-12)),this.title=this.simplified_file_name,this.directory=n,this.key=`${n}/${this.normalized_file_name}`,this.updateSearchable()}updateSearchable(){this.searchable=[this.file_name,this.title,this.author,this.description,this.trigger_phrase,this.tags.join(", ")].join(`
`).toLowerCase()}async load(){if(!(this.has_loaded_metadata||this.is_load_requested)){this.is_load_requested=!0;try{const o=await api.viewMetadata(this.directory,this.file_name);if(!o)return;this.title=_findInMetadata(o,"modelspec.title","title","display_name","name")||this.title,this.architecture_id=_findInMetadata(o,"modelspec.architecture","architecture")||"",this.author=_findInMetadata(o,"modelspec.author","author")||"",this.description=_findInMetadata(o,"modelspec.description","description")||"",this.resolution=_findInMetadata(o,"modelspec.resolution","resolution")||"",this.usage_hint=_findInMetadata(o,"modelspec.usage_hint","usage_hint")||"",this.trigger_phrase=_findInMetadata(o,"modelspec.trigger_phrase","trigger_phrase")||"",this.image=_findInMetadata(o,"modelspec.thumbnail","thumbnail","image","icon")||"";const n=_findInMetadata(o,"modelspec.tags","tags")||"";this.tags=n.split(",").map(s=>s.trim()),this.has_loaded_metadata=!0,this.updateSearchable()}catch(o){console.error("Error loading model metadata",this.file_name,this,o)}}}}var ResourceState=(i=>(i[i.Uninitialized=0]="Uninitialized",i[i.Loading=1]="Loading",i[i.Loaded=2]="Loaded",i))(ResourceState||{});class ModelFolder{static{p(this,"ModelFolder")}constructor(o,n){this.directory=o,this.getModelsFunc=n}models={};state=0;get key(){return this.directory+"/"}async load(){if(this.state!==0)return this;this.state=1;const o=await this.getModelsFunc(this.directory);for(const n of o)this.models[`${n.pathIndex}/${n.name}`]=new ComfyModelDef(n.name,this.directory,n.pathIndex);return this.state=2,this}}const useModelStore=defineStore("models",()=>{const i=useSettingStore(),o=ref([]),n=ref({}),s=computed(()=>o.value.map(m=>n.value[m])),a=computed(()=>s.value.flatMap(m=>Object.values(m.models)));async function r(){const m=i.get("Comfy.Assets.UseAssetAPI"),f=m?await assetService.getAssetModelFolders():await api.getModelFolders();o.value=f.map(_=>_.name),n.value={};for(const _ of o.value){const y=m?b=>assetService.getAssetModels(b):b=>api.getModels(b);n.value[_]=new ModelFolder(_,y)}}p(r,"loadModelFolders");async function l(m){const f=n.value[m];return f?await f.load():null}p(l,"getLoadedModelFolder");async function u(){return Promise.all(s.value.map(m=>m.load()))}return p(u,"loadModels"),{models:a,modelFolders:s,loadModelFolders:r,loadModels:u,getLoadedModelFolder:l}}),_hoisted_1$1z={class:"model_preview"},_hoisted_2$1d={class:"model_preview_title"},_hoisted_3$S={class:"model_preview_top_container"},_hoisted_4$E={class:"model_preview_filename"},_hoisted_5$A={key:0,class:"model_preview_architecture"},_hoisted_6$q={class:"model_preview_prefix"},_hoisted_7$n={key:1,class:"model_preview_author"},_hoisted_8$h={class:"model_preview_prefix"},_hoisted_9$d={key:0,class:"model_preview_image"},_hoisted_10$b=["src"],_hoisted_11$7={key:1,class:"model_preview_usage_hint"},_hoisted_12$4={class:"model_preview_prefix"},_hoisted_13$4={key:2,class:"model_preview_trigger_phrase"},_hoisted_14$2={class:"model_preview_prefix"},_hoisted_15$2={key:3,class:"model_preview_description"},_hoisted_16$2={class:"model_preview_prefix"},_sfc_main$1R=defineComponent({__name:"ModelPreview",props:{modelDef:{type:ComfyModelDef,required:!0}},setup(i){const n=i.modelDef;return(s,a)=>(openBlock(),createElementBlock("div",_hoisted_1$1z,[createBaseVNode("div",_hoisted_2$1d,toDisplayString(unref(n).title),1),createBaseVNode("div",_hoisted_3$S,[createBaseVNode("div",_hoisted_4$E,toDisplayString(unref(n).file_name),1),unref(n).architecture_id?(openBlock(),createElementBlock("div",_hoisted_5$A,[createBaseVNode("span",_hoisted_6$q,toDisplayString(s.$t("g.architecture"))+": ",1),createTextVNode(" "+toDisplayString(unref(n).architecture_id),1)])):createCommentVNode("",!0),unref(n).author?(openBlock(),createElementBlock("div",_hoisted_7$n,[createBaseVNode("span",_hoisted_8$h,toDisplayString(s.$t("g.author"))+": ",1),createTextVNode(" "+toDisplayString(unref(n).author),1)])):createCommentVNode("",!0)]),unref(n).image?(openBlock(),createElementBlock("div",_hoisted_9$d,[createBaseVNode("img",{src:unref(n).image},null,8,_hoisted_10$b)])):createCommentVNode("",!0),unref(n).usage_hint?(openBlock(),createElementBlock("div",_hoisted_11$7,[createBaseVNode("span",_hoisted_12$4,toDisplayString(s.$t("g.usageHint"))+": ",1),createTextVNode(" "+toDisplayString(unref(n).usage_hint),1)])):createCommentVNode("",!0),unref(n).trigger_phrase?(openBlock(),createElementBlock("div",_hoisted_13$4,[createBaseVNode("span",_hoisted_14$2,toDisplayString(s.$t("g.triggerPhrase"))+": ",1),createTextVNode(" "+toDisplayString(unref(n).trigger_phrase),1)])):createCommentVNode("",!0),unref(n).description?(openBlock(),createElementBlock("div",_hoisted_15$2,[createBaseVNode("span",_hoisted_16$2,toDisplayString(s.$t("g.description"))+": ",1),createTextVNode(" "+toDisplayString(unref(n).description),1)])):createCommentVNode("",!0)]))}}),ModelPreview=_export_sfc(_sfc_main$1R,[["__scopeId","data-v-acb8805c"]]),_hoisted_1$1y={key:0,class:"model-lib-model-icon-container"},_sfc_main$1Q=defineComponent({__name:"ModelTreeLeaf",props:{node:{}},setup(i){const o=i,n=computed(()=>o.node.data),s=computed(()=>{if(n.value.image)return n.value.image;const S=n.value.directory,C=n.value.path_index,I=n.value.file_name.split(".").pop(),T=n.value.file_name.replace(`.${I}`,".webp"),E=encodeURIComponent(T).replace(/%2F/g,"/");return`/api/experiment/models/preview/${S}/${C}/${E}`}),a=ref(null),r=ref({position:"absolute",top:"0px",left:"0px"}),l=useSettingStore(),u=computed(()=>l.get("Comfy.Sidebar.Location")),m=p(async()=>{const S=_.value;if(!S)return;const C=S.getBoundingClientRect(),I=a.value?.$el.offsetHeight||0,T=window.innerHeight-C.bottom;r.value.top=I>T?`${Math.max(0,C.top-(I-T)-20)}px`:`${C.top-40}px`,u.value==="left"?r.value.left=`${C.right}px`:r.value.left=`${C.left-400}px`,await n.value.load()},"handleModelHover"),f=ref(),_=ref(),y=ref(!1),b=computed(()=>y.value&&n.value&&n.value.has_loaded_metadata&&(n.value.author||n.value.simplified_file_name!=n.value.title||n.value.description||n.value.usage_hint||n.value.trigger_phrase||n.value.image)),w=p(async()=>{y.value=!0,await nextTick(),await m()},"handleMouseEnter"),k=p(()=>{y.value=!1},"handleMouseLeave");return onMounted(async()=>{_.value=f.value?.closest(".p-tree-node-content")??void 0,_.value?.addEventListener("mouseenter",w),_.value?.addEventListener("mouseleave",k),await n.value.load()}),onUnmounted(()=>{_.value?.removeEventListener("mouseenter",w),_.value?.removeEventListener("mouseleave",k)}),(S,C)=>(openBlock(),createElementBlock("div",{ref_key:"container",ref:f,class:"model-lib-node-container h-full w-full"},[createVNode(TreeExplorerTreeNode,{node:S.node},{"before-label":withCtx(()=>[s.value?(openBlock(),createElementBlock("span",_hoisted_1$1y,[createBaseVNode("span",{class:"model-lib-model-icon",style:normalizeStyle({backgroundImage:`url(${s.value})`})},null,4)])):createCommentVNode("",!0)]),_:1},8,["node"]),b.value?(openBlock(),createBlock(Teleport,{key:0,to:"#model-library-model-preview-container"},[createBaseVNode("div",{class:"model-lib-model-preview",style:normalizeStyle(r.value)},[createVNode(ModelPreview,{ref_key:"previewRef",ref:a,"model-def":n.value},null,8,["model-def"])],4)])):createCommentVNode("",!0)],512))}}),ModelTreeLeaf=_export_sfc(_sfc_main$1Q,[["__scopeId","data-v-641705c5"]]);function useTreeExpansion(i){const o=p(l=>{l.key&&typeof l.key=="string"&&(l.key in i.value?delete i.value[l.key]:i.value[l.key]=!0)},"toggleNode"),n=p(l=>{l.key&&typeof l.key=="string"&&(l.key in i.value?a(l):s(l))},"toggleNodeRecursive"),s=p(l=>{if(l.key&&typeof l.key=="string"&&!l.leaf){i.value[l.key]=!0;for(const u of l.children??[])s(u)}},"expandNode"),a=p(l=>{if(l.key&&typeof l.key=="string"&&!l.leaf){delete i.value[l.key];for(const u of l.children??[])a(u)}},"collapseNode");return{toggleNode:o,toggleNodeRecursive:n,expandNode:s,collapseNode:a,toggleNodeOnEvent:p((l,u)=>{l.ctrlKey?n(u):o(u)},"toggleNodeOnEvent")}}p(useTreeExpansion,"useTreeExpansion");const _sfc_main$1P=defineComponent({__name:"ModelLibrarySidebarTab",setup(i){const o=useModelStore(),n=useModelToNodeStore(),s=useSettingStore(),a=ref(""),r=ref({}),{expandNode:l,toggleNodeOnEvent:u}=useTreeExpansion(r),m=ref([]),f=p(async b=>{if(!b){m.value=[],r.value={};return}await o.loadModels();const w=b.toLocaleLowerCase();m.value=o.models.filter(k=>k.searchable.includes(w)),await nextTick(),l(_.value)},"handleSearch"),_=computed(()=>{const b=a.value?m.value:[...o.modelFolders,...o.models];return buildTree(b,w=>w.key.split("/"))}),y=computed(()=>{const b=s.get("Comfy.ModelLibrary.NameFormat"),w=p(k=>{const S=k.children?.map(w),C=k.leaf&&k.data?k.data:null,I=!k.leaf&&k.data?k.data:null;return{key:k.key,label:C?b==="title"?C.title:C.simplified_file_name:k.label,leaf:k.leaf,data:k.data,getIcon(){return C?C.image?"pi pi-image":"pi pi-file":I&&I.state===ResourceState.Loading?"pi pi-spin pi-spinner":"pi pi-folder"},getBadgeText(){if(I)return I.state===ResourceState.Loaded?void 0:""},children:S,draggable:k.leaf,handleClick(T){if(this.leaf){const E=n.getNodeProvider(C.directory);if(E){const L=useLitegraphService().addNodeOnGraph(E.nodeDef).widgets.find(A=>A.name===E.key);L&&(L.value=C.file_name)}}else u(T,k)}}},"fillNodeInfo");return w(_.value)});return watch(toRef$2(r,"value"),b=>{Object.entries(b).forEach(([w,k])=>{if(k){const S=w.split("/").slice(1).join("/");S&&!S.includes("/")&&o.getLoadedModelFolder(S)}})},{deep:!0}),onMounted(async()=>{s.get("Comfy.ModelLibrary.AutoLoadAll")&&await o.loadModels()}),(b,w)=>{const k=resolveDirective("tooltip");return openBlock(),createElementBlock(Fragment,null,[createVNode(SidebarTabTemplate,{title:b.$t("sideToolbar.modelLibrary"),class:"bg-(--p-tree-background)"},{"tool-buttons":withCtx(()=>[withDirectives(createVNode(unref(script),{icon:"pi pi-refresh",severity:"secondary",text:"",onClick:unref(o).loadModelFolders},null,8,["onClick"]),[[k,b.$t("g.refresh"),void 0,{bottom:!0}]]),withDirectives(createVNode(unref(script),{icon:"pi pi-cloud-download",severity:"secondary",text:"",onClick:unref(o).loadModels},null,8,["onClick"]),[[k,b.$t("g.loadAllFolders"),void 0,{bottom:!0}]])]),header:withCtx(()=>[createVNode(SearchBox,{"model-value":a.value,"onUpdate:modelValue":w[0]||(w[0]=S=>a.value=S),class:"model-lib-search-box p-2 2xl:p-4",placeholder:b.$t("g.searchModels")+"...",onSearch:f},null,8,["model-value","placeholder"])]),body:withCtx(()=>[unref(isElectron)()?(openBlock(),createBlock(_sfc_main$1S,{key:0})):createCommentVNode("",!0),createVNode(TreeExplorer,{"expanded-keys":r.value,"onUpdate:expandedKeys":w[1]||(w[1]=S=>r.value=S),class:"model-lib-tree-explorer",root:y.value},{node:withCtx(({node:S})=>[createVNode(ModelTreeLeaf,{node:S},null,8,["node"])]),_:1},8,["expanded-keys","root"])]),_:1},8,["title"]),w[2]||(w[2]=createBaseVNode("div",{id:"model-library-model-preview-container"},null,-1))],64)}}}),ModelLibrarySidebarTab=_export_sfc(_sfc_main$1P,[["__scopeId","data-v-9a777eb3"]]),useModelLibrarySidebarTab=p(()=>({id:"model-library",icon:"icon-[comfy--ai-model]",title:"sideToolbar.modelLibrary",tooltip:"sideToolbar.modelLibrary",label:"sideToolbar.labels.models",component:markRaw(ModelLibrarySidebarTab),type:"vue",iconBadge:p(()=>{if(isElectron()){const i=useElectronDownloadStore();if(i.inProgressDownloads.length>0)return i.inProgressDownloads.length.toString()}return null},"iconBadge")}),"useModelLibrarySidebarTab");function useVueFeatureFlagsIndividual(){const i=useSettingStore(),o=computed(()=>{try{return i.get("Comfy.VueNodes.Enabled")??!1}catch{return!1}});return watch(o,()=>{LiteGraph.vueNodesMode=o.value},{immediate:!0}),{shouldRenderVueNodes:o}}p(useVueFeatureFlagsIndividual,"useVueFeatureFlagsIndividual");const useVueFeatureFlags=createSharedComposable(useVueFeatureFlagsIndividual),_hoisted_1$1x={width:"1.2em",height:"1.2em",xmlns:"http://www.w3.org/2000/svg",class:"",viewBox:"0 0 16 16",fill:"none"},_hoisted_2$1c=["clip-path"],_hoisted_3$R=["id"];function render$2(i,o){return openBlock(),createElementBlock("svg",_hoisted_1$1x,[createBaseVNode("g",{"clip-path":"url(#"+i.idMap.clip0_704_2695+")"},o[0]||(o[0]=[createStaticVNode('<path d="M6.05048 2C5.52055 7.29512 9.23033 10.4722 14 9.94267" stroke="currentColor" stroke-width="1.3"></path><path d="M6.5 5.5L10 2" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"></path><path d="M8 8L12.5 3.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="square"></path><path d="M10.5 9.5L14 6" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"></path><path d="M7.99992 14.6667C11.6818 14.6667 14.6666 11.6819 14.6666 8.00004C14.6666 4.31814 11.6818 1.33337 7.99992 1.33337C4.31802 1.33337 1.33325 4.31814 1.33325 8.00004C1.33325 11.6819 4.31802 14.6667 7.99992 14.6667Z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"></path>',5)]),8,_hoisted_2$1c),createBaseVNode("defs",null,[createBaseVNode("clipPath",{id:i.idMap.clip0_704_2695},o[1]||(o[1]=[createBaseVNode("rect",{width:"16",height:"16",fill:"white"},null,-1)]),8,_hoisted_3$R)])])}p(render$2,"render$2");const __unplugin_components_0$2=markRaw({name:"comfy-mask",render:render$2,setup(){return{idMap:{clip0_704_2695:"uicons-"+p(()=>Math.random().toString(36).substr(2,10),"__randId")()}}}}),_hoisted_1$1w={width:"1.2em",height:"1.2em",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function render$1(i,o){return openBlock(),createElementBlock("svg",_hoisted_1$1w,o[0]||(o[0]=[createBaseVNode("path",{d:"M7.13727 11.2201L6.27454 14.4398",stroke:"var(--pin-color, var(--color-smoke-800, #8a8a8a))","stroke-width":"1.3","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),createBaseVNode("path",{d:"M6.28085 6.68385C6.21652 6.92342 6.08664 7.1403 5.9058 7.31009C5.72497 7.47989 5.50035 7.59587 5.25721 7.645L3.95569 7.91742C3.71254 7.96655 3.48793 8.08253 3.30709 8.25233C3.12626 8.42212 2.99637 8.639 2.93204 8.87857L2.80091 9.36797C2.75515 9.53876 2.7791 9.72073 2.86751 9.87385C2.95591 10.027 3.10153 10.1387 3.27231 10.1845L10.9997 12.255C11.1705 12.3008 11.3525 12.2768 11.5056 12.1884C11.6587 12.1 11.7705 11.9544 11.8162 11.7836L11.9474 11.2942C12.0114 11.0546 12.0074 10.8018 11.9357 10.5643C11.864 10.3269 11.7274 10.1141 11.5414 9.95001L10.5505 9.06333C10.3645 8.89921 10.2279 8.68646 10.1562 8.44899C10.0845 8.21153 10.0805 7.95877 10.1446 7.71913L10.7933 5.29787C10.8391 5.12709 10.9508 4.98148 11.1039 4.89307C11.2571 4.80466 11.439 4.78071 11.6098 4.82647C11.9514 4.91799 12.3153 4.87008 12.6216 4.69327C12.9278 4.51646 13.1513 4.22523 13.2428 3.88366C13.3343 3.54209 13.2864 3.17815 13.1096 2.8719C12.9328 2.56566 12.6416 2.34219 12.3 2.25067L7.1484 0.870299C6.80683 0.778775 6.44289 0.826689 6.13665 1.0035C5.8304 1.18031 5.60694 1.47154 5.51541 1.81311C5.42389 2.15468 5.4718 2.51862 5.64861 2.82487C5.82542 3.13111 6.11665 3.35458 6.45822 3.4461C6.62901 3.49186 6.77462 3.6036 6.86302 3.75672C6.95143 3.90984 6.97539 4.09181 6.92962 4.2626L6.28085 6.68385Z",fill:"var(--handle-color, var(--color-gold-600, #fd9903))"},null,-1)]))}p(render$1,"render$1");const __unplugin_components_0$1=markRaw({name:"comfy-pin",render:render$1}),_sfc_main$1O=defineComponent({__name:"NodeBadge",props:{text:{},fgColor:{default:"currentColor"},bgColor:{default:""},cssIcon:{}},setup(i){return(o,n)=>o.text?(openBlock(),createElementBlock("div",{key:0,class:"min-w-max rounded-sm bg-node-component-surface px-1 py-0.5 text-xs flex items-center gap-1",style:normalizeStyle({color:o.fgColor,backgroundColor:o.bgColor})},[createTextVNode(toDisplayString(o.text)+" ",1),o.cssIcon?(openBlock(),createElementBlock("i",{key:0,class:normalizeClass(unref(cn)(o.cssIcon))},null,2)):createCommentVNode("",!0)],4)):createCommentVNode("",!0)}}),tooltipsTemporarilyDisabled=ref(!1),hideTooltipsGlobally=p(()=>{const i=document.querySelectorAll(".p-tooltip");i.length!==0&&(i.forEach(o=>{const n=o.id;if(!n)return;const s=document.querySelectorAll('[data-pd-tooltip="true"]');for(const a of s)if(a.$_ptooltipId===n){a.dispatchEvent(new MouseEvent("mouseleave",{bubbles:!0}));break}}),tooltipsTemporarilyDisabled.value=!0)},"hideTooltipsGlobally"),handlePointerUp=p(()=>{tooltipsTemporarilyDisabled.value=!1},"handlePointerUp"),globalTooltipState={listenersSetup:!1};function setupGlobalTooltipHiding(){globalTooltipState.listenersSetup||(document.addEventListener("pointerdown",hideTooltipsGlobally),document.addEventListener("pointerup",handlePointerUp),window.addEventListener("wheel",hideTooltipsGlobally,{capture:!0,passive:!0}),globalTooltipState.listenersSetup=!0)}p(setupGlobalTooltipHiding,"setupGlobalTooltipHiding");function useNodeTooltips(i){const o=useNodeDefStore(),n=useSettingStore();setupGlobalTooltipHiding();const s=computed(()=>n.get("Comfy.EnableTooltips")),a=computed(()=>o.nodeDefsByName[unref(i)]),r=computed(()=>{if(!s.value||!a.value)return"";const _=`nodeDefs.${normalizeI18nKey(unref(i))}.description`;return st(_,a.value.description||"")});return{tooltipsEnabled:s,getNodeDescription:r,getInputSlotTooltip:p(_=>{if(!s.value||!a.value)return"";const y=`nodeDefs.${normalizeI18nKey(unref(i))}.inputs.${normalizeI18nKey(_)}.tooltip`,b=a.value.inputs?.[_]?.tooltip??"";return st(y,b)},"getInputSlotTooltip"),getOutputSlotTooltip:p(_=>{if(!s.value||!a.value)return"";const y=`nodeDefs.${normalizeI18nKey(unref(i))}.outputs.${_}.tooltip`,b=a.value.outputs?.[_]?.tooltip??"";return st(y,b)},"getOutputSlotTooltip"),getWidgetTooltip:p(_=>{if(!s.value||!a.value)return"";const y=_.tooltip;if(y)return y;const b=`nodeDefs.${normalizeI18nKey(unref(i))}.inputs.${normalizeI18nKey(_.name)}.tooltip`,w=a.value.inputs?.[_.name]?.tooltip??"";return st(b,w)},"getWidgetTooltip"),createTooltipConfig:p(_=>{const y=n.get("LiteGraph.Node.TooltipDelay"),b=_||"";return{value:b,showDelay:y,hideDelay:0,disabled:!s.value||!b||tooltipsTemporarilyDisabled.value,pt:{text:{class:"border-node-component-tooltip-border bg-node-component-tooltip-surface border rounded-md px-4 py-2 text-node-component-tooltip text-sm font-normal leading-tight max-w-75 shadow-none"},arrow:p(({context:w})=>({class:cn(w.top&&"border-t-node-component-tooltip-border",w.bottom&&"border-b-node-component-tooltip-border",w.left&&"border-l-node-component-tooltip-border ",w.right&&"border-r-node-component-tooltip-border")}),"arrow")}}},"createTooltipConfig")}}p(useNodeTooltips,"useNodeTooltips");function applyLightThemeColor(i,o){return!i||!o?i:adjustColor(i,{lightness:.5})}p(applyLightThemeColor,"applyLightThemeColor");const _hoisted_1$1v={key:0,class:"node-error p-4 text-sm text-red-500"},_hoisted_2$1b=["data-testid"],_hoisted_3$Q={class:"flex items-center justify-between gap-2.5 min-w-0"},_hoisted_4$D={class:"relative grow-1 flex items-center gap-2.5 min-w-0 flex-1"},_hoisted_5$z={class:"flex shrink-0 items-center px-0.5"},_hoisted_6$p={key:0,class:"icon-[comfy--workflow] size-4"},_hoisted_7$m={key:1,class:"icon-[lucide--dollar-sign] size-4"},_hoisted_8$g={class:"flex min-w-0 flex-1 items-center gap-2 text-sm font-bold","data-testid":"node-title"},_hoisted_9$c={class:"truncate min-w-0 flex-1"},_hoisted_10$a={class:"flex shrink-0 items-center justify-between gap-2"},_sfc_main$1N=defineComponent({__name:"NodeHeader",props:{nodeData:{},collapsed:{type:Boolean}},emits:["collapse","update:title","enter-subgraph"],setup(i,{emit:o}){const n=o,s=ref(null),{toastErrorHandler:a}=useErrorHandling();onErrorCaptured(M=>(s.value=M.message,a(M),!1));const r=ref(!1),{getNodeDescription:l,createTooltipConfig:u}=useNodeTooltips(i.nodeData?.type||""),m=computed(()=>{if(r.value)return{value:"",disabled:!0};const M=l.value;return u(M)}),f=computed(()=>u(st("enterSubgraph","Enter Subgraph"))),_=computed(()=>{const M=useColorPaletteStore(),P=useSettingStore().get("Comfy.Node.Opacity")??1;return i.nodeData?.color?{backgroundColor:applyLightThemeColor(i.nodeData.color,!!M.completedActivePalette.light_theme),opacity:P}:{backgroundColor:"",opacity:P}}),y=p(M=>{const P=(M?.title??"").trim();if(P.length>0)return P;const R=(M?.type??"").trim()||"Untitled",V=`nodeDefs.${normalizeI18nKey(R)}.display_name`;return st(V,R)},"resolveTitle"),b=ref(y(i.nodeData)),w=computed(()=>i.nodeData?.mode===LGraphEventMode.BYPASS),k=computed(()=>i.nodeData?.mode===LGraphEventMode.NEVER),S=computed(()=>k.value?{text:"Muted",cssIcon:"icon-[lucide--ban]"}:w.value?{text:"Bypassed",cssIcon:"icon-[lucide--redo-dot]"}:void 0),C=computed(()=>[...i.nodeData?.badges??[]].map(toValue)),I=computed(()=>!!i.nodeData?.flags?.pinned),T=computed(()=>!!i.nodeData?.apiNode),E=computed(()=>{if(!i.nodeData?.id)return!1;const M=app$1.graph?.rootGraph||app$1.graph;if(!M)return!1;const P=getLocatorIdFromNodeData(i.nodeData);return getNodeByLocatorId(M,P)?.isSubgraphNode()??!1});watch(()=>[i.nodeData?.title,i.nodeData?.type],()=>{const M=y(i.nodeData);M!==b.value&&(b.value=M)});const N=p(()=>{n("collapse")},"handleCollapse"),L=p(()=>{r.value=!0},"handleDoubleClick"),A=p(M=>{r.value=!1;const P=M.trim();P&&P!==b.value&&n("update:title",P)},"handleTitleEdit"),D=p(()=>{r.value=!1},"handleTitleCancel"),O=p(()=>{n("enter-subgraph")},"handleEnterSubgraph");return(M,P)=>{const R=__unplugin_components_0$1,V=resolveDirective("tooltip");return s.value?(openBlock(),createElementBlock("div",_hoisted_1$1v,toDisplayString(unref(st)("nodeErrors.header","Node Header Error")),1)):(openBlock(),createElementBlock("div",{key:1,class:normalizeClass(unref(cn)("lg-node-header py-2 pl-2 pr-3 text-sm rounded-t-2xl w-full min-w-0","text-node-component-header bg-node-component-header-surface",M.collapsed&&"rounded-2xl")),style:normalizeStyle(_.value),"data-testid":`node-header-${M.nodeData?.id||""}`,onDblclick:L},[createBaseVNode("div",_hoisted_3$Q,[createBaseVNode("div",_hoisted_4$D,[createBaseVNode("div",_hoisted_5$z,[createVNode(_sfc_main$2B,{size:"fit-content",type:"transparent","data-testid":"node-collapse-button",onClick:withModifiers(N,["stop"]),onDblclick:P[0]||(P[0]=withModifiers(()=>{},["stop"]))},{default:withCtx(()=>[createBaseVNode("i",{class:normalizeClass([unref(cn)("icon-[lucide--chevron-down] size-5 transition-transform",M.collapsed&&"-rotate-90"),"relative top-px text-xs leading-none text-node-component-header-icon"])},null,2)]),_:1})]),E.value?(openBlock(),createElementBlock("div",_hoisted_6$p)):createCommentVNode("",!0),T.value?(openBlock(),createElementBlock("div",_hoisted_7$m)):createCommentVNode("",!0),withDirectives((openBlock(),createElementBlock("div",_hoisted_8$g,[createBaseVNode("div",_hoisted_9$c,[createVNode(EditableText,{"model-value":b.value,"is-editing":r.value,"input-attrs":{"data-testid":"node-title-input"},onEdit:A,onCancel:D},null,8,["model-value","is-editing"])])])),[[V,m.value,void 0,{top:!0}]])]),createBaseVNode("div",_hoisted_10$a,[(openBlock(!0),createElementBlock(Fragment,null,renderList(C.value,$=>(openBlock(),createBlock(_sfc_main$1O,mergeProps({key:$.text,ref_for:!0},$),null,16))),128)),S.value?(openBlock(),createBlock(_sfc_main$1O,normalizeProps(mergeProps({key:0},S.value)),null,16)):createCommentVNode("",!0),I.value?(openBlock(),createBlock(R,{key:1,class:"size-5","data-testid":"node-pin-indicator"})):createCommentVNode("",!0),E.value?withDirectives((openBlock(),createBlock(_sfc_main$2B,{key:2,type:"transparent","data-testid":"subgraph-enter-button",class:"size-5",onClick:withModifiers(O,["stop"]),onDblclick:P[1]||(P[1]=withModifiers(()=>{},["stop"]))},{default:withCtx(()=>P[2]||(P[2]=[createBaseVNode("i",{class:"icon-[lucide--picture-in-picture] size-5 text-node-component-header-icon"},null,-1)])),_:1})),[[V,f.value,void 0,{top:!0}]]):createCommentVNode("",!0)])])],46,_hoisted_2$1b))}}});function coerceINodeSlot(i){return isSlotObject(i)?i:{name:typeof i=="string"?i:"",type:"any",boundingRect:[0,0,0,0]}}p(coerceINodeSlot,"coerceINodeSlot");function inputHasWidget(i){return isSlotObject(i)&&"widget"in i&&i.widget}p(inputHasWidget,"inputHasWidget");function nonWidgetedInputs(i){return i?.inputs?i.inputs.filter(o=>!inputHasWidget(o)).map(coerceINodeSlot):[]}p(nonWidgetedInputs,"nonWidgetedInputs");function linkedWidgetedInputs(i){return i?.inputs?i.inputs.filter(o=>inputHasWidget(o)&&!!o.link).map(coerceINodeSlot):[]}p(linkedWidgetedInputs,"linkedWidgetedInputs");function getSlotColor(i){return i?`var(--color-datatype-${String(i).toUpperCase()})`:"#AAA"}p(getSlotColor,"getSlotColor");const state=reactive({active:!1,pointerId:null,source:null,pointer:{client:{x:0,y:0},canvas:{x:0,y:0}},candidate:null,compatible:new Map});function updatePointerPosition(i,o,n,s){state.pointer.client.x=i,state.pointer.client.y=o,state.pointer.canvas.x=n,state.pointer.canvas.y=s}p(updatePointerPosition,"updatePointerPosition");function setCandidate(i){state.candidate=i}p(setCandidate,"setCandidate");function beginDrag(i,o){state.active=!0,state.source=i,state.pointerId=o,state.candidate=null,state.compatible.clear()}p(beginDrag,"beginDrag");function endDrag(){state.active=!1,state.pointerId=null,state.source=null,state.pointer.client.x=0,state.pointer.client.y=0,state.pointer.canvas.x=0,state.pointer.canvas.y=0,state.candidate=null,state.compatible.clear()}p(endDrag,"endDrag");function getSlotLayout(i,o,n){const s=getSlotKey(i,o,n);return layoutStore.getSlotLayout(s)}p(getSlotLayout,"getSlotLayout");function useSlotLinkDragUIState(){return{state:readonly(state),beginDrag,endDrag,updatePointerPosition,setCandidate,getSlotLayout,setCompatibleMap:p(i=>{state.compatible.clear();for(const[o,n]of i)state.compatible.set(o,n)},"setCompatibleMap"),setCompatibleForKey:p((i,o)=>{state.compatible.set(i,o)},"setCompatibleForKey"),clearCompatible:p(()=>state.compatible.clear(),"clearCompatible")}}p(useSlotLinkDragUIState,"useSlotLinkDragUIState");const useNodeSlotRegistryStore=defineStore("nodeSlotRegistry",()=>{const i=markRaw(new Map);function o(r){return i.get(r)}p(o,"getNode");function n(r){let l=i.get(r);return l||(l={nodeId:r,slots:markRaw(new Map)},i.set(r,l)),l}p(n,"ensureNode");function s(r){i.delete(r)}p(s,"deleteNode");function a(){i.clear()}return p(a,"clear"),{getNode:o,ensureNode:n,deleteNode:s,clear:a}});function createRafBatch(i){let o=null;return{schedule:p(()=>{o==null&&(o=requestAnimationFrame(()=>{o=null,i()}))},"schedule"),cancel:p(()=>{o!=null&&(cancelAnimationFrame(o),o=null)},"cancel"),flush:p(()=>{o!=null&&(cancelAnimationFrame(o),o=null,i())},"flush"),isScheduled:p(()=>o!=null,"isScheduled")}}p(createRafBatch,"createRafBatch");const pendingNodes=new Set,raf=createRafBatch(()=>{flushScheduledSlotLayoutSync()});function scheduleSlotLayoutSync(i){pendingNodes.add(i),raf.schedule()}p(scheduleSlotLayoutSync,"scheduleSlotLayoutSync");function flushScheduledSlotLayoutSync(){if(pendingNodes.size===0)return;const i=useSharedCanvasPositionConversion();for(const o of Array.from(pendingNodes))pendingNodes.delete(o),syncNodeSlotLayoutsFromDOM(o,i)}p(flushScheduledSlotLayoutSync,"flushScheduledSlotLayoutSync");function syncNodeSlotLayoutsFromDOM(i,o){const s=useNodeSlotRegistryStore().getNode(i);if(!s)return;const a=layoutStore.getNodeLayoutRef(i).value;if(!a)return;const r=[];for(const[l,u]of s.slots){const m=u.el.getBoundingClientRect(),f=[m.left+m.width/2,m.top+m.height/2],[_,y]=(o??useSharedCanvasPositionConversion()).clientPosToCanvasPos(f),b={x:_,y};u.cachedOffset={x:b.x-a.position.x,y:b.y-a.position.y};const w=LiteGraph.NODE_SLOT_HEIGHT,k=w/2;r.push({key:l,layout:{nodeId:i,index:u.index,type:u.type,position:{x:b.x,y:b.y},bounds:{x:b.x-k,y:b.y-k,width:w,height:w}}})}r.length&&layoutStore.batchUpdateSlotLayouts(r)}p(syncNodeSlotLayoutsFromDOM,"syncNodeSlotLayoutsFromDOM");function updateNodeSlotsFromCache(i){const n=useNodeSlotRegistryStore().getNode(i);if(!n)return;const s=layoutStore.getNodeLayoutRef(i).value;if(!s)return;const a=[];for(const[r,l]of n.slots){if(!l.cachedOffset){scheduleSlotLayoutSync(i);continue}const u={x:s.position.x+l.cachedOffset.x,y:s.position.y+l.cachedOffset.y},m=LiteGraph.NODE_SLOT_HEIGHT,f=m/2;a.push({key:r,layout:{nodeId:i,index:l.index,type:l.type,position:{x:u.x,y:u.y},bounds:{x:u.x-f,y:u.y-f,width:m,height:m}}})}a.length&&layoutStore.batchUpdateSlotLayouts(a)}p(updateNodeSlotsFromCache,"updateNodeSlotsFromCache");function useSlotElementTracking(i){const{nodeId:o,index:n,type:s,element:a}=i,r=useNodeSlotRegistryStore();return onMounted(()=>{if(!o)return;const l=watch(a,u=>{if(!u)return;const m=r.ensureNode(o);if(!m.stopWatch){const _=layoutStore.getNodeLayoutRef(o),y=watch(()=>_.value?.position,(w,k)=>{w&&(!k||!isPointEqual(w,k))&&updateNodeSlotsFromCache(o)}),b=watch(()=>_.value?.size,(w,k)=>{w&&(!k||!isSizeEqual(w,k))&&scheduleSlotLayoutSync(o)});m.stopWatch=()=>{y(),b()}}const f=getSlotKey(o,n,s==="input");u.dataset.slotKey=f,m.slots.set(f,{el:u,index:n,type:s}),scheduleSlotLayoutSync(o),l()},{immediate:!0,flush:"post"})}),onUnmounted(()=>{if(!o)return;const l=r.getNode(o);if(!l)return;const u=getSlotKey(o,n,s==="input"),m=l.slots.get(u);m&&(delete m.el.dataset.slotKey,l.slots.delete(u)),layoutStore.deleteSlotLayout(u),l.slots.size===0&&(l.stopWatch&&l.stopWatch(),r.deleteNode(o))}),{requestSlotLayoutSync:p(()=>scheduleSlotLayoutSync(o),"requestSlotLayoutSync")}}p(useSlotElementTracking,"useSlotElementTracking");const pointerHistory=new Map,defineEnhancements=p((i,o)=>{Object.defineProperties(i,{canvasX:{value:o.canvasX,configurable:!0,writable:!0},canvasY:{value:o.canvasY,configurable:!0,writable:!0},deltaX:{value:o.deltaX,configurable:!0,writable:!0},deltaY:{value:o.deltaY,configurable:!0,writable:!0},safeOffsetX:{value:o.safeOffsetX,configurable:!0,writable:!0},safeOffsetY:{value:o.safeOffsetY,configurable:!0,writable:!0}})},"defineEnhancements"),createEnhancement=p(i=>{const o=useSharedCanvasPositionConversion();o.update();const[n,s]=o.clientPosToCanvasPos([i.clientX,i.clientY]),a=useCanvasStore().getCanvas(),{offset:r,scale:l}=a.ds,[u,m]=o.canvasPosToClientPos([0,0]),f=u-r[0]*l,_=m-r[1]*l,y=i.clientX-f,b=i.clientY-_,w=pointerHistory.get(i.pointerId),k=w?y-w.x:0,S=w?b-w.y:0;return pointerHistory.set(i.pointerId,{x:y,y:b}),{canvasX:n,canvasY:s,deltaX:k,deltaY:S,safeOffsetX:y,safeOffsetY:b}},"createEnhancement"),toCanvasPointerEvent=p(i=>{const o=createEnhancement(i);return defineEnhancements(i,o),i},"toCanvasPointerEvent"),clearCanvasPointerHistory=p(i=>{pointerHistory.delete(i)},"clearCanvasPointerHistory"),adapterByGraph=new WeakMap;class LinkConnectorAdapter{static{p(this,"LinkConnectorAdapter")}constructor(o,n){this.network=o,this.linkConnector=n}get renderLinks(){return this.linkConnector.renderLinks}beginFromOutput(o,n,s){const a=this.network.getNodeById(o),r=a?.outputs?.[n];if(!a||!r)return;const l=this.network.getReroute(s?.fromRerouteId);s?.moveExisting?this.linkConnector.moveOutputLink(this.network,r):this.linkConnector.dragNewFromOutput(this.network,a,r,l)}beginFromInput(o,n,s){const a=this.network.getNodeById(o),r=a?.inputs?.[n];if(!a||!r)return;const l=this.network.getReroute(s?.fromRerouteId);s?.moveExisting?this.linkConnector.moveInputLink(this.network,r):this.linkConnector.dragNewFromInput(this.network,a,r,l)}isNodeValidDrop(o){const n=this.network.getNodeById(o);return n?this.linkConnector.isNodeValidDrop(n):!1}isInputValidDrop(o,n){const s=this.network.getNodeById(o),a=s?.inputs?.[n];return!s||!a?!1:this.linkConnector.isInputValidDrop(s,a)}isOutputValidDrop(o,n){const s=this.network.getNodeById(o),a=s?.outputs?.[n];return!s||!a?!1:this.linkConnector.renderLinks.some(r=>r.canConnectToOutput(s,a))}isRerouteValidDrop(o){const n=this.network.getReroute(o);return n?this.linkConnector.isRerouteValidDrop(n):!1}disconnectMovingLinks(){this.linkConnector.disconnectLinks()}dropOnCanvas(o){if(isSubgraph(this.network)){const{canvasX:n,canvasY:s}=o,a=this.network.getIoNodeOnPos?.(n,s);if(a){this.linkConnector.dropOnIoNode(a,o);return}}this.linkConnector.dropOnNothing(o)}reset(){this.linkConnector.reset()}}function createLinkConnectorAdapter(){const i=app$1.canvas?.graph,o=app$1.canvas?.linkConnector;if(!i||!o)return null;const n=adapterByGraph.get(i);if(n&&n.linkConnector===o)return n;const s=new LinkConnectorAdapter(i,o);return adapterByGraph.set(i,s),s}p(createLinkConnectorAdapter,"createLinkConnectorAdapter");const resolveSlotTargetCandidate=p((i,{adapter:o,graph:n})=>{const{state:s,setCompatibleForKey:a}=useSlotLinkDragUIState();if(!(i instanceof HTMLElement))return null;const l=i.closest(".lg-slot, .lg-node-widget")?.querySelector("[data-slot-key]")?.dataset.slotKey;if(!l)return null;const u=layoutStore.getSlotLayout(l);if(!u)return null;const m={layout:u,compatible:!1};if(o&&n){const f=s.compatible.get(l);if(f!=null)m.compatible=f;else{const _=u.nodeId,y=u.type==="input"?o.isInputValidDrop(_,u.index):o.isOutputValidDrop(_,u.index);a(l,y),m.compatible=y}}return m},"resolveSlotTargetCandidate"),resolveNodeSurfaceSlotCandidate=p((i,{adapter:o,graph:n,session:s})=>{const{setCompatibleForKey:a}=useSlotLinkDragUIState();if(!(i instanceof HTMLElement))return null;const l=i.closest("[data-node-id]")?.dataset.nodeId;if(!l||!o||!n)return null;const u=l,m=s.preferredSlotForNode.get(u);if(m!==void 0)return m?{layout:m.layout,compatible:!0}:null;const f=n.getNodeById(u);if(!f)return null;const _=o.renderLinks[0];if(!_)return null;const y=o.linkConnector.state.connectingTo;if(y!=="input"&&y!=="output")return null;const b=y==="input",w=_.fromSlot.type,S=(b?f.findInputByType(w):f.findOutputByType(w))?.index;if(S==null)return s.preferredSlotForNode.set(u,null),null;const C=getSlotKey(String(u),S,b),I=layoutStore.getSlotLayout(C);if(!I)return s.preferredSlotForNode.set(u,null),null;const T=b?o.isInputValidDrop(u,S):o.isOutputValidDrop(u,S);if(a(C,T),!T)return s.preferredSlotForNode.set(u,null),null;const E={index:S,key:C,layout:I};return s.preferredSlotForNode.set(u,E),{layout:I,compatible:!0}},"resolveNodeSurfaceSlotCandidate");function createSlotLinkDragContext(){const i={preferredSlotForNode:new Map,lastHoverSlotKey:null,lastHoverNodeId:null,lastCandidateKey:null,pendingPointerMove:null,lastPointerEventTarget:null,lastPointerTargetSlotKey:null,lastPointerTargetNodeId:null,reset:p(()=>{i.preferredSlotForNode=new Map,i.lastHoverSlotKey=null,i.lastHoverNodeId=null,i.lastCandidateKey=null,i.pendingPointerMove=null,i.lastPointerEventTarget=null,i.lastPointerTargetSlotKey=null,i.lastPointerTargetNodeId=null},"reset"),dispose:p(()=>{i.reset()},"dispose")};return i}p(createSlotLinkDragContext,"createSlotLinkDragContext");function createPointerSession(){let i=null,o=[];return{begin:p(u=>{i=u},"begin"),register:p((...u)=>{for(const m of u)typeof m=="function"&&o.push(m)},"register"),matches:p(u=>i!==null&&u.pointerId===i,"matches"),isActive:p(()=>i!==null,"isActive"),clear:p(()=>{for(const u of o)u();o=[],i=null},"clear")}}p(createPointerSession,"createPointerSession");function useSlotLinkInteraction({nodeId:i,index:o,type:n}){const{state:s,beginDrag:a,endDrag:r,updatePointerPosition:l,setCandidate:u,setCompatibleForKey:m,clearCompatible:f}=useSlotLinkDragUIState(),_=useSharedCanvasPositionConversion(),y=createPointerSession();let b=null;const w=createSlotLinkDragContext(),k=p(W=>{if(W.fromReroute){const q=layoutStore.getRerouteLayout(W.fromReroute.id);if(q)return q.position;const[ee,Y]=W.fromReroute.pos;return toPoint(ee,Y)}const X=W.node.id;if(X!=null){const q=W.toType==="output",ee=getSlotKey(String(X),W.fromSlotIndex,q),Y=layoutStore.getSlotLayout(ee);if(Y)return Y.position}const Q=W.fromPos;return toPoint(Q[0],Q[1])},"resolveRenderLinkSource"),S=p(()=>{if(b)for(const W of b.renderLinks){const X=k(W);if(!X)continue;const Q=X.x,q=X.y;(W.fromPos[0]!==Q||W.fromPos[1]!==q)&&(W.fromPos[0]=Q,W.fromPos[1]=q)}},"syncRenderLinkOrigins");function C(W){return"canConnectToReroute"in W}p(C,"hasCanConnectToReroute");const I=p(W=>W.toType==="input","isToInputLink"),T=p(W=>W.toType==="output","isToOutputLink");function E(W,X,Q){const q=W.filter(I).filter(ee=>ee.canConnectToInput(X,Q));for(const ee of q)ee.connectToInput(X,Q,b?.linkConnector.events);return q.length>0}p(E,"connectLinksToInput");function N(W,X,Q){const q=W.filter(T).filter(ee=>ee.canConnectToOutput(X,Q));for(const ee of q)ee.connectToOutput(X,Q,b?.linkConnector.events);return q.length>0}p(N,"connectLinksToOutput");const L=p(W=>{if(!W)return null;const X=getSlotKey(String(W.origin_id),W.origin_slot,!1),Q=layoutStore.getSlotLayout(X);return Q?{position:{...Q.position},direction:LinkDirection.NONE}:null},"resolveLinkOrigin"),A=p((W,X)=>{if(!X)return null;const Q=W.getLink(X.link);if(Q){const ae=LLink.getReroutes(W,Q).at(-1);if(ae){const ue=layoutStore.getRerouteLayout(ae.id);if(ue)return{position:{...ue.position},direction:LinkDirection.NONE};const K=ae.pos;if(K)return{position:toPoint(K[0],K[1]),direction:LinkDirection.NONE}}const re=L(Q);if(re)return re}const q=X._floatingLinks?.values(),ee=q?q.next().value:void 0;if(!ee)return null;if(ee.parentId!=null){const Y=layoutStore.getRerouteLayout(ee.parentId);if(Y)return{position:{...Y.position},direction:LinkDirection.NONE};const ae=W.getReroute(ee.parentId);if(ae)return{position:toPoint(ae.pos[0],ae.pos[1]),direction:LinkDirection.NONE}}return null},"resolveExistingInputLinkAnchor"),D=p(()=>{s.pointerId!=null&&clearCanvasPointerHistory(s.pointerId),b?.reset(),y.clear(),r(),b=null,P.cancel(),w.dispose(),f()},"cleanupInteraction"),O=p(W=>{const X=W.clientX,Q=W.clientY,[q,ee]=_.clientPosToCanvasPos([X,Q]);l(X,Q,q,ee)},"updatePointerState"),P=createRafBatch(p(()=>{const W=w.pendingPointerMove;if(!W)return;w.pendingPointerMove=null;const[X,Q]=_.clientPosToCanvasPos([W.clientX,W.clientY]);l(W.clientX,W.clientY,X,Q),S();let q=null,ee=null;const Y=W.target;if(Y===w.lastPointerEventTarget)q=w.lastPointerTargetSlotKey,ee=w.lastPointerTargetNodeId;else if(Y instanceof HTMLElement){const _e=Y.closest(".lg-slot, .lg-node-widget")?.querySelector("[data-slot-key]"),oe=Y.closest("[data-node-id]");q=_e?.dataset.slotKey??null,ee=oe?.dataset.nodeId??null,w.lastPointerEventTarget=Y,w.lastPointerTargetSlotKey=q,w.lastPointerTargetNodeId=ee}const ae=q!==w.lastHoverSlotKey||ee!==w.lastHoverNodeId;let re=s.candidate;if(ae){const _e=b,oe=app$1.canvas?.graph??null,se={adapter:_e,graph:oe,session:w},he=resolveSlotTargetCandidate(Y,se),be=resolveNodeSurfaceSlotCandidate(Y,se);if(re=he?.compatible?he:be,w.lastHoverSlotKey=q,w.lastHoverNodeId=ee,he){const Se=getSlotKey(he.layout.nodeId,he.layout.index,he.layout.type==="input");m(Se,!!he.compatible)}if(be&&!he?.compatible){const Se=getSlotKey(be.layout.nodeId,be.layout.index,be.layout.type==="input");m(Se,!!be.compatible)}}const ue=re?.compatible?re:null,K=ue?getSlotKey(ue.layout.nodeId,ue.layout.index,ue.layout.type==="input"):null,ne=K!==w.lastCandidateKey;ne&&(u(ue),w.lastCandidateKey=K);let de=!1;if(b){const _e=ue?ue.layout.position.x:s.pointer.canvas.x,oe=ue?ue.layout.position.y:s.pointer.canvas.y,se=b.linkConnector.state.snapLinksPos;de=!se||se[0]!==_e||se[1]!==oe,de&&(b.linkConnector.state.snapLinksPos=[_e,oe])}(ne||de)&&app$1.canvas?.setDirty(!0,!0)},"processPointerMoveFrame")),R=p(W=>{y.matches(W)&&(W.stopPropagation(),w.pendingPointerMove={clientX:W.clientX,clientY:W.clientY,target:W.target},P.schedule())},"handlePointerMove"),V=p(W=>{if(!W?.compatible)return!1;const X=app$1.canvas?.graph,Q=b;if(!X||!Q)return!1;const q=W.layout.nodeId,ee=X.getNodeById(q);if(!ee)return!1;if(W.layout.type==="input"){const Y=ee.inputs?.[W.layout.index];return!!Y&&E(Q.renderLinks,ee,Y)}if(W.layout.type==="output"){const Y=ee.outputs?.[W.layout.index];return!!Y&&N(Q.renderLinks,ee,Y)}return!1},"tryConnectToCandidate"),$=p(()=>{const W=layoutStore.queryRerouteAtPoint({x:s.pointer.canvas.x,y:s.pointer.canvas.y}),X=app$1.canvas?.graph,Q=b;if(!W||!X||!Q)return!1;const q=X.getReroute(W.id);if(!q||!Q.isRerouteValidDrop(q.id))return!1;let ee=!1;const Y=q.findTargetInputs()??[],ae=q.getReroutes();if(Y.length&&ae!==null){const ue=ae.slice(0,-1).reverse();for(const K of Q.renderLinks)if(I(K))for(const ne of Y)K.connectToRerouteInput(q,ne,Q.linkConnector.events,ue),ee=!0}const re=q.findSourceOutput();if(re){const{node:ue,output:K}=re;for(const ne of Q.renderLinks)T(ne)&&(C(ne)&&!ne.canConnectToReroute(q)||(ne.connectToRerouteOutput(q,ue,K,Q.linkConnector.events),ee=!0))}return ee},"tryConnectViaRerouteAtPointer"),F=p(W=>{if(!y.matches(W))return;const X=toCanvasPointerEvent(W);if(X.preventDefault(),P.flush(),P.flush(),!s.source){D(),app$1.canvas?.setDirty(!0,!0);return}const Q=s.candidate?.compatible?s.candidate:null;G(X.target,Q)||b?.dropOnCanvas(X),D(),app$1.canvas?.setDirty(!0,!0)},"finishInteraction"),j=p(W=>{W.stopPropagation(),F(W)},"handlePointerUp"),U=p(W=>{y.matches(W)&&(P.flush(),toCanvasPointerEvent(W),D(),app$1.canvas?.setDirty(!0,!0))},"handlePointerCancel");function G(W,X){const Q=b,q=app$1.canvas?.graph??null,ee={adapter:Q,graph:q,session:w},Y=p(()=>V(X),"attemptSnapped"),ae=resolveSlotTargetCandidate(W,ee),re=p(()=>V(ae),"attemptDomSlot"),ue=resolveNodeSurfaceSlotCandidate(W,ee),K=p(()=>V(ue),"attemptNodeSurface"),ne=p(()=>$(),"attemptReroute");return!!(Y()||re()||K()||ne())}p(G,"connectByPriority");const H=p(W=>{if(W.button!==0||!i||y.isActive())return;W.preventDefault(),W.stopPropagation();const X=app$1.canvas,Q=X?.graph;if(!X||!Q||(b=createLinkConnectorAdapter(),!b))return;P.cancel(),w.reset();const q=layoutStore.getSlotLayout(getSlotKey(i,o,n==="input"));if(!q)return;const ee=i,Y=n==="input",ae=n==="output",re=Q.getNodeById(ee),ue=Y?re?.inputs?.[o]:void 0,K=ae?re?.outputs?.[o]:void 0,ne=W.ctrlKey||W.metaKey,de=ue?.link??null,ve=ue?._floatingLinks?.size??0,_e=de!=null||ve>0,oe=K?.links?.length??0,se=K?._floatingLinks?.size??0,he=oe>0||se>0,be=Y&&_e&&ne&&W.altKey&&!W.shiftKey,Se=ae&&he&&ne&&W.altKey&&!W.shiftKey,me=Y&&de!=null?Q.getLink(de):void 0;if(be&&re&&re.disconnectInput(o,!0),Se&&re){re.disconnectOutput(o),X.setDirty(!0,!0),W.preventDefault(),W.stopPropagation();return}const fe=Y?ue?.dir??LinkDirection.LEFT:K?.dir??LinkDirection.RIGHT,Z=Y&&!be?A(Q,ue):null,J=ae&&W.shiftKey&&he,le=Y&&!be&&_e;ae?b.beginFromOutput(ee,o,{moveExisting:J}):b.beginFromInput(ee,o,{moveExisting:le}),le&&me&&(me._dragging=!0),S();const ce=Z?.direction??fe,ke=Z?.position??{x:q.position.x,y:q.position.y};a({nodeId:i,slotIndex:o,type:n,direction:ce,position:ke,linkId:be?void 0:me?.id,movingExistingOutput:J},W.pointerId),y.begin(W.pointerId),toCanvasPointerEvent(W),O(W),b.linkConnector.state.snapLinksPos=[s.pointer.canvas.x,s.pointer.canvas.y],y.register(useEventListener("pointermove",R,{capture:!0}),useEventListener("pointerup",j,{capture:!0}),useEventListener("pointercancel",U,{capture:!0}));const ye=n==="input"?"output":"input",ie=layoutStore.getAllSlotKeys();f();for(const pe of ie){const ge=layoutStore.getSlotLayout(pe);if(!ge||ge.type!==ye)continue;const Ce=ge.index,we=ye==="input"?b.isInputValidDrop(ge.nodeId,Ce):b.isOutputValidDrop(ge.nodeId,Ce);m(pe,we)}X.setDirty(!0,!0)},"onPointerDown");return tryOnScopeDispose(()=>{y.isActive()&&D()}),{onPointerDown:H}}p(useSlotLinkInteraction,"useSlotLinkInteraction");const _sfc_main$1M=defineComponent({__name:"SlotConnectionDot",props:{color:{},multi:{type:Boolean},class:{type:[Array,Object,String,Number,null,Boolean]}},setup(i,{expose:o}){const n=i,s=useTemplateRef("slot-el");return o({slotElRef:s}),(a,r)=>(openBlock(),createElementBlock("div",{class:normalizeClass(unref(cn)("size-6 flex items-center justify-center group/slot",n.class))},[createBaseVNode("div",{ref:"slot-el",class:normalizeClass(["slot-dot",unref(cn)("bg-slate-300 rounded-full","transition-all duration-150","border border-solid border-node-component-slot-dot-outline",!a.multi&&"cursor-crosshair group-hover/slot:[--node-component-slot-dot-outline-opacity-mult:5] group-hover/slot:scale-125",a.multi?"w-3 h-6":"size-3")]),style:normalizeStyle({backgroundColor:a.color})},null,6)],2))}}),_hoisted_1$1u={key:0,class:"node-error p-1 text-xs text-red-500"},_hoisted_2$1a={class:"h-full flex items-center min-w-0"},_sfc_main$1L=defineComponent({__name:"InputSlot",props:{nodeType:{},nodeId:{},slotData:{},index:{},connected:{type:Boolean},compatible:{type:Boolean},dotOnly:{type:Boolean},socketless:{type:Boolean}},setup(i){const o=i,n=useExecutionStore(),s=computed(()=>{const E=n.lastNodeErrors?.[o.nodeId??""];if(!E)return!1;const N=o.slotData.name;return E.errors.some(L=>L.extra_info?.input_name===N)}),a=computed(()=>s.value?"ring-2 ring-error ring-offset-0 rounded-full":""),r=computed(()=>s.value?"text-error font-medium":"text-node-component-slot-text"),l=ref(null),{toastErrorHandler:u}=useErrorHandling(),{getInputSlotTooltip:m,createTooltipConfig:f}=useNodeTooltips(o.nodeType||""),_=computed(()=>{const E=o.slotData.localized_name||o.slotData.name||"",L=m(E)||`Input: ${E}`;return f(L)});onErrorCaptured(E=>(l.value=E.message,u(E),!1));const y=computed(()=>s.value?"var(--color-error)":getSlotColor(o.slotData.type)),{state:b}=useSlotLinkDragUIState(),w=computed(()=>getSlotKey(o.nodeId??"",o.index,!0)),k=computed(()=>b.active?!b.compatible.get(w.value):!1),S=computed(()=>cn("lg-slot lg-slot--input flex items-center group rounded-r-lg h-6","cursor-crosshair",o.dotOnly?"lg-slot--dot-only":"pr-6",{"lg-slot--connected":o.connected,"lg-slot--compatible":o.compatible,"opacity-40":k.value},o.socketless&&"pointer-events-none invisible")),C=ref(null),I=ref(null);watchEffect(()=>{const E=C.value?.slotElRef;I.value=E||null}),useSlotElementTracking({nodeId:o.nodeId??"",index:o.index,type:"input",element:I});const{onPointerDown:T}=useSlotLinkInteraction({nodeId:o.nodeId??"",index:o.index,type:"input"});return(E,N)=>{const L=resolveDirective("tooltip");return l.value?(openBlock(),createElementBlock("div",_hoisted_1$1u,"âš ï¸")):withDirectives((openBlock(),createElementBlock("div",{key:1,class:normalizeClass(S.value)},[createVNode(_sfc_main$1M,{ref_key:"connectionDotRef",ref:C,color:y.value,class:normalizeClass(unref(cn)("-translate-x-1/2 w-3",a.value)),onPointerdown:unref(T)},null,8,["color","class","onPointerdown"]),createBaseVNode("div",_hoisted_2$1a,[E.dotOnly?createCommentVNode("",!0):(openBlock(),createElementBlock("span",{key:0,class:normalizeClass(unref(cn)("truncate text-xs font-normal",r.value))},toDisplayString(E.slotData.localized_name||E.slotData.name||`Input ${E.index}`),3))])],2)),[[L,_.value,void 0,{left:!0}]])}}}),_hoisted_1$1t={key:0,class:"node-error p-1 text-xs text-red-500"},_hoisted_2$19={class:"relative h-full flex items-center min-w-0"},_hoisted_3$P={key:0,class:"text-xs font-normal truncate text-node-component-slot-text"},_sfc_main$1K=defineComponent({__name:"OutputSlot",props:{nodeType:{},nodeId:{},slotData:{},index:{},connected:{type:Boolean},compatible:{type:Boolean},dotOnly:{type:Boolean}},setup(i){const o=i,n=ref(null),{toastErrorHandler:s}=useErrorHandling(),{getOutputSlotTooltip:a,createTooltipConfig:r}=useNodeTooltips(o.nodeType||""),l=computed(()=>{const S=o.slotData.name||"",I=a(o.index)||`Output: ${S}`;return r(I)});onErrorCaptured(S=>(n.value=S.message,s(S),!1));const u=computed(()=>getSlotColor(o.slotData.type)),{state:m}=useSlotLinkDragUIState(),f=computed(()=>getSlotKey(o.nodeId??"",o.index,!1)),_=computed(()=>m.active?!m.compatible.get(f.value):!1),y=computed(()=>cn("lg-slot lg-slot--output flex items-center justify-end group rounded-l-lg h-6","cursor-crosshair",o.dotOnly?"lg-slot--dot-only justify-center":"pl-6",{"lg-slot--connected":o.connected,"lg-slot--compatible":o.compatible,"opacity-40":_.value})),b=ref(null),w=ref(null);watchEffect(()=>{const S=b.value?.slotElRef;w.value=S||null}),useSlotElementTracking({nodeId:o.nodeId??"",index:o.index,type:"output",element:w});const{onPointerDown:k}=useSlotLinkInteraction({nodeId:o.nodeId??"",index:o.index,type:"output"});return(S,C)=>{const I=resolveDirective("tooltip");return n.value?(openBlock(),createElementBlock("div",_hoisted_1$1t,"âš ï¸")):withDirectives((openBlock(),createElementBlock("div",{key:1,class:normalizeClass(y.value)},[createBaseVNode("div",_hoisted_2$19,[S.dotOnly?createCommentVNode("",!0):(openBlock(),createElementBlock("span",_hoisted_3$P,toDisplayString(S.slotData.localized_name||S.slotData.name||`Output ${S.index}`),1))]),createVNode(_sfc_main$1M,{ref_key:"connectionDotRef",ref:b,color:u.value,class:"w-3 translate-x-1/2",onPointerdown:unref(k)},null,8,["color","onPointerdown"])],2)),[[I,l.value,void 0,{right:!0}]])}}}),_hoisted_1$1s={key:0,class:"node-error p-2 text-sm text-red-500"},_sfc_main$1J=defineComponent({__name:"NodeSlots",props:{nodeData:{},unified:{type:Boolean,default:!1}},setup(i){const o=computed(()=>i.unified?linkedWidgetedInputs(i.nodeData):[]),n=computed(()=>[...nonWidgetedInputs(i.nodeData),...o.value]),s=computed(()=>cn(i.unified&&"absolute inset-0 items-center pointer-events-none opacity-0 z-30")),a=computed(()=>cn(i.unified&&"grid grid-cols-1 grid-rows-1 gap-0 [&>*]:row-span-full [&>*]:col-span-full place-items-center")),r=p((m,f)=>{if(!i.nodeData?.inputs)return f;const _=i.nodeData.inputs.findIndex(y=>y===m);return _!==-1?_:f},"getActualInputIndex"),l=ref(null),{toastErrorHandler:u}=useErrorHandling();return onErrorCaptured(m=>(l.value=m.message,u(m),!1)),(m,f)=>l.value?(openBlock(),createElementBlock("div",_hoisted_1$1s,toDisplayString(unref(st)("nodeErrors.slots","Node Slots Error")),1)):(openBlock(),createElementBlock("div",{key:1,class:normalizeClass(unref(cn)("flex justify-between min-w-0",s.value))},[n.value.length?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(unref(cn)("flex flex-col min-w-0",a.value))},[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,(_,y)=>(openBlock(),createBlock(_sfc_main$1L,{key:`input-${y}`,"slot-data":_,"node-type":m.nodeData?.type||"","node-id":m.nodeData?.id!=null?String(m.nodeData.id):"",index:r(_,y)},null,8,["slot-data","node-type","node-id","index"]))),128))],2)):createCommentVNode("",!0),m.nodeData?.outputs?.length?(openBlock(),createElementBlock("div",{key:1,class:normalizeClass(unref(cn)("ml-auto flex flex-col min-w-0",a.value))},[(openBlock(!0),createElementBlock(Fragment,null,renderList(m.nodeData.outputs,(_,y)=>(openBlock(),createBlock(_sfc_main$1K,{key:`output-${y}`,"slot-data":_,"node-type":m.nodeData?.type||"","node-id":m.nodeData?.id!=null?String(m.nodeData.id):"",index:y},null,8,["slot-data","node-type","node-id","index"]))),128))],2)):createCommentVNode("",!0)],2))}}),_sfc_main$1I=defineComponent({__name:"WidgetDOM",props:{widget:{},nodeId:{},readonly:{type:Boolean}},setup(i){const o=i,n=ref(),{canvas:s}=useCanvasStore();return onMounted(()=>{if(!n.value)return;const a=s?.graph?.getNodeById(o.nodeId)??void 0;if(!a)return;const r=a.widgets?.find(l=>l.name===o.widget.name);!r||!isDOMWidget(r)||n.value.replaceChildren(r.element)}),(a,r)=>(openBlock(),createElementBlock("div",{ref_key:"domEl",ref:n},null,512))}}),_hoisted_1$1r={class:"relative mx-[-12px] min-w-0 basis-0"},scaleFactor=2,_sfc_main$1H=defineComponent({__name:"WidgetLegacy",props:{widget:{},readonly:{type:Boolean}},setup(i){const o=i,n=ref(),s=useCanvasStore().canvas;let a,r,l;onMounted(()=>{a=s?.graph?.getNodeById(n.value.parentElement.attributes["node-id"].value)??void 0,a&&(r=a.widgets?.find(b=>b.name===o.widget.name),r&&(n.value.width*=scaleFactor,r.triggerDraw||(r.callback=useChainCallback(r.callback,function(){this?.triggerDraw?.()})),r.triggerDraw=u,useResizeObserver(n.value.parentElement,u),watch(()=>useColorPaletteStore().activePaletteId,u),l=new CanvasPointer(n.value)))}),onBeforeUnmount(()=>{r&&(r.triggerDraw=()=>{})});function u(){if(!r||!a)return;const b=n.value.parentElement.clientWidth,w=r.computeSize?r.computeSize(b)[1]:20;r.y=0,n.value.height=(w+2)*scaleFactor,n.value.width=b*scaleFactor;const k=n.value?.getContext("2d");k&&(k.scale(scaleFactor,scaleFactor),r.draw?.(k,a,b,1,w))}p(u,"draw");function m(b){a&&(s.adjustMouseEvent(b),s.graph_mouse[0]=b.offsetX+a.pos[0],s.graph_mouse[1]=b.offsetY+a.pos[1])}p(m,"translateEvent");function f(b){!a||!r||!l||(m(b),l.down(b),r.mouse&&(l.onDrag=w=>r.mouse?.(w,[w.offsetX,w.offsetY],a)),s.processWidgetClick(b,a,r,l))}p(f,"handleDown");function _(b){l&&(m(b),b.click_time=b.timeStamp-(l?.eDown?.timeStamp??0),l.up(b))}p(_,"handleUp");function y(b){l&&(m(b),l.move(b))}return p(y,"handleMove"),(b,w)=>(openBlock(),createElementBlock("div",_hoisted_1$1r,[createBaseVNode("canvas",{ref_key:"canvasEl",ref:n,class:"absolute mt-[-13px] w-full cursor-crosshair",onPointerdown:f,onPointerup:_,onPointermove:y},null,544)]))}}),WidgetButton=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetButton-CO_p3EYg.js"),__vite__mapDeps([24,5,1,2,25]),import.meta.url)),WidgetInputText=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetInputText-CQ2DMZbD.js"),__vite__mapDeps([26,5,1,2,25,27,28,9,10,11,12,13]),import.meta.url)),WidgetInputNumber=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetInputNumber-CWsi50jC.js"),__vite__mapDeps([29,30,5,1,2,25,27,28,31,9,10,11,12,13]),import.meta.url)),WidgetToggleSwitch=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetToggleSwitch-DneuOBzR.js"),__vite__mapDeps([32,5,1,2,25,28]),import.meta.url)),WidgetSelect=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetSelect-CCfYw9j0.js"),__vite__mapDeps([33,34,1,2,5,10,11,25,27,28,35,9,12,13]),import.meta.url)),WidgetColorPicker=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetColorPicker-dZIEc4FM.js"),__vite__mapDeps([36,5,1,2,25,27,28,9,10,11,12,13]),import.meta.url)),WidgetTextarea=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetTextarea-CgQ7tNOm.js"),__vite__mapDeps([37,1,2,5,25,27,9,10,11,12,13]),import.meta.url)),WidgetChart=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetChart-BhgF-tyO.js"),__vite__mapDeps([38,5,1,2]),import.meta.url)),WidgetImageCompare=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetImageCompare-BIqV6Oy9.js"),__vite__mapDeps([39,5,1,2]),import.meta.url)),WidgetGalleria=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetGalleria-C16n4C62.js"),__vite__mapDeps([40,5,1,2,9,25,10,11,12,13,41]),import.meta.url)),WidgetMarkdown=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetMarkdown-BI0ARhBH.js"),__vite__mapDeps([42,1,2,5,9,10,11,12,13]),import.meta.url)),WidgetLegacy=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetLegacy-DUaZ0BYd.js"),__vite__mapDeps([43,5,1,2,9,10,11,12,13]),import.meta.url)),WidgetRecordAudio=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetRecordAudio-8vU9ms7V.js"),__vite__mapDeps([44,1,2,8,7,5,9,10,11,12,13]),import.meta.url)),AudioPreviewPlayer=defineAsyncComponent(()=>__vitePreload(()=>import("./AudioPreviewPlayer-CejvjGwo.js"),__vite__mapDeps([45,5,1,2,9,46,7,10,11,12,13,47]),import.meta.url)),WidgetAudioUI=defineAsyncComponent(()=>__vitePreload(()=>import("./WidgetAudioUI-zk3asrva.js"),__vite__mapDeps([48,46,7,34,1,2,5,10,11,25,27,28,35,45,9,12,13,47]),import.meta.url)),Load3D=defineAsyncComponent(()=>__vitePreload(()=>import("./Load3D-Cv8D_vB1.js"),__vite__mapDeps([49,4,1,2,5,6,9,10,11,12,13]),import.meta.url)),coreWidgetDefinitions=[["button",{component:WidgetButton,aliases:["BUTTON"],essential:!1}],["string",{component:WidgetInputText,aliases:["STRING","text"],essential:!1}],["int",{component:WidgetInputNumber,aliases:["INT"],essential:!0}],["float",{component:WidgetInputNumber,aliases:["FLOAT","number","slider"],essential:!0}],["boolean",{component:WidgetToggleSwitch,aliases:["BOOLEAN","toggle"],essential:!0}],["combo",{component:WidgetSelect,aliases:["COMBO","asset"],essential:!0}],["color",{component:WidgetColorPicker,aliases:["COLOR"],essential:!1}],["textarea",{component:WidgetTextarea,aliases:["TEXTAREA","multiline","customtext"],essential:!1}],["chart",{component:WidgetChart,aliases:["CHART"],essential:!1}],["imagecompare",{component:WidgetImageCompare,aliases:["IMAGECOMPARE"],essential:!1}],["galleria",{component:WidgetGalleria,aliases:["GALLERIA"],essential:!1}],["markdown",{component:WidgetMarkdown,aliases:["MARKDOWN","progressText"],essential:!1}],["legacy",{component:WidgetLegacy,aliases:[],essential:!0}],["audiorecord",{component:WidgetRecordAudio,aliases:["AUDIO_RECORD","AUDIORECORD"],essential:!1}],["audioUI",{component:AudioPreviewPlayer,aliases:["AUDIOUI","AUDIO_UI"],essential:!1}],["load3D",{component:Load3D,aliases:["LOAD_3D"],essential:!1}]],getComboWidgetAdditions=p(()=>new Map([["audio",WidgetAudioUI]]),"getComboWidgetAdditions"),widgets=new Map,aliasMap=new Map;for(const[i,o]of coreWidgetDefinitions){widgets.set(i,o);for(const n of o.aliases)aliasMap.set(n,i)}const getCanonicalType=p(i=>aliasMap.get(i)||i,"getCanonicalType"),getComponent=p((i,o)=>{if(i=="combo"){const s=getComboWidgetAdditions();if(s.has(o))return s.get(o)||null}const n=getCanonicalType(i);return widgets.get(n)?.component||null},"getComponent"),shouldRenderAsVue=p(i=>!i.options?.canvasOnly&&!!i.type,"shouldRenderAsVue"),_hoisted_1$1q={key:0,class:"node-error p-2 text-sm text-red-500"},_sfc_main$1G=defineComponent({__name:"NodeWidgets",props:{nodeData:{}},setup(i){const{shouldHandleNodePointerEvents:o,forwardEventToCanvas:n}=useCanvasInteractions();function s(_){o.value||(_.stopPropagation(),n(_))}p(s,"handleWidgetPointerEvent");const a=ref(null),{toastErrorHandler:r}=useErrorHandling();onErrorCaptured(_=>(a.value=_.message,r(_),!1));const l=computed(()=>i.nodeData?.type||""),{getWidgetTooltip:u,createTooltipConfig:m}=useNodeTooltips(l.value),f=computed(()=>{if(!i.nodeData?.widgets)return[];const{widgets:_}=i.nodeData,y=[];for(const b of _){if(b.options?.hidden||b.options?.canvasOnly||!b.type||!shouldRenderAsVue(b))continue;const w=getComponent(b.type,b.name)||(b.isDOMWidget?_sfc_main$1I:_sfc_main$1H),k=b.slotMetadata;let S=b.options;k?.linked&&(S={...b.options,disabled:!0});const C={name:b.name,type:b.type,value:b.value,label:b.label,options:S,callback:b.callback,spec:b.spec},I=p(N=>{b.value=N,b.type!=="asset"&&b.callback?.(N)},"updateHandler"),T=u(b),E=m(T);y.push({name:b.name,type:b.type,vueComponent:w,simplified:C,value:b.value,updateHandler:I,tooltipConfig:E,slotMetadata:k})}return y});return(_,y)=>{const b=resolveDirective("tooltip");return a.value?(openBlock(),createElementBlock("div",_hoisted_1$1q,toDisplayString(unref(st)("nodeErrors.widgets","Node Widgets Error")),1)):(openBlock(),createElementBlock("div",{key:1,class:normalizeClass(unref(cn)("lg-node-widgets grid grid-cols-[min-content_minmax(80px,max-content)_minmax(125px,auto)] has-[.widget-expands]:flex-1 gap-y-1 pr-3",unref(o)?"pointer-events-auto":"pointer-events-none")),onPointerdown:s,onPointermove:s,onPointerup:s},[(openBlock(!0),createElementBlock(Fragment,null,renderList(f.value,(w,k)=>(openBlock(),createElementBlock("div",{key:`widget-${k}-${w.name}`,class:"lg-node-widget group col-span-full grid grid-cols-subgrid items-stretch has-[.widget-expands]:flex-1"},[createBaseVNode("div",{class:normalizeClass(unref(cn)("z-10 w-3 opacity-0 transition-opacity duration-150 group-hover:opacity-100 flex items-center",w.slotMetadata?.linked&&"opacity-100"))},[w.slotMetadata?(openBlock(),createBlock(_sfc_main$1L,{key:0,"slot-data":{name:w.name,type:w.type,boundingRect:[0,0,0,0]},"node-id":_.nodeData?.id!=null?String(_.nodeData.id):"",index:w.slotMetadata.index,socketless:w.simplified.spec?.socketless,"dot-only":""},null,8,["slot-data","node-id","index","socketless"])):createCommentVNode("",!0)],2),withDirectives((openBlock(),createBlock(resolveDynamicComponent(w.vueComponent),{widget:w.simplified,"model-value":w.value,"node-id":_.nodeData?.id!=null?String(_.nodeData.id):"","node-type":l.value,class:"flex-1 col-span-2","onUpdate:modelValue":w.updateHandler},null,8,["widget","model-value","node-id","node-type","onUpdate:modelValue"])),[[b,w.tooltipConfig,void 0,{left:!0}]])]))),128))],34))}}}),_hoisted_1$1p={class:"scale-75"},_hoisted_2$18={class:"lg-node pointer-events-none absolute rounded-2xl border border-solid border-node-component-border bg-node-component-surface outline-2 -outline-offset-2 outline-transparent"},_hoisted_3$O={class:"flex flex-col gap-4 pb-4"},_sfc_main$1F=defineComponent({__name:"LGraphNodePreview",props:{nodeDef:{}},setup(i){const o=useWidgetStore(),n=computed(()=>{const s=Object.entries(i.nodeDef.inputs||{}).filter(([l,u])=>o.inputIsWidget(u)).map(([l,u])=>({name:l,type:u.widgetType||u.type,value:u.default!==void 0?u.default:u.type==="COMBO"&&Array.isArray(u.options)&&u.options.length>0?u.options[0]:"",options:{...u,hidden:u.hidden,advanced:u.advanced,values:u.type==="COMBO"?u.options:void 0}})),a=Object.entries(i.nodeDef.inputs||{}).filter(([l,u])=>!o.inputIsWidget(u)).map(([l,u])=>({name:l,type:u.type,shape:u.isOptional?RenderShape.HollowCircle:void 0,boundingRect:[0,0,0,0],link:null})),r=(i.nodeDef.outputs||[]).map(l=>typeof l=="string"?{name:l,type:l,boundingRect:[0,0,0,0],links:[]}:{...l,boundingRect:[0,0,0,0],links:[]});return{id:`preview-${i.nodeDef.name}`,title:i.nodeDef.display_name||i.nodeDef.name,type:i.nodeDef.name,mode:0,selected:!1,executing:!1,widgets:s,inputs:a,outputs:r,flags:{collapsed:!1}}});return(s,a)=>(openBlock(),createElementBlock("div",_hoisted_1$1p,[createBaseVNode("div",_hoisted_2$18,[createVNode(_sfc_main$1N,{"node-data":n.value},null,8,["node-data"]),a[0]||(a[0]=createBaseVNode("div",{class:"mx-0 mb-4 h-px w-full bg-node-component-border"},null,-1)),createBaseVNode("div",_hoisted_3$O,[createVNode(_sfc_main$1J,{"node-data":n.value},null,8,["node-data"]),n.value.widgets?.length?(openBlock(),createBlock(_sfc_main$1G,{key:0,"node-data":n.value},null,8,["node-data"])):createCommentVNode("",!0),createCommentVNode("",!0)])])]))}}),ALLOWED_TAGS=["video","source"],ALLOWED_ATTRS=["controls","autoplay","loop","muted","preload","poster"],MEDIA_SRC_REGEX=/(<(?:img|source|video)[^>]*\ssrc=['"])(?!(?:\/|https?:\/\/))([^'"\s>]+)(['"])/gi;function createMarkdownRenderer(i){const o=i?i.replace(/\/+$/,""):"",n=new _Renderer;return n.image=({href:s,title:a,text:r})=>{let l=s;o&&!/^(?:\/|https?:\/\/)/.test(s)&&(l=`${o}/${s}`);const u=a?` title="${a}"`:"";return`<img src="${l}" alt="${r}"${u} />`},n.link=({href:s,title:a,tokens:r,text:l})=>{const u=r?n.parser.parseInline(r):l,m=a?` title="${a}"`:"";return`<a href="${s}" ${m} target="_blank" rel="noopener noreferrer">${u}</a>`},n}p(createMarkdownRenderer,"createMarkdownRenderer");function renderMarkdownToHtml(i,o){if(!i)return"";let n=marked.parse(i,{renderer:createMarkdownRenderer(o),gfm:!0});return o&&(n=n.replace(MEDIA_SRC_REGEX,`$1${o}$2$3`)),purify.sanitize(n,{ADD_TAGS:ALLOWED_TAGS,ADD_ATTR:[...ALLOWED_ATTRS,"target","rel"]})}p(renderMarkdownToHtml,"renderMarkdownToHtml");const _hoisted_1$1o={key:1,class:"_sb_node_preview bg-component-node-background"},_hoisted_2$17={class:"_sb_table"},_hoisted_3$N=["title"],_hoisted_4$C={class:"_sb_preview_badge"},_hoisted_5$y={class:"_sb_col"},_hoisted_6$o={class:"_sb_col"},_hoisted_7$l={class:"_sb_col"},_hoisted_8$f=["innerHTML"],_sfc_main$1E=defineComponent({__name:"NodePreview",props:{nodeDef:{}},setup(i){const{shouldRenderVueNodes:o}=useVueFeatureFlags(),n=useColorPaletteStore(),s=computed(()=>n.completedActivePalette.colors.litegraph_base),a=useWidgetStore(),{description:r}=i.nodeDef,l=computed(()=>r?renderMarkdownToHtml(r):""),u=Object.values(i.nodeDef.inputs),m=i.nodeDef.outputs,f=u.filter(b=>!a.inputIsWidget(b)),_=u.filter(b=>a.inputIsWidget(b)),y=p((b,w=32)=>{let k;return typeof b=="object"&&b!==null||Array.isArray(b)?k=JSON.stringify(b):typeof b=="string"?k=b:k=String(b),toolkit.truncate(k,{length:w})},"truncateDefaultValue");return(b,w)=>unref(o)?(openBlock(),createBlock(_sfc_main$1F,{key:0,"node-def":b.nodeDef},null,8,["node-def"])):(openBlock(),createElementBlock("div",_hoisted_1$1o,[createBaseVNode("div",_hoisted_2$17,[createBaseVNode("div",{class:"node_header mr-4 text-ellipsis",title:b.nodeDef.display_name,style:normalizeStyle({backgroundColor:s.value.NODE_DEFAULT_COLOR,color:s.value.NODE_TITLE_COLOR})},[w[0]||(w[0]=createBaseVNode("div",{class:"_sb_dot headdot pr-3"},null,-1)),createTextVNode(" "+toDisplayString(b.nodeDef.display_name),1)],12,_hoisted_3$N),createBaseVNode("div",_hoisted_4$C,toDisplayString(b.$t("g.preview")),1),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(toolkit).zip(unref(f),unref(m)),([k,S])=>(openBlock(),createElementBlock("div",{key:(k?.name||"")+(S?.index.toString()||""),class:"_sb_row slot_row"},[createBaseVNode("div",_hoisted_5$y,[k?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(["_sb_dot",k.type])},null,2)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_6$o,toDisplayString(k?k.name:""),1),w[1]||(w[1]=createBaseVNode("div",{class:"_sb_col middle-column"},null,-1)),createBaseVNode("div",{class:"_sb_col _sb_inherit",style:normalizeStyle({color:s.value.NODE_TEXT_COLOR})},toDisplayString(S?S.name:""),5),createBaseVNode("div",_hoisted_7$l,[S?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(["_sb_dot",S.type])},null,2)):createCommentVNode("",!0)])]))),128)),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(_),k=>(openBlock(),createElementBlock("div",{key:k.name,class:"_sb_row _long_field"},[w[2]||(w[2]=createBaseVNode("div",{class:"_sb_col _sb_arrow"},"â—€",-1)),createBaseVNode("div",{class:"_sb_col",style:normalizeStyle({color:s.value.WIDGET_SECONDARY_TEXT_COLOR})},toDisplayString(k.name),5),w[3]||(w[3]=createBaseVNode("div",{class:"_sb_col middle-column"},null,-1)),createBaseVNode("div",{class:"_sb_col _sb_inherit",style:normalizeStyle({color:s.value.WIDGET_TEXT_COLOR})},toDisplayString(y(k.default)),5),w[4]||(w[4]=createBaseVNode("div",{class:"_sb_col _sb_arrow"},"â–¶",-1))]))),128))]),l.value?(openBlock(),createElementBlock("div",{key:0,class:"_sb_description",style:normalizeStyle({color:s.value.WIDGET_SECONDARY_TEXT_COLOR,backgroundColor:s.value.WIDGET_BGCOLOR}),innerHTML:l.value},null,12,_hoisted_8$f)):createCommentVNode("",!0)]))}}),NodePreview=_export_sfc(_sfc_main$1E,[["__scopeId","data-v-e73f504d"]]),_hoisted_1$1n={class:"_content"},_hoisted_2$16={class:"_footer"},_sfc_main$1D=defineComponent({__name:"NodeSearchFilter",emits:["addFilter"],setup(i,{emit:o}){const n=computed(()=>l.nodeSearchService.nodeFilters),s=ref(),a=computed(()=>s.value?.fuseSearch.data??[]),r=ref(""),l=useNodeDefStore();onMounted(()=>{s.value=l.nodeSearchService.nodeFilters[0],m()});const u=o,m=p(()=>{a.value.includes(r.value)||(r.value=a.value[0])},"updateSelectedFilterValue"),f=p(()=>{s.value&&u("addFilter",{filterDef:s.value,value:r.value})},"submit");return(_,y)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$1n,[createVNode(unref(script$l),{modelValue:s.value,"onUpdate:modelValue":y[0]||(y[0]=b=>s.value=b),class:"filter-type-select",options:n.value,"allow-empty":!1,"option-label":"name",onChange:m},null,8,["modelValue","options"]),createVNode(unref(script$7),{modelValue:r.value,"onUpdate:modelValue":y[1]||(y[1]=b=>r.value=b),class:"filter-value-select",options:a.value,filter:"","auto-filter-focus":""},null,8,["modelValue","options"])]),createBaseVNode("div",_hoisted_2$16,[createVNode(unref(script),{type:"button",label:_.$t("g.add"),onClick:f},null,8,["label"])])],64))}}),NodeSearchFilter=_export_sfc(_sfc_main$1D,[["__scopeId","data-v-d128f2a3"]]);function normalizePackId(i){return i.split("@")[0]}p(normalizePackId,"normalizePackId");function normalizePackKeys(i){return mapKeys(i,(o,n)=>normalizePackId(n))}p(normalizePackKeys,"normalizePackKeys");function extractCustomNodeName(i){const o=i?.split(".")||[];return o.length>=2&&o[0]==="custom_nodes"?normalizePackId(o[1]):null}p(extractCustomNodeName,"extractCustomNodeName");function getNodeHelpBaseUrl(i){if(getNodeSource(i.python_module).type===NodeSourceType.CustomNodes){const n=extractCustomNodeName(i.python_module);if(n)return`/extensions/${n}/docs/`}return`/docs/${i.name}/`}p(getNodeHelpBaseUrl,"getNodeHelpBaseUrl");class NodeHelpService{static{p(this,"NodeHelpService")}async fetchNodeHelp(o,n){return getNodeSource(o.python_module).type===NodeSourceType.CustomNodes?this.fetchCustomNodeHelp(o,n):this.fetchCoreNodeHelp(o,n)}async fetchCustomNodeHelp(o,n){const s=extractCustomNodeName(o.python_module);if(!s)throw new Error("Invalid custom node module");const a=`/extensions/${s}/docs/${o.name}/${n}.md`;let r=await fetch(api.fileURL(a));if(!r.ok){const l=`/extensions/${s}/docs/${o.name}.md`;r=await fetch(api.fileURL(l))}if(!r.ok)throw new Error(r.statusText);return r.text()}async fetchCoreNodeHelp(o,n){const s=`/docs/${o.name}/${n}.md`,a=await fetch(api.fileURL(s));if(!a.ok)throw new Error(a.statusText);return a.text()}}const nodeHelpService=new NodeHelpService,useNodeHelpStore=defineStore("nodeHelp",()=>{const i=ref(null),o=computed(()=>i.value!==null),n=ref(""),s=ref(!1),a=ref(null);function r(f){i.value=f}p(r,"openHelp");function l(){i.value=null}p(l,"closeHelp");const u=computed(()=>{const f=i.value;return f?getNodeHelpBaseUrl(f):""});watch(()=>i.value,async f=>{if(n.value="",a.value=null,f){s.value=!0;try{const _=i18n.global.locale.value||"en";n.value=await nodeHelpService.fetchNodeHelp(f,_)}catch(_){a.value=_.message,n.value=f.description||""}finally{s.value=!1}}},{immediate:!0});const m=computed(()=>renderMarkdownToHtml(n.value,u.value));return{currentHelpNode:i,isHelpOpen:o,openHelp:r,closeHelp:l,baseUrl:u,renderedHelpHtml:m,isLoading:s,error:a}}),_hoisted_1$1m={class:"flex h-full flex-col overflow-auto bg-(--p-tree-background)"},_hoisted_2$15={class:"flex items-center border-b border-(--p-divider-color) px-3 py-2"},_hoisted_3$M={class:"ml-2 font-semibold"},_hoisted_4$B={class:"node-help-content mx-auto w-full grow p-4"},_hoisted_5$x=["innerHTML"],_hoisted_6$n={key:2,class:"fallback-content space-y-6 text-sm"},_hoisted_7$k={key:0},_hoisted_8$e={key:1},_hoisted_9$b={key:2},_sfc_main$1C=defineComponent({__name:"NodeHelpPage",props:{node:{}},emits:["close"],setup(i){const o=useNodeHelpStore(),{renderedHelpHtml:n,isLoading:s,error:a}=storeToRefs(o),r=computed(()=>Object.values(i.node.inputs).map(u=>({name:u.name,type:u.type,tooltip:u.tooltip||""}))),l=computed(()=>i.node.outputs.map(u=>({name:u.name,type:u.type,tooltip:u.tooltip||""})));return(u,m)=>{const f=resolveDirective("tooltip");return openBlock(),createElementBlock("div",_hoisted_1$1m,[createBaseVNode("div",_hoisted_2$15,[withDirectives(createVNode(unref(script),{icon:"pi pi-arrow-left",text:"",severity:"secondary",onClick:m[0]||(m[0]=_=>u.$emit("close"))},null,512),[[f,u.$t("g.back"),void 0,{bottom:!0}]]),createBaseVNode("span",_hoisted_3$M,toDisplayString(u.node.display_name),1)]),createBaseVNode("div",_hoisted_4$B,[unref(s)?(openBlock(),createBlock(unref(script$5),{key:0,class:"m-auto","aria-label":u.$t("g.loading")},null,8,["aria-label"])):unref(a)?(openBlock(),createElementBlock("div",_hoisted_6$n,[u.node.description?(openBlock(),createElementBlock("p",_hoisted_7$k,[createBaseVNode("strong",null,toDisplayString(u.$t("g.description"))+":",1),createTextVNode(" "+toDisplayString(u.node.description),1)])):createCommentVNode("",!0),r.value.length?(openBlock(),createElementBlock("div",_hoisted_8$e,[createBaseVNode("p",null,[createBaseVNode("strong",null,toDisplayString(u.$t("nodeHelpPage.inputs"))+":",1)]),createBaseVNode("table",null,[createBaseVNode("thead",null,[createBaseVNode("tr",null,[createBaseVNode("th",null,toDisplayString(u.$t("g.name")),1),createBaseVNode("th",null,toDisplayString(u.$t("nodeHelpPage.type")),1),createBaseVNode("th",null,toDisplayString(u.$t("g.description")),1)])]),createBaseVNode("tbody",null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(r.value,_=>(openBlock(),createElementBlock("tr",{key:_.name},[createBaseVNode("td",null,[createBaseVNode("code",null,toDisplayString(_.name),1)]),createBaseVNode("td",null,toDisplayString(_.type),1),createBaseVNode("td",null,toDisplayString(_.tooltip||"-"),1)]))),128))])])])):createCommentVNode("",!0),l.value.length?(openBlock(),createElementBlock("div",_hoisted_9$b,[createBaseVNode("p",null,[createBaseVNode("strong",null,toDisplayString(u.$t("nodeHelpPage.outputs"))+":",1)]),createBaseVNode("table",null,[createBaseVNode("thead",null,[createBaseVNode("tr",null,[createBaseVNode("th",null,toDisplayString(u.$t("g.name")),1),createBaseVNode("th",null,toDisplayString(u.$t("nodeHelpPage.type")),1),createBaseVNode("th",null,toDisplayString(u.$t("g.description")),1)])]),createBaseVNode("tbody",null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.value,_=>(openBlock(),createElementBlock("tr",{key:_.name},[createBaseVNode("td",null,[createBaseVNode("code",null,toDisplayString(_.name),1)]),createBaseVNode("td",null,toDisplayString(_.type),1),createBaseVNode("td",null,toDisplayString(_.tooltip||"-"),1)]))),128))])])])):createCommentVNode("",!0)])):(openBlock(),createElementBlock("div",{key:1,class:"markdown-content",innerHTML:unref(n)},null,8,_hoisted_5$x))])])}}}),NodeHelpPage=_export_sfc(_sfc_main$1C,[["__scopeId","data-v-55444b67"]]),BOOKMARK_SETTING_ID="Comfy.NodeLibrary.Bookmarks.V2",useNodeBookmarkStore=defineStore("nodeBookmark",()=>{const i=useSettingStore(),o=useNodeDefStore(),n=computed(()=>i.get(BOOKMARK_SETTING_ID)),s=computed(()=>new Set(n.value)),a=computed(()=>u(n.value)),r=p(E=>s.value.has(E.nodePath)||s.value.has(E.name),"isBookmarked"),l=p(async E=>{r(E)?(await f(E.nodePath),await f(E.name)):await m(E.name)},"toggleBookmark"),u=p(E=>{const N=E.map(L=>{if(L.endsWith("/"))return createDummyFolderNodeDef(L);const A=L.split("/"),D=A.pop()??"",O=A.join("/"),M=o.nodeDefsByName[D];if(!M)return null;const P=toolkit.clone(M);return P.category=O,P}).filter(L=>L!==null);return buildNodeDefTree(N)},"buildBookmarkTree"),m=p(async E=>{await i.set(BOOKMARK_SETTING_ID,[...n.value,E])},"addBookmark"),f=p(async E=>{await i.set(BOOKMARK_SETTING_ID,n.value.filter(N=>N!==E))},"deleteBookmark"),_=p(async(E,N)=>{const A=(E?E.nodePath:"")+N+"/";return await m(A),A},"addNewBookmarkFolder"),y=p(async(E,N)=>{if(!E.isDummyFolder)throw new Error("Cannot rename non-folder node");if(N.includes("/"))throw new Error('Folder name cannot contain "/"');const L=E.category.split("/").slice(0,-1).concat(N).join("/")+"/";if(L!==E.nodePath){if(n.value.some(A=>A.startsWith(L)))throw new Error(`Folder name "${L}" already exists`);await i.set(BOOKMARK_SETTING_ID,n.value.map(A=>A.startsWith(E.nodePath)?A.replace(E.nodePath,L):A)),await C(E.nodePath,L)}},"renameBookmarkFolder"),b=p(async E=>{if(!E.isDummyFolder)throw new Error("Cannot delete non-folder node");await i.set(BOOKMARK_SETTING_ID,n.value.filter(N=>N!==E.nodePath&&!N.startsWith(E.nodePath))),await S(E.nodePath)},"deleteBookmarkFolder"),w=computed(()=>i.get("Comfy.NodeLibrary.BookmarksCustomization")),k=p(async(E,N)=>{const A={...w.value[E]||{},...N};A.icon===I&&delete A.icon,A.color===T&&delete A.color,Object.keys(A).length===0?await S(E):await i.set("Comfy.NodeLibrary.BookmarksCustomization",{...w.value,[E]:A})},"updateBookmarkCustomization"),S=p(async E=>{await i.set("Comfy.NodeLibrary.BookmarksCustomization",{...w.value,[E]:void 0})},"deleteBookmarkCustomization"),C=p(async(E,N)=>{const L={...w.value};L[E]&&(L[N]=L[E],delete L[E]),await i.set("Comfy.NodeLibrary.BookmarksCustomization",L)},"renameBookmarkCustomization"),I="pi-bookmark-fill",T="#a1a1aa";return{bookmarks:n,bookmarkedRoot:a,isBookmarked:r,toggleBookmark:l,addBookmark:m,addNewBookmarkFolder:_,renameBookmarkFolder:y,deleteBookmarkFolder:b,bookmarksCustomization:w,updateBookmarkCustomization:k,deleteBookmarkCustomization:S,renameBookmarkCustomization:C,defaultBookmarkIcon:I,defaultBookmarkColor:T}}),_sfc_main$1B=defineComponent({__name:"NodeTreeLeaf",props:{node:{},openNodeHelp:{type:Function}},setup(i){const{t:o}=useI18n(),n=i,s=computed(()=>n.node.data),a=useNodeBookmarkStore(),r=computed(()=>a.isBookmarked(s.value)),l=useSettingStore(),u=computed(()=>l.get("Comfy.Sidebar.Location")),m=p(async()=>{await a.toggleBookmark(s.value)},"toggleBookmark"),f=p(async()=>{if(!n.node.data)throw new Error("Failed to edit subgraph blueprint lacking backing node data");await useSubgraphStore().editBlueprint(n.node.data.name)},"editBlueprint"),_=ref(null),y=computed(()=>[{label:o("g.delete"),icon:"pi pi-trash",severity:"error",command:w}]);function b(L){s.value.name.startsWith(useSubgraphStore().typePrefix)&&_.value?.show(L)}p(b,"handleContextMenu");function w(){n.node.data&&useSubgraphStore().deleteBlueprint(n.node.data.name)}p(w,"deleteBlueprint");const k=ref({position:"fixed",top:"0px",left:"0px",pointerEvents:"none",zIndex:1001}),S=p(async()=>{const L=I.value;if(!L)return;const A=L.getBoundingClientRect(),D=40;k.value.top=`${A.top}px`,k.value.left=u.value==="left"?`${A.right+D}px`:`${A.left-D}px`,k.value.transform=u.value==="right"?"translateX(-100%)":void 0},"handleNodeHover"),C=ref(null),I=ref(null),T=ref(!1),E=p(async()=>{T.value=!0,await nextTick(),await S()},"handleMouseEnter"),N=p(()=>{T.value=!1},"handleMouseLeave");return onMounted(()=>{I.value=C.value?.closest(".p-tree-node-content")??null,I.value?.addEventListener("mouseenter",E),I.value?.addEventListener("mouseleave",N)}),onUnmounted(()=>{I.value?.removeEventListener("mouseenter",E),I.value?.removeEventListener("mouseleave",N)}),(L,A)=>{const D=resolveDirective("tooltip");return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",{ref_key:"container",ref:C,class:"node-lib-node-container"},[createVNode(TreeExplorerTreeNode,{node:L.node,onContextmenu:b},createSlots({"before-label":withCtx(()=>[s.value.experimental?(openBlock(),createBlock(unref(script$m),{key:0,value:L.$t("g.experimental"),severity:"primary"},null,8,["value"])):createCommentVNode("",!0),s.value.deprecated?(openBlock(),createBlock(unref(script$m),{key:1,value:L.$t("g.deprecated"),severity:"danger"},null,8,["value"])):createCommentVNode("",!0)]),_:2},[s.value.name.startsWith(unref(useSubgraphStore)().typePrefix)?{name:"actions",fn:withCtx(()=>[createVNode(unref(script),{size:"small",icon:"pi pi-trash",text:"",severity:"danger",onClick:withModifiers(w,["stop"])}),createVNode(unref(script),{size:"small",text:"",severity:"secondary",onClick:withModifiers(f,["stop"])},{icon:withCtx(()=>A[1]||(A[1]=[createBaseVNode("i",{class:"icon-[lucide--square-pen]"},null,-1)])),_:1})]),key:"0"}:{name:"actions",fn:withCtx(()=>[createVNode(unref(script),{class:"bookmark-button",size:"small",icon:r.value?"pi pi-bookmark-fill":"pi pi-bookmark",text:"",severity:"secondary",onClick:withModifiers(m,["stop"])},null,8,["icon"]),withDirectives(createVNode(unref(script),{class:"help-button",size:"small",icon:"pi pi-question",text:"",severity:"secondary",onClick:A[0]||(A[0]=withModifiers(O=>n.openNodeHelp(s.value),["stop"]))},null,512),[[D,L.$t("g.learnMore"),void 0,{bottom:!0}]])]),key:"1"}]),1032,["node"]),T.value?(openBlock(),createBlock(Teleport,{key:0,to:"#node-library-node-preview-container"},[createBaseVNode("div",{class:"node-lib-node-preview",style:normalizeStyle(k.value)},[createVNode(NodePreview,{"node-def":s.value},null,8,["node-def"])],4)])):createCommentVNode("",!0)],512),createVNode(unref(script$i),{ref_key:"menu",ref:_,model:y.value},null,8,["model"])],64)}}}),NodeTreeLeaf=_export_sfc(_sfc_main$1B,[["__scopeId","data-v-06d04688"]]),DEFAULT_ICON="pi pi-sort",DEFAULT_GROUPING_ID="category",DEFAULT_SORTING_ID="original";class NodeOrganizationService{static{p(this,"NodeOrganizationService")}groupingStrategies=[{id:"category",label:"sideToolbar.nodeLibraryTab.groupStrategies.category",icon:"pi pi-folder",description:"sideToolbar.nodeLibraryTab.groupStrategies.categoryDesc",getNodePath:p(o=>{const n=o.category||"";return[...n?n.split("/"):[],o.name]},"getNodePath")},{id:"module",label:"sideToolbar.nodeLibraryTab.groupStrategies.module",icon:"pi pi-box",description:"sideToolbar.nodeLibraryTab.groupStrategies.moduleDesc",getNodePath:p(o=>{const n=o.python_module||"";if(!n)return["unknown_module",o.name];const s=n.split(".");return s[0]==="nodes"?["core",o.name]:s[0]==="custom_nodes"?s.length>1?[s[1],o.name]:["custom_nodes",o.name]:[...s,o.name]},"getNodePath")},{id:"source",label:"sideToolbar.nodeLibraryTab.groupStrategies.source",icon:"pi pi-server",description:"sideToolbar.nodeLibraryTab.groupStrategies.sourceDesc",getNodePath:p(o=>o.api_node?["API nodes",o.name]:o.nodeSource.type===NodeSourceType.Core?["Core",o.name]:o.nodeSource.type===NodeSourceType.CustomNodes?["Custom nodes",o.name]:["Unknown",o.name],"getNodePath")}];sortingStrategies=[{id:"original",label:"sideToolbar.nodeLibraryTab.sortBy.original",icon:"pi pi-sort-alt",description:"sideToolbar.nodeLibraryTab.sortBy.originalDesc",compare:p(()=>0,"compare")},{id:"alphabetical",label:"sideToolbar.nodeLibraryTab.sortBy.alphabetical",icon:"pi pi-sort-alpha-down",description:"sideToolbar.nodeLibraryTab.sortBy.alphabeticalDesc",compare:p((o,n)=>(o.display_name??"").localeCompare(n.display_name??""),"compare")}];getGroupingStrategies(){return[...this.groupingStrategies]}getGroupingStrategy(o){return this.groupingStrategies.find(n=>n.id===o)}getSortingStrategies(){return[...this.sortingStrategies]}getSortingStrategy(o){return this.sortingStrategies.find(n=>n.id===o)}organizeNodes(o,n={}){const{groupBy:s=DEFAULT_GROUPING_ID,sortBy:a=DEFAULT_SORTING_ID}=n,r=this.getGroupingStrategy(s),l=this.getSortingStrategy(a);if(!r)throw new Error(`Unknown grouping strategy: ${s}`);if(!l)throw new Error(`Unknown sorting strategy: ${a}`);const u=l.id!=="original"?[...o].sort(l.compare):o,m=buildNodeDefTree(u,{pathExtractor:r.getNodePath});return a==="alphabetical"?sortedTree(m,{groupLeaf:!0}):m}getGroupingIcon(o){return this.getGroupingStrategy(o)?.icon||DEFAULT_ICON}getSortingIcon(o){return this.getSortingStrategy(o)?.icon||DEFAULT_ICON}}const nodeOrganizationService=new NodeOrganizationService,_hoisted_1$1l={class:"color-customization-selector-container flex flex-row items-center gap-2"},_hoisted_2$14={key:1,class:"pi pi-palette text-lg"},_sfc_main$1A=defineComponent({__name:"ColorCustomizationSelector",props:{modelValue:{},colorOptions:{},allowCustom:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(i,{emit:o}){const n={name:"_custom",value:""},s=computed(()=>[...i.colorOptions,...i.allowCustom?[n]:[]]),a=o,r=ref(n),l=ref("");return onMounted(()=>{if(i.modelValue){const u=i.colorOptions.find(m=>m.value===i.modelValue);u?r.value=u:(r.value=n,l.value=i.modelValue.replace("#",""))}}),watch(r,(u,m)=>{u.name==="_custom"?l.value=m.value.replace("#",""):a("update:modelValue",u.value)}),watch(l,u=>{r.value.name==="_custom"&&a("update:modelValue",u?`#${u}`:null)}),(u,m)=>(openBlock(),createElementBlock("div",_hoisted_1$1l,[createVNode(unref(script$l),{modelValue:r.value,"onUpdate:modelValue":m[0]||(m[0]=f=>r.value=f),options:s.value,"option-label":"name","data-key":"value","allow-empty":!1},{option:withCtx(f=>[f.option.name!=="_custom"?(openBlock(),createElementBlock("div",{key:0,style:normalizeStyle({width:"20px",height:"20px",backgroundColor:f.option.value,borderRadius:"50%"})},null,4)):(openBlock(),createElementBlock("i",_hoisted_2$14))]),_:1},8,["modelValue","options"]),r.value.name==="_custom"?(openBlock(),createBlock(unref(script$n),{key:0,modelValue:l.value,"onUpdate:modelValue":m[1]||(m[1]=f=>l.value=f)},null,8,["modelValue"])):createCommentVNode("",!0)]))}}),_hoisted_1$1k={class:"p-fluid"},_hoisted_2$13={class:"field icon-field"},_hoisted_3$L={for:"icon"},_hoisted_4$A={class:"field color-field"},_hoisted_5$w={for:"color"},_sfc_main$1z=defineComponent({__name:"CustomizationDialog",props:{modelValue:{type:Boolean},initialIcon:{},initialColor:{}},emits:["update:modelValue","confirm"],setup(i,{emit:o}){const{t:n}=useI18n(),s=i,a=o,r=computed({get:p(()=>s.modelValue,"get"),set:p(S=>a("update:modelValue",S),"set")}),l=useNodeBookmarkStore(),u=[{name:n("icon.bookmark"),value:l.defaultBookmarkIcon},{name:n("icon.folder"),value:"pi-folder"},{name:n("icon.star"),value:"pi-star"},{name:n("icon.heart"),value:"pi-heart"},{name:n("icon.file"),value:"pi-file"},{name:n("icon.inbox"),value:"pi-inbox"},{name:n("icon.box"),value:"pi-box"},{name:n("icon.briefcase"),value:"pi-briefcase"}],m=[{name:n("color.default"),value:l.defaultBookmarkColor},{name:n("color.blue"),value:"#007bff"},{name:n("color.green"),value:"#28a745"},{name:n("color.red"),value:"#dc3545"},{name:n("color.pink"),value:"#e83e8c"},{name:n("color.yellow"),value:"#ffc107"}],f=u.find(S=>S.value===l.defaultBookmarkIcon),_=ref(f),y=ref(s.initialColor||l.defaultBookmarkColor),b=p(()=>{_.value=u.find(S=>S.value===s.initialIcon)||f,y.value=s.initialColor||l.defaultBookmarkColor},"resetCustomization"),w=p(()=>{a("confirm",_.value.value,y.value),k()},"confirmCustomization"),k=p(()=>{r.value=!1},"closeDialog");return watch(()=>s.modelValue,S=>{S&&b()},{immediate:!0}),(S,C)=>(openBlock(),createBlock(unref(script$p),{visible:r.value,"onUpdate:visible":C[2]||(C[2]=I=>r.value=I),header:S.$t("g.customizeFolder")},{footer:withCtx(()=>[createVNode(unref(script),{label:S.$t("g.reset"),icon:"pi pi-refresh",class:"p-button-text",onClick:b},null,8,["label"]),createVNode(unref(script),{label:S.$t("g.confirm"),icon:"pi pi-check",autofocus:"",onClick:w},null,8,["label"])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$1k,[createBaseVNode("div",_hoisted_2$13,[createBaseVNode("label",_hoisted_3$L,toDisplayString(S.$t("g.icon")),1),createVNode(unref(script$l),{modelValue:_.value,"onUpdate:modelValue":C[0]||(C[0]=I=>_.value=I),options:u,"option-label":"name","data-key":"value"},{option:withCtx(I=>[createBaseVNode("i",{class:normalizeClass(["pi",I.option.value,"mr-2"]),style:normalizeStyle({color:y.value})},null,6)]),_:1},8,["modelValue"])]),createVNode(unref(script$o)),createBaseVNode("div",_hoisted_4$A,[createBaseVNode("label",_hoisted_5$w,toDisplayString(S.$t("g.color")),1),createVNode(_sfc_main$1A,{modelValue:y.value,"onUpdate:modelValue":C[1]||(C[1]=I=>y.value=I),"color-options":m},null,8,["modelValue"])])])]),_:1},8,["visible","header"]))}}),FolderCustomizationDialog=_export_sfc(_sfc_main$1z,[["__scopeId","data-v-1d16d52b"]]),_sfc_main$1y=defineComponent({__name:"NodeTreeFolder",props:{node:{}},setup(i){const o=useNodeBookmarkStore(),n=computed(()=>{const _=i.node.data;return _?o.bookmarksCustomization[_.nodePath]:void 0}),s=ref(null),a=ref(null);let r=null;const l=ref(null);onMounted(()=>{s.value=l.value?.closest(".p-tree-node-content"),a.value=s.value.querySelector(":scope > .p-tree-node-icon"),u(),r=watch(n,u,{deep:!0})});const u=p(()=>{a.value&&n.value&&(a.value.style.color=n.value.color??"")},"updateIconColor");onUnmounted(()=>{r&&r()});const m=inject(InjectKeyExpandedKeys),f=p(_=>{m&&(m.value[_.key]=!0)},"handleItemDrop");return(_,y)=>(openBlock(),createElementBlock("div",{ref_key:"container",ref:l,class:"node-lib-node-container"},[createVNode(TreeExplorerTreeNode,{node:_.node,onItemDropped:f},null,8,["node"])],512))}}),_sfc_main$1x=defineComponent({__name:"NodeBookmarkTreeExplorer",props:{filteredNodeDefs:{},openNodeHelp:{type:Function}},setup(i,{expose:o}){const n=i,s=ref({}),{expandNode:a,toggleNodeOnEvent:r}=useTreeExpansion(s),l=useNodeBookmarkStore(),u=computed(()=>{const I=p(T=>{if(T.leaf)return n.filteredNodeDefs.some(N=>N.name===T.data.name)?T:null;const E=T.children?.map(I).filter(N=>N!==null);return E&&E.length>0?{...T,children:E}:null},"filterTree");return n.filteredNodeDefs.length?I(l.bookmarkedRoot)||{key:"root",label:"Root",children:[]}:l.bookmarkedRoot});watch(()=>n.filteredNodeDefs,async I=>{I.length&&(await nextTick(),a(u.value))});const{t:m}=useI18n(),f=p(I=>[{label:m("g.customize"),icon:"pi pi-palette",command:p(()=>{if(!I.data)return;const T=l.bookmarksCustomization[I.data.nodePath];w.value=T?.icon||l.defaultBookmarkIcon,k.value=T?.color||l.defaultBookmarkColor,b.value=!0,S.value=I.data.nodePath},"command"),visible:!I?.leaf}],"extraMenuItems"),_=computed(()=>{const I=p(T=>{const N=T.children?.map(I)?.sort((L,A)=>L.leaf===A.leaf?L.label.localeCompare(A.label):L.leaf?1:-1);return{key:T.key,label:T.leaf?T.data.display_name:T.label,leaf:T.leaf,data:T.data,getIcon(){if(this.leaf)return"pi pi-circle-fill";const L=l.bookmarksCustomization[T.data?.nodePath];return L?.icon?"pi "+L.icon:"pi pi-bookmark-fill"},children:N,draggable:T.leaf,async handleAddFolder(L){L!==""&&await l.addNewBookmarkFolder(this.data,L)},renderDragPreview(L){const A=h(NodePreview,{nodeDef:T.data});return render$3(A,L),()=>{render$3(null,L)}},droppable:!T.leaf,async handleDrop(L){const A=L.data.data;l.isBookmarked(A)&&await l.toggleBookmark(A);const O=T.data.category+"/"+A.name;await l.addBookmark(O)},handleClick(L){this.leaf?useLitegraphService().addNodeOnGraph(this.data):r(L,T)},contextMenuItems:f,...T.leaf?{}:{async handleRename(L){this.data&&this.data.isDummyFolder&&await l.renameBookmarkFolder(this.data,L)},async handleDelete(){await l.deleteBookmarkFolder(this.data)}}}},"fillNodeInfo");return I(u.value)}),y=ref(null);o({addNewBookmarkFolder:p(()=>y.value?.addFolderCommand("root"),"addNewBookmarkFolder")});const b=ref(!1),w=ref(l.defaultBookmarkIcon),k=ref(l.defaultBookmarkColor),S=ref(""),C=p(async(I,T)=>{S.value&&await l.updateBookmarkCustomization(S.value,{icon:I,color:T})},"updateCustomization");return(I,T)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(TreeExplorer,{ref_key:"treeExplorerRef",ref:y,class:"node-lib-bookmark-tree-explorer",root:_.value,"expanded-keys":s.value},{folder:withCtx(({node:E})=>[createVNode(_sfc_main$1y,{node:E},null,8,["node"])]),node:withCtx(({node:E})=>[createVNode(NodeTreeLeaf,{node:E,"open-node-help":n.openNodeHelp},null,8,["node","open-node-help"])]),_:1},8,["root","expanded-keys"]),createVNode(FolderCustomizationDialog,{modelValue:b.value,"onUpdate:modelValue":T[0]||(T[0]=E=>b.value=E),"initial-icon":w.value,"initial-color":k.value,onConfirm:C},null,8,["modelValue","initial-icon","initial-color"])],64))}}),_hoisted_1$1j={class:"h-full"},_hoisted_2$12={class:"flex flex-col gap-1 p-2"},_hoisted_3$K={class:"flex flex-col gap-1 p-2"},_sfc_main$1w=defineComponent({__name:"NodeLibrarySidebarTab",setup(i){const o=useNodeDefStore(),n=useNodeBookmarkStore(),s=useNodeHelpStore(),a=useCommandStore(),r=ref({}),{expandNode:l,toggleNodeOnEvent:u}=useTreeExpansion(r),m=ref(null),f=ref(null),_=ref(null),y=ref(null),b=useLocalStorage("Comfy.NodeLibrary.GroupBy",DEFAULT_GROUPING_ID),w=useLocalStorage("Comfy.NodeLibrary.SortBy",DEFAULT_SORTING_ID),k=ref(""),{currentHelpNode:S,isHelpOpen:C}=storeToRefs(s),{openHelp:I,closeHelp:T}=s,E=computed(()=>nodeOrganizationService.getGroupingStrategies().map(G=>({id:G.id,label:G.label,icon:G.icon}))),N=computed(()=>nodeOrganizationService.getSortingStrategies().map(G=>({id:G.id,label:G.label,icon:G.icon}))),L=computed(()=>nodeOrganizationService.getGroupingIcon(b.value)),A=computed(()=>nodeOrganizationService.getSortingIcon(w.value)),D=p(G=>{b.value=G,_.value?.hide()},"selectGrouping"),O=p(G=>{w.value=G,y.value?.hide()},"selectSorting"),M=p(()=>{b.value=DEFAULT_GROUPING_ID,w.value=DEFAULT_SORTING_ID},"resetOrganization"),P=computed(()=>{const G=V.value.length>0?V.value:o.visibleNodeDefs;return nodeOrganizationService.organizeNodes(G,{groupBy:b.value,sortBy:w.value})}),R=computed(()=>{const G=p(H=>{const W=H.children?.map(G);return{key:H.key,label:H.leaf?H.data.display_name:H.label,leaf:H.leaf,data:H.data,getIcon(){if(this.leaf)return"pi pi-circle-fill"},children:W,draggable:H.leaf,renderDragPreview(X){const Q=h(NodePreview,{nodeDef:H.data});return render$3(Q,X),()=>{render$3(null,X)}},handleClick(X){this.leaf?useLitegraphService().addNodeOnGraph(this.data):u(X,this)}}},"fillNodeInfo");return G(P.value)}),V=ref([]),$=ref([]),F=p(async G=>{if(G.length===0&&!$.value.length){V.value=[],r.value={};return}const H=$.value.map(W=>W.filter);V.value=o.nodeSearchService.searchNode(G,H,{limit:64},{matchWildcards:!1}),await nextTick(),V.value.length>0&&l(P.value)},"handleSearch"),j=p(async G=>{$.value.push({filter:G,badge:G.filterDef.invokeSequence.toUpperCase(),badgeClass:G.filterDef.invokeSequence+"-badge",text:G.value,id:+new Date}),await F(k.value)},"onAddFilter"),U=p(async G=>{const H=$.value.findIndex(W=>W===G);H!==-1&&$.value.splice(H,1),await F(k.value)},"onRemoveFilter");return(G,H)=>{const W=resolveDirective("tooltip");return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$1j,[unref(C)?(openBlock(),createBlock(NodeHelpPage,{key:1,node:unref(S),onClose:unref(T)},null,8,["node","onClose"])):(openBlock(),createBlock(SidebarTabTemplate,{key:0,title:G.$t("sideToolbar.nodeLibrary"),class:"bg-(--p-tree-background)"},{"tool-buttons":withCtx(()=>[withDirectives(createVNode(unref(script),{class:"new-folder-button",icon:"pi pi-folder-plus",text:"",severity:"secondary",onClick:H[0]||(H[0]=X=>m.value?.addNewBookmarkFolder())},null,512),[[W,G.$t("g.newFolder"),void 0,{bottom:!0}]]),withDirectives(createVNode(unref(script),{icon:L.value,text:"",severity:"secondary",onClick:H[1]||(H[1]=X=>_.value?.toggle(X))},null,8,["icon"]),[[W,G.$t("sideToolbar.nodeLibraryTab.groupBy"),void 0,{bottom:!0}]]),withDirectives(createVNode(unref(script),{icon:A.value,text:"",severity:"secondary",onClick:H[2]||(H[2]=X=>y.value?.toggle(X))},null,8,["icon"]),[[W,G.$t("sideToolbar.nodeLibraryTab.sortMode"),void 0,{bottom:!0}]]),withDirectives(createVNode(unref(script),{icon:"pi pi-filter-slash",text:"",severity:"secondary",onClick:M},null,512),[[W,G.$t("sideToolbar.nodeLibraryTab.resetView"),void 0,{bottom:!0}]]),withDirectives(createVNode(unref(script),{icon:"pi pi-refresh",text:"",severity:"secondary",onClick:H[3]||(H[3]=()=>unref(a).execute("Comfy.RefreshNodeDefinitions"))},null,512),[[W,G.$t("menu.refresh"),void 0,{bottom:!0}]]),createVNode(unref(script$b),{ref_key:"groupingPopover",ref:_},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$12,[(openBlock(!0),createElementBlock(Fragment,null,renderList(E.value,X=>(openBlock(),createBlock(unref(script),{key:X.id,icon:X.icon,label:G.$t(X.label),text:"",severity:unref(b)===X.id?"primary":"secondary",class:"justify-start",onClick:p(Q=>D(X.id),"onClick")},null,8,["icon","label","severity","onClick"]))),128))])]),_:1},512),createVNode(unref(script$b),{ref_key:"sortingPopover",ref:y},{default:withCtx(()=>[createBaseVNode("div",_hoisted_3$K,[(openBlock(!0),createElementBlock(Fragment,null,renderList(N.value,X=>(openBlock(),createBlock(unref(script),{key:X.id,icon:X.icon,label:G.$t(X.label),text:"",severity:unref(w)===X.id?"primary":"secondary",class:"justify-start",onClick:p(Q=>O(X.id),"onClick")},null,8,["icon","label","severity","onClick"]))),128))])]),_:1},512)]),header:withCtx(()=>[createBaseVNode("div",null,[createVNode(SearchBox,{"model-value":k.value,"onUpdate:modelValue":H[4]||(H[4]=X=>k.value=X),class:"node-lib-search-box p-2 2xl:p-4",placeholder:G.$t("g.searchNodes")+"...","filter-icon":"pi pi-filter",filters:$.value,onSearch:F,onShowFilter:H[5]||(H[5]=X=>f.value?.toggle(X)),onRemoveFilter:U},null,8,["model-value","placeholder","filters"]),createVNode(unref(script$b),{ref_key:"searchFilter",ref:f,class:"ml-[-13px]"},{default:withCtx(()=>[createVNode(NodeSearchFilter,{onAddFilter:j})]),_:1},512)])]),body:withCtx(()=>[createBaseVNode("div",null,[createVNode(_sfc_main$1x,{ref_key:"nodeBookmarkTreeExplorerRef",ref:m,"filtered-node-defs":V.value,"open-node-help":unref(I)},null,8,["filtered-node-defs","open-node-help"]),withDirectives(createVNode(unref(script$o),{type:"dashed",class:"m-2"},null,512),[[vShow,unref(n).bookmarks.length>0]]),createVNode(TreeExplorer,{"expanded-keys":r.value,"onUpdate:expandedKeys":H[6]||(H[6]=X=>r.value=X),class:"node-lib-tree-explorer",root:R.value},{node:withCtx(({node:X})=>[createVNode(NodeTreeLeaf,{node:X,"open-node-help":unref(I)},null,8,["node","open-node-help"])]),_:1},8,["expanded-keys","root"])])]),_:1},8,["title"]))]),H[7]||(H[7]=createBaseVNode("div",{id:"node-library-node-preview-container"},null,-1))],64)}}}),useNodeLibrarySidebarTab=p(()=>({id:"node-library",icon:"icon-[comfy--node]",title:"sideToolbar.nodeLibrary",tooltip:"sideToolbar.nodeLibrary",label:"sideToolbar.labels.nodes",component:markRaw(_sfc_main$1w),type:"vue"}),"useNodeLibrarySidebarTab"),_hoisted_1$1i={class:"flex items-center"},_hoisted_2$11={key:0,class:"mr-2 shrink-0"},_hoisted_3$J={key:1,class:"ml-2 shrink-0"},_sfc_main$1v=defineComponent({__name:"TextDivider",props:{text:{},position:{default:"left"},align:{default:"center"},type:{default:"solid"},layout:{default:"horizontal"}},setup(i){return(o,n)=>(openBlock(),createElementBlock("div",_hoisted_1$1i,[o.position==="left"?(openBlock(),createElementBlock("span",_hoisted_2$11,toDisplayString(o.text),1)):createCommentVNode("",!0),createVNode(unref(script$o),{align:o.align,type:o.type,layout:o.layout,class:"grow"},null,8,["align","type","layout"]),o.position==="right"?(openBlock(),createElementBlock("span",_hoisted_3$J,toDisplayString(o.text),1)):createCommentVNode("",!0)]))}}),_sfc_main$1u=defineComponent({__name:"WorkflowTreeLeaf",props:{node:{}},setup(i){const o=useWorkflowBookmarkStore(),n=computed(()=>i.node.data&&o.isBookmarked(i.node.data.path)),s=p(async()=>{i.node.data&&await o.toggleBookmarked(i.node.data.path)},"handleBookmarkClick");return(a,r)=>(openBlock(),createBlock(TreeExplorerTreeNode,{node:a.node},{actions:withCtx(()=>[createVNode(unref(script),{icon:n.value?"pi pi-bookmark-fill":"pi pi-bookmark",text:"",severity:"secondary",size:"small",onClick:withModifiers(s,["stop"])},null,8,["icon"])]),_:1},8,["node"]))}}),_hoisted_1$1h={key:0,class:"comfyui-workflows-panel"},_hoisted_2$10={key:0,class:"comfyui-workflows-open"},_hoisted_3$I={key:0},_hoisted_4$z={class:"comfyui-workflows-bookmarks"},_hoisted_5$v={class:"comfyui-workflows-browse"},_hoisted_6$m={key:1,class:"comfyui-workflows-search-panel"},_sfc_main$1t=defineComponent({__name:"WorkflowsSidebarTab",setup(i){const o=useSettingStore(),n=computed(()=>o.get("Comfy.Workflow.WorkflowTabsPosition")),s=ref(""),a=computed(()=>s.value.length>0),r=ref([]),l=computed(()=>I(r.value)),u=p(async O=>{if(O.length===0){r.value=[],b.value={};return}const M=O.toLocaleLowerCase();r.value=m.workflows.filter(P=>P.path.toLocaleLowerCase().includes(M)),await nextTick(),w(l.value)},"handleSearch"),m=useWorkflowStore(),f=useWorkflowService(),_=useWorkspaceStore(),{t:y}=useI18n(),b=ref({}),{expandNode:w,toggleNodeOnEvent:k}=useTreeExpansion(b),S=ref({}),C=p(async O=>{O&&await f.closeWorkflow(O,{warnIfUnsaved:!_.shiftDown})},"handleCloseWorkflow"),I=p(O=>buildTree(O,M=>M.key.split("/")),"buildWorkflowTree"),T=computed(()=>sortedTree(I(m.persistedWorkflows),{groupLeaf:!0})),E=computed(()=>buildTree(m.bookmarkedWorkflows,O=>[O.key])),N=computed(()=>buildTree(m.openWorkflows,O=>[O.key])),L=p((O,M)=>{const P=O.children?.map(F=>L(F,M)),R=O.data;async function V(F){this.leaf?await f.openWorkflow(R):k(F,this)}p(V,"handleClick");const $=O.leaf?{handleClick:V,async handleRename(F){const j=M==="Browse"?R.directory+"/"+appendJsonExt(F):ComfyWorkflow.basePath+appendJsonExt(F);await f.renameWorkflow(R,j)},handleDelete:R.isTemporary?void 0:async function(){await f.deleteWorkflow(R)},contextMenuItems(){return[{label:y("g.insert"),icon:"pi pi-file-export",command:p(async()=>{const F=O.data;await f.insertWorkflow(F)},"command")},{label:y("g.duplicate"),icon:"pi pi-file-export",command:p(async()=>{const F=O.data;await f.duplicateWorkflow(F)},"command")}]},draggable:!0}:{handleClick:V};return{key:O.key,label:O.label,leaf:O.leaf,data:O.data,children:P,...$}},"renderTreeNode"),A=computed(()=>({[`root/${m.activeWorkflow?.key}`]:!0})),D=useWorkflowBookmarkStore();return onMounted(async()=>{await D.loadBookmarks()}),(O,M)=>{const P=resolveDirective("tooltip");return openBlock(),createElementBlock(Fragment,null,[createVNode(SidebarTabTemplate,{title:O.$t("sideToolbar.workflows"),class:"workflows-sidebar-tab bg-(--p-tree-background)"},{"tool-buttons":withCtx(()=>[withDirectives(createVNode(unref(script),{icon:"pi pi-refresh",severity:"secondary",text:"",onClick:M[0]||(M[0]=R=>unref(m).syncWorkflows())},null,512),[[P,O.$t("g.refresh"),void 0,{bottom:!0}]])]),header:withCtx(()=>[createVNode(SearchBox,{"model-value":s.value,"onUpdate:modelValue":M[1]||(M[1]=R=>s.value=R),class:"workflows-search-box p-2 2xl:p-4",placeholder:O.$t("g.searchWorkflows")+"...",onSearch:u},null,8,["model-value","placeholder"])]),body:withCtx(()=>[a.value?(openBlock(),createElementBlock("div",_hoisted_6$m,[createVNode(TreeExplorer,{"expanded-keys":b.value,"onUpdate:expandedKeys":M[5]||(M[5]=R=>b.value=R),root:L(l.value,"Browse")},{node:withCtx(({node:R})=>[createVNode(_sfc_main$1u,{node:R},null,8,["node"])]),_:1},8,["expanded-keys","root"])])):(openBlock(),createElementBlock("div",_hoisted_1$1h,[n.value==="Sidebar"?(openBlock(),createElementBlock("div",_hoisted_2$10,[createVNode(_sfc_main$1v,{text:unref(y)("sideToolbar.workflowTab.workflowTreeType.open"),type:"dashed",class:"ml-2"},null,8,["text"]),createVNode(TreeExplorer,{"expanded-keys":S.value,"onUpdate:expandedKeys":M[2]||(M[2]=R=>S.value=R),root:L(N.value,"Open"),"selection-keys":A.value},{node:withCtx(({node:R})=>[createVNode(TreeExplorerTreeNode,{node:R},{"before-label":withCtx(({node:V})=>[V.data?.isModified||!V.data?.isPersisted?(openBlock(),createElementBlock("span",_hoisted_3$I,"*")):createCommentVNode("",!0)]),actions:withCtx(({node:V})=>[createVNode(unref(script),{class:"close-workflow-button",icon:"pi pi-times",text:"",severity:unref(_).shiftDown?"danger":"secondary",size:"small",onClick:withModifiers($=>C(V.data),["stop"])},null,8,["severity","onClick"])]),_:2},1032,["node"])]),_:1},8,["expanded-keys","root","selection-keys"])])):createCommentVNode("",!0),withDirectives(createBaseVNode("div",_hoisted_4$z,[createVNode(_sfc_main$1v,{text:unref(y)("sideToolbar.workflowTab.workflowTreeType.bookmarks"),type:"dashed",class:"ml-2"},null,8,["text"]),createVNode(TreeExplorer,{"expanded-keys":S.value,"onUpdate:expandedKeys":M[3]||(M[3]=R=>S.value=R),root:L(E.value,"Bookmarks"),"selection-keys":A.value},{node:withCtx(({node:R})=>[createVNode(_sfc_main$1u,{node:R},null,8,["node"])]),_:1},8,["expanded-keys","root","selection-keys"])],512),[[vShow,unref(m).bookmarkedWorkflows.length>0]]),createBaseVNode("div",_hoisted_5$v,[createVNode(_sfc_main$1v,{text:unref(y)("sideToolbar.workflowTab.workflowTreeType.browse"),type:"dashed",class:"ml-2"},null,8,["text"]),unref(m).persistedWorkflows.length>0?(openBlock(),createBlock(TreeExplorer,{key:0,"expanded-keys":b.value,"onUpdate:expandedKeys":M[4]||(M[4]=R=>b.value=R),root:L(T.value,"Browse"),"selection-keys":A.value},{node:withCtx(({node:R})=>[createVNode(_sfc_main$1u,{node:R},null,8,["node"])]),_:1},8,["expanded-keys","root","selection-keys"])):(openBlock(),createBlock(NoResultsPlaceholder,{key:1,icon:"pi pi-folder",title:O.$t("g.empty"),message:O.$t("g.noWorkflowsFound")},null,8,["title","message"]))])]))]),_:1},8,["title"]),createVNode(unref(script$q))],64)}}}),useWorkflowsSidebarTab=p(()=>{const i=useSettingStore(),o=useWorkflowStore();return{id:"workflows",icon:"icon-[comfy--workflow]",iconBadge:p(()=>{if(i.get("Comfy.Workflow.WorkflowTabsPosition")!=="Sidebar")return null;const n=o.openWorkflows.length.toString();return n==="0"?null:n},"iconBadge"),title:"sideToolbar.workflows",tooltip:"sideToolbar.workflows",label:"sideToolbar.labels.workflows",component:markRaw(_sfc_main$1t),type:"vue"}},"useWorkflowsSidebarTab"),useSidebarTabStore=defineStore("sidebarTab",()=>{const i=ref([]),o=ref(null),n=computed(()=>i.value.find(u=>u.id===o.value)??null),s=p(u=>{o.value=o.value===u?null:u},"toggleSidebarTab"),a=p(u=>{i.value=[...i.value,u];const m=p(()=>`Toggle ${te(u.title)?t(u.title):u.title} Sidebar`,"labelFunction"),f=u.tooltip?te(String(u.tooltip))?()=>t(String(u.tooltip)):String(u.tooltip):void 0,_=p(()=>{const b={"node-library":"sideToolbar.nodeLibrary","model-library":"sideToolbar.modelLibrary",workflows:"sideToolbar.workflows",assets:"sideToolbar.assets"}[u.id];return b&&te(b)?t(b):u.title},"menubarLabelFunction");useCommandStore().registerCommand({id:`Workspace.ToggleSidebarTab.${u.id}`,icon:typeof u.icon=="string"?u.icon:void 0,label:m,menubarLabel:_,tooltip:f,versionAdded:"1.3.9",category:"view-controls",function:p(async()=>{const y=useSettingStore(),b=useCommandStore();if(u.id==="model-library"&&y.get("Comfy.Assets.UseAssetAPI")){await b.commands.find(w=>w.id==="Comfy.BrowseModelAssets")?.function?.();return}s(u.id)},"function"),active:p(()=>n.value?.id===u.id,"active"),source:"System"})},"registerSidebarTab");return{sidebarTabs:i,activeSidebarTabId:o,activeSidebarTab:n,toggleSidebarTab:s,registerSidebarTab:a,unregisterSidebarTab:p(u=>{const m=i.value.findIndex(f=>f.id===u);if(m!==-1){const f=i.value[m];f.type==="custom"&&f.destroy&&f.destroy();const _=[...i.value];_.splice(m,1),i.value=_}},"unregisterSidebarTab"),registerCoreSidebarTabs:p(()=>{a(useAssetsSidebarTab()),a(useNodeLibrarySidebarTab()),a(useModelLibrarySidebarTab()),a(useWorkflowsSidebarTab());const u=useMenuItemStore();u.registerCommands(["View"],["Workspace.ToggleBottomPanel","Comfy.BrowseTemplates","Workspace.ToggleFocusMode","Comfy.ToggleCanvasInfo","Comfy.Canvas.ToggleMinimap","Comfy.Canvas.ToggleLinkVisibility"]),u.registerCommands(["View"],["Comfy.Canvas.ZoomIn","Comfy.Canvas.ZoomOut","Comfy.Canvas.FitView"])},"registerCoreSidebarTabs")}}),useWorkspaceStore=defineStore("workspace",()=>{const i=ref(!1),o=ref(!1),n=ref(!1),s=computed(()=>useToastStore()),a=computed(()=>useQueueSettingsStore()),r=computed(()=>({commands:useCommandStore().commands,execute:useCommandStore().execute})),l=computed(()=>useSidebarTabStore()),u=computed(()=>({settings:useSettingStore().settingsById,get:p(L=>useSettingStore().get(L),"get"),set:p((L,A)=>useSettingStore().set(L,A),"set")})),m=computed(()=>useWorkflowStore()),f=useColorPaletteService(),_=useDialogService(),y=useBottomPanelStore(),b=useFirebaseAuthStore(),w=useApiKeyAuthStore(),k=computed(()=>b.currentUser),S=computed(()=>w.isAuthenticated),I={isLoggedIn:computed(()=>!!S.value||k.value!==null)};function T(L){l.value.registerSidebarTab(L)}p(T,"registerSidebarTab");function E(L){l.value.unregisterSidebarTab(L)}p(E,"unregisterSidebarTab");function N(){return l.value.sidebarTabs}return p(N,"getSidebarTabs"),{spinner:i,shiftDown:o,focusMode:n,toggleFocusMode:p(()=>{n.value=!n.value},"toggleFocusMode"),toast:s,queueSettings:a,command:r,sidebarTab:l,setting:u,workflow:m,colorPalette:f,dialog:_,bottomPanel:y,user:I,registerSidebarTab:T,unregisterSidebarTab:E,getSidebarTabs:N}}),useWorkflowService=p(()=>{const i=useSettingStore(),o=useWorkflowStore(),n=useToastStore(),s=useDialogService(),a=useWorkflowThumbnail(),r=useDomWidgetStore();async function l(O){if(i.get("Comfy.PromptFilename")){let M=await s.prompt({title:t("workflowService.exportWorkflow"),message:t("workflowService.enterFilename")+":",defaultValue:O});return M?(M.toLowerCase().endsWith(".json")||(M+=".json"),M):null}return O}p(l,"getFilename");function u(O){if(!i.get("Comfy.EnableWorkflowViewRestore"))return;const{offset:M,scale:P}=app$1.canvas.ds,[R,V]=M;O.extra??={},O.extra.ds={scale:P,offset:[R,V]}}p(u,"addViewRestore");const m=p(async(O,M)=>{const P=o.activeWorkflow;P?.path&&(O=P.filename);const R=await app$1.graphToPrompt();u(R.workflow);const V=JSON.stringify(R[M],null,2),$=new Blob([V],{type:"application/json"}),F=await l(O);F&&downloadBlob(F,$)},"exportWorkflow"),f=p(async O=>{const M=await O.promptSave();if(!M)return;const P=O.directory+"/"+appendJsonExt(M),R=o.getWorkflowByPath(P);if(R&&!R.isTemporary){if(await s.confirm({title:t("sideToolbar.workflowTab.confirmOverwriteTitle"),type:"overwrite",message:t("sideToolbar.workflowTab.confirmOverwrite"),itemList:[P]})!==!0)return;if(R.path===O.path){await _(O);return}if(!await I(R,!0))return}if(O.isTemporary)await C(O,P),await o.saveWorkflow(O);else{const V=o.saveAs(O,P);await k(V),await o.saveWorkflow(V)}},"saveWorkflowAs"),_=p(async O=>{O.isTemporary?await f(O):await o.saveWorkflow(O)},"saveWorkflow"),y=p(async()=>{await app$1.loadGraphData(defaultGraph)},"loadDefaultWorkflow"),b=p(async()=>{await app$1.loadGraphData(blankGraph)},"loadBlankWorkflow"),w=p(async()=>{const O=o.activeWorkflow;O&&await k(O,{force:!0})},"reloadCurrentWorkflow"),k=p(async(O,M={force:!1})=>{if(o.isActive(O)&&!M.force)return;const P=!O.isLoaded;P&&await O.load(),await app$1.loadGraphData(toRaw(O.activeState),!0,!0,O,{showMissingModelsDialog:P,showMissingNodesDialog:P,checkForRerouteMigration:!1})},"openWorkflow"),S=p(async(O,M={warnIfUnsaved:!0})=>{if(O.isModified&&M.warnIfUnsaved){const P=await s.confirm({title:t("sideToolbar.workflowTab.dirtyCloseTitle"),type:"dirtyClose",message:t("sideToolbar.workflowTab.dirtyClose"),itemList:[O.path],hint:M.hint});if(P===null)return!1;P===!0&&await _(O)}if(o.openWorkflows.length===1&&await y(),o.isActive(O)){const P=o.getMostRecentWorkflow();P?await k(P):await L()}return await o.closeWorkflow(O),!0},"closeWorkflow"),C=p(async(O,M)=>{await o.renameWorkflow(O,M)},"renameWorkflow"),I=p(async(O,M=!1)=>{let R=!i.get("Comfy.Workflow.ConfirmDelete")||M;return!R&&(R=await s.confirm({title:t("sideToolbar.workflowTab.confirmDeleteTitle"),type:"delete",message:t("sideToolbar.workflowTab.confirmDelete"),itemList:[O.path]}),!R)||o.isOpen(O)&&!await S(O,{warnIfUnsaved:!R})?!1:(await o.deleteWorkflow(O),M||n.add({severity:"info",summary:t("sideToolbar.workflowTab.deleted"),life:1e3}),!0)},"deleteWorkflow"),T=p(()=>{const M=useWorkspaceStore().workflow.activeWorkflow;M&&(M.changeTracker.store(),a.storeThumbnail(M),r.clear())},"beforeLoadNewGraph"),E=p(async(O,M)=>{const P=useWorkspaceStore().workflow;if(typeof O=="string"){const V=P.getWorkflowByPath(ComfyWorkflow.basePath+appendJsonExt(O));if(V?.isPersisted){const $=await P.openWorkflow(V);$.changeTracker.restore(),$.changeTracker.reset(M);return}}if(O===null||typeof O=="string"){const V=O,$=P.createTemporary(V?appendJsonExt(V):void 0,M);await P.openWorkflow($);return}const R=await P.openWorkflow(O);R.changeTracker.reset(M),R.changeTracker.restore()},"afterLoadNewGraph"),N=p(async(O,M={})=>{const P=await O.load(),R=toRaw(P.initialState),V=localStorage.getItem("litegrapheditor_clipboard"),$=new LGraph(R),F=document.createElement("canvas"),j=new LGraphCanvas(F,$,{skip_events:!0,skip_render:!0});j.selectItems(),j.copyToClipboard(),app$1.canvas.pasteFromClipboard(M),V!==null&&localStorage.setItem("litegrapheditor_clipboard",V)},"insertWorkflow"),L=p(async()=>{const O=o.openedWorkflowIndexShift(1);O&&await k(O)},"loadNextOpenedWorkflow");return{exportWorkflow:m,saveWorkflowAs:f,saveWorkflow:_,loadDefaultWorkflow:y,loadBlankWorkflow:b,reloadCurrentWorkflow:w,openWorkflow:k,closeWorkflow:S,renameWorkflow:C,deleteWorkflow:I,insertWorkflow:N,loadNextOpenedWorkflow:L,loadPreviousOpenedWorkflow:p(async()=>{const O=o.openedWorkflowIndexShift(-1);O&&await k(O)},"loadPreviousOpenedWorkflow"),duplicateWorkflow:p(async O=>{const M=JSON.parse(JSON.stringify(O.activeState)),P=O.isPersisted?" (Copy)":"",R=O.filename.replace(/\s*\(\d+\)$/,"")+P;await app$1.loadGraphData(M,!0,!0,R)},"duplicateWorkflow"),afterLoadNewGraph:E,beforeLoadNewGraph:T}},"useWorkflowService");async function confirmOverwrite(i){return await useDialogService().confirm({title:t("subgraphStore.overwriteBlueprintTitle"),type:"overwriteBlueprint",message:t("subgraphStore.overwriteBlueprint"),itemList:[i]})}p(confirmOverwrite,"confirmOverwrite");const useSubgraphStore=defineStore("subgraph",()=>{class i extends ComfyWorkflow{static{p(this,"SubgraphBlueprint")}static basePath="subgraphs/";tintCanvasBg="#22227740";hasPromptedSave=!1;constructor(S,C=!1){super(S),this.hasPromptedSave=!C}validateSubgraph(){if(!this.activeState?.definitions)throw new Error("The root graph of a subgraph blueprint must consist of only a single subgraph node");const{subgraphs:S}=this.activeState.definitions,{nodes:C}=this.activeState;function I(N){return N&&S.some(L=>L.id===N.type)}if(p(I,"isSubgraphNode"),C.length==1&&I(C[0]))return;const T={};let E=!1;for(let N=0;N<C.length;N++){if(!E&&I(C[N])){E=!0;continue}T[C[N].id]={errors:[],class_type:C[N].type,dependent_outputs:[]}}throw useExecutionStore().lastNodeErrors=T,useCanvasStore().getCanvas().draw(!0,!0),new Error("The root graph of a subgraph blueprint must consist of only a single subgraph node")}async save(){if(this.validateSubgraph(),!this.hasPromptedSave&&useSettingStore().get("Comfy.Workflow.WarnBlueprintOverwrite")){if(!await confirmOverwrite(this.filename))return this;this.hasPromptedSave=!0}const S=await super.save();return useSubgraphStore().updateDef(await this.load()),S}async saveAs(S){this.validateSubgraph(),this.hasPromptedSave=!0;const C=await super.saveAs(S);return useSubgraphStore().updateDef(await this.load()),C}async load({force:S=!1}={}){if(!S&&this.isLoaded)return await super.load({force:S});const C=await super.load({force:S}),I=C.activeState,T=(I.definitions?.subgraphs??[]).find(E=>E.id==I.nodes[0].type);if(!T)throw new Error("Loaded subgraph blueprint does not contain valid subgraph");return T.name=I.nodes[0].title=this.filename,C}async promptSave(){return await useDialogService().prompt({title:t("subgraphStore.saveBlueprint"),message:t("subgraphStore.blueprintName")+":",defaultValue:this.filename})}unload(){}}const o={},n="SubgraphBlueprint.",s=ref(new Map),a=useCanvasStore(),r=computed(()=>[...s.value.values()]);async function l(){async function k(E){E.path=i.basePath+E.path;const N=await new i(E,!0).load();useWorkflowStore().attachWorkflow(N),u(N)}p(k,"loadBlueprint");async function S(){async function E([L,A]){const D=i.basePath+A.name+".json",O=new i({path:D,modified:Date.now(),size:-1});O.originalContent=O.content=await A.data,O.filename=A.name,useWorkflowStore().attachWorkflow(O);const M=await O.load();u(M,{python_module:A.info.node_pack,display_name:A.name},L)}p(E,"loadGlobalBlueprint");const N=await api.getGlobalSubgraphs();await Promise.allSettled(Object.entries(N).map(E))}p(S,"loadInstalledBlueprints");const C=(await api.listUserDataFullInfo(i.basePath)).filter(E=>E.path.endsWith(".json")),T=(await Promise.allSettled([...C.map(k),S()])).filter(E=>"reason"in E).map(E=>E.reason);T.forEach(E=>console.error("Failed to load subgraph blueprint",E)),T.length>0&&useToastStore().add({severity:"error",summary:t("subgraphStore.loadFailure"),detail:T.length>3?`x${T.length}`:`${T}`,life:6e3})}p(l,"fetchSubgraphs");function u(k,S={},C=k.filename){const I=k.changeTracker.initialState.nodes[0];if(!I)throw new Error("Invalid Subgraph Blueprint");I.inputs??=[],I.outputs??=[];const T=Object.fromEntries(I.inputs.map(A=>[A.name,[`${A.type}`,void 0]]));let E="User generated subgraph blueprint";k.initialState.extra?.BlueprintDescription&&(E=`${k.initialState.extra.BlueprintDescription}`);const N={input:{required:T},output:I.outputs.map(A=>`${A.type}`),output_name:I.outputs.map(A=>A.name),name:n+C,display_name:C,description:E,category:"Subgraph Blueprints",output_node:!1,python_module:"blueprint",...S},L=new ComfyNodeDefImpl(N);s.value.set(C,L),o[C]=k}p(u,"registerNodeDef");async function m(){const k=a.getCanvas(),S=[...k.selectedItems][0];if(k.selectedItems.size!==1||!(S instanceof SubgraphNode))throw new TypeError("Must have single SubgraphNode selected to publish");const{nodes:C=[],subgraphs:I=[]}=k._serializeItems([S]);if(C.length!=1)throw new TypeError("Must have single SubgraphNode selected to publish");const T={revision:0,last_node_id:S.id,last_link_id:0,nodes:C,links:[],version:.4,definitions:{subgraphs:I}},E=await useDialogService().prompt({title:t("subgraphStore.saveBlueprint"),message:t("subgraphStore.blueprintName")+":",defaultValue:S.title});if(!E||s.value.has(E)&&!await confirmOverwrite(E))return;const N=i.basePath+E+".json",L=new i({path:N,size:-1,modified:Date.now()});L.originalContent=JSON.stringify(T);const A=await L.load();L.size=1,await L.save(),useWorkflowStore().attachWorkflow(A),u(A),useToastStore().add({severity:"success",summary:t("subgraphStore.publishSuccess"),detail:t("subgraphStore.publishSuccessMessage"),life:4e3})}p(m,"publishSubgraph");function f(k){u(k)}p(f,"updateDef");async function _(k){const S=k.slice(n.length);if(!(S in o))throw new Error("not yet loaded");useWorkflowStore().attachWorkflow(o[S]),await useWorkflowService().openWorkflow(o[S]);const C=useCanvasStore().getCanvas();C.graph&&"subgraph"in C.graph.nodes[0]&&C.setGraph(C.graph.nodes[0].subgraph)}p(_,"editBlueprint");function y(k){const S=k.slice(n.length);if(!(S in o))throw new Error("not yet loaded");return o[S].changeTracker.initialState}p(y,"getBlueprint");async function b(k){const S=k.slice(n.length);if(!(S in o))throw new Error("not yet loaded");await useDialogService().confirm({title:t("subgraphStore.confirmDeleteTitle"),type:"delete",message:t("subgraphStore.confirmDelete"),itemList:[S]})&&(await o[S].delete(),delete o[S],s.value.delete(S))}p(b,"deleteBlueprint");function w(k){return k instanceof i}return p(w,"isSubgraphBlueprint"),{deleteBlueprint:b,editBlueprint:_,fetchSubgraphs:l,getBlueprint:y,isSubgraphBlueprint:w,publishSubgraph:m,subgraphBlueprints:r,typePrefix:n,updateDef:f}});class ComfyNodeDefImpl{static{p(this,"ComfyNodeDefImpl")}name;display_name;category;python_module;description;help;deprecated;experimental;output_node;api_node;input;output;output_is_list;output_name;output_tooltips;input_order;inputs;outputs;hidden;nodeSource;static#e(o){const n=toolkit.cloneDeep(o);n.input??={};for(const[s,a]of Object.entries(n.input.required??{})){const r=a[1];r&&r.defaultInput&&console.warn(`Use of defaultInput on required input ${o.python_module}:${o.name}:${s} is deprecated. Please drop the defaultInput option.`)}for(const[s,a]of Object.entries(n.input.optional??{})){const r=a[1];r&&r.defaultInput&&(console.warn(`Use of defaultInput on optional input ${o.python_module}:${o.name}:${s} is deprecated. Please use forceInput instead.`),r.forceInput=!0)}return n}constructor(o){const n=ComfyNodeDefImpl.#e(o);Object.assign(this,n),this.name=n.name,this.display_name=n.display_name,this.category=n.category,this.python_module=n.python_module,this.description=n.description,this.help=n.help??"",this.deprecated=n.deprecated??n.category==="",this.experimental=n.experimental??n.category.startsWith("_for_testing"),this.output_node=n.output_node,this.api_node=!!n.api_node,this.input=n.input??{},this.output=n.output??[],this.output_is_list=n.output_is_list,this.output_name=n.output_name,this.output_tooltips=n.output_tooltips,this.input_order=n.input_order;const s=transformNodeDefV1ToV2(n);this.inputs=s.inputs,this.outputs=s.outputs,this.hidden=s.hidden,this.nodeSource=getNodeSource(n.python_module)}get nodePath(){return(this.category?this.category+"/":"")+this.name}get isDummyFolder(){return this.name===""}postProcessSearchScores(o){const s=useNodeFrequencyStore().getNodeFrequencyByName(this.name);return[o[0],-s,...o.slice(1)]}get isCoreNode(){return this.nodeSource.type===NodeSourceType.Core}get nodeLifeCycleBadgeText(){return this.deprecated?"[DEPR]":this.experimental?"[BETA]":""}}const SYSTEM_NODE_DEFS={PrimitiveNode:{name:"PrimitiveNode",display_name:"Primitive",category:"utils",input:{required:{},optional:{}},output:["*"],output_name:["connect to widget input"],output_is_list:[!1],output_node:!1,python_module:"nodes",description:"Primitive values like numbers, strings, and booleans."},Reroute:{name:"Reroute",display_name:"Reroute",category:"utils",input:{required:{"":["*",{}]},optional:{}},output:["*"],output_name:[""],output_is_list:[!1],output_node:!1,python_module:"nodes",description:"Reroute the connection to another node."},Note:{name:"Note",display_name:"Note",category:"utils",input:{required:{},optional:{}},output:[],output_name:[],output_is_list:[],output_node:!1,python_module:"nodes",description:"Node that add notes to your project"},MarkdownNote:{name:"MarkdownNote",display_name:"Markdown Note",category:"utils",input:{required:{},optional:{}},output:[],output_name:[],output_is_list:[],output_node:!1,python_module:"nodes",description:"Node that add notes to your project. Reformats text as markdown."}};function buildNodeDefTree(i,o={}){const{pathExtractor:n}=o;return buildTree(i,n||p(a=>a.nodePath.split("/"),"defaultPathExtractor"))}p(buildNodeDefTree,"buildNodeDefTree");function createDummyFolderNodeDef(i){return new ComfyNodeDefImpl({name:"",display_name:"",category:i.endsWith("/")?i.slice(0,-1):i,python_module:"nodes",description:"Dummy Folder Node (User should never see this string)",input:{},output:[],output_name:[],output_is_list:[],output_node:!1})}p(createDummyFolderNodeDef,"createDummyFolderNodeDef");const useNodeDefStore=defineStore("nodeDef",()=>{const i=ref({}),o=ref({}),n=ref(!1),s=ref(!1),a=ref([]),r=computed(()=>{const I=useSubgraphStore();return[...Object.values(i.value),...I.subgraphBlueprints]}),l=computed(()=>{const I=new Set;for(const T of r.value){for(const E of Object.values(T.inputs))I.add(E.type);for(const E of T.outputs)I.add(E.type)}return I}),u=computed(()=>r.value.filter(I=>a.value.every(T=>T.predicate(I)))),m=computed(()=>new NodeSearchService(u.value)),f=computed(()=>buildNodeDefTree(u.value));function _(I){const T={},E={};for(const N of I){const L=N instanceof ComfyNodeDefImpl?N:new ComfyNodeDefImpl(N);T[N.name]=L,E[N.display_name]=L}i.value=T,o.value=E}p(_,"updateNodeDefs");function y(I){const T=new ComfyNodeDefImpl(I);i.value[I.name]=T,o.value[I.display_name]=T}p(y,"addNodeDef");function b(I){const T=I.constructor?.nodeData?.name??I.type;return T?i.value[T]??null:null}p(b,"fromLGraphNode");function w(I,T){const E=b(I);if(E)return E.inputs[T]}p(w,"getInputSpecForWidget");function k(I){a.value=[...a.value,I]}p(k,"registerNodeDefFilter");function S(I){a.value=a.value.filter(T=>T.id!==I)}p(S,"unregisterNodeDefFilter");function C(){k({id:"core.deprecated",name:"Hide Deprecated Nodes",description:"Hides nodes marked as deprecated unless explicitly enabled",predicate:p(I=>n.value||!I.deprecated,"predicate")}),k({id:"core.experimental",name:"Hide Experimental Nodes",description:"Hides nodes marked as experimental unless explicitly enabled",predicate:p(I=>s.value||!I.experimental,"predicate")}),k({id:"core.subgraph",name:"Hide Subgraph Nodes",description:"Temporarily hides subgraph nodes from node library and search",predicate:p(I=>!(I.category==="subgraph"&&I.python_module==="nodes"),"predicate")})}return p(C,"registerCoreNodeDefFilters"),C(),{nodeDefsByName:i,nodeDefsByDisplayName:o,showDeprecated:n,showExperimental:s,nodeDefFilters:a,nodeDefs:r,nodeDataTypes:l,visibleNodeDefs:u,nodeSearchService:m,nodeTree:f,updateNodeDefs:_,addNodeDef:y,fromLGraphNode:b,getInputSpecForWidget:w,registerNodeDefFilter:k,unregisterNodeDefFilter:S}}),useNodeFrequencyStore=defineStore("nodeFrequency",()=>{const i=ref(64),o=ref({}),n=computed(()=>Object.keys(o.value)),s=ref(!1),a=p(async()=>{if(!s.value)try{const f=await axios.get("assets/sorted-custom-node-map.json");o.value=f.data,s.value=!0}catch(f){console.error("Error loading node frequencies:",f)}},"loadNodeFrequencies"),r=p(f=>l(f.name),"getNodeFrequency"),l=p(f=>o.value[f]??0,"getNodeFrequencyByName"),u=useNodeDefStore(),m=computed(()=>n.value.map(f=>u.nodeDefsByName[f]).filter(f=>f!==void 0).slice(0,i.value));return{nodeNamesByFrequency:n,topNodeDefs:m,isLoaded:s,loadNodeFrequencies:a,getNodeFrequency:r,getNodeFrequencyByName:l}}),INDUSTRY_CATEGORIES=[{name:"Film / TV / Animation",userCount:2885,keywords:["film","tv","television","animation","animation studio","tv production","film production","story","anime","video","cinematography","visual effects","vfx","vfx artist","movie","cinema","documentary","documentary filmmaker","broadcast","streaming","production","director","filmmaker","post-production","editing"]},{name:"Marketing / Advertising / Social Media",userCount:1340,keywords:["marketing","advertising","youtube","tiktok","social media","content creation","influencer","brand","promotion","digital marketing","seo","campaigns","copywriting","growth","engagement"]},{name:"Software / IT / AI",userCount:1100,keywords:["software","software development","software engineer","it","ai","ai research","corporate ai research","ai research lab","tech company ai research","developer","app developer","consulting","tech","tech startup","programmer","data science","machine learning","coding","programming","web development","app development","saas"]},{name:"Product & Industrial Design",userCount:1050,keywords:["product design","industrial","manufacturing","3d rendering","product visualization","mechanical","automotive","cad","prototype","design engineering","invention"]},{name:"Fine Art / Contemporary Art",userCount:780,keywords:["fine art","art","illustration","contemporary","artist","painting","drawing","sculpture","gallery","canvas","digital art","mixed media","abstract","portrait"]},{name:"Education / Research",userCount:640,keywords:["education","student","teacher","research","university research","academic ai research","university ai research","ai research at university","learning","university","school","academic","professor","curriculum","training","instruction","pedagogy"]},{name:"Architecture / Engineering / Construction",userCount:420,keywords:["architecture","architecture firm","construction","engineering","civil","civil engineering","cad","building","structural","landscape","landscape architecture","interior design","real estate","planning","blueprints"]},{name:"Gaming / Interactive Media",userCount:410,keywords:["gaming","game dev","game development","indie game studio","vr development","roblox","interactive","interactive media","virtual world","vr","ar","metaverse","simulation","unity","unity developer","unreal","indie games"]},{name:"Photography / Videography",userCount:70,keywords:["photography","photo","videography","camera","image","portrait","wedding","commercial photo","stock photography","photojournalism","event photography"]},{name:"Fashion / Beauty / Retail",userCount:25,keywords:["fashion","fashion design","beauty","beauty industry","jewelry","jewelry design","custom jewelry design","retail","retail store","style","clothing","cosmetics","makeup","accessories","boutique"]},{name:"Music / Performing Arts",userCount:25,keywords:["music","music production","vj","dance","projection mapping","audio visual","concert","concert production","performance","theater","stage","live events"]},{name:"Healthcare / Medical / Life Science",userCount:30,keywords:["healthcare","medical","medical research","doctor","biotech","life science","pharmaceutical","clinical","clinical research","hospital","medicine","health"]},{name:"E-commerce / Print-on-Demand / Business",userCount:15,keywords:["ecommerce","e-commerce","print on demand","shop","business","commercial","startup","entrepreneur","sales","online store"]},{name:"Nonprofit / Government / Public Sector",userCount:15,keywords:["501c3","ngo","government","public service","policy","nonprofit","charity","civic","community","social impact"]},{name:"Adult / NSFW",userCount:10,keywords:["nsfw","nsfw content","adult","adult entertainment","erotic","explicit","xxx","porn"]}],USE_CASE_CATEGORIES=[{name:"Content Creation & Marketing",keywords:["content creation","social media","marketing","marketing campaigns","advertising","youtube","youtube thumbnail","youtube thumbnail generation","tiktok","instagram","thumbnails","posts","campaigns","brand content"]},{name:"Art & Illustration",keywords:["art","illustration","drawing","painting","concept art","creating concept art","character design","digital art","fantasy art","portraits"]},{name:"Product Visualization & Design",keywords:["product","product mockup","product mockup creation","visualization","prototype visualization","design","prototype","mockup","3d rendering","industrial design","product photos"]},{name:"Film & Video Production",keywords:["film","video","video editing","movie","movie production","animation","vfx","visual effects","storyboard","storyboard creation","cinematography","post production"]},{name:"Gaming & Interactive Media",keywords:["game","gaming","game asset generation","game assets","game development","game textures","interactive","vr","vr content creation","ar","virtual","simulation","metaverse","textures"]},{name:"Architecture & Construction",keywords:["architecture","architectural rendering","building","building visualization","construction","interior design","interior design mockups","landscape","real estate","real estate visualization","floor plans","renderings"]},{name:"Education & Training",keywords:["education","educational","educational content","training","training materials","learning","teaching","tutorial","tutorial creation","course","academic","academic projects","instructional","workshops"]},{name:"Research & Development",keywords:["research","research experiments","development","experiment","prototype","prototype testing","testing","analysis","study","innovation","innovation projects","r&d","scientific visualization"]},{name:"Personal & Hobby",keywords:["personal","personal art projects","hobby","hobby work","fun","fun experiments","experiment","learning","curiosity","explore","creative","creative exploration","side project"]},{name:"Photography & Image Processing",keywords:["photography","product photography","portrait photography","photo","photo editing","image","image enhancement","portrait","editing","enhancement","restoration","photo manipulation"]}],FUSE_OPTIONS={keys:["keywords"],threshold:.53,minMatchCharLength:5,includeScore:!0,includeMatches:!0,ignoreLocation:!0,findAllMatches:!0};new Fuse(INDUSTRY_CATEGORIES,FUSE_OPTIONS);new Fuse(USE_CASE_CATEGORIES,FUSE_OPTIONS);let _telemetryProvider=null;function useTelemetry(){return _telemetryProvider}p(useTelemetry,"useTelemetry");let ComfyDialog$1=class extends EventTarget{static{p(this,"ComfyDialog")}element;textElement;#e;constructor(o="div",n=null){super(),this.#e=n,this.element=$el(o+".comfy-modal",{parent:document.body},[$el("div.comfy-modal-content",[$el("p",{$:p(s=>this.textElement=s,"$")}),...this.createButtons()])])}createButtons(){return this.#e??[$el("button",{type:"button",textContent:"Close",onclick:p(()=>this.close(),"onclick")})]}close(){this.element.style.display="none"}show(o){typeof o=="string"?this.textElement.innerHTML=o:this.textElement.replaceChildren(...o instanceof Array?o:[o]),this.element.style.display="flex"}};window.comfyAPI=window.comfyAPI||{};window.comfyAPI.dialog=window.comfyAPI.dialog||{};window.comfyAPI.dialog.ComfyDialog=ComfyDialog$1;class ComfySettingsDialog extends ComfyDialog$1{static{p(this,"ComfySettingsDialog")}app;constructor(o){super(),this.app=o}dispatchChange(o,n,s){this.dispatchEvent(new CustomEvent(o+".change",{detail:{value:n,oldValue:s}}))}get settingsValues(){return useSettingStore().settingValues}get settingsLookup(){return useSettingStore().settingsById}get settingsParamLookup(){return useSettingStore().settingsById}getSettingValue(o,n){return n!==void 0&&console.warn("Parameter defaultValue is deprecated. The default value in settings definition will be used instead."),useSettingStore().get(o)}getSettingDefaultValue(o){return useSettingStore().getDefaultValue(o)}async setSettingValueAsync(o,n){await useSettingStore().set(o,n)}setSettingValue(o,n){useSettingStore().set(o,n).catch(s=>{useToastStore().addAlert(t("toastMessages.errorSaveSetting",{id:o,err:s}))})}addSetting(o){const n=useSettingStore();return n.addSetting(o),{get value(){return n.get(o.id)},set value(s){n.set(o.id,s)}}}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.settings=window.comfyAPI.settings||{};window.comfyAPI.settings.ComfySettingsDialog=ComfySettingsDialog;function toggleSwitch(i,o,n){const s=n?.onChange;let a,r;function l(m){a!=null&&r[a].classList.remove("comfy-toggle-selected"),s?.({item:o[m],prev:a==null?void 0:o[a]}),a=m,r[a].classList.add("comfy-toggle-selected")}p(l,"updateSelected"),r=o.map((m,f)=>{typeof m=="string"&&(m={text:m}),m.value||(m.value=m.text);const _=$el("label",{textContent:m.text,title:m.tooltip??""},$el("input",{name:i,type:"radio",value:m.value??m.text,checked:m.selected,onchange:p(()=>{l(f)},"onchange")}));return m.selected&&l(f),_});const u=$el("div.comfy-toggle-switch",r);return a==null&&(r[0].children[0].checked=!0,l(0)),u}p(toggleSwitch,"toggleSwitch");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.toggleSwitch=window.comfyAPI.toggleSwitch||{};window.comfyAPI.toggleSwitch.toggleSwitch=toggleSwitch;const ComfyDialog=ComfyDialog$1;function $el(i,o,n){const s=i.split("."),a=document.createElement(s.shift());if(s.length>0&&a.classList.add(...s),o)if(typeof o=="string"?o={textContent:o}:o instanceof Element&&(o=[o]),Array.isArray(o))a.append(...o);else{const{parent:r,$:l,dataset:u,style:m,...f}=o;f.for&&a.setAttribute("for",f.for),m&&Object.assign(a.style,m),u&&Object.assign(a.dataset,u),Object.assign(a,f),n&&a.append(...Array.isArray(n)?n:[n]),r&&r.append(a),l&&l(a)}return a}p($el,"$el");function dragElement(i){var o=0,n=0,s=0,a=0,r=0,l=0;i.getElementsByClassName("drag-handle")[0]?i.getElementsByClassName("drag-handle")[0].onmousedown=y:i.onmousedown=y,new ResizeObserver(()=>{u()}).observe(i);function u(){try{r=Math.min(document.body.clientWidth-i.clientWidth,Math.max(0,i.offsetLeft)),l=Math.min(document.body.clientHeight-i.clientHeight,Math.max(0,i.offsetTop)),m()}catch{}}p(u,"ensureInBounds");function m(){if(i.style.display==="none")return;const k=document.body.clientWidth/2;r+i.clientWidth/2>k?(i.style.left="unset",i.style.right=document.body.clientWidth-r-i.clientWidth+"px"):(i.style.left=r+"px",i.style.right="unset"),i.style.top=l+"px",i.style.bottom="unset",_&&localStorage.setItem("Comfy.MenuPosition",JSON.stringify({x:i.offsetLeft,y:i.offsetTop}))}p(m,"positionElement");function f(){let k=localStorage.getItem("Comfy.MenuPosition");if(k){const S=JSON.parse(k);r=S.x,l=S.y,m(),u()}}p(f,"restorePos");let _;f(),_=!0;function y(k){k=k||window.event,k.preventDefault(),s=k.clientX,a=k.clientY,document.onmouseup=w,document.onmousemove=b}p(y,"dragMouseDown");function b(k){k=k||window.event,k.preventDefault(),i.classList.add("comfy-menu-manual-pos"),o=k.clientX-s,n=k.clientY-a,s=k.clientX,a=k.clientY,r=Math.min(document.body.clientWidth-i.clientWidth,Math.max(0,i.offsetLeft+o)),l=Math.min(document.body.clientHeight-i.clientHeight,Math.max(0,i.offsetTop+n)),m()}p(b,"elementDrag"),window.addEventListener("resize",()=>{u()});function w(){document.onmouseup=null,document.onmousemove=null}return p(w,"closeDragElement"),f}p(dragElement,"dragElement");class ComfyList{static{p(this,"ComfyList")}#e;#t;#o;element;button;constructor(o,n,s){this.#t=o,this.#e=n||o.toLowerCase(),this.#o=s||!1,this.element=$el("div.comfy-list"),this.element.style.display="none"}get visible(){return this.element.style.display!=="none"}async load(){const o=await api.getItems(this.#e);this.element.replaceChildren(...Object.keys(o).flatMap(n=>[$el("h4",{textContent:n}),$el("div.comfy-list-items",[...(this.#o?o[n].reverse():o[n]).map(s=>{const a="remove"in s?s.remove:{name:"Delete",cb:p(()=>api.deleteItem(this.#e,s.prompt[1]),"cb")};return $el("div",{textContent:s.prompt[0]+": "},[$el("button",{textContent:"Load",onclick:p(async()=>{if(await app$1.loadGraphData(s.prompt[3].extra_pnginfo.workflow,!0,!1),"outputs"in s){app$1.nodeOutputs={};for(const[r,l]of Object.entries(s.outputs)){const u=s.meta?.[r]?.display_node??r;app$1.nodeOutputs[u]=l}}},"onclick")}),$el("button",{textContent:a.name,onclick:p(async()=>{await a.cb(),await this.update()},"onclick")})])})])]),$el("div.comfy-list-actions",[$el("button",{textContent:"Clear "+this.#t,onclick:p(async()=>{await api.clearItems(this.#e),await this.load()},"onclick")}),$el("button",{textContent:"Refresh",onclick:p(()=>this.load(),"onclick")})]))}async update(){this.visible&&await this.load()}async show(){this.element.style.display="block",this.button.textContent="Close",await this.load()}hide(){this.element.style.display="none",this.button.textContent="View "+this.#t}toggle(){return this.visible?(this.hide(),!1):(this.show(),!0)}}class ComfyUI{static{p(this,"ComfyUI")}app;dialog;settings;batchCount;lastQueueSize;queue;history;autoQueueMode;graphHasChanged;autoQueueEnabled;menuContainer;queueSize;restoreMenuPosition;loadFile;constructor(o){this.app=o,this.dialog=new ComfyDialog,this.settings=new ComfySettingsDialog(o),this.batchCount=1,this.lastQueueSize=0,this.queue=new ComfyList("Queue"),this.history=new ComfyList("History","history",!0),api.addEventListener("status",()=>{this.queue.update(),this.history.update()}),this.setup(document.body)}setup(o){const n=$el("input",{id:"comfy-file-input",type:"file",accept:WORKFLOW_ACCEPT_STRING,style:{display:"none"},parent:document.body,onchange:p(async()=>{const a=n.files?.[0];a&&(await app$1.handleFile(a,"file_button"),n.value="")},"onchange")});this.loadFile=()=>n.click();const s=toggleSwitch("autoQueueMode",[{text:"instant",tooltip:"A new prompt will be queued as soon as the queue reaches 0"},{text:"change",tooltip:"A new prompt will be queued when the queue is at 0 and the graph is/has changed"}],{onChange:p(a=>{this.autoQueueMode=a.item.value},"onChange")});s.style.display="none",api.addEventListener("graphChanged",()=>{this.autoQueueMode==="change"&&this.autoQueueEnabled===!0&&(this.lastQueueSize===0?(this.graphHasChanged=!1,app$1.queuePrompt(0,this.batchCount)):this.graphHasChanged=!0)}),this.menuContainer=$el("div.comfy-menu.no-drag",{parent:o},[$el("div.drag-handle.comfy-menu-header",{style:{overflow:"hidden",position:"relative",width:"100%",cursor:"default"}},[$el("span.drag-handle"),$el("span.comfy-menu-queue-size",{$:p(a=>this.queueSize=a,"$")}),$el("div.comfy-menu-actions",[$el("button.comfy-settings-btn",{textContent:"âš™ï¸",onclick:p(()=>{useDialogService().showSettingsDialog()},"onclick")}),$el("button.comfy-close-menu-btn",{textContent:"Ã—",onclick:p(()=>{useWorkspaceStore().focusMode=!0},"onclick")})])]),$el("button.comfy-queue-btn",{id:"queue-button",textContent:"Queue Prompt",onclick:p(()=>{app$1.queuePrompt(0,this.batchCount)},"onclick")}),$el("div",{},[$el("label",{innerHTML:"Extra options"},[$el("input",{type:"checkbox",onchange:p(a=>{document.getElementById("extraOptions").style.display=a.srcElement.checked?"block":"none",this.batchCount=a.srcElement.checked?Number.parseInt(document.getElementById("batchCountInputRange").value):1,document.getElementById("autoQueueCheckbox").checked=!1,this.autoQueueEnabled=!1},"onchange")})])]),$el("div",{id:"extraOptions",style:{width:"100%",display:"none"}},[$el("div",[$el("label",{innerHTML:"Batch count"}),$el("input",{id:"batchCountInputNumber",type:"number",value:this.batchCount,min:"1",style:{width:"35%",marginLeft:"0.4em"},oninput:p(a=>{this.batchCount=a.target.value,document.getElementById("batchCountInputRange").value=this.batchCount.toString()},"oninput")}),$el("input",{id:"batchCountInputRange",type:"range",min:"1",max:"100",value:this.batchCount,oninput:p(a=>{this.batchCount=a.srcElement.value,document.getElementById("batchCountInputNumber").value=a.srcElement.value},"oninput")})]),$el("div",[$el("label",{for:"autoQueueCheckbox",innerHTML:"Auto Queue"}),$el("input",{id:"autoQueueCheckbox",type:"checkbox",checked:!1,title:"Automatically queue prompt when the queue size hits 0",onchange:p(a=>{this.autoQueueEnabled=a.target.checked,s.style.display=this.autoQueueEnabled?"":"none"},"onchange")}),s])]),$el("div.comfy-menu-btns",[$el("button",{id:"queue-front-button",textContent:"Queue Front",onclick:p(()=>{app$1.queuePrompt(-1,this.batchCount)},"onclick")}),$el("button",{$:p(a=>this.queue.button=a,"$"),id:"comfy-view-queue-button",textContent:"View Queue",onclick:p(()=>{this.history.hide(),this.queue.toggle()},"onclick")}),$el("button",{$:p(a=>this.history.button=a,"$"),id:"comfy-view-history-button",textContent:"View History",onclick:p(()=>{this.queue.hide(),this.history.toggle()},"onclick")})]),this.queue.element,this.history.element,$el("button",{id:"comfy-save-button",textContent:"Save",onclick:p(()=>{useCommandStore().execute("Comfy.ExportWorkflow")},"onclick")}),$el("button",{id:"comfy-dev-save-api-button",textContent:"Save (API Format)",style:{width:"100%",display:"none"},onclick:p(()=>{useCommandStore().execute("Comfy.ExportWorkflowAPI")},"onclick")}),$el("button",{id:"comfy-load-button",textContent:"Load",onclick:p(()=>n.click(),"onclick")}),$el("button",{id:"comfy-refresh-button",textContent:"Refresh",onclick:p(()=>app$1.refreshComboInNodes(),"onclick")}),$el("button",{id:"comfy-clipspace-button",textContent:"Clipspace",onclick:p(()=>app$1.openClipspace(),"onclick")}),$el("button",{id:"comfy-clear-button",textContent:"Clear",onclick:p(()=>{(!useSettingStore().get("Comfy.ConfirmClear")||confirm("Clear workflow?"))&&(app$1.clean(),useLitegraphService().resetView(),api.dispatchCustomEvent("graphCleared"))},"onclick")}),$el("button",{id:"comfy-load-default-button",textContent:"Load Default",onclick:p(async()=>{(!useSettingStore().get("Comfy.ConfirmClear")||confirm("Load default workflow?"))&&(useLitegraphService().resetView(),await app$1.loadGraphData())},"onclick")}),$el("button",{id:"comfy-reset-view-button",textContent:"Reset View",onclick:p(async()=>{useLitegraphService().resetView()},"onclick")})]),this.menuContainer.style.display="none",this.restoreMenuPosition=dragElement(this.menuContainer),this.setStatus({exec_info:{queue_remaining:"X"}})}setStatus(o){this.queueSize.textContent="Queue size: "+(o?o.exec_info.queue_remaining:"ERR"),o&&(this.lastQueueSize!=0&&o.exec_info.queue_remaining==0&&this.autoQueueEnabled&&(this.autoQueueMode==="instant"||this.graphHasChanged)&&!app$1.lastExecutionError&&(app$1.queuePrompt(0,this.batchCount),o.exec_info.queue_remaining+=this.batchCount,this.graphHasChanged=!1),this.lastQueueSize=o.exec_info.queue_remaining)}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.ui=window.comfyAPI.ui||{};window.comfyAPI.ui.ComfyDialog=ComfyDialog;window.comfyAPI.ui.$el=$el;window.comfyAPI.ui.ComfyUI=ComfyUI;function calculateImageGrid(i,o,n){let s=0,a=i[0].naturalWidth,r=i[0].naturalHeight;const l=i.length;let u,m,f,_,y;for(let b=1;b<=l;b++){const w=Math.ceil(l/b),k=o/b,S=n/w,C=k/a,I=S/r,T=Math.min(C,I,1),E=a*T,N=r*T,L=E*N*l;L>s&&(s=L,u=E,m=N,f=b,_=w,y=b*((k-E)/2))}return{cellWidth:u,cellHeight:m,cols:f,rows:_,shiftX:y}}p(calculateImageGrid,"calculateImageGrid");function createImageHost(i){const o=$el("div.comfy-img-preview");let n,s=!0;function a(){let r=null,l=null;if(n){let u=o.clientHeight;s?(s=!1,u<190&&(u=190),o.style.setProperty("--comfy-widget-min-height",u.toString())):o.style.setProperty("--comfy-widget-min-height",null);const m=i.size[0];({cellWidth:r,cellHeight:l}=calculateImageGrid(n,m-20,u)),r+="px",l+="px",o.style.setProperty("--comfy-img-preview-width",r),o.style.setProperty("--comfy-img-preview-height",l)}}return p(a,"updateSize"),{el:o,getCurrentImage(){return n?.[0]},updateImages(r){r!==n&&(n==null&&requestAnimationFrame(()=>{a()}),o.replaceChildren(...r),n=r,i.onResize?.(i.size),i.graph?.setDirtyCanvas(!0,!0))},getHeight(){a()},onDraw(){o.style.pointerEvents="all";const r=document.elementFromPoint(app$1.canvas.mouse[0],app$1.canvas.mouse[1]);if(o.style.pointerEvents="none",!r)return;const l=n.indexOf(r);i.overIndex=l}}}p(createImageHost,"createImageHost");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.imagePreview=window.comfyAPI.imagePreview||{};window.comfyAPI.imagePreview.calculateImageGrid=calculateImageGrid;window.comfyAPI.imagePreview.createImageHost=createImageHost;const renderPreview=p((i,o,n,s)=>{const a=useCanvasStore().getCanvas(),r=a.graph_mouse;!a.pointer_is_down&&o.pointerDown&&(r[0]===o.pointerDown.pos[0]&&r[1]===o.pointerDown.pos[1]&&(o.imageIndex=o.pointerDown.index),o.pointerDown=null);const l=o.imgs??[];let{imageIndex:u}=o;const m=l.length;m===1&&!u&&(o.imageIndex=u=0);const _=useSettingStore().get("Comfy.Node.AllowImageSizeDraw"),y=_?15:0,b=o.size[0],w=s?s-y:0;if(u==null){let O,M,P,R,V;const $=is_all_same_aspect_ratio(l);if($)R=0,{cellWidth:O,cellHeight:M,cols:V,shiftX:P}=calculateImageGrid(l,b,w);else{R=2;const j=l.reduce((G,H)=>Math.max(G,H.naturalWidth,H.naturalHeight),0),U=[];U.length=l.length,U[0]={naturalWidth:j,naturalHeight:j},{cellWidth:O,cellHeight:M,cols:V,shiftX:P}=calculateImageGrid(U,b,w)}let F=!1;o.imageRects=[];for(let j=0;j<m;j++){const U=l[j],G=Math.floor(j/V),H=j%V,W=H*O+P,X=G*M+n;if(!F&&(F=LiteGraph.isInsideRectangle(r[0],r[1],W+o.pos[0],X+o.pos[1],O,M),F)){o.overIndex=j;let K=110;a.pointer_is_down&&((!o.pointerDown||o.pointerDown.index!==j)&&(o.pointerDown={index:j,pos:[...r]}),K=125),i.filter=`contrast(${K}%) brightness(${K}%)`,a.canvas.style.cursor="pointer"}o.imageRects.push([W,X,O,M]);const Q=O/U.width,q=M/U.height,ee=Math.min(Q,q),Y=ee*U.height,ae=G*M+n+(M-Y)/2,re=ee*U.width,ue=H*O+P+(O-re)/2;i.drawImage(U,ue+R,ae+R,re-R*2,Y-R*2),$||(i.strokeStyle="#8F8F8F",i.lineWidth=1,i.strokeRect(W+R,X+R,O-R*2,M-R*2)),i.filter="none"}F||(o.pointerDown=null,o.overIndex=null);return}const k=l[u];let S=k.naturalWidth,C=k.naturalHeight;const I=b/S,T=w/C,E=Math.min(I,T,1);S*=E,C*=E;const N=(b-S)/2,L=(w-C)/2+n;if(i.drawImage(k,N,L,S,C),_){i.fillStyle=LiteGraph.NODE_TEXT_COLOR,i.textAlign="center",i.font="10px sans-serif";const O=`${Math.round(k.naturalWidth)} Ã— ${Math.round(k.naturalHeight)}`,M=L+C+10;i.fillText(O,N+S/2,M)}const A=p((O,M,P,R)=>{const V=LiteGraph.isInsideRectangle(r[0],r[1],O+o.pos[0],M+o.pos[1],P,P);let $="#333",F="#fff",j=!1;return V&&(a.canvas.style.cursor="pointer",a.pointer_is_down?($="#1e90ff",j=!0):($="#eee",F="#000")),i.fillStyle=$,i.beginPath(),i.roundRect(O,M,P,P,[4]),i.fill(),i.fillStyle=F,i.font="12px Arial",i.textAlign="center",i.fillText(R,O+15,M+20),j},"drawButton");if(!(m>1))return;const D=(o.imageIndex??0)+1;if(A(b-40,w+n-40,30,`${D}/${m}`)){const O=D>=m?0:D;(!o.pointerDown||o.pointerDown.index!==O)&&(o.pointerDown={index:O,pos:[...r]})}A(b-40,n+10,30,"x")&&(!o.pointerDown||o.pointerDown.index!==null)&&(o.pointerDown={index:null,pos:[...r]})},"renderPreview");class ImagePreviewWidget extends BaseWidget{static{p(this,"ImagePreviewWidget")}constructor(o,n,s){const a={name:n,options:s,type:"custom",value:"",y:0};super(a,o),this.serialize=!1}drawWidget(o){renderPreview(o,this.node,this.y,this.computedHeight)}onPointerDown(o,n){return o.onDragStart=()=>{const{canvas:s}=app$1,{graph:a}=s;s.emitBeforeChange(),a?.beforeChange(),o.finally=()=>{s.isDragging=!1,a?.afterChange(),s.emitAfterChange()},s.processSelect(n,o.eDown),s.isDragging=!0},o.onDragEnd=s=>{const{canvas:a}=app$1;(s.shiftKey||LiteGraph.alwaysSnapToGrid)&&a.graph?.snapToGrid(a.selectedItems),a.setDirty(!0,!0)},!0}onClick(){}computeLayoutSize(){return{minHeight:220,minWidth:1}}}const useImagePreviewWidget=p(()=>p((o,n)=>o.addCustomWidget(new ImagePreviewWidget(o,n.name,{serialize:!1})),"widgetConstructor"),"useImagePreviewWidget"),CANVAS_IMAGE_PREVIEW_WIDGET="$$canvas-image-preview";function useNodeCanvasImagePreview(){const i=useImagePreviewWidget();function o(s){s.imgs?.length&&(s.widgets?.find(a=>a.name===CANVAS_IMAGE_PREVIEW_WIDGET)||i(s,{type:"IMAGE_PREVIEW",name:CANVAS_IMAGE_PREVIEW_WIDGET}))}p(o,"showCanvasImagePreview");function n(s){if(!s.widgets)return;const a=s.widgets.findIndex(r=>r.name===CANVAS_IMAGE_PREVIEW_WIDGET);a>-1&&(s.widgets[a].onRemove?.(),s.widgets.splice(a,1))}return p(n,"removeCanvasImagePreview"),{showCanvasImagePreview:o,removeCanvasImagePreview:n}}p(useNodeCanvasImagePreview,"useNodeCanvasImagePreview");const _hoisted_1$1g={class:"pointer-events-none flex-1"},_hoisted_2$$={class:"text-[10px] text-slate-100"},_hoisted_3$H={class:"text-xs"},_sfc_main$1s=defineComponent({__name:"SubgraphNodeWidget",props:{nodeTitle:{},widgetName:{},isShown:{type:Boolean},isDraggable:{type:Boolean},isPhysical:{type:Boolean}},emits:["toggleVisibility"],setup(i){const o=i;function n(){return cn("flex py-1 pr-4 pl-0 break-all rounded items-center gap-1","bg-node-component-surface",o.isDraggable&&"draggable-item drag-handle cursor-grab [&.is-draggable]:cursor-grabbing")}p(n,"classes");function s(){return o.isPhysical?"icon-[lucide--link]":o.isDraggable?"icon-[lucide--eye]":"icon-[lucide--eye-off]"}return p(s,"getIcon"),(a,r)=>(openBlock(),createElementBlock("div",{class:normalizeClass(n())},[createBaseVNode("div",{class:normalizeClass(unref(cn)("size-4 pointer-events-none",a.isDraggable?"icon-[lucide--grip-vertical]":""))},null,2),createBaseVNode("div",_hoisted_1$1g,[createBaseVNode("div",_hoisted_2$$,toDisplayString(a.nodeTitle),1),createBaseVNode("div",_hoisted_3$H,toDisplayString(a.widgetName),1)]),createVNode(unref(script),{size:"small",text:"",icon:s(),disabled:a.isPhysical,severity:"secondary",onClick:r[0]||(r[0]=withModifiers(l=>a.$emit("toggleVisibility"),["stop"]))},null,8,["icon","disabled"])],2))}}),styleElement=document.createElement("style");styleElement.textContent=`
        .draggable-item {
            position: relative;
            will-change: transform;
            user-select: none;
        }
        .draggable-item.is-idle {
            transition: 0.25s ease transform;
        }
        .draggable-item.is-draggable {
            z-index: 10;
        }
    `;document.head.append(styleElement);class DraggableList extends EventTarget{static{p(this,"DraggableList")}listContainer;draggableItem;pointerStartX;pointerStartY;scrollYMax;itemsGap=0;items=[];itemSelector;handleClass="drag-handle";off=[];offDrag=[];constructor(o,n){super(),this.listContainer=o,this.itemSelector=n,this.listContainer&&(this.off.push(this.on(this.listContainer,"mousedown",this.dragStart)),this.off.push(this.on(this.listContainer,"touchstart",this.dragStart)),this.off.push(this.on(document,"mouseup",this.dragEnd)),this.off.push(this.on(document,"touchend",this.dragEnd)))}getAllItems(){return this.items?.length||(this.items=Array.from(this.listContainer.querySelectorAll(this.itemSelector)),this.items.forEach(o=>{o.classList.add("is-idle")})),this.items}getIdleItems(){return this.getAllItems().filter(o=>o.classList.contains("is-idle"))}isItemAbove(o){return o.hasAttribute("data-is-above")}isItemToggled(o){return o.hasAttribute("data-is-toggled")}on(o,n,s,a){return s=s.bind(this),o.addEventListener(n,s,a),()=>o.removeEventListener(n,s)}dragStart(o){o.target.classList.contains(this.handleClass)&&(this.draggableItem=o.target.closest(this.itemSelector)),this.draggableItem&&(this.pointerStartX=o.clientX||o.touches[0].clientX,this.pointerStartY=o.clientY||o.touches[0].clientY,this.scrollYMax=this.listContainer.scrollHeight-this.listContainer.clientHeight,this.setItemsGap(),this.initDraggableItem(),this.initItemsState(),this.offDrag.push(this.on(document,"mousemove",this.drag)),this.offDrag.push(this.on(document,"touchmove",this.drag,{passive:!1})),this.dispatchEvent(new CustomEvent("dragstart",{detail:{element:this.draggableItem,position:this.getAllItems().indexOf(this.draggableItem)}})))}setItemsGap(){if(this.getIdleItems().length<=1){this.itemsGap=0;return}const o=this.getIdleItems()[0],n=this.getIdleItems()[1],s=o.getBoundingClientRect(),a=n.getBoundingClientRect();this.itemsGap=Math.abs(s.bottom-a.top)}initItemsState(){this.getIdleItems().forEach((o,n)=>{this.getAllItems().indexOf(this.draggableItem)>n&&(o.dataset.isAbove="")})}initDraggableItem(){this.draggableItem.classList.remove("is-idle"),this.draggableItem.classList.add("is-draggable")}drag(o){if(!this.draggableItem)return;o.preventDefault();const n=o.clientX||o.touches[0].clientX,s=o.clientY||o.touches[0].clientY,a=this.listContainer.getBoundingClientRect();s>a.bottom?this.listContainer.scrollTop<this.scrollYMax&&(this.listContainer.scrollBy(0,10),this.pointerStartY-=10):s<a.top&&this.listContainer.scrollTop>0&&(this.pointerStartY+=10,this.listContainer.scrollBy(0,-10));const r=n-this.pointerStartX,l=s-this.pointerStartY;this.updateIdleItemsStateAndPosition(),this.draggableItem.style.transform=`translate(${r}px, ${l}px)`}updateIdleItemsStateAndPosition(){const o=this.draggableItem.getBoundingClientRect(),n=o.top+o.height/2;this.getIdleItems().forEach(s=>{const a=s.getBoundingClientRect(),r=a.top+a.height/2;this.isItemAbove(s)?n<=r?s.dataset.isToggled="":delete s.dataset.isToggled:n>=r?s.dataset.isToggled="":delete s.dataset.isToggled}),this.getIdleItems().forEach(s=>{if(this.isItemToggled(s)){const a=this.isItemAbove(s)?1:-1;s.style.transform=`translateY(${a*(o.height+this.itemsGap)}px)`}else s.style.transform=""})}dragEnd(){this.draggableItem&&(this.applyNewItemsOrder(),this.cleanup())}applyNewItemsOrder(){const o=[];let n=-1;this.getAllItems().forEach((s,a)=>{if(s===this.draggableItem){n=a;return}if(!this.isItemToggled(s)){o[a]=s;return}const r=this.isItemAbove(s)?a+1:a-1;o[r]=s});for(let s=0;s<this.getAllItems().length;s++)typeof o[s]>"u"&&(o[s]=this.draggableItem);o.forEach(s=>{this.listContainer.appendChild(s)}),this.items=o,this.dispatchEvent(new CustomEvent("dragend",{detail:{element:this.draggableItem,oldPosition:n,newPosition:o.indexOf(this.draggableItem)}}))}cleanup(){this.itemsGap=0,this.items=[],this.unsetDraggableItem(),this.unsetItemState(),this.offDrag.forEach(o=>o()),this.offDrag=[]}unsetDraggableItem(){this.draggableItem.style=null,this.draggableItem.classList.remove("is-draggable"),this.draggableItem.classList.add("is-idle"),this.draggableItem=null}unsetItemState(){this.getIdleItems().forEach(o=>{delete o.dataset.isAbove,delete o.dataset.isToggled,o.style.transform=""})}dispose(){this.off.forEach(o=>o())}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.draggableList=window.comfyAPI.draggableList||{};window.comfyAPI.draggableList.DraggableList=DraggableList;const _hoisted_1$1f={key:0,class:"border-b-1 border-node-component-border pt-1 pb-4"},_hoisted_2$_={class:"flex justify-between px-4 py-0"},_hoisted_3$G={class:"text-[9px] font-semibold text-slate-100 uppercase"},_hoisted_4$y={key:1,class:"pt-1 pb-4"},_hoisted_5$u={class:"flex justify-between px-4 py-0"},_hoisted_6$l={class:"text-[9px] font-semibold text-slate-100 uppercase"},_hoisted_7$j={key:2,class:"flex justify-center border-t-1 border-node-component-border py-4"},_sfc_main$1r=defineComponent({__name:"SubgraphNode",setup(i){const o=useCanvasStore(),n=ref(void 0),s=ref(),a=ref(""),r=refDebounced(a,200),l=customRef((A,D)=>({get(){A();const O=u.value;return O?parseProxyWidgets(O.properties.proxyWidgets):[]},set(O){D();const M=u.value;if(O){if(!M){console.error("Attempted to toggle widgets with no node selected");return}M.properties.proxyWidgets=O}}})),u=computed(()=>{const A=o.selectedItems[0];if(A instanceof SubgraphNode)return A;useDialogStore().closeDialog()}),m=computed({get(){if(!u.value)return[];const A=u.value;function D([O,M]){if(O==="-1"){const V=A.widgets.find($=>$.name===M);return V?[[{id:-1,title:"(Linked)",type:""},V]]:[]}const P=A.subgraph._nodes_by_id[O];if(!P?.widgets)return[];const R=P.widgets.find(V=>V.name===M);return R?[[P,R]]:[]}return p(D,"mapWidgets"),l.value.flatMap(D)},set(A){if(!u.value){console.error("Attempted to toggle widgets with no node selected");return}l.value=A.map(widgetItemToProperty)}}),f=computed(()=>{const A=u.value;if(!A)return[];const{updatePreviews:D}=useLitegraphService(),O=A.subgraph.nodes;for(const M of O)M.updateComputedDisabled(),D(M);return O.flatMap(S).filter(([M,P])=>!P.computedDisabled)}),_=computed(()=>{if(!u.value)return[];const D=l.value;return f.value.filter(O=>!D.some(matchesPropertyItem(O)))}),y=computed(()=>{const A=r.value.toLowerCase();return A?_.value.filter(([D,O])=>D.title.toLowerCase().includes(A)||O.name.toLowerCase().includes(A)):_.value}),b=computed(()=>u.value?y.value.filter(isRecommendedWidget):[]),w=computed(()=>{const A=r.value.toLowerCase();return A?m.value.filter(([D,O])=>D.title.toLowerCase().includes(A)||O.name.toLowerCase().includes(A)):m.value});function k(A){return`${A[0].id}: ${A[1].name}`}p(k,"toKey");function S(A){return A.widgets?A.widgets.map(D=>[A,D]):[]}p(S,"nodeWidgets");function C([A,D]){const O=u.value;if(!O)return[];demoteWidget(A,D,[O]),triggerRef(l)}p(C,"demote");function I([A,D]){const O=u.value;if(!O)return[];promoteWidget(A,D,[O]),triggerRef(l)}p(I,"promote");function T(){if(!u.value)return;const D=l.value,O=y.value.map(widgetItemToProperty);D.push(...O),l.value=D}p(T,"showAll");function E(){u.value&&(l.value=l.value.filter(D=>!w.value.some(matchesWidgetItem(D))||D[0]==="-1"))}p(E,"hideAll");function N(){if(!u.value)return;const D=l.value,O=b.value.map(widgetItemToProperty);D.push(...O),l.value=D}p(N,"showRecommended");function L(){n.value?.dispose(),!(r.value||!s.value?.children?.length)&&(n.value=new DraggableList(s.value,".draggable-item"),n.value.applyNewItemsOrder=function(){const A=[];let D=-1;this.getAllItems().forEach((R,V)=>{if(R===this.draggableItem){D=V;return}if(!this.isItemToggled(R)){A[V]=R;return}const $=this.isItemAbove(R)?V+1:V-1;A[$]=R});for(let R=0;R<this.getAllItems().length;R++)typeof A[R]>"u"&&(A[R]=this.draggableItem);const O=A.indexOf(this.draggableItem),M=m.value,[P]=M.splice(D,1);M.splice(O,0,P),m.value=M})}return p(L,"setDraggableState"),watchDebounced(w,()=>{L()},{debounce:100}),onMounted(()=>{L(),u.value&&pruneDisconnected(u.value)}),onBeforeUnmount(()=>{n.value?.dispose()}),(A,D)=>{const O=resolveComponent("Button");return openBlock(),createElementBlock(Fragment,null,[createVNode(SearchBox,{"model-value":a.value,"onUpdate:modelValue":D[0]||(D[0]=M=>a.value=M),class:"p-2",placeholder:A.$t("g.search")+"..."},null,8,["model-value","placeholder"]),w.value.length?(openBlock(),createElementBlock("div",_hoisted_1$1f,[createBaseVNode("div",_hoisted_2$_,[createBaseVNode("div",_hoisted_3$G,toDisplayString(A.$t("subgraphStore.shown")),1),createBaseVNode("a",{class:"cursor-pointer text-right text-[11px] font-normal text-azure-600",onClick:withModifiers(E,["stop"])},toDisplayString(A.$t("subgraphStore.hideAll")),1)]),createBaseVNode("div",{ref_key:"draggableItems",ref:s},[(openBlock(!0),createElementBlock(Fragment,null,renderList(w.value,([M,P])=>(openBlock(),createBlock(_sfc_main$1s,{key:k([M,P]),"node-title":M.title,"widget-name":P.name,"is-shown":!0,"is-draggable":!unref(r),"is-physical":M.id===-1,onToggleVisibility:p(R=>C([M,P]),"onToggleVisibility")},null,8,["node-title","widget-name","is-draggable","is-physical","onToggleVisibility"]))),128))],512)])):createCommentVNode("",!0),y.value.length?(openBlock(),createElementBlock("div",_hoisted_4$y,[createBaseVNode("div",_hoisted_5$u,[createBaseVNode("div",_hoisted_6$l,toDisplayString(A.$t("subgraphStore.hidden")),1),createBaseVNode("a",{class:"cursor-pointer text-right text-[11px] font-normal text-azure-600",onClick:withModifiers(T,["stop"])},toDisplayString(A.$t("subgraphStore.showAll")),1)]),(openBlock(!0),createElementBlock(Fragment,null,renderList(y.value,([M,P])=>(openBlock(),createBlock(_sfc_main$1s,{key:k([M,P]),"node-title":M.title,"widget-name":P.name,onToggleVisibility:p(R=>I([M,P]),"onToggleVisibility")},null,8,["node-title","widget-name","onToggleVisibility"]))),128))])):createCommentVNode("",!0),b.value.length?(openBlock(),createElementBlock("div",_hoisted_7$j,[createVNode(O,{size:"small",class:"rounded border-none px-3 py-0.5",onClick:withModifiers(N,["stop"])},{default:withCtx(()=>[createTextVNode(toDisplayString(A.$t("subgraphStore.showRecommended")),1)]),_:1})])):createCommentVNode("",!0)],64)}}}),key="global-subgraph-node-config";function showSubgraphNodeDialog(){const i=useDialogStore(),o={modal:!1,position:"topright",pt:{root:{class:"bg-node-component-surface mt-22"},header:{class:"h-8 text-xs ml-3"}}};i.showDialog({title:"Parameters",key,component:_sfc_main$1r,dialogComponentProps:o})}p(showSubgraphNodeDialog,"showSubgraphNodeDialog");function getOrderedInputSpecs(i,o){const n=[];if(!i.input_order)return Object.values(o);if(i.input_order.required)for(const a of i.input_order.required){const r=o[a];r&&!r.isOptional&&n.push(r)}if(i.input_order.optional)for(const a of i.input_order.optional){const r=o[a];r&&r.isOptional&&n.push(r)}const s=new Set(n.map(a=>a.name));for(const a of Object.values(o))s.has(a.name)||n.push(a);return n}p(getOrderedInputSpecs,"getOrderedInputSpecs");var BrushShape=(i=>(i.Arc="arc",i.Rect="rect",i))(BrushShape||{}),Tools=(i=>(i.MaskPen="pen",i.PaintPen="rgbPaint",i.Eraser="eraser",i.MaskBucket="paintBucket",i.MaskColorFill="colorSelect",i))(Tools||{});const allTools=["pen","rgbPaint","eraser","paintBucket","colorSelect"];var CompositionOperation=(i=>(i.SourceOver="source-over",i.DestinationOut="destination-out",i))(CompositionOperation||{}),MaskBlendMode=(i=>(i.Black="black",i.White="white",i.Negative="negative",i))(MaskBlendMode||{}),ColorComparisonMethod=(i=>(i.Simple="simple",i.HSL="hsl",i.LAB="lab",i))(ColorComparisonMethod||{});window.comfyAPI=window.comfyAPI||{};window.comfyAPI.types=window.comfyAPI.types||{};window.comfyAPI.types.BrushShape=BrushShape;window.comfyAPI.types.Tools=Tools;window.comfyAPI.types.allTools=allTools;window.comfyAPI.types.CompositionOperation=CompositionOperation;window.comfyAPI.types.MaskBlendMode=MaskBlendMode;window.comfyAPI.types.ColorComparisonMethod=ColorComparisonMethod;function useCanvasHistory(i=20){const o=useMaskEditorStore(),n=ref([]),s=ref(-1),a=ref(!1),r=computed(()=>n.value.length>1&&s.value>0),l=computed(()=>n.value.length>1&&s.value<n.value.length-1),u=p(()=>{const w=o.maskCtx,k=o.rgbCtx,S=o.maskCanvas,C=o.rgbCanvas;if(!w||!k||!S||!C){requestAnimationFrame(u);return}if(!S.width||!C.width){requestAnimationFrame(u);return}n.value=[];const I=w.getImageData(0,0,S.width,S.height),T=k.getImageData(0,0,C.width,C.height);n.value.push({mask:I,rgb:T}),s.value=0,a.value=!0},"saveInitialState"),m=p((w,k)=>{const S=o.maskCtx,C=o.rgbCtx,I=o.maskCanvas,T=o.rgbCanvas;if(!S||!C||!I||!T)return;if(!a.value||s.value===-1){u();return}n.value=n.value.slice(0,s.value+1);let E,N;if(w&&k?(E=w,N=k):(E=S.getImageData(0,0,I.width,I.height),N=C.getImageData(0,0,T.width,T.height)),n.value.push({mask:E,rgb:N}),s.value++,n.value.length>i){const L=n.value.shift();L&&(L.mask instanceof ImageBitmap&&L.mask.close(),L.rgb instanceof ImageBitmap&&L.rgb.close()),s.value--}},"saveState"),f=p(()=>{if(!r.value){alert("No more undo states available");return}s.value--,y(n.value[s.value])},"undo"),_=p(()=>{if(!l.value){alert("No more redo states available");return}s.value++,y(n.value[s.value])},"redo"),y=p(w=>{const k=o.maskCtx,S=o.rgbCtx;!k||!S||(w.mask instanceof ImageBitmap?(k.clearRect(0,0,w.mask.width,w.mask.height),k.drawImage(w.mask,0,0)):k.putImageData(w.mask,0,0),w.rgb instanceof ImageBitmap?(S.clearRect(0,0,w.rgb.width,w.rgb.height),S.drawImage(w.rgb,0,0)):S.putImageData(w.rgb,0,0))},"restoreState");return{canUndo:r,canRedo:l,currentStateIndex:s,saveInitialState:u,saveState:m,undo:f,redo:_,clearStates:p(()=>{n.value.forEach(w=>{w.mask instanceof ImageBitmap&&w.mask.close(),w.rgb instanceof ImageBitmap&&w.rgb.close()}),n.value=[],s.value=-1,a.value=!1},"clearStates")}}p(useCanvasHistory,"useCanvasHistory");const useMaskEditorStore=defineStore("maskEditor",()=>{const i=ref({type:BrushShape.Arc,size:10,opacity:.7,hardness:1,stepSize:10}),o=ref(MaskBlendMode.Black),n=ref("mask"),s=ref("#FF0000"),a=ref(Tools.MaskPen),r=ref(!1),l=ref(5),u=ref(100),m=ref(20),f=ref(!1),_=ref(ColorComparisonMethod.Simple),y=ref(!1),b=ref(!1),w=ref(0),k=ref(100),S=ref(1),C=ref(1),I=ref({x:0,y:0}),T=ref({x:0,y:0}),E=ref(0),N=ref(0),L=ref(null),A=ref(null),D=ref(null),O=ref(null),M=ref(null),P=ref(null),R=ref(null),V=ref(null),$=ref(null),F=ref(null),j=ref(.8),U=ref(!0),G=ref(!1),H=ref(!1),W=useCanvasHistory(20),X=ref(null);watch(L,J=>{J&&(A.value=J.getContext("2d",{willReadFrequently:!0}))}),watch(D,J=>{J&&(O.value=J.getContext("2d",{willReadFrequently:!0}))}),watch(M,J=>{J&&(P.value=J.getContext("2d",{willReadFrequently:!0}))});const Q=computed(()=>W.canUndo.value),q=computed(()=>W.canRedo.value),ee=computed(()=>{switch(o.value){case MaskBlendMode.Black:return{r:0,g:0,b:0};case MaskBlendMode.White:return{r:255,g:255,b:255};case MaskBlendMode.Negative:return{r:255,g:255,b:255};default:return{r:0,g:0,b:0}}});function Y(J){i.value.size=toolkit.clamp(J,1,500)}p(Y,"setBrushSize");function ae(J){i.value.opacity=toolkit.clamp(J,0,1)}p(ae,"setBrushOpacity");function re(J){i.value.hardness=toolkit.clamp(J,0,1)}p(re,"setBrushHardness");function ue(J){i.value.stepSize=toolkit.clamp(J,1,100)}p(ue,"setBrushStepSize");function K(){i.value.type=BrushShape.Arc,i.value.size=20,i.value.opacity=1,i.value.hardness=1,i.value.stepSize=5}p(K,"resetBrushToDefault");function ne(J){l.value=toolkit.clamp(J,0,255)}p(ne,"setPaintBucketTolerance");function de(J){u.value=toolkit.clamp(J,0,100)}p(de,"setFillOpacity");function ve(J){m.value=toolkit.clamp(J,0,255)}p(ve,"setColorSelectTolerance");function _e(J){w.value=toolkit.clamp(J,0,255)}p(_e,"setMaskTolerance");function oe(J){k.value=toolkit.clamp(J,0,100)}p(oe,"setSelectionOpacity");function se(J){S.value=Math.max(.1,Math.min(10,J))}p(se,"setZoomRatio");function he(J){I.value={...J}}p(he,"setPanOffset");function be(J){T.value={...J}}p(be,"setCursorPoint");function Se(){E.value++}p(Se,"resetZoom");function me(){N.value++}p(me,"triggerClear");function fe(J){j.value=toolkit.clamp(J,0,1)}p(fe,"setMaskOpacity");function Z(){i.value={type:BrushShape.Arc,size:10,opacity:.7,hardness:1,stepSize:5},o.value=MaskBlendMode.Black,n.value="mask",s.value="#FF0000",a.value=Tools.MaskPen,r.value=!1,l.value=5,u.value=100,m.value=20,f.value=!1,_.value=ColorComparisonMethod.Simple,y.value=!1,b.value=!1,w.value=0,k.value=100,S.value=1,I.value={x:0,y:0},T.value={x:0,y:0},j.value=.8}return p(Z,"resetState"),{brushSettings:i,maskBlendMode:o,activeLayer:n,rgbColor:s,currentTool:a,isAdjustingBrush:r,paintBucketTolerance:l,fillOpacity:u,colorSelectTolerance:m,colorSelectLivePreview:f,colorComparisonMethod:_,applyWholeImage:y,maskBoundary:b,maskTolerance:w,selectionOpacity:k,zoomRatio:S,displayZoomRatio:C,panOffset:I,cursorPoint:T,resetZoomTrigger:E,maskCanvas:L,maskCtx:A,rgbCanvas:D,rgbCtx:O,imgCanvas:M,imgCtx:P,canvasContainer:R,canvasBackground:V,pointerZone:$,image:F,maskOpacity:j,canUndo:Q,canRedo:q,maskColor:ee,brushVisible:U,isPanning:G,brushPreviewGradientVisible:H,canvasHistory:W,tgpuRoot:X,setBrushSize:Y,setBrushOpacity:ae,setBrushHardness:re,setBrushStepSize:ue,resetBrushToDefault:K,setPaintBucketTolerance:ne,setFillOpacity:de,setColorSelectTolerance:ve,setMaskTolerance:_e,setSelectionOpacity:oe,setZoomRatio:se,setPanOffset:he,setCursorPoint:be,resetZoom:Se,triggerClear:me,clearTrigger:N,setMaskOpacity:fe,resetState:Z}}),getPixelAlpha=p((i,o,n,s)=>i[(n*s+o)*4+3],"getPixelAlpha"),getPixelColor=p((i,o,n,s)=>{const a=(n*s+o)*4;return{r:i[a],g:i[a+1],b:i[a+2]}},"getPixelColor"),setPixel=p((i,o,n,s,a,r)=>{const l=(n*s+o)*4;i[l]=r.r,i[l+1]=r.g,i[l+2]=r.b,i[l+3]=a},"setPixel"),rgbToHSL=p((i,o,n)=>{i/=255,o/=255,n/=255;const s=Math.max(i,o,n),a=Math.min(i,o,n);let r=0,l=0;const u=(s+a)/2;if(s!==a){const m=s-a;switch(l=u>.5?m/(2-s-a):m/(s+a),s){case i:r=(o-n)/m+(o<n?6:0);break;case o:r=(n-i)/m+2;break;case n:r=(i-o)/m+4;break}r/=6}return{h:r*360,s:l*100,l:u*100}},"rgbToHSL"),rgbToLab=p(i=>{let o=i.r/255,n=i.g/255,s=i.b/255;o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92,o*=100,n*=100,s*=100;const a=o*.4124+n*.3576+s*.1805,r=o*.2126+n*.7152+s*.0722,l=o*.0193+n*.1192+s*.9505,_=[a/95.047,r/100,l/108.883];for(let y=0;y<_.length;y++)_[y]=_[y]>.008856?Math.pow(_[y],1/3):7.787*_[y]+16/116;return{l:116*_[1]-16,a:500*(_[0]-_[1]),b:200*(_[1]-_[2])}},"rgbToLab"),isPixelInRangeSimple=p((i,o,n)=>Math.sqrt(Math.pow(i.r-o.r,2)+Math.pow(i.g-o.g,2)+Math.pow(i.b-o.b,2))<=n,"isPixelInRangeSimple"),isPixelInRangeHSL=p((i,o,n)=>{const s=rgbToHSL(i.r,i.g,i.b),a=rgbToHSL(o.r,o.g,o.b),r=Math.abs(s.h-a.h),l=Math.abs(s.s-a.s),u=Math.abs(s.l-a.l);return Math.sqrt(Math.pow(r/360*255,2)+Math.pow(l/100*255,2)+Math.pow(u/100*255,2))<=n},"isPixelInRangeHSL"),isPixelInRangeLab=p((i,o,n)=>{const s=rgbToLab(i),a=rgbToLab(o);return Math.sqrt(Math.pow(s.l-a.l,2)+Math.pow(s.a-a.a,2)+Math.pow(s.b-a.b,2))/100*255<=n},"isPixelInRangeLab"),isPixelInRange=p((i,o,n,s)=>{switch(s){case ColorComparisonMethod.Simple:return isPixelInRangeSimple(i,o,n);case ColorComparisonMethod.HSL:return isPixelInRangeHSL(i,o,n);case ColorComparisonMethod.LAB:return isPixelInRangeLab(i,o,n);default:return isPixelInRangeSimple(i,o,n)}},"isPixelInRange");function useCanvasTools(){const i=useMaskEditorStore(),o=ref(null),n=p(u=>{const m=i.maskCtx,f=i.maskCanvas;if(!m||!f)return;const _=Math.floor(u.x),y=Math.floor(u.y),b=f.width,w=f.height;if(_<0||_>=b||y<0||y>=w)return;const k=m.getImageData(0,0,b,w),S=k.data,C=getPixelAlpha(S,_,y,b),I=C!==255;if(C===-1)return;const T=i.maskColor,E=i.paintBucketTolerance,N=Math.floor(i.fillOpacity/100*255),L=[],A=new Uint8Array(b*w),D=p((O,M,P,R)=>O===-1?!1:R?O!==255&&Math.abs(O-M)<=P:O===255||Math.abs(O-M)<=P,"shouldProcessPixel");for(D(C,C,E,I)&&L.push([_,y]);L.length>0;){const[O,M]=L.pop(),P=M*b+O;if(A[P])continue;const R=getPixelAlpha(S,O,M,b);if(!D(R,C,E,I))continue;A[P]=1,setPixel(S,O,M,b,I?N:0,T);const V=p(($,F)=>{if(!($<0||$>=b||F<0||F>=w)&&!A[F*b+$]){const j=getPixelAlpha(S,$,F,b);D(j,C,E,I)&&L.push([$,F])}},"checkNeighbor");V(O-1,M),V(O+1,M),V(O,M-1),V(O,M+1)}m.putImageData(k,0,0),i.canvasHistory.saveState()},"paintBucketFill"),s=p(async u=>{const m=i.maskCtx,f=i.imgCtx,_=i.imgCanvas;if(!m||!f||!_)return;const y=_.width,b=_.height;o.value=u;const w=m.getImageData(0,0,y,b),k=w.data,S=f.getImageData(0,0,y,b).data,C=i.colorSelectTolerance,I=i.colorComparisonMethod,T=i.maskColor,E=Math.floor(i.selectionOpacity/100*255),N=i.applyWholeImage,L=i.maskBoundary,A=i.maskTolerance;if(N){const D=getPixelColor(S,Math.floor(u.x),Math.floor(u.y),y),O=1e4;for(let M=0;M<y*b;M+=O){const P=Math.min(M+O,y*b);for(let R=M;R<P;R++){const V=R%y,$=Math.floor(R/y);isPixelInRange(getPixelColor(S,V,$,y),D,C,I)&&setPixel(k,V,$,y,E,T)}await new Promise(R=>setTimeout(R,0))}}else{const D=Math.floor(u.x),O=Math.floor(u.y);if(D<0||D>=y||O<0||O>=b)return;const M=getPixelColor(S,D,O,y),P=[],R=new Uint8Array(y*b);for(P.push([D,O]);P.length>0;){const[V,$]=P.pop(),F=$*y+V;if(R[F]||!isPixelInRange(getPixelColor(S,V,$,y),M,C,I))continue;R[F]=1,setPixel(k,V,$,y,E,T);const j=p((U,G)=>{U<0||U>=y||G<0||G>=b||R[G*y+U]||isPixelInRange(getPixelColor(S,U,G,y),M,C,I)&&(L&&255-getPixelAlpha(k,U,G,y)<=A||P.push([U,G]))},"checkNeighbor");j(V-1,$),j(V+1,$),j(V,$-1),j(V,$+1)}}m.putImageData(w,0,0),i.canvasHistory.saveState()},"colorSelectFill"),a=p(()=>{const u=i.maskCtx,m=i.maskCanvas;if(!u||!m)return;const f=u.getImageData(0,0,m.width,m.height),_=f.data;let y=0,b=0,w=0;for(let k=0;k<_.length;k+=4)if(_[k+3]>0){y=_[k],b=_[k+1],w=_[k+2];break}for(let k=0;k<_.length;k+=4){const S=_[k+3];_[k+3]=255-S,S===0&&(_[k]=y,_[k+1]=b,_[k+2]=w)}u.putImageData(f,0,0),i.canvasHistory.saveState()},"invertMask"),r=p(()=>{const u=i.maskCtx,m=i.maskCanvas,f=i.rgbCtx,_=i.rgbCanvas;u&&m&&u.clearRect(0,0,m.width,m.height),f&&_&&f.clearRect(0,0,_.width,_.height),i.canvasHistory.saveState()},"clearMask"),l=p(()=>{o.value=null},"clearLastColorSelectPoint");return watch([()=>i.colorSelectTolerance,()=>i.colorComparisonMethod,()=>i.selectionOpacity],async()=>{o.value&&i.colorSelectLivePreview&&i.canUndo&&(i.canvasHistory.undo(),await s(o.value))}),{paintBucketFill:n,colorSelectFill:s,clearLastColorSelectPoint:l,invertMask:a,clearMask:r}}p(useCanvasTools,"useCanvasTools");const useMaskEditorDataStore=defineStore("maskEditorData",()=>{const i=ref(null),o=ref(null),n=ref(null),s=ref(!1),a=ref(null),r=computed(()=>i.value!==null),l=computed(()=>o.value!==null),u=computed(()=>r.value&&!s.value);return{inputData:i,outputData:o,sourceNode:n,isLoading:s,loadError:a,hasValidInput:r,hasValidOutput:l,isReady:u,reset:p(()=>{i.value=null,o.value=null,n.value=null,s.value=!1,a.value=null},"reset"),setLoading:p((_,y)=>{s.value=_,y&&(a.value=y)},"setLoading")}});function imageLayerFilenamesByTimestamp(i){return{maskedImage:`clipspace-mask-${i}.png`,paint:`clipspace-paint-${i}.png`,paintedImage:`clipspace-painted-${i}.png`,paintedMaskedImage:`clipspace-painted-masked-${i}.png`}}p(imageLayerFilenamesByTimestamp,"imageLayerFilenamesByTimestamp");function useMaskEditorSaver(){const i=useMaskEditorDataStore(),o=useMaskEditorStore(),n=useNodeOutputStore(),s=p(async()=>{const T=i.sourceNode;if(!T||!i.inputData)throw new Error("No source node or input data");try{const E=await a();i.outputData=E,await b(T,E),await f(E),w(T,E),app$1.graph.setDirtyCanvas(!0)}catch(E){throw console.error("[MaskEditorSaver] Save failed:",E),E}},"save");async function a(){const T=o.maskCanvas,E=o.rgbCanvas,N=o.imgCanvas;if(!T||!E||!N)throw new Error("Canvas not initialized");const L=Date.now(),A=imageLayerFilenamesByTimestamp(L),[D,O,M,P]=await Promise.all([r(N,T,A.maskedImage),l(E,A.paint),u(N,E,A.paintedImage),m(N,E,T,A.paintedMaskedImage)]);return{maskedImage:D,paintLayer:O,paintedImage:M,paintedMaskedImage:P}}p(a,"prepareOutputData");async function r(T,E,N){const L=document.createElement("canvas");L.width=T.width,L.height=T.height;const A=L.getContext("2d");A.drawImage(T,0,0);const O=E.getContext("2d").getImageData(0,0,E.width,E.height),M=new Uint8ClampedArray(O.data.length);for(let $=0;$<O.data.length;$+=4)M[$]=0,M[$+1]=0,M[$+2]=0,M[$+3]=255-O.data[$+3];const P=A.getImageData(0,0,L.width,L.height);for(let $=0;$<P.data.length;$+=4)P.data[$+3]=M[$+3];A.putImageData(P,0,0);const R=await C(L),V=I(N);return{canvas:L,blob:R,ref:V}}p(r,"createMaskedImage");async function l(T,E){const N=S(T),L=await C(N),A=I(E);return{canvas:N,blob:L,ref:A}}p(l,"createPaintLayer");async function u(T,E,N){const L=document.createElement("canvas");L.width=T.width,L.height=T.height;const A=L.getContext("2d");A.drawImage(T,0,0),A.globalCompositeOperation="source-over",A.drawImage(E,0,0);const D=await C(L),O=I(N);return{canvas:L,blob:D,ref:O}}p(u,"createPaintedImage");async function m(T,E,N,L){const A=document.createElement("canvas");A.width=T.width,A.height=T.height;const D=A.getContext("2d");D.drawImage(T,0,0),D.globalCompositeOperation="source-over",D.drawImage(E,0,0);const M=N.getContext("2d").getImageData(0,0,N.width,N.height),P=new Uint8ClampedArray(M.data.length);for(let F=0;F<M.data.length;F+=4)P[F]=0,P[F+1]=0,P[F+2]=0,P[F+3]=255-M.data[F+3];const R=D.getImageData(0,0,A.width,A.height);for(let F=0;F<R.data.length;F+=4)R.data[F+3]=P[F+3];D.putImageData(R,0,0);const V=await C(A),$=I(L);return{canvas:A,blob:V,ref:$}}p(m,"createPaintedMaskedImage");async function f(T){const E=i.inputData.sourceRef,N=await _(T.maskedImage,E),L=await y(T.paintLayer,E),A=await y(T.paintedImage,E),D=await _(T.paintedMaskedImage,A);T.maskedImage.ref=N,T.paintLayer.ref=L,T.paintedImage.ref=A,T.paintedMaskedImage.ref=D}p(f,"uploadAllLayers");async function _(T,E){const N=new FormData;N.append("image",T.blob,T.ref.filename),N.append("original_ref",JSON.stringify(E)),N.append("type","input"),N.append("subfolder","clipspace");const L=await api.fetchApi("/upload/mask",{method:"POST",body:N});if(!L.ok)throw new Error(`Failed to upload mask: ${T.ref.filename}`);try{const A=await L.json();if(A?.name)return{filename:A.name,subfolder:A.subfolder||T.ref.subfolder,type:A.type||T.ref.type}}catch(A){console.warn("[MaskEditorSaver] Failed to parse upload response:",A)}return T.ref}p(_,"uploadMask");async function y(T,E){const N=new FormData;N.append("image",T.blob,T.ref.filename),N.append("original_ref",JSON.stringify(E)),N.append("type","input"),N.append("subfolder","clipspace");const L=await api.fetchApi("/upload/image",{method:"POST",body:N});if(!L.ok)throw new Error(`Failed to upload image: ${T.ref.filename}`);try{const A=await L.json();if(A?.name)return{filename:A.name,subfolder:A.subfolder||T.ref.subfolder,type:A.type||T.ref.type}}catch(A){console.warn("[MaskEditorSaver] Failed to parse upload response:",A)}return T.ref}p(y,"uploadImage");async function b(T,E){const L=E.paintedMaskedImage.canvas.toDataURL("image/png"),A=await k(L);T.imgs=[A],app$1.graph.setDirtyCanvas(!0)}p(b,"updateNodePreview");function w(T,E){const N=E.paintedMaskedImage.ref;T.images=[N];const L=T.widgets?.find(A=>A.name==="image");if(L){let A;if(A=(N.subfolder?N.subfolder+"/":"")+N.filename+(N.type?` [${N.type}]`:""),L.value=A,T.properties&&(T.properties.image=A),T.widgets_values&&T.widgets){const D=T.widgets.indexOf(L);D>=0&&(T.widgets_values[D]=A)}L.callback?.(A)}n.updateNodeImages(T)}p(w,"updateNodeWithServerReferences");function k(T){return new Promise((E,N)=>{const L=new Image;L.crossOrigin="anonymous",L.onload=()=>E(L),L.onerror=A=>{console.error("[MaskEditorSaver] Failed to load image:",T,A),N(new Error(`Failed to load image: ${T}`))},L.src=T})}p(k,"loadImageFromUrl");function S(T){const E=document.createElement("canvas");return E.width=T.width,E.height=T.height,E.getContext("2d").drawImage(T,0,0),E}p(S,"cloneCanvas");function C(T){return new Promise((E,N)=>{T.toBlob(L=>{L?E(L):N(new Error("Failed to create blob from canvas"))},"image/png")})}p(C,"canvasToBlob");function I(T){return{filename:T,subfolder:"clipspace",type:"input"}}return p(I,"createFileRef"),{save:s}}p(useMaskEditorSaver,"useMaskEditorSaver");const _hoisted_1$1e={class:"flex w-full items-center justify-between gap-3"},_hoisted_2$Z={class:"flex items-center gap-3"},_hoisted_3$F={class:"m-0 text-lg font-semibold"},_hoisted_4$x={class:"flex items-center gap-4"},_hoisted_5$t=["title"],_hoisted_6$k=["title"],_hoisted_7$i={class:"flex gap-3"},iconButtonClass="flex h-7.5 w-12.5 items-center justify-center rounded-[10px] border border-[var(--p-form-field-border-color)] pointer-events-auto transition-colors duration-100 bg-[var(--comfy-menu-bg)] hover:bg-secondary-background-hover",textButtonClass="h-7.5 w-15 rounded-[10px] border border-[var(--p-form-field-border-color)] text-[var(--input-text)] font-sans pointer-events-auto transition-colors duration-100 bg-[var(--comfy-menu-bg)] hover:bg-secondary-background-hover",_sfc_main$1q=defineComponent({__name:"TopBarHeader",setup(i){const o=useMaskEditorStore(),n=useDialogStore(),s=useCanvasTools(),a=useMaskEditorSaver(),r=ref(t("g.save")),l=ref(!0),u=p(()=>{o.canvasHistory.undo()},"onUndo"),m=p(()=>{o.canvasHistory.redo()},"onRedo"),f=p(()=>{s.invertMask()},"onInvert"),_=p(()=>{s.clearMask(),o.triggerClear()},"onClear"),y=p(async()=>{r.value=t("g.saving"),l.value=!1;try{o.brushVisible=!1,await a.save(),n.closeDialog()}catch(w){console.error("[TopBarHeader] Save failed:",w),o.brushVisible=!0,r.value=t("g.save"),l.value=!0}},"handleSave"),b=p(()=>{n.closeDialog({key:"global-mask-editor"})},"handleCancel");return(w,k)=>(openBlock(),createElementBlock("div",_hoisted_1$1e,[createBaseVNode("div",_hoisted_2$Z,[createBaseVNode("h3",_hoisted_3$F,toDisplayString(unref(t)("maskEditor.title")),1),createBaseVNode("div",_hoisted_4$x,[createBaseVNode("button",{class:normalizeClass(iconButtonClass),title:unref(t)("maskEditor.undo"),onClick:u},k[0]||(k[0]=[createBaseVNode("svg",{viewBox:"0 0 15 15",class:"h-6.25 w-6.25 pointer-events-none fill-[var(--input-text)]"},[createBaseVNode("path",{d:"M8.77,12.18c-.25,0-.46-.2-.46-.46s.2-.46.46-.46c1.47,0,2.67-1.2,2.67-2.67,0-1.57-1.34-2.67-3.26-2.67h-3.98l1.43,1.43c.18.18.18.47,0,.64-.18.18-.47.18-.64,0l-2.21-2.21c-.18-.18-.18-.47,0-.64l2.21-2.21c.18-.18.47-.18.64,0,.18.18.18.47,0,.64l-1.43,1.43h3.98c2.45,0,4.17,1.47,4.17,3.58,0,1.97-1.61,3.58-3.58,3.58Z"})],-1)]),8,_hoisted_5$t),createBaseVNode("button",{class:normalizeClass(iconButtonClass),title:unref(t)("maskEditor.redo"),onClick:m},k[1]||(k[1]=[createBaseVNode("svg",{viewBox:"0 0 15 15",class:"h-6.25 w-6.25 pointer-events-none fill-[var(--input-text)]"},[createBaseVNode("path",{class:"cls-1",d:"M6.23,12.18c-1.97,0-3.58-1.61-3.58-3.58,0-2.11,1.71-3.58,4.17-3.58h3.98l-1.43-1.43c-.18-.18-.18-.47,0-.64.18-.18.46-.18.64,0l2.21,2.21c.09.09.13.2.13.32s-.05.24-.13.32l-2.21,2.21c-.18.18-.47.18-.64,0-.18-.18-.18-.47,0-.64l1.43-1.43h-3.98c-1.92,0-3.26,1.1-3.26,2.67,0,1.47,1.2,2.67,2.67,2.67.25,0,.46.2.46.46s-.2.46-.46.46Z"})],-1)]),8,_hoisted_6$k),createBaseVNode("button",{class:normalizeClass(textButtonClass),onClick:f},toDisplayString(unref(t)("maskEditor.invert")),1),createBaseVNode("button",{class:normalizeClass(textButtonClass),onClick:_},toDisplayString(unref(t)("maskEditor.clear")),1)])]),createBaseVNode("div",_hoisted_7$i,[createVNode(unref(script),{label:r.value,icon:"pi pi-check",size:"small",disabled:!l.value,onClick:y},null,8,["label","disabled"]),createVNode(unref(script),{label:unref(t)("g.cancel"),icon:"pi pi-times",size:"small",severity:"secondary",onClick:b},null,8,["label"])])]))}});function useCanvasManager(){const i=useMaskEditorStore(),o=p(async(r,l,u)=>{const m=i.maskColor;u.drawImage(r,0,0,l.width,l.height);const f=u.getImageData(0,0,l.width,l.height);for(let _=0;_<f.data.length;_+=4){const y=f.data[_+3];f.data[_]=m.r,f.data[_+1]=m.g,f.data[_+2]=m.b,f.data[_+3]=255-y}u.globalCompositeOperation="source-over",u.putImageData(f,0,0)},"prepareMask"),n=p(async(r,l,u)=>{const{imgCanvas:m,maskCanvas:f,rgbCanvas:_,imgCtx:y,maskCtx:b,rgbCtx:w}=i;if(!m||!f||!_||!y||!b||!w)throw new Error("Canvas elements or contexts not available");m.width=r.width,m.height=r.height,f.width=r.width,f.height=r.height,_.width=r.width,_.height=r.height,y.drawImage(r,0,0,r.width,r.height),u&&w.drawImage(u,0,0,u.width,u.height),await o(l,f,b)},"invalidateCanvas"),s=p(()=>{const r=i.canvasBackground;r&&(i.maskBlendMode===MaskBlendMode.Black?r.style.backgroundColor="rgba(0,0,0,1)":(i.maskBlendMode===MaskBlendMode.White||i.maskBlendMode===MaskBlendMode.Negative)&&(r.style.backgroundColor="rgba(255,255,255,1)"))},"setCanvasBackground");return{invalidateCanvas:n,updateMaskColor:p(async()=>{const{maskCanvas:r,maskCtx:l,maskColor:u,maskBlendMode:m,maskOpacity:f}=i;if(!r||!l)return;m===MaskBlendMode.Negative?(r.style.mixBlendMode="difference",r.style.opacity="1"):(r.style.mixBlendMode="initial",r.style.opacity=String(f)),l.fillStyle=`rgb(${u.r}, ${u.g}, ${u.b})`,s();const _=l.getImageData(0,0,r.width,r.height);for(let y=0;y<_.data.length;y+=4)_.data[y]=u.r,_.data[y+1]=u.g,_.data[y+2]=u.b;l.putImageData(_,0,0)},"updateMaskColor")}}p(useCanvasManager,"useCanvasManager");function useImageLoaderInternal(){const i=useMaskEditorStore(),o=useMaskEditorDataStore(),n=useCanvasManager();return{loadImages:p(async()=>{const a=o.inputData;if(!a)throw new Error("No input data available in dataStore");const{imgCanvas:r,maskCanvas:l,rgbCanvas:u,imgCtx:m,maskCtx:f}=i;if(!r||!l||!u||!m||!f)throw new Error("Canvas elements or contexts not available");m.clearRect(0,0,r.width,r.height),f.clearRect(0,0,l.width,l.height);const _=a.baseLayer.image,y=a.maskLayer.image,b=a.paintLayer?.image;return l.width=_.width,l.height=_.height,u.width=_.width,u.height=_.height,i.image=_,await n.invalidateCanvas(_,y,b||null),await n.updateMaskColor(),_},"loadImages")}}p(useImageLoaderInternal,"useImageLoaderInternal");const useImageLoader=createSharedComposable(useImageLoaderInternal);function useKeyboard(){const i=useMaskEditorStore(),o=ref([]),n=p(m=>o.value.includes(m),"isKeyDown"),s=p(()=>{o.value=[]},"clearKeys"),a=p(m=>{if(o.value.includes(m.key)||o.value.push(m.key),m.key===" "){m.preventDefault();const f=document.activeElement;f&&f.blur&&f.blur()}if((m.ctrlKey||m.metaKey)&&!m.altKey){const f=m.key.toUpperCase();f==="Y"&&!m.shiftKey||f==="Z"&&m.shiftKey?i.canvasHistory.redo():f==="Z"&&!m.shiftKey&&i.canvasHistory.undo()}},"handleKeyDown"),r=p(m=>{o.value=o.value.filter(f=>f!==m.key)},"handleKeyUp");return{isKeyDown:n,addListeners:p(()=>{document.addEventListener("keydown",a),document.addEventListener("keyup",r),window.addEventListener("blur",s)},"addListeners"),removeListeners:p(()=>{document.removeEventListener("keydown",a),document.removeEventListener("keyup",r),window.removeEventListener("blur",s)},"removeListeners")}}p(useKeyboard,"useKeyboard");const paintedMaskedImagePrefix="clipspace-painted-masked-";function imageLayerFilenamesIfApplicable(i){if(!i.startsWith(paintedMaskedImagePrefix))return;const n=i.slice(paintedMaskedImagePrefix.length),s=parseInt(n.split(".")[0],10);return{maskedImage:`clipspace-mask-${s}.png`,paint:`clipspace-paint-${s}.png`,paintedImage:`clipspace-painted-${s}.png`,paintedMaskedImage:`${paintedMaskedImagePrefix}${s}.png`}}p(imageLayerFilenamesIfApplicable,"imageLayerFilenamesIfApplicable");function toRef(i){return{filename:i,subfolder:"clipspace",type:"input"}}p(toRef,"toRef");function mkFileUrl(i){const o=new URLSearchParams;o.set("filename",i.ref.filename),i.ref.subfolder&&o.set("subfolder",i.ref.subfolder),i.ref.type&&o.set("type",i.ref.type);const n=api.apiURL("/view?"+o.toString()+app$1.getPreviewFormatParam()+app$1.getRandParam()),s=new Image;return s.crossOrigin="anonymous",s.src=n,s.src}p(mkFileUrl,"mkFileUrl");function useMaskEditorLoader(){const i=useMaskEditorDataStore(),o=useNodeOutputStore(),n=p(async f=>{i.setLoading(!0);try{s(f);let _=a(f),y=r(_),b;if(f.widgets){const A=f.widgets.find(D=>D.name==="image");A&&(typeof A.value=="string"?b=A.value:typeof A.value=="object"&&A.value&&"filename"in A.value&&typeof A.value.filename=="string"&&(b=A.value.filename))}if(b)try{let A=b,D,O="input";const M=A.match(/ \[([^\]]+)\]$/);M&&(O=M[1],A=A.substring(0,A.length-M[0].length));const P=A.lastIndexOf("/");P!==-1&&(D=A.substring(0,P),A=A.substring(P+1)),y={filename:A,type:O,subfolder:D},_=mkFileUrl({ref:y})}catch(A){console.warn("Failed to parse widget filename as ref",A)}const w=b||y.filename;let k,S=imageLayerFilenamesIfApplicable(y.filename);if(k){const A=k.painted_masked||k.painted;A&&(S={maskedImage:A,paint:k.paint||"",paintedImage:k.painted||"",paintedMaskedImage:k.painted_masked||A})}const C=S?.maskedImage?mkFileUrl({ref:toRef(S.maskedImage)}):_,I=S?.maskedImage?r(C):y;let T=null;k?.paint?T=mkFileUrl({ref:toRef(k.paint)}):S?.paint&&(T=mkFileUrl({ref:toRef(S.paint)}));const[E,N,L]=await Promise.all([l(C,"rgb"),l(C,"a"),T?m(T):Promise.resolve(void 0)]);i.inputData={baseLayer:E,maskLayer:N,paintLayer:L,sourceRef:I,nodeId:f.id},i.sourceNode=f,i.setLoading(!1)}catch(_){const y=_ instanceof Error?_.message:"Failed to load from node";throw console.error("[MaskEditorLoader]",y,_),i.setLoading(!1,y),_}},"loadFromNode");function s(f){if(!f)throw new Error("Node is null or undefined");if(!(f.imgs?.length||f.previewMediaType==="image"))throw new Error("Node has no images")}p(s,"validateNode");function a(f){if(f.images?.[0]){const y=f.images[0],b=new URLSearchParams({filename:y.filename,type:y.type||"output",subfolder:y.subfolder||""});return api.apiURL(`/view?${b.toString()}`)}const _=o.getNodeOutputs(f);if(_?.images?.[0]){const y=_.images[0];if(!y.filename)throw new Error("nodeOutputStore image missing filename");const b=new URLSearchParams;return b.set("filename",y.filename),b.set("type",y.type||"output"),b.set("subfolder",y.subfolder||""),api.apiURL(`/view?${b.toString()}`)}if(f.imgs?.length){const y=f.imageIndex??0,b=f.imgs[y].src;if(b&&!b.startsWith("data:"))return b}throw new Error("Unable to get image URL from node")}p(a,"getNodeImageUrl");function r(f){try{const _=new URL(f),y=_.searchParams.get("filename");if(!y)throw new Error("Image URL missing filename parameter");return{filename:y,subfolder:_.searchParams.get("subfolder")||void 0,type:_.searchParams.get("type")||void 0}}catch{try{const y=new URL(f,window.location.origin),b=y.searchParams.get("filename");if(!b)throw new Error("Image URL missing filename parameter");return{filename:b,subfolder:y.searchParams.get("subfolder")||void 0,type:y.searchParams.get("type")||void 0}}catch{throw new Error(`Invalid image URL: ${f}`)}}}p(r,"parseImageRef");async function l(f,_){let y;try{y=new URL(f)}catch{y=new URL(f,window.location.origin)}_&&(y.searchParams.delete("channel"),y.searchParams.set("channel",_));const b=y.toString();return{image:await u(b),url:b}}p(l,"loadImageLayer");function u(f){return new Promise((_,y)=>{const b=new Image;b.crossOrigin="anonymous",b.onload=()=>_(b),b.onerror=()=>y(new Error(`Failed to load image: ${f}`)),b.src=f})}p(u,"loadImage");async function m(f){let _;try{_=new URL(f)}catch{_=new URL(f,window.location.origin)}const y=_.toString();return{image:await u(y),url:y}}return p(m,"loadPaintLayer"),{loadFromNode:n}}p(useMaskEditorLoader,"useMaskEditorLoader");function usePanAndZoom(){const i=useMaskEditorStore(),o=300,n=ref(0),s=ref(!1),a=ref(0),r=ref({x:0,y:0}),l=ref({x:0,y:0}),u=ref(1),m=ref(1),f=ref({x:0,y:0}),_=ref(null),y=ref({x:0,y:0}),b=ref(null),w=ref(null),k=ref(null),S=ref(null),C=ref(null),I=ref(null),T=ref(null),E=ref(0),N=ref(0),L=ref({x:0,y:0}),A=ref([]),D=p(q=>{const ee=q[0].clientX-q[1].clientX,Y=q[0].clientY-q[1].clientY;return Math.sqrt(ee*ee+Y*Y)},"getTouchDistance"),O=p(q=>({x:(q[0].clientX+q[1].clientX)/2,y:(q[0].clientY+q[1].clientY)/2}),"getTouchMidpoint"),M=p(q=>{const ee=q.x-f.value.x,Y=q.y-f.value.y;L.value={x:ee,y:Y},i.setCursorPoint({x:ee,y:Y})},"updateCursorPosition"),P=p(()=>{i.canvasHistory.undo()},"handleDoubleTap"),R=p(async()=>{if(!T.value?.width||!T.value?.height||!f.value||!u.value){console.warn("Missing required properties for pan/zoom");return}const q=T.value.width*u.value,ee=T.value.height*u.value;b.value||(b.value=i.canvasContainer),b.value&&(Object.assign(b.value.style,{width:`${q}px`,height:`${ee}px`,left:`${f.value.x}px`,top:`${f.value.y}px`}),k.value||(k.value=i.rgbCanvas),k.value&&((k.value.width!==T.value.width||k.value.height!==T.value.height)&&(k.value.width=T.value.width,k.value.height=T.value.height),k.value.style.width=`${q}px`,k.value.style.height=`${ee}px`),i.setPanOffset(f.value),i.setZoomRatio(u.value))},"invalidatePanZoom"),V=p(q=>{_.value={x:q.clientX,y:q.clientY},i.isPanning=!0,y.value={...f.value}},"handlePanStart"),$=p(async q=>{if(_.value===null)throw new Error("mouseDownPoint is null");const ee=_.value.x-q.clientX,Y=_.value.y-q.clientY,ae=y.value.x-ee,re=y.value.y-Y;f.value={x:ae,y:re},await R()},"handlePanMove"),F=p(async q=>{if(l.value===null){l.value={x:q.clientX,y:q.clientY};return}const ee=q.clientX-l.value.x,Y=q.clientY-l.value.y;f.value.x+=ee,f.value.y+=Y,await R(),l.value={x:q.clientX,y:q.clientY}},"handleSingleTouchPan"),j=p(q=>{if(q.preventDefault(),!(A.value.length>0))if(i.brushVisible=!1,q.touches.length===2){const ee=new Date().getTime();ee-n.value<o?(P(),n.value=0):(n.value=ee,s.value=!0,a.value=D(q.touches),r.value=O(q.touches))}else q.touches.length===1&&(l.value={x:q.touches[0].clientX,y:q.touches[0].clientY})},"handleTouchStart"),U=p(async q=>{if(q.preventDefault(),!(A.value.length>0))if(n.value=0,s.value&&q.touches.length===2){const ee=D(q.touches),Y=ee/a.value,ae=u.value;u.value=Math.max(.2,Math.min(10,u.value*Y));const re=u.value,ue=O(q.touches);if(r.value){const _e=ue.x-r.value.x,oe=ue.y-r.value.y;f.value.x+=_e,f.value.y+=oe}if(w.value===null&&(w.value=i.maskCanvas),!w.value)return;const K=w.value.getBoundingClientRect(),ne=ue.x-K.left,de=ue.y-K.top,ve=re/ae;f.value.x+=ne-ne*ve,f.value.y+=de-de*ve,await R(),a.value=ee,r.value=ue}else q.touches.length===1&&await F(q.touches[0])},"handleTouchMove"),G=p(q=>{q.preventDefault();const ee=q.touches[0];ee?l.value={x:ee.clientX,y:ee.clientY}:(s.value=!1,r.value={x:0,y:0})},"handleTouchEnd"),H=p(async q=>{const ee={x:q.clientX,y:q.clientY},Y=u.value,ae=q.deltaY<0?1.1:.9;u.value=Math.max(.2,Math.min(10,u.value*ae));const re=u.value;if(w.value||(w.value=i.maskCanvas),!w.value)return;const ue=w.value.getBoundingClientRect(),K=ee.x-ue.left,ne=ee.y-ue.top,de=re/Y;f.value.x+=K-K*de,f.value.y+=ne-ne*de,await R();const _e=w.value.clientWidth/E.value;m.value=_e,i.displayZoomRatio=_e,M(ee)},"zoom"),W=p(()=>{const q=C.value?.getBoundingClientRect().width||64;return{sidePanelWidth:I.value?.getBoundingClientRect().width||220,toolPanelWidth:q}},"getPanelDimensions"),X=p(async(q=500)=>{if(!T.value||!S.value)return;const ee=u.value,Y={...f.value},{sidePanelWidth:ae,toolPanelWidth:re}=W(),ue=S.value.clientWidth-ae-re,K=S.value.clientHeight,ne=ue/T.value.width,de=K/T.value.height,ve=Math.min(ne,de),_e=T.value.width/T.value.height;let oe,se;const he={x:re,y:0};de>ne?(oe=ue,se=oe/_e,he.y=(K-se)/2):(se=K,oe=se*_e,he.x=(ue-oe)/2+re);const be=performance.now(),Se=p(async me=>{const fe=me-be,Z=Math.min(fe/q,1),J=1-Math.pow(1-Z,3);u.value=ee+(ve-ee)*J,f.value.x=Y.x+(he.x-Y.x)*J,f.value.y=Y.y+(he.y-Y.y)*J,await R();const le=ee+(1-ee)*J;i.displayZoomRatio=le,Z<1&&requestAnimationFrame(Se)},"animate");requestAnimationFrame(Se),m.value=1},"smoothResetView"),Q=p(async(q,ee,Y,ae)=>{S.value=ee,C.value=Y||null,I.value=ae||null;const{sidePanelWidth:re,toolPanelWidth:ue}=W(),K=ee.clientWidth-re-ue,ne=ee.clientHeight,de=K/q.width,ve=ne/q.height,_e=q.width/q.height;let oe,se;const he={x:ue,y:0};ve>de?(oe=K,se=oe/_e,he.y=(ne-se)/2):(se=ne,oe=se*_e,he.x=(K-oe)/2+ue),T.value===null&&(T.value=q),E.value=oe,N.value=se,u.value=Math.min(de,ve),f.value=he,A.value=[],await R()},"initializeCanvasPanZoom");return watch(()=>i.resetZoomTrigger,async()=>{m.value!==1&&await X()}),{initializeCanvasPanZoom:Q,handlePanStart:V,handlePanMove:$,handleTouchStart:j,handleTouchMove:U,handleTouchEnd:G,updateCursorPosition:M,zoom:H,invalidatePanZoom:R}}p(usePanAndZoom,"usePanAndZoom");function useCoordinateTransformInternal(){const i=useMaskEditorStore();return{screenToCanvas:p(s=>{const a=unref(i.pointerZone),r=unref(i.canvasContainer),l=unref(i.maskCanvas);if(!a||!r||!l)return console.warn("screenToCanvas called before elements are available"),{x:0,y:0};const u=a.getBoundingClientRect(),m=r.getBoundingClientRect(),f=l.getBoundingClientRect(),_=u.left+s.x,y=u.top+s.y,b=_-m.left,w=y-m.top,k=l.width/f.width,S=l.height/f.height,C=b*k,I=w*S;return{x:C,y:I}},"screenToCanvas"),canvasToScreen:p(s=>{const a=unref(i.pointerZone),r=unref(i.canvasContainer),l=unref(i.maskCanvas);if(!a||!r||!l)return console.warn("canvasToScreen called before elements are available"),{x:0,y:0};const u=a.getBoundingClientRect(),m=r.getBoundingClientRect(),f=l.getBoundingClientRect(),_=f.width/l.width,y=f.height/l.height,b=s.x*_,w=s.y*y,k=m.left+b,S=m.top+w,C=k-u.left,I=S-u.top;return{x:C,y:I}},"canvasToScreen")}}p(useCoordinateTransformInternal,"useCoordinateTransformInternal");const useCoordinateTransform=createSharedComposable(useCoordinateTransformInternal);function catmullRomSpline(i,o,n,s,a){const l=p((E,N,L)=>{const A=Math.hypot(L.x-N.x,L.y-N.y);return E+Math.pow(A,.5)},"getT"),u=0,m=l(u,i,o),f=l(m,o,n),_=l(f,n,s),y=m+(f-m)*a,b=p((E,N,L,A,D)=>{if(Math.abs(A-L)<1e-4)return E;const O=(D-L)/(A-L);return add(mul(E,1-O),mul(N,O))},"interp"),w=b(i,o,u,m,y),k=b(o,n,m,f,y),S=b(n,s,f,_,y),C=b(w,k,u,f,y),I=b(k,S,m,_,y);return b(C,I,m,f,y)}p(catmullRomSpline,"catmullRomSpline");function add(i,o){return{x:i.x+o.x,y:i.y+o.y}}p(add,"add");function mul(i,o){return{x:i.x*o,y:i.y*o}}p(mul,"mul");function resampleSegment(i,o,n){if(i.length===0)return{points:[],remainder:n};const s=[];let a=0,r=n;for(let u=0;u<i.length-1;u++){const m=i[u],f=i[u+1],_=f.x-m.x,y=f.y-m.y,b=Math.hypot(_,y);if(b<1e-4){for(;r<=a;)s.push(m),r+=o;continue}for(;r<=a+b;){const w=(r-a)/b,k=m.x+w*_,S=m.y+w*y;s.push({x:k,y:S}),r+=o}a+=b}const l=r-a;return{points:s,remainder:l}}p(resampleSegment,"resampleSegment");const BrushUniforms=(globalThis.__TYPEGPU_AUTONAME__??(i=>i))(qs({brushColor:Le,brushOpacity:h$1,hardness:h$1,screenSize:B,brushShape:c}),"BrushUniforms"),StrokePoint=(globalThis.__TYPEGPU_AUTONAME__??(i=>i))(qs({pos:Ws(0,B),size:Ws(1,h$1),pressure:Ws(2,h$1)}),"StrokePoint"),VertexOutput=(globalThis.__TYPEGPU_AUTONAME__??(i=>i))(qs({position:yo.position,localUV:Ws(0,B),color:Ws(1,Le),opacity:Ws(2,h$1),hardness:Ws(3,h$1)}),"VertexOutput"),brushVertexTemplate=`
@group(0) @binding(0) var<uniform> globals: BrushUniforms;

@vertex
fn vs(
  @location(0) quadPos: vec2<f32>,
  @location(1) pos: vec2<f32>,
  @location(2) size: f32,
  @location(3) pressure: f32
) -> VertexOutput {
  // Convert diameter to radius
  let radius = size * pressure;
  let pixelPos = pos + (quadPos * radius);
  
  // Convert pixel coordinates to Normalized Device Coordinates (NDC)
  let ndcX = (pixelPos.x / globals.screenSize.x) * 2.0 - 1.0;
  let ndcY = 1.0 - ((pixelPos.y / globals.screenSize.y) * 2.0);  // Flip Y axis for WebGPU coordinate system

  return VertexOutput(
    vec4<f32>(ndcX, ndcY, 0.0, 1.0),
    quadPos,
    globals.brushColor,
    pressure * globals.brushOpacity,
    globals.hardness
  );
}
`,brushVertex=bf.resolve({template:brushVertexTemplate,externals:{BrushUniforms,VertexOutput}}),brushFragmentTemplate=`
@group(0) @binding(0) var<uniform> globals: BrushUniforms;

@fragment
fn fs(v: VertexOutput) -> @location(0) vec4<f32> {
  var dist: f32;
  if (globals.brushShape == 1u) {
    // Calculate Chebyshev distance for square shape
    dist = max(abs(v.localUV.x), abs(v.localUV.y));
  } else {
    // Calculate Euclidean distance for circle shape
    dist = length(v.localUV);
  }

  if (dist > 1.0) { discard; }

  // Calculate alpha with hardness and anti-aliasing
  let edgeWidth = fwidth(dist);
  let startFade = min(v.hardness, 1.0 - edgeWidth * 2.0);
  let linearAlpha = 1.0 - smoothstep(startFade, 1.0, dist);
  // Apply quadratic falloff for smoother edges
  let alphaShape = pow(linearAlpha, 2.0);
  
  // Return premultiplied alpha color
  let alpha = alphaShape * v.opacity;
  return vec4<f32>(v.color * alpha, alpha);
}
`,brushFragment=bf.resolve({template:brushFragmentTemplate,externals:{VertexOutput,BrushUniforms}}),blitShaderTemplate=`
@vertex fn vs(@builtin(vertex_index) vIdx: u32) -> @builtin(position) vec4<f32> {
  var pos = array<vec2<f32>, 3>(
    vec2<f32>(-1.0, -1.0), vec2<f32>(3.0, -1.0), vec2<f32>(-1.0, 3.0)
  );
  return vec4<f32>(pos[vIdx], 0.0, 1.0);
}

@group(0) @binding(0) var myTexture: texture_2d<f32>;

@fragment fn fs(@builtin(position) pos: vec4<f32>) -> @location(0) vec4<f32> {
  let c = textureLoad(myTexture, vec2<i32>(pos.xy), 0);
  // Treat texture as premultiplied to prevent double-darkening on overlaps
  return c;
}
`,blitShader=bf.resolve({template:blitShaderTemplate,externals:{}}),compositeShaderTemplate=`
@vertex fn vs(@builtin(vertex_index) vIdx: u32) -> @builtin(position) vec4<f32> {
  var pos = array<vec2<f32>, 3>(
    vec2<f32>(-1.0, -1.0), vec2<f32>(3.0, -1.0), vec2<f32>(-1.0, 3.0)
  );
  return vec4<f32>(pos[vIdx], 0.0, 1.0);
}

@group(0) @binding(0) var myTexture: texture_2d<f32>;
@group(1) @binding(0) var<uniform> globals: BrushUniforms;

@fragment fn fs(@builtin(position) pos: vec4<f32>) -> @location(0) vec4<f32> {
  let sampled = textureLoad(myTexture, vec2<i32>(pos.xy), 0);
  // Apply global brush opacity to accumulated coverage
  return sampled * globals.brushOpacity;
}
`,compositeShader=bf.resolve({template:compositeShaderTemplate,externals:{BrushUniforms}}),readbackShaderTemplate=`
@group(0) @binding(0) var inputTex: texture_2d<f32>;
@group(0) @binding(1) var<storage, read_write> outputBuf: array<u32>;

@compute @workgroup_size(8, 8)
fn main(@builtin(global_invocation_id) id: vec3<u32>) {
  let dims = textureDimensions(inputTex);
  if (id.x >= dims.x || id.y >= dims.y) { return; }

  let color = textureLoad(inputTex, vec2<i32>(id.xy), 0);
  
  var r = color.r;
  var g = color.g;
  var b = color.b;
  let a = color.a;

  if (a > 0.0) {
    r = r / a;
    g = g / a;
    b = b / a;
  }

  let ir = u32(clamp(r * 255.0, 0.0, 255.0));
  let ig = u32(clamp(g * 255.0, 0.0, 255.0));
  let ib = u32(clamp(b * 255.0, 0.0, 255.0));
  let ia = u32(clamp(a * 255.0, 0.0, 255.0));

  // Pack RGBA channels into a single u32 (Little Endian)
  let packed = ir | (ig << 8u) | (ib << 16u) | (ia << 24u);

  let index = id.y * dims.x + id.x;
  outputBuf[index] = packed;
}
`,readbackShader=bf.resolve({template:readbackShaderTemplate,externals:{}}),QUAD_VERTS=new Float32Array([-1,-1,1,-1,1,1,-1,1]),QUAD_INDICES=new Uint16Array([0,1,2,0,2,3]),UNIFORM_SIZE=48,STROKE_STRIDE=$s(StrokePoint),MAX_STROKES=1e4;class GPUBrushRenderer{static{p(this,"GPUBrushRenderer")}device;quadVertexBuffer;indexBuffer;instanceBuffer;uniformBuffer;renderPipeline;accumulatePipeline;blitPipeline;compositePipeline;compositePipelinePreview;erasePipeline;erasePipelinePreview;readbackPipeline;uniformBindGroupLayout;textureBindGroupLayout;mainUniformBindGroup;currentStrokeTexture=null;currentStrokeView=null;compositeTextureBindGroup=null;previewTextureBindGroup=null;lastReadbackTexture=null;lastReadbackBuffer=null;readbackBindGroup=null;lastBackgroundTexture=null;backgroundBindGroup=null;constructor(o,n="rgba8unorm"){this.device=o,this.quadVertexBuffer=o.createBuffer({size:QUAD_VERTS.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.quadVertexBuffer.getMappedRange()).set(QUAD_VERTS),this.quadVertexBuffer.unmap(),this.indexBuffer=o.createBuffer({size:QUAD_INDICES.byteLength,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0}),new Uint16Array(this.indexBuffer.getMappedRange()).set(QUAD_INDICES),this.indexBuffer.unmap(),this.instanceBuffer=o.createBuffer({size:MAX_STROKES*STROKE_STRIDE,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),this.uniformBuffer=o.createBuffer({size:UNIFORM_SIZE,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const s=o.createShaderModule({code:brushVertex}),a=o.createShaderModule({code:brushFragment});this.uniformBindGroupLayout=o.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),this.textureBindGroupLayout=o.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}}]}),this.mainUniformBindGroup=o.createBindGroup({layout:this.uniformBindGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const r=o.createPipelineLayout({bindGroupLayouts:[this.uniformBindGroupLayout]});this.renderPipeline=o.createRenderPipeline({layout:r,vertex:{module:s,entryPoint:"vs",buffers:[{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]},{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:1,offset:0,format:"float32x2"},{shaderLocation:2,offset:8,format:"float32"},{shaderLocation:3,offset:12,format:"float32"}]}]},fragment:{module:a,entryPoint:"fs",targets:[{format:"rgba8unorm",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}}),this.accumulatePipeline=o.createRenderPipeline({layout:r,vertex:{module:s,entryPoint:"vs",buffers:[{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]},{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:1,offset:0,format:"float32x2"},{shaderLocation:2,offset:8,format:"float32"},{shaderLocation:3,offset:12,format:"float32"}]}]},fragment:{module:a,entryPoint:"fs",targets:[{format:"rgba8unorm",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}});const l=o.createPipelineLayout({bindGroupLayouts:[this.textureBindGroupLayout]});this.blitPipeline=o.createRenderPipeline({layout:l,vertex:{module:o.createShaderModule({code:blitShader}),entryPoint:"vs"},fragment:{module:o.createShaderModule({code:blitShader}),entryPoint:"fs",targets:[{format:n,blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}});const u=o.createPipelineLayout({bindGroupLayouts:[this.textureBindGroupLayout,this.uniformBindGroupLayout]});this.compositePipeline=o.createRenderPipeline({layout:u,vertex:{module:o.createShaderModule({code:compositeShader}),entryPoint:"vs"},fragment:{module:o.createShaderModule({code:compositeShader}),entryPoint:"fs",targets:[{format:"rgba8unorm",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}}),this.compositePipelinePreview=o.createRenderPipeline({layout:u,vertex:{module:o.createShaderModule({code:compositeShader}),entryPoint:"vs"},fragment:{module:o.createShaderModule({code:compositeShader}),entryPoint:"fs",targets:[{format:n,blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}}),this.erasePipeline=o.createRenderPipeline({layout:u,vertex:{module:o.createShaderModule({code:compositeShader}),entryPoint:"vs"},fragment:{module:o.createShaderModule({code:compositeShader}),entryPoint:"fs",targets:[{format:"rgba8unorm",blend:{color:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}}),this.erasePipelinePreview=o.createRenderPipeline({layout:u,vertex:{module:o.createShaderModule({code:compositeShader}),entryPoint:"vs"},fragment:{module:o.createShaderModule({code:compositeShader}),entryPoint:"fs",targets:[{format:n,blend:{color:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}}),this.readbackPipeline=o.createComputePipeline({layout:"auto",compute:{module:o.createShaderModule({code:readbackShader}),entryPoint:"main"}})}prepareStroke(o,n){(!this.currentStrokeTexture||this.currentStrokeTexture.width!==o||this.currentStrokeTexture.height!==n)&&(this.currentStrokeTexture&&this.currentStrokeTexture.destroy(),this.currentStrokeTexture=this.device.createTexture({size:[o,n],format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC}),this.currentStrokeView=this.currentStrokeTexture.createView(),this.compositeTextureBindGroup=null,this.previewTextureBindGroup=null,this.lastReadbackTexture===this.currentStrokeTexture&&(this.readbackBindGroup=null,this.lastReadbackTexture=null));const s=this.device.createCommandEncoder();s.beginRenderPass({colorAttachments:[{view:this.currentStrokeView,loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0},storeOp:"store"}]}).end(),this.device.queue.submit([s.finish()])}renderStrokeToAccumulator(o,n){this.currentStrokeView&&this.renderStrokeInternal(this.currentStrokeView,this.accumulatePipeline,o,n)}compositeStroke(o,n){if(!this.currentStrokeTexture)return;const s=new ArrayBuffer(UNIFORM_SIZE),a=new Float32Array(s),r=new Uint32Array(s);a[0]=n.color[0],a[1]=n.color[1],a[2]=n.color[2],a[3]=n.opacity,a[4]=n.hardness,a[5]=0,a[6]=n.screenSize[0],a[7]=n.screenSize[1],r[8]=n.brushShape,this.device.queue.writeBuffer(this.uniformBuffer,0,s);const l=this.device.createCommandEncoder(),u=n.isErasing?this.erasePipeline:this.compositePipeline;this.compositeTextureBindGroup||(this.compositeTextureBindGroup=this.device.createBindGroup({layout:this.textureBindGroupLayout,entries:[{binding:0,resource:this.currentStrokeTexture.createView()}]}));const m=l.beginRenderPass({colorAttachments:[{view:o,loadOp:"load",storeOp:"store"}]});m.setPipeline(u),m.setBindGroup(0,this.compositeTextureBindGroup),m.setBindGroup(1,this.mainUniformBindGroup),m.draw(3),m.end(),this.device.queue.submit([l.finish()])}renderStroke(o,n,s){this.renderStrokeInternal(o,this.renderPipeline,n,s)}renderStrokeInternal(o,n,s,a){if(s.length===0)return;const r=new ArrayBuffer(UNIFORM_SIZE),l=new Float32Array(r),u=new Uint32Array(r);l[0]=a.color[0],l[1]=a.color[1],l[2]=a.color[2],l[3]=a.opacity,l[4]=a.hardness,l[5]=0,l[6]=a.width,l[7]=a.height,u[8]=a.brushShape,this.device.queue.writeBuffer(this.uniformBuffer,0,r);let m=0;for(;m<s.length;){const f=Math.min(s.length-m,MAX_STROKES),_=new Float32Array(f*4);for(let w=0;w<f;w++){const k=s[m+w];_[w*4+0]=k.x,_[w*4+1]=k.y,_[w*4+2]=a.size,_[w*4+3]=k.pressure}this.device.queue.writeBuffer(this.instanceBuffer,0,_);const y=this.device.createCommandEncoder(),b=y.beginRenderPass({colorAttachments:[{view:o,loadOp:"load",storeOp:"store"}]});b.setPipeline(n),b.setBindGroup(0,this.mainUniformBindGroup),b.setVertexBuffer(0,this.quadVertexBuffer),b.setVertexBuffer(1,this.instanceBuffer),b.setIndexBuffer(this.indexBuffer,"uint16"),b.drawIndexed(6,f),b.end(),this.device.queue.submit([y.finish()]),m+=f}}blitToCanvas(o,n,s){const a=this.device.createCommandEncoder(),r=o.getCurrentTexture().createView();if(s){(this.lastBackgroundTexture!==s||!this.backgroundBindGroup)&&(this.backgroundBindGroup=this.device.createBindGroup({layout:this.textureBindGroupLayout,entries:[{binding:0,resource:s.createView()}]}),this.lastBackgroundTexture=s);const l=a.beginRenderPass({colorAttachments:[{view:r,loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0},storeOp:"store"}]});l.setPipeline(this.blitPipeline),l.setBindGroup(0,this.backgroundBindGroup),l.draw(3),l.end()}else a.beginRenderPass({colorAttachments:[{view:r,loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0},storeOp:"store"}]}).end();if(this.currentStrokeTexture){const l=new ArrayBuffer(UNIFORM_SIZE),u=new Float32Array(l),m=new Uint32Array(l);u[0]=n.color[0],u[1]=n.color[1],u[2]=n.color[2],u[3]=n.opacity,u[4]=n.hardness,u[5]=0,u[6]=n.screenSize[0],u[7]=n.screenSize[1],m[8]=n.brushShape,this.device.queue.writeBuffer(this.uniformBuffer,0,l);const f=n.isErasing?this.erasePipelinePreview:this.compositePipelinePreview;this.previewTextureBindGroup||(this.previewTextureBindGroup=this.device.createBindGroup({layout:this.textureBindGroupLayout,entries:[{binding:0,resource:this.currentStrokeTexture.createView()}]}));const _=a.beginRenderPass({colorAttachments:[{view:r,loadOp:"load",storeOp:"store"}]});_.setPipeline(f),_.setBindGroup(0,this.previewTextureBindGroup),_.setBindGroup(1,this.mainUniformBindGroup),_.draw(3),_.end()}this.device.queue.submit([a.finish()])}clearPreview(o){const n=this.device.createCommandEncoder();n.beginRenderPass({colorAttachments:[{view:o.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0},storeOp:"store"}]}).end(),this.device.queue.submit([n.finish()])}prepareReadback(o,n){(this.lastReadbackTexture!==o||this.lastReadbackBuffer!==n||!this.readbackBindGroup)&&(this.readbackBindGroup=this.device.createBindGroup({layout:this.readbackPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:o.createView()},{binding:1,resource:{buffer:n}}]}),this.lastReadbackTexture=o,this.lastReadbackBuffer=n);const s=this.device.createCommandEncoder(),a=s.beginComputePass();a.setPipeline(this.readbackPipeline),a.setBindGroup(0,this.readbackBindGroup);const r=o.width,l=o.height;a.dispatchWorkgroups(Math.ceil(r/8),Math.ceil(l/8)),a.end(),this.device.queue.submit([s.finish()])}destroy(){this.quadVertexBuffer.destroy(),this.indexBuffer.destroy(),this.instanceBuffer.destroy(),this.uniformBuffer.destroy(),this.currentStrokeTexture&&this.currentStrokeTexture.destroy(),this.compositeTextureBindGroup=null,this.previewTextureBindGroup=null,this.readbackBindGroup=null,this.backgroundBindGroup=null,this.lastReadbackTexture=null,this.lastReadbackBuffer=null,this.lastBackgroundTexture=null}}class StrokeProcessor{static{p(this,"StrokeProcessor")}controlPoints=[];remainder=0;spacing;isFirstPoint=!0;hasProcessedSegment=!1;constructor(o){this.spacing=o}addPoint(o){if(this.isFirstPoint)return this.controlPoints.push(o),this.controlPoints.push(o),this.isFirstPoint=!1,[];if(this.controlPoints.push(o),this.controlPoints.length<4)return[];const n=this.controlPoints[0],s=this.controlPoints[1],a=this.controlPoints[2],r=this.controlPoints[3],l=this.processSegment(n,s,a,r);return this.controlPoints.shift(),l}endStroke(){if(this.controlPoints.length<2)return[];const o=[];for(;this.controlPoints.length>=3;){const n=this.controlPoints[0],s=this.controlPoints[1],a=this.controlPoints[2],r=a,l=this.processSegment(n,s,a,r);o.push(...l),this.controlPoints.shift()}if(!this.hasProcessedSegment&&this.controlPoints.length>=2){const n=this.controlPoints[1],s=this.processSegment(n,n,n,n);o.push(...s)}return o}processSegment(o,n,s,a){this.hasProcessedSegment=!0;const r=[],l=Math.hypot(s.x-n.x,s.y-n.y),u=Math.max(5,Math.ceil(l));for(let _=0;_<u;_++){const y=_/u;r.push(catmullRomSpline(o,n,s,a,y))}r.push(s);const{points:m,remainder:f}=resampleSegment(r,this.spacing,this.remainder);return this.remainder=f,m}}function getEffectiveBrushSize(i,o){const s=1+(1-o)*.5;return i*s}p(getEffectiveBrushSize,"getEffectiveBrushSize");function getEffectiveHardness(i,o,n){return n<=0?0:i*o/n}p(getEffectiveHardness,"getEffectiveHardness");const saveBrushToCache=debounce(function(i,o){try{const n=JSON.stringify(o);setStorageValue(i,n)}catch(n){console.error("Failed to save brush to cache:",n)}},300);function loadBrushFromCache(i){try{const o=getStorageValue(i);return o?JSON.parse(o):null}catch(o){return console.error("Failed to load brush from cache:",o),null}}p(loadBrushFromCache,"loadBrushFromCache");function useBrushDrawing(i){const o=useMaskEditorStore(),n=useCoordinateTransform();let s=null,a=null,r=null,l=null,u=null,m=null,f=null,_=null,y=null,b=null,w=0;const k=ref(!1),S=new QuickLRU({maxSize:20});function C(Z,J,le,ce){const ke=`${Z}_${J}_${le}_${ce}`;if(S.has(ke))return S.get(ke);const ye=Math.ceil(Z*2),ie=document.createElement("canvas"),pe=ie.getContext("2d");ie.width=ye,ie.height=ye;const ge=ye/2,Ce=ye/2,we=Z*J,Ie=pe.createImageData(ye,ye),Te=Ie.data,{r:Ee,g:Ne,b:xe}=parseToRgb(le),Be=Z-we;for(let Ae=0;Ae<ye;Ae++){const Oe=Ae+.5-Ce;for(let Me=0;Me<ye;Me++){const $e=Me+.5-ge,De=(Ae*ye+Me)*4,Ve=Math.max(Math.abs($e),Math.abs(Oe));let ze=0;if(Ve<=we)ze=ce;else if(Ve<=Z){const Fe=(Ve-we)/Be;ze=ce*Math.pow(1-Fe,2)}Te[De]=Ee,Te[De+1]=Ne,Te[De+2]=xe,Te[De+3]=ze*255}}return pe.putImageData(Ie,0,0),S.set(ke,ie),ie}p(C,"getCachedBrushTexture");const I=ref(!1),T=ref(!1),E=ref(null),N=ref(0),L=ref(new Date),A=ref(!0),D=ref({minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});function O(){D.value={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}p(O,"resetDirtyRect");function M(Z,J,le){D.value.minX=Math.min(D.value.minX,Z-le-2),D.value.minY=Math.min(D.value.minY,J-le-2),D.value.maxX=Math.max(D.value.maxX,Z+le+2),D.value.maxY=Math.max(D.value.maxY,J+le+2)}p(M,"updateDirtyRect");let P=null;const R=ref(null),V=ref(i?.useDominantAxis??!1),$=ref(i?.brushAdjustmentSpeed??1),F=loadBrushFromCache("maskeditor_brush_settings");F&&(o.setBrushSize(F.size),o.setBrushOpacity(F.opacity),o.setBrushHardness(F.hardness),o.brushSettings.type=F.type,o.setBrushStepSize(F.stepSize??5)),watch(()=>o.clearTrigger,()=>{fe()}),watch(()=>o.canvasHistory.currentStateIndex,async()=>{k.value||(await G(),l&&u&&l.clearPreview(u))}),onUnmounted(()=>{l&&(l.destroy(),l=null),s&&(s.destroy(),s=null),a&&(a.destroy(),a=null),f&&(f.destroy(),f=null),_&&(_.destroy(),_=null),y&&(y.destroy(),y=null),b&&(b.destroy(),b=null)});async function j(){if(o.tgpuRoot){r=o.tgpuRoot.device;return}try{const Z=await bf.init();o.tgpuRoot=Z,r=Z.device,console.warn("âœ… TypeGPU initialized! Root:",Z),console.warn("Device info:",Z.device.limits)}catch(Z){console.warn("Failed to initialize TypeGPU:",Z.message)}}p(j,"initTypeGPU");function U(Z){for(let J=0;J<Z.length;J+=4){const le=Z[J+3]/255;Z[J]=Math.round(Z[J]*le),Z[J+1]=Math.round(Z[J+1]*le),Z[J+2]=Math.round(Z[J+2]*le)}}p(U,"premultiplyData");async function G(){if(!r||!s||!a||!o.maskCanvas||!o.rgbCtx)return;const Z=o.maskCanvas.width,J=o.maskCanvas.height,le=o.maskCtx.getImageData(0,0,Z,J);U(le.data),r.queue.writeTexture({texture:s},le.data,{bytesPerRow:Z*4},{width:Z,height:J});const ce=o.rgbCtx.getImageData(0,0,Z,J);U(ce.data),r.queue.writeTexture({texture:a},ce.data,{bytesPerRow:Z*4},{width:Z,height:J})}p(G,"updateGPUFromCanvas");async function H(){if(await j(),!o.tgpuRoot||!r){console.warn("TypeGPU not initialized, skipping GPU resource setup");return}if(!o.maskCanvas||!o.rgbCanvas||!o.maskCtx||!o.rgbCtx){console.warn("Canvas contexts not ready, skipping GPU resource setup");return}const Z=o.maskCanvas.width,J=o.maskCanvas.height;try{console.warn(`ðŸŽ¨ Initializing GPU resources for ${Z}x${J} canvas`),s=(globalThis.__TYPEGPU_AUTONAME__??(ce=>ce))(r.createTexture({size:[Z,J],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC}),"maskTexture"),a=(globalThis.__TYPEGPU_AUTONAME__??(ce=>ce))(r.createTexture({size:[Z,J],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC}),"rgbTexture"),await G(),console.warn("âœ… GPU resources initialized successfully");const le=navigator.gpu.getPreferredCanvasFormat();l=new GPUBrushRenderer(r,le),console.warn("âœ… Brush renderer initialized")}catch(le){console.error("Failed to initialize GPU resources:",le),s=null,a=null}}p(H,"initGPUResources");function W(Z,J){const le=o.brushSettings,ce=o.maskCtx,ke=o.rgbCtx;if(!ce||!ke)throw new Error("Canvas contexts are required");const ye=le.type,ie=le.size,pe=le.hardness,ge=J??le.opacity,Ce=ce.globalCompositeOperation==="destination-out",we=o.currentTool;if(o.activeLayer==="rgb"&&we&&(we===Tools.Eraser||we===Tools.PaintPen)){const Ne=getEffectiveBrushSize(ie,pe),xe=getEffectiveHardness(ie,pe,Ne);X(ke,Z,ye,Ne,xe,ge);return}const Te=getEffectiveBrushSize(ie,pe),Ee=getEffectiveHardness(ie,pe,Te);Q(ce,Z,ye,Te,Ee,ge,Ce),M(Z.x,Z.y,Te)}p(W,"drawShape");function X(Z,J,le,ce,ke,ye){const{x:ie,y:pe}=J,ge=o.rgbColor;if(le===BrushShape.Rect&&ke<1){const we=ee(ge,ye),Ie=C(ce,ke,we,ye);Z.drawImage(Ie,ie-ce,pe-ce),M(ie,pe,ce);return}if(ke===1){const we=ee(ge,ye);Z.fillStyle=we,q(Z,le,ie,pe,ce),M(ie,pe,ce);return}const Ce=Y(Z,ie,pe,ce,ke,ge,ye,!1);Z.fillStyle=Ce,q(Z,le,ie,pe,ce),M(ie,pe,ce)}p(X,"drawRgbShape");function Q(Z,J,le,ce,ke,ye,ie){const{x:pe,y:ge}=J,Ce=o.maskColor;if(le===BrushShape.Rect&&ke<1){const Te=ie?`rgba(255, 255, 255, ${ye})`:`rgba(${Ce.r}, ${Ce.g}, ${Ce.b}, ${ye})`,Ee=C(ce,ke,Te,ye);Z.drawImage(Ee,pe-ce,ge-ce),M(pe,ge,ce);return}if(ke===1){Z.fillStyle=ie?`rgba(255, 255, 255, ${ye})`:`rgba(${Ce.r}, ${Ce.g}, ${Ce.b}, ${ye})`,q(Z,le,pe,ge,ce),M(pe,ge,ce);return}const we=`rgb(${Ce.r}, ${Ce.g}, ${Ce.b})`,Ie=Y(Z,pe,ge,ce,ke,we,ye,ie);Z.fillStyle=Ie,q(Z,le,pe,ge,ce),M(pe,ge,ce)}p(Q,"drawMaskShape");function q(Z,J,le,ce,ke){Z.beginPath(),J===BrushShape.Rect?Z.rect(le-ke,ce-ke,ke*2,ke*2):Z.arc(le,ce,ke,0,Math.PI*2,!1),Z.fill()}p(q,"drawShapeOnContext");function ee(Z,J){const{r:le,g:ce,b:ke}=hexToRgb(Z);return`rgba(${le}, ${ce}, ${ke}, ${J})`}p(ee,"formatRgba");function Y(Z,J,le,ce,ke,ye,ie,pe){if(!Number.isFinite(J)||!Number.isFinite(le)||!Number.isFinite(ce))return Z.createRadialGradient(0,0,0,0,0,0);const ge=Z.createRadialGradient(J,le,0,J,le,ce);if(pe)ge.addColorStop(0,`rgba(255, 255, 255, ${ie})`),ge.addColorStop(ke,`rgba(255, 255, 255, ${ie})`),ge.addColorStop(1,"rgba(255, 255, 255, 0)");else{const{r:Ce,g:we,b:Ie}=parseToRgb(ye);ge.addColorStop(0,`rgba(${Ce}, ${we}, ${Ie}, ${ie})`),ge.addColorStop(ke,`rgba(${Ce}, ${we}, ${Ie}, ${ie})`),ge.addColorStop(1,`rgba(${Ce}, ${we}, ${Ie}, 0)`)}return ge}p(Y,"createBrushGradient");async function ae(Z){if(!P)return;const J=P.addPoint(Z);if(J.length===0){l&&A.value&&me([],!0);return}if(l)me(J,!0);else for(const le of J)W(le);A.value=!1}p(ae,"drawWithBetterSmoothing");function re(Z){const J=o.maskBlendMode,le=o.maskCtx,ce=o.rgbCtx;if(!le||!ce)throw new Error("Canvas contexts are required");le.beginPath(),ce.beginPath(),Z===CompositionOperation.SourceOver?(le.fillStyle=J,le.globalCompositeOperation=CompositionOperation.SourceOver,ce.globalCompositeOperation=CompositionOperation.SourceOver):Z===CompositionOperation.DestinationOut&&(le.globalCompositeOperation=CompositionOperation.DestinationOut,ce.globalCompositeOperation=CompositionOperation.DestinationOut)}p(re,"initShape");async function ue(Z,J,le,ce){const{points:ke,remainder:ye}=resampleSegment([Z,J],ce,N.value);if(N.value=ye,re(le),l)me(ke);else for(const ie of ke)W(ie,1)}p(ue,"drawLine");async function K(Z){I.value=!0,O();try{l&&o.maskCanvas&&l.prepareStroke(o.maskCanvas.width,o.maskCanvas.height);let J;const le=o.currentTool,ce={x:Z.offsetX,y:Z.offsetY},ke=n.screenToCanvas(ce);le==="eraser"||Z.buttons===2?J=CompositionOperation.DestinationOut:J=CompositionOperation.SourceOver;const ye=o.brushSettings.stepSize/100,ie=Math.max(1,o.brushSettings.size*ye);if(Z.shiftKey&&E.value?(T.value=!0,await ue(E.value,ke,J,ie)):(T.value=!1,re(J),N.value=ie),E.value=ke,l){const pe=o.activeLayer==="rgb";pe&&o.rgbCanvas?(o.rgbCanvas.style.opacity="0",m&&(m.style.opacity="1")):!pe&&o.maskCanvas&&(o.maskCanvas.style.opacity="0",m&&(m.style.opacity=String(o.maskOpacity)))}P=new StrokeProcessor(ie),await ae(ke),L.value=new Date}catch(J){console.error("[useBrushDrawing] Failed to start drawing:",J),I.value=!1,T.value=!1}}p(K,"startDrawing");async function ne(Z){const J=performance.now()-L.value.getTime(),le={x:Z.offsetX,y:Z.offsetY},ce=n.screenToCanvas(le),ke=o.currentTool;J>20&&!I.value?requestAnimationFrame(async()=>{if(I.value)try{re(CompositionOperation.SourceOver),await be(ce)}catch(ye){console.error("[useBrushDrawing] Drawing error:",ye)}}):requestAnimationFrame(async()=>{if(I.value)try{ke==="eraser"||Z.buttons===2?re(CompositionOperation.DestinationOut):re(CompositionOperation.SourceOver),await ae(ce)}catch(ye){console.error("[useBrushDrawing] Drawing error:",ye)}}),L.value=new Date}p(ne,"handleDrawing");async function de(Z){const J={x:Z.offsetX,y:Z.offsetY},le=n.screenToCanvas(J);if(I.value){if(I.value=!1,E.value=le,A.value=!0,P){const ye=P.endStroke();if(ye.length>0)if(l)me(ye,!0);else for(const ie of ye)W(ie);P=null}if(l&&s&&a){const ie=o.activeLayer==="rgb"?a:s,pe=o.brushSettings.size,ge=o.brushSettings.hardness,Ce=getEffectiveBrushSize(pe,ge),we=getEffectiveHardness(pe,ge,Ce),Ie=o.currentTool==="eraser"||o.maskCtx?.globalCompositeOperation==="destination-out",Te=o.brushSettings.type===BrushShape.Rect?1:0;l.compositeStroke(ie.createView(),{opacity:o.brushSettings.opacity,color:[0,0,0],hardness:we,screenSize:[o.maskCanvas.width,o.maskCanvas.height],brushShape:Te,isErasing:Ie})}let ce,ke;if(l&&s&&a)try{const ye=await se();ce=ye.maskData,ke=ye.rgbData}catch(ye){console.warn("GPU readback failed, falling back to CPU:",ye)}k.value=!0,o.canvasHistory.saveState(ce,ke),await nextTick(),k.value=!1,l&&u&&l.clearPreview(u),o.activeLayer==="rgb"&&o.rgbCanvas?o.rgbCanvas.style.opacity="1":o.activeLayer==="mask"&&o.maskCanvas&&(o.maskCanvas.style.opacity=String(o.maskOpacity)),m&&(m.style.opacity="1")}}p(de,"drawEnd");async function ve(Z){Z.preventDefault();const J={x:Z.offsetX,y:Z.offsetY},le=n.screenToCanvas(J);o.brushPreviewGradientVisible=!0,R.value=le}p(ve,"startBrushAdjustment");async function _e(Z){if(!R.value)return;const J={x:Z.offsetX,y:Z.offsetY},le=5,ce=n.screenToCanvas(J),ke=ce.x-R.value.x,ye=ce.y-R.value.y,ie=Math.abs(ke)<le?0:ke,pe=Math.abs(ye)<le?0:ye;let ge=ie,Ce=pe;if(V.value){const Ne=Math.abs(ie)/Math.abs(pe),xe=2;Ne>xe?Ce=0:Ne<1/xe&&(ge=0)}const we=Math.max(-100,Math.min(100,ge)),Ie=Math.max(-100,Math.min(100,Ce)),Te=Math.max(1,Math.min(500,o.brushSettings.size+we/35*$.value)),Ee=Math.max(0,Math.min(1,o.brushSettings.hardness-Ie/4e3*$.value));o.setBrushSize(Te),o.setBrushHardness(Ee)}p(_e,"handleBrushAdjustment");function oe(){saveBrushToCache("maskeditor_brush_settings",o.brushSettings)}p(oe,"saveBrushSettings");async function se(){if(!r||!s||!a||!o.maskCanvas||!o.rgbCanvas||!o.maskCtx||!o.rgbCtx||!l)throw new Error("GPU resources not ready");const Z=o.maskCanvas.width,J=o.maskCanvas.height,le=Z*J*4;(!f||!_||!y||!b||w!==le)&&(f?.destroy(),_?.destroy(),y?.destroy(),b?.destroy(),f=(globalThis.__TYPEGPU_AUTONAME__??(Te=>Te))(r.createBuffer({size:le,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),"readbackStorageMask"),_=(globalThis.__TYPEGPU_AUTONAME__??(Te=>Te))(r.createBuffer({size:le,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),"readbackStorageRgb"),y=(globalThis.__TYPEGPU_AUTONAME__??(Te=>Te))(r.createBuffer({size:le,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),"readbackStagingMask"),b=(globalThis.__TYPEGPU_AUTONAME__??(Te=>Te))(r.createBuffer({size:le,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),"readbackStagingRgb"),w=le),l.prepareReadback(s,f),l.prepareReadback(a,_);const ce=r.createCommandEncoder();ce.copyBufferToBuffer(f,0,y,0,le),ce.copyBufferToBuffer(_,0,b,0,le),r.queue.submit([ce.finish()]),await Promise.all([y.mapAsync(GPUMapMode.READ),b.mapAsync(GPUMapMode.READ)]);const ke=new Uint8ClampedArray(y.getMappedRange().slice(0)),ye=new Uint8ClampedArray(b.getMappedRange().slice(0));y.unmap(),b.unmap();const ie=new ImageData(ke,Z,J),pe=new ImageData(ye,Z,J);let ge=0,Ce=0,we=Z,Ie=J;if(D.value.minX!==1/0&&D.value.maxX!==-1/0){const Te=D.value;ge=Math.floor(Math.max(0,Te.minX)),Ce=Math.floor(Math.max(0,Te.minY));const Ee=Math.ceil(Math.min(Z,Te.maxX)),Ne=Math.ceil(Math.min(J,Te.maxY));we=Ee-ge,Ie=Ne-Ce}return we>0&&Ie>0?(o.maskCtx.putImageData(ie,0,0,ge,Ce,we,Ie),o.rgbCtx.putImageData(pe,0,0,ge,Ce,we,Ie)):(o.maskCtx.putImageData(ie,0,0),o.rgbCtx.putImageData(pe,0,0)),{maskData:ie,rgbData:pe}}p(se,"copyGpuToCanvas");function he(){l?.destroy(),s&&(s.destroy(),s=null),a&&(a.destroy(),a=null),f?.destroy(),_?.destroy(),y?.destroy(),b?.destroy(),f=null,_=null,y=null,b=null,w=0,o.tgpuRoot&&(o.tgpuRoot.destroy(),o.tgpuRoot=null),r=null}p(he,"destroy");async function be(Z,J=1){if(l){const le=o.maskCanvas.width,ce=o.maskCanvas.height,ke=[{x:Z.x,y:Z.y,pressure:J}],ye=o.brushSettings.size,ie=o.brushSettings.hardness,pe=getEffectiveBrushSize(ye,ie),ge=getEffectiveHardness(ye,ie,pe),Ce=o.brushSettings.type===BrushShape.Rect?1:0;if(l.renderStrokeToAccumulator(ke,{size:pe,opacity:.5,hardness:ge,color:[1,1,1],width:le,height:ce,brushShape:Ce}),s&&u){const we=o.activeLayer==="rgb";let Ie=[1,1,1];if(we){const Ee=parseToRgb(o.rgbColor);Ie=[Ee.r/255,Ee.g/255,Ee.b/255]}else{const Ee=o.maskColor;Ie=[Ee.r/255,Ee.g/255,Ee.b/255]}const Te=o.currentTool==="eraser"||o.maskCtx?.globalCompositeOperation==="destination-out";l.blitToCanvas(u,{opacity:o.brushSettings.opacity,color:Ie,hardness:ge,screenSize:[le,ce],brushShape:Ce,isErasing:Te},void 0)}}else W(Z,J)}p(be,"gpuDrawPoint");function Se(Z){if(!r)return;const J=Z.getContext("webgpu");J&&(J.configure({device:r,format:navigator.gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),u=J,m=Z,console.warn("âœ… Preview Canvas Initialized"))}p(Se,"initPreviewCanvas");function me(Z,J=!1){if(!l||!s||!a)return;const le=o.activeLayer==="rgb";let ce=[1,1,1];if(le){const we=parseToRgb(o.rgbColor);ce=[we.r/255,we.g/255,we.b/255]}else{const we=o.maskColor;ce=[we.r/255,we.g/255,we.b/255]}let ke=[];if(J)ke=Z.map(we=>({x:we.x,y:we.y,pressure:1}));else for(let we=0;we<Z.length-1;we++){const Ie=Z[we],Te=Z[we+1],Ee=Math.hypot(Te.x-Ie.x,Te.y-Ie.y),Ne=o.brushSettings.stepSize/100,xe=Math.max(1,o.brushSettings.size*Ne),Be=Math.max(1,Math.ceil(Ee/xe));for(let Ae=0;Ae<=Be;Ae++){const Oe=Ae/Be,Me=1,$e=Ie.x+(Te.x-Ie.x)*Oe,De=Ie.y+(Te.y-Ie.y)*Oe;ke.push({x:$e,y:De,pressure:Me})}}const ye=o.brushSettings.size,ie=o.brushSettings.hardness,pe=getEffectiveBrushSize(ye,ie),ge=getEffectiveHardness(ye,ie,pe),Ce=o.brushSettings.type===BrushShape.Rect?1:0;l.renderStrokeToAccumulator(ke,{size:pe,opacity:.5,hardness:ge,color:ce,width:o.maskCanvas.width,height:o.maskCanvas.height,brushShape:Ce});for(const we of ke)M(we.x,we.y,pe);if(u){const we=o.currentTool==="eraser"||o.maskCtx?.globalCompositeOperation==="destination-out",Ie=le?a:s;l.blitToCanvas(u,{opacity:o.brushSettings.opacity,color:ce,hardness:ge,screenSize:[o.maskCanvas.width,o.maskCanvas.height],brushShape:Ce,isErasing:we},Ie??void 0)}}p(me,"gpuRender");function fe(){if(!r||!s||!a||!o.maskCanvas)return;const Z=o.maskCanvas.width,J=o.maskCanvas.height;r.queue.writeTexture({texture:s},new Uint8Array(Z*J*4),{bytesPerRow:Z*4},{width:Z,height:J}),r.queue.writeTexture({texture:a},new Uint8Array(Z*J*4),{bytesPerRow:Z*4},{width:Z,height:J})}return p(fe,"clearGPU"),{startDrawing:K,handleDrawing:ne,drawEnd:de,startBrushAdjustment:ve,handleBrushAdjustment:_e,saveBrushSettings:oe,destroy:he,initGPUResources:H,initPreviewCanvas:Se,clearGPU:fe}}p(useBrushDrawing,"useBrushDrawing");function useToolManager(i,o){const n=useMaskEditorStore(),s=useCoordinateTransform(),a=useBrushDrawing({useDominantAxis:app$1.extensionManager.setting.get("Comfy.MaskEditor.UseDominantAxis"),brushAdjustmentSpeed:app$1.extensionManager.setting.get("Comfy.MaskEditor.BrushAdjustmentSpeed")}),r=useCanvasTools(),l=ref(null),u={[Tools.MaskPen]:{newActiveLayerOnSet:"mask"},[Tools.Eraser]:{},[Tools.PaintPen]:{newActiveLayerOnSet:"rgb"},[Tools.MaskBucket]:{cursor:"url('/cursor/paintBucket.png') 30 25, auto",newActiveLayerOnSet:"mask"},[Tools.MaskColorFill]:{cursor:"url('/cursor/colorSelect.png') 15 25, auto",newActiveLayerOnSet:"mask"}},m=p(k=>{n.activeLayer=k;const S=n.currentTool;[Tools.MaskPen,Tools.MaskBucket,Tools.MaskColorFill].includes(S)&&k==="rgb"&&f(Tools.PaintPen),S===Tools.PaintPen&&k==="mask"&&f(Tools.MaskPen)},"setActiveLayer"),f=p(k=>{n.currentTool=k;const S=u[k].newActiveLayerOnSet;S&&(n.activeLayer=S);const C=u[k].cursor,I=n.pointerZone;C&&I?(n.brushVisible=!1,I.style.cursor=C):I&&(n.brushVisible=!0,I.style.cursor="none")},"switchTool"),_=p(()=>{const k=n.currentTool,S=u[k].cursor,C=n.pointerZone;S&&C?(n.brushVisible=!1,C.style.cursor=S):C&&(n.brushVisible=!0,C.style.cursor="none"),n.brushPreviewGradientVisible=!1},"updateCursor");return watch(()=>n.currentTool,k=>{k!==Tools.MaskColorFill&&r.clearLastColorSelectPoint()}),{switchTool:f,setActiveLayer:m,updateCursor:_,handlePointerDown:p(async k=>{if(k.preventDefault(),k.pointerType==="touch")return;const S=i.isKeyDown(" ");if(k.buttons===4||k.buttons===1&&S){o.handlePanStart(k),n.brushVisible=!1;return}if(n.currentTool===Tools.PaintPen&&k.button===0){await a.startDrawing(k);return}if(n.currentTool===Tools.PaintPen&&k.buttons===1){await a.handleDrawing(k);return}if(n.currentTool===Tools.MaskBucket&&k.button===0){const I={x:k.offsetX,y:k.offsetY},T=s.screenToCanvas(I);r.paintBucketFill(T);return}if(n.currentTool===Tools.MaskColorFill&&k.button===0){const I={x:k.offsetX,y:k.offsetY},T=s.screenToCanvas(I);await r.colorSelectFill(T);return}if(k.altKey&&k.button===2){n.isAdjustingBrush=!0,await a.startBrushAdjustment(k);return}const C=[Tools.MaskPen,Tools.Eraser,Tools.PaintPen].includes(n.currentTool);if([0,2].includes(k.button)&&C){await a.startDrawing(k);return}},"handlePointerDown"),handlePointerMove:p(async k=>{if(k.preventDefault(),k.pointerType==="touch")return;const S={x:k.clientX,y:k.clientY};o.updateCursorPosition(S);const C=i.isKeyDown(" ");if(k.buttons===4||k.buttons===1&&C){await o.handlePanMove(k);return}if([Tools.MaskPen,Tools.Eraser,Tools.PaintPen].includes(n.currentTool)){if(n.isAdjustingBrush&&(n.currentTool===Tools.MaskPen||n.currentTool===Tools.Eraser)&&k.altKey&&k.buttons===2){await a.handleBrushAdjustment(k);return}if(k.buttons===1||k.buttons===2){await a.handleDrawing(k);return}}},"handlePointerMove"),handlePointerUp:p(async k=>{n.isPanning=!1,n.brushVisible=!0,k.pointerType!=="touch"&&(_(),n.isAdjustingBrush=!1,await a.drawEnd(k),l.value=null)},"handlePointerUp"),brushDrawing:a}}p(useToolManager,"useToolManager");const _sfc_main$1p=defineComponent({__name:"BrushCursor",props:{containerRef:{}},setup(i){const o=useMaskEditorStore(),n=computed(()=>o.brushVisible?1:0),s=computed(()=>{const _=o.brushSettings.size,y=o.brushSettings.hardness;return getEffectiveBrushSize(_,y)*o.zoomRatio}),a=computed(()=>s.value*2),r=computed(()=>{const y=i.containerRef?.getBoundingClientRect()?.left||0;return o.cursorPoint.x+o.panOffset.x-s.value-y}),l=computed(()=>{const y=i.containerRef?.getBoundingClientRect()?.top||0;return o.cursorPoint.y+o.panOffset.y-s.value-y}),u=computed(()=>o.brushSettings.type===BrushShape.Rect?"0%":"50%"),m=computed(()=>o.brushPreviewGradientVisible),f=computed(()=>{const _=o.brushSettings.size,y=o.brushSettings.hardness,b=getEffectiveBrushSize(_,y),w=getEffectiveHardness(_,y,b);if(w===1)return"rgba(255, 0, 0, 0.5)";const k=w*100,S=100,C=k+(S-k)*.5;return`radial-gradient(
    circle,
    rgba(255, 0, 0, 0.5) 0%,
    rgba(255, 0, 0, 0.5) ${k}%,
    rgba(255, 0, 0, 0.125) ${C}%,
    rgba(255, 0, 0, 0) ${S}%
  )`});return(_,y)=>(openBlock(),createElementBlock("div",{id:"maskEditor_brush",style:normalizeStyle({position:"absolute",opacity:n.value,width:`${a.value}px`,height:`${a.value}px`,left:`${r.value}px`,top:`${l.value}px`,borderRadius:u.value,pointerEvents:"none",zIndex:1e3})},[createBaseVNode("div",{id:"maskEditor_brushPreviewGradient",style:normalizeStyle({display:m.value?"block":"none",background:f.value})},null,4)],4))}}),_sfc_main$1o=defineComponent({__name:"PointerZone",props:{toolManager:{},panZoom:{}},setup(i){const o=useMaskEditorStore(),n=ref();onMounted(()=>{if(!n.value){console.error("[PointerZone] Pointer zone ref not initialized");return}o.pointerZone=n.value}),watch(()=>o.isPanning,b=>{n.value&&(b?n.value.style.cursor="grabbing":i.toolManager.updateCursor())});const s=p(async b=>{await i.toolManager.handlePointerDown(b)},"handlePointerDown"),a=p(async b=>{await i.toolManager.handlePointerMove(b)},"handlePointerMove"),r=p(b=>{i.toolManager.handlePointerUp(b)},"handlePointerUp"),l=p(()=>{o.brushVisible=!1,n.value&&(n.value.style.cursor="")},"handlePointerLeave"),u=p(()=>{i.toolManager.updateCursor()},"handlePointerEnter"),m=p(b=>{i.panZoom.handleTouchStart(b)},"handleTouchStart"),f=p(async b=>{await i.panZoom.handleTouchMove(b)},"handleTouchMove"),_=p(b=>{i.panZoom.handleTouchEnd(b)},"handleTouchEnd"),y=p(async b=>{await i.panZoom.zoom(b);const w={x:b.clientX,y:b.clientY};i.panZoom.updateCursorPosition(w)},"handleWheel");return(b,w)=>(openBlock(),createElementBlock("div",{ref_key:"pointerZoneRef",ref:n,class:"w-[calc(100%-4rem-220px)] h-full",onPointerdown:s,onPointermove:a,onPointerup:r,onPointerleave:l,onPointerenter:u,onTouchstart:m,onTouchmove:f,onTouchend:_,onWheel:y,onContextmenu:w[0]||(w[0]=withModifiers(()=>{},["prevent"]))},null,544))}}),_hoisted_1$1d={class:"flex flex-col gap-3 pb-3"},_hoisted_2$Y={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},_hoisted_3$E=["min","max","step","value"],_sfc_main$1n=defineComponent({__name:"SliderControl",props:{label:{},min:{},max:{},step:{default:1},modelValue:{}},emits:["update:modelValue"],setup(i,{emit:o}){const n=o,s=p(a=>{const r=Number(a.target.value);n("update:modelValue",r)},"onInput");return(a,r)=>(openBlock(),createElementBlock("div",_hoisted_1$1d,[createBaseVNode("span",_hoisted_2$Y,toDisplayString(a.label),1),createBaseVNode("input",{type:"range",class:"maskEditor_sidePanelBrushRange",min:a.min,max:a.max,step:a.step,value:a.modelValue,onInput:s},null,40,_hoisted_3$E)]))}}),_hoisted_1$1c={class:"flex flex-col gap-3 pb-3"},_hoisted_2$X={class:"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5"},_hoisted_3$D={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},_hoisted_4$w={class:"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] -mt-2 -mb-1.5"},_hoisted_5$s=["value"],_hoisted_6$j={value:"black"},_hoisted_7$h={value:"white"},_hoisted_8$d={value:"negative"},_hoisted_9$a={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},_hoisted_10$9=["checked"],_hoisted_11$6={class:"maskEditor_sidePanelLayerPreviewContainer"},_hoisted_12$3={viewBox:"0 0 20 20",style:{}},_hoisted_13$3=["disabled"],_hoisted_14$1={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},_hoisted_15$1=["checked"],_hoisted_16$1=["disabled"],_hoisted_17$1={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},_hoisted_18$1={class:"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-secondary-background-hover"},_hoisted_19$1=["checked"],_hoisted_20$1={class:"maskEditor_sidePanelLayerPreviewContainer"},_hoisted_21$1=["src","alt"],_sfc_main$1m=defineComponent({__name:"ImageLayerSettingsPanel",props:{toolManager:{}},setup(i){const o=useMaskEditorStore(),n=useCanvasManager(),s=ref(!0),a=ref(!0),r=ref(!0),l=computed(()=>o.image?.src??""),u=computed(()=>o.currentTool===Tools.Eraser),m=p(k=>{const S=k.target.checked;s.value=S;const C=o.maskCanvas;C&&(C.style.opacity=S?String(o.maskOpacity):"0")},"onMaskLayerVisibilityChange"),f=p(k=>{const S=k.target.checked;a.value=S;const C=o.rgbCanvas;C&&(C.style.opacity=S?"1":"0")},"onPaintLayerVisibilityChange"),_=p(k=>{const S=k.target.checked;r.value=S;const C=o.imgCanvas;C&&(C.style.opacity=S?"1":"0")},"onBaseImageLayerVisibilityChange"),y=p(k=>{o.setMaskOpacity(k);const S=o.maskCanvas;S&&(S.style.opacity=String(k)),s.value=k!==0},"onMaskOpacityChange"),b=p(async k=>{const S=k.target.value;let C;switch(S){case"white":C=MaskBlendMode.White;break;case"negative":C=MaskBlendMode.Negative;break;default:C=MaskBlendMode.Black}o.maskBlendMode=C,await n.updateMaskColor()},"onBlendModeChange"),w=p(k=>{i.toolManager?.setActiveLayer(k)},"setActiveLayer");return(k,S)=>(openBlock(),createElementBlock("div",_hoisted_1$1c,[createBaseVNode("h3",_hoisted_2$X,toDisplayString(unref(t)("maskEditor.layers")),1),createVNode(_sfc_main$1n,{label:unref(t)("maskEditor.maskOpacity"),min:0,max:1,step:.01,"model-value":unref(o).maskOpacity,"onUpdate:modelValue":y},null,8,["label","model-value"]),createBaseVNode("span",_hoisted_3$D,toDisplayString(unref(t)("maskEditor.maskBlendingOptions")),1),createBaseVNode("div",_hoisted_4$w,[createBaseVNode("select",{class:"maskEditor_sidePanelDropdown",value:unref(o).maskBlendMode,onChange:b},[createBaseVNode("option",_hoisted_6$j,toDisplayString(unref(t)("maskEditor.black")),1),createBaseVNode("option",_hoisted_7$h,toDisplayString(unref(t)("maskEditor.white")),1),createBaseVNode("option",_hoisted_8$d,toDisplayString(unref(t)("maskEditor.negative")),1)],40,_hoisted_5$s)]),createBaseVNode("span",_hoisted_9$a,toDisplayString(unref(t)("maskEditor.maskLayer")),1),createBaseVNode("div",{class:"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-secondary-background-hover",style:normalizeStyle({border:unref(o).activeLayer==="mask"?"2px solid #007acc":"none"})},[createBaseVNode("input",{type:"checkbox",class:"maskEditor_sidePanelLayerCheckbox",checked:s.value,onChange:m},null,40,_hoisted_10$9),createBaseVNode("div",_hoisted_11$6,[(openBlock(),createElementBlock("svg",_hoisted_12$3,S[2]||(S[2]=[createBaseVNode("path",{class:"cls-1",d:"M1.31,5.32v9.36c0,.55.45,1,1,1h15.38c.55,0,1-.45,1-1V5.32c0-.55-.45-1-1-1H2.31c-.55,0-1,.45-1,1ZM11.19,13.44c-2.91.94-5.57-1.72-4.63-4.63.34-1.05,1.19-1.9,2.24-2.24,2.91-.94,5.57,1.72,4.63,4.63-.34,1.05-1.19-1.9-2.24,2.24Z"},null,-1)])))]),createBaseVNode("button",{style:normalizeStyle([{"font-size":"12px"},{opacity:unref(o).activeLayer==="mask"?"0.5":"1"}]),disabled:unref(o).activeLayer==="mask",onClick:S[0]||(S[0]=C=>w("mask"))},toDisplayString(unref(t)("maskEditor.activateLayer")),13,_hoisted_13$3)],4),createBaseVNode("span",_hoisted_14$1,toDisplayString(unref(t)("maskEditor.paintLayer")),1),createBaseVNode("div",{class:"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-secondary-background-hover",style:normalizeStyle({border:unref(o).activeLayer==="rgb"?"2px solid #007acc":"none"})},[createBaseVNode("input",{type:"checkbox",class:"maskEditor_sidePanelLayerCheckbox",checked:a.value,onChange:f},null,40,_hoisted_15$1),S[3]||(S[3]=createBaseVNode("div",{class:"maskEditor_sidePanelLayerPreviewContainer"},[createBaseVNode("svg",{viewBox:"0 0 20 20"},[createBaseVNode("path",{class:"cls-1",d:"M 17 6.965 c 0 0.235 -0.095 0.47 -0.275 0.655 l -6.51 6.52 c -0.045 0.035 -0.09 0.075 -0.135 0.11 c -0.035 -0.695 -0.605 -1.24 -1.305 -1.245 c 0.035 -0.06 0.08 -0.12 0.135 -0.17 l 6.52 -6.52 c 0.36 -0.36 0.945 -0.36 1.3 0 c 0.175 0.175 0.275 0.415 0.275 0.65 Z"}),createBaseVNode("path",{class:"cls-1",d:"M 9.82 14.515 c 0 2.23 -3.23 1.59 -4.82 0 c 1.65 -0.235 2.375 -1.29 3.53 -1.29 c 0.715 0 1.29 0.58 1.29 1.29 Z"})])],-1)),createBaseVNode("button",{style:normalizeStyle([{"font-size":"12px"},{opacity:unref(o).activeLayer==="rgb"?"0.5":"1",display:u.value?"block":"none"}]),disabled:unref(o).activeLayer==="rgb",onClick:S[1]||(S[1]=C=>w("rgb"))},toDisplayString(unref(t)("maskEditor.activateLayer")),13,_hoisted_16$1)],4),createBaseVNode("span",_hoisted_17$1,toDisplayString(unref(t)("maskEditor.baseImageLayer")),1),createBaseVNode("div",_hoisted_18$1,[createBaseVNode("input",{type:"checkbox",class:"maskEditor_sidePanelLayerCheckbox",checked:r.value,onChange:_},null,40,_hoisted_19$1),createBaseVNode("div",_hoisted_20$1,[createBaseVNode("img",{class:"maskEditor_sidePanelImageLayerImage",src:l.value,alt:unref(t)("maskEditor.baseLayerPreview")},null,8,_hoisted_21$1)])])]))}}),_hoisted_1$1b={class:"flex flex-col gap-3 pb-3"},_hoisted_2$W={class:"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5"},_hoisted_3$C={class:"flex flex-col gap-3 pb-3"},_hoisted_4$v={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},_hoisted_5$r={class:"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-secondary-background-hover"},_hoisted_6$i={class:"flex flex-col gap-3 pb-3"},_hoisted_7$g={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},_hoisted_8$c=["value"],_sfc_main$1l=defineComponent({__name:"BrushSettingsPanel",setup(i){const o=useMaskEditorStore(),n=p(f=>{o.brushSettings.type=f},"setBrushShape"),s=p(f=>{o.rgbColor=f.target.value},"onColorChange"),a=p(f=>{o.setBrushSize(f)},"onThicknessChange"),r=p(f=>{o.setBrushOpacity(f)},"onOpacityChange"),l=p(f=>{o.setBrushHardness(f)},"onHardnessChange"),u=p(f=>{o.setBrushStepSize(f)},"onStepSizeChange"),m=p(()=>{o.resetBrushToDefault()},"resetToDefault");return(f,_)=>(openBlock(),createElementBlock("div",_hoisted_1$1b,[createBaseVNode("h3",_hoisted_2$W,toDisplayString(unref(t)("maskEditor.brushSettings")),1),createBaseVNode("button",{class:"w-45 h-7.5 border-none bg-black/20 border border-[var(--border-color)] text-[var(--input-text)] font-sans text-[15px] pointer-events-auto transition-colors duration-100 hover:bg-[var(--p-overlaybadge-outline-color)] hover:border-none",onClick:m},toDisplayString(unref(t)("maskEditor.resetToDefault")),1),createBaseVNode("div",_hoisted_3$C,[createBaseVNode("span",_hoisted_4$v,toDisplayString(unref(t)("maskEditor.brushShape")),1),createBaseVNode("div",_hoisted_5$r,[createBaseVNode("div",{class:normalizeClass(["maskEditor_sidePanelBrushShapeCircle bg-transparent hover:bg-comfy-menu-bg",{active:unref(o).brushSettings.type===unref(BrushShape).Arc}]),style:normalizeStyle({background:unref(o).brushSettings.type===unref(BrushShape).Arc?"var(--p-button-text-primary-color)":""}),onClick:_[0]||(_[0]=y=>n(unref(BrushShape).Arc))},null,6),createBaseVNode("div",{class:normalizeClass(["maskEditor_sidePanelBrushShapeSquare bg-transparent hover:bg-comfy-menu-bg",{active:unref(o).brushSettings.type===unref(BrushShape).Rect}]),style:normalizeStyle({background:unref(o).brushSettings.type===unref(BrushShape).Rect?"var(--p-button-text-primary-color)":""}),onClick:_[1]||(_[1]=y=>n(unref(BrushShape).Rect))},null,6)])]),createBaseVNode("div",_hoisted_6$i,[createBaseVNode("span",_hoisted_7$g,toDisplayString(unref(t)("maskEditor.colorSelector")),1),createBaseVNode("input",{type:"color",value:unref(o).rgbColor,onInput:s},null,40,_hoisted_8$c)]),createVNode(_sfc_main$1n,{label:unref(t)("maskEditor.thickness"),min:1,max:500,step:1,"model-value":unref(o).brushSettings.size,"onUpdate:modelValue":a},null,8,["label","model-value"]),createVNode(_sfc_main$1n,{label:unref(t)("maskEditor.opacity"),min:0,max:1,step:.01,"model-value":unref(o).brushSettings.opacity,"onUpdate:modelValue":r},null,8,["label","model-value"]),createVNode(_sfc_main$1n,{label:unref(t)("maskEditor.hardness"),min:0,max:1,step:.01,"model-value":unref(o).brushSettings.hardness,"onUpdate:modelValue":l},null,8,["label","model-value"]),createVNode(_sfc_main$1n,{label:f.$t("maskEditor.stepSize"),min:1,max:100,step:1,"model-value":unref(o).brushSettings.stepSize,"onUpdate:modelValue":u},null,8,["label","model-value"])]))}}),_hoisted_1$1a={class:"flex flex-row gap-2.5 items-center min-h-6 relative"},_hoisted_2$V={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},_hoisted_3$B=["value"],_hoisted_4$u=["value"],_sfc_main$1k=defineComponent({__name:"DropdownControl",props:{label:{},options:{},modelValue:{}},emits:["update:modelValue"],setup(i,{emit:o}){const n=i,s=o,a=computed(()=>n.options.map(l=>typeof l=="string"?{label:l,value:l}:l)),r=p(l=>{const u=l.target.value;s("update:modelValue",u)},"onChange");return(l,u)=>(openBlock(),createElementBlock("div",_hoisted_1$1a,[createBaseVNode("span",_hoisted_2$V,toDisplayString(l.label),1),createBaseVNode("select",{class:"absolute right-0 h-6 px-1.5 rounded-md border border-border-default transition-colors duration-100 bg-secondary-background focus:outline focus:outline-node-component-border",value:l.modelValue,onChange:r},[(openBlock(!0),createElementBlock(Fragment,null,renderList(a.value,m=>(openBlock(),createElementBlock("option",{key:m.value,value:m.value},toDisplayString(m.label),9,_hoisted_4$u))),128))],40,_hoisted_3$B)]))}}),_hoisted_1$19={class:"flex flex-row gap-2.5 items-center min-h-6 relative"},_hoisted_2$U={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},_hoisted_3$A={class:"maskEditor_sidePanelToggleContainer"},_hoisted_4$t=["checked"],_sfc_main$1j=defineComponent({__name:"ToggleControl",props:{label:{},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(i,{emit:o}){const n=o,s=p(a=>{const r=a.target.checked;n("update:modelValue",r)},"onChange");return(a,r)=>(openBlock(),createElementBlock("div",_hoisted_1$19,[createBaseVNode("span",_hoisted_2$U,toDisplayString(a.label),1),createBaseVNode("label",_hoisted_3$A,[createBaseVNode("input",{type:"checkbox",class:"maskEditor_sidePanelToggleCheckbox",checked:a.modelValue,onChange:s},null,40,_hoisted_4$t),r[0]||(r[0]=createBaseVNode("div",{class:"maskEditor_sidePanelToggleSwitch"},null,-1))])]))}}),_hoisted_1$18={class:"flex flex-col gap-3 pb-3"},_hoisted_2$T={class:"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5"},_sfc_main$1i=defineComponent({__name:"ColorSelectSettingsPanel",setup(i){const o=useMaskEditorStore(),n=Object.values(ColorComparisonMethod),s=p(_=>{o.setColorSelectTolerance(_)},"onToleranceChange"),a=p(_=>{o.setSelectionOpacity(_)},"onSelectionOpacityChange"),r=p(_=>{o.colorSelectLivePreview=_},"onLivePreviewChange"),l=p(_=>{o.applyWholeImage=_},"onWholeImageChange"),u=p(_=>{o.colorComparisonMethod=_},"onMethodChange"),m=p(_=>{o.maskBoundary=_},"onMaskBoundaryChange"),f=p(_=>{o.setMaskTolerance(_)},"onMaskToleranceChange");return(_,y)=>(openBlock(),createElementBlock("div",_hoisted_1$18,[createBaseVNode("h3",_hoisted_2$T,toDisplayString(unref(t)("maskEditor.colorSelectSettings")),1),createVNode(_sfc_main$1n,{label:unref(t)("maskEditor.tolerance"),min:0,max:255,step:1,"model-value":unref(o).colorSelectTolerance,"onUpdate:modelValue":s},null,8,["label","model-value"]),createVNode(_sfc_main$1n,{label:unref(t)("maskEditor.selectionOpacity"),min:0,max:100,step:1,"model-value":unref(o).selectionOpacity,"onUpdate:modelValue":a},null,8,["label","model-value"]),createVNode(_sfc_main$1j,{label:unref(t)("maskEditor.livePreview"),"model-value":unref(o).colorSelectLivePreview,"onUpdate:modelValue":r},null,8,["label","model-value"]),createVNode(_sfc_main$1j,{label:unref(t)("maskEditor.applyToWholeImage"),"model-value":unref(o).applyWholeImage,"onUpdate:modelValue":l},null,8,["label","model-value"]),createVNode(_sfc_main$1k,{label:unref(t)("maskEditor.method"),options:unref(n),"model-value":unref(o).colorComparisonMethod,"onUpdate:modelValue":u},null,8,["label","options","model-value"]),createVNode(_sfc_main$1j,{label:unref(t)("maskEditor.stopAtMask"),"model-value":unref(o).maskBoundary,"onUpdate:modelValue":m},null,8,["label","model-value"]),createVNode(_sfc_main$1n,{label:unref(t)("maskEditor.maskTolerance"),min:0,max:255,step:1,"model-value":unref(o).maskTolerance,"onUpdate:modelValue":f},null,8,["label","model-value"])]))}}),_hoisted_1$17={class:"flex flex-col gap-3 pb-3"},_hoisted_2$S={class:"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5"},_sfc_main$1h=defineComponent({__name:"PaintBucketSettingsPanel",setup(i){const o=useMaskEditorStore(),n=p(a=>{o.setPaintBucketTolerance(a)},"onToleranceChange"),s=p(a=>{o.setFillOpacity(a)},"onFillOpacityChange");return(a,r)=>(openBlock(),createElementBlock("div",_hoisted_1$17,[createBaseVNode("h3",_hoisted_2$S,toDisplayString(unref(t)("maskEditor.paintBucketSettings")),1),createVNode(_sfc_main$1n,{label:unref(t)("maskEditor.tolerance"),min:0,max:255,step:1,"model-value":unref(o).paintBucketTolerance,"onUpdate:modelValue":n},null,8,["label","model-value"]),createVNode(_sfc_main$1n,{label:unref(t)("maskEditor.fillOpacity"),min:0,max:100,step:1,"model-value":unref(o).fillOpacity,"onUpdate:modelValue":s},null,8,["label","model-value"])]))}}),_hoisted_1$16={class:"maskEditor_sidePanel"},_hoisted_2$R={class:"maskEditor_sidePanelContainer"},_sfc_main$1g=defineComponent({__name:"SettingsPanelContainer",setup(i){const o=computed(()=>{const n=useMaskEditorStore().currentTool;return n===Tools.MaskBucket?_sfc_main$1h:n===Tools.MaskColorFill?_sfc_main$1i:_sfc_main$1l});return(n,s)=>(openBlock(),createElementBlock("div",_hoisted_1$16,[createBaseVNode("div",_hoisted_2$R,[(openBlock(),createBlock(resolveDynamicComponent(o.value)))])]))}}),_hoisted_1$15={class:"flex flex-col gap-3 pb-3 h-full !items-stretch bg-[var(--comfy-menu-bg)] overflow-y-auto w-55 px-2.5"},_hoisted_2$Q={class:"w-full min-h-full"},_sfc_main$1f=defineComponent({__name:"SidePanel",props:{toolManager:{}},setup(i){return(o,n)=>(openBlock(),createElementBlock("div",_hoisted_1$15,[createBaseVNode("div",_hoisted_2$Q,[createVNode(_sfc_main$1g),n[0]||(n[0]=createBaseVNode("div",{class:"w-full h-0.5 bg-[var(--border-color)] mt-6 mb-1.5"},null,-1)),createVNode(_sfc_main$1m,{"tool-manager":o.toolManager},null,8,["tool-manager"])])]))}}),iconsHtml={[Tools.MaskPen]:`
    <svg viewBox="0 0 44 44">
      <path class="cls-1" d="M10.97,15.98v14.04c0,.825.675,1.5,1.5,1.5h23.07c.825,0,1.5-.675,1.5-1.5V15.98c0-.825-.675-1.5-1.5-1.5H12.47c-.825,0-1.5.675-1.5,1.5ZM25.79,28.16c-4.365,1.41-8.355-2.58-6.945-6.945.51-1.575,1.785-2.85,3.36-3.36,4.365-1.41,8.355,2.58,6.945,6.945-.51,1.575-1.785,2.85-3.36,3.36Z"/>
    </svg>
  `,[Tools.Eraser]:`
    <svg viewBox="0 0 44 44">
      <g>
        <rect class="cls-2" x="16.68" y="10" width="10.63" height="24" rx="1.16" ry="1.16" transform="translate(22 -9.11) rotate(45)"/>
        <path class="cls-1" d="M17.27,34.27c-.42,0-.85-.16-1.17-.48l-5.88-5.88c-.31-.31-.48-.73-.48-1.17s.17-.86.48-1.17l15.34-15.34c.62-.62,1.72-.62,2.34,0l5.88,5.88c.65.65.65,1.7,0,2.34l-15.34,15.34c-.32.32-.75.48-1.17.48ZM26.73,10.73c-.18,0-.34.07-.46.19l-15.34,15.34c-.12.12-.19.29-.19.46s.07.34.19.46l5.88,5.88c.26.26.67.26.93,0l15.34-15.34c.26-.26.26-.67,0-.93l-5.88-5.88c-.12-.12-.29-.19-.46-.19Z"/>
      </g>
      <path class="cls-3" d="M20.33,11.03h8.32c.64,0,1.16.52,1.16,1.16v15.79h-10.63v-15.79c0-.64.52-1.16,1.16-1.16Z" transform="translate(20.97 -11.61) rotate(45)"/>
    </svg>
  `,[Tools.MaskBucket]:`
    <svg viewBox="0 0 44 44">
      <path class="cls-1" d="M33.4,21.76l-11.42,11.41-.04.05c-.61.61-1.6.61-2.21,0l-8.91-8.91c-.61-.61-.61-1.6,0-2.21l.04-.05.3-.29h22.24Z"/>
      <path class="cls-1" d="M20.83,34.17c-.55,0-1.07-.21-1.46-.6l-8.91-8.91c-.8-.8-.8-2.11,0-2.92l11.31-11.31c.8-.8,2.11-.8,2.92,0l8.91,8.91c.39.39.6.91.6,1.46s-.21,1.07-.6,1.46l-11.31,11.31c-.39.39-.91.6-1.46.6ZM23.24,10.83c-.27,0-.54.1-.75.31l-11.31,11.31c-.41.41-.41,1.09,0,1.5l8.91,8.91c.4.4,1.1.4,1.5,0l11.31-11.31c.2-.2.31-.47.31-.75s-.11-.55-.31-.75l-8.91-8.91c-.21-.21-.48-.31-.75-.31Z"/>
      <path class="cls-1" d="M34.28,26.85c0,.84-.68,1.52-1.52,1.52s-1.52-.68-1.52-1.52,1.52-2.86,1.52-2.86c0,0,1.52,2.02,1.52,2.86Z"/>
    </svg>
  `,[Tools.MaskColorFill]:`
    <svg viewBox="0 0 44 44">
      <path class="cls-1" d="M30.29,13.72c-1.09-1.1-2.85-1.09-3.94,0l-2.88,2.88-.75-.75c-.2-.19-.51-.19-.71,0-.19.2-.19.51,0,.71l1.4,1.4-9.59,9.59c-.35.36-.54.82-.54,1.32,0,.14,0,.28.05.41-.05.04-.1.08-.15.13-.39.39-.39,1.01,0,1.4.38.39,1.01.39,1.4,0,.04-.04.08-.09.11-.13.14.04.3.06.45.06.5,0,.97-.19,1.32-.55l9.59-9.59,1.38,1.38c.1.09.22.14.35.14s.26-.05.35-.14c.2-.2.2-.52,0-.71l-.71-.72,2.88-2.89c1.08-1.08,1.08-2.85-.01-3.94ZM19.43,25.82h-2.46l7.15-7.15,1.23,1.23-5.92,5.92Z"/>
    </svg>
  `,[Tools.PaintPen]:`
    <svg viewBox="0 0 44 44">
      <path class="cls-1" d="M34,13.93c0,.47-.19.94-.55,1.31l-13.02,13.04c-.09.07-.18.15-.27.22-.07-1.39-1.21-2.48-2.61-2.49.07-.12.16-.24.27-.34l13.04-13.04c.72-.72,1.89-.72,2.6,0,.35.35.55.83.55,1.3Z"/>
      <path class="cls-1" d="M19.64,29.03c0,4.46-6.46,3.18-9.64,0,3.3-.47,4.75-2.58,7.06-2.58,1.43,0,2.58,1.16,2.58,2.58Z"/>
    </svg>
  `};window.comfyAPI=window.comfyAPI||{};window.comfyAPI.constants=window.comfyAPI.constants||{};window.comfyAPI.constants.iconsHtml=iconsHtml;const _hoisted_1$14={class:"h-full z-[8888] flex flex-col justify-between bg-comfy-menu-bg"},_hoisted_2$P={class:"flex flex-col"},_hoisted_3$z=["onClick"],_hoisted_4$s=["innerHTML"],_hoisted_5$q=["title"],_hoisted_6$h={class:"text-sm text-text-secondary"},_hoisted_7$f={class:"text-xs text-text-secondary"},_sfc_main$1e=defineComponent({__name:"ToolPanel",props:{toolManager:{}},setup(i){const o=useMaskEditorStore(),n=p(u=>{i.toolManager.switchTool(u)},"onToolSelect"),s=computed(()=>o.currentTool),a=computed(()=>`${Math.round(o.displayZoomRatio*100)}%`),r=computed(()=>{const u=o.image;return u?`${u.width}x${u.height}`:" "}),l=p(()=>{o.resetZoom()},"onResetZoom");return(u,m)=>(openBlock(),createElementBlock("div",_hoisted_1$14,[createBaseVNode("div",_hoisted_2$P,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(allTools),f=>(openBlock(),createElementBlock("div",{key:f,class:normalizeClass(["maskEditor_toolPanelContainer hover:bg-secondary-background-hover",{maskEditor_toolPanelContainerSelected:s.value===f}]),onClick:p(_=>n(f),"onClick")},[createBaseVNode("div",{class:"flex items-center justify-center",innerHTML:unref(iconsHtml)[f]},null,8,_hoisted_4$s),m[0]||(m[0]=createBaseVNode("div",{class:"maskEditor_toolPanelIndicator"},null,-1))],10,_hoisted_3$z))),128))]),createBaseVNode("div",{class:"flex flex-col items-center cursor-pointer rounded-md mb-2 transition-colors duration-200 hover:bg-secondary-background-hover",title:unref(t)("maskEditor.clickToResetZoom"),onClick:l},[createBaseVNode("span",_hoisted_6$h,toDisplayString(a.value),1),createBaseVNode("span",_hoisted_7$f,toDisplayString(r.value),1)],8,_hoisted_5$q)]))}}),_hoisted_1$13={class:"maskEditor-ui-container flex min-h-0 flex-1 flex-col"},_hoisted_2$O={class:"flex min-h-0 flex-1 overflow-hidden"},_sfc_main$1d=defineComponent({__name:"MaskEditorContent",props:{node:{}},setup(i){const o=useMaskEditorStore(),n=useMaskEditorDataStore(),s=useDialogStore(),a=useMaskEditorLoader(),r=ref(),l=ref(),u=ref(),m=ref(),f=ref(),_=ref(),y=ref(),b=ref(),w=ref(),k=ref(!1),S=useKeyboard(),C=usePanAndZoom(),I=useToolManager(S,C);let T=null;const E=p(L=>{L.ctrlKey&&L.preventDefault()},"handleDragStart"),N=p(async()=>{if(!r.value){console.error("[MaskEditorContent] Cannot initialize - missing required refs");return}if(!u.value||!m.value||!f.value||!l.value||!y.value){console.error("[MaskEditorContent] Cannot initialize - missing canvas refs");return}o.maskCanvas=m.value,o.rgbCanvas=f.value,o.imgCanvas=u.value,o.canvasContainer=l.value,o.canvasBackground=y.value;try{await a.loadFromNode(i.node);const A=await useImageLoader().loadImages();await C.initializeCanvasPanZoom(A,r.value,b.value?.$el,w.value?.$el),o.canvasHistory.saveInitialState(),I.brushDrawing&&(await I.brushDrawing.initGPUResources(),_.value&&I.brushDrawing.initPreviewCanvas&&(_.value.width=m.value.width,_.value.height=m.value.height,I.brushDrawing.initPreviewCanvas(_.value))),k.value=!0}catch(L){console.error("[MaskEditorContent] Initialization failed:",L),s.closeDialog()}},"initUI");return onMounted(()=>{S.addListeners(),r.value&&(T=new ResizeObserver(async()=>{C&&await C.invalidatePanZoom()}),T.observe(r.value)),N()}),onBeforeUnmount(()=>{I.brushDrawing.saveBrushSettings(),S?.removeListeners(),T&&(T.disconnect(),T=null),o.canvasHistory.clearStates(),o.resetState(),n.reset()}),(L,A)=>(openBlock(),createElementBlock("div",{ref_key:"containerRef",ref:r,class:"maskEditor-dialog-root flex h-full w-full flex-col",onContextmenu:A[4]||(A[4]=withModifiers(()=>{},["prevent"])),onDragstart:E},[createBaseVNode("div",{id:"maskEditorCanvasContainer",ref_key:"canvasContainerRef",ref:l,onContextmenu:A[3]||(A[3]=withModifiers(()=>{},["prevent"]))},[createBaseVNode("canvas",{ref_key:"imgCanvasRef",ref:u,class:"absolute top-0 left-0 w-full h-full z-0",onContextmenu:A[0]||(A[0]=withModifiers(()=>{},["prevent"]))},null,544),createBaseVNode("canvas",{ref_key:"rgbCanvasRef",ref:f,class:"absolute top-0 left-0 w-full h-full z-10",onContextmenu:A[1]||(A[1]=withModifiers(()=>{},["prevent"]))},null,544),createBaseVNode("canvas",{ref_key:"maskCanvasRef",ref:m,class:"absolute top-0 left-0 w-full h-full z-30",onContextmenu:A[2]||(A[2]=withModifiers(()=>{},["prevent"]))},null,544),createBaseVNode("canvas",{ref_key:"gpuCanvasRef",ref:_,class:normalizeClass(["absolute top-0 left-0 w-full h-full pointer-events-none",{"z-20":unref(o).activeLayer==="rgb","z-40":unref(o).activeLayer==="mask"}])},null,2),createBaseVNode("div",{ref_key:"canvasBackgroundRef",ref:y,class:"bg-white w-full h-full"},null,512)],544),createBaseVNode("div",_hoisted_1$13,[createBaseVNode("div",_hoisted_2$O,[k.value?(openBlock(),createBlock(_sfc_main$1e,{key:0,ref_key:"toolPanelRef",ref:b,"tool-manager":unref(I)},null,8,["tool-manager"])):createCommentVNode("",!0),k.value?(openBlock(),createBlock(_sfc_main$1o,{key:1,"tool-manager":unref(I),"pan-zoom":unref(C)},null,8,["tool-manager","pan-zoom"])):createCommentVNode("",!0),k.value?(openBlock(),createBlock(_sfc_main$1f,{key:2,ref_key:"sidePanelRef",ref:w,"tool-manager":unref(I)},null,8,["tool-manager"])):createCommentVNode("",!0)])]),k.value?(openBlock(),createBlock(_sfc_main$1p,{key:0,"container-ref":r.value},null,8,["container-ref"])):createCommentVNode("",!0)],544))}}),MaskEditorContent=_export_sfc(_sfc_main$1d,[["__scopeId","data-v-6c02c403"]]);function useMaskEditor(){return{openMaskEditor:p(o=>{if(!o){console.error("[MaskEditor] No node provided");return}if(!o.imgs?.length&&o.previewMediaType!=="image"){console.error("[MaskEditor] Node has no images");return}useDialogStore().showDialog({key:"global-mask-editor",headerComponent:_sfc_main$1q,component:MaskEditorContent,props:{node:o},dialogComponentProps:{style:"width: 90vw; height: 90vh;",modal:!0,maximizable:!0,closable:!0,pt:{root:{class:"mask-editor-dialog flex flex-col"},content:{class:"flex flex-col min-h-0 flex-1 !p-0"},header:{class:"!p-2"}}}})},"openMaskEditor")}}p(useMaskEditor,"useMaskEditor");const CONFIG=Symbol(),GET_CONFIG=Symbol(),useLitegraphService=p(()=>{const i=useExtensionService(),o=useToastStore(),n=useWidgetStore(),s=useCanvasStore(),{toggleSelectedNodesMode:a}=useSelectedLiteGraphItems();function r(M){return`nodeDefs.${normalizeI18nKey(M.constructor.nodeData.name)}`}p(r,"nodeKey");function l(M,P){const R=P.name,V=`${r(M)}.inputs.${normalizeI18nKey(R)}.name`;if(n.widgets.get(P.widgetType??P.type)&&!P.forceInput)return;const F=M.addInput(R,P.type,{shape:P.isOptional?RenderShape.HollowCircle:void 0,localized_name:st(V,R)});F.label??=P.display_name}p(l,"addInputSocket");function u(M){M.strokeStyles.running=function(){const P=String(this.id),R=useWorkflowStore().nodeIdToNodeLocatorId(P);if(useExecutionStore().nodeLocationProgressStates[R]?.state==="running")return{color:"#0f0"}},M.strokeStyles.nodeError=function(){if(app$1.lastNodeErrors?.[this.id]?.errors)return{color:"red"}},M.strokeStyles.dragOver=function(){if(app$1.dragOverNode?.id==this.id)return{color:"dodgerblue"}},M.strokeStyles.executionError=function(){if(app$1.lastExecutionError?.node_id==this.id)return{color:"#f0f",lineWidth:2}}}p(u,"setupStrokeStyles");function m(M,P){l(M,P),f(M,P)}p(m,"addNodeInput");function f(M,P){const R={...P};P.widgetType&&(R.type=P.widgetType);const V=P.name,$=`${r(M)}.inputs.${normalizeI18nKey(V)}.name`,F=n.widgets.get(R.type);if(!F||P.forceInput)return;const{widget:j,minWidth:U=1,minHeight:G=1}=F(M,V,transformInputSpecV2ToV1(R),app$1)??{};if(j&&(j.label=st($,j.label??R.display_name??V),j.options??={},Object.assign(j.options,{advanced:P.advanced,hidden:P.hidden})),!j?.options?.socketless){const W=transformInputSpecV2ToV1(R);M.addInput(V,P.type,{shape:P.isOptional?RenderShape.HollowCircle:void 0,localized_name:st($,V),widget:{name:V,[GET_CONFIG]:()=>W}})}const H=M;H._initialMinSize.width=Math.max(H._initialMinSize.width,U),H._initialMinSize.height=Math.max(H._initialMinSize.height,G)}p(f,"addInputWidget");function _(M,P){const R=M.constructor.nodeData,V=getOrderedInputSpecs(R,P);for(const $ of V)l(M,$);for(const $ of V)f(M,$)}p(_,"addInputs");function y(M,P){for(const R of P){const{name:V,is_list:$}=R,F=R.type==="COMFY_MATCHTYPE_V3"?"*":R.type,j=$?{shape:LiteGraph.GRID_SHAPE}:{},U=`${r(M)}.outputs.${R.index}.name`,G=`dataTypes.${normalizeI18nKey(F)}`,H={...j,localized_name:st(F!==V?U:G,V)};M.addOutput(V,F,H)}}p(y,"addOutputs");function b(M){const P=M.computeSize(),R=M.widgets?.length&&!useSettingStore().get("LiteGraph.Node.DefaultPadding"),V=M;P[0]=Math.max(V._initialMinSize.width,P[0]+(R?60:0)),P[1]=Math.max(V._initialMinSize.height,P[1]),M.setSize(P)}p(b,"setInitialSize");function w(M,P,R){const V=class Re extends SubgraphNode{static{p(this,"ComfyNode")}static comfyClass;static title;static category;static nodeData;_initialMinSize={width:1,height:1};constructor(){super(app$1.graph,P,R),P.events.addEventListener("widget-promoted",j=>{const{widget:U}=j.detail;if(!isDOMWidget(U)&&!isComponentWidget(U))return;const G=useDomWidgetStore();if(!G.widgetStates.has(U.id)){G.registerWidget(U);const H=G.widgetStates.get(U.id);if(H){const W=s.getCanvas().graph;H.visible=W?.nodes.includes(U.node)??!1}}}),P.events.addEventListener("widget-demoted",j=>{const{widget:U}=j.detail;if(!isDOMWidget(U)&&!isComponentWidget(U))return;const G=useDomWidgetStore();G.widgetStates.has(U.id)&&G.unregisterWidget(U.id)}),u(this),_(this,Re.nodeData.inputs),y(this,Re.nodeData.outputs),b(this),this.serialize_widgets=!0,i.invokeExtensionsAsync("nodeCreated",this)}configure(j){const U=["name","type","shape","localized_name"],G=new Map(j.inputs?.map(Q=>[Q.name,Q])??[]),H=new Set(this.inputs.map(Q=>Q.name)),W=this.inputs.map(Q=>{const q=G.get(Q.name);return q?{...q,...toolkit.pick(Q,U.concat("widget"))}:Q}),X=j.inputs?.filter(Q=>!H.has(Q.name));j.inputs=[...W,...X??[]],j.outputs=toolkit.zip(this.outputs,j.outputs).map(([Q,q])=>Q?q?{...q,...toolkit.pick(Q,U)}:Q:q),j.widgets_values=migrateWidgetsValues(Re.nodeData.inputs,this.widgets??[],j.widgets_values??[]),super.configure(j)}};S(V),T(V),E(V),V.prototype.comfyClass=M.name,V.comfyClass=M.name;const $=new ComfyNodeDefImpl(M);V.nodeData=$,LiteGraph.registerNodeType(P.id,V),V.category=$.category,V.skip_list=!0,V.title=$.display_name||$.name}p(w,"registerSubgraphNodeDef");async function k(M,P){const R=class Pe extends LGraphNode{static{p(this,"ComfyNode")}static comfyClass;static title;static category;static nodeData;_initialMinSize={width:1,height:1};constructor(F){super(F),u(this),_(this,Pe.nodeData.inputs),y(this,Pe.nodeData.outputs),b(this),this.serialize_widgets=!0,Pe.nodeData.api_node&&(this.color=LGraphCanvas.node_colors.yellow.color,this.bgcolor=LGraphCanvas.node_colors.yellow.bgcolor),i.invokeExtensionsAsync("nodeCreated",this)}configure(F){const j=["name","type","shape","localized_name"],U=new Map(F.inputs?.map(X=>[X.name,X])??[]),G=new Set(this.inputs.map(X=>X.name)),H=this.inputs.map(X=>{const Q=U.get(X.name);return Q?{...Q,...toolkit.pick(X,j.concat("widget"))}:X}),W=F.inputs?.filter(X=>!G.has(X.name));F.inputs=[...H,...W??[]],F.outputs=toolkit.zip(this.outputs,F.outputs).map(([X,Q])=>X?Q?{...Q,...toolkit.pick(X,j)}:X:Q),F.widgets_values=migrateWidgetsValues(Pe.nodeData.inputs,this.widgets??[],F.widgets_values??[]),super.configure(F)}};S(R),T(R),E(R),R.prototype.comfyClass=P.name,R.comfyClass=P.name,await i.invokeExtensionsAsync("beforeRegisterNodeDef",R,P);const V=new ComfyNodeDefImpl(P);R.nodeData=V,LiteGraph.registerNodeType(M,R),R.category=V.category,R.title=V.display_name||V.name}p(k,"registerNodeDef");function S(M){function P(R){return typeof window.ClipboardItem>"u"?[]:[{content:"Copy Image",callback:p(async()=>{const V=new URL(R.src);V.searchParams.delete("preview");const $=p(async F=>{await navigator.clipboard.write([new ClipboardItem({[F.type]:F})])},"writeImage");try{const j=await(await fetch(V)).blob();try{await $(j)}catch(U){if(j.type!=="image/png"){const G=$el("canvas",{width:R.naturalWidth,height:R.naturalHeight}),H=G.getContext("2d");let W;if(typeof window.createImageBitmap>"u"){W=new Image;const X=new Promise((Q,q)=>{W.onload=Q,W.onerror=q}).finally(()=>{URL.revokeObjectURL(W.src)});W.src=URL.createObjectURL(j),await X}else W=await createImageBitmap(j);try{H.drawImage(W,0,0),G.toBlob($,"image/png")}finally{typeof W.close=="function"&&W.close()}return}throw U}}catch(F){o.addAlert(t("toastMessages.errorCopyImage",{error:F.message??F}))}},"callback")}]}p(P,"getCopyImageOption"),M.prototype.getExtraMenuOptions=function(R,V){if(this.imgs){let U;this.imageIndex!=null?U=this.imgs[this.imageIndex]:this.overIndex!=null&&(U=this.imgs[this.overIndex]),U&&V.unshift({content:"Open Image",callback:p(()=>{const G=new URL(U.src);G.searchParams.delete("preview"),window.open(G,"_blank")},"callback")},...P(U),{content:"Save Image",callback:p(()=>{const G=new URL(U.src);G.searchParams.delete("preview");const H=new URLSearchParams(G.search).get("filename");downloadFile(G.toString(),H??void 0)},"callback")})}V.push({content:"Bypass",callback:p(()=>{a(LGraphEventMode.BYPASS),R.setDirty(!0,!0)},"callback")}),ComfyApp.clipspace_return_node||(V.push({content:"Copy (Clipspace)",callback:p(()=>{ComfyApp.copyToClipspace(this)},"callback")}),ComfyApp.clipspace!=null&&V.push({content:"Paste (Clipspace)",callback:p(()=>{ComfyApp.pasteFromClipspace(this)},"callback")}),isImageNode(this)&&V.push({content:"Open in MaskEditor | Image Canvas",callback:p(()=>{useMaskEditor().openMaskEditor(this)},"callback")})),this instanceof SubgraphNode&&V.unshift({content:"Edit Subgraph Widgets",callback:p(()=>{showSubgraphNodeDialog()},"callback")},{content:"Unpack Subgraph",callback:p(()=>{useNodeOutputStore().revokeSubgraphPreviews(this),this.graph.unpackSubgraph(this)},"callback")});const[$,F]=R.graph_mouse,j=this.getWidgetOnPos($,F,!0);if(j){const U=this.inputs.find(G=>G.widget?.name===j.name);U&&V.unshift({content:`${t("contextMenu.RenameWidget")}: ${j.label??j.name}`,callback:p(async()=>{const G=await useDialogService().prompt({title:t("g.rename"),message:t("g.enterNewName")+":",defaultValue:j.label,placeholder:j.name});G!==null&&(j.label=G||void 0,U.label=G||void 0,useCanvasStore().canvas?.setDirty(!0))},"callback")}),this.graph&&!this.graph.isRootGraph&&addWidgetPromotionOptions(V,j,this)}return[]}}p(S,"addNodeContextMenuHandler");function C(M,P){try{I.call(M,P)}catch(R){console.error("Error drawing node background",R)}}p(C,"updatePreviews");function I(M){if(this.flags.collapsed)return;const P=useNodeOutputStore(),{showAnimatedPreview:R,removeAnimatedPreview:V}=useNodeAnimatedImage(),{showCanvasImagePreview:$,removeCanvasImagePreview:F}=useNodeCanvasImagePreview(),j=P.getNodeOutputs(this),U=P.getNodePreviews(this),G=j&&this.images!==j.images,H=U&&this.preview!==U;if(H&&(this.preview=U),G&&(this.images=j.images),G||H){this.animatedImages=j?.animated?.find(Boolean);const W=this.animatedImages&&j?.images?.some(q=>q.filename?.includes("webp")),X=this.animatedImages&&j?.images?.some(q=>q.filename?.includes("png"));this.animatedImages&&!W&&!X||isVideoNode(this)?useNodeVideo(this,M).showPreview():useNodeImage(this,M).showPreview()}this.imgs?.length&&(this.animatedImages?(F(this),R(this)):(V(this),$(this)))}p(I,"unsafeUpdatePreviews");function T(M){M.prototype.setSizeForImage=function(){console.warn("node.setSizeForImage is deprecated. Now it has no effect. Please remove the call to it.")},M.prototype.onDrawBackground=function(){C(this)}}p(T,"addDrawBackgroundHandler");function E(M){const P=M.prototype.onKeyDown;M.prototype.onKeyDown=function(R){if(P&&P.apply(this,R)===!1)return!1;if(this.flags.collapsed||!this.imgs||this.imageIndex===null)return;let V=!1;if(R.key==="ArrowLeft"||R.key==="ArrowRight"?(R.key==="ArrowLeft"?this.imageIndex-=1:R.key==="ArrowRight"&&(this.imageIndex+=1),this.imageIndex%=this.imgs.length,this.imageIndex<0&&(this.imageIndex=this.imgs.length+this.imageIndex),V=!0):R.key==="Escape"&&(this.imageIndex=null,V=!0),V===!0)return R.preventDefault(),R.stopImmediatePropagation(),!1}}p(E,"addNodeKeyHandler");function N(M,P={}){if(P.pos??=L(),M.name.startsWith(useSubgraphStore().typePrefix)){const $=s.getCanvas(),F=useSubgraphStore().getBlueprint(M.name),j={nodes:F.nodes,subgraphs:F.definitions?.subgraphs},U=$._deserializeItems(j,{position:P.pos});if(!U)throw new Error("Failed to add subgraph blueprint");const G=U.nodes.values().next().value;if(!G)throw new Error("Subgraph blueprint was added, but failed to resolve a subgraph Node");return G}const R=LiteGraph.createNode(M.name,M.display_name,P);return(useWorkflowStore().activeSubgraph??app$1.graph).add(R),R}p(N,"addNodeOnGraph");function L(){const M=Math.max(window.devicePixelRatio??1,1),[P,R,V,$]=app$1.canvas.ds.visible_area;return[P+V/M/2,R+$/M/2]}p(L,"getCanvasCenter");function A(M){const P=app$1.graph.getNodeById(M);P&&app$1.canvas.animateToBounds(P.boundingRect)}p(A,"goToNode");function D(){const M=s.canvas;M&&(M.ds.scale=1,M.ds.offset=[0,0],M.setDirty(!0,!0))}p(D,"resetView");function O(){const M=s.canvas;if(!M)return;const P=createBounds(app$1.graph.nodes);P&&(M.ds.fitToBounds(P),M.setDirty(!0,!0))}return p(O,"fitView"),{registerNodeDef:k,registerSubgraphNodeDef:w,addNodeOnGraph:N,addNodeInput:m,getCanvasCenter:L,goToNode:A,resetView:D,fitView:O,updatePreviews:C}},"useLitegraphService"),useSubgraphNavigationStore=defineStore("subgraphNavigation",()=>{const i=useWorkflowStore(),o=useCanvasStore(),n=shallowRef(),s=ref([]),a=new QuickLRU({maxSize:32}),r=p(()=>{const w=o.getCanvas();return w?w.graph?.rootGraph?.id??"root":"root"},"getCurrentRootGraphId"),l=computed(()=>s.value.map(w=>app$1.graph.subgraphs.get(w)).filter(isNonNullish)),u=p(w=>{s.value.length=0;for(const k of w)s.value.push(k)},"restoreState"),m=p(()=>[...s.value],"exportState"),f=p(()=>{const w=o.getCanvas();return w?{scale:w.ds.state.scale,offset:[...w.ds.state.offset]}:null},"getCurrentViewport"),_=p(w=>{const k=f();k&&a.set(w,k)},"saveViewport"),y=p(w=>{const k=a.get(w);if(!k)return;const S=app$1.canvas;S&&(S.ds.scale=k.scale,S.ds.offset[0]=k.offset[0],S.ds.offset[1]=k.offset[1],S.setDirty(!0,!0))},"restoreViewport"),b=p((w,k)=>{if(k?_(k.id):!k&&w&&_(r()),!w){s.value.length=0,y(r());return}const C=findSubgraphPathById(w.rootGraph,w.id);!!C?s.value=[...C]:s.value=[w.id],y(w.id)},"onNavigated");return watch(()=>i.activeSubgraph,(w,k)=>{b(w,k)}),{activeSubgraph:n,navigationStack:l,restoreState:u,exportState:m,saveViewport:_,restoreViewport:y,viewportCache:a}});function getProxyWidgets(i){return parseProxyWidgets(i.properties.proxyWidgets)}p(getProxyWidgets,"getProxyWidgets");function promoteWidget(i,o,n){for(const s of n){const a=[...getProxyWidgets(s),widgetItemToProperty([i,o])];s.properties.proxyWidgets=a}o.promoted=!0}p(promoteWidget,"promoteWidget");function demoteWidget(i,o,n){for(const s of n){const a=getProxyWidgets(s).filter(r=>!matchesPropertyItem([i,o])(r));s.properties.proxyWidgets=a}o.promoted=!1}p(demoteWidget,"demoteWidget");function matchesWidgetItem([i,o]){return([n,s])=>n.id==i&&s.name===o}p(matchesWidgetItem,"matchesWidgetItem");function matchesPropertyItem([i,o]){return([n,s])=>i.id==n&&o.name===s}p(matchesPropertyItem,"matchesPropertyItem");function widgetItemToProperty([i,o]){return[`${i.id}`,o.name]}p(widgetItemToProperty,"widgetItemToProperty");function getParentNodes(){const{navigationStack:i}=useSubgraphNavigationStore(),o=i.at(-1);return o?(i.at(-2)??o.rootGraph).nodes.filter(s=>s.type===o.id&&s.isSubgraphNode()):(useToastStore().add({severity:"error",summary:t("g.error"),detail:t("subgraphStore.promoteOutsideSubgraph"),life:2e3}),[])}p(getParentNodes,"getParentNodes");function addWidgetPromotionOptions(i,o,n){const s=getParentNodes(),a=s.filter(r=>!getProxyWidgets(r).some(matchesPropertyItem([n,o])));a.length>0?i.unshift({content:`Promote Widget: ${o.label??o.name}`,callback:p(()=>{promoteWidget(n,o,a)},"callback")}):i.unshift({content:`Un-Promote Widget: ${o.label??o.name}`,callback:p(()=>{demoteWidget(n,o,s)},"callback")})}p(addWidgetPromotionOptions,"addWidgetPromotionOptions");function tryToggleWidgetPromotion(){const i=useCanvasStore().getCanvas(),[o,n]=i.graph_mouse,s=i.graph?.getNodeOnPos(o,n,i.visible_nodes);if(!s)return;const a=s.getWidgetOnPos(o,n,!0),r=getParentNodes();if(!r.length||!a)return;const l=r.filter(u=>!getProxyWidgets(u).some(matchesPropertyItem([s,a])));l.length>0?promoteWidget(s,a,l):demoteWidget(s,a,r)}p(tryToggleWidgetPromotion,"tryToggleWidgetPromotion");const recommendedNodes=["CLIPTextEncode","LoadImage","SaveImage","PreviewImage"],recommendedWidgetNames=["seed"];function isRecommendedWidget([i,o]){return!o.computedDisabled&&(recommendedNodes.includes(i.type)||recommendedWidgetNames.includes(o.name))}p(isRecommendedWidget,"isRecommendedWidget");function nodeWidgets(i){return i.widgets?.map(o=>[i,o])??[]}p(nodeWidgets,"nodeWidgets");function promoteRecommendedWidgets(i){const{updatePreviews:o}=useLitegraphService(),n=i.subgraph.nodes;for(const r of n){let l=p(function(){o(r);const u=r.widgets?.find(f=>f.name.startsWith("$$"));!u||getProxyWidgets(i).some(matchesPropertyItem([r,u]))||promoteWidget(r,u,[i])},"checkWidgets");r.updateComputedDisabled(),requestAnimationFrame(()=>o(r,l))}const a=n.flatMap(nodeWidgets).filter(isRecommendedWidget).map(widgetItemToProperty);i.properties.proxyWidgets=a,i.computeSize(i.size)}p(promoteRecommendedWidgets,"promoteRecommendedWidgets");function pruneDisconnected(i){i.properties.proxyWidgets=i.widgets.filter(isProxyWidget).filter(o=>!isDisconnectedWidget(o)).map(o=>[o._overlay.nodeId,o._overlay.widgetName])}p(pruneDisconnected,"pruneDisconnected");class DisconnectedWidget extends BaseWidget{static{p(this,"DisconnectedWidget")}constructor(o){super(o,new LGraphNode("DisconnectedPlaceholder")),this.disabled=!0}drawWidget(o,{width:n,showText:s=!0}){o.save(),this.drawWidgetShape(o,{width:n,showText:s}),s&&this.drawTruncatingText({ctx:o,width:n,leftPadding:0,rightPadding:0}),o.restore()}onClick(){}get _displayValue(){return"Disconnected"}}const conf={type:"button",value:void 0,name:"Disconnected",options:{},y:0,clicked:!1},disconnectedWidget=new DisconnectedWidget(conf);function isProxyWidget(i){return i?._overlay?.isProxyWidget??!1}p(isProxyWidget,"isProxyWidget");function isDisconnectedWidget(i){return i instanceof disconnectedWidget.constructor}p(isDisconnectedWidget,"isDisconnectedWidget");function registerProxyWidgets(i){i.canvas.addEventListener("subgraph-opened",o=>{const{subgraph:n,fromNode:s}=o.detail,a=parseProxyWidgets(s.properties.proxyWidgets);for(const r of n.nodes)for(const l of r.widgets??[])l.promoted=a.some(([u,m])=>r.id==u&&l.name==m)}),i.canvas.addEventListener("subgraph-converted",o=>promoteRecommendedWidgets(o.detail.subgraphNode)),SubgraphNode.prototype.onConfigure=onConfigure}p(registerProxyWidgets,"registerProxyWidgets");const originalOnConfigure=SubgraphNode.prototype.onConfigure,onConfigure=p(function(i){if(!this.isSubgraphNode())throw new Error("Can't add proxyWidgets to non-subgraphNode");const o=useCanvasStore();if(this.properties.proxyWidgets??=[],originalOnConfigure?.call(this,i),Object.defineProperty(this.properties,"proxyWidgets",{get:p(()=>this.widgets.map(n=>isProxyWidget(n)?[n._overlay.nodeId,n._overlay.widgetName]:["-1",n.name]),"get"),set:p(n=>{const s=parseProxyWidgets(n),{deactivateWidget:a,setWidget:r}=useDomWidgetStore(),l=useCanvasStore().canvas?.graph===this.graph;if(l)for(const m of this.widgets.filter(f=>isProxyWidget(f)))m instanceof DOMWidgetImpl&&a(m.id);const u=s.flatMap(([m,f])=>{if(m==="-1"){const y=this.widgets.find(b=>b.name===f);return y?[y]:[]}const _=newProxyWidget(this,m,f);return l&&_ instanceof DOMWidgetImpl&&r(_),[_]});this.widgets=this.widgets.filter(m=>!isProxyWidget(m)&&!s.some(([,f])=>m.name===f)),this.widgets.push(...u),o.canvas?.setDirty(!0,!0),this._setConcreteSlots(),this.arrange()},"set")}),i.properties?.proxyWidgets){this.properties.proxyWidgets=i.properties.proxyWidgets;const n=parseProxyWidgets(i.properties.proxyWidgets);i.widgets_values?.forEach((s,a)=>{if(n[a]?.[0]!=="-1")return;const r=this.widgets.find(l=>l.name==n[a][1]);s!==null&&r&&(r.value=s)})}},"onConfigure");function newProxyWidget(i,o,n){const s=`${o}: ${n}`,a={nodeId:o,graph:i.subgraph,widgetName:n,afterQueued:void 0,computedHeight:void 0,isProxyWidget:!0,last_y:void 0,name:s,node:i,onRemove:void 0,promoted:void 0,serialize:!1,width:void 0,y:0};return newProxyFromOverlay(i,a)}p(newProxyWidget,"newProxyWidget");function resolveLinkedWidget(i){const{graph:o,nodeId:n,widgetName:s}=i,a=getNodeByExecutionId(o,n);if(!a)return[void 0,void 0];const r=a.widgets?.find(l=>l.name===s);return r&&isProxyWidget(r)&&isDisconnectedWidget(r)&&(r.computedHeight=20),[a,r]}p(resolveLinkedWidget,"resolveLinkedWidget");function newProxyFromOverlay(i,o){const{updatePreviews:n}=useLitegraphService();let[s,a]=resolveLinkedWidget(o),r=a??disconnectedWidget;o.widgetName.startsWith("$$")&&(o.node=new Proxy(i,{get(m,f){return f!=="imgs"?Reflect.get(i,f):s?s.imgs:[]}}));const l={get(m,f,_){let y=r,b=_;return f=="_overlay"?o:(f=="value"&&(b=r),Object.prototype.hasOwnProperty.call(o,f)&&(y=o,b=o),Reflect.get(y,f,b))},set(m,f,_,y){let b=r,w=y;return f=="value"?w=r:f=="computedHeight"&&(o.widgetName.startsWith("$$")&&s&&n(s),s&&a?.computedDisabled&&demoteWidget(s,a,[i]),[s,a]=resolveLinkedWidget(o),r=a??disconnectedWidget),Object.prototype.hasOwnProperty.call(o,f)&&(b=o,w=o),Reflect.set(b,f,_,w)},getPrototypeOf(){return Reflect.getPrototypeOf(r)},ownKeys(){return Reflect.ownKeys(r)},has(m,f){let _=r;return Object.prototype.hasOwnProperty.call(o,f)&&(_=o),Reflect.has(_,f)}};return new Proxy(disconnectedWidget,l)}p(newProxyFromOverlay,"newProxyFromOverlay");function getNodeById(i,o){return i.getNodeById?i.getNodeById(o):(i=i,i.nodes.find(n=>n.id==o))}p(getNodeById,"getNodeById");function extendLink(i){return{link:i,id:i[0],origin_id:i[1],origin_slot:i[2],target_id:i[3],target_slot:i[4],type:i[5]}}p(extendLink,"extendLink");function fixBadLinks(i,o={}){const{fix:n=!1,silent:s=!1,logger:a=console}=o,r={log:p((...k)=>{s||a.log(...k)},"log")},l={},u={patchedNodes:[],deletedLinks:[]};function m(k,S,C,I,T){l[k.id]=l[k.id]||{};const E=l[k.id];if(S==0){if(E.inputs=E.inputs||{},E.inputs[C]!==void 0)return r.log(` > Already set ${k.id}.inputs[${C}] to ${E.inputs[C]} Skipping.`),!1;const N=T==="REMOVE"?null:I;E.inputs[C]=N}else{if(E.outputs=E.outputs||{},E.outputs[C]=E.outputs[C]||{links:[...k.outputs?.[C]?.links||[]],changes:{}},E.outputs[C].changes[I]!==void 0)return r.log(` > Already set ${k.id}.outputs[${C}] to ${E.inputs[C]}! Skipping.`),!1;if(E.outputs[C].changes[I]=T,T==="ADD"){if(E.outputs[C].links.indexOf(I)!==-1)return r.log(` > Hmmm.. asked to add ${I} but it is already in list...`),!1;E.outputs[C].links.push(I),n&&(k.outputs=k.outputs||[],k.outputs[C]=k.outputs[C]||{},k.outputs[C].links=k.outputs[C].links||[],k.outputs[C].links.push(I))}else{const N=E.outputs[C].links.indexOf(I);if(N===-1)return r.log(` > Hmmm.. asked to remove ${I} but it doesn't exist...`),!1;E.outputs[C].links.splice(N,1),n&&k.outputs?.[C].links.splice(N,1)}}return u.patchedNodes.push(k),!0}p(m,"patchNodeSlot");function f(k,S,C,I){let T=!1;if(S===0){const E=k.inputs?.[C]?.link===I;if(l[k.id]?.inputs){const N=l[k.id].inputs[C]===I;if(n&&E!==N)throw Error("Error. Expected node to match patched data.");T=N}else T=!!E}else{const E=k.outputs?.[C]?.links?.includes(I);if(l[k.id]?.outputs?.[C]?.changes[I]){const N=l[k.id].outputs[C]?.links.includes(I);if(n&&E!==N)throw Error("Error. Expected node to match patched data.");T=!!N}else T=!!E}return T}p(f,"nodeHasLinkId");function _(k,S,C){let I=!1;{const T=k.inputs?.[C]?.link!=null;if(l[k.id]?.inputs){const E=l[k.id].inputs[C]!=null;if(n&&T!==E)throw Error("Error. Expected node to match patched data.");I=E}else I=!!T}return I}p(_,"nodeHasAnyLink");let y=[];Array.isArray(i.links)?y=i.links:y=Object.values(i.links).reduce((k,S)=>(k[S.id]=S,k),y);const b=[...y];b.reverse();for(const k of b){if(!k)continue;const S=k.origin_slot!=null?k:extendLink(k),C=getNodeById(i,S.origin_id),I=p(()=>f(C,1,S.origin_slot,S.id),"originHasLink"),T=p((M,P=S.id)=>m(C,1,S.origin_slot,P,M),"patchOrigin"),E=getNodeById(i,S.target_id),N=p(()=>f(E,0,S.target_slot,S.id),"targetHasLink"),L=p(()=>_(E,0,S.target_slot),"targetHasAnyLink"),A=p((M,P=S.id)=>m(E,0,S.target_slot,P,M),"patchTarget"),D=`origin(${S.origin_id}).outputs[${S.origin_slot}].links`,O=`target(${S.target_id}).inputs[${S.target_slot}].link`;if(!C||!E){!C&&!E?r.log(`Link ${S.id} is invalid, both origin ${S.origin_id} and target ${S.target_id} do not exist`):C?E||(r.log(`Link ${S.id} is funky... target ${S.target_id} does not exist, but origin ${S.origin_id} does.`),I()&&(r.log(` > [PATCH] Origin's links' has ${S.id}; will remove the link first.`),T("REMOVE"))):(r.log(`Link ${S.id} is funky... origin ${S.origin_id} does not exist, but target ${S.target_id} does.`),N()&&(r.log(` > [PATCH] ${O} does have link, will remove the inputs' link first.`),A("REMOVE",-1)));continue}if(N()||I()){if(!I())r.log(`${S.id} is funky... ${D} does NOT contain it, but ${O} does.`),r.log(` > [PATCH] Attempt a fix by adding this ${S.id} to ${D}.`),T("ADD");else if(!N())if(r.log(`${S.id} is funky... ${O} is NOT correct (is ${E.inputs?.[S.target_slot]?.link}), but ${D} contains it`),L())r.log(` > [PATCH] ${O} is defined, removing ${S.id} from ${D}.`),T("REMOVE");else{r.log(` > [PATCH] ${O} is not defined, will set to ${S.id}.`);let M=A("ADD");M||(r.log(` > [PATCH] Nvm, ${O} already patched. Removing ${S.id} from ${D}.`),M=T("REMOVE"))}}}for(const k of b){if(!k)continue;const S=k.origin_slot!=null?k:extendLink(k),C=getNodeById(i,S.origin_id),I=getNodeById(i,S.target_id);if((!C||!f(C,1,S.origin_slot,S.id))&&(!I||!f(I,0,S.target_slot,S.id))){r.log(`${S.id} is def invalid; BOTH origin node ${S.origin_id} ${C?`doesn't have ${S.id}`:"is removed"} and ${S.origin_id} target node ${I?`doesn't have ${S.id}`:"is removed"}.`),u.deletedLinks.push(S.id);continue}}if(n){for(let k=u.deletedLinks.length-1;k>=0;k--)if(r.log(`Deleting link #${u.deletedLinks[k]}.`),i.getNodeById)delete i.links[u.deletedLinks[k]];else{i=i;const S=i.links.findIndex(C=>C&&(C[0]===u.deletedLinks[k]||C.id===u.deletedLinks[k]));S===-1&&r.log(`INDEX NOT FOUND for #${u.deletedLinks[k]}`),r.log(`splicing ${S} from links`),i.links.splice(S,1)}i.getNodeById||(i.links=i.links.filter(k=>!!k))}if(!u.patchedNodes.length&&!u.deletedLinks.length)return{hasBadLinks:!1,fixed:!1,graph:i,patched:u.patchedNodes.length,deleted:u.deletedLinks.length};r.log(`${n?"Made":"Would make"} ${u.patchedNodes.length||"no"} node link patches, and ${u.deletedLinks.length||"no"} stale link removals.`);let w=!!(u.patchedNodes.length||u.deletedLinks.length);return n&&!s&&(w=fixBadLinks(i,{fix:!1,silent:!0}).hasBadLinks),{hasBadLinks:w,fixed:!!w&&n,graph:i,patched:u.patchedNodes.length,deleted:u.deletedLinks.length}}p(fixBadLinks,"fixBadLinks");function useWorkflowValidation(){const i=useToastStore();function o(s,a={}){const{silent:r=!1}=a,l=[],u=fixBadLinks(s,{fix:!0,silent:r,logger:{log:p(m=>{l.push(m)},"log")}});return!r&&l.length>0&&i.add({severity:"warn",summary:"Workflow Validation",detail:l.join(`
`)}),u.fixed&&(r||i.add({severity:"success",summary:"Workflow Links Fixed",detail:`Fixed ${u.patched} node connections and removed ${u.deleted} invalid links.`})),u.graph}p(o,"tryFixLinks");async function n(s,a={}){const{silent:r=!1}=a;let l=null;const u=await validateComfyWorkflow(s,m=>{r||i.addAlert(m)});if(u)try{l=o(u,{silent:r})}catch(m){console.error(m)}return{graphData:l}}return p(n,"validateWorkflow"),{validateWorkflow:n}}p(useWorkflowValidation,"useWorkflowValidation");const useSubgraphService=p(()=>{const i=useNodeDefStore();function o(r,l,u){const m={id:-1,type:u.id,pos:[0,0],size:[100,100],inputs:[],outputs:[],flags:{},order:0,mode:0};useLitegraphService().registerSubgraphNodeDef(r,l,m)}p(o,"registerLitegraphNode");function n(r){const{id:l,name:u}=r,m={input:{required:{}},output:[],output_is_list:[],output_name:[],output_tooltips:[],name:l,display_name:u,description:`Subgraph node for ${u}`,category:"subgraph",output_node:!1,python_module:"nodes"};return i.addNodeDef(m),m}p(n,"createNodeDef");function s(r){const l=r.definitions?.subgraphs;if(l)for(const u of l){const m=app$1.graph.subgraphs.get(u.id)??app$1.graph.createSubgraph(u);a(m,u)}}p(s,"loadSubgraphs");function a(r,l){const u=n(l);o(u,r,l)}return p(a,"registerNewSubgraph"),{loadSubgraphs:s,registerNewSubgraph:a}},"useSubgraphService"),GROUP=Symbol();function isGroupNode(i){return i.constructor?.nodeData?.[GROUP]!==void 0}p(isGroupNode,"isGroupNode");class ExecutableGroupNodeDTO extends ExecutableNodeDTO{static{p(this,"ExecutableGroupNodeDTO")}get isVirtualNode(){return!0}getInnerNodes(){return this.node.getInnerNodes?.(this.nodesByExecutionId)??[]}resolveOutput(o,n,s){if(this.mode===LGraphEventMode.BYPASS){const{inputs:m}=this,f=Object.keys(m).map(Number),y=[o,...f].find(b=>m[b]?.type===n);return y===void 0?void 0:this.resolveInput(y,s)}const a=this.node.outputs[o]?.links?.at(0),r=this.node.graph?.getLink(a);if(!r)throw new Error(`Failed to get link for group node ${this.node.id} with link ${a}`);const l=this.node.updateLink?.(r);if(!l)throw new Error(`Failed to update link for group node ${this.node.id} with link ${a}`);const u=this.node.getInnerNodes?.(this.nodesByExecutionId).find(m=>m.id===l.origin_id);if(!u)throw new Error(`Failed to get node for group node ${this.node.id} with link ${a}`);return{node:u,origin_id:`${this.id}:${l.origin_id.split(":").at(-1)}`,origin_slot:l.origin_slot}}}const graphToPrompt=p(async(i,o={})=>{const{sortNodes:n=!1}=o;for(const l of i.computeExecutionOrder(!1)){const u=l.getInnerNodes?l.getInnerNodes(new Map):[l];for(const m of u)m.isVirtualNode&&m.applyToGraph?.()}const s=i.serialize({sortNodes:n});for(const l of s.nodes){for(const u of l.inputs??[])delete u.localized_name;for(const u of l.outputs??[])delete u.localized_name}compressWidgetInputSlots(s),s.extra??={},s.extra.frontendVersion="1.33.13";const a=new Map;for(const l of i.computeExecutionOrder(!1)){const u=isGroupNode(l)?new ExecutableGroupNodeDTO(l,[],a):new ExecutableNodeDTO(l,[],a);for(const m of u.getInnerNodes())a.set(m.id,m);a.set(u.id,u)}const r={};for(const l of a.values()){if(l.isVirtualNode||l.mode===LGraphEventMode.NEVER||l.mode===LGraphEventMode.BYPASS)continue;const u={},{widgets:m}=l;if(m)for(const[f,_]of m.entries()){if(!_.name||_.options?.serialize===!1)continue;const y=_.serializeValue?await _.serializeValue(l,f):_.value;u[_.name]=Array.isArray(y)?{__value__:y}:y}for(const[f,_]of l.inputs.entries()){const y=l.resolveInput(f);if(y){if(y.widgetInfo){const{value:b}=y.widgetInfo;u[_.name]=Array.isArray(b)?{__value__:b}:b;continue}u[_.name]=[String(y.origin_id),parseInt(y.origin_slot)]}}r[String(l.id)]={inputs:u,class_type:l.comfyClass,_meta:{title:l.title}}}for(const{inputs:l}of Object.values(r))for(const[u,m]of Object.entries(l))Array.isArray(m)&&m.length===2&&!r[m[0]]&&delete l[u];return{workflow:s,output:r}},"graphToPrompt");function findLegacyRerouteNodes(i){return i.nodes.filter(o=>o.type==="Reroute")}p(findLegacyRerouteNodes,"findLegacyRerouteNodes");function noNativeReroutes(i){return!i.extra?.reroutes?.length&&!i.extra?.linkExtensions?.length}p(noNativeReroutes,"noNativeReroutes");function getNodeCenter(i){return[i.pos[0]+i.size[0]/2,i.pos[1]+i.size[1]/2]}p(getNodeCenter,"getNodeCenter");class ConversionContext{static{p(this,"ConversionContext")}constructor(o){this.workflow=o,this.nodeById=toolkit.keyBy(o.nodes.map(toolkit.cloneDeep),"id"),this.linkById=toolkit.keyBy(o.links.map(s=>({id:s[0],origin_id:s[1],origin_slot:s[2],target_id:s[3],target_slot:s[4],type:s[5]})),"id");const n=findLegacyRerouteNodes(o).map((s,a)=>({nodeId:s.id,id:a+1,pos:getNodeCenter(s),linkIds:[]}));this.#e=n.length+1,this.rerouteByNodeId=toolkit.keyBy(n,"nodeId"),this.rerouteById=toolkit.keyBy(n,"id"),this.linkExtensions=[],this.validReroutes=new Set}nodeById;linkById;rerouteById;rerouteByNodeId;linkExtensions;validReroutes;#e=0;#t(o){const n=[];let s=o;for(;s?.type==="Reroute";){n.push(s);const a=this.linkById[s.inputs?.[0]?.link??0];if(!a)break;s=this.nodeById[a.origin_id]}return n}#o(o){const n=o.map(s=>this.rerouteByNodeId[s.id]);for(const s of n)this.validReroutes.add(s);for(let s=0;s<o.length-1;s++){const a=n[s],r=n[s+1];a.parentId=r.id}return n}#n(o,n,s){if(s.length===0)throw new Error("No reroute nodes found");const a=this.rerouteByNodeId[s[0].id];this.linkExtensions.push({id:n.id,parentId:a.id});const r=this.#o(s);for(const l of r)l.linkIds??=[],l.linkIds.push(n.id),delete l.floating;return{id:n.id,origin_id:o.origin_id,origin_slot:o.origin_slot,target_id:n.target_id,target_slot:n.target_slot,type:n.type}}#s(o,n){const s=this.#o(n);for(const a of s)a.linkIds?.length||(a.floating={slotType:"input"});return{id:this.#e++,origin_id:-1,origin_slot:-1,target_id:o.target_id,target_slot:o.target_slot,type:o.type,parentId:s[0].id}}#i(o,n){const s=this.#o(n);for(const a of s)a.linkIds?.length||(a.floating={slotType:"output"});return{id:this.#e++,origin_id:o.origin_id,origin_slot:o.origin_slot,target_id:-1,target_slot:-1,type:o.type,parentId:s[0].id}}#c(o,n){for(const a of o){for(const r of a.inputs??[])r.link=null;for(const r of a.outputs??[])r.links=[]}const s=toolkit.keyBy(o,"id");for(const a of n){s[a.origin_id].outputs[a.origin_slot].links.push(a.id);const l=s[a.target_id];l.inputs[a.target_slot].link=a.id}}migrateReroutes(){const o=[],n=[],s=[];for(const l of Object.values(this.linkById)){const u=!!this.rerouteByNodeId[l.origin_id],m=!!this.rerouteByNodeId[l.target_id];!u&&!m?o.push(l):u&&!m&&s.push(l)}for(const l of s){const u=this.nodeById[l.origin_id],m=this.#t(u),f=this.linkById[m[m.length-1]?.inputs?.[0]?.link??-1];f?o.push(this.#n(f,l,m)):n.push(this.#s(l,m))}const a=Object.keys(this.rerouteByNodeId).map(l=>this.nodeById[l]).filter(l=>{const u=l.outputs?.[0];return u?!u.links?.length:!1});for(const l of a){const u=this.#t(l),m=this.linkById[u[u.length-1]?.inputs?.[0]?.link??-1];m&&n.push(this.#i(m,u))}const r=Object.values(this.nodeById).filter(l=>l.type!=="Reroute");return this.#c(r,o),{...this.workflow,nodes:r,links:o.map(l=>[l.id,l.origin_id,l.origin_slot,l.target_id,l.target_slot,l.type]),floatingLinks:n.length>0?n:void 0,extra:{...this.workflow.extra,reroutes:Array.from(this.validReroutes).map(l=>toolkit.omit(l,"nodeId")),linkExtensions:this.linkExtensions}}}}const migrateLegacyRerouteNodes=p(i=>{if(findLegacyRerouteNodes(i).length===0)return i;const n=JSON.parse(JSON.stringify(i));return n.extra||(n.extra={}),new ConversionContext(n).migrateReroutes()},"migrateLegacyRerouteNodes");function getSelectedModelsMetadata(i){try{if(!i.properties?.models?.length||!i.widgets_values)return;const o=Array.isArray(i.widgets_values)?i.widgets_values:Object.values(i.widgets_values);if(!o.length)return;const n=new Set;for(const s of o)typeof s=="string"&&s.trim()&&n.add(s);return i.properties.models.filter(s=>n.has(s.name))}catch(o){console.error("Error filtering models by current selection:",o)}}p(getSelectedModelsMetadata,"getSelectedModelsMetadata");function serialise(i,o){const n={nodes:[],links:[]};let s=0;const a=[];for(const r of i)r.clonable!==!1&&(r._relative_id=s++,a.push(r));for(const r of a){const l=r.clone();if(!l){console.warn("node type not found: "+r.type);continue}if(n.nodes.push(l.serialize()),!!r.inputs?.length)for(const u of r.inputs){if(!u||u.link==null)continue;const m=o.links.get(u.link);if(!m)continue;const f=o.getNodeById(m.origin_id);f&&n.links.push([f._relative_id,m.origin_slot,r._relative_id,m.target_slot,f.id])}}return JSON.stringify(n)}p(serialise,"serialise");function deserialiseAndCreate(i,o){if(!i)return;const{graph:n,graph_mouse:s}=o;o.emitBeforeChange();try{n.beforeChange();const a=JSON.parse(i),r=[1/0,1/0];for(const{pos:u}of a.nodes)r[0]>u[0]&&(r[0]=u[0]),r[1]>u[1]&&(r[1]=u[1]);(!Number.isFinite(r[0])||!Number.isFinite(r[1]))&&(r[0]=s[0],r[1]=s[1]);const l=[];for(const u of a.nodes){const m=LiteGraph.createNode(u.type);m&&(m.configure(u),m.pos[0]+=s[0]-r[0],m.pos[1]+=s[1]-r[1],n.add(m,!0),l.push(m))}for(const u of a.links){const m=u[0],f=m!=null?l[m]:void 0,_=l[u[2]];f&&_?f.connect(u[1],_,u[3]):console.warn("Warning, nodes missing on pasting")}o.selectNodes(l),n.afterChange()}finally{o.emitAfterChange()}}p(deserialiseAndCreate,"deserialiseAndCreate");function applyClasses(i,o,...n){o??="";let s;typeof o=="string"?s=o:o instanceof Array?s=o.join(" "):s=Object.entries(o).reduce((a,r)=>(r[1]&&(a+=(a.length?" ":"")+r[0]),a),""),i.className=s,n&&i.classList.add(...n)}p(applyClasses,"applyClasses");function toggleElement(i,{onHide:o,onShow:n}={}){let s,a;return r=>{r?(a&&(a=!1,s.replaceWith(i)),n?.(i,r)):(s||(s=document.createComment("")),a=!0,i.replaceWith(s),o?.(i))}}p(toggleElement,"toggleElement");window.comfyAPI=window.comfyAPI||{};window.comfyAPI.utils=window.comfyAPI.utils||{};window.comfyAPI.utils.applyClasses=applyClasses;window.comfyAPI.utils.toggleElement=toggleElement;class ComfyButton{static{p(this,"ComfyButton")}#e=0;#t=!1;isOver=!1;iconElement=$el("i.mdi");contentElement=$el("span");popup;element;overIcon;iconSize;content;icon;tooltip;classList;hidden;enabled;action;constructor({icon:o,overIcon:n,iconSize:s,content:a,tooltip:r,action:l,classList:u="comfyui-button",visibilitySetting:m,app:f,enabled:_=!0}){if(this.element=$el("button",{onmouseenter:p(()=>{this.isOver=!0,this.overIcon&&this.updateIcon()},"onmouseenter"),onmouseleave:p(()=>{this.isOver=!1,this.overIcon&&this.updateIcon()},"onmouseleave")},[this.iconElement,this.contentElement]),this.icon=prop(this,"icon",o,toggleElement(this.iconElement,{onShow:this.updateIcon})),this.overIcon=prop(this,"overIcon",n,()=>{this.isOver&&this.updateIcon()}),this.iconSize=prop(this,"iconSize",s,this.updateIcon),this.content=prop(this,"content",a,toggleElement(this.contentElement,{onShow:p((y,b)=>{typeof b=="string"?y.textContent=b:y.replaceChildren(b)},"onShow")})),this.tooltip=prop(this,"tooltip",r,y=>{y?this.element.title=y:this.element.removeAttribute("title")}),r!==void 0&&this.element.setAttribute("aria-label",r),this.classList=prop(this,"classList",u,this.updateClasses),this.hidden=prop(this,"hidden",!1,this.updateClasses),this.enabled=prop(this,"enabled",_,()=>{this.updateClasses(),this.element.disabled=!this.enabled}),this.action=prop(this,"action",l),this.element.addEventListener("click",y=>{this.popup&&(this.#e||this.popup.toggle()),this.action?.(y,this)}),m?.id){const y=p(()=>{this.hidden=f.ui.settings.getSettingValue(m.id)!==m.showValue},"settingUpdated");f.ui.settings.addEventListener(m.id+".change",y),y()}}updateIcon=p(()=>this.iconElement.className=`mdi mdi-${this.isOver&&this.overIcon||this.icon}${this.iconSize?" mdi-"+this.iconSize+"px":""}`,"updateIcon");updateClasses=p(()=>{const o=[];this.hidden&&o.push("hidden"),this.enabled||o.push("disabled"),this.popup&&(this.#t?o.push("popup-open"):o.push("popup-closed")),applyClasses(this.element,this.classList,...o)},"updateClasses");withPopup(o,n="click"){if(this.popup=o,n==="hover")for(const s of[this.element,this.popup.element])s.addEventListener("mouseenter",()=>{this.popup.open=!!++this.#e}),s.addEventListener("mouseleave",()=>{this.popup.open=!!--this.#e});return o.addEventListener("change",()=>{this.#t=o.open,this.updateClasses()}),this}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.button=window.comfyAPI.button||{};window.comfyAPI.button.ComfyButton=ComfyButton;class ComfyButtonGroup{static{p(this,"ComfyButtonGroup")}element=$el("div.comfyui-button-group");buttons;constructor(...o){this.buttons=prop(this,"buttons",o,()=>this.update())}insert(o,n){this.buttons.splice(n,0,o),this.update()}append(o){this.buttons.push(o),this.update()}remove(o){if(typeof o!="number"&&(o=this.buttons.indexOf(o)),o>-1){const n=this.buttons.splice(o,1);return this.update(),n}}update(){this.element.replaceChildren(...this.buttons.map(o=>o.element??o))}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.buttonGroup=window.comfyAPI.buttonGroup||{};window.comfyAPI.buttonGroup.ComfyButtonGroup=ComfyButtonGroup;class ComfyPopup extends EventTarget{static{p(this,"ComfyPopup")}element=$el("div.comfyui-popup");open;children;target;ignoreTarget;container;position;closeOnEscape;horizontal;classList;constructor({target:o,container:n=document.body,classList:s="",ignoreTarget:a=!0,closeOnEscape:r=!0,position:l="absolute",horizontal:u="left"},...m){super(),this.target=o,this.ignoreTarget=a,this.container=n,this.position=l,this.closeOnEscape=r,this.horizontal=u,n.append(this.element),this.children=prop(this,"children",m,()=>{this.element.replaceChildren(...this.children),this.update()}),this.classList=prop(this,"classList",s,()=>applyClasses(this.element,this.classList,"comfyui-popup",u)),this.open=prop(this,"open",!1,(f,_)=>{f!==_&&(f?this.#t():this.#e())})}toggle(){this.open=!this.open}#e(){this.element.classList.remove("open"),window.removeEventListener("resize",this.update),window.removeEventListener("click",this.#n,{capture:!0}),window.removeEventListener("keydown",this.#o,{capture:!0}),this.dispatchEvent(new CustomEvent("close")),this.dispatchEvent(new CustomEvent("change"))}#t(){this.element.classList.add("open"),this.update(),window.addEventListener("resize",this.update),window.addEventListener("click",this.#n,{capture:!0}),this.closeOnEscape&&window.addEventListener("keydown",this.#o,{capture:!0}),this.dispatchEvent(new CustomEvent("open")),this.dispatchEvent(new CustomEvent("change"))}#o=p(o=>{o.key==="Escape"&&(this.open=!1,o.preventDefault(),o.stopImmediatePropagation())},"#escHandler");#n=p(o=>{const n=o.target;!this.element.contains(n)&&this.ignoreTarget&&!this.target.contains(n)&&(this.open=!1)},"#clickHandler");update=p(()=>{const o=this.target.getBoundingClientRect();this.element.style.setProperty("--bottom","unset"),this.position==="absolute"?(this.horizontal==="left"?this.element.style.setProperty("--left",o.left+"px"):this.element.style.setProperty("--left",o.right-this.element.clientWidth+"px"),this.element.style.setProperty("--top",o.bottom+"px"),this.element.style.setProperty("--limit",o.bottom+"px")):(this.element.style.setProperty("--left","0px"),this.element.style.setProperty("--top",o.height+"px"),this.element.style.setProperty("--limit",o.height+"px")),this.element.getBoundingClientRect().height<30&&(this.element.style.setProperty("--top","unset"),this.element.style.setProperty("--bottom",o.height+5+"px"),this.element.style.setProperty("--limit",o.height+5+"px"))},"update")}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.popup=window.comfyAPI.popup||{};window.comfyAPI.popup.ComfyPopup=ComfyPopup;class ComfySplitButton{static{p(this,"ComfySplitButton")}arrow;element;popup;items;constructor({primary:o,mode:n,horizontal:s="left",position:a="relative"},...r){this.arrow=new ComfyButton({icon:"chevron-down"}),this.element=$el("div.comfyui-split-button"+(n==="hover"?".hover":""),[$el("div.comfyui-split-primary",{ariaLabel:"Queue current workflow"},o.element),$el("div.comfyui-split-arrow",{ariaLabel:"Open extra opens",ariaHasPopup:"true"},this.arrow.element)]),this.popup=new ComfyPopup({target:this.element,container:a==="relative"?this.element:document.body,classList:"comfyui-split-button-popup"+(n==="hover"?" hover":""),closeOnEscape:n==="click",position:a,horizontal:s}),this.arrow.withPopup(this.popup,n),this.items=prop(this,"items",r,()=>this.update())}update(){this.popup.element.replaceChildren(...this.items.map(o=>"element"in o?o.element:o))}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.splitButton=window.comfyAPI.splitButton||{};window.comfyAPI.splitButton.ComfySplitButton=ComfySplitButton;class ComfyAsyncDialog extends ComfyDialog$1{static{p(this,"ComfyAsyncDialog")}#e;constructor(o){super("dialog.comfy-dialog.comfyui-dialog",o?.map(n=>(typeof n=="string"&&(n={text:n}),$el("button.comfyui-button",{type:"button",textContent:n.text,onclick:p(()=>this.close(n.value??n.text),"onclick")}))))}show(o){return this.element.addEventListener("close",()=>{this.close()}),super.show(o),new Promise(n=>{this.#e=n})}showModal(o){return this.element.addEventListener("close",()=>{this.close()}),super.show(o),this.element.showModal(),new Promise(n=>{this.#e=n})}close(o=null){this.#e(o),this.element.close(),super.close()}static async prompt({title:o=null,message:n,actions:s}){const a=new ComfyAsyncDialog(s),r=[$el("span",n)];o&&r.unshift($el("h3",o));const l=await a.showModal(r);return a.element.remove(),l}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.asyncDialog=window.comfyAPI.asyncDialog||{};window.comfyAPI.asyncDialog.ComfyAsyncDialog=ComfyAsyncDialog;class ComfyAppMenu{static{p(this,"ComfyAppMenu")}app;actionsGroup;settingsGroup;viewGroup;element;constructor(o){this.app=o,this.actionsGroup=new ComfyButtonGroup,this.settingsGroup=new ComfyButtonGroup,this.viewGroup=new ComfyButtonGroup,this.element=$el("div.flex.gap-2.mx-2",[this.actionsGroup.element,this.settingsGroup.element,this.viewGroup.element])}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.index=window.comfyAPI.index||{};window.comfyAPI.index.ComfyAppMenu=ComfyAppMenu;const SCALE_FACTOR=1.2;function ensureCorrectLayoutScale(i="LG",o){if(!useSettingStore().get("Comfy.VueNodes.AutoScaleLayout"))return;const s=app$1.canvas,a=o??s?.graph;if(!a?.nodes)return;const{shouldRenderVueNodes:r}=useVueFeatureFlags(),l=i==="LG"&&r.value,u=i==="Vue"&&!r.value;if(!l&&!u){a.extra.workflowRendererVersion??=i;return}const m=createBounds(a.nodes);if(!m)return;const[f,_]=m,y=new Map(a.nodes.map(S=>[S.id,S])),b=[],w=l?SCALE_FACTOR:1/SCALE_FACTOR,k=!o||o===s?.graph;for(const S of a.nodes){const C=y.get(S.id);if(!C)continue;const[I,T]=C.pos,E=I-f,N=T-_,L=f+E*w,A=_+N*w,D=C.width*w,O=l?C.size[1]*w+LiteGraph.NODE_TITLE_HEIGHT:(C.size[1]-LiteGraph.NODE_TITLE_HEIGHT)*w;C.pos[0]=L,C.pos[1]=A,C.size[0]=D,C.size[1]=O,k&&b.push({nodeId:String(C.id),bounds:{x:L,y:A,width:D,height:O}})}k&&b.length>0&&layoutStore.batchUpdateNodeBounds(b);for(const S of a.reroutes.values()){const[C,I]=S.pos,T=C-f,E=I-_,N=f+T*w,L=_+E*w;S.pos=[N,L],k&&r.value&&useLayoutMutations().moveReroute(S.id,{x:N,y:L},{x:C,y:I})}if("inputNode"in a&&"outputNode"in a){const S=[a.inputNode,a.outputNode];for(const C of S){const[I,T]=C.pos,[E,N]=C.size,L=I-f,A=T-_,D=f+L*w,O=_+A*w,M=E*w,P=N*w;C.pos=[D,O],C.size=[M,P]}}if(a.groups.forEach(S=>{const[C,I]=S.pos,[T,E]=S.size,N=C-f,L=I-_,A=f+N*w,D=_+L*w,O=T*w,M=E*w;S.pos=[A,D],S.size=[O,M]}),k&&s){const S=s.ds.convertOffsetToCanvas([f,_]);s.ds.changeScale(s.ds.scale/w,S)}a.extra.workflowRendererVersion=l?"Vue":"LG"}p(ensureCorrectLayoutScale,"ensureCorrectLayoutScale");async function extractFileFromDragEvent(i){if(!i.dataTransfer)return;if(i.dataTransfer.files.length&&i.dataTransfer.files[0].type!=="image/bmp")return i.dataTransfer.files[0];const o=["text/uri-list","text/x-moz-url"],n=[...i.dataTransfer.types].find(l=>o.includes(l));if(!n)return;const s=i.dataTransfer.getData(n)?.split(`
`)?.[0];if(!s)return;const r=await(await fetch(s)).blob();return new File([r],s,{type:r.type})}p(extractFileFromDragEvent,"extractFileFromDragEvent");const ANIM_PREVIEW_WIDGET="$$comfy_animation_preview";function sanitizeNodeName(i){let o={"&":"","<":"",">":"",'"':"","'":"","`":"","=":""};return String(i).replace(/[&<>"'`=]/g,p(function(s){return o[s]},"fromEntityMap"))}p(sanitizeNodeName,"sanitizeNodeName");class ComfyApp{static{p(this,"ComfyApp")}queueItems=[];processingQueue=!1;static clipspace=null;static clipspace_invalidate_handler=null;static open_maskeditor=null;static maskeditor_is_opended=null;static clipspace_return_node=null;vueAppReady;api;ui;extensionManager;_nodeOutputs;nodePreviewImages;rootGraphInternal;get graph(){return this.rootGraphInternal}get rootGraph(){return this.rootGraphInternal||console.error("ComfyApp graph accessed before initialization"),this.rootGraphInternal}canvas;dragOverNode=null;canvasElRef=shallowRef();get canvasEl(){return unref(this.canvasElRef)}configuringGraphLevel=0;get configuringGraph(){return this.configuringGraphLevel>0}ctx;bodyTop;bodyLeft;bodyRight;bodyBottom;canvasContainer;menu;openClipspace=p(()=>{},"openClipspace");positionConversion;get lastNodeErrors(){return useExecutionStore().lastNodeErrors}get lastExecutionError(){return useExecutionStore().lastExecutionError}get runningNodeId(){return useExecutionStore().executingNodeId}get shiftDown(){return useWorkspaceStore().shiftDown}get widgets(){return Object.fromEntries(useWidgetStore().widgets.entries())}get storageLocation(){return"server"}get isNewUserSession(){return!1}get extensions(){return useExtensionStore().extensions}get progress(){return useExecutionStore()._executingNodeProgress}static isImageNode(o){return isImageNode(o)}resetView(){useLitegraphService().resetView()}constructor(){this.vueAppReady=!1,this.ui=new ComfyUI(this),this.api=api,this.bodyTop=$el("div.comfyui-body-top"),this.bodyLeft=$el("div.comfyui-body-left"),this.bodyRight=$el("div.comfyui-body-right"),this.bodyBottom=$el("div.comfyui-body-bottom"),this.canvasContainer=$el("div.graph-canvas-container"),this.menu=new ComfyAppMenu(this),this.nodeOutputs={},this.nodePreviewImages={}}get nodeOutputs(){return this._nodeOutputs}set nodeOutputs(o){this._nodeOutputs=o,this.vueAppReady&&useExtensionService().invokeExtensions("onNodeOutputsUpdated",o)}getPreviewFormatParam(){let o=useSettingStore().get("Comfy.PreviewFormat");return o?`&preview=${o}`:""}getRandParam(){return"&rand="+Math.random()}static onClipspaceEditorSave(){ComfyApp.clipspace_return_node&&ComfyApp.pasteFromClipspace(ComfyApp.clipspace_return_node)}static onClipspaceEditorClosed(){ComfyApp.clipspace_return_node=null}static copyToClipspace(o){var n=null;o.widgets&&(n=o.widgets.map(({type:f,name:_,value:y})=>({type:f,name:_,value:y})));var s=void 0,a=void 0;if(o.imgs!=null){s=[],a=[];for(let f=0;f<o.imgs.length;f++)s[f]=new Image,s[f].src=o.imgs[f].src,a[f]=s[f]}var r=0;o.imageIndex&&(r=o.imageIndex);const l=s?s.length+1:1,u=s?s.length+2:2,m=o.images??useNodeOutputStore().getNodeOutputs(o)?.images;ComfyApp.clipspace={widgets:n,imgs:s,original_imgs:a,images:m,selectedIndex:r,img_paste_mode:"selected",paintedIndex:l,combinedIndex:u},ComfyApp.clipspace_return_node=null,ComfyApp.clipspace_invalidate_handler&&ComfyApp.clipspace_invalidate_handler()}static pasteFromClipspace(o){if(ComfyApp.clipspace){let n;if(ComfyApp.clipspace.combinedIndex!==void 0&&ComfyApp.clipspace.imgs&&ComfyApp.clipspace.combinedIndex<ComfyApp.clipspace.imgs.length&&(n=ComfyApp.clipspace.imgs[ComfyApp.clipspace.combinedIndex].src),ComfyApp.clipspace.imgs&&o.imgs&&(ComfyApp.clipspace.images&&(ComfyApp.clipspace.img_paste_mode=="selected"?o.images=[ComfyApp.clipspace.images[ComfyApp.clipspace.selectedIndex]]:o.images=ComfyApp.clipspace.images,app$1.nodeOutputs[o.id+""]&&(app$1.nodeOutputs[o.id+""].images=o.images)),ComfyApp.clipspace.imgs))if(ComfyApp.clipspace.img_paste_mode=="selected"){const s=new Image;s.src=ComfyApp.clipspace.imgs[ComfyApp.clipspace.selectedIndex].src,o.imgs=[s],o.imageIndex=0}else{const s=[];for(let a=0;a<ComfyApp.clipspace.imgs.length;a++)s[a]=new Image,s[a].src=ComfyApp.clipspace.imgs[a].src,o.imgs=s}if(ComfyApp.clipspace.imgs?.[ComfyApp.clipspace.paintedIndex]&&o.imgs){const s=new Image;s.src=ComfyApp.clipspace.imgs[ComfyApp.clipspace.paintedIndex].src,o.imgs.push(s)}if(ComfyApp.clipspace.imgs?.[ComfyApp.clipspace.combinedIndex]&&o.imgs&&n){const s=new Image;s.src=n,o.imgs=[s]}if(o.widgets){if(ComfyApp.clipspace.images){const s=ComfyApp.clipspace.images[ComfyApp.clipspace.selectedIndex],a=o.widgets.findIndex(r=>r.name==="image");a>=0&&(o.widgets[a].type!="image"&&typeof o.widgets[a].value=="string"&&s.filename?o.widgets[a].value=(s.subfolder?s.subfolder+"/":"")+s.filename+(s.type?` [${s.type}]`:""):o.widgets[a].value=s)}ComfyApp.clipspace.widgets&&ComfyApp.clipspace.widgets.forEach(({type:s,name:a,value:r})=>{const l=Object.values(o.widgets).find(u=>u.type===s&&u.name===a);if(l&&l.type!="button")if(l.type!="image"&&typeof l.value=="string"&&r.filename){const u=r;l.value=(u.subfolder?u.subfolder+"/":"")+u.filename+(u.type?` [${u.type}]`:"")}else l.value=r,l.callback?.(r)})}app$1.graph.setDirtyCanvas(!0),useNodeOutputStore().updateNodeImages(o)}}addDropHandler(){useEventListener(document,"drop",async o=>{try{o.preventDefault(),o.stopPropagation();const n=this.dragOverNode;if(this.dragOverNode=null,await n?.onDragDrop?.(o))return;const s=await extractFileFromDragEvent(o);if(!s)return;const a=useWorkspaceStore();try{a.spinner=!0,await this.handleFile(s,"file_drop")}finally{a.spinner=!1}}catch(n){useToastStore().addAlert(t("toastMessages.dropFileError",{error:n}))}}),useEventListener(this.canvasElRef,"dragleave",async()=>{this.dragOverNode&&(this.dragOverNode=null,this.graph.setDirtyCanvas(!1,!0))}),useEventListener(this.canvasElRef,"dragover",o=>{this.canvas.adjustMouseEvent(o);const n=this.graph.getNodeOnPos(o.canvasX,o.canvasY);if(!n?.onDragOver?.(o)){this.dragOverNode=null;return}this.dragOverNode=n,requestAnimationFrame(()=>{this.graph.setDirtyCanvas(!1,!0)})},!1)}addProcessKeyHandler(){const o=LGraphCanvas.prototype.processKey;LGraphCanvas.prototype.processKey=function(n){if(this.graph&&!(n.target instanceof Element&&n.target.localName=="input")){if(n.type=="keydown"&&!n.repeat){const s=KeyComboImpl.fromEvent(n),r=useKeybindingStore().getKeybinding(s);if(r&&r.targetElementId==="graph-canvas-container"){useCommandStore().execute(r.commandId),this.graph.change(),n.preventDefault(),n.stopImmediatePropagation();return}if(n.key==="c"&&(n.metaKey||n.ctrlKey)||(n.key==="v"||n.key=="V")&&(n.metaKey||n.ctrlKey)&&!n.shiftKey)return}return o.apply(this,[n])}}}addApiUpdateHandlers(){api.addEventListener("status",({detail:o})=>{this.ui.setStatus(o)}),api.addEventListener("progress",()=>{this.graph.setDirtyCanvas(!0,!1)}),api.addEventListener("executing",()=>{this.graph.setDirtyCanvas(!0,!1)}),api.addEventListener("executed",({detail:o})=>{const n=useNodeOutputStore(),s=String(o.display_node||o.node);n.setNodeOutputsByExecutionId(s,o.output,{merge:o.merge});const a=getNodeByExecutionId(this.graph,s);a&&a.onExecuted&&a.onExecuted(o.output)}),api.addEventListener("execution_start",()=>{triggerCallbackOnAllNodes(this.graph,"onExecutionStart")}),api.addEventListener("execution_error",({detail:o})=>{if(o.exception_message?.includes("Unauthorized: Please login first to use this node."))useDialogService().showApiNodesSignInDialog([o.node_type]);else if(o.exception_message?.includes("Payment Required: Please add credits to your account to use this node.")){const{isActiveSubscription:n}=useSubscription();n.value&&useDialogService().showTopUpCreditsDialog({isInsufficientCredits:!0})}else useDialogService().showExecutionErrorDialog(o);this.canvas.draw(!0,!0)}),api.addEventListener("b_preview_with_metadata",({detail:o})=>{const{blob:n,displayNodeId:s}=o,{setNodePreviewsByExecutionId:a,revokePreviewsByExecutionId:r}=useNodeOutputStore();r(s);const l=URL.createObjectURL(n),u=s.split(":");for(let m=1;m<=u.length;m++)a(u.slice(0,m).join(":"),[l])}),api.init()}addConfigureHandler(){const o=this,n=LGraph.prototype.configure;LGraph.prototype.configure=function(...s){o.configuringGraphLevel++;try{return n.apply(this,s)}finally{o.configuringGraphLevel--}}}addAfterConfigureHandler(o){const{onConfigure:n}=o;o.onConfigure=function(...s){fixLinkInputSlots(this),triggerCallbackOnAllNodes(this,"onGraphConfigured");const a=n?.apply(this,s);return triggerCallbackOnAllNodes(this,"onAfterGraphConfigured"),a}}async setup(o){this.bodyTop=document.getElementById("comfyui-body-top"),this.bodyLeft=document.getElementById("comfyui-body-left"),this.bodyRight=document.getElementById("comfyui-body-right"),this.bodyBottom=document.getElementById("comfyui-body-bottom"),this.canvasContainer=document.getElementById("graph-canvas-container"),this.canvasElRef.value=o,await useWorkspaceStore().workflow.syncWorkflows(),useSubgraphStore().fetchSubgraphs(),await useExtensionService().loadExtensions(),this.addProcessKeyHandler(),this.addConfigureHandler(),this.addApiUpdateHandlers();const n=new LGraph;n.events.addEventListener("subgraph-created",s=>{try{const{subgraph:a,data:r}=s.detail;useSubgraphService().registerNewSubgraph(a,r)}catch(a){console.error("Failed to register subgraph",a),useToastStore().add({severity:"error",summary:"Failed to register subgraph",detail:a instanceof Error?a.message:String(a)})}}),this.addAfterConfigureHandler(n),this.rootGraphInternal=n,this.canvas=new LGraphCanvas(o,n),this.canvas.state=reactive(this.canvas.state),this.ctx=o.getContext("2d"),LiteGraph.alt_drag_do_clone_nodes=!0,LiteGraph.macGesturesRequireMac=!1,this.canvas.canvas.addEventListener("litegraph:set-graph",s=>{const{newGraph:a}=s.detail,r=useDomWidgetStore(),l=Object.fromEntries(a.nodes.flatMap(u=>u.widgets??[]).filter(u=>u instanceof DOMWidgetImpl).map(u=>[u.id,u]));for(const[u,m]of r.widgetStates.entries())u in l?(m.active=!0,m.widget=l[u]):m.active=!1}),this.canvas.canvas.addEventListener("litegraph:set-graph",s=>{const{newGraph:a,oldGraph:r}=s.detail;r&&ensureCorrectLayoutScale(a.extra.workflowRendererVersion,a)}),registerProxyWidgets(this.canvas),this.graph.start(),useResizeObserver(this.canvasElRef,([s])=>{s.target instanceof HTMLCanvasElement&&this.resizeCanvas(s.target)}),await useExtensionService().invokeExtensionsAsync("init"),await this.registerNodes(),this.addDropHandler(),await useExtensionService().invokeExtensionsAsync("setup"),this.positionConversion=useCanvasPositionConversion(this.canvasContainer,this.canvas)}resizeCanvas(o){const n=Math.max(window.devicePixelRatio,1);o.height=o.width=NaN;const{width:s,height:a}=o.getBoundingClientRect();o.width=Math.round(s*n),o.height=Math.round(a*n),o.getContext("2d").scale(n,n),this.canvas?.draw(!0,!0)}updateVueAppNodeDefs(o){const n={};for(const[l,u]of Object.entries(LiteGraph.registered_node_types))l in o||l in SYSTEM_NODE_DEFS||u.skip_list||(n[l]={name:l,display_name:l,category:u.category||"__frontend_only__",input:{required:{},optional:{}},output:[],output_name:[],output_is_list:[],output_node:!1,python_module:"custom_nodes.frontend_only",description:u.description??`Frontend only node for ${l}`});const s={...n,...o,...SYSTEM_NODE_DEFS},a=useNodeDefStore(),r=Object.values(s);useExtensionService().invokeExtensions("beforeRegisterVueAppNodeDefs",r,this),a.updateNodeDefs(r)}async getNodeDefs(){const o=p(n=>({...n,display_name:st(`nodeDefs.${n.name}.display_name`,n.display_name??n.name),description:n.description?st(`nodeDefs.${n.name}.description`,n.description):"",category:n.category.split("/").map(s=>st(`nodeCategories.${s}`,s)).join("/")}),"translateNodeDef");return toolkit.mapValues(await api.getNodeDefs(),n=>o(n))}async registerNodes(){const o=await this.getNodeDefs();await this.registerNodesFromDefs(o),await useExtensionService().invokeExtensionsAsync("registerCustomNodes"),this.vueAppReady&&this.updateVueAppNodeDefs(o)}async registerNodeDef(o,n){return await useLitegraphService().registerNodeDef(o,n)}async registerNodesFromDefs(o){await useExtensionService().invokeExtensionsAsync("addCustomNodeDefs",o);for(const n in o)this.registerNodeDef(n,o[n])}loadTemplateData(o){if(!o?.templates)return;const n=localStorage.getItem("litegrapheditor_clipboard");var s,a,r;for(const l of o.templates){if(!l?.data)continue;JSON.parse(l.data).reroutes?(localStorage.setItem("litegrapheditor_clipboard",l.data),app$1.canvas.pasteFromClipboard()):deserialiseAndCreate(l.data,app$1.canvas),s=!1;for(const m in app$1.canvas.selected_nodes)r=app$1.canvas.selected_nodes[m],a=r.pos[1]+r.size[1],(s===!1||a>s)&&(s=a);app$1.canvas.graph_mouse[1]=s+50}localStorage.setItem("litegrapheditor_clipboard",n)}showMissingNodesError(o){useSettingStore().get("Comfy.Workflow.ShowMissingNodesWarning")&&useDialogService().showLoadWorkflowWarning({missingNodeTypes:o})}showMissingModelsError(o,n){useSettingStore().get("Comfy.Workflow.ShowMissingModelsWarning")&&useDialogService().showMissingModelsWarning({missingModels:o,paths:n})}async loadGraphData(o,n=!0,s=!0,a=null,r={}){const{showMissingNodesDialog:l=!0,showMissingModelsDialog:u=!0,checkForRerouteMigration:m=!1,openSource:f}=r;useWorkflowService().beforeLoadNewGraph(),n!==!1&&this.clean();let _=!1;if((!o||typeof o!="object"||Array.isArray(o))&&(o=defaultGraph,_=!0),o=clone$1(o),useSettingStore().get("Comfy.Validation.Workflows")){const{graphData:E}=await useWorkflowValidation().validateWorkflow(o);o=E??o}m&&o.version===.4&&findLegacyRerouteNodes(o).length&&noNativeReroutes(o)&&useToastStore().add({group:"reroute-migration",severity:"warn"}),useSubgraphService().loadSubgraphs(o);const y=[],b=[];await useExtensionService().invokeExtensionsAsync("beforeConfigureGraph",o,y);const w=[],k=p((E,N="")=>{if(!Array.isArray(E)){console.warn("Workflow nodes data is missing or invalid, skipping node processing",{nodes:E,path:N});return}for(let L of E){L.type=="T2IAdapterLoader"&&(L.type="ControlNetLoader"),L.type=="ConditioningAverage "&&(L.type="ConditioningAverage"),L.type=="SDV_img2vid_Conditioning"&&(L.type="SVD_img2vid_Conditioning"),L.type=="Load3DAnimation"&&(L.type="Load3D"),L.type=="Preview3DAnimation"&&(L.type="Preview3D"),L.type in LiteGraph.registered_node_types||(N?y.push({type:L.type,hint:`in subgraph '${N}'`}):y.push(L.type),L.type=sanitizeNodeName(L.type));const A=getSelectedModelsMetadata(L);A?.length&&w.push(...A)}},"collectMissingNodesAndModels");if(k(o.nodes),o.definitions?.subgraphs)for(const E of o.definitions.subgraphs)isSubgraphDefinition(E)&&k(E.nodes,E.name||E.id);const S=o.models;S?.length&&w.push(...S);const C=p(E=>E.url||E.hash,"getModelKey"),I=w.filter(C),T=toolkit.uniqBy(I,C);if(T.length&&useSettingStore().get("Comfy.Workflow.ShowMissingModelsWarning")){const E=useModelStore();await E.loadModelFolders();for(const N of T){const L=await E.getLoadedModelFolder(N.directory);L||(N.directory_invalid=!0);const A=L?.models;A&&Object.values(A).some(O=>O.file_name===N.name)||b.push(N)}}try{this.graph.configure(o);const E=this.graph.extra.workflowRendererVersion;ensureCorrectLayoutScale(E);for(const N of this.graph.subgraphs.values())ensureCorrectLayoutScale(N.extra.workflowRendererVersion||E,N);s&&useSettingStore().get("Comfy.EnableWorkflowViewRestore")&&(o.extra?.ds?(this.canvas.ds.offset=o.extra.ds.offset,this.canvas.ds.scale=o.extra.ds.scale):requestAnimationFrame(()=>{useLitegraphService().fitView()}))}catch(E){useDialogService().showErrorDialog(E,{title:t("errorDialog.loadWorkflowTitle"),reportType:"loadWorkflowError"}),console.error(E);return}for(const E of this.graph.nodes){const N=E.computeSize();if(N[0]=Math.max(E.size[0],N[0]),N[1]=Math.max(E.size[1],N[1]),E.setSize(N),E.widgets)for(let L of E.widgets)(E.type=="KSampler"||E.type=="KSamplerAdvanced")&&L.name=="sampler_name"&&typeof L.value=="string"&&L.value.startsWith("sample_")&&(L.value=L.value.slice(7)),(E.type=="KSampler"||E.type=="KSamplerAdvanced"||E.type=="PrimitiveNode")&&L.name=="control_after_generate"&&(L.value===!0?L.value="randomize":L.value===!1&&(L.value="fixed")),_&&L.type=="combo"&&!L.options.values.includes(L.value)&&L.options.values.length>0&&(L.value=L.options.values[0]);useExtensionService().invokeExtensions("loadedGraphNode",E)}if(y.length&&l&&this.showMissingNodesError(y),b.length&&u){const E=await api.getFolderPaths();this.showMissingModelsError(b,E)}await useExtensionService().invokeExtensionsAsync("afterConfigureGraph",y),y.length,y.map(E=>typeof E=="string"?E:E.type),await useWorkflowService().afterLoadNewGraph(a,this.graph.serialize()),requestAnimationFrame(()=>{this.graph.setDirtyCanvas(!0,!0)})}async graphToPrompt(o=this.graph){return graphToPrompt(o,{sortNodes:useSettingStore().get("Comfy.Workflow.SortNodeIdOnSave")})}async queuePrompt(o,n=1,s){if(this.queueItems.push({number:o,batchCount:n,queueNodeIds:s}),this.processingQueue)return!1;this.processingQueue=!0;const a=useExecutionStore();a.lastNodeErrors=null;let r=await useFirebaseAuthStore().getIdToken(),l=useApiKeyAuthStore().getApiKey();try{for(;this.queueItems.length;){const{number:u,batchCount:m,queueNodeIds:f}=this.queueItems.pop();for(let _=0;_<m;_++){executeWidgetsCallback(this.graph.nodes,"beforeQueued");for(const b of this.graph.subgraphs.values())executeWidgetsCallback(b.nodes,"beforeQueued");const y=await this.graphToPrompt(this.graph);try{api.authToken=r,api.apiKey=l??void 0;const b=await api.queuePrompt(u,y,{partialExecutionTargets:f});if(delete api.authToken,delete api.apiKey,a.lastNodeErrors=b.node_errors??null,a.lastNodeErrors?.length)this.canvas.draw(!0,!0);else try{b.prompt_id&&a.storePrompt({id:b.prompt_id,nodes:Object.keys(y.output),workflow:useWorkspaceStore().workflow.activeWorkflow})}catch{}}catch(b){useDialogService().showErrorDialog(b,{title:t("errorDialog.promptExecutionError"),reportType:"promptExecutionError"}),console.error(b),b instanceof PromptExecutionError&&(a.lastNodeErrors=b.response.node_errors??null,this.canvas.draw(!0,!0));break}executeWidgetsCallback(y.workflow.nodes.map(b=>this.graph.getNodeById(b.id)).filter(b=>!!b),"afterQueued");for(const b of this.graph.subgraphs.values())executeWidgetsCallback(b.nodes,"afterQueued");this.canvas.draw(!0,!0),await this.ui.queue.update()}}}finally{this.processingQueue=!1}return api.dispatchCustomEvent("promptQueued",{number:o,batchCount:n}),!a.lastNodeErrors}showErrorOnFileLoad(o){useToastStore().addAlert(t("toastMessages.fileLoadError",{fileName:o.name}))}async handleFile(o,n){const s=o.name.replace(/\.\w+$/,""),a=await getWorkflowDataFromFile(o);if(!a){this.showErrorOnFileLoad(o);return}const{workflow:r,prompt:l,parameters:u,templates:m}=a;if(m&&this.loadTemplateData({templates:m}),r){let f;try{if(f=typeof r=="string"?JSON.parse(r):r,f&&typeof f=="object"&&!Array.isArray(f)){await this.loadGraphData(f,!0,!0,s,{openSource:n});return}else console.error("Invalid workflow structure, trying parameters fallback"),this.showErrorOnFileLoad(o)}catch(_){console.error("Failed to parse workflow:",_),this.showErrorOnFileLoad(o)}}if(u){useWorkflowService().beforeLoadNewGraph(),importA1111(this.graph,u),useWorkflowService().afterLoadNewGraph(s,this.graph.serialize());return}if(l){const f=typeof l=="string"?JSON.parse(l):l;this.loadApiJson(f,s);return}this.showErrorOnFileLoad(o)}isApiJson(o){return toolkit.isObject(o)&&Object.values(o).every(n=>n.class_type)}loadApiJson(o,n){useWorkflowService().beforeLoadNewGraph();const s=Object.values(o).filter(r=>!LiteGraph.registered_node_types[r.class_type]);if(s.length){this.showMissingNodesError(s.map(r=>r.class_type));return}const a=Object.keys(o);app$1.graph.clear();for(const r of a){const l=o[r],u=LiteGraph.createNode(l.class_type);u&&(u.id=isNaN(+r)?r:+r,u.title=l._meta?.title??u.title,app$1.graph.add(u))}for(const r of a){const l=o[r],u=app$1.graph.getNodeById(r);for(const m in l.inputs??{}){const f=l.inputs[m];if(f instanceof Array){const[_,y]=f,b=app$1.graph.getNodeById(_);let w=u.inputs?.findIndex(k=>k.name===m);if(w==null||w===-1)try{const k=u.widgets?.find(S=>S.name===m);k&&u.convertWidgetToInput?.(k)&&(w=u.inputs?.length-1)}catch{}(w!=null||w!==-1)&&b.connect(y,u,w)}else{const _=u.widgets?.find(y=>y.name===m);_&&(_.value=f,_.callback?.(f))}}}app$1.graph.arrange();for(const r of a){const l=o[r],u=app$1.graph.getNodeById(r);for(const m in l.inputs??{}){const f=l.inputs[m];if(f instanceof Array){const[_,y]=f,b=app$1.graph.getNodeById(_);let w=u.inputs?.findIndex(k=>k.name===m);if(w==null||w===-1)try{const k=u.widgets?.find(S=>S.name===m);k&&u.convertWidgetToInput?.(k)&&(w=u.inputs?.length-1)}catch{}(w!=null||w!==-1)&&b.connect(y,u,w)}else{const _=u.widgets?.find(y=>y.name===m);_&&(_.value=f,_.callback?.(f))}}}app$1.graph.arrange(),useWorkflowService().afterLoadNewGraph(n,this.graph.serialize())}registerExtension(o){useExtensionService().registerExtension(o)}collectCanvasMenuItems(o){return useExtensionService().invokeExtensions("getCanvasMenuItems",o).flat()}collectNodeMenuItems(o){return useExtensionService().invokeExtensions("getNodeMenuItems",o).flat()}async refreshComboInNodes(){const o={severity:"info",summary:t("g.update"),detail:t("toastMessages.updateRequested")};this.vueAppReady&&useToastStore().add(o);const n=await this.getNodeDefs();for(const s in n)this.registerNodeDef(s,n[s]);forEachNode(this.graph,s=>{const a=n[s.type];if(s.refreshComboInNode?.(n),!!a?.input&&s.widgets){const r=a.input;for(const l of s.widgets)if(l.type==="combo"){let u;if(r.required?.[l.name]!==void 0?u="required":r.optional?.[l.name]!==void 0&&(u="optional"),u!==void 0){const m=r[u]?.[l.name];m&&(isComboInputSpecV2(m)?l.options.values=m[1]?.options:isComboInputSpecV1(m)&&(l.options.values=m[0]))}}}}),await useExtensionService().invokeExtensionsAsync("refreshComboInNodes",n),this.vueAppReady&&(this.updateVueAppNodeDefs(n),useToastStore().remove(o),useToastStore().add({severity:"success",summary:t("g.updated"),detail:t("toastMessages.nodeDefinitionsUpdated"),life:1e3}))}clean(){useNodeOutputStore().resetAllOutputsAndPreviews();const n=useExecutionStore();n.lastNodeErrors=null,n.lastExecutionError=null,useDomWidgetStore().clear(),this.graph&&!this.canvas.subgraph&&this.graph.clear()}clientPosToCanvasPos(o){if(!this.positionConversion)throw new Error("clientPosToCanvasPos called before setup");return this.positionConversion.clientPosToCanvasPos(o)}canvasPosToClientPos(o){if(!this.positionConversion)throw new Error("canvasPosToClientPos called before setup");return this.positionConversion.canvasPosToClientPos(o)}}const app$1=new ComfyApp;window.comfyAPI=window.comfyAPI||{};window.comfyAPI.app=window.comfyAPI.app||{};window.comfyAPI.app.ANIM_PREVIEW_WIDGET=ANIM_PREVIEW_WIDGET;window.comfyAPI.app.ComfyApp=ComfyApp;window.comfyAPI.app.app=app$1;const useTitleEditorStore=defineStore("titleEditor",()=>({titleEditorTarget:shallowRef(null)})),useCanvasStore=defineStore("canvas",()=>{const i=shallowRef(null),o=ref([]),n=p(()=>{const C=Array.from(i.value?.selectedItems??[]);o.value=C.map(I=>markRaw(I))},"updateSelectedItems"),s=ref(100),a=ref(!1);let r;const l=p(()=>{app$1.canvas?.ds&&(r=app$1.canvas.ds.onChanged,s.value=Math.round(app$1.canvas.ds.scale*100),app$1.canvas.ds.onChanged=()=>{app$1.canvas?.ds?.scale&&(s.value=Math.round(app$1.canvas.ds.scale*100)),r?.(app$1.canvas.ds.scale,app$1.canvas.ds.offset)})},"initScaleSync"),u=p(()=>{app$1.canvas?.ds&&(app$1.canvas.ds.onChanged=r,r=void 0)},"cleanupScaleSync"),m=computed(()=>o.value.some(isLGraphNode)),f=computed(()=>o.value.some(isLGraphGroup)),_=computed(()=>o.value.some(isReroute)),y=p(()=>{if(!i.value)throw new Error("getCanvas: canvas is null");return i.value},"getCanvas"),b=p(C=>{if(!app$1.canvas?.ds||C<=0)return;const I=C/100,T=app$1.canvas.ds;T.changeScale(I,T.element?[T.element.width/2,T.element.height/2]:void 0),app$1.canvas.setDirty(!0,!0),s.value=Math.round(I*100)},"setAppZoomFromPercentage"),w=shallowRef(null),k=ref(!1),S=computed(()=>new Set(o.value.filter(C=>C.id!==void 0).map(C=>String(C.id))));return whenever(()=>i.value,C=>{useEventListener(C.canvas,"litegraph:set-graph",I=>{const T=I.detail?.newGraph??app$1.canvas?.graph;w.value=T,k.value=!!app$1.canvas?.subgraph}),useEventListener(C.canvas,"subgraph-opened",()=>{k.value=!0})},{immediate:!0}),{canvas:i,selectedItems:o,selectedNodeIds:S,nodeSelected:m,groupSelected:f,rerouteSelected:_,appScalePercentage:s,linearMode:a,updateSelectedItems:n,getCanvas:y,setAppZoomFromPercentage:b,initScaleSync:l,cleanupScaleSync:u,currentGraph:w,isInSubgraph:k}});function clone(i){return JSON.parse(JSON.stringify(i))}p(clone,"clone");const logger=log.getLogger("ChangeTracker");logger.setLevel("info");class ChangeTracker{static{p(this,"ChangeTracker")}constructor(o,n){this.workflow=o,this.initialState=n,this.activeState=n}static MAX_HISTORY=50;activeState;undoQueue=[];redoQueue=[];changeCount=0;_restoringState=!1;ds;nodeOutputs;subgraphState;reset(o){this._restoringState||(logger.debug("Reset State"),o&&(this.activeState=clone(o)),this.initialState=clone(this.activeState))}store(){this.ds={scale:app$1.canvas.ds.scale,offset:[app$1.canvas.ds.offset[0],app$1.canvas.ds.offset[1]]};const o=useSubgraphNavigationStore().exportState();this.subgraphState={navigation:o}}restore(){if(this.ds&&(app$1.canvas.ds.scale=this.ds.scale,app$1.canvas.ds.offset=this.ds.offset),this.nodeOutputs&&useNodeOutputStore().restoreOutputs(this.nodeOutputs),this.subgraphState){const{navigation:o}=this.subgraphState;useSubgraphNavigationStore().restoreState(o);const n=o.at(-1);if(n){const s=app$1.graph.subgraphs.get(n);s&&app$1.canvas.setGraph(s)}else app$1.canvas.setGraph(app$1.graph)}}updateModified(){api.dispatchCustomEvent("graphChanged",this.activeState);const o=useWorkflowStore().getWorkflowByPath(this.workflow.path);if(o&&(o.isModified=!ChangeTracker.graphEqual(this.initialState,this.activeState),logger.getLevel()<=logger.levels.DEBUG&&o.isModified)){const n=ChangeTracker.graphDiff(this.initialState,this.activeState);logger.debug("Graph diff:",n)}}checkState(){if(!app$1.graph||this.changeCount)return;const o=clone(app$1.graph.serialize());if(!this.activeState){this.activeState=o;return}ChangeTracker.graphEqual(this.activeState,o)||(this.undoQueue.push(this.activeState),this.undoQueue.length>ChangeTracker.MAX_HISTORY&&this.undoQueue.shift(),logger.debug("Diff detected. Undo queue length:",this.undoQueue.length),this.activeState=o,this.redoQueue.length=0,this.updateModified())}async updateState(o,n){const s=o.pop();if(s){n.push(this.activeState),this._restoringState=!0;try{await app$1.loadGraphData(s,!1,!1,this.workflow,{showMissingModelsDialog:!1,showMissingNodesDialog:!1,checkForRerouteMigration:!1}),this.activeState=s,this.updateModified()}finally{this._restoringState=!1}}}async undo(){await this.updateState(this.undoQueue,this.redoQueue),logger.debug("Undo. Undo queue length:",this.undoQueue.length,"Redo queue length:",this.redoQueue.length)}async redo(){await this.updateState(this.redoQueue,this.undoQueue),logger.debug("Redo. Undo queue length:",this.undoQueue.length,"Redo queue length:",this.redoQueue.length)}async undoRedo(o){if((o.ctrlKey||o.metaKey)&&!o.altKey){const n=o.key.toUpperCase();if(n==="Y"&&!o.shiftKey||n=="Z"&&o.shiftKey)return await this.redo(),!0;if(n==="Z"&&!o.shiftKey)return await this.undo(),!0}}beforeChange(){this.changeCount++}afterChange(){--this.changeCount||this.checkState()}static init(){const o=p(()=>useWorkflowStore().activeWorkflow?.changeTracker,"getCurrentChangeTracker"),n=p(()=>o()?.checkState(),"checkState");let s=!1;window.addEventListener("keydown",u=>{if(u.repeat||app$1.constructor.maskeditor_is_opended?.())return;const f=document.activeElement;requestAnimationFrame(async()=>{let _=null;if(!app$1.ui.autoQueueEnabled||app$1.ui.autoQueueMode==="instant"){if(f?.tagName==="INPUT"||f&&"type"in f&&f.type==="textarea")return;_=f}if(s=u.key==="Control"||u.key==="Shift"||u.key==="Alt"||u.key==="Meta",s)return;const y=o();y&&(await y.undoRedo(u)||ChangeTracker.bindInput(_)||(logger.debug("checkState on keydown"),y.checkState()))})},!0),window.addEventListener("keyup",()=>{s&&(s=!1,logger.debug("checkState on keyup"),n())}),window.addEventListener("mouseup",()=>{logger.debug("checkState on mouseup"),n()}),api.addEventListener("promptQueued",()=>{logger.debug("checkState on promptQueued"),n()}),api.addEventListener("graphCleared",()=>{logger.debug("checkState on graphCleared"),n()});const a=LGraphCanvas.prototype.processMouseUp;LGraphCanvas.prototype.processMouseUp=function(u){const m=a.apply(this,[u]);return logger.debug("checkState on processMouseUp"),n(),m};const r=LGraphCanvas.prototype.prompt;LGraphCanvas.prototype.prompt=function(u,m,f,_){const y=p(b=>{f(b),n()},"extendedCallback");return logger.debug("checkState on prompt"),r.apply(this,[u,m,y,_])};const l=LiteGraph.ContextMenu.prototype.close;LiteGraph.ContextMenu.prototype.close=function(u){const m=l.apply(this,[u]);return logger.debug("checkState on contextMenuClose"),n(),m},document.addEventListener("litegraph:canvas",u=>{const m=u.detail;m.subType==="before-change"?o()?.beforeChange():m.subType==="after-change"&&o()?.afterChange()}),api.addEventListener("executed",u=>{const m=u.detail,_=useExecutionStore().queuedPrompts[m.prompt_id]?.workflow?.changeTracker;if(!_)return;_.nodeOutputs??={};const y=_.nodeOutputs,b=y[m.node];if(m.merge&&b)for(const w in m.output??{}){const k=b[w];k instanceof Array?b[w]=k.concat(m.output[w]):b[w]=m.output[w]}else y[m.node]=m.output})}static bindInput(o){if(!o||o.tagName==="CANVAS"||o.tagName==="BODY")return!1;for(const n of["change","input","blur"]){const s=o;if(`on${n}`in s){const a=p(()=>{useWorkflowStore().activeWorkflow?.changeTracker?.checkState?.(),s.removeEventListener(n,a)},"listener");return s.addEventListener(n,a),!0}}return!1}static graphEqual(o,n){if(o===n)return!0;if(typeof o=="object"&&o&&typeof n=="object"&&n){if(!toolkit.isEqualWith(o.nodes,n.nodes,(s,a)=>{if(Array.isArray(s)&&Array.isArray(a))return toolkit.isEqual(new Set(s),new Set(a))})||!toolkit.isEqual(toolkit.omit(o.extra??{},["ds"]),toolkit.omit(n.extra??{},["ds"])))return!1;for(const s of["links","floatingLinks","reroutes","groups","definitions","subgraphs"])if(!toolkit.isEqual(o[s],n[s]))return!1;return!0}return!1}static graphDiff(o,n){function s(a){return{links:a.links,floatingLinks:a.floatingLinks,reroutes:a.reroutes,groups:a.groups,extra:a.extra,definitions:a.definitions,subgraphs:a.subgraphs,nodes:a.nodes.sort((r,l)=>typeof r.id=="number"&&typeof l.id=="number"?r.id-l.id:0)}}return p(s,"sortGraphNodes"),diff(s(o),s(n))}}window.comfyAPI=window.comfyAPI||{};window.comfyAPI.changeTracker=window.comfyAPI.changeTracker||{};window.comfyAPI.changeTracker.ChangeTracker=ChangeTracker;async function syncEntities(i,o,n,s,a=()=>!1){const r=(await api.listUserDataFullInfo(i)).map(l=>({...l,path:i?`${i}/${l.path}`:l.path}));for(const l of r){const u=o[l.path];if(!u)o[l.path]=n(l);else{if(a(u))continue;s(u,l)}}for(const[l,u]of Object.entries(o))a(u)||r.some(m=>m.path===l)||delete o[l]}p(syncEntities,"syncEntities");class UserFile{static{p(this,"UserFile")}constructor(o,n,s){this.path=o,this.lastModified=n,this.size=s;const a=getPathDetails(o);this.path=o,this.directory=a.directory,this.fullFilename=a.fullFilename,this.filename=a.filename,this.suffix=a.suffix}directory;fullFilename;filename;suffix;isLoading=!1;content=null;originalContent=null;updatePath(o){const n=getPathDetails(o);this.path=o,this.directory=n.directory,this.fullFilename=n.fullFilename,this.filename=n.filename,this.suffix=n.suffix}static createTemporary(o){return new UserFile(o,Date.now(),-1)}get isTemporary(){return this.size===-1}get isPersisted(){return!this.isTemporary}get key(){return this.path}get isLoaded(){return this.content!==null}get isModified(){return this.content!==this.originalContent}async load({force:o=!1}={}){if(this.isTemporary||!o&&this.isLoaded)return this;this.isLoading=!0;const n=await api.getUserData(this.path);if(n.status!==200)throw new Error(`Failed to load file '${this.path}': ${n.status} ${n.statusText}`);return this.content=await n.text(),this.originalContent=this.content,this.isLoading=!1,this}unload(){this.content=null,this.originalContent=null,this.isLoading=!1}async saveAs(o){const n=this.isTemporary?this:UserFile.createTemporary(o);return n.content=this.content,await n.save(),n}async save({force:o=!1}={}){if(this.isPersisted&&!this.isModified&&!o)return this;const s=await(await api.storeUserData(this.path,this.content,{overwrite:this.isPersisted,throwOnError:!0,full_info:!0})).json();return typeof s=="object"&&(this.lastModified=s.modified,this.size=s.size),this.originalContent=this.content,this}async delete(){if(this.isTemporary)return;const o=await api.deleteUserData(this.path);if(o.status!==204)throw new Error(`Failed to delete file '${this.path}': ${o.status} ${o.statusText}`)}async rename(o){if(this.isTemporary)return this.updatePath(o),this;const n=await api.moveUserData(this.path,o);if(n.status!==200)throw new Error(`Failed to rename file '${this.path}': ${n.status} ${n.statusText}`);this.updatePath(o);const s=await n.json();return typeof s=="object"&&(this.lastModified=s.modified,this.size=s.size),this}}class ComfyWorkflow extends UserFile{static{p(this,"ComfyWorkflow")}static basePath="workflows/";tintCanvasBg;changeTracker=null;_isModified=!1;constructor(o){super(o.path,o.modified,o.size)}get key(){return this.path.substring(ComfyWorkflow.basePath.length)}get activeState(){return this.changeTracker?.activeState??null}get initialState(){return this.changeTracker?.initialState??null}get isLoaded(){return this.changeTracker!==null}get isModified(){return this._isModified}set isModified(o){this._isModified=o}async load({force:o=!1}={}){if(await super.load({force:o}),!o&&this.isLoaded)return this;if(!this.originalContent)throw new Error("[ASSERT] Workflow content should be loaded");return this.changeTracker=markRaw(new ChangeTracker(this,JSON.parse(this.originalContent))),this}unload(){this.changeTracker=null,super.unload()}async save(){this.content=JSON.stringify(this.activeState);const o=await super.save({force:!0});return this.changeTracker?.reset(),this.isModified=!1,o}async saveAs(o){return this.content=JSON.stringify(this.activeState),await super.saveAs(o)}async promptSave(){return await useDialogService().prompt({title:t("workflowService.saveWorkflow"),message:t("workflowService.enterFilename")+":",defaultValue:this.filename})}}const useWorkflowStore=defineStore("workflow",()=>{const i=ref([]),o=32,n=p(K=>{delete l.value[K.path];const ne=f.value.indexOf(K.path);return ne!==-1&&(f.value=f.value.filter(de=>de!==K.path)),ne},"detachWorkflow"),s=p((K,ne=-1)=>{l.value[K.path]=K,ne!==-1&&f.value.splice(ne,0,K.path)},"attachWorkflow"),a=ref(null),r=p(K=>a.value?.path===K.path,"isActive"),l=ref({}),u=computed(()=>Object.values(l.value)),m=p(K=>l.value[K]??null,"getWorkflowByPath"),f=ref([]),_=computed(()=>new Set(f.value)),y=computed(()=>f.value.map(K=>l.value[K])),b=p((K,ne)=>{const de=f.value[K];f.value.splice(K,1),f.value.splice(ne,0,de)},"reorderWorkflows"),w=p(K=>_.value.has(K.path),"isOpen"),k=p(K=>{const{left:ne=[],right:de=[]}=K;if(!ne.length&&!de.length)return;const ve=p(_e=>typeof _e=="string"&&_e in l.value,"isValidPath");f.value=toolkit.union(ne,f.value,de).filter(ve)},"openWorkflowsInBackground"),S=p(async K=>{if(r(K))return K;f.value.includes(K.path)||f.value.push(K.path);const ne=await K.load();a.value=ne,app$1.canvas.bg_tint=ne.tintCanvasBg;const de=i.value.indexOf(K.path);return de!==-1&&i.value.splice(de,1),i.value.push(K.path),i.value.length>o&&i.value.shift(),useCanvasStore().linearMode=!!ne.activeState.extra?.linearMode,ne},"openWorkflow"),C=p(K=>{const{directory:ne,filename:de,suffix:ve}=getPathDetails(K);let _e=2,oe=K;for(;l.value[oe];)oe=`${ne}/${de} (${_e}).${ve}`,_e++;return oe},"getUnconflictedPath"),I=p((K,ne)=>{const de=generateUUID(),ve=JSON.parse(JSON.stringify(K.activeState));ve.id=de;const _e=new K.constructor({path:ne,modified:Date.now(),size:-1});return _e.originalContent=_e.content=JSON.stringify(ve),l.value[_e.path]=_e,_e},"saveAs"),T=p((K,ne)=>{const de=C(ComfyWorkflow.basePath+(K??"Unsaved Workflow.json")),ve=u.value.find(oe=>oe.fullFilename==K);if(K&&ne&&ve?.changeTracker&&!ve.directory.startsWith(ComfyWorkflow.basePath.slice(0,-1)))return ve.changeTracker.reset(ne),ve;const _e=new ComfyWorkflow({path:de,modified:Date.now(),size:-1});return _e.originalContent=_e.content=ne?JSON.stringify(ne):defaultGraphJSON,l.value[_e.path]=_e,_e},"createTemporary"),E=p(async K=>{f.value=f.value.filter(ne=>ne!==K.path),K.isTemporary?($(K.key),delete l.value[K.path]):K.unload()},"closeWorkflow"),N=p(K=>{const ne=f.value.indexOf(a.value?.path??"");if(ne!==-1){const de=y.value.length,ve=(ne+K+de)%de;return y.value[ve]??null}return null},"openedWorkflowIndexShift"),L=p(()=>{const K=a.value?.path,ne=[];for(let de=i.value.length-1;de>=0;de--){const ve=i.value[de];if(ve!==K&&_.value.has(ve)){ne.unshift(ve);const _e=l.value[ve];if(_e)return i.value=ne,_e}}return i.value=[],null},"getMostRecentWorkflow"),A=computed(()=>Array.from(u.value).filter(K=>K.isPersisted&&!K.path.startsWith("subgraphs/"))),D=p(async(K="")=>{await syncEntities(K?"workflows/"+K:"workflows",l.value,ne=>new ComfyWorkflow({path:ne.path,modified:ne.modified,size:ne.size}),(ne,de)=>{ne.lastModified=de.modified,ne.size=de.size,ne.unload()},ne=>ne.isTemporary)},"syncWorkflows"),O=useWorkflowBookmarkStore(),M=computed(()=>u.value.filter(K=>O.isBookmarked(K.path))),P=computed(()=>u.value.filter(K=>K.isModified)),R=ref(!1),{moveWorkflowThumbnail:V,clearThumbnail:$}=useWorkflowThumbnail(),F=p(async(K,ne)=>{R.value=!0;try{const de=K.path,ve=K.key,_e=O.isBookmarked(de),oe=n(K);try{await K.rename(ne)}finally{s(K,oe)}const se=K.key;V(ve,se),_e&&(await O.setBookmarked(de,!1),await O.setBookmarked(ne,!0))}finally{R.value=!1}},"renameWorkflow"),j=p(async K=>{R.value=!0;try{await K.delete(),O.isBookmarked(K.path)&&await O.setBookmarked(K.path,!1),$(K.key),delete l.value[K.path]}finally{R.value=!1}},"deleteWorkflow"),U=p(async K=>{R.value=!0;try{const ne=n(K);try{await K.save()}finally{s(K,ne)}}finally{R.value=!1}},"saveWorkflow"),G=ref(!1),H=shallowRef(),W=p(()=>{const K=app$1.canvas?.subgraph;H.value=K?markRaw(K):void 0,app$1.canvas&&(G.value=isSubgraph(K))},"updateActiveGraph"),X=p((K,ne)=>{const de=ne.getNodeById(K);if(de?.isSubgraphNode())return de.subgraph},"subgraphNodeIdToSubgraph"),Q=p((K,ne,de=[])=>{const ve=ne.shift();if(ve===void 0)return de;const _e=X(ve,K);if(_e===void 0)throw new Error("Subgraph not found");return de.push(_e),Q(_e,ne,de)},"getSubgraphsFromInstanceIds"),q=p(K=>{const ne=H.value;if(K.includes(":")){if(!ne)return}else return ne?void 0:K;const de=K.split(":"),{graph:ve}=app$1;if(Q(ve,de).at(-1)===ne)return de.at(-1)},"executionIdToCurrentId");return watch(a,W),{activeWorkflow:a,attachWorkflow:s,isActive:r,openWorkflows:y,openedWorkflowIndexShift:N,getMostRecentWorkflow:L,openWorkflow:S,openWorkflowsInBackground:k,isOpen:w,isBusy:R,closeWorkflow:E,createTemporary:T,renameWorkflow:F,deleteWorkflow:j,saveAs:I,saveWorkflow:U,reorderWorkflows:b,workflows:u,bookmarkedWorkflows:M,persistedWorkflows:A,modifiedWorkflows:P,getWorkflowByPath:m,syncWorkflows:D,isSubgraphActive:G,activeSubgraph:H,updateActiveGraph:W,executionIdToCurrentId:q,nodeIdToNodeLocatorId:p((K,ne)=>{const de=ne??H.value;return de?createNodeLocatorId(de.id,K):String(K)},"nodeIdToNodeLocatorId"),nodeToNodeLocatorId:p(K=>isSubgraph(K.graph)?createNodeLocatorId(K.graph.id,K.id):String(K.id),"nodeToNodeLocatorId"),nodeExecutionIdToNodeLocatorId:p(K=>{if(!K.includes(":"))return K;const ne=parseNodeExecutionId(K);if(!ne||ne.length===0)return null;const de=ne[ne.length-1],ve=ne.slice(0,-1);if(ve.length===0)return String(de);try{const _e=Q(app$1.graph,ve.map(se=>String(se))),oe=_e[_e.length-1];return createNodeLocatorId(oe.id,de)}catch{return null}},"nodeExecutionIdToNodeLocatorId"),nodeLocatorIdToNodeId:p(K=>parseNodeLocatorId(K)?.localNodeId??null,"nodeLocatorIdToNodeId"),nodeLocatorIdToNodeExecutionId:p((K,ne)=>{const de=parseNodeLocatorId(K);if(!de)return null;const{subgraphUuid:ve,localNodeId:_e}=de;if(!ve)return String(_e);const oe=p((he,be,Se=[])=>{if(isSubgraph(he)&&he.id===be)return Se;for(const me of he._nodes)if(me.isSubgraphNode()&&me.subgraph){const fe=oe(me.subgraph,be,[...Se,me.id]);if(fe)return fe}return null},"findSubgraphPath"),se=oe(app$1.graph,ve);return!se||ne&&!se.some((he,be)=>{const Se=Q(app$1.graph,se.slice(0,be+1).map(me=>String(me)));return Se[Se.length-1]===ne})?null:createNodeExecutionId([...se,_e])},"nodeLocatorIdToNodeExecutionId")}}),useWorkflowBookmarkStore=defineStore("workflowBookmark",()=>{const i=ref(new Set),o=p(l=>i.value.has(l),"isBookmarked"),n=p(async()=>{const l=await api.getUserData("workflows/.index.json");if(l.status===200){const u=await l.json();i.value=new Set(u?.favorites??[])}},"loadBookmarks"),s=p(async()=>{await api.storeUserData("workflows/.index.json",{favorites:Array.from(i.value)})},"saveBookmarks"),a=p(async(l,u)=>{i.value.has(l)!==u&&(u?i.value.add(l):i.value.delete(l),await s())},"setBookmarked");return{isBookmarked:o,loadBookmarks:n,saveBookmarks:s,setBookmarked:a,toggleBookmarked:p(async l=>{await a(l,!i.value.has(l))},"toggleBookmarked")}}),DEFAULT_MAX_SIZE=50;function useCachedRequest(i,o={}){const{maxSize:n=DEFAULT_MAX_SIZE,cacheKeyFn:s=paramsToCacheKey}=o,a=new QuickLRU({maxSize:n}),r=new Map,l=new Map,u=p(async(b,w)=>{try{const k=new AbortController;l.set(w,k);const S=i(b,k.signal);r.set(w,S);const C=await S;return a.set(w,C),C}catch{return a.set(w,null),null}finally{r.delete(w),l.delete(w)}},"executeAndCacheCall"),m=p(async b=>{try{return await b}catch(w){return console.error("Error in pending request:",w),null}},"handlePendingRequest"),f=p(()=>{for(const b of l.values())b.abort()},"abortAllRequests");return{call:p(async b=>{const w=s(b),k=a.get(w);if(k!==void 0)return k;const S=r.get(w);return S?m(S):u(b,w)},"call"),cancel:p(()=>{f(),l.clear(),r.clear()},"cancel"),clear:p(()=>a.clear(),"clear")}}p(useCachedRequest,"useCachedRequest");const API_BASE_URL="https://api.comfy.org",registryApiClient=axios.create({baseURL:API_BASE_URL,headers:{"Content-Type":"application/json"},paramsSerializer:{indexes:null}}),useComfyRegistryService=p(()=>{const i=ref(!1),o=ref(null),n=p((S,C,I)=>{if(!axios.isAxiosError(S))return S instanceof Error?`${C}: ${S.message}`:`${C}: Unknown error occurred`;const T=S;if(T.response){const{status:E,data:N}=T.response;if(I&&I[E])return I[E];switch(E){case 400:return`Bad request: ${N?.message||"Invalid input"}`;case 401:return"Unauthorized: Authentication required";case 403:return`Forbidden: ${N?.message||"Access denied"}`;case 404:return`Not found: ${N?.message||"Resource not found"}`;case 409:return`Conflict: ${N?.message||"Resource conflict"}`;case 500:return`Server error: ${N?.message||"Internal server error"}`;default:return`${C}: ${N?.message||T.message}`}}return`${C}: ${T.message}`},"handleApiError"),s=p(async(S,C,I)=>{i.value=!0,o.value=null;try{return(await S()).data}catch(T){return isAbortError(T)||(o.value=n(T,C,I)),null}finally{i.value=!1}},"executeApiRequest");return{isLoading:i,error:o,listAllPacks:p(async(S,C)=>{const I="/nodes";return s(()=>registryApiClient.get(I,{params:S,signal:C}),"Failed to list packs")},"listAllPacks"),search:p(async(S,C)=>{const I="/nodes/search";return s(()=>registryApiClient.get(I,{params:S,signal:C}),"Failed to perform search")},"search"),getPackById:p(async(S,C)=>{const I=`/nodes/${S}`,T="Failed to get pack",E={404:`Pack not found: The pack with ID ${S} does not exist`};return s(()=>registryApiClient.get(I,{signal:C}),T,E)},"getPackById"),getPackVersions:p(async(S,C,I)=>{const T=`/nodes/${S}/versions`,E="Failed to get pack versions",N={403:"This pack has been banned and its versions are not available",404:`Pack not found: Pack with ID ${S} does not exist`};return s(()=>registryApiClient.get(T,{params:C,signal:I}),E,N)},"getPackVersions"),getPackByVersion:p(async(S,C,I)=>{const T=`/nodes/${S}/versions/${C}`,E="Failed to get pack version",N={403:"This pack has been banned and its versions are not available",404:`Pack not found: Pack with ID ${S} does not exist`};return s(()=>registryApiClient.get(T,{signal:I}),E,N)},"getPackByVersion"),getPublisherById:p(async(S,C)=>{const I=`/publishers/${S}`,T="Failed to get publisher",E={404:`Publisher not found: The publisher with ID ${S} does not exist`};return s(()=>registryApiClient.get(I,{signal:C}),T,E)},"getPublisherById"),listPacksForPublisher:p(async(S,C,I)=>{const T=C?{include_banned:!0}:void 0,E=`/publishers/${S}/nodes`,N="Failed to list packs for publisher",L={400:"Bad request: Invalid input data",404:`Publisher not found: The publisher with ID ${S} does not exist`};return s(()=>registryApiClient.get(E,{params:T,signal:I}),N,L)},"listPacksForPublisher"),getNodeDefs:p(async(S,C)=>{const{packId:I,version:T,...E}=S;if(!I||!T)return null;const N=`/nodes/${I}/versions/${T}/comfy-nodes`;return s(()=>registryApiClient.get(N,{params:E,signal:C}),"Failed to get node definitions",{403:"This pack has been banned and its definition is not available",404:"The requested node, version, or comfy node does not exist"})},"getNodeDefs"),postPackReview:p(async(S,C,I)=>{const T=`/nodes/${S}/reviews`,E={star:C},N="Failed to add review",L={400:"Bad request: Invalid review",404:`Pack not found: Pack with ID ${S} does not exist`};return s(()=>registryApiClient.post(T,null,{params:E,signal:I}),N,L)},"postPackReview"),inferPackFromNodeName:p(async(S,C)=>{const I=`/comfy-nodes/${S}/node`,T="Failed to infer pack from comfy node name",E={404:`Comfy node not found: The node with name ${S} does not exist in the registry`};return s(()=>registryApiClient.get(I,{signal:C}),T,E)},"inferPackFromNodeName"),getBulkNodeVersions:p(async(S,C)=>{const I="/bulk/nodes/versions",T="Failed to get bulk node versions",E={400:"Bad request: Invalid node version identifiers provided"},N={node_versions:S};return s(()=>registryApiClient.post(I,N,{signal:C}),T,E)},"getBulkNodeVersions")}},"useComfyRegistryService"),PACK_LIST_CACHE_SIZE=20,PACK_BY_ID_CACHE_SIZE=64,isNodePack=p(i=>i!==void 0&&"id"in i,"isNodePack"),useComfyRegistryStore=defineStore("comfyRegistry",()=>{const i=useComfyRegistryService();let o=null;const n=new QuickLRU({maxSize:PACK_BY_ID_CACHE_SIZE}),s=useCachedRequest(i.listAllPacks,{maxSize:PACK_LIST_CACHE_SIZE}),a=useCachedRequest(async y=>y?i.getPackById(y):null,{maxSize:PACK_BY_ID_CACHE_SIZE}),r=p(async y=>{const[b,w]=partition(y,S=>n.has(S)),k=b.map(S=>n.get(S)).filter(isNodePack);if(w.length){o=new AbortController;const S=await i.listAllPacks({node_id:w.filter(I=>I!==void 0)},o.signal),{nodes:C=[]}=S??{};C.forEach(I=>{I?.id&&(n.set(I.id,I),k.push(I))})}return k},"getPacksByIds"),l=useCachedRequest(i.getNodeDefs,{maxSize:PACK_BY_ID_CACHE_SIZE}),u=useCachedRequest(i.search,{maxSize:PACK_LIST_CACHE_SIZE}),m=useCachedRequest(i.inferPackFromNodeName,{maxSize:PACK_BY_ID_CACHE_SIZE});return{listAllPacks:s,getPackById:a,getPacksByIds:{call:r,cancel:p(()=>o?.abort(),"cancel")},getNodeDefs:l,search:u,inferPackFromNodeName:m,clearCache:p(()=>{l.clear(),s.clear(),a.clear(),m.clear()},"clearCache"),cancelRequests:p(()=>{l.cancel(),s.cancel(),a.cancel(),m.cancel(),o?.abort()},"cancelRequests"),isLoading:i.isLoading,error:i.error}}),useNodePacks=p((i,o={})=>{const{immediate:n=!1}=o,{getPacksByIds:s}=useComfyRegistryStore(),a=p(()=>s.call(get$1(i).filter(Boolean)),"fetchPacks"),{isReady:r,isLoading:l,error:u,execute:m,state:f}=useAsyncState(a,[],{immediate:n});return{error:u,isLoading:l,isReady:r,nodePacks:f,startFetch:m,cleanup:p(()=>{s.cancel(),r.value=!1,l.value=!1},"cleanup")}},"useNodePacks"),CORE_NODES_PACK_NAME="comfy-core",useWorkflowPacks=p((i={})=>{const o=useNodeDefStore(),n=useSystemStatsStore(),{inferPackFromNodeName:s}=useComfyRegistryStore(),a=ref([]),r=p(N=>{if(typeof N.properties?.cnr_id=="string")return N.properties.cnr_id;if(typeof N.properties?.aux_id=="string")return N.properties.aux_id},"getWorkflowNodePackId"),l=p(N=>N.replace(/^v/,"").trim(),"cleanVersionString"),u=p(async N=>{const L=N.type;if(o.nodeDefsByName[L]?.nodeSource.type==="core")return n.systemStats||await n.refetchSystemStats(),{id:CORE_NODES_PACK_NAME,version:n.systemStats?.system?.comfyui_version??"nightly"};const D=await s.call(L);if(D)return{id:D.id,version:D.latest_version?.version??"nightly"}},"inferPack"),m=p(async N=>{const L=r(N);if(!L)return u(N);if(L===CORE_NODES_PACK_NAME)return;const A=typeof N.properties.ver=="string"?l(N.properties.ver):void 0;return{id:L,version:A}},"workflowNodeToPack"),f=p(async()=>{if(!app$1.graph)return[];const N=collectAllNodes(app$1.graph);if(!N.length)return a.value=[],[];const L=await Promise.all(N.map(m));a.value=L.filter(A=>A!==void 0)},"getWorkflowPacks"),_=p(N=>N.reduce((L,A)=>(A?.id&&L.add(A.id),L),new Set),"packsToUniqueIds"),y=computed(()=>Array.from(_(a.value))),{startFetch:b,cleanup:w,error:k,isLoading:S,nodePacks:C,isReady:I}=useNodePacks(y,i),T=p(N=>y.value.includes(N),"isIdInWorkflow"),E=p(N=>N.filter(L=>!!L.id&&T(L.id)),"filterWorkflowPack");return onUnmounted(()=>{w()}),{error:k,isLoading:S,isReady:I,workflowPacks:C,startFetchWorkflowPacks:p(async()=>{await f(),await b()},"startFetchWorkflowPacks"),filterWorkflowPack:E}},"useWorkflowPacks"),LOGS_MESSAGE_TYPE="logs",MANAGER_WS_TASK_DONE_NAME$1="cm-task-completed",MANAGER_WS_TASK_STARTED_NAME$1="cm-task-started",useServerLogs=p((i={})=>{const{ui_id:o,immediate:n=!1,messageFilter:s=p(C=>!!C.trim(),"messageFilter")}=i,a=ref([]),r=ref(!o);let l=null,u=null,m=null;const f=p(C=>C?.type===LOGS_MESSAGE_TYPE&&C.detail?.entries?.length>0,"isValidLogEvent"),_=p(C=>C.detail.entries.map(I=>I.m).filter(s),"parseLogMessage"),y=p(C=>{if(r.value&&f(C)){const I=_(C);I.length>0&&a.value.push(...I)}},"handleLogMessage"),b=p(C=>{o&&C?.detail?.ui_id===o&&(r.value=!0)},"handleTaskStarted"),w=p(C=>{o&&C?.detail?.ui_id===o&&(r.value=!1)},"handleTaskDone"),k=p(async()=>{await api.subscribeLogs(!0),l=useEventListener(api,LOGS_MESSAGE_TYPE,y),o&&(m=useEventListener(api,MANAGER_WS_TASK_STARTED_NAME$1,b),u=useEventListener(api,MANAGER_WS_TASK_DONE_NAME$1,w))},"start"),S=p(async()=>{l?.(),m?.(),u?.(),l=null,m=null,u=null,await api.subscribeLogs(!1)},"stopListening");return n&&k(),onUnmounted(async()=>{await S(),a.value=[]}),{logs:a,startListening:k,stopListening:S}},"useServerLogs"),MANAGER_WS_TASK_DONE_NAME="cm-task-completed",MANAGER_WS_TASK_STARTED_NAME="cm-task-started",useManagerQueue=p((i,o,n)=>{const{showManagerProgressDialog:s}=useDialogService(),a=ref(64),r=ref(!1),l=ref(!1),u=computed(()=>o.value.running_queue.length+o.value.pending_queue.length),m=p(()=>{l.value=u.value>0},"updateProcessingState"),f=computed(()=>u.value===0),_=computed(()=>Object.keys(i.value).length),y=p(E=>E.client_id===app$1.api.clientId,"isTaskFromThisClient"),b=p(E=>E.client_id===app$1.api.clientId,"isHistoryTaskFromThisClient"),w=p(E=>E.filter(y),"filterQueueByClientId"),k=p(E=>pickBy(E,b),"filterHistoryByClientId"),S=p(E=>{o.value.running_queue=w(E.running_queue),o.value.pending_queue=w(E.pending_queue),i.value=k(E.history),E.installed_packs&&(n.value=normalizePackKeys(E.installed_packs)),m()},"updateTaskState"),C=useEventListener(app$1.api,MANAGER_WS_TASK_DONE_NAME,E=>{E?.type===MANAGER_WS_TASK_DONE_NAME&&E.detail?.state&&(S(E.detail.state),f.value&&setTimeout(()=>{f.value&&s()},1e3))}),I=useEventListener(app$1.api,MANAGER_WS_TASK_STARTED_NAME,E=>{E?.type===MANAGER_WS_TASK_STARTED_NAME&&E.detail?.state&&(S(E.detail.state),s())});return{isLoading:r,isProcessing:l,maxHistoryItems:a,allTasksDone:f,historyCount:_,currentQueueLength:u,updateTaskState:S,cleanup:p(()=>{C(),I(),l.value=!1,r.value=!1},"cleanup")}},"useManagerQueue"),isMergedNodePack=p(i=>"comfy_nodes"in i,"isMergedNodePack"),IsInstallingKey=Symbol("isInstalling");var ManagerTab=(i=>(i.All="all",i.Installed="installed",i.Workflow="workflow",i.Missing="missing",i.UpdateAvailable="updateAvailable",i))(ManagerTab||{}),SortableAlgoliaField=(i=>(i.Downloads="total_install",i.Created="create_time",i.Updated="update_time",i.Publisher="publisher_id",i.Name="name",i))(SortableAlgoliaField||{}),ManagerUIState=(i=>(i.DISABLED="disabled",i.LEGACY_UI="legacy",i.NEW_UI="new",i))(ManagerUIState||{});function useManagerState(){const i=useSystemStatsStore(),{systemStats:o,isInitialized:n}=storeToRefs(i),s=readonly(computed(()=>{if(!n.value)return"disabled";const _=api.getClientFeatureFlags().supports_manager_v4_ui??!1,y=api.getServerFeature("extension.manager.supports_v4");return o.value?.system?.argv?.includes("--enable-manager")?o.value?.system?.argv?.includes("--enable-manager-legacy-ui")?"legacy":_&&y===!0?"new":y===!0&&!_||y===!1?"legacy":y===void 0?"new":"disabled":"disabled"})),a=readonly(computed(()=>s.value!=="disabled")),r=readonly(computed(()=>s.value==="new")),l=readonly(computed(()=>s.value==="legacy")),u=readonly(computed(()=>r.value)),m=readonly(computed(()=>a.value));return{managerUIState:s,isManagerEnabled:a,isNewManagerUI:r,isLegacyManagerUI:l,shouldShowInstallButton:u,shouldShowManagerButtons:m,openManager:p(async _=>{const y=s.value,b=useDialogService(),w=useCommandStore();switch(y){case"disabled":b.showSettingsDialog("extension");break;case"legacy":{const k=_?.legacyCommand||"Comfy.Manager.Menu.ToggleVisibility";try{await w.execute(k)}catch{_?.showToastOnLegacyError!==!1&&useToastStore().add({severity:"error",summary:t("g.error"),detail:t("manager.legacyMenuNotAvailable"),life:3e3}),_?.showToastOnLegacyError===!1&&b.showSettingsDialog("extension")}break}case"new":_?.isLegacyOnly?(useToastStore().add({severity:"error",summary:t("g.error"),detail:t("manager.legacyMenuNotAvailable"),life:3e3}),b.showManagerDialog({initialTab:ManagerTab.All})):b.showManagerDialog(_?.initialTab?{initialTab:_.initialTab}:void 0);break}},"openManager")}}p(useManagerState,"useManagerState");const useManagerState$1=Object.freeze(Object.defineProperty({__proto__:null,ManagerUIState,useManagerState},Symbol.toStringTag,{value:"Module"})),GENERIC_SECURITY_ERR_MSG="Forbidden: A security error has occurred. Please check the terminal logs",managerApiClient=axios.create({baseURL:api.apiURL("/v2/"),headers:{"Content-Type":"application/json"}}),useComfyManagerService=p(()=>{const i=ref(!1),o=ref(null),n=p(()=>useManagerState().isNewManagerUI.value,"isManagerServiceAvailable"),s=p((N,L,A)=>{if(isAbortError(N))return;let D;if(!axios.isAxiosError(N))D=`${L} failed: ${N instanceof Error?N.message:String(N)}`;else{const O=N,M=O.response?.status;M&&A?.[M]?D=A[M]:M===404?D="Could not connect to ComfyUI-Manager":D=O.response?.data?.message??`${L} failed with status ${M}`}o.value=D},"handleRequestError"),a=p(async(N,L)=>{const{errorContext:A,routeSpecificErrors:D,isQueueOperation:O}=L;if(!n())return o.value="Manager service is not available in current mode",null;i.value=!0,o.value=null;try{const M=await N();return O&&await r(),M.data}catch(M){return s(M,A,D),null}finally{i.value=!1}},"executeRequest"),r=p(async N=>a(()=>managerApiClient.get("manager/queue/start",{signal:N}),{errorContext:"Starting ComfyUI-Manager job queue",routeSpecificErrors:{201:"Created: ComfyUI-Manager job queue is already running"}}),"startQueue"),l=p(async(N,L)=>a(()=>managerApiClient.get("manager/queue/status",{params:N?{client_id:N}:void 0,signal:L}),{errorContext:"Getting ComfyUI-Manager queue status"}),"getQueueStatus"),u=p(async N=>a(()=>managerApiClient.get("customnode/installed",{signal:N}),{errorContext:"Fetching installed packs"}),"listInstalledPacks"),m=p(async N=>a(()=>managerApiClient.get("customnode/import_fail_info",{signal:N}),{errorContext:"Fetching import failure information"}),"getImportFailInfo"),f=p(async(N={},L)=>{const A="Fetching bulk import failure information";return!N.cnr_ids?.length&&!N.urls?.length?{}:a(()=>managerApiClient.post("customnode/import_fail_info_bulk",N,{signal:L}),{errorContext:A})},"getImportFailInfoBulk"),_=p(async(N,L,A,D)=>{const O={kind:N,params:L,ui_id:A||v4(),client_id:api.clientId??api.initialClientId??"unknown"},M=`Queueing ${O.kind} task`;return a(()=>managerApiClient.post("manager/queue/task",O,{signal:D}),{errorContext:M,routeSpecificErrors:{403:GENERIC_SECURITY_ERR_MSG,404:"Not Found: Task could not be queued"},isQueueOperation:!0})},"queueTask");return{isLoading:i,error:o,startQueue:r,getQueueStatus:l,getTaskHistory:p(async(N={},L)=>a(()=>managerApiClient.get("manager/queue/history",{params:N,signal:L}),{errorContext:"Getting ComfyUI-Manager task history"}),"getTaskHistory"),listInstalledPacks:u,getImportFailInfo:m,getImportFailInfoBulk:f,installPack:p(async(N,L,A)=>_("install",N,L,A),"installPack"),uninstallPack:p(async(N,L,A)=>_("uninstall",N,L,A),"uninstallPack"),enablePack:p(async(N,L,A)=>_("enable",N,L,A),"enablePack"),disablePack:p(async(N,L,A)=>_("disable",N,L,A),"disablePack"),updatePack:p(async(N,L,A)=>_("update",N,L,A),"updatePack"),updateAllPacks:p(async(N={},L,A)=>{const D="Updating all packs",O={403:"Forbidden: To use this action, a security_level of `middle or below` is required",401:"Unauthorized: ComfyUI-Manager job queue is busy"},M={mode:N.mode,client_id:api.clientId??api.initialClientId??"unknown",ui_id:L||v4()};return a(()=>managerApiClient.get("manager/queue/update_all",{params:M,signal:A}),{errorContext:D,routeSpecificErrors:O,isQueueOperation:!0})},"updateAllPacks"),rebootComfyUI:p(async N=>a(()=>managerApiClient.get("manager/reboot",{signal:N}),{errorContext:"Rebooting ComfyUI",routeSpecificErrors:{403:"Forbidden: Rebooting ComfyUI requires security_level of middle or below"}}),"rebootComfyUI"),isLegacyManagerUI:p(async N=>a(()=>managerApiClient.get("manager/is_legacy_manager_ui",{signal:N}),{errorContext:"Checking if user set Manager to use the legacy UI"}),"isLegacyManagerUI")}},"useComfyManagerService"),useComfyManagerStore=defineStore("comfyManager",()=>{const{t:i}=useI18n(),o=useComfyManagerService(),{showManagerProgressDialog:n}=useDialogService(),s=ref({}),a=ref(new Set),r=ref(new Set),l=ref(new Set),u=ref(new Set),m=ref(!0),f=ref([]),_=ref([]),y=ref([]),b=ref({}),w=ref([]),k=ref([]),S=ref({history:{},running_queue:[],pending_queue:[],installed_packs:{}}),C=ref(new Map),I=useManagerQueue(b,S,s);useEventListener(app$1.api,"cm-task-completed",Y=>{const ae=Y.detail?.ui_id;if(ae&&C.value.has(ae)){const re=C.value.get(ae);u.value.delete(re),C.value.delete(ae)}});const T=p(()=>{m.value=!0},"setStale"),E=p(()=>{const Y=[],ae=[];for(const re of f.value)k.value.includes(re.taskId)?ae.push(re):Y.push(re);_.value=Y,y.value=ae},"partitionTaskLogs"),N=p(()=>{const Y=[],ae=[];for(const re of Object.values(b.value))re.status?.status_str==="success"?Y.push(re.ui_id):ae.push(re.ui_id);w.value=Y,k.value=ae},"partitionTasks");whenever(b,()=>{N(),E()},{deep:!0});const L=p(Y=>Y.cnr_id||Y.aux_id,"getPackId"),A=p(Y=>!!Y&&l.value.has(Y),"isInstalledPackId"),D=p(Y=>!!Y&&A(Y)&&a.value.has(Y),"isEnabledPackId"),O=p(Y=>!!Y&&u.value.has(Y),"isInstallingPackId"),M=p(Y=>Y.reduce((ae,re)=>{const ue=re.cnr_id||re.aux_id;return ue&&ae.add(ue),ae},new Set),"packsToIdSet"),P=p(Y=>{const ae=new Set,re=new Set;for(const ue of Y){const K=L(ue);if(!K)continue;const{enabled:ne}=ue;ne===!0?ae.add(K):ne===!1&&re.add(K),ae.has(K)&&re.has(K)&&re.delete(K)}a.value=ae,r.value=re},"updateDisabledIds"),R=p(Y=>{l.value=M(Y)},"updateInstalledIds");watch(s,p(()=>{const Y=Object.values(s.value);P(Y),R(Y)},"onPacksChanged"),{deep:!0});const $=p(async()=>{const Y=await o.listInstalledPacks();Y&&(s.value=normalizePackKeys(Y)),m.value=!1},"refreshInstalledList");whenever(m,$,{immediate:!0});const F=p(async(Y,ae)=>{const re=v4(),{logs:ue}=useServerLogs({ui_id:re,immediate:!0});try{n(),I.isProcessing.value=!0,f.value.push({taskName:ae,taskId:re,logs:ue.value}),await Y(re)}catch(K){I.isProcessing.value=!1,b.value[re]={ui_id:re,client_id:api.clientId||"unknown",kind:"error",result:"failed",status:{status_str:"error",completed:!1,messages:[K instanceof Error?K.message:String(K)]},timestamp:new Date().toISOString()}}},"enqueueTaskWithLogs"),j=useCachedRequest(async(Y,ae)=>{if(!Y.id)return;let re=i("g.installing");if(l.value.has(Y.id)){const K=s.value[Y.id];K&&K.ver!==Y.selected_version?re=i("manager.changingVersion",{from:K.ver,to:Y.selected_version}):re=i("g.enabling")}u.value.add(Y.id),await F(p(K=>(C.value.set(K,Y.id),o.installPack(Y,K,ae)),"task"),`${re} ${Y.id}`)},{maxSize:1}),U=p(async(Y,ae)=>{j.clear(),j.cancel(),u.value.add(Y.id);const re={node_name:Y.id,is_unknown:!1};await F(p(K=>(C.value.set(K,Y.id),o.uninstallPack(re,K,ae)),"task"),i("manager.uninstalling",{id:Y.id}))},"uninstallPack"),G=useCachedRequest(async(Y,ae)=>{H.cancel();const re={node_name:Y.id,node_ver:Y.version};await F(p(K=>o.updatePack(re,K,ae),"task"),i("g.updating",{id:Y.id}))},{maxSize:1}),H=useCachedRequest(async(Y,ae)=>{await F(p(ue=>o.updateAllPacks(Y,ue,ae),"task"),i("manager.updatingAllPacks"))},{maxSize:1}),W=p(async(Y,ae)=>{const re={node_name:Y.id,is_unknown:!1};await F(p(K=>o.disablePack(re,K,ae),"task"),i("g.disabling",{id:Y.id}))},"disablePack"),X=p(async(Y,ae)=>{const re={cnr_id:Y.id};await F(p(K=>o.enablePack(re,K,ae),"task"),i("g.enabling",{id:Y.id}))},"enablePack"),Q=p(Y=>s.value[Y]?.ver,"getInstalledPackVersion"),q=p(()=>{f.value=[]},"clearLogs"),ee=p(()=>{f.value=[],b.value={},w.value=[],k.value=[],_.value=[],y.value=[],u.value.clear(),C.value.clear(),S.value={history:{},running_queue:[],pending_queue:[],installed_packs:{}}},"resetTaskState");return{isLoading:o.isLoading,error:o.error,taskLogs:f,clearLogs:q,resetTaskState:ee,setStale:T,installedPacks:s,installedPacksIds:l,isPackInstalled:A,isPackEnabled:D,isPackInstalling:O,getInstalledPackVersion:Q,refreshInstalledList:$,taskHistory:b,taskQueue:S,isProcessingTasks:I.isProcessing,succeededTasksIds:w,failedTasksIds:k,succeededTasksLogs:_,failedTasksLogs:y,managerQueue:I,installPack:j,uninstallPack:U,updatePack:G,updateAllPacks:H,disablePack:W,enablePack:X}}),useManagerProgressDialogStore=defineStore("managerProgressDialog",()=>{const i=ref(!1),o=ref(0);return{isExpanded:i,toggle:p(()=>{i.value=!i.value},"toggle"),collapse:p(()=>{i.value=!1},"collapse"),expand:p(()=>{i.value=!0},"expand"),setActiveTabIndex:p(u=>{o.value=u},"setActiveTabIndex"),getActiveTabIndex:p(()=>o.value,"getActiveTabIndex")}}),useMissingNodes=createSharedComposable(()=>{const i=useNodeDefStore(),o=useComfyManagerStore(),n=useWorkflowStore(),{workflowPacks:s,isLoading:a,error:r,startFetchWorkflowPacks:l}=useWorkflowPacks(),u=p(w=>w.filter(k=>!o.isPackInstalled(k.id)),"filterMissingPacks"),m=computed(()=>s.value.length?u(s.value):[]),f=p(w=>w==="comfy-core","isCorePack"),_=p(w=>{const k=w.properties?.cnr_id;if(k===void 0||!f(k))return!1;const S=w.type;return!!!i.nodeDefsByName[S]},"isMissingCoreNode"),y=computed(()=>{const w=collectAllNodes(app$1.graph,_);return groupBy(w,k=>String(k.properties?.ver||""))}),b=computed(()=>m.value.length>0||Object.keys(y.value).length>0);return watch(()=>n.activeWorkflow,async()=>{await l()},{immediate:!0}),{missingNodePacks:m,missingCoreNodes:y,hasMissingNodes:b,isLoading:a,error:r}}),_hoisted_1$12={class:"flex h-full w-full flex-col gap-4 p-4"},_hoisted_2$N={class:"m-0 text-sm leading-4 text-muted-foreground"},_hoisted_3$y={class:"comfy-missing-nodes flex flex-col max-h-[256px] rounded-lg py-2 scrollbar-custom bg-secondary-background"},_hoisted_4$r={class:"text-xs"},_hoisted_5$p={key:0,class:"text-xs"},_hoisted_6$g={class:"m-0 text-sm leading-4 text-muted-foreground"},_sfc_main$1c=defineComponent({__name:"MissingNodesContent",props:{missingNodeTypes:{}},setup(i){const o=i,{missingCoreNodes:n}=useMissingNodes(),s=computed(()=>{const a=new Set;return o.missingNodeTypes.filter(r=>{const l=typeof r=="object"?r.type:r;return a.has(l)?!1:(a.add(l),!0)}).map(r=>typeof r=="object"?{label:r.type,hint:r.hint,action:r.action}:{label:r})});return(a,r)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["flex w-[490px] flex-col border-t-1 border-border-default",unref(isCloud)?"border-b-1":""])},[createBaseVNode("div",_hoisted_1$12,[createBaseVNode("div",null,[createBaseVNode("p",_hoisted_2$N,toDisplayString(unref(isCloud)?a.$t("missingNodes.cloud.description"):a.$t("missingNodes.oss.description")),1)]),unref(isCloud)?createCommentVNode("",!0):(openBlock(),createBlock(_sfc_main$2F,{key:0,"missing-core-nodes":unref(n)},null,8,["missing-core-nodes"])),createBaseVNode("div",_hoisted_3$y,[(openBlock(!0),createElementBlock(Fragment,null,renderList(s.value,(l,u)=>(openBlock(),createElementBlock("div",{key:u,class:"flex min-h-8 items-center justify-between px-4 py-2 bg-secondary-background text-muted-foreground"},[createBaseVNode("span",_hoisted_4$r,toDisplayString(l.label),1),l.hint?(openBlock(),createElementBlock("span",_hoisted_5$p,toDisplayString(l.hint),1)):createCommentVNode("",!0)]))),128))]),createBaseVNode("div",null,[createBaseVNode("p",_hoisted_6$g,toDisplayString(unref(isCloud)?a.$t("missingNodes.cloud.replacementInstruction"):a.$t("missingNodes.oss.replacementInstruction")),1)])])],2))}}),_hoisted_1$11=["width","height"],_hoisted_2$M={"clip-path":"url(#clip0_776_9582)"},_hoisted_3$x=["fill"],_hoisted_4$q=["fill"],_hoisted_5$o=["fill"],_hoisted_6$f=["fill"],_hoisted_7$e=["fill"],_hoisted_8$b=["fill"],_hoisted_9$9=["fill"],_hoisted_10$8=["fill"],_sfc_main$1b=defineComponent({__name:"DotSpinner",props:{size:{default:24},duration:{default:"2s"}},setup(i){const o=useColorPaletteStore(),n=computed(()=>o.completedActivePalette.light_theme?"#2C2B30":"#D4D4D4");return(s,a)=>(openBlock(),createElementBlock("div",{class:"inline-flex items-center justify-center",style:normalizeStyle({width:s.size+"px",height:s.size+"px"})},[(openBlock(),createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",width:s.size,height:s.size,viewBox:"0 0 14 14",fill:"none",class:"animate-spin",style:normalizeStyle({animationDuration:s.duration})},[createBaseVNode("g",_hoisted_2$M,[createBaseVNode("path",{class:"dot-animation",style:{"animation-delay":"0s"},"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7 2.21053C7.61042 2.21053 8.10526 1.71568 8.10526 1.10526C8.10526 0.494843 7.61042 0 7 0C6.38958 0 5.89474 0.494843 5.89474 1.10526C5.89474 1.71568 6.38958 2.21053 7 2.21053Z",fill:n.value},null,8,_hoisted_3$x),createBaseVNode("path",{class:"dot-animation",style:{"animation-delay":"0.25s"},"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2.21053 7C2.21053 7.61042 1.71568 8.10526 1.10526 8.10526C0.494843 8.10526 0 7.61042 0 7C0 6.38958 0.494843 5.89474 1.10526 5.89474C1.71568 5.89474 2.21053 6.38958 2.21053 7Z",fill:n.value},null,8,_hoisted_4$q),createBaseVNode("path",{class:"dot-animation",style:{"animation-delay":"0.5s"},"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14 7C14 7.61042 13.5052 8.10526 12.8947 8.10526C12.2843 8.10526 11.7895 7.61042 11.7895 7C11.7895 6.38958 12.2843 5.89474 12.8947 5.89474C13.5052 5.89474 14 6.38958 14 7Z",fill:n.value},null,8,_hoisted_5$o),createBaseVNode("path",{class:"dot-animation",style:{"animation-delay":"0.75s"},"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8.10526 12.8947C8.10526 13.5052 7.61041 14 6.99999 14C6.38957 14 5.89473 13.5052 5.89473 12.8947C5.89473 12.2843 6.38957 11.7895 6.99999 11.7895C7.61041 11.7895 8.10526 12.2843 8.10526 12.8947Z",fill:n.value},null,8,_hoisted_6$f),createBaseVNode("path",{class:"dot-animation",style:{"animation-delay":"0.125s"},"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2.05039 3.61349C2.48203 4.04513 3.18184 4.04513 3.61347 3.61349C4.0451 3.18186 4.0451 2.48205 3.61347 2.05042C3.18184 1.61878 2.48203 1.61878 2.05039 2.05042C1.61876 2.48205 1.61876 3.18186 2.05039 3.61349Z",fill:n.value},null,8,_hoisted_7$e),createBaseVNode("path",{class:"dot-animation",style:{"animation-delay":"0.625s"},"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.9496 11.9496C11.518 12.3812 10.8182 12.3812 10.3865 11.9496C9.9549 11.5179 9.9549 10.8181 10.3865 10.3865C10.8182 9.95485 11.518 9.95485 11.9496 10.3865C12.3812 10.8181 12.3812 11.5179 11.9496 11.9496Z",fill:n.value},null,8,_hoisted_8$b),createBaseVNode("path",{class:"dot-animation",style:{"animation-delay":"0.875s"},"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2.05039 11.9496C2.48203 12.3812 3.18184 12.3812 3.61347 11.9496C4.0451 11.5179 4.0451 10.8181 3.61347 10.3865C3.18184 9.95485 2.48203 9.95485 2.05039 10.3865C1.61876 10.8181 1.61876 11.5179 2.05039 11.9496Z",fill:n.value},null,8,_hoisted_9$9),createBaseVNode("path",{class:"dot-animation",style:{"animation-delay":"0.375s"},"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.9496 3.61349C11.518 4.04513 10.8182 4.04513 10.3865 3.61349C9.9549 3.18186 9.9549 2.48205 10.3865 2.05042C10.8182 1.61878 11.518 1.61878 11.9496 2.05042C12.3812 2.48205 12.3812 3.18186 11.9496 3.61349Z",fill:n.value},null,8,_hoisted_10$8)]),a[0]||(a[0]=createBaseVNode("defs",null,[createBaseVNode("clipPath",{id:"clip0_776_9582"},[createBaseVNode("rect",{width:"14",height:"14",fill:"white"})])],-1))],12,_hoisted_1$11))],4))}}),DotSpinner=_export_sfc(_sfc_main$1b,[["__scopeId","data-v-ec0691c8"]]),useInstalledPacks=p((i={})=>{const o=useComfyManagerStore(),n=ref(!1),s=ref(""),a=computed(()=>Array.from(o.installedPacksIds)),{startFetch:r,cleanup:l,error:u,isLoading:m,nodePacks:f,isReady:_}=useNodePacks(a,i),y=p(k=>k.filter(S=>o.isPackInstalled(S.id)),"filterInstalledPack"),b=p(async()=>{if(!n.value){n.value=!0;try{o.installedPacksIds.size===0&&await o.refreshInstalledList(),await r()}finally{n.value=!1}}},"startFetchInstalled");whenever(a,async k=>{const S=k.sort().join(",");S!==s.value&&!n.value&&(s.value=S,await r())}),onUnmounted(()=>{l()});const w=computed(()=>{const k=[];for(const S of Object.values(o.installedPacks)){const C=S.cnr_id||S.aux_id;C&&k.push({id:C,version:S.ver??""})}return k});return{error:u,isLoading:m,isReady:_,installedPacks:f,installedPacksWithVersions:w,startFetchInstalled:b,filterInstalledPack:y}},"useInstalledPacks"),useConflictDetectionStore=defineStore("conflictDetection",()=>{const i=ref([]),o=ref(!1),n=ref(null),s=computed(()=>i.value.some(y=>y.has_conflict)),a=computed(()=>y=>i.value.find(b=>b.package_id===y)),r=computed(()=>i.value.filter(y=>y.conflicts.some(b=>b.type==="banned"))),l=computed(()=>i.value.filter(y=>y.conflicts.some(b=>b.type==="pending")));function u(y){i.value=[...y]}p(u,"setConflictedPackages");function m(){i.value=[]}p(m,"clearConflicts");function f(y){o.value=y}p(f,"setDetecting");function _(y){n.value=y}return p(_,"setLastDetectionTime"),{conflictedPackages:i,isDetecting:o,lastDetectionTime:n,hasConflicts:s,getConflictsForPackageByID:a,bannedPackages:r,securityPendingPackages:l,setConflictedPackages:u,clearConflicts:m,setDetecting:f,setLastDetectionTime:_}}),STORAGE_KEYS={CONFLICT_MODAL_DISMISSED:"Comfy.ConflictModalDismissed",CONFLICT_RED_DOT_DISMISSED:"Comfy.ConflictRedDotDismissed",CONFLICT_WARNING_BANNER_DISMISSED:"Comfy.ConflictWarningBannerDismissed"},modalDismissed=useStorage(STORAGE_KEYS.CONFLICT_MODAL_DISMISSED,!1),redDotDismissed=useStorage(STORAGE_KEYS.CONFLICT_RED_DOT_DISMISSED,!1),warningBannerDismissed=useStorage(STORAGE_KEYS.CONFLICT_WARNING_BANNER_DISMISSED,!1);function useConflictAcknowledgment(){const i=useConflictDetectionStore(),o=computed(()=>({modal_dismissed:modalDismissed.value,red_dot_dismissed:redDotDismissed.value,warning_banner_dismissed:warningBannerDismissed.value}));function n(){redDotDismissed.value=!0}p(n,"dismissRedDotNotification");function s(){warningBannerDismissed.value=!0,redDotDismissed.value=!0}p(s,"dismissWarningBanner");function a(){redDotDismissed.value=!0,modalDismissed.value=!0,warningBannerDismissed.value=!0}p(a,"markConflictsAsSeen");const r=computed(()=>i.hasConflicts),l=computed(()=>!modalDismissed.value),u=computed(()=>!(!r.value||redDotDismissed.value)),m=computed(()=>r.value&&!warningBannerDismissed.value);return{acknowledgmentState:o,shouldShowConflictModal:l,shouldShowRedDot:u,shouldShowManagerBanner:m,dismissRedDotNotification:n,dismissWarningBanner:s,markConflictsAsSeen:a}}p(useConflictAcknowledgment,"useConflictAcknowledgment");function createBannedConflict(i){return i===!0?{type:"banned",current_value:"installed",required_value:"not_banned"}:null}p(createBannedConflict,"createBannedConflict");function createPendingConflict(i){return i===!0?{type:"pending",current_value:"installed",required_value:"not_pending"}:null}p(createPendingConflict,"createPendingConflict");function consolidateConflictsByPackage(i){const o=groupBy(i,n=>normalizePackId(n.package_name));return Object.entries(o).map(([n,s])=>{const a=s.flatMap(u=>u.conflicts),r=uniqBy(a,u=>`${u.type}|${u.current_value}|${u.required_value}`);return{...s[0],package_name:n,conflicts:r,has_conflict:r.length>0,is_compatible:r.length===0}})}p(consolidateConflictsByPackage,"consolidateConflictsByPackage");function getRegistryOS(i){if(!i)return;const o=i.toLowerCase();if(o.includes("darwin")||o.includes("mac"))return"macOS";if(o.includes("win"))return"Windows";if(o.includes("linux"))return"Linux"}p(getRegistryOS,"getRegistryOS");function getRegistryAccelerator(i){if(!i)return"CPU";const o=i.toLowerCase();return o==="cuda"?"CUDA":o==="mps"?"Metal":o==="rocm"?"ROCm":"CPU"}p(getRegistryAccelerator,"getRegistryAccelerator");function checkOSCompatibility(i,o){if(isNil(i)||isEmpty(i))return null;const n=getRegistryOS(o);return n?i.includes(n)?null:{type:"os",current_value:n,required_value:i.join(", ")}:{type:"os",current_value:"Unknown",required_value:i.join(", ")}}p(checkOSCompatibility,"checkOSCompatibility");function checkAcceleratorCompatibility(i,o){if(isNil(i)||isEmpty(i))return null;const n=getRegistryAccelerator(o);return i.includes(n)?null:{type:"accelerator",current_value:n,required_value:i.join(", ")}}p(checkAcceleratorCompatibility,"checkAcceleratorCompatibility");function normalizeOSList(i){if(isNil(i)||isEmpty(i)||i.some(n=>n.toLowerCase()==="os independent"))return;const o=[];return i.forEach(n=>{(n==="Windows"||n==="macOS"||n==="Linux")&&(o.includes(n)||o.push(n))}),o.length>0?o:void 0}p(normalizeOSList,"normalizeOSList");const config={app_title:"ComfyUI",app_version:"1.33.13"};function cleanVersion(i){return semver.clean(i)||i}p(cleanVersion,"cleanVersion");function checkVersionCompatibility(i,o,n){if(isNil(o)||isEmpty(o)||isNil(n)||isEmpty(n?.trim()))return null;const s=cleanVersion(o);let a=!1;try{a=semver.satisfies(s,n)}catch{return{type:i,current_value:o,required_value:n}}return a?null:{type:i,current_value:o,required_value:n}}p(checkVersionCompatibility,"checkVersionCompatibility");function getFrontendVersion(){return config.app_version}p(getFrontendVersion,"getFrontendVersion");function useConflictDetection(){const i=useComfyManagerStore(),{startFetchInstalled:o,installedPacks:n,installedPacksWithVersions:s,isReady:a}=useInstalledPacks(),r=ref(!1),l=ref(null),u=ref(null),m=ref(null),f=ref([]),_=ref([]),y=ref(null),b=useConflictAcknowledgment(),w=useConflictDetectionStore(),k=computed(()=>w.hasConflicts),S=computed(()=>w.conflictedPackages),C=computed(()=>w.bannedPackages),I=computed(()=>w.securityPendingPackages);async function T(){try{const{systemStats:$,isInitialized:F}=useSystemStatsStore();await until(F);const j=getFrontendVersion(),U={comfyui_version:$?.system.comfyui_version??"",frontend_version:j,os:$?.system.os??"",accelerator:$?.devices?.[0]?.type??""};return m.value=U,U}catch{const F={comfyui_version:void 0,frontend_version:void 0,os:void 0,accelerator:void 0};return m.value=F,F}}p(T,"collectSystemEnvironment");async function E(){try{if(await o(),!a.value||!n.value||n.value.length===0)return console.warn("[ConflictDetection] No installed packages available from useInstalledPacks"),[];const $=useComfyRegistryService();y.value=new AbortController;const F=new Map,j=s.value.map(G=>({node_id:G.id,version:G.version}));if(j.length>0)try{const G=await $.getBulkNodeVersions(j,y.value?.signal);G&&G.node_versions?.length>0&&G.node_versions.forEach(H=>{H.status==="success"&&H.node_version?F.set(H.identifier.node_id,H.node_version):H.status==="error"&&console.warn(`[ConflictDetection] Failed to fetch version data for ${H.identifier.node_id}@${H.identifier.version}:`,H.error_message)})}catch(G){console.warn("[ConflictDetection] Failed to fetch bulk version data:",G)}const U=[];for(const G of s.value){const H=F.get(G.id),W=i.isPackEnabled(G.id),X=find(n.value,{id:G.id});if(H){const Q={id:G.id,name:X?.name||G.id,installed_version:G.version,is_enabled:W,supported_comfyui_version:H.supported_comfyui_version,supported_comfyui_frontend_version:H.supported_comfyui_frontend_version,supported_os:normalizeOSList(H.supported_os),supported_accelerators:H.supported_accelerators,version_status:H.status,is_banned:H.status==="NodeVersionStatusBanned",is_pending:H.status==="NodeVersionStatusPending"};U.push(Q)}else{console.warn(`[ConflictDetection] No Registry data found for ${G.id}, using fallback`);const Q={id:G.id,name:X?.name||G.id,installed_version:G.version,is_enabled:W,is_banned:!1,is_pending:!1};U.push(Q)}}return U}catch($){return console.warn("[ConflictDetection] Failed to fetch package requirements:",$),[]}}p(E,"buildNodeRequirements");function N($,F){const j=[],U=checkVersionCompatibility("comfyui_version",F.comfyui_version,$.supported_comfyui_version);U&&j.push(U);const G=checkVersionCompatibility("frontend_version",F.frontend_version,$.supported_comfyui_frontend_version);G&&j.push(G);const H=checkOSCompatibility($.supported_os,F.os);H&&j.push(H);const W=checkAcceleratorCompatibility($.supported_accelerators,F.accelerator);W&&j.push(W);const X=createBannedConflict($.is_banned);X&&j.push(X);const Q=createPendingConflict($.is_pending);Q&&j.push(Q);const q=j.length>0;return{package_id:$.id??"",package_name:$.name??"",has_conflict:q,conflicts:j,is_compatible:!q}}p(N,"analyzePackageConflicts");async function L(){try{const $=useComfyManagerService();if(!s.value||s.value.length===0)return console.warn("[ConflictDetection] No installed packages available for import failure check"),{};const F=s.value.map(U=>U.id),j=await $.getImportFailInfoBulk({cnr_ids:F},y.value?.signal);if(j){const U={};return Object.entries(j).forEach(([G,H])=>{H!==null&&(U[G]=H)}),U}return{}}catch($){return console.warn("[ConflictDetection] Failed to fetch import failure information:",$),{}}}p(L,"fetchImportFailInfo");function A($){const F=[];if(!$||typeof $!="object")return F;for(const[j,U]of Object.entries($))if(U&&typeof U=="object"){const G=U.msg||"Unknown import error",H=U.path||"";F.push({package_id:j,package_name:j,has_conflict:!0,conflicts:[{type:"import_failed",current_value:"installed",required_value:U.msg}],is_compatible:!1}),console.warn(`[ConflictDetection] Python import failure detected for ${j}:`,{path:H,error:G})}return F}p(A,"detectImportFailConflicts");async function D(){if(r.value)return{success:!1,error_message:"Already detecting conflicts",results:f.value};r.value=!0,u.value=null;try{const $=await T(),j=(await E()).map(async q=>{try{return N(q,$)}catch(ee){return console.warn(`[ConflictDetection] Failed to detect conflicts for package ${q.name}:`,ee),null}}),G=(await Promise.allSettled(j)).map(q=>q.status==="fulfilled"?q.value:null).filter(q=>q!==null),H=await L(),W=A(H),X=[...G,...W];if(f.value=X,l.value=new Date().toISOString(),X.some(q=>q.has_conflict)){const q=X.filter(ae=>ae.has_conflict),ee=consolidateConflictsByPackage(q);return w.setConflictedPackages(ee),f.value=[...ee],_.value=[...ee],{success:!0,results:ee,detected_system_environment:$}}else w.clearConflicts(),f.value=[];return{success:!0,results:X,detected_system_environment:$}}catch($){return console.error("[ConflictDetection] Error during conflict detection:",$),u.value=$ instanceof Error?$.message:String($),{success:!1,error_message:u.value,results:[]}}finally{r.value=!1,y.value&&(y.value=null)}}p(D,"runFullConflictAnalysis");async function O(){try{const{useManagerState:$}=await __vitePreload(async()=>{const{useManagerState:j}=await Promise.resolve().then(()=>useManagerState$1);return{useManagerState:j}},void 0,import.meta.url);if(!$().isNewManagerUI.value)return;await D()}catch($){console.warn("[ConflictDetection] Error during initialization (ignored):",$)}}p(O,"initializeConflictDetection");function M(){y.value&&(y.value.abort(),y.value=null)}p(M,"cancelRequests"),getCurrentInstance()&&onUnmounted(()=>{M()});async function R(){f.value.length===0&&await D();const $=k.value,F=b.shouldShowConflictModal.value;return $&&F}p(R,"shouldShowConflictModalAfterUpdate");function V($){const F=[],j=checkOSCompatibility(normalizeOSList($.supported_os),m.value?.os);j&&F.push(j);const U=checkAcceleratorCompatibility($.supported_accelerators,m.value?.accelerator);U&&F.push(U);const G=checkVersionCompatibility("comfyui_version",m.value?.comfyui_version,$.supported_comfyui_version);G&&F.push(G);const H=getFrontendVersion(),W=checkVersionCompatibility("frontend_version",H,$.supported_comfyui_frontend_version);W&&F.push(W);const X=createBannedConflict($.status==="NodeStatusBanned"||$.status==="NodeVersionStatusBanned");X&&F.push(X);const Q=createPendingConflict($.status==="NodeVersionStatusPending");return Q&&F.push(Q),{hasConflict:F.length>0,conflicts:F}}return p(V,"checkNodeCompatibility"),{isDetecting:readonly(r),lastDetectionTime:readonly(l),detectionError:readonly(u),systemEnvironment:readonly(m),detectionResults:readonly(f),hasConflicts:k,conflictedPackages:S,bannedPackages:C,securityPendingPackages:I,runFullConflictAnalysis:D,collectSystemEnvironment:T,initializeConflictDetection:O,cancelRequests:M,shouldShowConflictModalAfterUpdate:R,checkNodeCompatibility:V}}p(useConflictDetection,"useConflictDetection");const _hoisted_1$10={key:0,class:"pi pi-exclamation-triangle text-yellow-500"},_sfc_main$1a=defineComponent({__name:"PackInstallButton",props:{nodePacks:{},isLoading:{type:Boolean,default:!1},label:{default:"Install"},size:{default:"sm"},hasConflict:{type:Boolean},conflictInfo:{}},setup(i){const o=useComfyManagerStore(),{showNodeConflictDialog:n}=useDialogService(),s=computed(()=>i.nodePacks?.length?i.nodePacks.some(f=>o.isPackInstalling(f.id)):!1),a=p(f=>{if(!f.id)throw new Error("Node ID is required for installation");const y=f.publisher?.name==="Unclaimed"?"nightly":f.latest_version?.version??"latest";return{id:f.id,repository:f.repository??"",channel:"dev",mode:"cache",selected_version:y,version:y}},"createPayload"),r=p(f=>o.installPack.call(a(f)),"installPack"),l=p(async()=>{if(!i.nodePacks?.length)return;if(i.hasConflict&&i.conflictInfo){const{checkNodeCompatibility:_}=useConflictDetection(),y=i.nodePacks.map(b=>{const w=_(b);return{package_id:b.id||"",package_name:b.name||"",has_conflict:w.hasConflict,conflicts:w.conflicts,is_compatible:!w.hasConflict}}).filter(b=>b.has_conflict);n({conflictedPackages:y,buttonText:t("manager.conflicts.installAnyway"),onButtonClick:p(async()=>{const b=i.nodePacks.filter(w=>!o.isPackInstalled(w.id));b.length&&await u(b)},"onButtonClick")});return}const f=i.nodePacks.filter(_=>!o.isPackInstalled(_.id));f.length&&await u(f)},"installAllPacks"),u=p(async f=>{await Promise.all(f.map(r)),o.installPack.clear()},"performInstallation"),m=computed(()=>s.value?t("g.installing"):i.label??(i.nodePacks.length>1?t("manager.installSelected"):t("g.install")));return(f,_)=>(openBlock(),createBlock(_sfc_main$2D,mergeProps(f.$attrs,{type:"secondary",label:m.value,size:f.size,disabled:f.isLoading||s.value,onClick:l}),{icon:withCtx(()=>[f.hasConflict&&!s.value&&!f.isLoading?(openBlock(),createElementBlock("i",_hoisted_1$10)):f.isLoading||s.value?(openBlock(),createBlock(DotSpinner,{key:1,duration:"1s",size:f.size==="sm"?12:16},null,8,["size"])):createCommentVNode("",!0)]),_:1},16,["label","size","disabled"]))}}),_hoisted_1$$={key:0,class:"flex w-full items-center justify-between gap-2 py-2 px-4"},_hoisted_2$L={key:1,class:"flex justify-end gap-1 py-2 px-4"},_sfc_main$19=defineComponent({__name:"MissingNodesFooter",setup(i){const o=useDialogStore(),{t:n}=useI18n(),s=p(()=>{o.closeDialog({key:"global-missing-nodes"})},"handleGotItClick"),{missingNodePacks:a,isLoading:r,error:l}=useMissingNodes(),u=useComfyManagerStore(),m=useManagerState(),f=computed(()=>a.value?.length?a.value.some(k=>u.isPackInstalling(k.id)):!1),_=computed(()=>m.shouldShowManagerButtons.value),y=computed(()=>m.shouldShowInstallButton.value),b=p(async()=>{await m.openManager({initialTab:ManagerTab.Missing,showToastOnLegacyError:!0})},"openManager"),w=computed(()=>!r.value&&!f.value&&a.value?.length===0);return watch(w,async k=>{k&&y.value&&(await nextTick(),o.closeDialog({key:"global-missing-nodes"}),useToastStore().add({severity:"success",summary:n("g.success"),detail:n("manager.allMissingNodesInstalled"),life:3e3}))}),(k,S)=>unref(isCloud)?(openBlock(),createElementBlock("div",_hoisted_1$$,[createVNode(_sfc_main$2D,{label:k.$t("missingNodes.cloud.learnMore"),type:"transparent",size:"sm","icon-position":"left",as:"a",href:"https://www.comfy.org/cloud",target:"_blank",rel:"noopener noreferrer"},{icon:withCtx(()=>S[0]||(S[0]=[createBaseVNode("i",{class:"icon-[lucide--info]"},null,-1)])),_:1},8,["label"]),createVNode(_sfc_main$2A,{label:k.$t("missingNodes.cloud.gotIt"),type:"secondary",size:"md",onClick:s},null,8,["label"])])):_.value?(openBlock(),createElementBlock("div",_hoisted_2$L,[createVNode(_sfc_main$2A,{label:k.$t("g.openManager"),type:"transparent",size:"sm",onClick:b},null,8,["label"]),y.value?(openBlock(),createBlock(_sfc_main$1a,{key:0,type:"secondary",size:"md",disabled:unref(r)||!!unref(l)||unref(a).length===0||f.value,"is-loading":unref(r),"node-packs":unref(a),label:unref(r)?k.$t("manager.gettingInfo"):k.$t("manager.installAllMissingNodes")},null,8,["disabled","is-loading","node-packs","label"])):createCommentVNode("",!0)])):createCommentVNode("",!0)}}),_hoisted_1$_={class:"flex w-full items-center justify-between p-4"},_hoisted_2$K={class:"flex items-center gap-2"},_hoisted_3$w={class:"m-0 text-sm"},_sfc_main$18=defineComponent({__name:"MissingNodesHeader",setup(i){return(o,n)=>(openBlock(),createElementBlock("div",_hoisted_1$_,[createBaseVNode("div",_hoisted_2$K,[n[0]||(n[0]=createBaseVNode("i",{class:"icon-[lucide--triangle-alert] text-gold-600"},null,-1)),createBaseVNode("p",_hoisted_3$w,toDisplayString(unref(isCloud)?o.$t("missingNodes.cloud.title"):o.$t("missingNodes.oss.title")),1)])]))}}),_sfc_main$17=defineComponent({__name:"FindIssueButton",props:{errorMessage:{},repoOwner:{},repoName:{}},setup(i){const o=i,n=computed(()=>o.errorMessage+" is:issue"),s=p(()=>{const a=encodeURIComponent(n.value),r=`https://github.com/${o.repoOwner}/${o.repoName}/issues?q=${a}`;window.open(r,"_blank")},"openGitHubIssues");return(a,r)=>(openBlock(),createBlock(unref(script),{label:a.$t("g.findIssues"),severity:"secondary",icon:"pi pi-github",onClick:s},null,8,["label"]))}});function generateErrorReport(i){const n=JSON.stringify(i.workflow),s=n.length>2e4?"Workflow too large. Please manually upload the workflow from local file system.":n,a=i.systemStats;return`
# ComfyUI Error Report
${i?`## Error Details
- **Node ID:** ${i.nodeId||"N/A"}
- **Node Type:** ${i.nodeType||"N/A"}
- **Exception Type:** ${i.exceptionType||"N/A"}
- **Exception Message:** ${i.exceptionMessage||"N/A"}
## Stack Trace
\`\`\`
${i.traceback||"No stack trace available"}
\`\`\``:""}
## System Information
- **ComfyUI Version:** ${a.system.comfyui_version}
- **Arguments:** ${a.system.argv.join(" ")}
- **OS:** ${a.system.os}
- **Python Version:** ${a.system.python_version}
- **Embedded Python:** ${a.system.embedded_python}
- **PyTorch Version:** ${a.system.pytorch_version}
## Devices
${a.devices.map(r=>`
- **Name:** ${r.name}
  - **Type:** ${r.type}
  - **VRAM Total:** ${r.vram_total}
  - **VRAM Free:** ${r.vram_free}
  - **Torch VRAM Total:** ${r.torch_vram_total}
  - **Torch VRAM Free:** ${r.torch_vram_free}
`).join(`
`)}
## Logs
\`\`\`
${i.serverLogs}
\`\`\`
## Attached Workflow
Please make sure that workflow does not contain any sensitive information such as API keys or passwords.
\`\`\`
${s}
\`\`\`

## Additional Context
(Please add any additional context or steps to reproduce the error here)
`}p(generateErrorReport,"generateErrorReport");const _hoisted_1$Z={class:"comfy-error-report flex flex-col gap-4"},_hoisted_2$J={class:"font-bold"},_hoisted_3$v={class:"flex justify-center gap-2"},_hoisted_4$p={class:"break-words whitespace-pre-wrap"},_hoisted_5$n={class:"flex justify-end gap-4"},repoOwner="comfyanonymous",repoName="ComfyUI",_sfc_main$16=defineComponent({__name:"ErrorDialogContent",props:{error:{}},setup(i){const o=ref(""),n=ref(!1),s=p(()=>{n.value=!0},"showReport"),a=useToast(),{t:r}=useI18n(),l=useSystemStatsStore(),u=computed(()=>i.error.nodeType??i.error.exceptionType??r("errorDialog.defaultTitle")),m=p(async()=>{await useCommandStore().execute("Comfy.ContactSupport")},"showContactSupport");onMounted(async()=>{l.systemStats||await l.refetchSystemStats();try{const[y]=await Promise.all([api.getLogs()]);o.value=generateErrorReport({systemStats:l.systemStats,serverLogs:y,workflow:app$1.graph.serialize(),exceptionType:i.error.exceptionType,exceptionMessage:i.error.exceptionMessage,traceback:i.error.traceback,nodeId:i.error.nodeId,nodeType:i.error.nodeType})}catch(y){console.error("Error fetching logs:",y),a.add({severity:"error",summary:r("g.error"),detail:r("toastMessages.failedToFetchLogs"),life:5e3})}});const{copyToClipboard:f}=useCopyToClipboard(),_=p(async()=>{await f(o.value)},"copyReportToClipboard");return(y,b)=>(openBlock(),createElementBlock("div",_hoisted_1$Z,[createVNode(NoResultsPlaceholder,{class:"pb-0",icon:"pi pi-exclamation-circle",title:u.value,message:y.error.exceptionMessage,"text-class":"break-words max-w-[60vw]"},null,8,["title","message"]),y.error.extensionFile?(openBlock(),createElementBlock(Fragment,{key:0},[createBaseVNode("span",null,toDisplayString(unref(r)("errorDialog.extensionFileHint"))+":",1),b[0]||(b[0]=createBaseVNode("br",null,null,-1)),createBaseVNode("span",_hoisted_2$J,toDisplayString(y.error.extensionFile),1)],64)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_3$v,[withDirectives(createVNode(unref(script),{text:"",label:y.$t("g.showReport"),onClick:s},null,8,["label"]),[[vShow,!n.value]]),withDirectives(createVNode(unref(script),{text:"",label:y.$t("issueReport.helpFix"),onClick:m},null,8,["label"]),[[vShow,!n.value]])]),n.value?(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(unref(script$o)),createVNode(unref(script$c),{class:"h-[400px] w-full max-w-[80vw]"},{default:withCtx(()=>[createBaseVNode("pre",_hoisted_4$p,toDisplayString(o.value),1)]),_:1}),createVNode(unref(script$o))],64)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_5$n,[createVNode(_sfc_main$17,{"error-message":y.error.exceptionMessage,"repo-owner":repoOwner,"repo-name":repoName},null,8,["error-message"]),n.value?(openBlock(),createBlock(unref(script),{key:0,label:y.$t("g.copyToClipboard"),icon:"pi pi-copy",onClick:_},null,8,["label"])):createCommentVNode("",!0)])]))}});function useCivitaiModel(i){const o=p(f=>`https://civitai.com/api/v1/model-versions/${f}`,"createModelVersionUrl"),n=p(()=>new URL(i).pathname.split("/").pop()||null,"extractModelIdFromUrl"),s=p(async()=>{const f=n();if(!f)return null;const _=o(f);return(await fetch(_)).json()},"fetchModelData"),a=p(()=>{const f=r.value?.files?.find(_=>_.downloadUrl&&i.startsWith(_.downloadUrl));return f?.sizeKB?f.sizeKB<<10:null},"findMatchingFileSize"),{state:r,isLoading:l,error:u}=useAsyncState(s,null,{immediate:!0});return{fileSize:computed(()=>l.value?null:a()),isLoading:l,error:u,modelData:r}}p(useCivitaiModel,"useCivitaiModel");function useDownload(i,o){const n=ref(null),s=ref(null),a=p(u=>{n.value=u},"setFileSize"),r=p(async()=>{try{const u=await fetch(i,{method:"HEAD"});if(!u.ok)throw new Error("Failed to fetch file size");const m=u.headers.get("content-length");if(m)a(parseInt(m));else return console.error('"content-length" header not found'),null}catch(u){return console.error("Error fetching file size:",u),s.value=u instanceof Error?u:new Error(String(u)),null}},"fetchFileSize"),l=p(()=>{const u=document.createElement("a");i.includes("huggingface.co")&&s.value?u.href=downloadUrlToHfRepoUrl(i):(u.href=i,u.download=i.split("/").pop()||"download"),u.target="_blank",u.rel="noopener noreferrer",u.click()},"triggerBrowserDownload");return onMounted(()=>{if(isCivitaiModelUrl(i)){const{fileSize:u,error:m}=useCivitaiModel(i);whenever(u,a),whenever(m,r,{once:!0})}else r()}),{triggerBrowserDownload:l,fileSize:n}}p(useDownload,"useDownload");const _hoisted_1$Y={class:"flex flex-col"},_hoisted_2$I={class:"flex flex-row items-center gap-2"},_hoisted_3$u={key:0,class:"pi pi-check text-green-500"},_hoisted_4$o={class:"file-info"},_hoisted_5$m={class:"file-details"},_hoisted_6$e=["title"],_hoisted_7$d={key:0,class:"file-error"},_hoisted_8$a={class:"file-action flex flex-row items-center gap-2"},_hoisted_9$8={key:0,class:"flex flex-row items-center gap-2"},_sfc_main$15=defineComponent({__name:"ElectronFileDownload",props:{url:{},hint:{},label:{},error:{}},setup(i){const o=i,{t:n}=useI18n(),s=computed(()=>o.label||o.url.split("/").pop()),a=computed(()=>o.hint||o.url),r=useDownload(o.url),l=ref(0),u=ref(null),m=computed(()=>r.fileSize.value?formatSize(r.fileSize.value):"?"),{copyToClipboard:f}=useCopyToClipboard(),_=useElectronDownloadStore(),[y,b]=o.label.split("/");_.$subscribe((T,{downloads:E})=>{const N=E.find(L=>o.url===L.url);N&&(l.value=Number((N.progress*100).toFixed(1)),u.value=N.status)});const w=p(async()=>{await _.start({url:o.url,savePath:y.trim(),filename:b.trim()})},"triggerDownload"),k=p(()=>_.cancel(o.url),"triggerCancelDownload"),S=p(()=>_.pause(o.url),"triggerPauseDownload"),C=p(()=>_.resume(o.url),"triggerResumeDownload"),I=p(async()=>{await f(o.url)},"copyURL");return(T,E)=>{const N=resolveDirective("tooltip");return openBlock(),createElementBlock("div",_hoisted_1$Y,[createBaseVNode("div",_hoisted_2$I,[u.value==="completed"?(openBlock(),createElementBlock("i",_hoisted_3$u)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_4$o,[createBaseVNode("div",_hoisted_5$m,[createBaseVNode("span",{class:"file-type",title:a.value},toDisplayString(s.value),9,_hoisted_6$e)]),o.error?(openBlock(),createElementBlock("div",_hoisted_7$d,toDisplayString(o.error),1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_8$a,[u.value===null||u.value==="error"?(openBlock(),createBlock(unref(script),{key:0,class:"file-action-button",label:T.$t("g.download")+" ("+m.value+")",size:"small",outlined:"",disabled:!!o.error,icon:"pi pi-download",onClick:w},null,8,["label","disabled"])):createCommentVNode("",!0),(u.value===null||u.value==="error")&&o.url?(openBlock(),createBlock(unref(script),{key:1,label:T.$t("g.copyURL"),size:"small",outlined:"",onClick:I},null,8,["label"])):createCommentVNode("",!0)])]),u.value==="in_progress"||u.value==="paused"?(openBlock(),createElementBlock("div",_hoisted_9$8,[createVNode(unref(script$k),{class:"flex-1",value:l.value,"show-value":l.value>10},null,8,["value","show-value"]),u.value==="in_progress"?withDirectives((openBlock(),createBlock(unref(script),{key:0,class:"file-action-button",size:"small",outlined:"",disabled:!!o.error,icon:"pi pi-pause-circle",onClick:S},null,8,["disabled"])),[[N,unref(n)("electronFileDownload.pause"),void 0,{top:!0}]]):createCommentVNode("",!0),u.value==="paused"?withDirectives((openBlock(),createBlock(unref(script),{key:1,class:"file-action-button",size:"small",outlined:"",disabled:!!o.error,icon:"pi pi-play-circle",onClick:C},null,8,["disabled"])),[[N,unref(n)("electronFileDownload.resume"),void 0,{top:!0}]]):createCommentVNode("",!0),withDirectives(createVNode(unref(script),{class:"file-action-button",size:"small",outlined:"",disabled:!!o.error,icon:"pi pi-times-circle",severity:"danger",onClick:k},null,8,["disabled"]),[[N,unref(n)("electronFileDownload.cancel"),void 0,{top:!0}]])])):createCommentVNode("",!0)])}}}),_hoisted_1$X={class:"flex flex-row items-center gap-2"},_hoisted_2$H=["title"],_sfc_main$14=defineComponent({__name:"FileDownload",props:{url:{},hint:{},label:{},error:{}},setup(i){const o=i,n=computed(()=>o.label||o.url.split("/").pop()),s=computed(()=>o.hint||o.url),a=useDownload(o.url),r=computed(()=>a.fileSize.value?formatSize(a.fileSize.value):"?"),l=p(async()=>{await u(o.url)},"copyURL"),{copyToClipboard:u}=useCopyToClipboard();return(m,f)=>(openBlock(),createElementBlock("div",_hoisted_1$X,[createBaseVNode("div",null,[createBaseVNode("div",null,[createBaseVNode("span",{title:s.value},toDisplayString(n.value),9,_hoisted_2$H)]),o.error?(openBlock(),createBlock(unref(script$1),{key:0,severity:"error",icon:"pi pi-exclamation-triangle",size:"small",variant:"outlined",class:"my-2 h-min max-w-xs px-1",title:o.error,pt:{text:{class:"overflow-hidden text-ellipsis"}}},{default:withCtx(()=>[createTextVNode(toDisplayString(o.error),1)]),_:1},8,["title"])):createCommentVNode("",!0)]),createBaseVNode("div",null,[createVNode(unref(script),{label:m.$t("g.download")+" ("+r.value+")",size:"small",outlined:"",disabled:!!o.error,title:o.url,onClick:unref(a).triggerBrowserDownload},null,8,["label","disabled","title","onClick"])]),createBaseVNode("div",null,[createVNode(unref(script),{label:m.$t("g.copyURL"),size:"small",outlined:"",disabled:!!o.error,onClick:l},null,8,["label","disabled"])])]))}}),_hoisted_1$W={class:"mb-4 flex gap-1"},_hoisted_2$G={for:"doNotAskAgain"},_sfc_main$13=defineComponent({__name:"MissingModelsWarning",props:{missingModels:{},paths:{}},setup(i){const o=["https://civitai.com/","https://huggingface.co/","http://localhost:"],n=[".safetensors",".sft"],s=new Set(["https://huggingface.co/stabilityai/stable-zero123/resolve/main/stable_zero123.ckpt","https://huggingface.co/TencentARC/T2I-Adapter/resolve/main/models/t2iadapter_depth_sd14v1.pth?download=true","https://github.com/xinntao/Real-ESRGAN/releases/download/v0.1.0/RealESRGAN_x4plus.pth"]),a=i,{t:r}=useI18n(),l=ref(!1),u=ref({}),m=computed(()=>a.missingModels.map(f=>{const _=a.paths[f.directory];if(f.directory_invalid||!_)return{label:`${f.directory} / ${f.name}`,url:f.url,error:"Invalid directory specified (does this require custom nodes?)"};const y=u.value[f.name]??{downloading:!1,completed:!1,progress:0,error:null,name:f.name,directory:f.directory,url:f.url,folder_path:_[0]};if(u.value[f.name]=y,!s.has(f.url)){if(!o.some(b=>f.url.startsWith(b)))return{label:`${f.directory} / ${f.name}`,url:f.url,error:`Download not allowed from source '${f.url}', only allowed from '${o.join("', '")}'`};if(!n.some(b=>f.name.endsWith(b)))return{label:`${f.directory} / ${f.name}`,url:f.url,error:`Only allowed suffixes are: '${n.join("', '")}'`}}return{url:f.url,label:`${f.directory} / ${f.name}`,downloading:y.downloading,completed:y.completed,progress:y.progress,error:y.error,name:f.name,paths:_,folderPath:y.folder_path}}));return onBeforeUnmount(async()=>{l.value&&await useSettingStore().set("Comfy.Workflow.ShowMissingModelsWarning",!1)}),(f,_)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(NoResultsPlaceholder,{class:"pb-0",icon:"pi pi-exclamation-circle",title:unref(r)("missingModelsDialog.missingModels"),message:unref(r)("missingModelsDialog.missingModelsMessage")},null,8,["title","message"]),createBaseVNode("div",_hoisted_1$W,[createVNode(unref(script$9),{modelValue:l.value,"onUpdate:modelValue":_[0]||(_[0]=y=>l.value=y),binary:"","input-id":"doNotAskAgain"},null,8,["modelValue"]),createBaseVNode("label",_hoisted_2$G,toDisplayString(unref(r)("missingModelsDialog.doNotAskAgain")),1)]),createVNode(unref(script$r),{options:m.value,class:"comfy-missing-models"},{option:withCtx(({option:y})=>[unref(isElectron)()?(openBlock(),createBlock(Suspense,{key:0},{default:withCtx(()=>[createVNode(_sfc_main$15,{url:y.url,label:y.label,error:y.error},null,8,["url","label","error"])]),_:2},1024)):(openBlock(),createBlock(_sfc_main$14,{key:1,url:y.url,label:y.label,error:y.error},null,8,["url","label","error"]))]),_:1},8,["options"])],64))}}),MissingModelsWarning=_export_sfc(_sfc_main$13,[["__scopeId","data-v-520e7481"]]),_hoisted_1$V={class:"prompt-dialog-content flex flex-col gap-2 pt-8"},_sfc_main$12=defineComponent({__name:"PromptDialogContent",props:{message:{},defaultValue:{},onConfirm:{type:Function},placeholder:{}},setup(i){const o=i,n=ref(o.defaultValue),s=p(()=>{o.onConfirm(n.value),useDialogStore().closeDialog()},"onConfirm"),a=ref(),r=p(()=>{if(!a.value)return;const l=a.value.$el;l.setSelectionRange(0,l.value.length)},"selectAllText");return(l,u)=>(openBlock(),createElementBlock("div",_hoisted_1$V,[createVNode(unref(script$s),null,{default:withCtx(()=>[createVNode(unref(script$3),{ref_key:"inputRef",ref:a,modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=m=>n.value=m),placeholder:l.placeholder,autofocus:"",onKeyup:withKeys(s,["enter"]),onFocus:r},null,8,["modelValue","placeholder"]),createBaseVNode("label",null,toDisplayString(l.message),1)]),_:1}),createVNode(unref(script),{onClick:s},{default:withCtx(()=>[createTextVNode(toDisplayString(l.$t("g.confirm")),1)]),_:1})]))}}),_imports_0$1=""+new URL("images/comfy-logo-mono.svg",import.meta.url).href,HOST_WHITELIST=["localhost"];function normalizeHost(i){let o=(i||"").trim().toLowerCase();o=o.replace(/\.$/,"");const n=o.match(/^\[([^\]]+)\]:(\d+)$/);if(n)o=n[1];else{const s=o.match(/^([^:]+):(\d+)$/);s&&(o=s[1])}return o=o.replace(/^\[|\]$/g,""),o}p(normalizeHost,"normalizeHost");function isHostWhitelisted(i){const o=normalizeHost(i);return isLocalhostLabel(o)||isIPv4Loopback(o)||isIPv6Loopback(o)||isComfyOrgHost(o)?!0:HOST_WHITELIST.map(normalizeHost).includes(o)}p(isHostWhitelisted,"isHostWhitelisted");function isLocalhostLabel(i){return i==="localhost"||i.endsWith(".localhost")}p(isLocalhostLabel,"isLocalhostLabel");const IPV4_OCTET="(?:25[0-5]|2[0-4]\\d|1\\d\\d|0?\\d?\\d)",V4_LOOPBACK_RE=new RegExp("^127\\."+IPV4_OCTET+"\\."+IPV4_OCTET+"\\."+IPV4_OCTET+"$");function isIPv4Loopback(i){return V4_LOOPBACK_RE.test(i)}p(isIPv4Loopback,"isIPv4Loopback");const V6_FULL_LOOPBACK_RE=/^(?:0{1,4}:){7}0{0,3}1$/i,V6_COMPRESSED_LOOPBACK_RE=/^((?:0{1,4}(?::0{1,4}){0,6})?)::((?:0{1,4}:){0,6})0{0,3}1$/i;function isIPv6Loopback(i){if(V6_FULL_LOOPBACK_RE.test(i))return!0;const o=i.match(V6_COMPRESSED_LOOPBACK_RE);if(!o)return!1;const n=o[1]?o[1].match(/0{1,4}:/gi)?.length??0:0,s=o[2]?o[2].match(/0{1,4}:/gi)?.length??0:0;return n+s<=6}p(isIPv6Loopback,"isIPv6Loopback");const COMFY_ORG_HOST=/\.comfy\.org$/;function isComfyOrgHost(i){return COMFY_ORG_HOST.test(i)}p(isComfyOrgHost,"isComfyOrgHost");const VALID_STATUS_CODES=[200,201,301,302,307,308],checkUrlReachable=p(async i=>{try{const o=await axios.head(i);return VALID_STATUS_CODES.includes(o.status)}catch{return!1}},"checkUrlReachable");async function isInChina(){const i=navigator.language.toLowerCase().startsWith("zh-cn");try{if(await Promise.race([fetch("https://www.google.com",{mode:"no-cors",cache:"no-cache"}),new Promise((n,s)=>setTimeout(()=>s(),2e3))]))return!1}catch{if(i)return!0;try{const o=performance.now();return await fetch("https://www.baidu.com",{mode:"no-cors",cache:"no-cache"}),performance.now()-o<150}catch{return i}}return!1}p(isInChina,"isInChina");const apiKeySchema=z.object({apiKey:z.string().trim().startsWith("comfyui-",t("validation.prefix",{prefix:"comfyui-"})).length(72,t("validation.length",{length:72}))}),signInSchema=z.object({email:z.string().email(t("validation.invalidEmail")).min(1,t("validation.required")),password:z.string().min(1,t("validation.required"))}),passwordSchema=z.object({password:z.string().min(8,t("validation.minLength",{length:8})).max(32,t("validation.maxLength",{length:32})).regex(/[A-Z]/,t("validation.password.uppercase")).regex(/[a-z]/,t("validation.password.lowercase")).regex(/\d/,t("validation.password.number")).regex(/[^A-Za-z0-9]/,t("validation.password.special")),confirmPassword:z.string().min(1,t("validation.required"))}),updatePasswordSchema=passwordSchema.refine(i=>i.password===i.confirmPassword,{message:t("validation.password.match"),path:["confirmPassword"]}),signUpSchema=passwordSchema.extend({email:z.string().email(t("validation.invalidEmail")).min(1,t("validation.required"))}).refine(i=>i.password===i.confirmPassword,{message:t("validation.password.match"),path:["confirmPassword"]}),_hoisted_1$U={class:"flex flex-col gap-6"},_hoisted_2$F={class:"mb-8 flex flex-col gap-4"},_hoisted_3$t={class:"my-0 text-2xl leading-normal font-medium"},_hoisted_4$n={class:"flex flex-col gap-2"},_hoisted_5$l={class:"my-0 text-base text-muted"},_hoisted_6$d={href:"https://docs.comfy.org/interface/user#logging-in-with-an-api-key",target:"_blank",class:"cursor-pointer text-blue-500"},_hoisted_7$c={class:"flex flex-col gap-2"},_hoisted_8$9={class:"mb-2 text-base font-medium opacity-80",for:"comfy-org-api-key"},_hoisted_9$7={class:"flex flex-col gap-2"},_hoisted_10$7={class:"text-muted"},_hoisted_11$5=["href"],_hoisted_12$2={href:"https://docs.comfy.org/tutorials/api-nodes/overview#log-in-with-api-key-on-non-whitelisted-websites",target:"_blank",class:"cursor-pointer text-blue-500"},_hoisted_13$2={class:"mt-4 flex items-center justify-between"},_sfc_main$11=defineComponent({__name:"ApiKeyForm",emits:["back","success"],setup(i,{emit:o}){const n=useFirebaseAuthStore(),s=useApiKeyAuthStore(),a=computed(()=>n.loading),r=computed(()=>configValueOrDefault(remoteConfig.value,"comfy_platform_base_url",getComfyPlatformBaseUrl())),{t:l}=useI18n(),u=o,m=p(async f=>{f.valid&&(await s.storeApiKey(f.values.apiKey),u("success"))},"onSubmit");return(f,_)=>(openBlock(),createElementBlock("div",_hoisted_1$U,[createBaseVNode("div",_hoisted_2$F,[createBaseVNode("h1",_hoisted_3$t,toDisplayString(unref(l)("auth.apiKey.title")),1),createBaseVNode("div",_hoisted_4$n,[createBaseVNode("p",_hoisted_5$l,toDisplayString(unref(l)("auth.apiKey.description")),1),createBaseVNode("a",_hoisted_6$d,toDisplayString(unref(l)("g.learnMore")),1)])]),createVNode(unref(script$t),{class:"flex flex-col gap-6",resolver:unref(zodResolver)(unref(apiKeySchema)),onSubmit:m},{default:withCtx(y=>[y.apiKey?.invalid?(openBlock(),createBlock(unref(script$1),{key:0,severity:"error",class:"mb-4"},{default:withCtx(()=>[createTextVNode(toDisplayString(y.apiKey.error.message),1)]),_:2},1024)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_7$c,[createBaseVNode("label",_hoisted_8$9,toDisplayString(unref(l)("auth.apiKey.label")),1),createBaseVNode("div",_hoisted_9$7,[createVNode(unref(script$3),{"pt:root:id":"comfy-org-api-key","pt:root:autocomplete":"off",class:"h-10",name:"apiKey",type:"password",placeholder:unref(l)("auth.apiKey.placeholder"),invalid:y.apiKey?.invalid},null,8,["placeholder","invalid"]),createBaseVNode("small",_hoisted_10$7,[createTextVNode(toDisplayString(unref(l)("auth.apiKey.helpText"))+" ",1),createBaseVNode("a",{href:`${r.value}/login`,target:"_blank",class:"cursor-pointer text-blue-500"},toDisplayString(unref(l)("auth.apiKey.generateKey")),9,_hoisted_11$5),_[1]||(_[1]=createBaseVNode("span",{class:"mx-1"},"â€¢",-1)),createBaseVNode("a",_hoisted_12$2,toDisplayString(unref(l)("auth.apiKey.whitelistInfo")),1)])])]),createBaseVNode("div",_hoisted_13$2,[createVNode(unref(script),{type:"button",link:"",onClick:_[0]||(_[0]=b=>f.$emit("back"))},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(l)("g.back")),1)]),_:1}),createVNode(unref(script),{type:"submit",loading:a.value,disabled:a.value},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(l)("g.save")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["resolver"])]))}}),_hoisted_1$T={class:"flex flex-col gap-2"},_hoisted_2$E={key:0,class:"text-red-500"},_hoisted_3$s={class:"flex flex-col gap-2"},_hoisted_4$m={class:"mb-2 flex items-center justify-between"},_hoisted_5$k={class:"text-base font-medium opacity-80",for:"comfy-org-sign-in-password"},_hoisted_6$c=["onClick"],_hoisted_7$b={key:0,class:"text-red-500"},emailInputId="comfy-org-sign-in-email",_sfc_main$10=defineComponent({__name:"SignInForm",emits:["submit"],setup(i,{emit:o}){const n=useFirebaseAuthStore(),s=useFirebaseAuthActions(),a=computed(()=>n.loading),r=useToast(),{t:l}=useI18n(),u=o,m=p(_=>{_.valid&&u("submit",_.values)},"onSubmit"),f=p(async(_,y)=>{if(!_||!y){r.add({severity:"warn",summary:l("auth.login.emailPlaceholder"),life:5e3}),document.getElementById(emailInputId)?.focus?.();return}await s.sendPasswordReset(_)},"handleForgotPassword");return(_,y)=>(openBlock(),createBlock(unref(script$t),{class:"flex flex-col gap-6",resolver:unref(zodResolver)(unref(signInSchema)),onSubmit:m},{default:withCtx(b=>[createBaseVNode("div",_hoisted_1$T,[createBaseVNode("label",{class:"mb-2 text-base font-medium opacity-80",for:emailInputId},toDisplayString(unref(l)("auth.login.emailLabel")),1),createVNode(unref(script$3),{id:emailInputId,autocomplete:"email",class:"h-10",name:"email",type:"text",placeholder:unref(l)("auth.login.emailPlaceholder"),invalid:b.email?.invalid},null,8,["placeholder","invalid"]),b.email?.invalid?(openBlock(),createElementBlock("small",_hoisted_2$E,toDisplayString(b.email.error.message),1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_3$s,[createBaseVNode("div",_hoisted_4$m,[createBaseVNode("label",_hoisted_5$k,toDisplayString(unref(l)("auth.login.passwordLabel")),1),createBaseVNode("span",{class:normalizeClass(["cursor-pointer text-base font-medium text-muted select-none",{"text-link-disabled":!b.email?.value||b.email?.invalid}]),onClick:p(w=>f(b.email?.value,b.email?.valid),"onClick")},toDisplayString(unref(l)("auth.login.forgotPassword")),11,_hoisted_6$c)]),createVNode(unref(script$u),{"input-id":"comfy-org-sign-in-password","pt:pc-input-text:root:autocomplete":"current-password",name:"password",feedback:!1,"toggle-mask":"",placeholder:unref(l)("auth.login.passwordPlaceholder"),class:normalizeClass([{"p-invalid":b.password?.invalid},"h-10"]),fluid:""},null,8,["placeholder","class"]),b.password?.invalid?(openBlock(),createElementBlock("small",_hoisted_7$b,toDisplayString(b.password.error.message),1)):createCommentVNode("",!0)]),a.value?(openBlock(),createBlock(unref(script$5),{key:0,class:"h-8 w-8"})):(openBlock(),createBlock(unref(script),{key:1,type:"submit",label:unref(l)("auth.login.loginButton"),class:"mt-4 h-10 font-medium"},null,8,["label"]))]),_:1},8,["resolver"]))}}),SignInForm=_export_sfc(_sfc_main$10,[["__scopeId","data-v-cf4d4a5d"]]),_hoisted_1$S={class:"mb-2 flex items-center justify-between"},_hoisted_2$D={class:"text-base font-medium opacity-80",for:"comfy-org-sign-up-password"},_hoisted_3$r={class:"flex flex-col gap-1"},_hoisted_4$l={key:0,class:"text-sm"},_hoisted_5$j={class:"mt-1 space-y-1"},_hoisted_6$b={class:"mb-2 text-base font-medium opacity-80",for:"comfy-org-sign-up-confirm-password"},_hoisted_7$a={key:0,class:"text-red-500"},_sfc_main$$=defineComponent({__name:"PasswordFields",setup(i){const{t:o}=useI18n(),n=ref(""),s=computed(()=>({length:n.value.length>=8&&n.value.length<=32,uppercase:/[A-Z]/.test(n.value),lowercase:/[a-z]/.test(n.value),number:/\d/.test(n.value),special:/[^A-Za-z0-9]/.test(n.value)}));return(a,r)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(unref(script$v),{name:"password",class:"flex flex-col gap-2"},{default:withCtx(l=>[createBaseVNode("div",_hoisted_1$S,[createBaseVNode("label",_hoisted_2$D,toDisplayString(unref(o)("auth.signup.passwordLabel")),1)]),createVNode(unref(script$u),{modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=u=>n.value=u),"input-id":"comfy-org-sign-up-password","pt:pc-input-text:root:autocomplete":"new-password",name:"password",feedback:!1,"toggle-mask":"",placeholder:unref(o)("auth.signup.passwordPlaceholder"),class:normalizeClass([{"p-invalid":l.invalid},"h-10"]),fluid:""},null,8,["modelValue","placeholder","class"]),createBaseVNode("div",_hoisted_3$r,[l.dirty||l.invalid?(openBlock(),createElementBlock("small",_hoisted_4$l,[createTextVNode(toDisplayString(unref(o)("validation.password.requirements"))+": ",1),createBaseVNode("ul",_hoisted_5$j,[createBaseVNode("li",{class:normalizeClass({"text-red-500":!s.value.length})},toDisplayString(unref(o)("validation.password.minLength")),3),createBaseVNode("li",{class:normalizeClass({"text-red-500":!s.value.uppercase})},toDisplayString(unref(o)("validation.password.uppercase")),3),createBaseVNode("li",{class:normalizeClass({"text-red-500":!s.value.lowercase})},toDisplayString(unref(o)("validation.password.lowercase")),3),createBaseVNode("li",{class:normalizeClass({"text-red-500":!s.value.number})},toDisplayString(unref(o)("validation.password.number")),3),createBaseVNode("li",{class:normalizeClass({"text-red-500":!s.value.special})},toDisplayString(unref(o)("validation.password.special")),3)])])):createCommentVNode("",!0)])]),_:1}),createVNode(unref(script$v),{name:"confirmPassword",class:"flex flex-col gap-2"},{default:withCtx(l=>[createBaseVNode("label",_hoisted_6$b,toDisplayString(unref(o)("auth.login.confirmPasswordLabel")),1),createVNode(unref(script$u),{name:"confirmPassword","input-id":"comfy-org-sign-up-confirm-password","pt:pc-input-text:root:autocomplete":"new-password",feedback:!1,"toggle-mask":"",placeholder:unref(o)("auth.login.confirmPasswordPlaceholder"),class:normalizeClass([{"p-invalid":l.invalid},"h-10"]),fluid:""},null,8,["placeholder","class"]),l.error?(openBlock(),createElementBlock("small",_hoisted_7$a,toDisplayString(l.error.message),1)):createCommentVNode("",!0)]),_:1})],64))}}),_hoisted_1$R={class:"mb-2 text-base font-medium opacity-80",for:"comfy-org-sign-up-email"},_hoisted_2$C={key:0,class:"text-red-500"},_sfc_main$_=defineComponent({__name:"SignUpForm",emits:["submit"],setup(i,{emit:o}){const{t:n}=useI18n(),s=o,a=p(r=>{r.valid&&s("submit",r.values)},"onSubmit");return(r,l)=>(openBlock(),createBlock(unref(script$t),{class:"flex flex-col gap-6",resolver:unref(zodResolver)(unref(signUpSchema)),onSubmit:a},{default:withCtx(()=>[createVNode(unref(script$v),{name:"email",class:"flex flex-col gap-2"},{default:withCtx(u=>[createBaseVNode("label",_hoisted_1$R,toDisplayString(unref(n)("auth.signup.emailLabel")),1),createVNode(unref(script$3),{"pt:root:id":"comfy-org-sign-up-email","pt:root:autocomplete":"email",class:"h-10",type:"text",placeholder:unref(n)("auth.signup.emailPlaceholder"),invalid:u.invalid},null,8,["placeholder","invalid"]),u.error?(openBlock(),createElementBlock("small",_hoisted_2$C,toDisplayString(u.error.message),1)):createCommentVNode("",!0)]),_:1}),createVNode(_sfc_main$$),createVNode(unref(script),{type:"submit",label:unref(n)("auth.signup.signUpButton"),class:"mt-4 h-10 font-medium"},null,8,["label"])]),_:1},8,["resolver"]))}}),_hoisted_1$Q={class:"w-96 overflow-x-hidden p-2"},_hoisted_2$B={class:"mb-8 flex flex-col gap-4"},_hoisted_3$q={class:"my-0 text-2xl leading-normal font-medium"},_hoisted_4$k={class:"my-0 text-base"},_hoisted_5$i={class:"text-muted"},_hoisted_6$a={class:"text-muted"},_hoisted_7$9={class:"flex flex-col gap-6"},_hoisted_8$8=["alt"],_hoisted_9$6={class:"text-center text-muted"},_hoisted_10$6=["href"],_hoisted_11$4={class:"mt-8 text-xs text-muted"},_hoisted_12$1={href:"https://www.comfy.org/terms-of-service",target:"_blank",class:"cursor-pointer text-blue-500"},_hoisted_13$1={href:"https://www.comfy.org/privacy",target:"_blank",class:"cursor-pointer text-blue-500"},_sfc_main$Z=defineComponent({__name:"SignInContent",props:{onSuccess:{type:Function}},setup(i){const{t:o}=useI18n(),n=useFirebaseAuthActions(),s=window.isSecureContext,a=ref(!0),r=ref(!1),l=isHostWhitelisted(normalizeHost(window.location.hostname)),u=computed(()=>configValueOrDefault(remoteConfig.value,"comfy_platform_base_url",getComfyPlatformBaseUrl())),m=p(()=>{a.value=!a.value,r.value=!1},"toggleState"),f=p(async()=>{await n.signInWithGoogle()&&i.onSuccess()},"signInWithGoogle"),_=p(async()=>{await n.signInWithGithub()&&i.onSuccess()},"signInWithGithub"),y=p(async k=>{await n.signInWithEmail(k.email,k.password)&&i.onSuccess()},"signInWithEmail"),b=p(async k=>{await n.signUpWithEmail(k.email,k.password)&&i.onSuccess()},"signUpWithEmail"),w=ref(!1);return onMounted(async()=>{w.value=await isInChina()}),onUnmounted(()=>{n.accessError.value=!1}),(k,S)=>(openBlock(),createElementBlock("div",_hoisted_1$Q,[r.value?(openBlock(),createBlock(_sfc_main$11,{key:0,onBack:S[0]||(S[0]=C=>r.value=!1),onSuccess:k.onSuccess},null,8,["onSuccess"])):(openBlock(),createElementBlock(Fragment,{key:1},[createBaseVNode("div",_hoisted_2$B,[createBaseVNode("h1",_hoisted_3$q,toDisplayString(a.value?unref(o)("auth.login.title"):unref(o)("auth.signup.title")),1),createBaseVNode("p",_hoisted_4$k,[createBaseVNode("span",_hoisted_5$i,toDisplayString(a.value?unref(o)("auth.login.newUser"):unref(o)("auth.signup.alreadyHaveAccount")),1),createBaseVNode("span",{class:"ml-1 cursor-pointer text-blue-500",onClick:m},toDisplayString(a.value?unref(o)("auth.login.signUp"):unref(o)("auth.signup.signIn")),1)])]),unref(s)?createCommentVNode("",!0):(openBlock(),createBlock(unref(script$1),{key:0,severity:"warn",class:"mb-4"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(o)("auth.login.insecureContextWarning")),1)]),_:1})),a.value?(openBlock(),createBlock(SignInForm,{key:1,onSubmit:y})):(openBlock(),createElementBlock(Fragment,{key:2},[w.value?(openBlock(),createBlock(unref(script$1),{key:0,severity:"warn",class:"mb-4"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(o)("auth.signup.regionRestrictionChina")),1)]),_:1})):(openBlock(),createBlock(_sfc_main$_,{key:1,onSubmit:b}))],64)),createVNode(unref(script$o),{align:"center",layout:"horizontal",class:"my-8"},{default:withCtx(()=>[createBaseVNode("span",_hoisted_6$a,toDisplayString(unref(o)("auth.login.orContinueWith")),1)]),_:1}),createBaseVNode("div",_hoisted_7$9,[unref(l)?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(unref(script),{type:"button",class:"h-10",severity:"secondary",outlined:"",onClick:f},{default:withCtx(()=>[S[2]||(S[2]=createBaseVNode("i",{class:"pi pi-google mr-2"},null,-1)),createTextVNode(" "+toDisplayString(a.value?unref(o)("auth.login.loginWithGoogle"):unref(o)("auth.signup.signUpWithGoogle")),1)]),_:1}),createVNode(unref(script),{type:"button",class:"h-10",severity:"secondary",outlined:"",onClick:_},{default:withCtx(()=>[S[3]||(S[3]=createBaseVNode("i",{class:"pi pi-github mr-2"},null,-1)),createTextVNode(" "+toDisplayString(a.value?unref(o)("auth.login.loginWithGithub"):unref(o)("auth.signup.signUpWithGithub")),1)]),_:1})],64)):createCommentVNode("",!0),createVNode(unref(script),{type:"button",class:"h-10",severity:"secondary",outlined:"",onClick:S[1]||(S[1]=C=>r.value=!0)},{default:withCtx(()=>[createBaseVNode("img",{src:_imports_0$1,class:"mr-2 h-5 w-5",alt:k.$t("g.comfy")},null,8,_hoisted_8$8),createTextVNode(" "+toDisplayString(unref(o)("auth.login.useApiKey")),1)]),_:1}),createBaseVNode("small",_hoisted_9$6,[createTextVNode(toDisplayString(unref(o)("auth.apiKey.helpText"))+" ",1),createBaseVNode("a",{href:`${u.value}/login`,target:"_blank",class:"cursor-pointer text-blue-500"},toDisplayString(unref(o)("auth.apiKey.generateKey")),9,_hoisted_10$6)]),unref(n).accessError.value?(openBlock(),createBlock(unref(script$1),{key:1,severity:"info",icon:"pi pi-info-circle",variant:"outlined",closable:""},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(o)("toastMessages.useApiKeyTip")),1)]),_:1})):createCommentVNode("",!0)]),createBaseVNode("p",_hoisted_11$4,[createTextVNode(toDisplayString(unref(o)("auth.login.termsText"))+" ",1),createBaseVNode("a",_hoisted_12$1,toDisplayString(unref(o)("auth.login.termsLink")),1),createTextVNode(" "+toDisplayString(unref(o)("auth.login.andText"))+" ",1),createBaseVNode("a",_hoisted_13$1,toDisplayString(unref(o)("auth.login.privacyLink")),1),createTextVNode(". "+toDisplayString(unref(o)("auth.login.questionsContactPrefix"))+" ",1),S[4]||(S[4]=createBaseVNode("a",{href:"mailto:hello@comfy.org",class:"cursor-pointer text-blue-500"}," hello@comfy.org",-1)),S[5]||(S[5]=createTextVNode(". "))])],64))]))}}),_hoisted_1$P={key:0,class:"flex items-center gap-1"},_hoisted_2$A={class:"flex items-center gap-2"},_hoisted_3$p={key:1,class:"flex items-center gap-1"},_sfc_main$Y=defineComponent({__name:"UserCredit",props:{textClass:{}},setup(i){const o=useFirebaseAuthStore(),n=computed(()=>o.isFetchingBalance),s=computed(()=>o.balance?formatMetronomeCurrency(o.balance.amount_micros,"usd"):"0.00");return(a,r)=>n.value?(openBlock(),createElementBlock("div",_hoisted_1$P,[createBaseVNode("div",_hoisted_2$A,[createVNode(unref(script$4),{shape:"circle",width:"1.5rem",height:"1.5rem"})]),r[0]||(r[0]=createBaseVNode("div",{class:"flex-1"},null,-1)),createVNode(unref(script$4),{width:"8rem",height:"2rem"})])):(openBlock(),createElementBlock("div",_hoisted_3$p,[createVNode(unref(script$m),{severity:"secondary",icon:"pi pi-dollar",rounded:"",class:"p-1 text-amber-400"}),createBaseVNode("div",{class:normalizeClass(a.textClass)},toDisplayString(s.value),3)]))}}),_hoisted_1$O={class:"flex items-center gap-2"},_hoisted_2$z={key:1,class:"text-xl"},_sfc_main$X=defineComponent({__name:"CreditTopUpOption",props:{amount:{},preselected:{type:Boolean},editable:{type:Boolean,default:!1}},setup(i){const o=useFirebaseAuthActions(),n=ref(i.amount),s=ref(!1),a=ref(!1),r=p(async()=>{const l=i.editable?n.value:i.amount;a.value=!0,await o.purchaseCredits(l),a.value=!1,s.value=!0},"handleBuyNow");return onBeforeUnmount(()=>{s.value&&o.fetchBalance()}),(l,u)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$O,[createVNode(unref(script$m),{severity:"secondary",icon:"pi pi-dollar",rounded:"",class:"p-1 text-amber-400"}),l.editable?(openBlock(),createBlock(unref(script$w),{key:0,modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=m=>n.value=m),min:1,max:1e3,step:1,"show-buttons":"","allow-empty":!1,"highlight-on-focus":!0,"pt:pc-input-text:root":"w-24",onBlur:u[1]||(u[1]=m=>n.value=Number(m.value)),onInput:u[2]||(u[2]=m=>n.value=Number(m.value))},null,8,["modelValue"])):(openBlock(),createElementBlock("span",_hoisted_2$z,toDisplayString(l.amount),1))]),a.value?(openBlock(),createBlock(unref(script$5),{key:0,class:"h-8 w-8"})):(openBlock(),createBlock(unref(script),{key:1,severity:l.preselected?"primary":"secondary",outlined:!l.preselected,label:l.$t("credits.topUp.buyNow"),onClick:r},null,8,["severity","outlined","label"]))],64))}}),_hoisted_1$N={class:"flex w-96 flex-col gap-10 p-2"},_hoisted_2$y={key:0,class:"flex flex-col gap-4"},_hoisted_3$o={class:"my-0 text-2xl leading-normal font-medium"},_hoisted_4$j={class:"my-0 text-base"},_hoisted_5$h={class:"flex items-center justify-between"},_hoisted_6$9={class:"flex w-full flex-col gap-2"},_hoisted_7$8={class:"text-base text-muted"},_hoisted_8$7={class:"flex w-full items-center justify-between"},_hoisted_9$5={class:"flex flex-col gap-2"},_hoisted_10$5={class:"text-sm text-muted"},_hoisted_11$3={class:"grid grid-cols-[2fr_1fr] gap-2"},_sfc_main$W=defineComponent({__name:"TopUpCreditsDialogContent",props:{isInsufficientCredits:{type:Boolean,default:!1},amountOptions:{default:p(()=>[5,10,20,50],"default")},preselectedAmountOption:{default:10}},setup(i){const o=useFirebaseAuthActions(),n=p(async()=>{await o.accessBillingPortal()},"handleSeeDetails");return(s,a)=>(openBlock(),createElementBlock("div",_hoisted_1$N,[s.isInsufficientCredits?(openBlock(),createElementBlock("div",_hoisted_2$y,[createBaseVNode("h1",_hoisted_3$o,toDisplayString(s.$t("credits.topUp.insufficientTitle")),1),createBaseVNode("p",_hoisted_4$j,toDisplayString(s.$t("credits.topUp.insufficientMessage")),1)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_5$h,[createBaseVNode("div",_hoisted_6$9,[createBaseVNode("div",_hoisted_7$8,toDisplayString(s.$t("credits.yourCreditBalance")),1),createBaseVNode("div",_hoisted_8$7,[createVNode(_sfc_main$Y,{"text-class":"text-2xl"}),createVNode(unref(script),{outlined:"",severity:"secondary",label:s.$t("credits.topUp.seeDetails"),icon:"pi pi-arrow-up-right",onClick:n},null,8,["label"])])])]),createBaseVNode("div",_hoisted_9$5,[createBaseVNode("span",_hoisted_10$5,toDisplayString(s.$t("credits.topUp.quickPurchase"))+":",1),createBaseVNode("div",_hoisted_11$3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(s.amountOptions,r=>(openBlock(),createBlock(_sfc_main$X,{key:r,amount:r,preselected:r===s.preselectedAmountOption},null,8,["amount","preselected"]))),128)),createVNode(_sfc_main$X,{amount:100,preselected:!1,editable:""})])])]))}}),_sfc_main$V=defineComponent({__name:"UpdatePasswordContent",props:{onSuccess:{type:Function}},setup(i){const o=useFirebaseAuthActions(),n=ref(!1),s=p(async a=>{if(a.valid){n.value=!0;try{await o.updatePassword(a.values.password),i.onSuccess()}finally{n.value=!1}}},"onSubmit");return(a,r)=>(openBlock(),createBlock(unref(script$t),{class:"flex w-96 flex-col gap-6",resolver:unref(zodResolver)(unref(updatePasswordSchema)),onSubmit:s},{default:withCtx(()=>[createVNode(_sfc_main$$),createVNode(unref(script),{type:"submit",label:a.$t("userSettings.updatePassword"),class:"mt-4 h-10 font-medium",loading:n.value},null,8,["label","loading"])]),_:1},8,["resolver"]))}}),_imports_0=""+new URL("images/comfy-logo-single.svg",import.meta.url).href,_sfc_main$U={},_hoisted_1$M={class:"px-2 py-4"},_hoisted_2$x=["alt"];function _sfc_render$2(i,o){return openBlock(),createElementBlock("div",_hoisted_1$M,[createBaseVNode("img",{src:_imports_0,alt:i.$t("g.comfyOrgLogoAlt"),width:"32",height:"32"},null,8,_hoisted_2$x)])}p(_sfc_render$2,"_sfc_render$2");const ComfyOrgHeader=_export_sfc(_sfc_main$U,[["render",_sfc_render$2]]),_hoisted_1$L={class:"px-4"},_sfc_main$T=defineComponent({__name:"SettingDialogHeader",setup(i){return(o,n)=>(openBlock(),createElementBlock("div",null,[createBaseVNode("h2",_hoisted_1$L,[n[0]||(n[0]=createBaseVNode("i",{class:"pi pi-cog"},null,-1)),createBaseVNode("span",null,toDisplayString(o.$t("g.settings")),1),createCommentVNode("",!0)])]))}}),SettingDialogHeader=_export_sfc(_sfc_main$T,[["__scopeId","data-v-45e39e74"]]),useUserStore=defineStore("user",()=>{const i=ref(null),o=ref(null),n=computed(()=>i.value&&"users"in i.value),s=computed(()=>!o.value&&n.value),a=computed(()=>Object.entries(i.value?.users??{}).map(([y,b])=>({userId:y,username:b}))),r=computed(()=>a.value.find(y=>y.userId===o.value)??null),l=computed(()=>i.value!==null);async function u(){i.value=await api.getUserConfig(),o.value=localStorage["Comfy.userId"]}p(u,"initialize");async function m(y){const b=await api.createUser(y),w=await b.json();if(b.status>=300)throw new Error(w.error??"Error creating user: "+b.status+" "+b.statusText);return{userId:w,username:y}}p(m,"createUser");async function f({userId:y,username:b}){o.value=y,localStorage["Comfy.userId"]=y,localStorage["Comfy.userName"]=b}p(f,"login"),watchEffect(()=>{n.value&&o.value&&(api.user=o.value)});async function _(){delete localStorage["Comfy.userId"],delete localStorage["Comfy.userName"]}return p(_,"logout"),{users:a,currentUser:r,isMultiUserServer:n,needsLogin:s,initialized:l,initialize:u,createUser:m,login:f,logout:_}}),_hoisted_1$K={class:"flex items-center justify-between"},_sfc_main$S=defineComponent({__name:"CurrentUserMessage",setup(i){const o=useUserStore(),n=p(async()=>{await o.logout(),window.location.reload()},"logout");return(s,a)=>unref(o).isMultiUserServer?(openBlock(),createBlock(unref(script$1),{key:0,severity:"info",icon:"pi pi-user","pt:text":"w-full"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$K,[createBaseVNode("div",null,toDisplayString(s.$t("g.currentUser"))+": "+toDisplayString(unref(o).currentUser?.username),1),createVNode(unref(script),{icon:"pi pi-sign-out",text:"",onClick:n})])]),_:1})):createCommentVNode("",!0)}}),_hoisted_1$J={class:"flex h-full w-full flex-col gap-2"},_sfc_main$R=defineComponent({__name:"PanelTemplate",props:{value:{},class:{}},setup(i){const o=i;return(n,s)=>(openBlock(),createBlock(unref(script$x),{value:o.value,class:normalizeClass(["h-full w-full",o.class])},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$J,[renderSlot(n.$slots,"header"),createVNode(unref(script$c),{class:"h-0 grow pr-2"},{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3}),renderSlot(n.$slots,"footer")])]),_:3},8,["value","class"]))}}),_hoisted_1$I={class:"flex items-center justify-between"},_hoisted_2$w={class:"actions"},_sfc_main$Q=defineComponent({__name:"ColorPaletteMessage",setup(i){const o=useSettingStore(),n=useColorPaletteStore(),s=useColorPaletteService(),{palettes:a,activePaletteId:r}=storeToRefs(n),l=p(async()=>{const u=await s.importColorPalette();u&&await o.set("Comfy.ColorPalette",u.id)},"importCustomPalette");return(u,m)=>(openBlock(),createBlock(unref(script$1),{severity:"info",icon:"pi pi-palette","pt:text":"w-full"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$I,[createBaseVNode("div",null,toDisplayString(u.$t("settingsCategories.ColorPalette")),1),createBaseVNode("div",_hoisted_2$w,[createVNode(unref(script$7),{modelValue:unref(r),"onUpdate:modelValue":m[0]||(m[0]=f=>isRef(r)?r.value=f:null),class:"w-44",options:unref(a),"option-label":"name","option-value":"id"},null,8,["modelValue","options"]),createVNode(unref(script),{icon:"pi pi-file-export",text:"",title:u.$t("g.export"),onClick:m[1]||(m[1]=f=>unref(s).exportColorPalette(unref(r)))},null,8,["title"]),createVNode(unref(script),{icon:"pi pi-file-import",text:"",title:u.$t("g.import"),onClick:l},null,8,["title"]),createVNode(unref(script),{icon:"pi pi-trash",severity:"danger",text:"",title:u.$t("g.delete"),disabled:!unref(n).isCustomPalette(unref(r)),onClick:m[2]||(m[2]=f=>unref(s).deleteCustomColorPalette(unref(r)))},null,8,["title","disabled"])])])]),_:1}))}}),_hoisted_1$H={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function render(i,o){return openBlock(),createElementBlock("svg",_hoisted_1$H,o[0]||(o[0]=[createBaseVNode("path",{fill:"currentColor",d:"M5 21q-1.275 0-1.812-1.137t.262-2.113L9 11V5H8q-.425 0-.712-.288T7 4t.288-.712T8 3h8q.425 0 .713.288T17 4t-.288.713T16 5h-1v6l5.55 6.75q.8.975.263 2.113T19 21zm2-3h10l-3.4-4h-3.2zm-2 1h14l-6-7.3V5h-2v6.7zm7-7"},null,-1)]))}p(render,"render");const __unplugin_components_0=markRaw({name:"material-symbols-experiment-outline",render}),_hoisted_1$G={class:"flex gap-2"},_sfc_main$P=defineComponent({__name:"BackgroundImageUpload",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const o=useModel(i,"modelValue"),n=ref(null),s=ref(!1),a=p(()=>{n.value?.click()},"triggerFileInput"),r=p(async m=>{const f=new FormData;f.append("image",m),f.append("subfolder","backgrounds");const _=await api.fetchApi("/upload/image",{method:"POST",body:f});if(_.status!==200)return useToastStore().addAlert(`Upload failed: ${_.status} - ${_.statusText}`),null;const y=await _.json();return y.subfolder?`${y.subfolder}/${y.name}`:y.name},"uploadFile"),l=p(async m=>{const f=m.target;if(f.files&&f.files[0]){const _=f.files[0];s.value=!0;try{const y=await r(_);if(y){const b=new URLSearchParams({filename:y,type:"input",subfolder:"backgrounds"});o.value=`/api/view?${b.toString()}`}}catch(y){useToastStore().addAlert(`Upload error: ${String(y)}`)}finally{s.value=!1}}},"handleFileUpload"),u=p(()=>{o.value="",n.value&&(n.value.value="")},"clearImage");return(m,f)=>{const _=resolveDirective("tooltip");return openBlock(),createElementBlock("div",_hoisted_1$G,[createVNode(unref(script$3),{modelValue:o.value,"onUpdate:modelValue":f[0]||(f[0]=y=>o.value=y),class:"flex-1",placeholder:m.$t("g.imageUrl")},null,8,["modelValue","placeholder"]),withDirectives(createVNode(unref(script),{icon:s.value?"pi pi-spin pi-spinner":"pi pi-upload",size:"small",disabled:s.value,onClick:a},null,8,["icon","disabled"]),[[_,m.$t("g.upload")]]),withDirectives(createVNode(unref(script),{outlined:"",icon:"pi pi-trash",severity:"danger",size:"small",disabled:!o.value,onClick:u},null,8,["disabled"]),[[_,m.$t("g.clear")]]),createBaseVNode("input",{ref_key:"fileInput",ref:n,type:"file",class:"hidden",accept:"image/*",onChange:l},null,544)])}}}),_sfc_main$O=defineComponent({__name:"CustomFormValue",props:{renderFunction:{type:Function}},setup(i){const o=i,n=ref(null);function s(){if(n.value){n.value.innerHTML="";const a=o.renderFunction();n.value.appendChild(a)}}return p(s,"renderContent"),onMounted(s),watch(()=>o.renderFunction,s),(a,r)=>(openBlock(),createElementBlock("div",{ref_key:"container",ref:n},null,512))}}),_hoisted_1$F={class:"color-picker-wrapper flex items-center gap-2"},_sfc_main$N=defineComponent({inheritAttrs:!1,__name:"FormColorPicker",props:mergeModels({defaultValue:{},label:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const o=useModel(i,"modelValue");return(n,s)=>(openBlock(),createElementBlock("div",_hoisted_1$F,[createVNode(unref(script$n),mergeProps({modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=a=>o.value=a)},n.$attrs),null,16,["modelValue"]),createVNode(unref(script$3),{modelValue:o.value,"onUpdate:modelValue":s[1]||(s[1]=a=>o.value=a),class:"w-28",placeholder:n.label},null,8,["modelValue","placeholder"])]))}}),_hoisted_1$E={class:"image-upload-wrapper"},_hoisted_2$v={class:"flex items-center gap-2"},_hoisted_3$n=["src"],_hoisted_4$i={key:1,class:"pi pi-image text-xl text-smoke-400"},_hoisted_5$g={class:"flex flex-col gap-2"},_sfc_main$M=defineComponent({__name:"FormImageUpload",props:{modelValue:{}},emits:["update:modelValue"],setup(i,{emit:o}){const n=o,s=ref(null),a=p(()=>{s.value?.click()},"triggerFileInput"),r=p(u=>{const m=u.target;if(m.files&&m.files[0]){const f=m.files[0],_=new FileReader;_.onload=y=>{n("update:modelValue",y.target?.result)},_.readAsDataURL(f)}},"handleFileUpload"),l=p(()=>{n("update:modelValue",""),s.value&&(s.value.value="")},"clearImage");return(u,m)=>(openBlock(),createElementBlock("div",_hoisted_1$E,[createBaseVNode("div",_hoisted_2$v,[createBaseVNode("div",{class:normalizeClass(["preview-box flex h-16 w-16 items-center justify-center rounded border p-2",{"bg-base-background":!u.modelValue}])},[u.modelValue?(openBlock(),createElementBlock("img",{key:0,src:u.modelValue,class:"max-h-full max-w-full object-contain"},null,8,_hoisted_3$n)):(openBlock(),createElementBlock("i",_hoisted_4$i))],2),createBaseVNode("div",_hoisted_5$g,[createVNode(unref(script),{icon:"pi pi-upload",label:u.$t("g.upload"),size:"small",onClick:a},null,8,["label"]),u.modelValue?(openBlock(),createBlock(unref(script),{key:0,class:"w-full",outlined:"",icon:"pi pi-trash",severity:"danger",size:"small",onClick:l})):createCommentVNode("",!0)])]),createBaseVNode("input",{ref_key:"fileInput",ref:s,type:"file",class:"hidden",accept:"image/*",onChange:r},null,544)]))}}),_hoisted_1$D={class:"flex flex-row gap-4"},_hoisted_2$u=["for"],_sfc_main$L=defineComponent({__name:"FormRadioGroup",props:{modelValue:{},options:{},optionLabel:{},optionValue:{},id:{}},emits:["update:modelValue"],setup(i){const o=i,n=computed(()=>o.options?o.options.map(s=>typeof s=="string"?{text:s,value:s}:"text"in s?{text:s.text,value:s.value??s.text}:{text:s[o.optionLabel||"text"]||"Unknown",value:s[o.optionValue||"value"]}):[]);return(s,a)=>(openBlock(),createElementBlock("div",_hoisted_1$D,[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,r=>(openBlock(),createElementBlock("div",{key:r.value,class:"flex items-center"},[createVNode(unref(script$y),{"input-id":`${s.id}-${r.value}`,name:s.id,value:r.value,"model-value":s.modelValue,"aria-describedby":`${r.text}-label`,"onUpdate:modelValue":a[0]||(a[0]=l=>s.$emit("update:modelValue",l))},null,8,["input-id","name","value","model-value","aria-describedby"]),createBaseVNode("label",{for:`${s.id}-${r.value}`,class:"ml-2 cursor-pointer"},toDisplayString(r.text),9,_hoisted_2$u)]))),128))]))}}),_hoisted_1$C={class:"input-knob flex flex-row items-center gap-2"},_sfc_main$K=defineComponent({inheritAttrs:!1,__name:"InputKnob",props:{modelValue:{},inputClass:{},knobClass:{},min:{},max:{},step:{},resolution:{}},emits:["update:modelValue"],setup(i,{emit:o}){const n=i,s=o,a=ref(n.modelValue);watch(()=>n.modelValue,u=>{a.value=u});const r=p(u=>{u===null&&(u=Number(n.min)||0);const m=Number(n.min??Number.NEGATIVE_INFINITY),f=Number(n.max??Number.POSITIVE_INFINITY),_=Number(n.step)||1;u=Math.max(m,Math.min(f,u)),u=Math.round(u/_)*_,a.value=u,s("update:modelValue",u)},"updateValue"),l=p(u=>{r(u);const m=(n.step??1).toString(),f=m.includes(".")?m.split(".")[1].length:0;return u.toFixed(n.resolution??f)},"displayValue");return(u,m)=>(openBlock(),createElementBlock("div",_hoisted_1$C,[createVNode(unref(script$z),mergeProps({"model-value":u.modelValue,"value-template":l,class:["knob-part",u.knobClass],min:u.min,max:u.max,step:u.step},u.$attrs,{"onUpdate:modelValue":r}),null,16,["model-value","class","min","max","step"]),createVNode(unref(script$w),{"model-value":u.modelValue,class:normalizeClass(["input-part",u.inputClass]),"max-fraction-digits":3,min:u.min,max:u.max,step:u.step,"allow-empty":!1,"onUpdate:modelValue":r},null,8,["model-value","class","min","max","step"])]))}}),_hoisted_1$B={class:"input-slider flex flex-row items-center gap-2"},_sfc_main$J=defineComponent({inheritAttrs:!1,__name:"InputSlider",props:{modelValue:{},inputClass:{},sliderClass:{},min:{},max:{},step:{}},emits:["update:modelValue"],setup(i,{emit:o}){const n=i,s=o,a=ref(n.modelValue);watch(()=>n.modelValue,l=>{a.value=l});const r=p(l=>{l===null&&(l=Number(n.min)||0);const u=Number(n.min??Number.NEGATIVE_INFINITY),m=Number(n.max??Number.POSITIVE_INFINITY),f=Number(n.step)||1;l=Math.max(u,Math.min(m,l)),l=Math.round(l/f)*f,a.value=l,s("update:modelValue",l)},"updateValue");return(l,u)=>(openBlock(),createElementBlock("div",_hoisted_1$B,[createVNode(unref(script$8),mergeProps({"model-value":l.modelValue,class:["slider-part",l.sliderClass],min:l.min,max:l.max,step:l.step},l.$attrs,{"onUpdate:modelValue":u[0]||(u[0]=m=>r(m))}),null,16,["model-value","class","min","max","step"]),createVNode(unref(script$w),{"model-value":l.modelValue,class:normalizeClass(["input-part",l.inputClass]),"max-fraction-digits":3,min:l.min,max:l.max,step:l.step,"allow-empty":!1,"onUpdate:modelValue":r},null,8,["model-value","class","min","max","step"])]))}});var ValidationState=(i=>(i.IDLE="IDLE",i.LOADING="LOADING",i.VALID="VALID",i.INVALID="INVALID",i))(ValidationState||{});const _sfc_main$I=defineComponent({inheritAttrs:!1,__name:"UrlInput",props:{modelValue:{},validateUrlFn:{type:Function}},emits:["update:modelValue","state-change"],setup(i,{emit:o}){const n=i,s=o,a=ref(ValidationState.IDLE),r=p(y=>y?y.replace(/\s+/g,""):"","cleanInput"),l=ref(r(n.modelValue));watch(()=>n.modelValue,async y=>{l.value=r(y),await _(y)}),watch(a,y=>{s("state-change",y)}),onMounted(async()=>{await _(n.modelValue)});const u=p(y=>{l.value=r(y??""),a.value=ValidationState.IDLE},"handleInput"),m=p(async()=>{const y=r(l.value);let b=y;try{b=new URL(y).toString()}catch{}s("update:modelValue",b)},"handleBlur"),f=p(async y=>{if(!isValidUrl(y))return!1;try{return await checkUrlReachable(y)}catch{return!1}},"defaultValidateUrl"),_=p(async y=>{if(a.value===ValidationState.LOADING)return;const b=r(y);if(a.value=ValidationState.IDLE,!!b){a.value=ValidationState.LOADING;try{const w=await(n.validateUrlFn??f)(b);a.value=w?ValidationState.VALID:ValidationState.INVALID}catch{a.value=ValidationState.INVALID}}},"validateUrl");return(y,b)=>(openBlock(),createBlock(unref(script$g),{class:"w-full"},{default:withCtx(()=>[createVNode(unref(script$3),mergeProps(y.$attrs,{"model-value":l.value,class:"w-full",invalid:a.value===unref(ValidationState).INVALID,"onUpdate:modelValue":u,onBlur:m}),null,16,["model-value","invalid"]),createVNode(unref(script$f),{class:normalizeClass({"pi pi-spin pi-spinner text-neutral-400":a.value===unref(ValidationState).LOADING,"pi pi-check cursor-pointer text-green-500":a.value===unref(ValidationState).VALID,"pi pi-times cursor-pointer text-red-500":a.value===unref(ValidationState).INVALID}),onClick:b[0]||(b[0]=w=>_(n.modelValue))},null,8,["class"])]),_:1}))}}),_hoisted_1$A={class:"flex flex-row items-center gap-2"},_hoisted_2$t={class:"form-label flex grow items-center"},_hoisted_3$m=["id"],_hoisted_4$h={key:0,class:"pi pi-info-circle bg-transparent"},_hoisted_5$f={class:"form-input flex justify-end"},_sfc_main$H=defineComponent({__name:"FormItem",props:mergeModels({item:{},id:{},labelClass:{}},{formValue:{},formValueModifiers:{}}),emits:["update:formValue"],setup(i){const o=useModel(i,"formValue"),n=i;function s(r){const l={...r.attrs||{}},u=r.type;switch(typeof u=="function"&&(l.renderFunction=()=>u(n.item.name,m=>o.value=m,o.value,r.attrs)),r.type){case"combo":case"radio":l.options=typeof r.options=="function"?r.options(o.value):r.options,typeof r.options?.[0]!="string"&&(l.optionLabel="text",l.optionValue="value");break}return l}p(s,"getFormAttrs");function a(r){if(typeof r.type=="function")return _sfc_main$O;switch(r.type){case"boolean":return script$A;case"number":return script$w;case"slider":return _sfc_main$J;case"knob":return _sfc_main$K;case"combo":return script$7;case"radio":return _sfc_main$L;case"image":return _sfc_main$M;case"color":return _sfc_main$N;case"url":return _sfc_main$I;case"backgroundImage":return _sfc_main$P;default:return script$3}}return p(a,"getFormComponent"),(r,l)=>{const u=resolveDirective("tooltip");return openBlock(),createElementBlock("div",_hoisted_1$A,[createBaseVNode("div",_hoisted_2$t,[createBaseVNode("span",{id:`${n.id}-label`,class:normalizeClass(["text-muted",n.labelClass])},[renderSlot(r.$slots,"name-prefix",{},void 0,!0),createTextVNode(" "+toDisplayString(n.item.name)+" ",1),n.item.tooltip?withDirectives((openBlock(),createElementBlock("i",_hoisted_4$h,null,512)),[[u,n.item.tooltip]]):createCommentVNode("",!0),renderSlot(r.$slots,"name-suffix",{},void 0,!0)],10,_hoisted_3$m)]),createBaseVNode("div",_hoisted_5$f,[(openBlock(),createBlock(resolveDynamicComponent(markRaw(a(n.item))),mergeProps({id:n.id,"model-value":o.value,"onUpdate:modelValue":l[0]||(l[0]=m=>o.value=m),"aria-labelledby":`${n.id}-label`},s(n.item)),null,16,["id","model-value","aria-labelledby"]))])])}}}),FormItem=_export_sfc(_sfc_main$H,[["__scopeId","data-v-cd19ee1f"]]),_sfc_main$G=defineComponent({__name:"SettingItem",props:{setting:{}},setup(i){const o=i,{t:n}=useI18n();function s(m){return typeof m=="function"?s(m(o.setting.value??"")):m.map(f=>{const _=typeof f=="string"?f:f.text,y=typeof f=="string"?f:f.value;return{text:n(`settings.${normalizeI18nKey(o.setting.id)}.options.${normalizeI18nKey(_)}`,_),value:y}})}p(s,"translateOptions");const a=computed(()=>{const m=normalizeI18nKey(o.setting.id);return{...o.setting,name:n(`settings.${m}.name`,o.setting.name),tooltip:o.setting.tooltip?st(`settings.${m}.tooltip`,o.setting.tooltip):void 0,options:o.setting.options?s(o.setting.options):void 0}}),r=useSettingStore(),l=computed(()=>r.get(o.setting.id)),u=p(async m=>{const f=o.setting.id;l.value,await r.set(f,m),r.get(f)},"updateSettingValue");return(m,f)=>{const _=__unplugin_components_0,y=resolveDirective("tooltip");return openBlock(),createBlock(FormItem,{id:m.setting.id,item:a.value,"form-value":l.value,"onUpdate:formValue":u},{"name-prefix":withCtx(()=>[m.setting.id==="Comfy.Locale"?(openBlock(),createBlock(unref(script$m),{key:0,class:"pi pi-language"})):createCommentVNode("",!0),m.setting.experimental?withDirectives((openBlock(),createBlock(unref(script$m),{key:1},{icon:withCtx(()=>[createVNode(_)]),_:1})),[[y,{value:m.$t("g.experimental"),showDelay:600}]]):createCommentVNode("",!0)]),_:1},8,["id","item","form-value"])}}}),_hoisted_1$z={class:"setting-group"},_sfc_main$F=defineComponent({__name:"SettingGroup",props:{group:{},divider:{type:Boolean}},setup(i){return(o,n)=>(openBlock(),createElementBlock("div",_hoisted_1$z,[o.divider?(openBlock(),createBlock(unref(script$o),{key:0})):createCommentVNode("",!0),createBaseVNode("h3",null,toDisplayString(o.$t(`settingsCategories.${unref(normalizeI18nKey)(o.group.label)}`,o.group.label)),1),(openBlock(!0),createElementBlock(Fragment,null,renderList(o.group.settings.filter(s=>!s.deprecated),s=>(openBlock(),createElementBlock("div",{key:s.id,class:"setting-item mb-4"},[createVNode(_sfc_main$G,{setting:s},null,8,["setting"])]))),128))]))}}),_hoisted_1$y={key:0},_sfc_main$E=defineComponent({__name:"SettingsPanel",props:{settingGroups:{}},setup(i){const o=i;return(n,s)=>o.settingGroups.length>0?(openBlock(),createElementBlock("div",_hoisted_1$y,[(openBlock(!0),createElementBlock(Fragment,null,renderList(o.settingGroups,(a,r)=>(openBlock(),createBlock(_sfc_main$F,{key:a.label,divider:r!==0,group:a},null,8,["divider","group"]))),128))])):(openBlock(),createBlock(NoResultsPlaceholder,{key:1,icon:"pi pi-search",title:n.$t("g.noResultsFound"),message:n.$t("g.searchFailedMessage")},null,8,["title","message"]))}});function useSettingSearch(){const i=useSettingStore(),{shouldRenderVueNodes:o}=useVueFeatureFlags(),n=ref(""),s=ref([]),a=ref(!1);watch(n,()=>a.value=!0);const r=computed(()=>new Set(s.value.map(_=>getSettingInfo(i.settingsById[_]).category))),l=computed(()=>n.value.length===0),u=computed(()=>!l.value&&!a.value);return{searchQuery:n,filteredSettingIds:s,searchInProgress:a,searchResultsCategories:r,queryIsEmpty:l,inSearch:u,handleSearch:p(_=>{if(!_){s.value=[];return}const y=_.toLocaleLowerCase(),w=Object.values(i.settingsById).filter(k=>{if(k.type==="hidden"||k.deprecated||o.value&&k.hideInVueNodes)return!1;const S=k.id.toLowerCase(),C=k.name.toLowerCase(),I=st(`settings.${normalizeI18nKey(k.id)}.name`,k.name).toLocaleLowerCase(),T=getSettingInfo(k),E=st(`settingsCategories.${normalizeI18nKey(T.category)}`,T.category).toLocaleLowerCase(),N=st(`settingsCategories.${normalizeI18nKey(T.subCategory)}`,T.subCategory).toLocaleLowerCase();return S.includes(y)||C.includes(y)||I.includes(y)||E.includes(y)||N.includes(y)});s.value=w.map(k=>k.id),a.value=!1},"handleSearch"),getSearchResults:p(_=>{const y={};return s.value.forEach(b=>{const w=i.settingsById[b],k=getSettingInfo(w),S=k.subCategory;(_===null||_.label===k.category)&&(y[S]||(y[S]=[]),y[S].push(w))}),Object.entries(y).map(([b,w])=>({label:b,settings:w}))},"getSearchResults")}}p(useSettingSearch,"useSettingSearch");function useSettingUI(i){const{t:o}=useI18n(),{isLoggedIn:n}=useCurrentUser(),s=useSettingStore(),a=ref(null),{shouldRenderVueNodes:r}=useVueFeatureFlags(),l=computed(()=>{const E=buildTree(Object.values(s.settingsById).filter(L=>L.type!=="hidden"&&!(r.value&&L.hideInVueNodes)),L=>L.category||L.id.split(".")),N=(E.children??[]).filter(L=>L.leaf);return N.length&&(E.children=(E.children??[]).filter(L=>!L.leaf),E.children.push({key:"Other",label:"Other",leaf:!1,children:N})),E}),u=computed(()=>l.value.children??[]),m={node:{key:"about",label:"About",children:[]},component:defineAsyncComponent(()=>__vitePreload(()=>import("./AboutPanel-CA8QIU54.js"),__vite__mapDeps([50,5,1,2,9,10,11,12,13]),import.meta.url))},f={node:{key:"credits",label:"Credits",children:[]},component:defineAsyncComponent(()=>__vitePreload(()=>import("./CreditsPanel-DtIWzS1h.js"),__vite__mapDeps([51,5,1,2,9,10,11,12,13]),import.meta.url))},_=null,y={node:{key:"user",label:"User",children:[]},component:defineAsyncComponent(()=>__vitePreload(()=>import("./UserPanel-pAKycb4S.js"),__vite__mapDeps([52,5,1,2,53,9,10,11,12,13]),import.meta.url))},b={node:{key:"keybinding",label:"Keybinding",children:[]},component:defineAsyncComponent(()=>__vitePreload(()=>import("./KeybindingPanel-qQrbj6Fg.js"),__vite__mapDeps([54,1,2,5,9,55,10,11,12,13,56]),import.meta.url))},w={node:{key:"extension",label:"Extension",children:[]},component:defineAsyncComponent(()=>__vitePreload(()=>import("./ExtensionPanel-B5wIUQFP.js"),__vite__mapDeps([57,5,1,2,9,10,11,12,13]),import.meta.url))},k={node:{key:"server-config",label:"Server-Config",children:[]},component:defineAsyncComponent(()=>__vitePreload(()=>import("./ServerConfigPanel-BjtPWljf.js"),__vite__mapDeps([58,9,1,2,5,59,10,11,12,13]),import.meta.url))},S=computed(()=>[m,f,y,b,w,...isElectron()?[k]:[]].filter(E=>E.component)),C=computed(()=>{if(!i)return u.value[0];for(const E of T.value){const N=E.children?.find(L=>L.key===i);if(N)return N}return u.value[0]}),I=p(E=>({...E,translatedLabel:o(`settingsCategories.${normalizeI18nKey(E.label)}`,E.label)}),"translateCategory"),T=computed(()=>[{key:"account",label:"Account",children:[y.node,...n.value&&isCloud&&window.__CONFIG__?.subscription_required&&_?[_.node]:[],...n.value&&!isCloud?[f.node]:[]].map(I)},{key:"settings",label:"Application Settings",children:u.value.map(I)},{key:"specialSettings",label:"Special Settings",children:[b.node,w.node,m.node,...isElectron()?[k.node]:[]].map(I)}]);return onMounted(()=>{a.value=C.value}),{panels:S,activeCategory:a,defaultCategory:C,groupedMenuTreeNodes:T,settingCategories:u}}p(useSettingUI,"useSettingUI");const _hoisted_1$x={class:"settings-container"},_sfc_main$D=defineComponent({__name:"SettingDialogContent",props:{defaultPanel:{}},setup(i){const{activeCategory:o,defaultCategory:n,settingCategories:s,groupedMenuTreeNodes:a,panels:r}=useSettingUI(i.defaultPanel),{searchQuery:l,searchResultsCategories:u,queryIsEmpty:m,inSearch:f,handleSearch:_,getSearchResults:y}=useSettingSearch(),b=useFirebaseAuthActions(),w=p(T=>Math.max(0,...flattenTree(T).map(E=>E.sortOrder??0)),"getGroupSortOrder"),k=p(T=>[...T.children??[]].sort((E,N)=>{const L=w(N)-w(E);return L!==0?L:E.label.localeCompare(N.label)}).map(E=>({label:E.label,settings:flattenTree(E).sort((N,L)=>{const A=N.sortOrder??0;return(L.sortOrder??0)-A})})),"sortedGroups"),S=p(T=>{_(T.trim()),o.value=T?null:n.value},"handleSearch"),C=computed(()=>y(o.value)),I=computed(()=>f.value?"Search Results":o.value?.label??"");return watch(o,(T,E)=>{I.value||(o.value=E),o.value?.key==="credits"&&b.fetchBalance()}),(T,E)=>(openBlock(),createElementBlock("div",_hoisted_1$x,[createVNode(unref(script$c),{class:"settings-sidebar w-48 shrink-0 p-2 2xl:w-64"},{default:withCtx(()=>[createVNode(SearchBox,{"model-value":unref(l),"onUpdate:modelValue":E[0]||(E[0]=N=>isRef(l)?l.value=N:null),class:"settings-search-box mb-2 w-full",placeholder:T.$t("g.searchSettings")+"...","debounce-time":128,autofocus:"",onSearch:S},null,8,["model-value","placeholder"]),createVNode(unref(script$r),{modelValue:unref(o),"onUpdate:modelValue":E[1]||(E[1]=N=>isRef(o)?o.value=N:null),options:unref(a),"option-label":"translatedLabel","option-group-label":"label","option-group-children":"children","scroll-height":"100%","option-disabled":p(N=>!unref(m)&&!unref(u).has(N.label??""),"option-disabled"),class:"w-full border-none"},{optiongroup:withCtx(()=>[createVNode(unref(script$o),{class:"my-0"})]),_:1},8,["modelValue","options","option-disabled"])]),_:1}),createVNode(unref(script$o),{layout:"vertical",class:"mx-1 hidden md:flex 2xl:mx-4"}),createVNode(unref(script$o),{layout:"horizontal",class:"flex md:hidden"}),createVNode(unref(script$C),{value:I.value,lazy:!0,class:"settings-content h-full w-full"},{default:withCtx(()=>[createVNode(unref(script$B),{class:"settings-tab-panels h-full w-full pr-0"},{default:withCtx(()=>[createVNode(_sfc_main$R,{value:"Search Results"},{default:withCtx(()=>[createVNode(_sfc_main$E,{"setting-groups":C.value},null,8,["setting-groups"])]),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(s),N=>(openBlock(),createBlock(_sfc_main$R,{key:N.key,value:N.label??""},{header:withCtx(()=>[I.value==="Comfy"?(openBlock(),createBlock(_sfc_main$S,{key:0})):createCommentVNode("",!0),I.value==="Appearance"?(openBlock(),createBlock(_sfc_main$Q,{key:1})):createCommentVNode("",!0)]),default:withCtx(()=>[createVNode(_sfc_main$E,{"setting-groups":k(N)},null,8,["setting-groups"])]),_:2},1032,["value"]))),128)),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(r),N=>(openBlock(),createBlock(Suspense,{key:N.node.key},{fallback:withCtx(()=>[createBaseVNode("div",null,toDisplayString(T.$t("g.loadingPanel",{panel:N.node.label})),1)]),default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(N.component)))]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]))}}),SettingDialogContent=_export_sfc(_sfc_main$D,[["__scopeId","data-v-54ba910a"]]),_hoisted_1$w={class:"flex w-full items-center justify-between py-2"},_hoisted_2$s={class:"flex flex-col text-sm leading-normal font-medium"},_hoisted_3$l={class:"text-muted"},_hoisted_4$g={class:"h-full"},_hoisted_5$e={class:"break-words whitespace-pre-wrap"},_sfc_main$C=defineComponent({__name:"ManagerProgressDialogContent",setup(i){const o=useComfyManagerStore(),n=useManagerProgressDialogStore(),s=p(N=>{const L=a.value[N];if(!L)return!1;const A=o.taskQueue;return A?[...A.running_queue||[],...A.pending_queue||[]].some(O=>O.ui_id===L.taskId):!1},"isInProgress"),a=computed(()=>n.getActiveTabIndex()===0?o.succeededTasksLogs:o.failedTasksLogs),r=computed(()=>n.isExpanded),l=computed(()=>!r.value),u=ref({}),m=p(N=>{u.value[N]=!u.value[N]},"togglePanel"),f=ref(null),{y:_}=useScroll(f,{eventListenerOptions:{passive:!0}}),y=ref(null),b=ref(!1),w=computed(()=>a.value?.at(-1)?.logs),k=p(N=>N?Math.abs(N.scrollHeight-N.scrollTop-N.clientHeight)<20:!1,"isAtBottom"),S=p(()=>{!y.value||b.value||(y.value.scrollTop=y.value.scrollHeight)},"scrollLastPanelToBottom"),C=p(()=>{_.value=f.value?.scrollHeight??0},"scrollContentToBottom"),I=p(()=>{b.value=!1},"resetUserScrolling"),T=p(N=>{const L=N.target;L===y.value&&(b.value=!k(L))},"handleScroll");return whenever(w,p(()=>{b.value||S()},"onLogsAdded"),{flush:"post",deep:!0}),whenever(()=>r.value,C),whenever(l,I),onMounted(()=>{C()}),onBeforeUnmount(()=>{n.collapse()}),(N,L)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["overflow-hidden transition-all duration-300",{"max-h-[500px]":r.value,"m-0 max-h-0 p-0":!r.value}])},[createBaseVNode("div",{ref_key:"sectionsContainerRef",ref:f,class:normalizeClass(["scroll-container max-h-[450px] overflow-y-auto px-6 py-4",{"max-h-[450px]":r.value,"max-h-0":!r.value}]),style:{scrollbarWidth:"thin",scrollbarColor:"rgba(156, 163, 175, 0.5) transparent"}},[(openBlock(!0),createElementBlock(Fragment,null,renderList(a.value,(A,D)=>(openBlock(),createElementBlock("div",{key:D},[createVNode(unref(script$D),{expanded:u.value[D]===!0,toggleable:"",class:"shadow-elevation-1 mt-2 rounded-lg"},{header:withCtx(()=>[createBaseVNode("div",_hoisted_1$w,[createBaseVNode("div",_hoisted_2$s,[createBaseVNode("span",null,toDisplayString(A.taskName),1),createBaseVNode("span",_hoisted_3$l,toDisplayString(s(D)?N.$t("g.inProgress"):N.$t("g.completed")+" âœ“"),1)])])]),toggleicon:withCtx(()=>[createVNode(unref(script),{icon:u.value[D]?"pi pi-chevron-right":"pi pi-chevron-down",text:"",class:"text-neutral-300",onClick:p(O=>m(D),"onClick")},null,8,["icon","onClick"])]),default:withCtx(()=>[createBaseVNode("div",{ref_for:!0,ref:D===a.value.length-1?O=>y.value=O:void 0,class:normalizeClass(["h-64 overflow-y-auto rounded-lg bg-black",{"h-64":D!==a.value.length-1,grow:D===a.value.length-1}]),onScroll:T},[createBaseVNode("div",_hoisted_4$g,[(openBlock(!0),createElementBlock(Fragment,null,renderList(A.logs,(O,M)=>(openBlock(),createElementBlock("div",{key:M,class:"text-muted"},[createBaseVNode("pre",_hoisted_5$e,toDisplayString(O),1)]))),128))])],34)]),_:2},1032,["expanded"])]))),128))],2)],2))}}),_hoisted_1$v={class:"flex items-center text-base leading-none"},_hoisted_2$r={class:"flex items-center"},_hoisted_3$k={class:"flex items-center gap-4"},_hoisted_4$f={key:0,class:"text-sm text-neutral-700"},_hoisted_5$d={class:"flex items-center"},_sfc_main$B=defineComponent({__name:"ManagerProgressFooter",setup(i){const{t:o}=useI18n(),n=useDialogStore(),s=useManagerProgressDialogStore(),a=useComfyManagerStore(),r=useSettingStore(),{runFullConflictAnalysis:l}=useConflictDetection(),u=ref(!1),m=ref(!1),f=computed(()=>a.isProcessingTasks||u.value),_=computed(()=>a.succeededTasksIds.length+a.failedTasksIds.length),y=computed(()=>{const C=Object.keys(a.taskHistory).length,I=a.taskQueue,T=I?(I.running_queue?.length||0)+(I.pending_queue?.length||0):0;return C+T}),b=p(()=>{n.closeDialog({key:"global-manager-progress-dialog"})},"closeDialog"),w=o("manager.installingDependencies"),k=computed(()=>u.value?o("manager.restartingBackend"):m.value?o("manager.extensionsSuccessfullyInstalled"):a.taskLogs.length?a.taskLogs.at(-1)?.taskName??w:w),S=p(async()=>{const C=r.get("Comfy.Toast.DisableReconnectingToast");try{await r.set("Comfy.Toast.DisableReconnectingToast",!0),u.value=!0,useEventListener(api,"reconnected",p(async()=>{try{a.setStale(),await useCommandStore().execute("Comfy.RefreshNodeDefinitions"),await useWorkflowService().reloadCurrentWorkflow(),l()}finally{await r.set("Comfy.Toast.DisableReconnectingToast",C),u.value=!1,m.value=!0,setTimeout(()=>{b(),a.resetTaskState()},3e3)}},"onReconnect"),{once:!0}),await useComfyManagerService().rebootComfyUI()}catch(I){throw await r.set("Comfy.Toast.DisableReconnectingToast",C),u.value=!1,m.value=!1,b(),I}},"handleRestart");return(C,I)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["flex w-full items-center justify-between px-6 py-2 shadow-lg",{"rounded-t-none":unref(s).isExpanded,"rounded-lg":!unref(s).isExpanded}])},[createBaseVNode("div",_hoisted_1$v,[createBaseVNode("div",_hoisted_2$r,[f.value?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(DotSpinner,{duration:"1s",class:"mr-2"}),createBaseVNode("span",null,toDisplayString(k.value),1)],64)):m.value?(openBlock(),createElementBlock(Fragment,{key:1},[I[0]||(I[0]=createBaseVNode("span",{class:"mr-2"},"ðŸŽ‰",-1)),createBaseVNode("span",null,toDisplayString(k.value),1)],64)):(openBlock(),createElementBlock(Fragment,{key:2},[I[1]||(I[1]=createBaseVNode("span",{class:"mr-2"},"âœ…",-1)),createBaseVNode("span",null,toDisplayString(C.$t("manager.restartToApplyChanges")),1)],64))])]),createBaseVNode("div",_hoisted_3$k,[f.value?(openBlock(),createElementBlock("span",_hoisted_4$f,toDisplayString(_.value)+" "+toDisplayString(C.$t("g.progressCountOf"))+" "+toDisplayString(y.value),1)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_5$d,[!f.value&&!m.value?(openBlock(),createBlock(unref(script),{key:0,rounded:"",outlined:"",class:"mr-4 rounded-md border-2 border-base-foreground px-3 text-base-foreground hover:bg-secondary-background-hover",onClick:S},{default:withCtx(()=>[createTextVNode(toDisplayString(C.$t("manager.applyChanges")),1)]),_:1})):m.value?createCommentVNode("",!0):(openBlock(),createBlock(unref(script),{key:1,icon:unref(s).isExpanded?"pi pi-chevron-up":"pi pi-chevron-down",text:"",rounded:"",size:"small",class:"font-bold",severity:"secondary","aria-label":C.$t(unref(s).isExpanded?"contextMenu.Collapse":"contextMenu.Expand"),onClick:withModifiers(unref(s).toggle,["stop"])},null,8,["icon","aria-label","onClick"])),createVNode(unref(script),{icon:"pi pi-times",text:"",rounded:"",size:"small",class:"font-bold",severity:"secondary","aria-label":C.$t("g.close"),onClick:withModifiers(b,["stop"])},null,8,["aria-label"])])])],2))}}),_hoisted_1$u={key:0,class:"flex items-center px-4 py-2"},_sfc_main$A=defineComponent({__name:"ManagerProgressHeader",setup(i){const o=useManagerProgressDialogStore(),n=useComfyManagerStore(),s=computed({get:p(()=>o.getActiveTabIndex(),"get"),set:p(l=>o.setActiveTabIndex(l),"set")}),{t:a}=useI18n(),r=computed(()=>[{label:a("manager.installationQueue")},{label:a("manager.failed",{count:n.failedTasksIds.length})}]);return(l,u)=>unref(o).isExpanded?(openBlock(),createElementBlock("div",_hoisted_1$u,[createVNode(unref(script$E),{"active-index":s.value,"onUpdate:activeIndex":u[0]||(u[0]=m=>s.value=m),model:r.value,class:"w-full border-none",pt:{menu:{class:"border-none"},menuitem:{class:"font-medium"},action:{class:"px-4 py-2"}}},null,8,["active-index","model"])])):createCommentVNode("",!0)}}),_sfc_main$z=defineComponent({__name:"ContentDivider",props:{orientation:{default:"horizontal"},width:{default:.3}},setup(i){useCssVars(s=>({"4bb7c524":s.width+"px"}));const o=useColorPaletteStore(),n=computed(()=>o.completedActivePalette.light_theme);return(s,a)=>(openBlock(),createElementBlock("div",{class:normalizeClass({"content-divider":!0,"content-divider--horizontal":s.orientation==="horizontal","content-divider--vertical":s.orientation==="vertical"}),style:normalizeStyle({backgroundColor:n.value?"#DCDAE1":"#2C2C2C"})},null,6))}}),ContentDivider=_export_sfc(_sfc_main$z,[["__scopeId","data-v-1d39213b"]]),useResponsiveCollapse=p((i="lg")=>{const o=useBreakpoints(breakpointsTailwind),n=o.smallerOrEqual(i),s=ref(!n.value);return watch(n,p(()=>{n.value&&s.value?s.value=!1:!n.value&&!s.value&&(s.value=!0)},"onIsSmallScreenChange")),{breakpoints:o,isOpen:s,isSmallScreen:n,open:p(()=>s.value=!0,"open"),close:p(()=>s.value=!1,"close"),toggle:p(()=>s.value=!s.value,"toggle")}},"useResponsiveCollapse"),_hoisted_1$t={class:"z-5 flex w-3/12 max-w-[250px] translate-x-0 transition-transform duration-300 ease-in-out"},_hoisted_2$q={class:"flex items-center text-left"},_hoisted_3$j={class:"text-sm"},_sfc_main$y=defineComponent({__name:"ManagerNavSidebar",props:mergeModels({tabs:{}},{selectedTab:{},selectedTabModifiers:{}}),emits:["update:selectedTab"],setup(i){const o=useModel(i,"selectedTab");return(n,s)=>(openBlock(),createElementBlock("aside",_hoisted_1$t,[createVNode(unref(script$c),{class:"flex-1"},{default:withCtx(()=>[createVNode(unref(script$r),{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=a=>o.value=a),options:n.tabs,"option-label":"label","list-style":"max-height:unset",class:"w-full border-0 bg-transparent shadow-none",pt:{list:{class:"p-3 gap-2"},option:{class:"px-4 py-2 text-lg rounded-lg"},optionGroup:{class:"p-0 text-left text-inherit"}}},{option:withCtx(a=>[createBaseVNode("div",_hoisted_2$q,[createBaseVNode("i",{class:normalizeClass(["pi",a.option.icon,"mr-2 text-sm"])},null,2),createBaseVNode("span",_hoisted_3$j,toDisplayString(a.option.label),1)])]),_:1},8,["modelValue","options"])]),_:1}),createVNode(ContentDivider,{orientation:"vertical",width:.3})]))}}),ImportFailedKey=Symbol("ImportFailed"),_sfc_main$x=defineComponent({__name:"PackStatusMessage",props:{statusType:{},hasCompatibilityIssues:{type:Boolean}},setup(i){const n=inject(ImportFailedKey)?.importFailed,s={NodeStatusActive:{label:"active",severity:"success"},NodeStatusDeleted:{label:"deleted",severity:"warn"},NodeStatusBanned:{label:"banned",severity:"error"},NodeVersionStatusActive:{label:"active",severity:"success"},NodeVersionStatusPending:{label:"pending",severity:"warn"},NodeVersionStatusDeleted:{label:"deleted",severity:"warn"},NodeVersionStatusFlagged:{label:"flagged",severity:"error"},NodeVersionStatusBanned:{label:"banned",severity:"error"}},a=computed(()=>n?.value?"importFailed":i.hasCompatibilityIssues?"conflicting":s[i.statusType]?.label||"unknown"),r=computed(()=>i.hasCompatibilityIssues||n?.value?"error":s[i.statusType]?.severity||"secondary");return(l,u)=>(openBlock(),createBlock(unref(script$1),{severity:r.value,class:"flex w-fit items-center rounded-xl p-0 break-words",pt:{text:{class:"text-xs"},content:{class:"px-2 py-0.5"}}},{default:withCtx(()=>[u[0]||(u[0]=createBaseVNode("i",{class:"pi pi-circle-fill mr-1.5 p-0 text-[0.6rem]",style:{opacity:.8}},null,-1)),createTextVNode(" "+toDisplayString(l.$t(`manager.status.${a.value}`)),1)]),_:1},8,["severity"]))}}),_hoisted_1$s=["width","height"],_hoisted_2$p=["fill"],_sfc_main$w=defineComponent({__name:"VerifiedIcon",props:{size:{default:16},color:{default:"#60A5FA"},class:{}},setup(i){const o=computed(()=>i.class||"");return(n,s)=>(openBlock(),createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",width:n.size,height:n.size,viewBox:"0 0 16 16",fill:"none",class:normalizeClass(o.value)},[createBaseVNode("path",{d:"M8.00049 1.3335C8.73661 1.33367 9.33332 1.93038 9.3335 2.6665V2.83447C9.82278 2.96041 10.2851 3.15405 10.7095 3.40479L10.8286 3.28564C11.3493 2.76525 12.1937 2.76519 12.7144 3.28564C13.235 3.80626 13.2348 4.65067 12.7144 5.17139L12.5952 5.29053C12.846 5.71486 13.0396 6.17725 13.1655 6.6665H13.3335C14.0699 6.6665 14.6665 7.26411 14.6665 8.00049C14.6663 8.73672 14.0698 9.3335 13.3335 9.3335H13.1655C13.0396 9.82284 12.846 10.2851 12.5952 10.7095L12.7144 10.8286C13.235 11.3493 13.235 12.1937 12.7144 12.7144C12.1937 13.235 11.3493 13.235 10.8286 12.7144L10.7095 12.5952C10.2851 12.846 9.82284 13.0396 9.3335 13.1655V13.3335C9.3335 14.0698 8.73672 14.6663 8.00049 14.6665C7.26411 14.6665 6.6665 14.0699 6.6665 13.3335V13.1655C6.17725 13.0396 5.71486 12.846 5.29053 12.5952L5.17139 12.7144C4.65067 13.2348 3.80626 13.235 3.28564 12.7144C2.76519 12.1937 2.76525 11.3493 3.28564 10.8286L3.40479 10.7095C3.15405 10.2851 2.96041 9.82278 2.83447 9.3335H2.6665C1.93038 9.33332 1.33367 8.73661 1.3335 8.00049C1.3335 7.26422 1.93027 6.66668 2.6665 6.6665H2.83447C2.96043 6.17722 3.15403 5.71488 3.40479 5.29053L3.28564 5.17139C2.76536 4.65065 2.76508 3.80621 3.28564 3.28564C3.80621 2.76508 4.65065 2.76536 5.17139 3.28564L5.29053 3.40479C5.71488 3.15403 6.17722 2.96043 6.6665 2.83447V2.6665C6.66668 1.93027 7.26422 1.3335 8.00049 1.3335ZM7.3335 8.00049L6.00049 6.6665L4.6665 8.00049L7.3335 10.6665L11.3335 6.6665L10.0005 5.3335L7.3335 8.00049Z",fill:n.color},null,8,_hoisted_2$p)],10,_hoisted_1$s))}});function getConflictMessage(i,o){const n=`manager.conflicts.conflictMessages.${i.type}`;return i.type==="comfyui_version"||i.type==="frontend_version"||i.type==="os"||i.type==="accelerator"?o(n,{current:i.current_value,required:i.required_value}):i.type==="banned"||i.type==="pending"||i.type==="import_failed"?o(n):o("manager.conflicts.conflictMessages.generic",{current:i.current_value,required:i.required_value})}p(getConflictMessage,"getConflictMessage");function getJoinedConflictMessages(i,o,n="; "){return i.map(s=>getConflictMessage(s,o)).join(n)}p(getJoinedConflictMessages,"getJoinedConflictMessages");const _hoisted_1$r={class:"w-64 pt-1"},_hoisted_2$o={class:"py-2"},_hoisted_3$i={class:"text-md pl-3 font-semibold text-neutral-500"},_hoisted_4$e={key:0,class:"flex flex-col items-center py-4 text-center text-muted"},_hoisted_5$c={key:1,class:"py-2"},_hoisted_6$8={class:"flex w-full items-center justify-between p-1"},_hoisted_7$7={class:"flex items-center gap-2"},_hoisted_8$6={key:0,class:"w-4"},_hoisted_9$4={key:0,class:"pi pi-exclamation-triangle text-yellow-500"},_hoisted_10$4={key:0,class:"pi pi-check text-highlight"},_hoisted_11$2={class:"flex justify-end gap-2 px-3 py-1"},_sfc_main$v=defineComponent({__name:"PackVersionSelectorPopover",props:{nodePack:{}},emits:["cancel","submit"],setup(i,{emit:o}){const n={LATEST:"latest",NIGHTLY:"nightly"},s={DEFAULT:"default",DEV:"dev"},a={CACHE:"cache",REMOTE:"remote",LOCAL:"local"},r=o,{t:l}=useI18n(),u=useComfyRegistryService(),m=useComfyManagerStore(),{checkNodeCompatibility:f}=useConflictDetection(),_=ref(!1),y=ref(n.LATEST);onMounted(()=>{const D=b()??n.LATEST;y.value=semver.valid(D)?D:n.NIGHTLY});const b=p(()=>{if(i.nodePack.id)return i.nodePack.publisher?.name==="Unclaimed"?n.NIGHTLY:m.isPackInstalled(i.nodePack.id)?m.getInstalledPackVersion(i.nodePack.id):i.nodePack.latest_version?.version},"getInitialSelectedVersion"),w=p(async()=>i.nodePack?.id?await u.getPackVersions(i.nodePack.id)||[]:[],"fetchVersions"),k=ref([]),S=ref([]),C=ref(!1),I=p(async()=>{C.value=!0;const D=await w();S.value=D;const O=i.nodePack.latest_version?.version,M=D.map(V=>({value:V.version??"",label:V.version??""})).filter(V=>V.value&&V.value!==O),P=O?`${l("manager.latestVersion")} (${O})`:l("manager.latestVersion"),R=[{value:n.LATEST,label:P}];i.nodePack.repository?.length&&R.push({value:n.NIGHTLY,label:l("manager.nightlyVersion")}),k.value=[...R,...M],C.value=!1},"onNodePackChange");whenever(()=>i.nodePack.id,(D,O)=>{D!==O&&I()},{deep:!0,immediate:!0});const T=p(async()=>{if(_.value=!0,!i.nodePack.id)throw new Error("Node ID is required for installation");const D=y.value==="latest"?i.nodePack.latest_version?.version??"latest":y.value;await m.installPack.call({id:i.nodePack.id,repository:i.nodePack.repository??"",channel:s.DEFAULT,mode:a.CACHE,version:D,selected_version:y.value}),_.value=!1,r("submit")},"handleSubmit"),E=p(D=>{const O=i.nodePack.latest_version?.version;if(D==="latest"||D===O)return{...i.nodePack.latest_version};const P=S.value.find(R=>R.version===D);return P?{...P}:{...i.nodePack}},"getVersionData"),N=p(D=>{const O=E(D),M=f(O),P=M.hasConflict?getJoinedConflictMessages(M.conflicts,l):"";return{hasConflict:M.hasConflict,conflictMessage:P}},"getVersionCompatibility"),L=p(D=>y.value===D||D==="latest"&&y.value===i.nodePack.latest_version?.version,"isOptionSelected"),A=computed(()=>k.value.map(D=>{const O=N(D.value),M=L(D.value);return{...D,hasConflict:O.hasConflict,conflictMessage:O.conflictMessage,isSelected:M}}));return(D,O)=>{const M=resolveDirective("tooltip");return openBlock(),createElementBlock("div",_hoisted_1$r,[createBaseVNode("div",_hoisted_2$o,[createBaseVNode("span",_hoisted_3$i,toDisplayString(D.$t("manager.selectVersion")),1)]),C.value||_.value?(openBlock(),createElementBlock("div",_hoisted_4$e,[createVNode(unref(script$5),{class:"mb-2 h-8 w-8"}),createTextVNode(" "+toDisplayString(D.$t("manager.loadingVersions")),1)])):k.value.length===0?(openBlock(),createElementBlock("div",_hoisted_5$c,[createVNode(NoResultsPlaceholder,{title:D.$t("g.noResultsFound"),message:D.$t("manager.tryAgainLater"),icon:"pi pi-exclamation-circle",class:"p-0"},null,8,["title","message"])])):(openBlock(),createBlock(unref(script$r),{key:2,modelValue:y.value,"onUpdate:modelValue":O[0]||(O[0]=P=>y.value=P),"option-label":"label","option-value":"value",options:A.value,"highlight-on-select":!1,class:"max-h-[50vh] w-full rounded-md border-none shadow-none",pt:{listContainer:{class:"scrollbar-hide"}}},{option:withCtx(P=>[createBaseVNode("div",_hoisted_6$8,[createBaseVNode("div",_hoisted_7$7,[P.option.value==="nightly"?(openBlock(),createElementBlock("div",_hoisted_8$6)):(openBlock(),createElementBlock(Fragment,{key:1},[P.option.hasConflict?withDirectives((openBlock(),createElementBlock("i",_hoisted_9$4,null,512)),[[M,{value:P.option.conflictMessage,showDelay:300}]]):(openBlock(),createBlock(_sfc_main$w,{key:1,size:20,class:"relative right-0.5"}))],64)),createBaseVNode("span",null,toDisplayString(P.option.label),1)]),P.option.isSelected?(openBlock(),createElementBlock("i",_hoisted_10$4)):createCommentVNode("",!0)])]),_:1},8,["modelValue","options"])),createVNode(ContentDivider,{class:"my-2"}),createBaseVNode("div",_hoisted_11$2,[createVNode(unref(script),{text:"",class:"text-sm",severity:"secondary",label:D.$t("g.cancel"),disabled:_.value,onClick:O[1]||(O[1]=P=>r("cancel"))},null,8,["label","disabled"]),createVNode(unref(script),{severity:"secondary",label:D.$t("g.install"),class:"rounded-lg bg-secondary-background px-4 py-2.5 text-sm text-base-foreground",disabled:_.value,onClick:T},null,8,["label","disabled"])])])}}}),usePackUpdateStatus=p(i=>{const{isPackInstalled:o,getInstalledPackVersion:n}=useComfyManagerStore(),s=computed(()=>o(i?.id)),a=computed(()=>n(i.id??"")),r=computed(()=>i.latest_version?.version),l=computed(()=>!!a.value&&!semver.valid(a.value));return{isUpdateAvailable:computed(()=>!s.value||l.value||!r.value||!a.value?!1:semver.compare(r.value,a.value)>0),isNightlyPack:l,installedVersion:a,latestVersion:r}},"usePackUpdateStatus"),_hoisted_1$q=["aria-haspopup","role","tabindex"],_hoisted_2$n={key:0,class:"pi pi-arrow-circle-up text-xs text-blue-600"},_hoisted_3$h={key:1,class:"pi pi-chevron-right text-xxs"},TRUNCATED_HASH_LENGTH=7,_sfc_main$u=defineComponent({__name:"PackVersionBadge",props:{nodePack:{},isSelected:{type:Boolean},fill:{type:Boolean,default:!0}},setup(i){const{isUpdateAvailable:o}=usePackUpdateStatus(i.nodePack),n=ref(),s=useComfyManagerStore(),a=computed(()=>s.isPackInstalled(i.nodePack?.id)),r=computed(()=>a.value&&!s.isPackEnabled(i.nodePack?.id)),l=computed(()=>{if(!i.nodePack.id)return"nightly";const f=s.installedPacks[i.nodePack.id]?.ver??i.nodePack.latest_version?.version??"nightly";return semver.valid(f)?f:f.slice(0,TRUNCATED_HASH_LENGTH)}),u=p(f=>{n.value.toggle(f)},"toggleVersionSelector"),m=p(()=>{n.value.hide()},"closeVersionSelector");return watch(()=>i.isSelected,(f,_)=>{_&&!f&&m()}),(f,_)=>{const y=resolveDirective("tooltip");return openBlock(),createElementBlock("div",null,[withDirectives((openBlock(),createElementBlock("div",{class:normalizeClass(["inline-flex items-center gap-1 rounded-2xl py-1 text-xs",{"bg-dialog-surface px-1.5":f.fill,"cursor-pointer":!r.value,"cursor-not-allowed opacity-60":r.value}]),"aria-haspopup":!r.value,role:r.value?"text":"button",tabindex:r.value?-1:0,onClick:_[0]||(_[0]=b=>!r.value&&u(b)),onKeydown:[_[1]||(_[1]=withKeys(b=>!r.value&&u(b),["enter"])),_[2]||(_[2]=withKeys(b=>!r.value&&u(b),["space"]))]},[unref(o)?(openBlock(),createElementBlock("i",_hoisted_2$n)):createCommentVNode("",!0),createBaseVNode("span",null,toDisplayString(l.value),1),r.value?createCommentVNode("",!0):(openBlock(),createElementBlock("i",_hoisted_3$h))],42,_hoisted_1$q)),[[y,r.value?f.$t("manager.enablePackToChangeVersion"):null,void 0,{top:!0}]]),createVNode(unref(script$b),{ref_key:"popoverRef",ref:n,pt:{content:{class:"p-0 shadow-lg"}}},{default:withCtx(()=>[createVNode(_sfc_main$v,{"installed-version":l.value,"node-pack":f.nodePack,onCancel:m,onSubmit:m},null,8,["installed-version","node-pack"])]),_:1},512)])}}}),_hoisted_1$p={class:"flex items-center gap-2"},TOGGLE_DEBOUNCE_MS=256,_sfc_main$t=defineComponent({__name:"PackEnableToggle",props:{nodePack:{},hasConflict:{type:Boolean}},setup(i){const{t:o}=useI18n(),{isPackEnabled:n,enablePack:s,disablePack:a,installedPacks:r}=useComfyManagerStore(),{getConflictsForPackageByID:l}=useConflictDetectionStore(),{showNodeConflictDialog:u}=useDialogService(),{acknowledgmentState:m,markConflictsAsSeen:f}=useConflictAcknowledgment(),_=ref(!1),y=computed(()=>n(i.nodePack.id)),b=computed(()=>{const L=i.nodePack.id;return L?r[L]?.ver??i.nodePack.latest_version?.version??"nightly":"nightly"}),w=computed(()=>l(i.nodePack.id||"")),k=computed(()=>!(i.hasConflict&&!m.value.modal_dismissed&&w.value)),S=p(L=>{let A=m.value.modal_dismissed;L&&(A=!1),w.value&&!A&&u({conflictedPackages:[w.value],buttonText:y.value?o("manager.conflicts.understood"):o("manager.conflicts.enableAnyway"),onButtonClick:p(async()=>{y.value||await C()},"onButtonClick"),dialogComponentProps:{onClose:p(()=>{f()},"onClose")}})},"showConflictModal"),C=p(()=>{if(!i.nodePack.id)throw new Error("Node ID is required for enabling");return s({id:i.nodePack.id,version:b.value??"latest"})},"handleEnable"),I=p(()=>{if(!i.nodePack.id)throw new Error("Node ID is required for disabling");return a({id:i.nodePack.id,version:b.value??"latest"})},"handleDisable"),T=p(async L=>{_.value||(_.value=!0,L?await C():await I(),_.value=!1)},"handleToggle"),E=debounce(L=>{T(L)},TOGGLE_DEBOUNCE_MS,{trailing:!0}),N=p(async L=>{k.value||(L.preventDefault(),S(!1))},"handleToggleInteraction");return(L,A)=>{const D=resolveDirective("tooltip");return openBlock(),createElementBlock("div",_hoisted_1$p,[L.hasConflict?withDirectives((openBlock(),createElementBlock("div",{key:0,class:"flex h-6 w-6 cursor-pointer items-center justify-center",onClick:A[0]||(A[0]=O=>S(!0))},A[1]||(A[1]=[createBaseVNode("i",{class:"pi pi-exclamation-triangle text-xl text-yellow-500"},null,-1)]))),[[D,{value:L.$t("manager.conflicts.warningTooltip"),showDelay:300}]]):createCommentVNode("",!0),k.value?(openBlock(),createBlock(unref(script$A),{key:2,"model-value":y.value,disabled:_.value,"aria-label":L.$t("g.enableOrDisablePack"),"onUpdate:modelValue":unref(E)},null,8,["model-value","disabled","aria-label","onUpdate:modelValue"])):(openBlock(),createBlock(unref(script$A),{key:1,"model-value":y.value,disabled:_.value,readonly:!k.value,"aria-label":L.$t("g.enableOrDisablePack"),onFocus:N},null,8,["model-value","disabled","readonly","aria-label"]))])}}}),_sfc_main$s=defineComponent({__name:"PackUninstallButton",props:{nodePacks:{},size:{}},setup(i){const o=useComfyManagerStore(),n=p(r=>{if(!r.id)throw new Error("Node ID is required for uninstallation");return{id:r.id,version:r.latest_version?.version||"unknown"}},"createPayload"),s=p(r=>o.uninstallPack(n(r)),"uninstallPack"),a=p(async()=>{i.nodePacks?.length&&await Promise.all(i.nodePacks.map(s))},"uninstallItems");return(r,l)=>(openBlock(),createBlock(_sfc_main$2D,mergeProps(r.$attrs,{type:"transparent",label:r.nodePacks.length>1?r.$t("manager.uninstallSelected"):r.$t("manager.uninstall"),border:!0,size:r.size,class:"border-red-500",onClick:a}),null,16,["label","size"]))}}),_hoisted_1$o={class:"aspect-[2/1] w-full max-w-[204] overflow-hidden rounded-lg"},_hoisted_2$m={key:0,class:"h-full w-full"},_hoisted_3$g=["alt"],_hoisted_4$d={key:1,class:"relative h-full w-full"},_hoisted_5$b=["src","alt"],DEFAULT_BANNER$1="/assets/images/fallback-gradient-avatar.svg",_sfc_main$r=defineComponent({__name:"PackIcon",props:{nodePack:{}},setup(i){const o=ref(!1),n=computed(()=>!i.nodePack.banner_url&&!i.nodePack.icon),s=computed(()=>i.nodePack.banner_url||i.nodePack.icon);return(a,r)=>(openBlock(),createElementBlock("div",_hoisted_1$o,[n.value?(openBlock(),createElementBlock("div",_hoisted_2$m,[createBaseVNode("img",{src:DEFAULT_BANNER$1,alt:a.$t("g.defaultBanner"),class:"h-full w-full object-cover"},null,8,_hoisted_3$g)])):(openBlock(),createElementBlock("div",_hoisted_4$d,[s.value?(openBlock(),createElementBlock("div",{key:0,class:"absolute inset-0 bg-cover bg-center bg-no-repeat",style:normalizeStyle({backgroundImage:`url(${s.value})`,filter:"blur(10px)"})},null,4)):createCommentVNode("",!0),createBaseVNode("img",{src:o.value?DEFAULT_BANNER$1:s.value,alt:a.nodePack.name+" banner",class:normalizeClass(o.value?"relative w-full h-full object-cover z-10":"relative w-full h-full object-contain z-10"),onError:r[0]||(r[0]=l=>o.value=!0)},null,42,_hoisted_5$b)]))]))}}),_hoisted_1$n={key:0,class:"flex flex-col items-center"},_hoisted_2$l={class:"mt-4 mb-2 text-center text-2xl font-bold",style:{"word-break":"break-all"}},_hoisted_3$f={class:"inline-block text-base"},_hoisted_4$c={key:0,class:"mt-2 mb-4 flex w-full max-w-xs justify-center"},_hoisted_5$a={key:1,class:"flex flex-col items-center"},_sfc_main$q=defineComponent({__name:"InfoPanelHeader",props:{nodePacks:{},hasConflict:{type:Boolean}},setup(i){const o=useComfyManagerStore(),s=inject(ImportFailedKey)?.importFailed,a=ref(!1);watch([()=>i.nodePacks,()=>o.installedPacks],()=>{a.value=i.nodePacks.every(m=>o.isPackInstalled(m.id))},{immediate:!0});const{checkNodeCompatibility:r}=useConflictDetection(),l=computed(()=>{if(!i.nodePacks?.length)return[];const m=[];for(const f of i.nodePacks){const _=r(f);_.conflicts&&m.push(..._.conflicts)}return m}),u=computed(()=>l.value.length>0);return(m,f)=>m.nodePacks?.length?(openBlock(),createElementBlock("div",_hoisted_1$n,[renderSlot(m.$slots,"thumbnail",{},()=>[createVNode(_sfc_main$r,{"node-pack":m.nodePacks[0],width:"204",height:"106"},null,8,["node-pack"])]),createBaseVNode("h2",_hoisted_2$l,[renderSlot(m.$slots,"title",{},()=>[createBaseVNode("span",_hoisted_3$f,toDisplayString(m.nodePacks[0].name),1)])]),unref(s)?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_4$c,[renderSlot(m.$slots,"install-button",{},()=>[a.value?(openBlock(),createBlock(_sfc_main$s,mergeProps({key:0},m.$attrs,{size:"md","node-packs":m.nodePacks}),null,16,["node-packs"])):(openBlock(),createBlock(_sfc_main$1a,mergeProps({key:1},m.$attrs,{size:"md","node-packs":m.nodePacks,"has-conflict":m.hasConflict||u.value,"conflict-info":l.value}),null,16,["node-packs","has-conflict","conflict-info"]))])]))])):(openBlock(),createElementBlock("div",_hoisted_5$a,[createVNode(NoResultsPlaceholder,{message:m.$t("manager.status.unknown"),title:m.$t("manager.tryAgainLater")},null,8,["message","title"])]))}}),_hoisted_1$m=["textContent"],_hoisted_2$k={key:1,class:"break-words"},_hoisted_3$e=["href"],_hoisted_4$b={class:"text-blue-600"},_hoisted_5$9={key:1},_hoisted_6$7={key:2},_hoisted_7$6={key:3,class:"rounded px-1 py-0.5 text-xs"},_hoisted_8$5={key:4},_sfc_main$p=defineComponent({__name:"MarkdownText",props:{text:{}},setup(i){const o=computed(()=>/(\[.*?\]\(.*?\)|(\*\*|__)(.*?)(\*\*|__)|(\*|_)(.*?)(\*|_)|`(.*?)`)/.test(i.text)),n=computed(()=>{if(!o.value)return[{type:"text",text:i.text}];const s=[],a=i.text;let r=0;const l=/\[(.*?)\]\((.*?)\)/g;let u;for(;(u=l.exec(a))!==null;)u.index>r&&s.push({type:"text",text:a.substring(r,u.index)}),s.push({type:"link",text:u[1],url:u[2]}),r=u.index+u[0].length;if(r<a.length){let m=a.substring(r);m=m.replace(/(\*\*|__)(.*?)(\*\*|__)/g,(f,_,y)=>(s.push({type:"bold",text:y}),"")),m=m.replace(/(\*|_)(.*?)(\*|_)/g,(f,_,y)=>(s.push({type:"italic",text:y}),"")),m=m.replace(/`(.*?)`/g,(f,_)=>(s.push({type:"code",text:_}),"")),m&&s.push({type:"text",text:m})}return s});return(s,a)=>(openBlock(),createElementBlock("div",null,[o.value?(openBlock(),createElementBlock("div",_hoisted_2$k,[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,(r,l)=>(openBlock(),createElementBlock(Fragment,{key:l},[r.type==="link"&&"url"in r?(openBlock(),createElementBlock("a",{key:0,href:r.url,target:"_blank",rel:"noopener noreferrer",class:"hover:underline"},[createBaseVNode("span",_hoisted_4$b,toDisplayString(r.text),1)],8,_hoisted_3$e)):r.type==="bold"?(openBlock(),createElementBlock("strong",_hoisted_5$9,toDisplayString(r.text),1)):r.type==="italic"?(openBlock(),createElementBlock("em",_hoisted_6$7,toDisplayString(r.text),1)):r.type==="code"?(openBlock(),createElementBlock("code",_hoisted_7$6,toDisplayString(r.text),1)):(openBlock(),createElementBlock("span",_hoisted_8$5,toDisplayString(r.text),1))],64))),128))])):(openBlock(),createElementBlock("div",{key:0,class:"break-words",textContent:toDisplayString(s.text)},null,8,_hoisted_1$m))]))}}),_hoisted_1$l={class:"flex flex-col gap-4 text-sm"},_hoisted_2$j={class:"mb-3"},_hoisted_3$d={class:"break-words text-muted"},_hoisted_4$a=["href"],_hoisted_5$8={key:0,class:"pi pi-github text-base"},_hoisted_6$6={class:"break-all"},_sfc_main$o=defineComponent({__name:"InfoTextSection",props:{sections:{}},setup(i){const o=p(n=>n.includes("github.com"),"isGitHubLink");return(n,s)=>(openBlock(),createElementBlock("div",_hoisted_1$l,[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.sections,(a,r)=>(openBlock(),createElementBlock("div",{key:r,class:"mb-4"},[createBaseVNode("div",_hoisted_2$j,toDisplayString(a.title),1),createBaseVNode("div",_hoisted_3$d,[a.isUrl?(openBlock(),createElementBlock("a",{key:0,href:a.text,target:"_blank",rel:"noopener noreferrer",class:"flex items-center gap-2"},[o(a.text)?(openBlock(),createElementBlock("i",_hoisted_5$8)):createCommentVNode("",!0),createBaseVNode("span",_hoisted_6$6,toDisplayString(a.text),1)],8,_hoisted_4$a)):(openBlock(),createBlock(_sfc_main$p,{key:1,text:a.text,class:"text-muted"},null,8,["text"]))])]))),128))]))}}),_hoisted_1$k={class:"overflow-hidden"},_hoisted_2$i={key:1,class:"text-sm text-muted italic"},_hoisted_3$c={key:2},_hoisted_4$9={class:"mb-1"},_sfc_main$n=defineComponent({__name:"DescriptionTabPanel",props:{nodePack:{}},setup(i){const{t:o}=useI18n(),n=p(m=>/^license(\.md|\.txt)?$/i.test(m),"isLicenseFile"),s=p(m=>{const f=/^(https?:\/\/github\.com\/[^/]+\/[^/]+)/i,_=m.match(f);return _?_[1]:m},"extractBaseRepoUrl"),a=p((m,f)=>{if(!f||!m)return"";const _=n(m)?m:"LICENSE";return`${s(f)}/blob/main/${_}`},"createLicenseUrl"),r=p(m=>{const f=m.file||m.text;if(typeof f=="string"&&n(f)&&i.nodePack.repository){const _=a(f,i.nodePack.repository);return{text:_,isUrl:!!_&&isValidUrl(_)}}else{if(m.text)return{text:m.text,isUrl:!1};if(typeof f=="string")return{text:f,isUrl:!1}}return{text:JSON.stringify(m),isUrl:!1}},"parseLicenseObject"),l=p(m=>{if(m==="{}")return null;try{const f=JSON.parse(m);return Object.keys(f).length===0?null:r(f)}catch{if(n(m)&&i.nodePack.repository){const _=a(m,i.nodePack.repository);return{text:_,isUrl:!!_&&isValidUrl(_)}}return{text:m,isUrl:!1}}},"formatLicense"),u=computed(()=>{const m=[{title:o("g.description"),text:i.nodePack.description||o("manager.noDescription")}];if(i.nodePack.repository&&m.push({title:o("manager.repository"),text:i.nodePack.repository,isUrl:isValidUrl(i.nodePack.repository)}),i.nodePack.license){const f=l(i.nodePack.license);f&&f.text&&m.push({title:o("manager.license"),text:f.text,isUrl:f.isUrl})}return m});return(m,f)=>(openBlock(),createElementBlock("div",_hoisted_1$k,[m.nodePack?.description?(openBlock(),createBlock(_sfc_main$o,{key:0,sections:u.value},null,8,["sections"])):(openBlock(),createElementBlock("p",_hoisted_2$i,toDisplayString(m.$t("manager.noDescription")),1)),m.nodePack?.latest_version?.dependencies?.length?(openBlock(),createElementBlock("div",_hoisted_3$c,[createBaseVNode("p",_hoisted_4$9,toDisplayString(m.$t("manager.dependencies")),1),(openBlock(!0),createElementBlock(Fragment,null,renderList(m.nodePack.latest_version.dependencies,(_,y)=>(openBlock(),createElementBlock("div",{key:y,class:"break-words text-muted"},toDisplayString(_),1))),128))])):createCommentVNode("",!0)]))}}),registryToFrontendV2NodeOutputs=p(i=>{const o=JSON.parse(i.return_types??"{}");if(!o.length)return[];const n=JSON.parse(i.return_names??"{}"),s=i.output_is_list??[],a=[];for(let r=0;r<o.length;r++)a.push({type:o[r],name:n[r]||o[r],is_list:s[r]??!1,index:r});return a},"registryToFrontendV2NodeOutputs"),registryToFrontendV2NodeInputs=p(i=>{const o=JSON.parse(i.input_types??"{}");if(!o||!Object.keys(o).length)return{};const n={};return o.required&&Object.entries(o.required).forEach(([s,a])=>{n[s]=transformInputSpecV1ToV2(a,{name:s,isOptional:!1})}),o.optional&&Object.entries(o.optional).forEach(([s,a])=>{n[s]=transformInputSpecV1ToV2(a,{name:s,isOptional:!0})}),n},"registryToFrontendV2NodeInputs"),registryToFrontendV2NodeDef=p((i,o)=>{const n=i.comfy_node_name??"Node Name";return{category:i.category??"unknown",description:i.description??"",display_name:n,name:n,inputs:registryToFrontendV2NodeInputs(i),outputs:registryToFrontendV2NodeOutputs(i),output_node:!1,python_module:o.name??o.id??"unknown"}},"registryToFrontendV2NodeDef"),_hoisted_1$j={class:"flex flex-col gap-4 text-sm"},_sfc_main$m=defineComponent({__name:"NodesTabPanel",props:{nodePack:{},nodeNames:{}},setup(i){const{getNodeDefs:o}=useComfyRegistryStore(),n=ref(!1),s=shallowRef(null);whenever(()=>i.nodePack,p(async()=>{o.cancel(),n.value=!0;const{id:m}=i.nodePack,f=i.nodePack.latest_version?.version;if(!m||!f)s.value=null;else{const _=await o.call({packId:m,version:f,page:1,limit:256});s.value=_?.comfy_nodes??null}n.value=!1},"fetchNodeDefs"),{immediate:!0,deep:!0});const r=p(m=>{try{return registryToFrontendV2NodeDef(m,i.nodePack)}catch{return null}},"toFrontendNodeDef"),l=computed(()=>s.value?s.value.map(r).filter(m=>m!==null):null),u=p(m=>`${m.category}${m.comfy_node_name??useId()}`,"createNodeDefKey");return(m,f)=>(openBlock(),createElementBlock("div",_hoisted_1$j,[l.value?.length?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(l.value,_=>(openBlock(),createElementBlock("div",{key:u(_),class:"rounded-lg border p-4"},[createVNode(NodePreview,{"node-def":_,class:"min-w-full! text-[.625rem]!"},null,8,["node-def"])]))),128)):n.value?(openBlock(),createBlock(unref(script$5),{key:1})):m.nodeNames.length?(openBlock(!0),createElementBlock(Fragment,{key:2},renderList(m.nodeNames,_=>(openBlock(),createElementBlock("div",{key:_,class:"truncate text-muted"},toDisplayString(_),1))),128)):(openBlock(),createBlock(NoResultsPlaceholder,{key:3,title:m.$t("manager.noNodesFound"),message:m.$t("manager.noNodesFoundDescription")},null,8,["title","message"]))]))}});function extractImportFailedConflicts(i){if(!i)return null;const o=i.filter(n=>n.type==="import_failed");return o.length>0?o:null}p(extractImportFailedConflicts,"extractImportFailedConflicts");function createImportFailedDialog(){const{t:i}=useI18n(),{showErrorDialog:o}=useDialogService();return n=>{if(n){const s=n.map(r=>r.required_value).filter(Boolean).join(`
`)||i("manager.importFailedGenericError"),a=new Error(s);o(a,{title:i("manager.failedToInstall"),reportType:"importFailedError"})}}}p(createImportFailedDialog,"createImportFailedDialog");function useImportFailedDetection(i){const{isPackInstalled:o}=useComfyManagerStore(),{getConflictsForPackageByID:n}=useConflictDetectionStore(),s=computed(()=>i?o(unref(i)):!1),a=computed(()=>{const m=unref(i);return!m||!s.value?null:n(m)||null}),r=computed(()=>extractImportFailedConflicts(a.value?.conflicts)),l=computed(()=>r.value!==null),u=createImportFailedDialog();return{importFailedInfo:r,importFailed:l,showImportFailedDialog:p(()=>u(r.value),"showImportFailedDialog"),isInstalled:s}}p(useImportFailedDetection,"useImportFailedDetection");const _hoisted_1$i={class:"flex flex-col gap-3"},_hoisted_2$h={class:"text-sm text-base-foreground"},_hoisted_3$b={class:"flex items-center justify-between"},_hoisted_4$8={class:"flex-1 text-sm break-words"},_sfc_main$l=defineComponent({__name:"WarningTabPanel",props:{nodePack:{},conflictResult:{}},setup(i){const o=computed(()=>i.nodePack?.id||""),{importFailedInfo:n,showImportFailedDialog:s}=useImportFailedDetection(o);return(a,r)=>(openBlock(),createElementBlock("div",_hoisted_1$i,[unref(n)?(openBlock(),createElementBlock("button",{key:0,class:"inline-flex cursor-pointer items-center justify-end gap-1 border-none bg-transparent outline-none",onClick:r[0]||(r[0]=(...l)=>unref(s)&&unref(s)(...l))},[r[1]||(r[1]=createBaseVNode("i",{class:"pi pi-code text-base"},null,-1)),createBaseVNode("span",_hoisted_2$h,toDisplayString(unref(t)("serverStart.openLogs")),1)])):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(a.conflictResult?.conflicts||[],(l,u)=>(openBlock(),createElementBlock("div",{key:u,class:"rounded-md bg-yellow-800/20 p-3"},[createBaseVNode("div",_hoisted_3$b,[createBaseVNode("div",_hoisted_4$8,toDisplayString(unref(getConflictMessage)(l,a.$t)),1)])]))),128))]))}}),_hoisted_1$h={class:"overflow-hidden"},_hoisted_2$g={class:"flex items-center gap-1"},_sfc_main$k=defineComponent({__name:"InfoTabs",props:{nodePack:{},hasCompatibilityIssues:{type:Boolean},conflictResult:{}},setup(i){const n=inject(ImportFailedKey)?.importFailed,s=computed(()=>{const{comfy_nodes:r}=i.nodePack;return r??[]}),a=ref("description");return watchEffect(()=>{i.hasCompatibilityIssues?a.value="warning":a.value==="warning"&&(a.value="description")},{flush:"post"}),(r,l)=>(openBlock(),createElementBlock("div",_hoisted_1$h,[createVNode(unref(script$C),{value:a.value},{default:withCtx(()=>[createVNode(unref(script$F),{class:"scrollbar-hide overflow-x-auto"},{default:withCtx(()=>[r.hasCompatibilityIssues?(openBlock(),createBlock(unref(script$G),{key:0,value:"warning",class:"mr-6 p-2"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$g,[l[0]||(l[0]=createBaseVNode("span",null,"âš ï¸",-1)),createTextVNode(" "+toDisplayString(unref(n)?r.$t("g.error"):r.$t("g.warning")),1)])]),_:1})):createCommentVNode("",!0),createVNode(unref(script$G),{value:"description",class:"mr-6 p-2"},{default:withCtx(()=>[createTextVNode(toDisplayString(r.$t("g.description")),1)]),_:1}),createVNode(unref(script$G),{value:"nodes",class:"p-2"},{default:withCtx(()=>[createTextVNode(toDisplayString(r.$t("g.nodes")),1)]),_:1})]),_:1}),createVNode(unref(script$B),{class:"overflow-auto px-2 py-4"},{default:withCtx(()=>[r.hasCompatibilityIssues?(openBlock(),createBlock(unref(script$x),{key:0,value:"warning",class:"bg-transparent"},{default:withCtx(()=>[createVNode(_sfc_main$l,{"node-pack":r.nodePack,"conflict-result":r.conflictResult},null,8,["node-pack","conflict-result"])]),_:1})):createCommentVNode("",!0),createVNode(unref(script$x),{value:"description"},{default:withCtx(()=>[createVNode(_sfc_main$n,{"node-pack":r.nodePack},null,8,["node-pack"])]),_:1}),createVNode(unref(script$x),{value:"nodes"},{default:withCtx(()=>[createVNode(_sfc_main$m,{"node-pack":r.nodePack,"node-names":s.value},null,8,["node-pack","node-names"])]),_:1})]),_:1})]),_:1},8,["value"])]))}}),_hoisted_1$g={class:"flex py-1.5 text-xs"},_hoisted_2$f={class:"w-1/3 truncate pr-2 text-muted"},_hoisted_3$a={class:"w-2/3"},_sfc_main$j=defineComponent({__name:"MetadataRow",props:{label:{},value:{default:"N/A"}},setup(i){return(o,n)=>(openBlock(),createElementBlock("div",_hoisted_1$g,[createBaseVNode("div",_hoisted_2$f,toDisplayString(o.label),1),createBaseVNode("div",_hoisted_3$a,[renderSlot(o.$slots,"default",{},()=>[createTextVNode(toDisplayString(o.value),1)])])]))}}),_hoisted_1$f={key:0,class:"relative z-40 flex h-full flex-col overflow-hidden"},_hoisted_2$e={class:"top-0 z-10 w-full px-6 pt-6"},_hoisted_3$9={class:"mb-6"},_hoisted_4$7={class:"mb-6 overflow-hidden"},_hoisted_5$7={key:1,class:"flex-1 overflow-hidden px-8 pt-4 text-sm"},_sfc_main$i=defineComponent({__name:"InfoPanel",props:{nodePack:{}},setup(i){const o=ref(null),{isPackInstalled:n}=useComfyManagerStore(),s=computed(()=>n(i.nodePack.id)),a=ref(!1);provide(IsInstallingKey,a),whenever(s,()=>{a.value=!1});const{checkNodeCompatibility:r}=useConflictDetection(),{getConflictsForPackageByID:l}=useConflictDetectionStore(),{t:u,d:m,n:f}=useI18n(),_=computed(()=>{if(s.value&&i.nodePack.id)return l(i.nodePack.id)||null;const T=r(i.nodePack);return T.hasConflict?{package_id:i.nodePack.id||"",package_name:i.nodePack.name||"",has_conflict:!0,conflicts:T.conflicts,is_compatible:!1}:null}),y=computed(()=>_.value?.has_conflict),b=computed(()=>i.nodePack.id||""),{importFailed:w,showImportFailedDialog:k}=useImportFailedDetection(b);provide(ImportFailedKey,{importFailed:w,showImportFailedDialog:k});const S=computed(()=>[{key:"publisher",label:u("manager.createdBy"),value:i.nodePack.publisher?.name??i.nodePack.publisher?.id},{key:"downloads",label:u("manager.downloads"),value:i.nodePack.downloads?f(i.nodePack.downloads):void 0},{key:"lastUpdated",label:u("manager.lastUpdated"),value:i.nodePack.latest_version?.createdAt?m(i.nodePack.latest_version.createdAt,{dateStyle:"medium"}):void 0}]),{y:C}=useScroll(o,{eventListenerOptions:{passive:!0}}),I=p(()=>{C.value=0},"onNodePackChange");return whenever(()=>i.nodePack.id,(T,E)=>{T!==E&&I()},{immediate:!0}),(T,E)=>T.nodePack?(openBlock(),createElementBlock("div",_hoisted_1$f,[createBaseVNode("div",_hoisted_2$e,[createVNode(_sfc_main$q,{"node-packs":[T.nodePack],"has-conflict":y.value},null,8,["node-packs","has-conflict"])]),createBaseVNode("div",{ref_key:"scrollContainer",ref:o,class:"scrollbar-hide flex-1 overflow-y-auto p-6 pt-2 text-sm"},[createBaseVNode("div",_hoisted_3$9,[!unref(w)&&unref(n)(T.nodePack.id)?(openBlock(),createBlock(_sfc_main$j,{key:0,label:unref(u)("manager.filter.enabled"),class:"flex",style:{"align-items":"center"}},{default:withCtx(()=>[createVNode(_sfc_main$t,{"node-pack":T.nodePack,"has-conflict":y.value},null,8,["node-pack","has-conflict"])]),_:1},8,["label"])):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(S.value,N=>withDirectives((openBlock(),createBlock(_sfc_main$j,{key:N.key,label:N.label,value:N.value},null,8,["label","value"])),[[vShow,N.value!==void 0&&N.value!==null]])),128)),createVNode(_sfc_main$j,{label:unref(u)("g.status")},{default:withCtx(()=>[createVNode(_sfc_main$x,{"status-type":T.nodePack.status,"has-compatibility-issues":y.value},null,8,["status-type","has-compatibility-issues"])]),_:1},8,["label"]),createVNode(_sfc_main$j,{label:unref(u)("manager.version")},{default:withCtx(()=>[createVNode(_sfc_main$u,{"node-pack":T.nodePack,"is-selected":!0},null,8,["node-pack"])]),_:1},8,["label"])]),createBaseVNode("div",_hoisted_4$7,[createVNode(_sfc_main$k,{"node-pack":T.nodePack,"has-compatibility-issues":y.value,"conflict-result":_.value},null,8,["node-pack","has-compatibility-issues","conflict-result"])])],512)])):(openBlock(),createElementBlock("div",_hoisted_5$7,toDisplayString(T.$t("manager.infoPanelEmpty")),1))}}),_hoisted_1$e={class:"relative h-[104px] w-[224px] shadow-xl"},_hoisted_2$d={class:"rounded-lg border p-0.5 shadow-lg"},_sfc_main$h=defineComponent({__name:"PackIconStacked",props:{nodePacks:{},maxVisible:{default:3},offset:{default:8}},setup(i){return(o,n)=>(openBlock(),createElementBlock("div",_hoisted_1$e,[(openBlock(!0),createElementBlock(Fragment,null,renderList(o.nodePacks.slice(0,o.maxVisible),(s,a)=>(openBlock(),createElementBlock("div",{key:s.id,class:"absolute h-[90px] w-[210px]",style:normalizeStyle({bottom:`${a*o.offset}px`,right:`${a*o.offset}px`,zIndex:o.maxVisible-a})},[createBaseVNode("div",_hoisted_2$d,[createVNode(_sfc_main$r,{"node-pack":s},null,8,["node-pack"])])],4))),128))]))}});function usePacksSelection(i){const o=useComfyManagerStore(),n=computed(()=>i.value.filter(m=>o.isPackInstalled(m.id))),s=computed(()=>i.value.filter(m=>!o.isPackInstalled(m.id))),a=computed(()=>n.value.length===i.value.length),r=computed(()=>s.value.length===i.value.length),l=computed(()=>n.value.length>0&&s.value.length>0),u=computed(()=>a.value?"all-installed":r.value?"none-installed":"mixed");return{installedPacks:n,notInstalledPacks:s,isAllInstalled:a,isNoneInstalled:r,isMixed:l,selectionState:u}}p(usePacksSelection,"usePacksSelection");const STATUS_PRIORITY=["NodeStatusBanned","NodeVersionStatusBanned","NodeStatusDeleted","NodeVersionStatusDeleted","NodeVersionStatusFlagged","NodeVersionStatusPending","NodeStatusActive","NodeVersionStatusActive"];function usePacksStatus(i){const o=useConflictDetectionStore(),n=computed(()=>i.value.some(a=>a.id&&o.getConflictsForPackageByID(a.id)?.conflicts?.some(l=>l.type==="import_failed")||!1)),s=computed(()=>{if(n.value)return"NodeVersionStatusActive";for(const a of STATUS_PRIORITY)if(i.value.some(r=>r.status===a))return a;return"NodeVersionStatusActive"});return{hasImportFailed:n,overallStatus:s}}p(usePacksStatus,"usePacksStatus");const _hoisted_1$d={key:0,class:"flex h-full flex-col"},_hoisted_2$c={class:"flex-1 overflow-auto p-6"},_hoisted_3$8={class:"mt-5"},_hoisted_4$6={class:"mr-2 inline-block text-base text-blue-500"},_hoisted_5$6={class:"text-base"},_hoisted_6$5={key:0,class:"text-sm text-neutral-500"},_hoisted_7$5={class:"mb-6"},_hoisted_8$4={key:1,class:"mx-8 mt-4 flex-1 overflow-hidden text-sm"},_sfc_main$g=defineComponent({__name:"InfoPanelMultiItem",props:{nodePacks:{}},setup(i){const o=toRef$2(()=>i.nodePacks),{installedPacks:n,notInstalledPacks:s,isAllInstalled:a,isNoneInstalled:r,isMixed:l}=usePacksSelection(o),{hasImportFailed:u,overallStatus:m}=usePacksStatus(o),{checkNodeCompatibility:f}=useConflictDetection(),{getNodeDefs:_}=useComfyRegistryStore();provide(ImportFailedKey,{importFailed:u,showImportFailedDialog:p(()=>{},"showImportFailedDialog")});const y=computed(()=>{const I=new Map;for(const T of s.value){const E=f(T);E.hasConflict&&T.id&&I.set(T.id,E.conflicts)}return I}),b=computed(()=>{const I=new Map;return y.value.forEach(T=>{T.forEach(E=>{const N=`${E.type}-${E.current_value}-${E.required_value}`;I.has(N)||I.set(N,E)})}),Array.from(I.values())}),w=computed(()=>b.value.length>0),k=p(async I=>I.latest_version?.version?(await _.call({packId:I.id,version:I.latest_version?.version,limit:8192}))?.comfy_nodes??[]:[],"getPackNodes"),{state:S}=useAsyncState(()=>Promise.all(i.nodePacks.map(k)),[],{immediate:!0}),C=computed(()=>S.value.reduce((I,T)=>I+(T?.length||0),0));return onUnmounted(()=>{_.cancel()}),(I,T)=>I.nodePacks?.length?(openBlock(),createElementBlock("div",_hoisted_1$d,[createBaseVNode("div",_hoisted_2$c,[createVNode(_sfc_main$q,{"node-packs":I.nodePacks},{thumbnail:withCtx(()=>[createVNode(_sfc_main$h,{"node-packs":I.nodePacks},null,8,["node-packs"])]),title:withCtx(()=>[createBaseVNode("div",_hoisted_3$8,[createBaseVNode("span",_hoisted_4$6,toDisplayString(I.nodePacks.length),1),createBaseVNode("span",_hoisted_5$6,toDisplayString(I.$t("manager.packsSelected")),1)])]),"install-button":withCtx(()=>[unref(l)?(openBlock(),createElementBlock("div",_hoisted_6$5,toDisplayString(I.$t("manager.mixedSelectionMessage")),1)):unref(a)?(openBlock(),createBlock(_sfc_main$s,{key:1,size:"md","node-packs":unref(n)},null,8,["node-packs"])):unref(r)?(openBlock(),createBlock(_sfc_main$1a,{key:2,size:"md","node-packs":unref(s),"has-conflict":w.value,"conflict-info":b.value},null,8,["node-packs","has-conflict","conflict-info"])):createCommentVNode("",!0)]),_:1},8,["node-packs"]),createBaseVNode("div",_hoisted_7$5,[createVNode(_sfc_main$j,{label:I.$t("g.status")},{default:withCtx(()=>[createVNode(_sfc_main$x,{"status-type":unref(m),"has-compatibility-issues":w.value},null,8,["status-type","has-compatibility-issues"])]),_:1},8,["label"]),createVNode(_sfc_main$j,{label:I.$t("manager.totalNodes"),value:C.value},null,8,["label","value"])])])])):(openBlock(),createElementBlock("div",_hoisted_8$4,toDisplayString(I.$t("manager.infoPanelEmpty")),1))}}),_hoisted_1$c={class:"aspect-7/3 w-full overflow-hidden"},_hoisted_2$b={key:0,class:"h-full w-full"},_hoisted_3$7=["alt"],_hoisted_4$5={key:1,class:"relative h-full w-full"},_hoisted_5$5=["src","alt"],DEFAULT_BANNER="/assets/images/fallback-gradient-avatar.svg",_sfc_main$f=defineComponent({__name:"PackBanner",props:{nodePack:{}},setup(i){const o=ref(!1),n=computed(()=>!i.nodePack.banner_url&&!i.nodePack.icon),s=computed(()=>i.nodePack.banner_url||i.nodePack.icon);return(a,r)=>(openBlock(),createElementBlock("div",_hoisted_1$c,[n.value?(openBlock(),createElementBlock("div",_hoisted_2$b,[createBaseVNode("img",{src:DEFAULT_BANNER,alt:a.$t("g.defaultBanner"),class:"h-full w-full object-cover"},null,8,_hoisted_3$7)])):(openBlock(),createElementBlock("div",_hoisted_4$5,[s.value?(openBlock(),createElementBlock("div",{key:0,class:"absolute inset-0 bg-cover bg-center bg-no-repeat opacity-30",style:normalizeStyle({backgroundImage:`url(${s.value})`,filter:"blur(10px)"})},null,4)):createCommentVNode("",!0),createBaseVNode("img",{src:o.value?DEFAULT_BANNER:s.value,alt:a.nodePack.name+" banner",class:normalizeClass(o.value?"relative w-full h-full object-cover z-10":"relative w-full h-full object-contain z-10"),onError:r[0]||(r[0]=l=>o.value=!0)},null,42,_hoisted_5$5)]))]))}}),_hoisted_1$b={class:"flex min-h-12 items-center justify-between px-4 py-2 text-xs leading-3 font-medium text-muted"},_hoisted_2$a={key:0,class:"flex items-center gap-1.5"},_sfc_main$e=defineComponent({__name:"PackCardFooter",props:{nodePack:{}},setup(i){const{isPackInstalled:o}=useComfyManagerStore(),n=computed(()=>o(i.nodePack?.id)),s=inject(IsInstallingKey),{n:a}=useI18n(),r=computed(()=>i.nodePack.downloads?a(i.nodePack.downloads):""),{checkNodeCompatibility:l}=useConflictDetection(),u=computed(()=>i.nodePack?l(i.nodePack).conflicts||[]:[]),m=computed(()=>u.value.length>0);return(f,_)=>(openBlock(),createElementBlock("div",_hoisted_1$b,[f.nodePack.downloads?(openBlock(),createElementBlock("div",_hoisted_2$a,[_[0]||(_[0]=createBaseVNode("i",{class:"pi pi-download text-muted"},null,-1)),createBaseVNode("span",null,toDisplayString(r.value),1)])):createCommentVNode("",!0),n.value?(openBlock(),createBlock(_sfc_main$t,{key:2,"has-conflict":m.value,"node-pack":f.nodePack},null,8,["has-conflict","node-pack"])):(openBlock(),createBlock(_sfc_main$1a,{key:1,"node-packs":[f.nodePack],"is-installing":unref(s),"has-conflict":m.value,"conflict-info":u.value},null,8,["node-packs","is-installing","has-conflict","conflict-info"]))]))}}),_hoisted_1$a={class:"h-full w-full px-4 pt-4 pb-3"},_hoisted_2$9={class:"flex h-full w-full flex-col gap-y-1"},_hoisted_3$6={class:"truncate overflow-hidden text-sm font-bold text-ellipsis"},_hoisted_4$4={key:0,class:"my-0 mb-1 line-clamp-3 min-h-12 flex-1 overflow-hidden text-xs leading-4 font-medium break-words text-muted"},_hoisted_5$4={class:"flex flex-col gap-y-2"},_hoisted_6$4={class:"flex flex-1 items-center gap-2"},_hoisted_7$4={key:0,class:"p-2 pl-0 text-xs"},_hoisted_8$3={key:1,class:"flex items-center justify-center gap-1 px-2 py-1 text-xs font-medium text-muted"},_hoisted_9$3={class:"flex"},_hoisted_10$3={key:0,class:"max-w-40 truncate text-xs leading-3 font-medium text-muted"},_sfc_main$d=defineComponent({__name:"PackCard",props:{nodePack:{},isSelected:{type:Boolean,default:!1}},setup(i){const{d:o}=useI18n(),n=useColorPaletteStore(),s=computed(()=>n.completedActivePalette.light_theme),{isPackInstalled:a,isPackEnabled:r,isPackInstalling:l}=useComfyManagerStore(),u=computed(()=>l(i.nodePack?.id));provide(IsInstallingKey,u);const m=computed(()=>a(i.nodePack?.id)),f=computed(()=>m.value&&!r(i.nodePack?.id)),_=computed(()=>isMergedNodePack(i.nodePack)?i.nodePack.comfy_nodes?.length:void 0),y=computed(()=>{if(!i.nodePack)return null;const{publisher:w,author:k}=i.nodePack;return w?.name??w?.id??k}),b=computed(()=>i.nodePack.latest_version?.createdAt?o(new Date(i.nodePack.latest_version.createdAt),{dateStyle:"medium"}):null);return(w,k)=>(openBlock(),createBlock(unref(script$6),{class:normalizeClass(["shadow-elevation-3 inline-flex size-full flex-col items-start justify-between overflow-hidden rounded-lg transition-all duration-200",{"selected-card":w.isSelected,"opacity-60":f.value}]),pt:{body:{class:"p-0 flex flex-col w-full h-full rounded-lg gap-0"},content:{class:"flex-1 flex flex-col rounded-lg min-h-0"},title:{class:"w-full h-full rounded-t-lg cursor-pointer"},footer:{class:"p-0 m-0 flex flex-col gap-0",style:{borderTop:s.value?"1px solid #f4f4f4":"1px solid #2C2C2C"}}}},{title:withCtx(()=>[createVNode(_sfc_main$f,{"node-pack":w.nodePack},null,8,["node-pack"])]),content:withCtx(()=>[createBaseVNode("div",_hoisted_1$a,[createBaseVNode("div",_hoisted_2$9,[createBaseVNode("span",_hoisted_3$6,toDisplayString(w.nodePack.name),1),w.nodePack.description?(openBlock(),createElementBlock("p",_hoisted_4$4,toDisplayString(w.nodePack.description),1)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_5$4,[createBaseVNode("div",_hoisted_6$4,[_.value?(openBlock(),createElementBlock("div",_hoisted_7$4,toDisplayString(_.value)+" "+toDisplayString(w.$t("g.nodes")),1)):createCommentVNode("",!0),createVNode(_sfc_main$u,{"node-pack":w.nodePack,"is-selected":w.isSelected,fill:!1,class:normalizeClass(u.value?"pointer-events-none":"")},null,8,["node-pack","is-selected","class"]),b.value?(openBlock(),createElementBlock("div",_hoisted_8$3,toDisplayString(b.value),1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_9$3,[y.value?(openBlock(),createElementBlock("span",_hoisted_10$3,toDisplayString(y.value),1)):createCommentVNode("",!0)])])])])]),footer:withCtx(()=>[createVNode(_sfc_main$e,{"node-pack":w.nodePack,"is-installing":u.value},null,8,["node-pack","is-installing"])]),_:1},8,["class","pt"]))}}),PackCard=_export_sfc(_sfc_main$d,[["__scopeId","data-v-d5c78bd4"]]),_sfc_main$c=defineComponent({__name:"PackUpdateButton",props:{nodePacks:{},hasDisabledUpdatePacks:{type:Boolean}},setup(i){const o=ref(!1),n=useComfyManagerStore(),s=p(l=>({id:l.id,version:l.latest_version.version}),"createPayload"),a=p(async l=>{if(!l.id||!l.latest_version?.version){console.warn("Pack missing required id or version:",l);return}await n.updatePack.call(s(l))},"updatePack"),r=p(async()=>{if(!i.nodePacks?.length){console.warn("No packs provided for update");return}o.value=!0;const l=i.nodePacks.filter(u=>n.isPackInstalled(u.id));if(!l.length){o.value=!1;return}try{await Promise.all(l.map(a)),n.updatePack.clear()}catch(u){console.error("Pack update failed:",u),console.error("Failed packs info:",l.map(m=>m.id))}finally{o.value=!1}},"updateAllPacks");return(l,u)=>{const m=resolveDirective("tooltip");return withDirectives((openBlock(),createBlock(_sfc_main$2D,mergeProps(l.$attrs,{type:"transparent",label:l.$t("manager.updateAll"),border:!0,size:"sm",disabled:o.value,onClick:r}),createSlots({_:2},[o.value?{name:"icon",fn:withCtx(()=>[createVNode(DotSpinner,{duration:"1s",size:12})]),key:"0"}:void 0]),1040,["label","disabled"])),[[m,l.hasDisabledUpdatePacks?l.$t("manager.disabledNodesWontUpdate"):null,void 0,{top:!0}]])}}}),_hoisted_1$9={class:"flex items-center gap-1"},_hoisted_2$8={class:"text-muted"},_sfc_main$b=defineComponent({__name:"SearchFilterDropdown",props:{options:{},label:{},modelValue:{}},emits:["update:modelValue"],setup(i){return(o,n)=>(openBlock(),createElementBlock("div",_hoisted_1$9,[createBaseVNode("span",_hoisted_2$8,toDisplayString(o.label)+":",1),createVNode(unref(script$H),{"model-value":o.modelValue,options:o.options,"option-label":"label","option-value":"id",class:"min-w-[6rem] border-none bg-transparent shadow-none",pt:{input:{class:"py-0 px-1 border-none"},trigger:{class:"hidden"},panel:{class:"shadow-md"},item:{class:"py-2 px-3 text-sm"}},"onUpdate:modelValue":n[0]||(n[0]=s=>o.$emit("update:modelValue",s))},null,8,["model-value","options"])]))}}),useUpdateAvailableNodes=p(()=>{const i=useComfyManagerStore(),{installedPacks:o,isLoading:n,error:s,startFetchInstalled:a}=useInstalledPacks(),r=p(y=>{if(!i.isPackInstalled(y?.id))return!1;const w=i.getInstalledPackVersion(y.id??""),k=y.latest_version?.version;return!!w&&!semver.valid(w)||!k||!w?!1:semver.compare(k,w)>0},"isOutdatedPack"),l=p(y=>y.filter(r),"filterOutdatedPacks"),u=computed(()=>o.value.length?l(o.value):[]),m=computed(()=>u.value.filter(y=>i.isPackEnabled(y.id))),f=computed(()=>m.value.length>0),_=computed(()=>u.value.length>m.value.length);return onMounted(async()=>{!o.value.length&&!n.value&&await a()}),{updateAvailableNodePacks:u,enabledUpdateAvailableNodePacks:m,hasUpdateAvailable:f,hasDisabledUpdatePacks:_,isLoading:n,error:s}},"useUpdateAvailableNodes"),_hoisted_1$8={class:"relative w-full p-6"},_hoisted_2$7={class:"flex h-12 items-center justify-between gap-1"},_hoisted_3$5={class:"flex w-5/12 items-center"},_hoisted_4$3={class:"mt-3 flex text-sm"},_hoisted_5$3={class:"ml-1 flex gap-6"},_hoisted_6$3={class:"ml-6 flex items-center gap-4"},_hoisted_7$3={key:0,class:"text-color-secondary"},_sfc_main$a=defineComponent({__name:"RegistrySearchBar",props:mergeModels({searchResults:{},suggestions:{},sortOptions:{},isMissingTab:{type:Boolean},isUpdateAvailableTab:{type:Boolean}},{searchQuery:{},searchQueryModifiers:{},searchMode:{default:"packs"},searchModeModifiers:{},sortField:{default:SortableAlgoliaField.Downloads},sortFieldModifiers:{}}),emits:["update:searchQuery","update:searchMode","update:sortField"],setup(i){const o=useModel(i,"searchQuery"),n=useModel(i,"searchMode"),s=useModel(i,"sortField"),{t:a}=useI18n(),{missingNodePacks:r,isLoading:l,error:u}=useMissingNodes(),{hasUpdateAvailable:m,enabledUpdateAvailableNodePacks:f,hasDisabledUpdatePacks:_}=useUpdateAvailableNodes(),y=computed(()=>o.value?.trim()&&i.searchResults?.length),b=computed(()=>i.sortOptions?i.sortOptions.map(S=>({id:S.id,label:S.label})):[]),w=[{id:"packs",label:a("manager.filter.nodePack")},{id:"nodes",label:a("g.nodes")}],k=p(S=>{o.value=S.value.query},"onOptionSelect");return(S,C)=>(openBlock(),createElementBlock("div",_hoisted_1$8,[createBaseVNode("div",_hoisted_2$7,[createBaseVNode("div",_hoisted_3$5,[createVNode(unref(script$I),{modelValue:o.value,"onUpdate:modelValue":C[0]||(C[0]=I=>o.value=I),modelModifiers:{lazy:!0},suggestions:S.suggestions||[],placeholder:S.$t("manager.searchPlaceholder"),"complete-on-focus":!1,delay:8,"option-label":"query",class:"w-full",pt:{pcInputText:{root:{autofocus:!0,class:"w-full rounded-2xl"}},loader:{style:"display: none"}},"show-empty-message":!1,onComplete:unref(stubTrue),onOptionSelect:k},null,8,["modelValue","suggestions","placeholder","onComplete"])]),S.isMissingTab&&unref(r).length>0?(openBlock(),createBlock(_sfc_main$1a,{key:0,disabled:unref(l)||!!unref(u),"node-packs":unref(r),label:S.$t("manager.installAllMissingNodes")},null,8,["disabled","node-packs","label"])):createCommentVNode("",!0),S.isUpdateAvailableTab&&unref(m)?(openBlock(),createBlock(_sfc_main$c,{key:1,"node-packs":unref(f),"has-disabled-update-packs":unref(_)},null,8,["node-packs","has-disabled-update-packs"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_4$3,[createBaseVNode("div",_hoisted_5$3,[createVNode(_sfc_main$b,{"model-value":n.value,"onUpdate:modelValue":C[1]||(C[1]=I=>n.value=I),options:w,label:S.$t("g.filter")},null,8,["model-value","label"]),createVNode(_sfc_main$b,{"model-value":s.value,"onUpdate:modelValue":C[2]||(C[2]=I=>s.value=I),options:b.value,label:S.$t("g.sort")},null,8,["model-value","options","label"])]),createBaseVNode("div",_hoisted_6$3,[y.value?(openBlock(),createElementBlock("small",_hoisted_7$3,toDisplayString(S.$t("g.resultsCount",{count:S.searchResults?.length||0})),1)):createCommentVNode("",!0)])])]))}}),_hoisted_1$7={class:"flex h-full flex-col overflow-hidden rounded-lg shadow-sm","data-virtual-grid-item":""},_hoisted_2$6={class:"flex w-full items-center justify-between px-4 py-3"},_hoisted_3$4={class:"flex items-center"},_hoisted_4$2={class:"flex h-6 w-6 items-center justify-center"},_hoisted_5$2={class:"flex flex-1 p-4"},_hoisted_6$2={class:"mr-4 shrink-0"},_hoisted_7$2={class:"flex flex-1 flex-col overflow-hidden"},_hoisted_8$2={class:"mb-3"},_hoisted_9$2={class:"flex gap-2"},_hoisted_10$2={class:"flex w-full items-center justify-between px-5 py-4"},_sfc_main$9=defineComponent({__name:"PackCardSkeleton",setup(i){return(o,n)=>(openBlock(),createElementBlock("div",_hoisted_1$7,[createBaseVNode("div",_hoisted_2$6,[createBaseVNode("div",_hoisted_3$4,[createBaseVNode("div",_hoisted_4$2,[createVNode(unref(script$4),{shape:"circle",width:"1.5rem",height:"1.5rem"})]),createVNode(unref(script$4),{width:"5rem",height:"1rem",class:"ml-2"})]),createVNode(unref(script$4),{width:"4rem",height:"1.75rem","border-radius":"0.75rem"})]),createBaseVNode("div",_hoisted_5$2,[createBaseVNode("div",_hoisted_6$2,[createVNode(unref(script$4),{width:"4rem",height:"4rem","border-radius":"0.5rem"})]),createBaseVNode("div",_hoisted_7$2,[createVNode(unref(script$4),{width:"80%",height:"1rem",class:"mb-2"}),createBaseVNode("div",_hoisted_8$2,[createVNode(unref(script$4),{width:"100%",height:"0.75rem",class:"mb-1"}),createVNode(unref(script$4),{width:"95%",height:"0.75rem",class:"mb-1"}),createVNode(unref(script$4),{width:"90%",height:"0.75rem"})]),createBaseVNode("div",_hoisted_9$2,[createVNode(unref(script$4),{width:"4rem",height:"1.5rem","border-radius":"0.75rem"}),createVNode(unref(script$4),{width:"5rem",height:"1.5rem","border-radius":"0.75rem"})])])]),createBaseVNode("div",_hoisted_10$2,[createVNode(unref(script$4),{width:"4rem",height:"0.8rem"}),createVNode(unref(script$4),{width:"6rem",height:"0.8rem"})])]))}}),_sfc_main$8=defineComponent({__name:"GridSkeleton",props:{skeletonCardCount:{default:12},gridStyle:{}},setup(i){return(o,n)=>(openBlock(),createElementBlock("div",{style:normalizeStyle(o.gridStyle)},[(openBlock(!0),createElementBlock(Fragment,null,renderList(o.skeletonCardCount,s=>(openBlock(),createBlock(_sfc_main$9,{key:s}))),128))],4))}}),STORAGE_KEY="Comfy.Manager.UI.State",useManagerStatePersistence=p(()=>{const i=p(()=>{try{const s=localStorage.getItem(STORAGE_KEY);if(s)return JSON.parse(s)}catch(s){console.error("Failed to load manager UI state:",s)}return{selectedTabId:ManagerTab.All,searchQuery:"",searchMode:"packs",sortField:SortableAlgoliaField.Downloads}},"loadStoredState"),o=p(s=>{localStorage.setItem(STORAGE_KEY,JSON.stringify(s))},"persistState");return{loadStoredState:i,persistState:o,reset:p(()=>{o({selectedTabId:ManagerTab.All,searchQuery:"",searchMode:"packs",sortField:SortableAlgoliaField.Downloads})},"reset")}},"useManagerStatePersistence"),SEARCH_CACHE_MAX_SIZE=64,DEFAULT_PAGE_SIZE=64,MIN_CHARS_FOR_SUGGESTIONS_ALGOLIA=2,RETRIEVE_ATTRIBUTES=["comfy_nodes","name","description","latest_version","status","publisher_id","total_install","create_time","update_time","license","repository_url","latest_version_status","comfy_node_extract_status","id","icon_url","github_stars","supported_os","supported_comfyui_version","supported_comfyui_frontend_version","supported_accelerators","banner_url"],searchPacksCache=new QuickLRU({maxSize:SEARCH_CACHE_MAX_SIZE}),toRegistryLatestVersion=p(i=>({version:i.latest_version,createdAt:i.update_time,status:i.latest_version_status,comfy_node_extract_status:i.comfy_node_extract_status??void 0}),"toRegistryLatestVersion"),toRegistryPublisher=p(i=>({id:i.publisher_id,name:i.publisher_id}),"toRegistryPublisher"),toRegistryPack=memoize(i=>({id:i.id??i.objectID,name:i.name,description:i.description,repository:i.repository_url,license:i.license,downloads:i.total_install,status:i.status,icon:i.icon_url,latest_version:toRegistryLatestVersion(i),publisher:toRegistryPublisher(i),created_at:i.create_time,category:i.category,author:i.author,tags:i.tags,github_stars:i.github_stars,supported_os:i.supported_os,supported_comfyui_version:i.supported_comfyui_version,supported_comfyui_frontend_version:i.supported_comfyui_frontend_version,supported_accelerators:i.supported_accelerators,banner_url:i.banner_url,comfy_nodes:i.comfy_nodes}),i=>i.id),useAlgoliaSearchProvider=p(()=>{const i=liteClient("4E0RO38HS8","684d998c36b67a9a9fce8fc2d8860579"),o=p(async(l,u)=>{const{pageSize:m,pageNumber:f}=u,_=omit(u,["pageSize","pageNumber"]),y=[{query:l,indexName:"nodes_index",attributesToRetrieve:RETRIEVE_ATTRIBUTES,..._,hitsPerPage:m,page:f}];l.length>=MIN_CHARS_FOR_SUGGESTIONS_ALGOLIA&&y.push({indexName:"nodes_index_query_suggestions",query:l});const{results:w}=await i.search({requests:y,strategy:"none"}),[k,S={hits:[]}]=w,C=k.hits.map(toRegistryPack),I=S.hits.map(T=>({query:T.query,popularity:T.popularity}));return{nodePacks:C,querySuggestions:I}},"searchPacksInternal");return{searchPacks:p(async(l,u)=>{const m=paramsToCacheKey({query:l,...u}),f=searchPacksCache.get(m);if(f!==void 0)return f;const _=await o(l,u);return searchPacksCache.set(m,_),_},"searchPacks"),clearSearchCache:p(()=>{searchPacksCache.clear()},"clearSearchCache"),getSortValue:p((l,u)=>{switch(u){case SortableAlgoliaField.Downloads:return l.downloads??0;case SortableAlgoliaField.Created:{const m=l.created_at;return m?new Date(m).getTime():0}case SortableAlgoliaField.Updated:return l.latest_version?.createdAt?new Date(l.latest_version.createdAt).getTime():0;case SortableAlgoliaField.Publisher:return l.publisher?.name??"";case SortableAlgoliaField.Name:return l.name??"";default:return 0}},"getSortValue"),getSortableFields:p(()=>[{id:SortableAlgoliaField.Downloads,label:"Downloads",direction:"desc"},{id:SortableAlgoliaField.Created,label:"Created",direction:"desc"},{id:SortableAlgoliaField.Updated,label:"Updated",direction:"desc"},{id:SortableAlgoliaField.Publisher,label:"Publisher",direction:"asc"},{id:SortableAlgoliaField.Name,label:"Name",direction:"asc"}],"getSortableFields")}},"useAlgoliaSearchProvider"),useComfyRegistrySearchProvider=p(()=>{const i=useComfyRegistryStore();return{searchPacks:p(async(r,l)=>{const{pageSize:u,pageNumber:m,restrictSearchableAttributes:f}=l,_=f?.includes("comfy_nodes"),y={search:_?void 0:r,comfy_node_search:_?r:void 0,limit:u,page:m+1},b=await i.search.call(y);return!b||!b.nodes?{nodePacks:[],querySuggestions:[]}:{nodePacks:b.nodes,querySuggestions:[]}},"searchPacks"),clearSearchCache:p(()=>{i.search.clear()},"clearSearchCache"),getSortValue:p((r,l)=>{switch(l){case"downloads":return r.downloads??0;case"name":return r.name??"";case"publisher":return r.publisher?.name??"";case"updated":return r.latest_version?.createdAt?new Date(r.latest_version.createdAt).getTime():0;default:return 0}},"getSortValue"),getSortableFields:p(()=>[{id:"downloads",label:"Downloads",direction:"desc"},{id:"name",label:"Name",direction:"asc"},{id:"publisher",label:"Publisher",direction:"asc"},{id:"updated",label:"Updated",direction:"desc"}],"getSortableFields")}},"useComfyRegistrySearchProvider"),CIRCUIT_BREAKER_THRESHOLD=3,CIRCUIT_BREAKER_TIMEOUT=6e4,useRegistrySearchGateway=p(()=>{const i=[];let o=0;try{i.push({provider:useAlgoliaSearchProvider(),name:"Algolia",isHealthy:!0,consecutiveFailures:0})}catch(y){console.warn("Failed to initialize Algolia provider:",y)}i.push({provider:useComfyRegistrySearchProvider(),name:"ComfyRegistry",isHealthy:!0,consecutiveFailures:0});const n=p(y=>!!(y.consecutiveFailures<CIRCUIT_BREAKER_THRESHOLD||y.lastAttempt&&Date.now()-y.lastAttempt.getTime()>CIRCUIT_BREAKER_TIMEOUT),"isCircuitClosed"),s=p(y=>{y.isHealthy=!0,y.consecutiveFailures=0,y.lastError=void 0},"recordSuccess"),a=p((y,b)=>{y.consecutiveFailures++,y.lastError=b,y.lastAttempt=new Date,y.consecutiveFailures>=CIRCUIT_BREAKER_THRESHOLD&&(y.isHealthy=!1,console.warn(`${y.name} provider circuit breaker opened after ${y.consecutiveFailures} failures`))},"recordFailure"),r=p(()=>{const y=i[o];if(y&&n(y))return y.provider;for(let b=0;b<i.length;b++){const w=i[b];if(n(w))return o=b,w.provider}throw new Error("No available search providers")},"getActiveProvider"),l=p(()=>{o<i.length-1&&o++},"updateActiveProviderOnFailure");return{searchPacks:p(async(y,b)=>{let w=null;for(let k=0;k<i.length;k++)try{const S=r(),C=i[o],I=await S.searchPacks(y,b);return s(C),I}catch(S){w=S;const C=i[o];a(C,w),console.warn(`${C.name} search provider failed (${C.consecutiveFailures} failures):`,S),l()}throw new Error(`All search providers failed. Last error: ${w?.message||"Unknown error"}`)},"searchPacks"),clearSearchCache:p(()=>{for(const y of i)try{y.provider.clearSearchCache()}catch(b){console.warn(`Failed to clear cache for ${y.name} provider:`,b)}},"clearSearchCache"),getSortValue:p((y,b)=>r().getSortValue(y,b),"getSortValue"),getSortableFields:p(()=>r().getSortableFields(),"getSortableFields")}},"useRegistrySearchGateway"),SEARCH_DEBOUNCE_TIME=320,DEFAULT_SORT_FIELD=SortableAlgoliaField.Downloads;function useRegistrySearch(i={}){const{initialSortField:o=DEFAULT_SORT_FIELD,initialSearchMode:n="packs",initialSearchQuery:s="",initialPageNumber:a=0}=i,r=ref(!1),l=ref(o),u=ref(n),m=ref(DEFAULT_PAGE_SIZE),f=ref(a),_=ref(s),y=ref([]),b=ref([]),w=computed(()=>u.value==="nodes"?["comfy_nodes"]:["name","description"]),k=useRegistrySearchGateway(),{searchPacks:S,clearSearchCache:C,getSortValue:I,getSortableFields:T}=k,E=p(async D=>{r.value=!0,D.append||(f.value=0);const{nodePacks:O,querySuggestions:M}=await S(_.value,{pageSize:m.value,pageNumber:f.value,restrictSearchableAttributes:w.value});let P=O;if(l.value&&l.value!==DEFAULT_SORT_FIELD){const $=T().find(F=>F.id===l.value)?.direction||"desc";P=orderBy(O,[F=>I(F,l.value)],[$])}D.append&&y.value?.length?y.value=y.value.concat(P):y.value=P,b.value=M,r.value=!1},"updateSearchResults"),N=p(()=>E({append:!1}),"onQueryChange"),L=p(()=>E({append:!0}),"onPageChange");watch([l,u],N),watch(f,L),watchDebounced(_,N,{debounce:SEARCH_DEBOUNCE_TIME,immediate:!0});const A=computed(()=>T());return{isLoading:r,pageNumber:f,pageSize:m,sortField:l,searchMode:u,searchQuery:_,suggestions:b,searchResults:y,sortOptions:A,clearCache:C}}p(useRegistrySearch,"useRegistrySearch");const _hoisted_1$6=["aria-label"],_hoisted_2$5={class:"relative flex flex-1 overflow-hidden"},_hoisted_3$3={class:"flex h-full flex-col px-6"},_hoisted_4$1={key:0,class:"relative mt-3 mb-4 flex items-center gap-6 rounded-lg bg-yellow-500/20 p-4"},_hoisted_5$1={class:"flex flex-1 flex-col gap-2"},_hoisted_6$1={class:"m-0 text-sm font-bold"},_hoisted_7$1={class:"m-0 text-xs"},_hoisted_8$1={class:"flex-1 overflow-auto"},_hoisted_9$1={key:0,class:"h-full scrollbar-hide w-full overflow-auto"},_hoisted_10$1={class:"z-20 flex w-[clamp(250px,33%,306px)] border-l-0"},_hoisted_11$1={class:"isolate flex w-full flex-col"},_sfc_main$7=defineComponent({__name:"ManagerDialogContent",props:{initialTab:{}},setup(i){const{t:o}=useI18n(),{buildDocsUrl:n}=useExternalLink(),s=useComfyManagerStore(),{getPackById:a}=useComfyRegistryStore(),r=useConflictAcknowledgment(),l=useManagerStatePersistence(),u=l.loadStoredState(),m={display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(17rem, 1fr))",padding:"0.5rem",gap:"1.5rem"},{isSmallScreen:f,isOpen:_,toggle:y}=useResponsiveCollapse(),{shouldShowManagerBanner:b,dismissWarningBanner:w,dismissRedDotNotification:k}=r,S=ref([{id:ManagerTab.All,label:o("g.all"),icon:"pi-list"},{id:ManagerTab.Installed,label:o("g.installed"),icon:"pi-box"},{id:ManagerTab.Workflow,label:o("manager.inWorkflow"),icon:"pi-folder"},{id:ManagerTab.Missing,label:o("g.missing"),icon:"pi-exclamation-circle"},{id:ManagerTab.UpdateAvailable,label:o("g.updateAvailable"),icon:"pi-sync"}]),C=i.initialTab??u.selectedTabId,I=ref(S.value.find(ie=>ie.id===C)||S.value[0]),{searchQuery:T,pageNumber:E,isLoading:N,searchResults:L,searchMode:A,sortField:D,suggestions:O,sortOptions:M}=useRegistrySearch({initialSortField:u.sortField,initialSearchMode:u.searchMode,initialSearchQuery:u.searchQuery});E.value=0;const P=p(()=>{E.value++},"onApproachEnd"),R=computed(()=>L.value.length===0&&T.value===""),V=computed(()=>T.value===""),$=ref([]),{startFetchInstalled:F,filterInstalledPack:j,installedPacks:U,isLoading:G,isReady:H}=useInstalledPacks(),{startFetchWorkflowPacks:W,filterWorkflowPack:X,workflowPacks:Q,isLoading:q,isReady:ee}=useWorkflowPacks(),Y=p(ie=>ie.filter(pe=>!s.isPackInstalled(pe.id)),"filterMissingPacks"),ae=computed(()=>I.value?.id===ManagerTab.UpdateAvailable),re=computed(()=>I.value?.id===ManagerTab.Installed),ue=computed(()=>I.value?.id===ManagerTab.Missing),K=computed(()=>I.value?.id===ManagerTab.Workflow),ne=computed(()=>I.value?.id===ManagerTab.All),de=p(ie=>{const{isUpdateAvailable:pe}=usePackUpdateStatus(ie);return pe.value===!0},"isOutdatedPack"),ve=p(ie=>ie.filter(de),"filterOutdatedPacks");watch([ae,U],async()=>{ae.value&&(V.value&&!U.value.length&&!H.value&&!G.value?await F():$.value=ve(U.value))},{immediate:!0}),watch([re,U],async()=>{re.value&&(V.value?!U.value.length&&!H.value&&!G.value?await F():$.value=U.value:$.value=j(L.value))},{immediate:!0}),watch([ue,K,Q,U],async()=>{!K.value&&!ue.value||(V.value?!Q.value.length&&!q.value&&!ee.value?(await W(),ue.value&&await F()):$.value=ue.value?Y(Q.value):Q.value:$.value=ue.value?Y(X(L.value)):X(L.value))},{immediate:!0}),watch([ne,L],()=>{ne.value&&($.value=L.value)});const _e=p(()=>{window.open(n("/troubleshooting/custom-node-issues",{includeLocale:!0}),"_blank")},"onClickWarningLink"),oe=p(()=>{switch(I.value?.id){case ManagerTab.Installed:$.value=V.value?U.value:j(L.value);break;case ManagerTab.Workflow:$.value=V.value?Q.value:X(L.value);break;case ManagerTab.Missing:V.value||($.value=Y(X(L.value)));break;case ManagerTab.UpdateAvailable:$.value=V.value?ve(U.value):ve(L.value);break;default:$.value=L.value}},"onResultsChange");watch(L,oe,{flush:"post"}),watch(()=>s.installedPacksIds,oe);const se=computed(()=>N.value?L.value.length===0:I.value?.id===ManagerTab.Installed?G.value:I.value?.id===ManagerTab.Workflow||I.value?.id===ManagerTab.Missing?q.value:R.value),he=computed(()=>$.value.map(ie=>({...ie,key:ie.id||ie.name}))),be=ref([]),Se=computed(()=>be.value.length===1?be.value[0]:null),me=p(()=>{switch(I.value?.id){case ManagerTab.Installed:return s.installedPacksIds?.size;case ManagerTab.Workflow:return Q.value?.length;case ManagerTab.Missing:return Q.value?.filter?.(ie=>!s.isPackInstalled(ie.id))?.length;default:return L.value.length}},"getLoadingCount"),fe=computed(()=>{const ie=me();return ie||(f.value?12:16)}),Z=p((ie,pe)=>{if(pe.shiftKey||pe.ctrlKey||pe.metaKey){const ge=be.value.findIndex(Ce=>Ce.id===ie.id);ge===-1?be.value.push(ie):be.value.splice(ge,1)}else be.value=[ie]},"selectNodePack"),J=p(()=>{be.value=[]},"unSelectItems"),le=p(ie=>{const pe=ie.target;pe&&!pe.closest("[data-virtual-grid-item]")&&J()},"handleGridContainerClick"),ce=computed(()=>be.value.length>1),ke=ref(null);whenever(Se,async()=>{a.cancel();const ie=Se.value;if(!ie?.id||ce.value||ke.value===ie.id)return;const pe=await a.call(ie.id);if(pe?.id===ie.id){ke.value=ie.id;const ge=merge({},ie,pe),Ce=be.value.findIndex(Ie=>Ie.id===ge.id);Ce!==-1&&be.value.splice(Ce,1,ge);const we=$.value.findIndex(Ie=>Ie.id===ge.id);we!==-1&&$.value.splice(we,1,ge)}});let ye=null;return onMounted(()=>{ye=document.getElementById("results-grid")}),watch([T,I],()=>{ye??=document.getElementById("results-grid"),ye&&(E.value=0,ye.scrollTop=0)}),watchEffect(()=>{k()}),onBeforeUnmount(()=>{l.persistState({selectedTabId:I.value?.id,searchQuery:T.value,searchMode:A.value,sortField:D.value})}),onUnmounted(()=>{a.cancel()}),(ie,pe)=>(openBlock(),createElementBlock("div",{class:"mx-auto flex h-full flex-col overflow-hidden","aria-label":ie.$t("manager.title")},[createVNode(ContentDivider,{width:.3}),unref(f)?(openBlock(),createBlock(unref(script),{key:0,icon:unref(_)?"pi pi-chevron-left":"pi pi-chevron-right",severity:"secondary",filled:"",class:normalizeClass(["absolute top-1/2 z-10 -translate-y-1/2",unref(_)?"left-[12rem]":"left-2"]),onClick:unref(y)},null,8,["icon","class","onClick"])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_2$5,[unref(_)?(openBlock(),createBlock(_sfc_main$y,{key:0,"selected-tab":I.value,"onUpdate:selectedTab":pe[0]||(pe[0]=ge=>I.value=ge),tabs:S.value},null,8,["selected-tab","tabs"])):createCommentVNode("",!0),createBaseVNode("div",{class:normalizeClass(["flex-1 overflow-auto bg-base-background",{"transition-all duration-300":unref(f)}])},[createBaseVNode("div",_hoisted_3$3,[unref(b)?(openBlock(),createElementBlock("div",_hoisted_4$1,[pe[5]||(pe[5]=createBaseVNode("i",{class:"pi pi-exclamation-triangle text-lg text-yellow-600"},null,-1)),createBaseVNode("div",_hoisted_5$1,[createBaseVNode("p",_hoisted_6$1,toDisplayString(ie.$t("manager.conflicts.warningBanner.title")),1),createBaseVNode("p",_hoisted_7$1,toDisplayString(ie.$t("manager.conflicts.warningBanner.message")),1),createBaseVNode("p",{class:"m-0 cursor-pointer text-sm font-bold",onClick:_e},toDisplayString(ie.$t("manager.conflicts.warningBanner.button")),1)]),createVNode(_sfc_main$2B,{class:"absolute top-0 right-0",type:"transparent",onClick:unref(w)},{default:withCtx(()=>pe[4]||(pe[4]=[createBaseVNode("i",{class:"pi pi-times text-xs text-base-foreground"},null,-1)])),_:1},8,["onClick"])])):createCommentVNode("",!0),createVNode(_sfc_main$a,{"search-query":unref(T),"onUpdate:searchQuery":pe[1]||(pe[1]=ge=>isRef(T)?T.value=ge:null),"search-mode":unref(A),"onUpdate:searchMode":pe[2]||(pe[2]=ge=>isRef(A)?A.value=ge:null),"sort-field":unref(D),"onUpdate:sortField":pe[3]||(pe[3]=ge=>isRef(D)?D.value=ge:null),"search-results":unref(L),suggestions:unref(O),"is-missing-tab":ue.value,"sort-options":unref(M),"is-update-available-tab":ae.value},null,8,["search-query","search-mode","sort-field","search-results","suggestions","is-missing-tab","sort-options","is-update-available-tab"]),createBaseVNode("div",_hoisted_8$1,[se.value?(openBlock(),createElementBlock("div",_hoisted_9$1,[createVNode(_sfc_main$8,{"grid-style":m,"skeleton-card-count":fe.value},null,8,["skeleton-card-count"])])):unref(L).length===0?(openBlock(),createBlock(NoResultsPlaceholder,{key:1,title:unref(s).error?ie.$t("manager.errorConnecting"):ie.$t("manager.noResultsFound"),message:unref(s).error?ie.$t("manager.tryAgainLater"):ie.$t("manager.tryDifferentSearch")},null,8,["title","message"])):(openBlock(),createElementBlock("div",{key:2,class:"h-full",onClick:le},[createVNode(VirtualGrid,{id:"results-grid",items:he.value,"buffer-rows":4,"grid-style":m,onApproachEnd:P},{item:withCtx(({item:ge})=>[createVNode(PackCard,{"node-pack":ge,"is-selected":be.value.some(Ce=>Ce.id===ge.id),onClick:withModifiers(Ce=>Z(ge,Ce),["stop"])},null,8,["node-pack","is-selected","onClick"])]),_:1},8,["items"])]))])])],2),createBaseVNode("div",_hoisted_10$1,[createVNode(ContentDivider,{orientation:"vertical",width:.2}),createBaseVNode("div",_hoisted_11$1,[!ce.value&&Se.value?(openBlock(),createBlock(_sfc_main$i,{key:0,"node-pack":Se.value},null,8,["node-pack"])):(openBlock(),createBlock(_sfc_main$g,{key:1,"node-packs":be.value},null,8,["node-packs"]))])])])],8,_hoisted_1$6))}}),_sfc_main$6={},_hoisted_1$5={class:"w-full"},_hoisted_2$4={class:"flex items-center"},_hoisted_3$2={class:"text-left text-lg font-normal"};function _sfc_render$1(i,o){return openBlock(),createElementBlock("div",_hoisted_1$5,[createBaseVNode("div",_hoisted_2$4,[createBaseVNode("h2",_hoisted_3$2,toDisplayString(i.$t("manager.discoverCommunityContent")),1)])])}p(_sfc_render$1,"_sfc_render$1");const ManagerHeader=_export_sfc(_sfc_main$6,[["render",_sfc_render$1]]),_hoisted_1$4={class:"flex w-[552px] flex-col"},_hoisted_2$3={class:"flex h-full w-full flex-col gap-2 px-4 py-6"},_hoisted_3$1={key:0},_hoisted_4={class:"m-0 mb-4 text-sm leading-4 text-base-foreground"},_hoisted_5={key:1,class:"flex min-h-8 w-full flex-col rounded-lg bg-base-background"},_hoisted_6={class:"flex flex-1"},_hoisted_7={class:"mr-2 text-xs font-bold text-warning-background"},_hoisted_8={class:"text-xs font-bold text-base-foreground"},_hoisted_9={key:0,"data-testid":"conflict-dialog-panel-expanded",class:"flex max-h-[142px] scrollbar-hide flex-col gap-2.5 overflow-y-auto px-4 py-2"},_hoisted_10={class:"text-xs text-muted"},_hoisted_11={class:"flex min-h-8 w-full flex-col rounded-lg bg-base-background"},_hoisted_12={class:"flex flex-1"},_hoisted_13={class:"mr-2 text-xs font-bold text-warning-background"},_hoisted_14={class:"text-xs font-bold text-base-foreground"},_hoisted_15={key:0,"data-testid":"conflict-dialog-panel-expanded",class:"flex max-h-[142px] scrollbar-hide flex-col gap-2.5 overflow-y-auto px-4 py-2"},_hoisted_16={class:"text-xs text-muted"},_hoisted_17={class:"flex min-h-8 w-full flex-col rounded-lg bg-base-background"},_hoisted_18={class:"flex flex-1"},_hoisted_19={class:"mr-2 text-xs font-bold text-warning-background"},_hoisted_20={class:"text-xs font-bold text-base-foreground"},_hoisted_21={key:0,"data-testid":"conflict-dialog-panel-expanded",class:"flex max-h-[142px] scrollbar-hide flex-col gap-2.5 overflow-y-auto px-4 py-2"},_hoisted_22={class:"text-xs text-muted"},_sfc_main$5=defineComponent({__name:"NodeConflictDialogContent",props:{showAfterWhatsNew:{type:Boolean,default:!1},conflictedPackages:{}},setup(i){const{t:o}=useI18n(),{conflictedPackages:n}=useConflictDetection(),s=ref(!1),a=ref(!1),r=ref(!1),l=computed(()=>i.conflictedPackages||n.value),u=computed(()=>{const w=flatMap(l.value,k=>k.conflicts);return filter(w,k=>k.type!=="import_failed")}),m=computed(()=>filter(l.value,w=>some(w.conflicts,k=>k.type==="import_failed"))),f=computed(()=>map(m.value,w=>w.package_name||w.package_id)),_=p(()=>{r.value=!r.value,s.value=!1,a.value=!1},"toggleImportFailedPanel"),y=p(()=>{s.value=!s.value,a.value=!1,r.value=!1},"toggleConflictsPanel"),b=p(()=>{a.value=!a.value,s.value=!1,r.value=!1},"toggleExtensionsPanel");return(w,k)=>(openBlock(),createElementBlock("div",_hoisted_1$4,[createVNode(ContentDivider,{width:1}),createBaseVNode("div",_hoisted_2$3,[w.showAfterWhatsNew?(openBlock(),createElementBlock("div",_hoisted_3$1,[createBaseVNode("p",_hoisted_4,[createTextVNode(toDisplayString(w.$t("manager.conflicts.description"))+" ",1),k[0]||(k[0]=createBaseVNode("br",null,null,-1)),k[1]||(k[1]=createBaseVNode("br",null,null,-1)),createTextVNode(" "+toDisplayString(w.$t("manager.conflicts.info")),1)])])):createCommentVNode("",!0),f.value.length>0?(openBlock(),createElementBlock("div",_hoisted_5,[createBaseVNode("div",{"data-testid":"conflict-dialog-panel-toggle",class:"flex h-8 w-full items-center justify-between gap-2 pl-4",onClick:_},[createBaseVNode("div",_hoisted_6,[createBaseVNode("span",_hoisted_7,toDisplayString(f.value.length),1),createBaseVNode("span",_hoisted_8,toDisplayString(w.$t("manager.conflicts.importFailedExtensions")),1)]),createBaseVNode("div",null,[createVNode(unref(script),{icon:r.value?"pi pi-chevron-down text-xs":"pi pi-chevron-right text-xs",text:"",class:"!bg-transparent text-muted"},null,8,["icon"])])]),r.value?(openBlock(),createElementBlock("div",_hoisted_9,[(openBlock(!0),createElementBlock(Fragment,null,renderList(f.value,(S,C)=>(openBlock(),createElementBlock("div",{key:C,class:"conflict-list-item flex h-6 flex-shrink-0 items-center justify-between px-4"},[createBaseVNode("span",_hoisted_10,toDisplayString(S),1),k[2]||(k[2]=createBaseVNode("span",{class:"pi pi-info-circle text-sm"},null,-1))]))),128))])):createCommentVNode("",!0)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_11,[createBaseVNode("div",{"data-testid":"conflict-dialog-panel-toggle",class:"flex h-8 w-full items-center justify-between gap-2 pl-4",onClick:y},[createBaseVNode("div",_hoisted_12,[createBaseVNode("span",_hoisted_13,toDisplayString(u.value.length),1),createBaseVNode("span",_hoisted_14,toDisplayString(w.$t("manager.conflicts.conflicts")),1)]),createBaseVNode("div",null,[createVNode(unref(script),{icon:s.value?"pi pi-chevron-down text-xs":"pi pi-chevron-right text-xs",text:"",class:"!bg-transparent text-muted"},null,8,["icon"])])]),s.value?(openBlock(),createElementBlock("div",_hoisted_15,[(openBlock(!0),createElementBlock(Fragment,null,renderList(u.value,(S,C)=>(openBlock(),createElementBlock("div",{key:C,class:"conflict-list-item flex h-6 flex-shrink-0 items-center justify-between px-4"},[createBaseVNode("span",_hoisted_16,toDisplayString(unref(getConflictMessage)(S,unref(o))),1),k[3]||(k[3]=createBaseVNode("span",{class:"pi pi-info-circle text-sm"},null,-1))]))),128))])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_17,[createBaseVNode("div",{"data-testid":"conflict-dialog-panel-toggle",class:"flex h-8 w-full items-center justify-between gap-2 pl-4",onClick:b},[createBaseVNode("div",_hoisted_18,[createBaseVNode("span",_hoisted_19,toDisplayString(l.value.length),1),createBaseVNode("span",_hoisted_20,toDisplayString(w.$t("manager.conflicts.extensionAtRisk")),1)]),createBaseVNode("div",null,[createVNode(unref(script),{icon:a.value?"pi pi-chevron-down text-xs":"pi pi-chevron-right text-xs",text:"",class:"!bg-transparent text-muted"},null,8,["icon"])])]),a.value?(openBlock(),createElementBlock("div",_hoisted_21,[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.value,S=>(openBlock(),createElementBlock("div",{key:S.package_id,class:"conflict-list-item flex h-6 flex-shrink-0 items-center justify-between px-4"},[createBaseVNode("span",_hoisted_22,toDisplayString(S.package_name),1),k[4]||(k[4]=createBaseVNode("span",{class:"pi pi-info-circle text-sm"},null,-1))]))),128))])):createCommentVNode("",!0)])]),createVNode(ContentDivider,{width:1})]))}}),NodeConflictDialogContent=_export_sfc(_sfc_main$5,[["__scopeId","data-v-9daa91fe"]]),_hoisted_1$3={class:"flex w-full items-center justify-between px-3 py-4"},_hoisted_2$2={class:"flex w-full items-center justify-between gap-2 pr-1"},_sfc_main$4=defineComponent({__name:"NodeConflictFooter",props:{buttonText:{default:void 0},onButtonClick:{type:Function,default:void 0}},setup(i){const o=i,{buildDocsUrl:n}=useExternalLink(),s=useDialogStore(),a=p(()=>{window.open(n("/troubleshooting/custom-node-issues",{includeLocale:!0}),"_blank")},"handleConflictInfoClick"),r=p(()=>{s.closeDialog({key:"global-node-conflict"}),o.onButtonClick&&o.onButtonClick()},"handleButtonClick");return(l,u)=>(openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$2,[createVNode(unref(script),{label:l.$t("manager.conflicts.conflictInfoTitle"),text:"",severity:"secondary",size:"small",icon:"pi pi-info-circle",pt:{label:{class:"text-sm"}},onClick:a},null,8,["label"]),o.buttonText?(openBlock(),createBlock(unref(script),{key:0,label:o.buttonText,severity:"secondary",size:"small",onClick:r},null,8,["label"])):createCommentVNode("",!0)])]))}}),_sfc_main$3={},_hoisted_1$2={class:"flex h-12 w-full items-center justify-between pl-6"},_hoisted_2$1={class:"flex items-center gap-2"},_hoisted_3={class:"text-base font-bold"};function _sfc_render(i,o){return openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$1,[o[0]||(o[0]=createBaseVNode("i",{class:"pi pi-exclamation-triangle text-lg"},null,-1)),createBaseVNode("p",_hoisted_3,toDisplayString(i.$t("manager.conflicts.title")),1)])])}p(_sfc_render,"_sfc_render");const NodeConflictHeader=_export_sfc(_sfc_main$3,[["render",_sfc_render]]),useDialogService=p(()=>{const i=useDialogStore();function o(A){i.showDialog({key:"global-missing-nodes",headerComponent:_sfc_main$18,footerComponent:_sfc_main$19,component:_sfc_main$1c,dialogComponentProps:{closable:!0,pt:{root:{class:"bg-base-background border-border-default"},header:{class:"!p-0 !m-0"},content:{class:"!p-0 overflow-y-hidden"},footer:{class:"!p-0"},pcCloseButton:{root:{class:"!w-7 !h-7 !border-none !outline-none !p-2 !m-1.5"}}}},props:A})}p(o,"showLoadWorkflowWarning");function n(A){i.showDialog({key:"global-missing-models-warning",component:MissingModelsWarning,props:A})}p(n,"showMissingModelsWarning");function s(A){const D=A?{props:{defaultPanel:A}}:void 0;i.showDialog({key:"global-settings",headerComponent:SettingDialogHeader,component:SettingDialogContent,...D})}p(s,"showSettingsDialog");function a(){i.showDialog({key:"global-settings",headerComponent:SettingDialogHeader,component:SettingDialogContent,props:{defaultPanel:"about"}})}p(a,"showAboutDialog");function r(A){const D={error:{exceptionType:A.exception_type,exceptionMessage:A.exception_message,nodeId:A.node_id?.toString(),nodeType:A.node_type,traceback:A.traceback.join(`
`),reportType:"graphExecutionError"}};i.showDialog({key:"global-execution-error",component:_sfc_main$16,props:D,dialogComponentProps:{onClose:p(()=>{},"onClose")}})}p(r,"showExecutionErrorDialog");function l(A={}){i.showDialog({key:"global-manager",component:_sfc_main$7,headerComponent:ManagerHeader,dialogComponentProps:{closable:!0,pt:{pcCloseButton:{root:{class:"bg-dialog-surface w-9 h-9 p-1.5 rounded-full text-white"}},header:{class:"py-0! px-6 m-0! h-[68px]"},content:{class:"p-0! h-full w-[90vw] max-w-full flex-1 overflow-hidden"},root:{class:"manager-dialog"}}},props:A})}p(l,"showManagerDialog");function u(A){const D="fileName"in A?A.fileName:A.stack?.match(/(\/extensions\/.*\.js)/)?.[1],O=D?D.substring(D.indexOf("/extensions/")):void 0;return{errorMessage:A.toString(),stackTrace:A.stack,extensionFile:O}}p(u,"parseError");function m(A,D={}){const O=A instanceof Error?u(A):{errorMessage:String(A)},M={error:{exceptionType:D.title??"Unknown Error",exceptionMessage:O.errorMessage,traceback:O.stackTrace??t("errorDialog.noStackTrace"),reportType:D.reportType}};i.showDialog({key:"global-error",component:_sfc_main$16,props:M,dialogComponentProps:{onClose:p(()=>{},"onClose")}})}p(m,"showErrorDialog");function f(A){return i.showDialog({key:"global-manager-progress-dialog",component:_sfc_main$C,headerComponent:_sfc_main$A,footerComponent:_sfc_main$B,props:A?.props,priority:2,dialogComponentProps:{closable:!1,modal:!1,position:"bottom",pt:{root:{class:"w-[80%] max-w-2xl mx-auto border-none"},content:{class:"p-0!"},header:{class:"p-0! border-none"},footer:{class:"p-0! border-none"}}}})}p(f,"showManagerProgressDialog");async function _(A){return new Promise(D=>{i.showDialog({key:"api-nodes-signin",component:_sfc_main$2G,props:{apiNodeNames:A,onLogin:p(()=>y().then(O=>D(O)),"onLogin"),onCancel:p(()=>D(!1),"onCancel")},headerComponent:ComfyOrgHeader,dialogComponentProps:{closable:!1,onClose:p(()=>D(!1),"onClose")}})}).then(D=>(i.closeDialog({key:"api-nodes-signin"}),D))}p(_,"showApiNodesSignInDialog");async function y(){return new Promise(A=>{i.showDialog({key:"global-signin",component:_sfc_main$Z,headerComponent:ComfyOrgHeader,props:{onSuccess:p(()=>A(!0),"onSuccess")},dialogComponentProps:{closable:!0,onClose:p(()=>A(!1),"onClose")}})}).then(A=>(i.closeDialog({key:"global-signin"}),A))}p(y,"showSignInDialog");async function b({title:A,message:D,defaultValue:O="",placeholder:M}){return new Promise(P=>{i.showDialog({key:"global-prompt",title:A,component:_sfc_main$12,props:{message:D,defaultValue:O,onConfirm:p(R=>{P(R)},"onConfirm"),placeholder:M},dialogComponentProps:{onClose:p(()=>{P(null)},"onClose")}})})}p(b,"prompt");async function w({title:A,message:D,type:O="default",itemList:M=[],hint:P}){return new Promise(R=>{const V={key:"global-prompt",title:A,component:ConfirmationDialogContent,props:{message:D,type:O,itemList:M,onConfirm:R,hint:P},dialogComponentProps:{onClose:p(()=>R(null),"onClose")}};i.showDialog(V)})}p(w,"confirm");function k(A){const{isActiveSubscription:D}=useSubscription();if(D.value)return i.showDialog({key:"top-up-credits",component:_sfc_main$W,headerComponent:ComfyOrgHeader,props:A,dialogComponentProps:{pt:{header:{class:"p-3!"}}}})}p(k,"showTopUpCreditsDialog");function S(){return i.showDialog({key:"global-update-password",component:_sfc_main$V,headerComponent:ComfyOrgHeader,props:{onSuccess:p(()=>i.closeDialog({key:"global-update-password"}),"onSuccess")}})}p(S,"showUpdatePasswordDialog");function C(A){return{dialog:i.showExtensionDialog(A),closeDialog:p(()=>i.closeDialog({key:A.key}),"closeDialog")}}p(C,"showExtensionDialog");function I(A){i.isDialogOpen("global-manager")?i.closeDialog({key:"global-manager"}):l(A)}p(I,"toggleManagerDialog");function T(A){i.isDialogOpen("global-manager-progress-dialog")?i.closeDialog({key:"global-manager-progress-dialog"}):f({props:A})}p(T,"toggleManagerProgressDialog");function E(A){const D={headless:!0,modal:!0,closable:!1,pt:{root:{class:"rounded-2xl overflow-hidden"},header:{class:"p-0! hidden"},content:{class:"p-0! m-0!"}}};return i.showDialog({...A,dialogComponentProps:merge(D,A.dialogComponentProps||{})})}p(E,"showLayoutDialog");function N(A={}){const{dialogComponentProps:D,buttonText:O,onButtonClick:M,showAfterWhatsNew:P,conflictedPackages:R}=A;return i.showDialog({key:"global-node-conflict",headerComponent:NodeConflictHeader,footerComponent:_sfc_main$4,component:NodeConflictDialogContent,dialogComponentProps:{closable:!0,pt:{header:{class:"!p-0 !m-0"},content:{class:"!p-0 overflow-y-hidden"},footer:{class:"!p-0"},pcCloseButton:{root:{class:"!w-7 !h-7 !border-none !outline-none !p-2 !m-1.5 bg-dialog-surface text-white"}}},...D},props:{showAfterWhatsNew:P,conflictedPackages:R},footerProps:{buttonText:O,onButtonClick:M}})}p(N,"showNodeConflictDialog");async function L(){}return p(L,"showSubscriptionRequiredDialog"),{showLoadWorkflowWarning:o,showMissingModelsWarning:n,showSettingsDialog:s,showAboutDialog:a,showExecutionErrorDialog:r,showManagerDialog:l,showManagerProgressDialog:f,showApiNodesSignInDialog:_,showSignInDialog:y,showSubscriptionRequiredDialog:L,showTopUpCreditsDialog:k,showUpdatePasswordDialog:S,showExtensionDialog:C,prompt:b,showErrorDialog:m,confirm:w,toggleManagerDialog:I,toggleManagerProgressDialog:T,showLayoutDialog:E,showNodeConflictDialog:N}},"useDialogService"),_hoisted_1$1={class:"relative h-full w-full overflow-hidden"},_sfc_main$2=defineComponent({__name:"LayoutDefault",setup(i){return useFavicon("/assets/favicon.ico"),(o,n)=>{const s=resolveComponent("router-view");return openBlock(),createElementBlock("main",_hoisted_1$1,[createVNode(s)])}}}),STORAGE_PREFIX="Comfy.PreservedQuery.",preservedQueries=new Map,readQueryParam=p(i=>typeof i=="string"?i:void 0,"readQueryParam"),getStorageKey=p(i=>`${STORAGE_PREFIX}${i}`,"getStorageKey"),isValidQueryRecord=p(i=>typeof i!="object"||i===null||Array.isArray(i)?!1:Object.values(i).every(o=>typeof o=="string"),"isValidQueryRecord"),readFromStorage=p(i=>{try{const o=sessionStorage.getItem(getStorageKey(i));if(!o)return null;const n=JSON.parse(o);return isValidQueryRecord(n)?n:(console.warn("[preservedQuery] invalid storage format"),sessionStorage.removeItem(getStorageKey(i)),null)}catch{return console.warn("[preservedQuery] storage operation failed"),sessionStorage.removeItem(getStorageKey(i)),null}},"readFromStorage"),writeToStorage=p((i,o)=>{try{if(!o||Object.keys(o).length===0){sessionStorage.removeItem(getStorageKey(i));return}sessionStorage.setItem(getStorageKey(i),JSON.stringify(o))}catch(n){console.warn("[preservedQuery] failed to write storage",{namespace:i,error:n})}},"writeToStorage"),hydratePreservedQuery=p(i=>{if(preservedQueries.has(i))return;const o=readFromStorage(i);o&&preservedQueries.set(i,o)},"hydratePreservedQuery"),capturePreservedQuery=p((i,o,n)=>{const s={};n.forEach(a=>{const r=readQueryParam(o[a]);r&&(s[a]=r)}),Object.keys(s).length!==0&&(preservedQueries.set(i,s),writeToStorage(i,s))},"capturePreservedQuery"),mergePreservedQueryIntoQuery=p((i,o)=>{const n=preservedQueries.get(i);if(!n)return;const s={...o||{}};let a=!1;for(const[r,l]of Object.entries(n))typeof s[r]!="string"&&(s[r]=l,a=!0);return a?s:void 0},"mergePreservedQueryIntoQuery"),clearPreservedQuery=p(i=>{preservedQueries.has(i)&&(preservedQueries.delete(i),writeToStorage(i,null))},"clearPreservedQuery"),installPreservedQueryTracker=p((i,o)=>{const n=o.map(s=>({...s}));i.beforeEach((s,a,r)=>{const l=new Set(Object.keys(s.query));n.forEach(({namespace:u,keys:m})=>{hydratePreservedQuery(u),m.some(_=>l.has(_))&&capturePreservedQuery(u,s.query,m)}),r()})},"installPreservedQueryTracker"),PRESERVED_QUERY_NAMESPACES={TEMPLATE:"template"},isFileProtocol=window.location.protocol==="file:";function getBasePath(){return isElectron()?"/":window.location.pathname}p(getBasePath,"getBasePath");const basePath=getBasePath(),router=createRouter({history:isFileProtocol?createWebHashHistory():createWebHistory(basePath),routes:[{path:"/",component:_sfc_main$2,children:[{path:"",name:"GraphView",component:p(()=>__vitePreload(()=>import("./GraphView-JQ93MQWb.js").then(i=>i.G),__vite__mapDeps([60,1,2,9,5,10,11,53,46,3,35,55,59,30,25,27,28,31,61]),import.meta.url),"component"),beforeEnter:p(async(i,o,n)=>{const s=useUserStore();await s.initialize(),s.needsLogin?n("/user-select"):n()},"beforeEnter")},{path:"user-select",name:"UserSelectView",component:p(()=>__vitePreload(()=>import("./UserSelectView-tIQVssmq.js"),__vite__mapDeps([62,1,2,5,9,10,11,12,13]),import.meta.url),"component")}]}],scrollBehavior(i,o,n){return n||{top:0}}});installPreservedQueryTracker(router,[{namespace:PRESERVED_QUERY_NAMESPACES.TEMPLATE,keys:["template","source"]}]);const _hoisted_1={key:0},_hoisted_2=["id"],_sfc_main$1=defineComponent({__name:"GlobalDialog",setup(i){const o=useDialogStore();return(n,s)=>(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(o).dialogStack,a=>(openBlock(),createBlock(unref(script$p),mergeProps({key:a.key,visible:a.visible,"onUpdate:visible":p(r=>a.visible=r,"onUpdate:visible"),class:"global-dialog",ref_for:!0},a.dialogComponentProps,{pt:a.dialogComponentProps.pt,"aria-labelledby":a.key}),createSlots({header:withCtx(()=>[a.dialogComponentProps?.headless?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_1,[a.headerComponent?(openBlock(),createBlock(resolveDynamicComponent(a.headerComponent),{key:0,id:a.key},null,8,["id"])):(openBlock(),createElementBlock("h3",{key:1,id:a.key},toDisplayString(a.title||" "),9,_hoisted_2))]))]),default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(a.component),mergeProps({ref_for:!0},a.contentProps,{maximized:a.dialogComponentProps.maximized}),null,16,["maximized"]))]),_:2},[a.footerComponent?{name:"footer",fn:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(a.footerComponent),mergeProps({ref_for:!0},a.footerProps),null,16))]),key:"0"}:void 0]),1040,["visible","onUpdate:visible","pt","aria-labelledby"]))),128))}}),_sfc_main=defineComponent({__name:"App",setup(i){const o=useWorkspaceStore(),n=useConflictDetection(),s=useWorkflowStore(),a=useDialogService(),r=computed(()=>o.spinner),l=p(m=>{o.shiftDown=m.shiftKey},"handleKey");useEventListener(window,"keydown",l),useEventListener(window,"keyup",l);const u=p(m=>{const{target:f}=m;switch(!0){case f instanceof HTMLTextAreaElement:case(f instanceof HTMLInputElement&&f.type==="text"):electronAPI()?.showContextMenu({type:"text"});return}},"showContextMenu");return onMounted(()=>{window.__COMFYUI_FRONTEND_VERSION__=config.app_version,isElectron()&&document.addEventListener("contextmenu",u),window.addEventListener("vite:preloadError",async m=>{!app$1.vueAppReady||!s.activeWorkflow?.isModified?window.location.reload():await a.confirm({title:t("g.vitePreloadErrorTitle"),message:t("g.vitePreloadErrorMessage")}).then(f=>{f&&window.location.reload()})}),n.initializeConflictDetection()}),(m,f)=>{const _=resolveComponent("router-view");return openBlock(),createElementBlock(Fragment,null,[createVNode(_),r.value?(openBlock(),createBlock(unref(script$5),{key:0,class:"absolute inset-0 flex h-[unset] items-center justify-center"})):createCommentVNode("",!0),createVNode(_sfc_main$1),createVNode(unref(script$J),{"full-screen":"",blocked:r.value},null,8,["blocked"])],64)}}}),ComfyUIPreset=definePreset(index,{semantic:{primary:index.primitive.blue}}),firebaseApp=initializeApp(getFirebaseConfig()),app=createApp(_sfc_main),pinia=createPinia();init({app,dsn:"https://e2d0c0bd392ffdce48e856c2a055f437@o4507954455314432.ingest.us.sentry.io/4508621568475136",enabled:!0,release:"1.33.13",normalizeDepth:8,tracesSampleRate:0,replaysSessionSampleRate:0,replaysOnErrorSampleRate:0,integrations:[],autoSessionTracking:!1,defaultIntegrations:!1});app.directive("tooltip",Tooltip);app.use(router).use(PrimeVue,{theme:{preset:ComfyUIPreset,options:{prefix:"p",cssLayer:{name:"primevue",order:"theme, base, primevue"},darkModeSelector:".dark-theme, :root:has(.dark-theme)"}}}).use(ConfirmationService).use(ToastService).use(pinia).use(i18n).use(VueFire,{firebaseApp,modules:[VueFireAuth()]});app.mount("#vue-app");export{useExternalLink as $,showNativeSystemMenu as A,useWorkflowStore as B,useSidebarTabStore as C,useBottomPanelStore as D,collectAllNodes as E,useNodeDefStore as F,useDialogService as G,useWorkflowService as H,ComfyWorkflow as I,appendJsonExt as J,useSubgraphNavigationStore as K,useSubgraphStore as L,useCanvasStore as M,forEachSubgraphNode as N,useQueueStore as O,useCopyToClipboard as P,useLitegraphService as Q,useMediaAssetActions as R,createAnnotatedPath as S,downloadBlob as T,mapTaskOutputToAssetItem as U,useExecutionStore as V,useAssetsStore as W,useAssetSelectionStore as X,_sfc_main$2h as Y,useExtensionStore as Z,_sfc_main$2B as _,api as a,useSystemStatsStore as a$,useCurrentUser as a0,useFirebaseAuthActions as a1,_sfc_main$Y as a2,isElectron as a3,useCanvasPositionConversion as a4,isDOMWidget as a5,isComponentWidget as a6,useDomWidgetStore as a7,useChainCallback as a8,layoutStore as a9,useTitleEditorStore as aA,RenderShape as aB,alignNodes as aC,distributeNodes as aD,useNodeBookmarkStore as aE,useExtensionService as aF,EditableText as aG,useNodeFrequencyStore as aH,highlightQuery as aI,formatNumberWithSuffix as aJ,NodeSourceType as aK,NodePreview as aL,NodeSearchFilter as aM,SearchFilterChip as aN,LinkReleaseTriggerAction as aO,_sfc_main$2b as aP,_sfc_main$2a as aQ,_sfc_main$2c as aR,_sfc_main$29 as aS,useMenuItemStore as aT,useColorPaletteService as aU,useManagerState as aV,SettingDialogHeader as aW,SettingDialogContent as aX,ManagerTab as aY,getComfyApiBaseUrl as aZ,isAbortError as a_,MinimapDataSourceFactory as aa,renderMinimapToCanvas as ab,useColorPaletteStore as ac,enforceMinimumBounds as ad,calculateMinimapScale as ae,useCanvasInteractions as af,LiteGraph as ag,isOverNodeInput as ah,isOverNodeOutput as ai,LGraphCanvas as aj,adjustColor as ak,isColorable as al,getItemsColorOption as am,showSubgraphNodeDialog as an,useNodeHelpStore as ao,useNodeLibrarySidebarTab as ap,isLGraphNode as aq,isImageNode as ar,SubgraphNode as as,isLoad3dNode as at,LGraphEventMode as au,useSelectedLiteGraphItems as av,useVueFeatureFlags as aw,isLGraphGroup as ax,LGraphNode as ay,LGraphGroup as az,isCloud as b,selectionBounds as b$,stringToLocale as b0,useConflictAcknowledgment as b1,electronAPI as b2,formatVersionAnchor as b3,renderMarkdownToHtml as b4,useConflictDetection as b5,useUserStore as b6,useKeybindingStore as b7,usePragmaticDraggable as b8,usePragmaticDroppable as b9,getStorageValue as bA,setStorageValue as bB,hydratePreservedQuery as bC,mergePreservedQueryIntoQuery as bD,snapPoint as bE,isMiddlePointerInput as bF,syncNodeSlotLayoutsFromDOM as bG,getLocatorIdFromNodeData as bH,applyLightThemeColor as bI,nonWidgetedInputs as bJ,getNodeByLocatorId as bK,_sfc_main$1M as bL,_sfc_main$1J as bM,_sfc_main$1N as bN,_sfc_main$1G as bO,ChangeTracker as bP,UnauthorizedError as bQ,mergeCustomNodesI18n as bR,isNativeWindow as bS,IS_CONTROL_WIDGET as bT,updateControlWidgetLabel as bU,migrateLegacyRerouteNodes as bV,_sfc_main$2d as bW,assetItemSchema as bX,MODELS_TAG as bY,MISSING_TAG as bZ,getAllNonIoNodesInSubgraph as b_,useWorkflowThumbnail as ba,useWorkflowBookmarkStore as bb,LayoutSource as bc,NodeSlotType as bd,useLayoutMutations as be,addNodeTitleHeight as bf,ensureCorrectLayoutScale as bg,removeNodeTitleHeight as bh,LGraphBadge as bi,BadgePosition as bj,NodeBadgeMode as bk,useSharedCanvasPositionConversion as bl,ComfyNodeDefImpl as bm,ComfyModelDef as bn,legacyMenuCompat as bo,te as bp,LGraph as bq,LLink as br,DragAndScale as bs,ContextMenu as bt,isVideoNode as bu,isAudioNode as bv,CanvasPointer as bw,LinkMarkerShape as bx,clearPreservedQuery as by,PRESERVED_QUERY_NAMESPACES as bz,cn as c,formatMetronomeCurrency as c$,useQueueSettingsStore as c0,getExecutionIdsForSelectedNodes as c1,ManagerUIState as c2,tryToggleWidgetPromotion as c3,DEFAULT_DARK_COLOR_PALETTE as c4,DEFAULT_LIGHT_COLOR_PALETTE as c5,config as c6,useQueuePendingTaskCountStore as c7,useAssetsSidebarTab as c8,_imports_0$1 as c9,isFloatInputSpec$1 as cA,isComboInputSpec$1 as cB,getComboSpecComboOptions as cC,GET_CONFIG as cD,ComfyWidgets as cE,applyTextReplacements$1 as cF,CONFIG as cG,addValueControlWidgets as cH,NodeSlot as cI,GROUP as cJ,useWidgetStore as cK,deserialiseAndCreate as cL,serialise as cM,Load3dUtils as cN,ComponentWidgetImpl as cO,addWidget as cP,nodeToLoad3dMap as cQ,useMaskEditorStore as cR,useMaskEditor as cS,createBounds as cT,useNodeFileInput as cU,useNodeDragAndDrop as cV,useNodePaste as cW,isComboInputSpecV1 as cX,formatSize as cY,formatCommitHash as cZ,_sfc_main$R as c_,useFirebaseAuthStore as ca,useModelStore as cb,loadLocale as cc,KeyComboImpl as cd,KeybindingImpl as ce,isComboInputSpec as cf,isColorFormat as cg,toHexFromFormat as ch,_sfc_main$1H as ci,useLoad3dDrag as cj,Load3DViewerContent as ck,useLoad3dService as cl,useLoad3d as cm,ComfyApp as cn,ComfyDialog as co,$el as cp,isComboWidget as cq,processDynamicPrompt as cr,isValidUrl as cs,ExecutableNodeDTO as ct,ComfyDialog$1 as cu,PREFIX as cv,SEPARATOR as cw,DraggableList as cx,getInputSpecType as cy,isIntInputSpec$1 as cz,_export_sfc as d,SearchBox as d0,FormItem as d1,getFilenameDetails as d2,truncateFilename as d3,_sfc_main$2C as e,_sfc_main$2A as f,_sfc_main$2D as g,assetService as h,i18n as i,useDialogStore as j,d as k,useModelToNodeStore as l,useNodeOutputStore as m,normalizeI18nKey as n,downloadFile as o,useCommandStore as p,__unplugin_components_0$2 as q,app$1 as r,st as s,t,useSettingStore as u,useErrorHandling as v,useSubscription as w,useTelemetry as x,useToastStore as y,useWorkspaceStore as z};
//# sourceMappingURL=index-UkVvUXbW.js.map
