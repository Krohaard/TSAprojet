const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ComfyQueueButton-CseMwkKR.js","./vendor-vue-BFtl7jfJ.js","./vendor-other-CcUSxTdr.js","./vendor-other-C4ppb7nW.css","./vendor-primevue-D4_dEx5Z.js","./index-UkVvUXbW.js","./vendor-xterm-DV1MVhAx.js","./vendor-xterm-LZoznX6r.css","./vendor-three-zdhtZbSm.js","./vendor-tiptap-BLQhG9Oo.js","./index-Cfl3R9AH.css","./UserAvatar.vue_vue_type_script_setup_true_lang-BRVc2hhq.js","./nodeFilterUtil-D49mCu4H.js","./mathUtil-DlGw4Aca.js","./LazyImage.vue_vue_type_script_setup_true_lang-BVGan4gh.js","./keybindingService-C6DMpW4T.js","./serverConfigStore-4mCelzF0.js","./WidgetInputNumber.vue_vue_type_script_setup_true_lang-BsOu6KNe.js","./widgetPropFilter-CygYoMQt.js","./index-Bq9c0rSj.js","./WidgetLayoutField.vue_vue_type_script_setup_true_lang-CyeRWKQg.js","./WidgetInputNumber-Df2tetAs.css","./ComfyQueueButton-wNPBWF2W.css"])))=>i.map(i=>d[i]);
var il=Object.defineProperty;var n=(e,o)=>il(e,"name",{value:o,configurable:!0});import{bp as yt,r as R,H as b,cT as Os,bs as K,d6 as rl,i as ul,dS as Bs,w as te,c as m,d as T,l as ue,x as Qe,A as L,q as E,e as y,u as J,bq as v,f as Pe,s as A,T as Rn,p as O,t as z,F as le,z as we,h as qe,b as Dn,a as Oo,cU as An,cV as Bo,e4 as cl,e5 as zs,D as Ln,E as Ne,G as pe,m as kt,L as Ke,e6 as ss,dU as bn,e7 as dl,k as _e,J as qt,v as Kt,cR as Et,ck as En,o as De,bb as st,bu as Vn,dj as Fs,d3 as Ct,n as Le,dm as be,d9 as pl,cA as zo,e8 as fl,dt as so,cQ as Re,cp as Ut,c_ as qo,e9 as ml,dd as Us,ea as Gs,j as Hs,eb as vl,bP as rt,y as Rt,cm as js,cS as Ko,ec as qs,ed as go,ee as gl,ba as as,ef as hl,db as yl,b9 as Ks,ci as Qs,cl as ao,d0 as Js,di as bl,bh as Ys,dT as Zs,d2 as wl,br as kl,eg as Cl,eh as Sl,cz as xl,dk as Xs,cY as $l,bg as _l,g as ls,ei as Tl,e1 as Nl,dL as Ml}from"./vendor-other-CcUSxTdr.js";import{d as Vt,u as ce,s as at,j as ea,k as ta}from"./vendor-vue-BFtl7jfJ.js";import{s as re,b as Il,g as Pl,c as oa,d as na,u as Wt,k as et,a1 as Fo,a2 as wn,a3 as Tt,_ as sa,P as aa,x as Ht,a4 as la,a5 as Rl,z as is,S as Dl,R as Al,O as Ll,I as El,a6 as Vl,w as ia,m as Wl,U as ko,n as Ol,A as ra,e as Bl,M as zl,a7 as Fl,a8 as Ul,l as Gl,r as Hl,i as no}from"./vendor-primevue-D4_dEx5Z.js";import{s as ye,n as Oe,a as he,i as ua,b as jt,c as de,_ as Ee,d as Se,e as Qo,f as bt,t as Z,u as ne,g as Fe,h as Uo,j as St,k as jl,l as Wn,m as Ot,o as Jo,p as ke,q as ca,r as j,v as ho,w as On,x as ql,y as wt,z as lt,A as Kl,B as Me,C as Qt,D as Yt,E as Ql,F as ut,G as it,H as tt,I as da,J as pa,K as Bn,L as fa,M as fe,N as Jl,O as xt,P as ma,Q as yo,R as Yl,S as Zl,T as Xl,U as ei,V as Je,W as va,X as ti,Y as oi,Z as zn,$ as Zt,a0 as Xt,a1 as ga,a2 as ni,a3 as ze,a4 as si,a5 as lo,a6 as ai,a7 as li,a8 as po,a9 as Ce,aa as ha,ab as ii,ac as ft,ad as ri,ae as ui,af as Bt,ag as ve,ah as ci,ai as di,aj as Xe,ak as io,al as Po,am as pi,an as ya,ao as fi,ap as mi,aq as Mt,ar as ba,as as Dt,at as vi,au as Ae,av as Yo,aw as Go,ax as wa,ay as pt,az as At,aA as Zo,aB as Co,aC as gi,aD as hi,aE as ka,aF as yi,aG as bi,aH as Fn,aI as rs,aJ as wi,aK as ki,aL as Ci,aM as Si,aN as xi,aO as ht,aP as Ro,aQ as Do,aR as Ao,aS as Lo,aT as Ca,aU as Sa,aV as _t,aW as $i,aX as _i,aY as ro,aZ as xa,a_ as Ti,a$ as $a,b0 as Ni,b1 as _a,b2 as uo,b3 as Un,b4 as Mi,b5 as Ii,b6 as Ta,b7 as Pi,b8 as Ri,b9 as Na,ba as Di,bb as Ai,bc as Jt,bd as Li,be as bo,bf as Ei,bg as us,bh as Vi,bi as Gn,bj as Wi,bk as ct,bl as Ma,bm as Oi,bn as Bi,bo as nn,bp as zi,bq as Fi,br as Ui,bs as Gi,bt as Hi,bu as ji,bv as qi,bw as sn,bx as So,by as Ki,bz as Ia,bA as an,bB as ln,bC as Qi,bD as Ji,bE as cs,bF as Yi,bG as Zi,bH as rn,bI as Xi,bJ as er,bK as ds,bL as ps,bM as fs,bN as tr,bO as Pa,bP as or,bQ as nr,bR as sr,bS as ar,bT as lr,bU as ms,bV as ir,bW as rr,bX as ur,bY as vs,bZ as gs,b_ as cr,b$ as dr,c0 as co,c1 as pr,c2 as fr,c3 as mr,c4 as vr,c5 as gr,c6 as hr,c7 as Ra,c8 as yr,c9 as br,ca as wr,cb as kr,cc as Cr}from"./index-UkVvUXbW.js";import"./vendor-xterm-DV1MVhAx.js";import{_ as Da}from"./UserAvatar.vue_vue_type_script_setup_true_lang-BRVc2hhq.js";import{f as Hn,i as Sr}from"./nodeFilterUtil-D49mCu4H.js";import{c as xr}from"./mathUtil-DlGw4Aca.js";import{_ as $r,a as fo,u as _r}from"./LazyImage.vue_vue_type_script_setup_true_lang-BVGan4gh.js";import{u as un}from"./keybindingService-C6DMpW4T.js";import{u as Tr}from"./serverConfigStore-4mCelzF0.js";import{_ as Nr}from"./WidgetInputNumber.vue_vue_type_script_setup_true_lang-BsOu6KNe.js";const cn=n(e=>({all:"icon-[lucide--list]","getting-started":"icon-[lucide--graduation-cap]","generation-image":"icon-[lucide--image]",image:"icon-[lucide--image]","generation-video":"icon-[lucide--film]",video:"icon-[lucide--film]","generation-3d":"icon-[lucide--box]","3d":"icon-[lucide--box]","generation-audio":"icon-[lucide--volume-2]",audio:"icon-[lucide--volume-2]","generation-llm":"icon-[lucide--message-square-text]","api-nodes":"icon-[lucide--hand-coins]","closed-models":"icon-[lucide--hand-coins]",llm:"icon-[lucide--message-square-text]",llms:"icon-[lucide--message-square-text]","llm-api":"icon-[lucide--message-square-text]","small-models":"icon-[lucide--zap]",performance:"icon-[lucide--zap]","mac-compatible":"icon-[lucide--command]","runs-on-mac":"icon-[lucide--command]","lora-training":"icon-[lucide--dumbbell]",training:"icon-[lucide--dumbbell]",extensions:"icon-[lucide--puzzle]",tools:"icon-[lucide--wrench]",upscaling:"icon-[lucide--maximize-2]",controlnet:"icon-[lucide--sliders-horizontal]","area-composition":"icon-[lucide--layout-grid]"})[e.toLowerCase()]||"icon-[lucide--folder]","getCategoryIcon"),Aa=Vt("workflowTemplates",()=>{const e=yt({}),o=yt([]),t=yt([]),a=R(!1),l=R(new Set),s=n($=>d.value.find(k=>k.name===$),"getTemplateByName"),i=R(new Map),r=n(($,k)=>({...$,localizedTitle:ye(`templateWorkflows.template.${Oe(k)}.${Oe($.name)}`,$.title??$.name),localizedDescription:ye(`templateWorkflows.templateDescription.${Oe(k)}.${Oe($.name)}`,$.description)}),"addLocalizedFieldsToTemplate"),u=n(($,k)=>$.map(x=>r(x,k)),"localizeTemplateList"),c=n($=>({...$,localizedTitle:ye(`templateWorkflows.category.${Oe($.title)}`,$.title??$.moduleName),templates:u($.templates,$.title)}),"localizeTemplateCategory"),p=n(()=>{const $=o.value.flatMap(x=>x.templates.map(_=>({...r(_,x.title),sourceModule:x.moduleName}))),k=Object.entries(e.value).flatMap(([x,_])=>_.map(M=>({name:M,mediaType:"image",mediaSubtype:"jpg",description:M,sourceModule:x})));return{moduleName:"all",title:"All",localizedTitle:ye("templateWorkflows.category.All","All Templates"),templates:[...$,...k]}},"createAllCategory"),g=b(()=>{const $=[...o.value.map(c),...Object.entries(e.value).map(([x,_])=>({moduleName:x,title:x,localizedTitle:ye(`templateWorkflows.category.${Oe(x)}`,x),templates:_.map(M=>({name:M,mediaType:"image",mediaSubtype:"jpg",description:M}))}))];return[{label:ye("templateWorkflows.category.ComfyUI Examples","ComfyUI Examples"),modules:[p(),...$.filter(x=>x.moduleName==="default")]},...Object.keys(e.value).length>0?[{label:ye("templateWorkflows.category.Custom Nodes","Custom Nodes"),modules:$.filter(x=>x.moduleName!=="default")}]:[]]}),d=b(()=>{const $=[];return o.value.forEach(x=>{x.templates.forEach(_=>{const M={..._,sourceModule:x.moduleName,category:x.title,categoryType:x.type,categoryGroup:x.category,isEssential:x.isEssential,isPartnerNode:_.openSource===!1,searchableText:[_.title||_.name,_.description||"",x.title,..._.tags||[],..._.models||[]].join(" ")};$.push(M)})}),Object.entries(e.value).forEach(([x,_])=>{_.forEach(M=>{const N={name:M,title:M,description:M,mediaType:"image",mediaSubtype:"jpg",sourceModule:x,category:"Extensions",categoryType:"extension",searchableText:`${M} ${x} extension`};$.push(N)})}),$.filter(x=>!x.requiresCustomNodes?.length)}),w=b(()=>{const $={keys:[{name:"searchableText",weight:.4},{name:"title",weight:.3},{name:"name",weight:.2},{name:"tags",weight:.1}],threshold:.3,includeScore:!0};return new Os(d.value,$)}),h=n($=>{if($==="all")return d.value;if($==="basics")return d.value.filter(x=>x.isEssential);if($==="partner-nodes")return d.value.filter(x=>x.isPartnerNode);if($.startsWith("extension-")){const x=$.replace("extension-","");return d.value.filter(_=>_.sourceModule===x)}const k=i.value.get($);return k?d.value.filter(x=>!(k.category&&x.category!==k.category||k.categoryGroup&&x.categoryGroup!==k.categoryGroup)):d.value},"filterTemplatesByCategory"),C=b(()=>{if(!a.value)return[];const $=[];i.value.clear(),$.push({id:"all",label:ye("templateWorkflows.category.All","All Templates"),icon:cn("all")});let k="Getting Started";const x=o.value.find(V=>V.isEssential&&V.templates.length>0),_=!!x;x&&(k=x.title),_&&$.push({id:"basics",label:k,icon:"icon-[lucide--graduation-cap]"});const M=new Map;if(o.value.forEach(V=>{if(V.isEssential)return;const P=V.category,G=V.icon;if(P){M.has(P)||M.set(P,{title:P,items:[]});const D=M.get(P),B=`${P.toLowerCase().replace(/\s+/g,"-")}-${V.title.toLowerCase().replace(/\s+/g,"-")}`;i.value.set(B,{category:V.title,categoryGroup:P}),D.items.push({id:B,label:ye(`templateWorkflows.category.${Oe(V.title)}`,V.title),icon:G||cn(V.type||"default")})}}),M.forEach((V,P)=>{V.items.length>0&&$.push({title:ye(`templateWorkflows.category.${Oe(P)}`,P.split(" ").map(G=>G.charAt(0).toUpperCase()+G.slice(1).toLowerCase()).join(" ")),items:V.items})}),d.value.filter(V=>V.isPartnerNode).length>0&&$.push({id:"partner-nodes",label:ye("templateWorkflows.category.Partner Nodes","Partner Nodes"),icon:"icon-[lucide--handshake]"}),d.value.filter(V=>V.sourceModule!=="default").length>0){const P=Array.from(new Set(d.value.filter(G=>G.sourceModule!=="default").map(G=>G.sourceModule))).sort().map(G=>({id:`extension-${G}`,label:ye(`templateWorkflows.category.${Oe(G)}`,G),icon:cn("extensions")}));$.push({title:ye("templateWorkflows.category.Extensions","Extensions"),items:P,collapsible:!0})}return $});async function f(){try{if(!a.value){e.value=await he.getWorkflowTemplates();const $=ua.global.locale.value,[k,x]=await Promise.all([he.getCoreWorkflowTemplates($),jt&&$!=="en"?he.getCoreWorkflowTemplates("en"):Promise.resolve([])]);o.value=k,t.value=x;const _=o.value.flatMap(N=>N.templates.map(I=>I.name)),M=Object.values(e.value).flat();l.value=new Set([..._,...M]),a.value=!0}}catch($){console.error("Error fetching workflow templates:",$)}}n(f,"loadWorkflowTemplates");function S($){if(t.value.length===0)return null;for(const k of t.value){const x=k.templates.find(_=>_.name===$);if(x)return{tags:x.tags,category:k.title,useCase:x.useCase,models:x.models,license:x.license}}return null}return n(S,"getEnglishMetadata"),{groupedTemplates:g,navGroupedTemplates:C,enhancedTemplates:d,templateFuse:w,filterTemplatesByCategory:h,isLoaded:a,loadWorkflowTemplates:f,knownTemplateNames:l,getTemplateByName:s,getEnglishMetadata:S}}),Xo=Symbol(),Mr={class:"flex h-full w-full"},Ir={class:"flex h-full w-full flex-col"},Pr={class:"flex flex-1 shrink-0 gap-2"},Rr={key:0,class:"icon-[lucide--panel-left] text-sm"},Dr={key:1,class:"icon-[lucide--panel-left-close] text-sm"},Ar={class:"flex min-h-0 flex-1 flex-col"},Lr={key:0,class:"text-xxl m-0 px-6 pt-2 pb-6 capitalize"},Er=K({__name:"BaseModalLayout",props:{contentTitle:{}},setup(e){const o={md:880},t={width:"w-1/3",minWidth:"min-w-40",maxWidth:"max-w-56"},a=rl(),l=ul(Xo,()=>{}),i=Bs(o).greater("md"),r=R(!0),u=R(!1),c=R(!1),p=b(()=>!!a.rightPanel);te(i,M=>{M||(c.value=!1)});const g=b(()=>i.value?r.value:c.value),d=n(()=>{i.value?r.value=!r.value:c.value=!c.value},"toggleLeftPanel"),w=n(()=>{u.value=!u.value},"toggleRightPanel"),h=de("base-widget-layout","rounded-2xl overflow-hidden relative"),C=b(()=>de("absolute top-4 right-18 z-10","transition-opacity duration-200",{"opacity-0 pointer-events-none":u.value||!p.value})),f=de("absolute top-4 right-6 z-10","transition-opacity duration-200"),S=de("flex-1 flex bg-base-background"),$=de("w-full h-18 px-6","flex items-center justify-between gap-2"),k=b(()=>de("flex justify-end gap-2 w-0",p.value&&!u.value?"min-w-22":"min-w-10")),x=b(()=>de("min-h-0 px-6 pt-0 pb-10","overflow-y-auto scrollbar-hide")),_=b(()=>de("w-1/4 min-w-40 max-w-80"));return(M,N)=>(m(),T("div",{class:J(v(h))},[ue(L(Ee,{class:J(C.value),onClick:w},{default:E(()=>N[0]||(N[0]=[y("i",{class:"icon-[lucide--panel-right] text-sm"},null,-1)])),_:1},8,["class"]),[[Qe,!u.value&&p.value]]),L(Ee,{class:J(v(f)),onClick:v(l)},{default:E(()=>N[1]||(N[1]=[y("i",{class:"pi pi-times text-sm"},null,-1)])),_:1},8,["class","onClick"]),y("div",Mr,[L(Rn,{name:"slide-panel"},{default:E(()=>[M.$slots.leftPanel&&g.value?(m(),T("nav",{key:0,class:J([t.width,t.minWidth,t.maxWidth])},[Pe(M.$slots,"leftPanel",{},void 0,!0)],2)):A("",!0)]),_:3}),y("div",{class:J(v(S))},[y("div",Ir,[M.$slots.header?(m(),T("header",{key:0,class:J(v($))},[y("div",Pr,[v(i)?A("",!0):(m(),O(Ee,{key:0,onClick:d},{default:E(()=>[g.value?(m(),T("i",Dr)):(m(),T("i",Rr))]),_:1})),Pe(M.$slots,"header",{},void 0,!0)]),Pe(M.$slots,"header-right-area",{},void 0,!0),y("div",{class:J(k.value)},[u.value&&p.value?(m(),O(Ee,{key:0,onClick:w},{default:E(()=>N[2]||(N[2]=[y("i",{class:"icon-[lucide--panel-right-close] text-sm"},null,-1)])),_:1})):A("",!0)],2)],2)):A("",!0),y("main",Ar,[Pe(M.$slots,"contentFilter",{},void 0,!0),M.$slots.leftPanel?A("",!0):(m(),T("h2",Lr,z(M.contentTitle),1)),y("div",{class:J(x.value)},[Pe(M.$slots,"content",{},void 0,!0)],2)])]),p.value&&u.value?(m(),T("aside",{key:0,class:J(_.value)},[Pe(M.$slots,"rightPanel",{},void 0,!0)],2)):A("",!0)],2)])],2))}}),jn=Se(Er,[["__scopeId","data-v-4ebc4d9c"]]),Vr=K({__name:"NavIcon",props:{icon:{}},setup(e){return(o,t)=>(m(),T("i",{class:J([o.icon,"text-neutral text-sm"])},null,2))}}),Wr={key:1,class:"text-neutral icon-[lucide--folder] text-xs"},Or={class:"flex items-center"},hs=K({__name:"NavItem",props:{icon:{},active:{type:Boolean},onClick:{type:Function}},setup(e){return(o,t)=>(m(),T("div",{class:J(["flex cursor-pointer items-center gap-2 rounded-md px-4 py-3 text-sm transition-colors text-base-foreground",o.active?"bg-interface-menu-component-surface-selected":"hover:bg-interface-menu-component-surface-hovered"]),role:"button",onClick:t[0]||(t[0]=(...a)=>o.onClick&&o.onClick(...a))},[o.icon?(m(),O(Vr,{key:0,icon:o.icon},null,8,["icon"])):(m(),T("i",Wr)),y("span",Or,[Pe(o.$slots,"default")])],2))}}),Br={class:"text-xs font-bold text-text-secondary uppercase"},zr=K({__name:"NavTitle",props:{title:{},modelValue:{type:Boolean,default:!1},collapsible:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:o}){const t=o,a=b({get:n(()=>e.modelValue,"get"),set:n(s=>t("update:modelValue",s),"set")}),l=n(()=>{a.value=!a.value},"toggleCollapse");return(s,i)=>(m(),T("div",{class:J(v(de)("flex items-center justify-between m-0 px-3 py-0 pt-5",s.collapsible&&"cursor-pointer select-none")),onClick:i[0]||(i[0]=r=>s.collapsible&&l())},[y("h3",Br,z(s.title),1),s.collapsible?(m(),T("i",{key:0,class:J(v(de)("pi transition-transform duration-200 text-xs text-text-secondary ",a.value?"pi-chevron-right":"pi-chevron-down"))},null,2)):A("",!0)],2))}}),Fr={},Ur={class:"flex h-16 items-center justify-between px-6"},Gr={class:"flex items-center gap-2 pl-1"},Hr={class:"text-neutral text-base font-bold"};function jr(e,o){return m(),T("header",Ur,[y("div",Gr,[Pe(e.$slots,"icon",{},()=>[o[0]||(o[0]=y("i",{class:"text-neutral icon-[lucide--puzzle] text-base"},null,-1))]),y("h2",Hr,[Pe(e.$slots,"default")])])])}n(jr,"_sfc_render$3");const qr=Se(Fr,[["render",jr]]),Kr={class:"flex h-full w-full flex-col bg-modal-panel-background"},Qr={class:"flex scrollbar-hide flex-1 flex-col gap-1 overflow-y-auto px-3 py-4"},Jr={key:0,class:"flex flex-col gap-2"},Yr={key:1,class:"flex flex-col gap-2"},qn=K({__name:"LeftSidePanel",props:{navItems:{default:n(()=>[],"default")},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:o}){const t=o,a=R({}),l=n(()=>{if(!e.navItems||e.navItems.length===0)return null;const i=e.navItems[0];return"items"in i&&i.items.length>0?i.items[0].id:"id"in i?i.id:null},"getFirstItemId"),s=b({get:n(()=>e.modelValue??l(),"get"),set:n(i=>t("update:modelValue",i),"set")});return(i,r)=>(m(),T("div",Kr,[L(qr,null,{icon:E(()=>[Pe(i.$slots,"header-icon")]),default:E(()=>[Pe(i.$slots,"header-title")]),_:3}),y("nav",Qr,[(m(!0),T(le,null,we(i.navItems,(u,c)=>(m(),T(le,{key:c},["items"in u?(m(),T("div",Jr,[L(zr,{modelValue:a.value[u.title],"onUpdate:modelValue":n(p=>a.value[u.title]=p,"onUpdate:modelValue"),title:u.title,collapsible:u.collapsible},null,8,["modelValue","onUpdate:modelValue","title","collapsible"]),!u.collapsible||!a.value[u.title]?(m(!0),T(le,{key:0},we(u.items,p=>(m(),O(hs,{key:p.id,icon:p.icon,active:s.value===p.id,onClick:n(g=>s.value=p.id,"onClick")},{default:E(()=>[qe(z(p.label),1)]),_:2},1032,["icon","active","onClick"]))),128)):A("",!0)])):(m(),T("div",Yr,[L(hs,{icon:u.icon,active:s.value===u.id,onClick:n(p=>s.value=u.id,"onClick")},{default:E(()=>[qe(z(u.label),1)]),_:2},1032,["icon","active","onClick"])]))],64))),128))])]))}});function Zr(){const e=Dn({get supportsPreviewMetadata(){return he.getServerFeature("supports_preview_metadata")},get maxUploadSize(){return he.getServerFeature("max_upload_size")},get supportsManagerV4(){return he.getServerFeature("extension.manager.supports_v4")},get modelUploadButtonEnabled(){return he.getServerFeature("model_upload_button_enabled",!1)}}),o=n((t,a)=>b(()=>he.getServerFeature(t,a)),"featureFlag");return{flags:Oo(e),featureFlag:o}}n(Zr,"useFeatureFlags");function Xr(e){return b(()=>{const{minWidth:o,maxWidth:t}=e,a={};return o&&(a.minWidth=o),t&&(a.maxWidth=t),a})}n(Xr,"usePopoverSizing");const eu={class:"flex flex-col px-2 pt-2 pb-0"},tu={key:1,class:"mt-2 flex items-center justify-between"},ou={key:0,class:"px-1 text-sm text-base-foreground"},nu={class:"text-sm"},su={key:0,class:"pointer-events-none absolute -top-2 -right-2 z-10 flex h-5 w-5 items-center justify-center rounded-full bg-primary-background text-xs font-semibold text-base-foreground"},au={key:0,class:"text-bold icon-[lucide--check] text-xs text-white"},Lt=K({inheritAttrs:!1,__name:"MultiSelect",props:An({label:{},showSearchBox:{type:Boolean,default:!1},showSelectedCount:{type:Boolean,default:!1},showClearButton:{type:Boolean,default:!1},searchPlaceholder:{default:"Search..."},listMaxHeight:{default:"28rem"},popoverMinWidth:{},popoverMaxWidth:{}},{modelValue:{required:!0},modelModifiers:{},searchQuery:{default:""},searchQueryModifiers:{}}),emits:["update:modelValue","update:searchQuery"],setup(e){const o=Bo(e,"modelValue"),t=Bo(e,"searchQuery"),{t:a}=ce(),l=b(()=>o.value.length),s=Xr({minWidth:e.popoverMinWidth,maxWidth:e.popoverMaxWidth}),i=cl(),r=b(()=>i.options||[]),u={fuseOptions:{keys:["name","value"],threshold:.3,includeScore:!1},matchAllWhenSearchEmpty:!0},{results:c}=zs(t,r,u),p=b(()=>{if(!t.value||t.value.trim()==="")return r.value;const g=c.value.map(w=>w.item);return[...o.value.filter(w=>!g.some(h=>h.value===w.value)),...g]});return(g,d)=>(m(),O(v(Il),kt({modelValue:o.value,"onUpdate:modelValue":d[2]||(d[2]=w=>o.value=w)},{...g.$attrs,options:p.value},{"option-label":"name",unstyled:"","max-selected-labels":0,pt:{root:n(({props:w})=>({class:v(de)("h-10 relative inline-flex cursor-pointer select-none","rounded-lg bg-secondary-background text-base-foreground","transition-all duration-200 ease-in-out","border-[2.5px] border-solid",l.value>0?"border-node-component-border":"border-transparent","focus-within:border-node-component-border",{"opacity-60 cursor-default":w.disabled})}),"root"),labelContainer:{class:"flex-1 flex items-center overflow-hidden whitespace-nowrap pl-4 py-2 "},label:{class:"p-0"},dropdown:{class:"flex shrink-0 cursor-pointer items-center justify-center px-3"},header:n(()=>({class:g.showSearchBox||g.showSelectedCount||g.showClearButton?"block":"hidden"}),"header"),overlay:{class:v(de)("mt-2 rounded-lg py-2 px-2","bg-base-background","text-base-foreground","border border-solid border-border-default")},listContainer:n(()=>({style:{maxHeight:`min(${g.listMaxHeight}, 50vh)`},class:"scrollbar-custom"}),"listContainer"),list:{class:"flex flex-col gap-0 p-0 m-0 list-none border-none text-sm"},option:n(({context:w})=>({class:v(de)("flex gap-2 items-center h-10 px-2 rounded-lg","hover:bg-secondary-background-hover",w?.focused&&"bg-secondary-background-selected hover:bg-secondary-background-selected")}),"option"),pcHeaderCheckbox:{root:{class:"hidden"},style:{display:"none"}},pcOptionCheckbox:{root:{class:"hidden"},style:{display:"none"}}},"aria-label":g.label||v(a)("g.multiSelectDropdown"),role:"combobox","aria-expanded":!1,"aria-haspopup":"listbox",tabindex:0}),Ln({value:E(()=>[y("span",nu,z(g.label),1),l.value>0?(m(),T("span",su,z(l.value),1)):A("",!0)]),dropdownicon:E(()=>[d[4]||(d[4]=y("i",{class:"icon-[lucide--chevron-down] text-muted-foreground"},null,-1))]),option:E(w=>[y("div",{class:"flex items-center gap-2",style:pe(v(s))},[y("div",{class:J(["flex h-4 w-4 shrink-0 items-center justify-center rounded p-0.5 transition-all duration-200",w.selected?"bg-primary-background":"bg-secondary-background"])},[w.selected?(m(),T("i",au)):A("",!0)],2),L(v(re),{class:"border-none bg-transparent text-left outline-none",unstyled:""},{default:E(()=>[qe(z(w.option.name),1)]),_:2},1024)],4)]),_:2},[g.showSearchBox||g.showSelectedCount||g.showClearButton?{name:"header",fn:E(()=>[y("div",eu,[g.showSearchBox?(m(),O(Qo,{key:0,modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=w=>t.value=w),class:J(g.showSelectedCount||g.showClearButton?"mb-2":""),"show-order":!0,"show-border":!0,"place-holder":g.searchPlaceholder},null,8,["modelValue","class","place-holder"])):A("",!0),g.showSelectedCount||g.showClearButton?(m(),T("div",tu,[g.showSelectedCount?(m(),T("span",ou,z(l.value>0?g.$t("g.itemsSelected",{selectedCount:l.value}):g.$t("g.itemSelected",{selectedCount:l.value})),1)):A("",!0),g.showClearButton?(m(),O(bt,{key:1,label:g.$t("g.clearAll"),type:"transparent",size:"fit-content",class:"text-sm text-text-primary",onClick:d[1]||(d[1]=Ne(w=>o.value=[],["stop"]))},null,8,["label"])):A("",!0)])):A("",!0),d[3]||(d[3]=y("div",{class:"my-4 h-px bg-border-default"},null,-1))])]),key:"0"}:void 0]),1040,["modelValue","pt","aria-label"]))}}),lu={class:"flex items-center gap-2 text-sm"},iu={key:0,class:"text-base-foreground"},ru={key:1,class:"text-base-foreground"},uu={class:"truncate"},cu={key:0,class:"icon-[lucide--check] text-base-foreground"},en=K({inheritAttrs:!1,__name:"SingleSelect",props:An({label:{},options:{},listMaxHeight:{default:"28rem"},popoverMinWidth:{},popoverMaxWidth:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const o=Bo(e,"modelValue"),{t}=ce(),a=n(s=>{if(s==null||!e.options)return e.label??"";const i=e.options.find(r=>r.value===s);return i?i.name:e.label??""},"getLabel"),l=b(()=>{if(!e.popoverMinWidth&&!e.popoverMaxWidth)return;const s=[];return e.popoverMinWidth&&s.push(`min-width: ${e.popoverMinWidth}`),e.popoverMaxWidth&&s.push(`max-width: ${e.popoverMaxWidth}`),s.join("; ")});return(s,i)=>(m(),O(v(Pl),kt({modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=r=>o.value=r)},s.$attrs,{options:s.options,"option-label":"name","option-value":"value",unstyled:"",pt:{root:n(({props:r})=>({class:["h-10 relative inline-flex cursor-pointer select-none items-center","rounded-lg","bg-secondary-background text-base-foreground","border-[2.5px] border-solid border-transparent","transition-all duration-200 ease-in-out","focus-within:border-node-component-border",{"opacity-60 cursor-default":r.disabled}]}),"root"),label:{class:"flex-1 flex items-center whitespace-nowrap pl-4 py-2 outline-hidden"},dropdown:{class:"flex shrink-0 items-center justify-center px-3 py-2"},overlay:{class:v(de)("mt-2 p-2 rounded-lg","bg-base-background text-base-foreground","border border-solid border-border-default")},listContainer:n(()=>({style:`max-height: min(${s.listMaxHeight}, 50vh)`,class:"scrollbar-custom"}),"listContainer"),list:{class:"flex flex-col gap-0 p-0 m-0 list-none border-none text-sm"},option:n(({context:r})=>({class:v(de)("flex items-center justify-between gap-3 px-2 py-3 rounded","hover:bg-secondary-background-hover",r.focused&&"bg-secondary-background-hover",r.selected&&"bg-secondary-background-selected hover:bg-secondary-background-selected")}),"option"),optionLabel:{class:"truncate"},optionGroupLabel:{class:"px-3 py-2 text-xs uppercase tracking-wide text-muted-foreground"},emptyMessage:{class:"px-3 py-2 text-sm text-muted-foreground"}},"aria-label":s.label||v(t)("g.singleSelectDropdown"),role:"combobox","aria-expanded":!1,"aria-haspopup":"listbox",tabindex:0}),{value:E(r=>[y("div",lu,[Pe(s.$slots,"icon"),r.value!==null&&r.value!==void 0?(m(),T("span",iu,z(a(r.value)),1)):(m(),T("span",ru,z(s.label),1))])]),dropdownicon:E(()=>i[1]||(i[1]=[y("i",{class:"icon-[lucide--chevron-down] text-muted-foreground"},null,-1)])),option:E(({option:r,selected:u})=>[y("div",{class:"flex w-full items-center justify-between gap-3",style:pe(l.value)},[y("span",uu,z(r.name),1),u?(m(),T("i",cu)):A("",!0)],4)]),_:3},16,["modelValue","options","pt","aria-label"]))}});function du(e){const o=b(()=>{const l=Ke(e).map(i=>{const r=i.name.split(".").pop();return r&&r!==i.name?r:null}).filter(i=>i!==null);return ss(l,(i,r)=>i===r).sort().map(i=>({name:`.${i}`,value:i}))}),t=b(()=>{const l=Ke(e).map(i=>i.user_metadata?.base_model).filter(i=>i!==void 0&&typeof i=="string");return ss(l,(i,r)=>i===r).sort().map(i=>({name:i,value:i}))});return{availableFileFormats:o,availableBaseModels:t}}n(du,"useAssetFilterOptions");const pu=K({__name:"AssetFilterBar",props:{assets:{default:n(()=>[],"default")}},emits:["filterChange"],setup(e,{emit:o}){const t=R([]),a=R([]),l=R("name-asc"),{availableFileFormats:s,availableBaseModels:i}=du(e.assets),r=[{name:Z("assetBrowser.sortAZ"),value:"name-asc"},{name:Z("assetBrowser.sortZA"),value:"name-desc"},{name:Z("assetBrowser.sortRecent"),value:"recent"}],u=o,c=de("flex gap-4 items-center justify-between","px-6 pt-2 pb-6"),p=de("flex gap-4 items-center"),g=de("flex items-center"),d=de("min-w-32");function w(){u("filterChange",{fileFormats:t.value.map(h=>h.value),baseModels:a.value.map(h=>h.value),sortBy:l.value})}return n(w,"handleFilterChange"),(h,C)=>(m(),T("div",{class:J(v(c)),"data-component-id":"asset-filter-bar"},[y("div",{class:J(v(p)),"data-component-id":"asset-filter-bar-left"},[v(s).length>0?(m(),O(Lt,{key:0,modelValue:t.value,"onUpdate:modelValue":[C[0]||(C[0]=f=>t.value=f),w],label:h.$t("assetBrowser.fileFormats"),options:v(s),class:J(v(d)),"data-component-id":"asset-filter-file-formats"},null,8,["modelValue","label","options","class"])):A("",!0),v(i).length>0?(m(),O(Lt,{key:1,modelValue:a.value,"onUpdate:modelValue":[C[1]||(C[1]=f=>a.value=f),w],label:h.$t("assetBrowser.baseModels"),options:v(i),class:J(v(d)),"data-component-id":"asset-filter-base-models"},null,8,["modelValue","label","options","class"])):A("",!0)],2),y("div",{class:J(v(g)),"data-component-id":"asset-filter-bar-right"},[L(en,{modelValue:l.value,"onUpdate:modelValue":[C[2]||(C[2]=f=>l.value=f),w],label:h.$t("assetBrowser.sortBy"),options:r,class:J(v(d)),"data-component-id":"asset-filter-sort"},{icon:E(()=>C[3]||(C[3]=[y("i",{class:"icon-[lucide--arrow-up-down] size-3"},null,-1)])),_:1},8,["modelValue","label","class"])],2)],2))}}),fu={class:"absolute right-2 bottom-2 flex flex-wrap justify-end gap-1"},mu=K({__name:"AssetBadgeGroup",props:{badges:{}},setup(e){return(o,t)=>(m(),T("div",fu,[(m(!0),T(le,null,we(o.badges,a=>(m(),T("span",{key:a.label,class:J(v(de)("px-2 py-1 rounded text-xs font-bold uppercase tracking-wider text-modal-card-tag-foreground bg-modal-card-tag-background"))},z(a.label),3))),128))]))}}),vu={class:"relative aspect-square w-full overflow-hidden rounded-xl"},gu=["src"],hu={key:1,class:"flex h-full w-full items-center justify-center bg-gradient-to-br from-smoke-400 via-smoke-800 to-charcoal-400"},yu=["id"],bu=["id"],wu={key:0,class:"flex items-center gap-1"},ku={key:1,class:"flex items-center gap-1"},Cu={key:2,class:"flex items-center gap-1"},Su=K({__name:"AssetCard",props:{asset:{},interactive:{type:Boolean}},emits:["select"],setup(e){const o=e,t=ne(),a=bn(),l=bn(),s=b(()=>t.get("LiteGraph.Node.TooltipDelay")),{error:i}=dl({src:o.asset.preview_url??"",alt:o.asset.name}),r=b(()=>o.asset.preview_url&&!i.value),u=b(()=>{const p=de("rounded-xl overflow-hidden transition-all duration-200 bg-modal-card-background");return o.interactive?de(p,"group","appearance-none bg-transparent p-0 m-0","font-inherit text-inherit outline-none cursor-pointer text-left","hover:bg-secondary-background","border-none","focus:outline-solid outline-azure-600 outline-4"):p}),c=b(()=>o.interactive?{type:"button","aria-labelledby":a,"aria-describedby":l}:{"aria-labelledby":a,"aria-describedby":l});return(p,g)=>{const d=_e("tooltip");return m(),O(Kt(p.interactive?"button":"div"),kt({"data-component-id":"AssetCard","data-asset-id":p.asset.id},c.value,{class:u.value,onClick:g[0]||(g[0]=w=>p.interactive&&p.$emit("select",p.asset)),onKeydown:g[1]||(g[1]=qt(w=>p.interactive&&p.$emit("select",p.asset),["enter"]))}),{default:E(()=>[y("div",vu,[r.value?(m(),T("img",{key:0,src:p.asset.preview_url,class:"h-full w-full object-contain"},null,8,gu)):(m(),T("div",hu)),L(mu,{badges:p.asset.badges},null,8,["badges"])]),y("div",{class:J(v(de)("p-4 h-32 flex flex-col justify-between"))},[y("div",null,[ue((m(),T("h3",{id:v(a),class:J(v(de)("mb-2 m-0 text-base font-semibold line-clamp-2 wrap-anywhere","text-base-foreground"))},[qe(z(p.asset.name),1)],10,yu)),[[d,{value:p.asset.name,showDelay:s.value},void 0,{top:!0}]]),ue((m(),T("p",{id:v(l),class:J(v(de)("m-0 text-sm leading-6 overflow-hidden [-webkit-box-orient:vertical] [-webkit-line-clamp:2] [display:-webkit-box]","text-muted-foreground"))},[qe(z(p.asset.description),1)],10,bu)),[[d,{value:p.asset.description,showDelay:s.value},void 0,{top:!0}]])]),y("div",{class:J(v(de)("flex gap-4 text-xs text-muted-foreground"))},[p.asset.stats.stars?(m(),T("span",wu,[g[2]||(g[2]=y("i",{class:"icon-[lucide--star] size-3"},null,-1)),qe(" "+z(p.asset.stats.stars),1)])):A("",!0),p.asset.stats.downloadCount?(m(),T("span",ku,[g[3]||(g[3]=y("i",{class:"icon-[lucide--download] size-3"},null,-1)),qe(" "+z(p.asset.stats.downloadCount),1)])):A("",!0),p.asset.stats.formattedDate?(m(),T("span",Cu,[g[4]||(g[4]=y("i",{class:"icon-[lucide--clock] size-3"},null,-1)),qe(" "+z(p.asset.stats.formattedDate),1)])):A("",!0)],2)],2)]),_:1},16,["data-asset-id","class"])}}});function Kn(e={}){const{minWidth:o="15rem",maxWidth:t="1fr",padding:a="0",gap:l="1rem",columns:s}=e;return s!==void 0&&s<1&&console.warn("createGridStyle: columns must be >= 1, defaulting to 1"),{display:"grid",gridTemplateColumns:s?`repeat(${Math.max(1,s??1)}, 1fr)`:`repeat(auto-fill, minmax(${o}, ${t}))`,padding:a,gap:l}}n(Kn,"createGridStyle");const xu=["aria-label","aria-setsize"],$u={key:0,class:"col-span-full flex items-center justify-center py-20"},_u={key:1,class:"col-span-full flex flex-col items-center justify-center py-16 text-muted-foreground"},Tu={class:"mb-2 text-lg font-medium"},Nu={class:"text-sm"},Mu=K({__name:"AssetGrid",props:{assets:{},loading:{type:Boolean}},emits:["assetSelect"],setup(e){const o=b(()=>Kn());return(t,a)=>(m(),T("div",{"data-component-id":"AssetGrid",style:pe(o.value),role:"grid","aria-label":t.$t("assetBrowser.assetCollection"),"aria-rowcount":-1,"aria-colcount":-1,"aria-setsize":t.assets.length},[t.loading?(m(),T("div",$u,a[1]||(a[1]=[y("i",{class:"icon-[lucide--loader] size-12 animate-spin text-muted-foreground"},null,-1)]))):t.assets.length===0?(m(),T("div",_u,[a[2]||(a[2]=y("i",{class:"mb-4 icon-[lucide--search] size-10"},null,-1)),y("h3",Tu,z(t.$t("assetBrowser.noAssetsFound")),1),y("p",Nu,z(t.$t("assetBrowser.tryAdjustingFilters")),1)])):(m(!0),T(le,{key:2},we(t.assets,l=>(m(),O(Su,{key:l.id,asset:l,interactive:!0,role:"gridcell",onSelect:a[0]||(a[0]=s=>t.$emit("assetSelect",s))},null,8,["asset"]))),128))],12,xu))}});function Iu(e){const o={loras:"LoRA",ipadapter:"IP-Adapter",sams:"SAM",clip_vision:"CLIP Vision",animatediff_motion_lora:"AnimateDiff Motion LoRA",animatediff_models:"AnimateDiff Model",vae:"VAE",sam2:"SAM 2",controlnet:"ControlNet",gligen:"GLIGEN"};return o[e]?o[e]:e.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}n(Iu,"formatDisplayName");const La=Et(()=>{const{state:e,isLoading:o,error:t,execute:a}=En(async()=>(await he.getModelFolders()).map(s=>({name:Iu(s.name),value:s.name})),[],{immediate:!1,onError:n(l=>{console.error("Failed to fetch model types:",l)},"onError")});return{modelTypes:e,isLoading:o,error:t,fetchModelTypes:a}}),Pu={class:"flex flex-col gap-4 text-sm text-muted-foreground"},Ru={class:"flex flex-col gap-2"},Du={class:"m-0"},Au={class:"mt-0 bg-modal-card-background text-base-foreground p-3 rounded-lg"},Lu={class:"flex flex-col gap-2"},Eu={class:""},Vu={class:"flex items-center gap-2"},Wu=K({__name:"UploadModelConfirmation",props:An({metadata:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const o=Bo(e,"modelValue"),{modelTypes:t,isLoading:a}=La();return(l,s)=>(m(),T("div",Pu,[y("div",Ru,[y("p",Du,z(l.$t("assetBrowser.modelAssociatedWithLink")),1),y("p",Au,z(l.metadata?.name||l.metadata?.filename),1)]),y("div",Lu,[y("label",Eu,z(l.$t("assetBrowser.modelTypeSelectorLabel")),1),L(en,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=i=>o.value=i),label:v(a)?l.$t("g.loading"):l.$t("assetBrowser.modelTypeSelectorPlaceholder"),options:v(t),disabled:v(a)},null,8,["modelValue","label","options","disabled"]),y("div",Vu,[s[1]||(s[1]=y("i",{class:"icon-[lucide--circle-question-mark]"},null,-1)),y("span",null,z(l.$t("assetBrowser.notSureLeaveAsIs")),1)])])]))}}),Ou={class:"flex justify-end gap-2 w-full"},Bu={key:0,class:"text-muted-foreground mr-auto underline flex items-center gap-2"},zu={href:"#",target:"_blank",class:"text-muted-foreground"},Fu={key:3},Uu={key:0,class:"icon-[lucide--loader-circle] animate-spin"},Gu={key:0,class:"icon-[lucide--loader-circle] animate-spin"},Hu=K({__name:"UploadModelFooter",props:{currentStep:{},isFetchingMetadata:{type:Boolean},isUploading:{type:Boolean},canFetchMetadata:{type:Boolean},canUploadModel:{type:Boolean},uploadStatus:{}},emits:["back","fetchMetadata","upload","close"],setup(e,{emit:o}){const t=o;return(a,l)=>(m(),T("div",Ou,[a.currentStep===1?(m(),T("span",Bu,[l[5]||(l[5]=y("i",{class:"icon-[lucide--circle-question-mark]"},null,-1)),y("a",zu,z(a.$t("How do I find this?")),1)])):A("",!0),a.currentStep===1?(m(),O(bt,{key:1,label:a.$t("g.cancel"),type:"transparent",size:"md",disabled:a.isFetchingMetadata||a.isUploading,onClick:l[0]||(l[0]=s=>t("close"))},null,8,["label","disabled"])):A("",!0),a.currentStep!==1&&a.currentStep!==3?(m(),O(bt,{key:2,label:a.$t("g.back"),type:"transparent",size:"md",disabled:a.isFetchingMetadata||a.isUploading,onClick:l[1]||(l[1]=s=>t("back"))},null,8,["label","disabled"])):(m(),T("span",Fu)),a.currentStep===1?(m(),O(Fe,{key:4,label:a.$t("g.continue"),type:"secondary",size:"md",disabled:!a.canFetchMetadata||a.isFetchingMetadata,onClick:l[2]||(l[2]=s=>t("fetchMetadata"))},{icon:E(()=>[a.isFetchingMetadata?(m(),T("i",Uu)):A("",!0)]),_:1},8,["label","disabled"])):a.currentStep===2?(m(),O(Fe,{key:5,label:a.$t("assetBrowser.upload"),type:"secondary",size:"md",disabled:!a.canUploadModel||a.isUploading,onClick:l[3]||(l[3]=s=>t("upload"))},{icon:E(()=>[a.isUploading?(m(),T("i",Gu)):A("",!0)]),_:1},8,["label","disabled"])):a.currentStep===3&&a.uploadStatus==="success"?(m(),O(bt,{key:6,label:a.$t("assetBrowser.finish"),type:"secondary",size:"md",onClick:l[4]||(l[4]=s=>t("close"))},null,8,["label"])):A("",!0)]))}}),ju={class:"flex flex-1 flex-col gap-6 text-sm text-muted-foreground"},qu={key:0,class:"flex flex-1 flex-col items-center justify-center gap-2"},Ku={class:"text-center"},Qu={class:"m-0 font-bold"},Ju={key:1,class:"flex flex-col gap-2"},Yu={class:"m-0 font-bold"},Zu={class:"m-0"},Xu={class:"flex flex-row items-start p-4 bg-modal-card-background rounded-lg"},ec={class:"flex flex-col justify-center items-start gap-1 flex-1"},tc={class:"text-base-foreground m-0"},oc={class:"text-sm text-muted m-0"},nc={key:2,class:"flex flex-1 flex-col items-center justify-center gap-6"},sc={class:"text-center"},ac={class:"m-0 text-sm font-bold"},lc={key:0,class:"text-sm text-muted mb-0"},ic=K({__name:"UploadModelProgress",props:{status:{},error:{},metadata:{},modelType:{}},setup(e){return(o,t)=>(m(),T("div",ju,[o.status==="uploading"?(m(),T("div",qu,[t[0]||(t[0]=y("i",{class:"icon-[lucide--loader-circle] animate-spin text-6xl text-muted-foreground"},null,-1)),y("div",Ku,[y("p",Qu,z(o.$t("assetBrowser.uploadingModel")),1)])])):o.status==="success"?(m(),T("div",Ju,[y("p",Yu,z(o.$t("assetBrowser.modelUploaded")),1),y("p",Zu,z(o.$t("assetBrowser.findInLibrary",{type:o.modelType})),1),y("div",Xu,[y("div",ec,[y("p",tc,z(o.metadata?.name||o.metadata?.filename),1),y("p",oc,z(o.modelType),1)])])])):o.status==="error"?(m(),T("div",nc,[t[1]||(t[1]=y("i",{class:"icon-[lucide--x-circle] text-6xl text-error"},null,-1)),y("div",sc,[y("p",ac,z(o.$t("assetBrowser.uploadFailed")),1),o.error?(m(),T("p",lc,z(o.error),1)):A("",!0)])])):A("",!0)]))}}),rc={class:"flex flex-col gap-6 text-sm text-muted-foreground"},uc={class:"flex flex-col gap-2"},cc={class:"m-0"},dc={class:"list-disc space-y-1 pl-5 mt-0"},pc=["innerHTML"],fc=["innerHTML"],mc={class:"flex flex-col gap-2"},vc=["innerHTML"],gc={key:0,class:"text-xs text-error"},hc=["innerHTML"],yc=K({__name:"UploadModelUrlInput",props:{modelValue:{},error:{}},emits:["update:modelValue"],setup(e,{emit:o}){const t=e,a=o,l=b({get:n(()=>t.modelValue,"get"),set:n(s=>a("update:modelValue",s),"set")});return(s,i)=>(m(),T("div",rc,[y("div",uc,[y("p",cc,z(s.$t("assetBrowser.uploadModelDescription1")),1),y("ul",dc,[y("li",{innerHTML:s.$t("assetBrowser.uploadModelDescription2")},null,8,pc),y("li",{innerHTML:s.$t("assetBrowser.uploadModelDescription3")},null,8,fc)])]),y("div",mc,[y("label",{class:"mb-0",innerHTML:s.$t("assetBrowser.civitaiLinkLabel")},null,8,vc),L(v(oa),{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=r=>l.value=r),autofocus:"",placeholder:s.$t("assetBrowser.civitaiLinkPlaceholder"),class:"w-full bg-secondary-background border-0 p-4"},null,8,["modelValue","placeholder"]),s.error?(m(),T("p",gc,z(s.error),1)):(m(),T("p",{key:1,innerHTML:s.$t("assetBrowser.civitaiLinkExample")},null,8,hc))])]))}});function bc(e){const o=R(1),t=R(!1),a=R(!1),l=R("idle"),s=R(""),i=R({url:"",metadata:null,name:"",tags:[]}),r=R();te(()=>i.value.url,()=>{s.value=""});const u=b(()=>i.value.url.trim().length>0),c=b(()=>!!r.value);function p(h){try{const C=new URL(h).hostname.toLowerCase();return C==="civitai.com"||C.endsWith(".civitai.com")}catch{return!1}}n(p,"isCivitaiUrl");async function g(){if(!u.value)return;let h=i.value.url.trim();try{h=new URL(encodeURI(h)).toString()}catch{}if(i.value.url=h,!p(i.value.url)){s.value=ye("assetBrowser.onlyCivitaiUrlsSupported","Only Civitai URLs are supported");return}t.value=!0;try{const C=await Uo.getAssetMetadata(i.value.url);if(i.value.metadata=C,i.value.name=C.filename||C.name||"",C.tags&&C.tags.length>0){i.value.tags=C.tags;const f=C.tags.find(S=>e.value.some($=>$.value===S));f&&(r.value=f)}o.value=2}catch(C){console.error("Failed to retrieve metadata:",C),s.value=C instanceof Error?C.message:ye("assetBrowser.uploadModelFailedToRetrieveMetadata","Failed to retrieve metadata. Please check the link and try again."),o.value=1}finally{t.value=!1}}n(g,"fetchMetadata");async function d(){if(c.value){a.value=!0,l.value="uploading";try{const h=r.value?["models",r.value]:["models"],C=i.value.metadata?.filename||i.value.metadata?.name||"model";return await Uo.uploadAssetFromUrl({url:i.value.url,name:C,tags:h,user_metadata:{source:"civitai",source_url:i.value.url,model_type:r.value}}),l.value="success",o.value=3,!0}catch(h){return console.error("Failed to upload asset:",h),l.value="error",s.value=h instanceof Error?h.message:"Failed to upload model",o.value=3,!1}finally{a.value=!1}}}n(d,"uploadModel");function w(){o.value>1&&(o.value=o.value-1)}return n(w,"goToPreviousStep"),{currentStep:o,isFetchingMetadata:t,isUploading:a,uploadStatus:l,uploadError:s,wizardData:i,selectedModelType:r,canFetchMetadata:u,canUploadModel:c,fetchMetadata:g,uploadModel:d,goToPreviousStep:w}}n(bc,"useUploadModelWizard");const wc={class:"upload-model-dialog flex flex-col justify-between gap-6 p-4 pt-6 border-t-[1px] border-border-default"},kc=K({__name:"UploadModelDialog",emits:["upload-success"],setup(e,{emit:o}){const t=St(),{modelTypes:a,fetchModelTypes:l}=La(),s=o,{currentStep:i,isFetchingMetadata:r,isUploading:u,uploadStatus:c,uploadError:p,wizardData:g,selectedModelType:d,canFetchMetadata:w,canUploadModel:h,fetchMetadata:C,uploadModel:f,goToPreviousStep:S}=bc(a);async function $(){await C()}n($,"handleFetchMetadata");async function k(){await f()&&s("upload-success")}n(k,"handleUploadModel");function x(){t.closeDialog({key:"upload-model"})}return n(x,"handleClose"),De(()=>{l()}),(_,M)=>(m(),T("div",wc,[v(i)===1?(m(),O(yc,{key:0,modelValue:v(g).url,"onUpdate:modelValue":M[0]||(M[0]=N=>v(g).url=N),error:v(p)},null,8,["modelValue","error"])):v(i)===2?(m(),O(Wu,{key:1,modelValue:v(d),"onUpdate:modelValue":M[1]||(M[1]=N=>st(d)?d.value=N:null),metadata:v(g).metadata},null,8,["modelValue","metadata"])):v(i)===3?(m(),O(ic,{key:2,status:v(c),error:v(p),metadata:v(g).metadata,"model-type":v(d)},null,8,["status","error","metadata","model-type"])):A("",!0),L(Hu,{"current-step":v(i),"is-fetching-metadata":v(r),"is-uploading":v(u),"can-fetch-metadata":v(w),"can-upload-model":v(h),"upload-status":v(c),onBack:v(S),onFetchMetadata:$,onUpload:k,onClose:x},null,8,["current-step","is-fetching-metadata","is-uploading","can-fetch-metadata","can-upload-model","upload-status","onBack"])]))}}),Cc=Se(kc,[["__scopeId","data-v-6715b0b8"]]),Sc=""+new URL("images/civitai.svg",import.meta.url).href,xc={},$c={class:"flex items-center gap-2 p-4 font-bold"},_c={class:"rounded-full bg-white px-1.5 py-0 text-xxs font-inter font-semibold uppercase text-black"};function Tc(e,o){return m(),T("div",$c,[o[0]||(o[0]=y("img",{src:Sc,class:"size-4"},null,-1)),y("span",null,z(e.$t("assetBrowser.uploadModelFromCivitai")),1),y("span",_c,z(e.$t("g.beta")),1)])}n(Tc,"_sfc_render$2");const Nc=Se(xc,[["render",Tc]]);function Mc(e){return typeof e.user_metadata?.description=="string"?e.user_metadata.description:null}n(Mc,"getAssetDescription");function Ea(e){return typeof e.user_metadata?.base_model=="string"?e.user_metadata.base_model:null}n(Ea,"getAssetBaseModel");function Ic(e){return o=>e==="all"||o.tags.includes(e)}n(Ic,"filterByCategory");function Pc(e){return o=>{if(e.length===0)return!0;const t=new Set(e),a=o.name.split(".").pop()?.toLowerCase();return a?t.has(a):!1}}n(Pc,"filterByFileFormats");function Rc(e){return o=>{if(e.length===0)return!0;const t=new Set(e),a=Ea(o);return a?t.has(a):!1}}n(Rc,"filterByBaseModels");function Dc(e=R([])){const o=b(()=>e.value??[]),t=R(""),a=R("all"),l=R({sortBy:"name-asc",fileFormats:[],baseModels:[]});function s(h){const C=h.tags.find(x=>x!=="models"),f=Mc(h)||`${C||Z("assetBrowser.unknown")} model`,S=[];C&&S.push({label:C,type:"type"});const $=Ea(h);$&&S.push({label:$,type:"base"});const k={formattedDate:jl(new Date(h.created_at),{dateStyle:"short"}),downloadCount:void 0,stars:void 0};return{...h,description:f,badges:S,stats:k}}n(s,"transformAssetForDisplay");const i=b(()=>{const h=o.value.filter(f=>f.tags[0]==="models").map(f=>f.tags[1]).filter(f=>typeof f=="string"&&f.length>0),C=Array.from(new Set(h)).sort().map(f=>({id:f,label:f.charAt(0).toUpperCase()+f.slice(1),icon:"icon-[lucide--package]"}));return[{id:"all",label:Z("assetBrowser.allModels"),icon:"icon-[lucide--folder]"},...C]}),r=b(()=>a.value==="all"?Z("assetBrowser.allModels"):i.value.find(C=>C.id===a.value)?.label||Z("assetBrowser.assets")),u=b(()=>o.value.filter(Ic(a.value))),c={fuseOptions:{keys:[{name:"name",weight:.4},{name:"tags",weight:.3}],threshold:.4,ignoreLocation:!0,includeScore:!0},matchAllWhenSearchEmpty:!0},{results:p}=zs(t,u,c),g=b(()=>p.value.map(h=>h.item)),d=b(()=>{const C=[...g.value.filter(Pc(l.value.fileFormats)).filter(Rc(l.value.baseModels))];return C.sort((f,S)=>{switch(l.value.sortBy){case"name-desc":return S.name.localeCompare(f.name);case"recent":return new Date(S.created_at).getTime()-new Date(f.created_at).getTime();case"popular":return f.name.localeCompare(S.name);case"name-asc":default:return f.name.localeCompare(S.name)}}),C.map(s)});function w(h){l.value={...h}}return n(w,"updateFilters"),{searchQuery:t,selectedCategory:a,availableCategories:i,contentTitle:r,categoryFilteredAssets:u,filteredAssets:d,updateFilters:w}}n(Dc,"useAssetBrowser");const Ac=new Set(["VAE","CLIP","GLIGEN"]);function Lc(e){return e?e==="diffusion_models"?"Diffusion":e.split("_").map(o=>{const t=o.toUpperCase();if(Ac.has(t))return t;const a=o.toLowerCase();return a.charAt(0).toUpperCase()+a.slice(1)}).join(" "):"Models"}n(Lc,"formatCategoryLabel");const Ec={class:"capitalize"},Vc={class:"flex w-full items-center justify-between gap-2"},ys=K({__name:"AssetBrowserModal",props:{nodeType:{},inputName:{},onSelect:{type:Function},onClose:{type:Function},showLeftPanel:{type:Boolean},title:{},assetType:{}},emits:["asset-select","close"],setup(e,{emit:o}){const t=e,{t:a}=ce(),l=St(),s=o;Vn(Xo,t.onClose??(()=>{}));const i=n(async()=>t.nodeType?await Uo.getAssetsForNodeType(t.nodeType)??[]:t.assetType?await Uo.getAssetsByTag(t.assetType)??[]:[],"fetchAssets"),{state:r,isLoading:u,execute:c}=En(i,[],{immediate:!1});te(()=>[t.nodeType,t.assetType],async()=>{await c()},{immediate:!0});const{searchQuery:p,selectedCategory:g,availableCategories:d,categoryFilteredAssets:w,filteredAssets:h,updateFilters:C}=Dc(r),f=Wn(),S=b(()=>{const G=(r.value??[]).map(D=>D.tags?.find(B=>B!=="models")).find(D=>typeof D=="string"&&D.length>0);if(G)return G;if(t.nodeType){const D=f.getCategoryForNodeType(t.nodeType);if(D)return D}return t.assetType?t.assetType:"models"}),$=b(()=>g.value!=="all"?g.value:S.value),k=b(()=>{if(t.title)return t.title;const P=Lc($.value);return a("assetBrowser.allCategory",{category:P})}),x=b(()=>t.showLeftPanel??!0);function _(){t.onClose?.(),s("close")}n(_,"handleClose");function M(P){s("asset-select",P),t.onSelect?.(P)}n(M,"handleAssetSelectAndEmit");const{flags:N}=Zr(),I=b(()=>N.modelUploadButtonEnabled);function V(){l.showDialog({key:"upload-model",headerComponent:Nc,component:Cc,props:{onUploadSuccess:n(async()=>{await c()},"onUploadSuccess")},dialogComponentProps:{pt:{header:"py-0! pl-0!",content:"p-0!"}}})}return n(V,"handleUploadClick"),(P,G)=>(m(),O(jn,{"data-component-id":"AssetBrowserModal",class:"size-full max-h-full max-w-full min-w-0","content-title":k.value,onClose:_},Ln({header:E(()=>[y("div",Vc,[L(Qo,{modelValue:v(p),"onUpdate:modelValue":G[1]||(G[1]=D=>st(p)?p.value=D:null),autofocus:!0,size:"lg",placeholder:P.$t("assetBrowser.searchAssetsPlaceholder"),class:"max-w-96"},null,8,["modelValue","placeholder"]),I.value?(m(),O(Fe,{key:0,type:"accent",size:"md",class:"!h-10 [&>span]:hidden md:[&>span]:inline",label:P.$t("assetBrowser.uploadModel"),"on-click":V},{icon:E(()=>G[3]||(G[3]=[y("i",{class:"icon-[lucide--package-plus]"},null,-1)])),_:1},8,["label"])):A("",!0)])]),contentFilter:E(()=>[L(pu,{assets:v(w),onFilterChange:v(C)},null,8,["assets","onFilterChange"])]),content:E(()=>[L(Mu,{assets:v(h),loading:v(u),onAssetSelect:M},null,8,["assets","loading"])]),_:2},[x.value?{name:"leftPanel",fn:E(()=>[L(qn,{modelValue:v(g),"onUpdate:modelValue":G[0]||(G[0]=D=>st(g)?g.value=D:null),"data-component-id":"AssetBrowserModal-LeftSidePanel","nav-items":v(d)},{"header-icon":E(()=>G[2]||(G[2]=[y("div",{class:"icon-[lucide--folder] size-4"},null,-1)])),"header-title":E(()=>[y("span",Ec,z(k.value),1)]),_:1},8,["modelValue","nav-items"])]),key:"0"}:void 0]),1032,["content-title"]))}}),bs={headless:!0,modal:!0,closable:!0,pt:{root:{class:"rounded-2xl overflow-hidden asset-browser-dialog"},header:{class:"!p-0 hidden"},content:{class:"!p-0 !m-0 h-full w-full"}}},Wc=n(()=>{const e=St(),o="global-asset-browser";async function t(l){const s=n(i=>{l.onAssetSelected?.(i),e.closeDialog({key:o})},"handleAssetSelected");e.showDialog({key:o,component:ys,props:{nodeType:l.nodeType,inputName:l.inputName,currentValue:l.currentValue,onSelect:s,onClose:n(()=>e.closeDialog({key:o}),"onClose")},dialogComponentProps:bs})}n(t,"show");async function a(l){const s=n(i=>{l.onAssetSelected?.(i),e.closeDialog({key:o})},"handleAssetSelected");e.showDialog({key:o,component:ys,props:{showLeftPanel:!0,assetType:l.assetType,title:l.title,onSelect:s,onClose:n(()=>e.closeDialog({key:o}),"onClose")},dialogComponentProps:bs})}return n(a,"browse"),{show:t,browse:a}},"useAssetBrowserDialog"),Oc=["aria-label"],Bc={class:"relative h-full w-full grow overflow-hidden rounded-[5px] bg-node-component-surface"},zc={key:0,class:"flex size-full flex-col items-center justify-center bg-smoke-800/50 text-center text-white py-8"},Fc={class:"text-sm text-smoke-300"},Uc={class:"mt-1 text-xs text-smoke-400"},Gc=["src"],Hc={key:3,class:"actions absolute top-2 right-2 flex gap-1"},jc=["title","aria-label"],qc=["title","aria-label"],Kc={key:4,class:"absolute right-2 bottom-2 left-2 flex justify-center gap-1"},Qc=["aria-label","onClick"],Jc={class:"mt-2 text-center text-xs text-white"},Yc={key:0,class:"text-red-400"},Zc={key:1,class:"text-smoke-400"},Xc={key:2},ed=K({__name:"VideoPreview",props:{imageUrls:{},nodeId:{}},setup(e){const o=e,{t}=ce(),a=Ot(),l=R(0),s=R(!1),i=R(null),r=R(!1),u=R(!1),c=b(()=>o.imageUrls[l.value]),p=b(()=>o.imageUrls.length>1);te(()=>o.imageUrls,_=>{l.value>=_.length&&(l.value=0),i.value=null,r.value=!1,u.value=_.length>0},{deep:!0});const g=n(_=>{if(!_.target||!(_.target instanceof HTMLVideoElement))return;const M=_.target;u.value=!1,r.value=!1,M.videoWidth&&M.videoHeight&&(i.value=`${M.videoWidth} x ${M.videoHeight}`)},"handleVideoLoad"),d=n(()=>{u.value=!1,r.value=!0,i.value=null},"handleVideoError"),w=n(()=>{try{Jo(c.value)}catch{Wt().add({severity:"error",summary:"Error",detail:t("g.failedToDownloadVideo"),life:3e3,group:"video-preview"})}},"handleDownload"),h=n(()=>{o.nodeId&&a.removeNodeOutputs(o.nodeId)},"handleRemove"),C=n(_=>{_>=0&&_<o.imageUrls.length&&(l.value=_,i.value=null,u.value=!0,r.value=!1)},"setCurrentIndex"),f=n(()=>{s.value=!0},"handleMouseEnter"),S=n(()=>{s.value=!1},"handleMouseLeave"),$=n(_=>["w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer",_===l.value?"bg-white":"bg-white/50 hover:bg-white/80"],"getNavigationDotClass"),k=n(_=>{if(!(o.imageUrls.length<=1))switch(_.key){case"ArrowLeft":_.preventDefault(),C(l.value>0?l.value-1:o.imageUrls.length-1);break;case"ArrowRight":_.preventDefault(),C(l.value<o.imageUrls.length-1?l.value+1:0);break;case"Home":_.preventDefault(),C(0);break;case"End":_.preventDefault(),C(o.imageUrls.length-1);break}},"handleKeyDown"),x=n(_=>{try{return new URL(_).searchParams.get("filename")||"Unknown file"}catch{return"Invalid URL"}},"getVideoFilename");return(_,M)=>_.imageUrls.length>0?(m(),T("div",{key:0,class:"video-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2",tabindex:"0",role:"region","aria-label":_.$t("g.videoPreview"),onMouseenter:f,onMouseleave:S,onKeydown:k},[y("div",Bc,[r.value?(m(),T("div",zc,[M[0]||(M[0]=y("i",{class:"mb-2 icon-[lucide--video-off] h-12 w-12 text-smoke-400"},null,-1)),y("p",Fc,z(_.$t("g.videoFailedToLoad")),1),y("p",Uc,z(x(c.value)),1)])):A("",!0),u.value&&!r.value?(m(),O(v(na),{key:1,class:"absolute inset-0 size-full","border-radius":"5px",width:"16rem",height:"16rem"})):A("",!0),r.value?A("",!0):(m(),T("video",{key:2,src:c.value,class:J(v(de)("block size-full object-contain",u.value&&"invisible")),controls:"",loop:"",playsinline:"",onLoadeddata:g,onError:d},null,42,Gc)),s.value?(m(),T("div",Hc,[y("button",{class:"action-btn cursor-pointer rounded-lg border-0 bg-white p-2 text-black shadow-sm transition-all duration-200 hover:bg-smoke-100",title:_.$t("g.downloadVideo"),"aria-label":_.$t("g.downloadVideo"),onClick:w},M[1]||(M[1]=[y("i",{class:"icon-[lucide--download] h-4 w-4"},null,-1)]),8,jc),y("button",{class:"action-btn cursor-pointer rounded-lg border-0 bg-white p-2 text-black shadow-sm transition-all duration-200 hover:bg-smoke-100",title:_.$t("g.removeVideo"),"aria-label":_.$t("g.removeVideo"),onClick:h},M[2]||(M[2]=[y("i",{class:"icon-[lucide--x] h-4 w-4"},null,-1)]),8,qc)])):A("",!0),p.value?(m(),T("div",Kc,[(m(!0),T(le,null,we(_.imageUrls,(N,I)=>(m(),T("button",{key:I,class:J($(I)),"aria-label":_.$t("g.viewVideoOfTotal",{index:I+1,total:_.imageUrls.length}),onClick:n(V=>C(I),"onClick")},null,10,Qc))),128))])):A("",!0)]),y("div",Jc,[r.value?(m(),T("span",Yc,z(_.$t("g.errorLoadingVideo")),1)):u.value?(m(),T("span",Zc,z(_.$t("g.loading"))+"... ",1)):(m(),T("span",Xc,z(i.value||_.$t("g.calculatingDimensions")),1))])],40,Oc)):A("",!0)}}),td=["aria-label"],od={class:"h-full w-full overflow-hidden rounded-[5px] bg-node-component-surface"},nd={key:0,class:"flex size-full flex-col items-center justify-center bg-smoke-800/50 text-center text-white py-8"},sd={class:"text-sm text-smoke-300"},ad={class:"mt-1 text-xs text-smoke-400"},ld=["src","alt"],id={key:3,class:"actions absolute top-2 right-2 flex gap-2.5"},rd=["title","aria-label"],ud=["title","aria-label"],cd=["title","aria-label"],dd={key:4,class:"absolute right-2 bottom-2 left-2 flex justify-center gap-1"},pd=["aria-label","onClick"],fd={class:"mt-2 text-center text-xs text-white"},md={key:0,class:"text-red-400"},vd={key:1,class:"text-smoke-400"},gd={key:2},dn="flex h-8 min-h-8 items-center justify-center gap-2.5 rounded-lg border-0 bg-button-surface px-2 py-2 text-button-surface-contrast shadow-sm transition-colors duration-200 hover:bg-button-hover-surface focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-button-surface-contrast focus-visible:ring-offset-2 focus-visible:ring-offset-transparent cursor-pointer",hd=K({__name:"ImagePreview",props:{imageUrls:{},nodeId:{}},setup(e){const o=e,{t}=ce(),a=ke(),l=Ot(),s=R(0),i=R(!1),r=R(null),u=R(!1),c=R(!1),p=R(),g=b(()=>o.imageUrls[s.value]),d=b(()=>o.imageUrls.length>1),w=b(()=>`Node output ${s.value+1}`);te(()=>o.imageUrls,P=>{s.value>=P.length&&(s.value=0),r.value=null,u.value=!1,c.value=P.length>0},{deep:!0});const h=n(P=>{if(!P.target||!(P.target instanceof HTMLImageElement))return;const G=P.target;c.value=!1,u.value=!1,G.naturalWidth&&G.naturalHeight&&(r.value=`${G.naturalWidth} x ${G.naturalHeight}`)},"handleImageLoad"),C=n(()=>{c.value=!1,u.value=!0,r.value=null},"handleImageError"),f=n(()=>{if(!o.nodeId||!p.value)return;const P=j.rootGraph?.getNodeById(o.nodeId);P&&(P.imageIndex=s.value,P.imgs=[p.value],j.canvas?.select(P))},"setupNodeForMaskEditor"),S=n(()=>{f(),a.execute("Comfy.MaskEditor.OpenMaskEditor")},"handleEditMask"),$=n(()=>{try{Jo(g.value)}catch{Wt().add({severity:"error",summary:"Error",detail:t("g.failedToDownloadImage"),life:3e3,group:"image-preview"})}},"handleDownload"),k=n(()=>{o.nodeId&&l.removeNodeOutputs(o.nodeId)},"handleRemove"),x=n(P=>{P>=0&&P<o.imageUrls.length&&(s.value=P,r.value=null,c.value=!0,u.value=!1)},"setCurrentIndex"),_=n(()=>{i.value=!0},"handleMouseEnter"),M=n(()=>{i.value=!1},"handleMouseLeave"),N=n(P=>["w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer",P===s.value?"bg-white":"bg-white/50 hover:bg-white/80"],"getNavigationDotClass"),I=n(P=>{if(!(o.imageUrls.length<=1))switch(P.key){case"ArrowLeft":P.preventDefault(),x(s.value>0?s.value-1:o.imageUrls.length-1);break;case"ArrowRight":P.preventDefault(),x(s.value<o.imageUrls.length-1?s.value+1:0);break;case"Home":P.preventDefault(),x(0);break;case"End":P.preventDefault(),x(o.imageUrls.length-1);break}},"handleKeyDown"),V=n(P=>{try{return new URL(P).searchParams.get("filename")||"Unknown file"}catch{return"Invalid URL"}},"getImageFilename");return(P,G)=>{const D=ca;return P.imageUrls.length>0?(m(),T("div",{key:0,class:"image-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2 justify-center",tabindex:"0",role:"region","aria-label":P.$t("g.imagePreview"),onMouseenter:_,onMouseleave:M,onKeydown:I},[y("div",od,[u.value?(m(),T("div",nd,[G[0]||(G[0]=y("i",{class:"mb-2 icon-[lucide--image-off] h-12 w-12 text-smoke-400"},null,-1)),y("p",sd,z(P.$t("g.imageFailedToLoad")),1),y("p",ad,z(V(g.value)),1)])):A("",!0),c.value&&!u.value?(m(),O(v(na),{key:1,class:"absolute inset-0 size-full","border-radius":"5px",width:"16rem",height:"16rem"})):A("",!0),u.value?A("",!0):(m(),T("img",{key:2,ref_key:"currentImageEl",ref:p,src:g.value,alt:w.value,class:J(v(de)("block size-full object-contain pointer-events-none",c.value&&"invisible")),onLoad:h,onError:C},null,42,ld)),i.value?(m(),T("div",id,[d.value?A("",!0):(m(),T("button",{key:0,class:J(dn),title:P.$t("g.editOrMaskImage"),"aria-label":P.$t("g.editOrMaskImage"),onClick:S},[L(D,{class:"h-4 w-4"})],8,rd)),y("button",{class:J(dn),title:P.$t("g.downloadImage"),"aria-label":P.$t("g.downloadImage"),onClick:$},G[1]||(G[1]=[y("i",{class:"icon-[lucide--download] h-4 w-4"},null,-1)]),8,ud),y("button",{class:J(dn),title:P.$t("g.removeImage"),"aria-label":P.$t("g.removeImage"),onClick:k},G[2]||(G[2]=[y("i",{class:"icon-[lucide--x] h-4 w-4"},null,-1)]),8,cd)])):A("",!0),d.value?(m(),T("div",dd,[(m(!0),T(le,null,we(P.imageUrls,(B,F)=>(m(),T("button",{key:F,class:J(N(F)),"aria-label":P.$t("g.viewImageOfTotal",{index:F+1,total:P.imageUrls.length}),onClick:n(W=>x(F),"onClick")},null,10,pd))),128))])):A("",!0)]),y("div",fd,[u.value?(m(),T("span",md,z(P.$t("g.errorLoadingImage")),1)):c.value?(m(),T("span",vd,z(P.$t("g.loading"))+"... ",1)):(m(),T("span",gd,z(r.value||P.$t("g.calculatingDimensions")),1))])],40,td)):A("",!0)}}}),yd={key:0,class:"node-error p-2 text-sm text-red-500"},bd={key:1,class:"lg-node-content flex grow flex-col"},wd=K({__name:"NodeContent",props:{nodeData:{},media:{}},setup(e){const o=e,t=b(()=>o.media&&o.media.urls.length>0),a=b(()=>o.nodeData?.id?.toString()),l=R(null),{toastErrorHandler:s}=ho();return Fs(i=>(l.value=i.message,s(i),!1)),(i,r)=>l.value?(m(),T("div",yd,z(v(ye)("nodeErrors.content","Node Content Error")),1)):(m(),T("div",bd,[Pe(i.$slots,"default",{},()=>[t.value&&i.media?.type==="video"?(m(),O(ed,{key:0,"image-urls":i.media.urls,"node-id":a.value,class:"mt-2"},null,8,["image-urls","node-id"])):t.value&&i.media?.type==="image"?(m(),O(hd,{key:1,"image-urls":i.media.urls,"node-id":a.value,class:"mt-2"},null,8,["image-urls","node-id"])):A("",!0)])]))}}),kd={class:"flex max-w-xs min-w-40 flex-col gap-2 p-3"},Cd={class:"text-sm font-inter"},Sd={key:1,class:"text-xs"},xd={class:"flex max-w-xs min-w-40 flex-col gap-2 p-3"},$d={class:"text-sm font-inter"},_d={key:1,class:"text-xs"},ws="cursor-pointer transition-opacity hover:opacity-80",Td=K({__name:"TopbarBadge",props:{badge:{},displayMode:{default:"full"},reverseOrder:{type:Boolean,default:!1},noPadding:{type:Boolean,default:!1},backgroundColor:{default:"var(--comfy-menu-bg)"}},setup(e){const o=e,t=R(),a=n(d=>{t.value?.toggle(d)},"togglePopover"),l=b(()=>o.badge.variant??"info"),s=b(()=>({backgroundColor:o.backgroundColor})),i=b(()=>{switch(l.value){case"error":return"bg-danger-100 text-white";case"warning":return"bg-gold-600 text-black";case"info":default:return"bg-white text-black"}}),r=b(()=>{switch(l.value){case"error":return"text-danger-100";case"warning":return"text-gold-600";case"info":default:return"text-text-primary"}}),u=b(()=>r.value),c=b(()=>{if(o.badge.icon)return o.badge.icon;switch(l.value){case"error":return"pi pi-exclamation-circle";case"warning":return"pi pi-exclamation-triangle";case"info":default:return}}),p=b(()=>{switch(l.value){case"error":return"bg-danger-100";case"warning":return"bg-gold-600";case"info":default:return"bg-slate-100"}}),g=b(()=>({root:{class:de("absolute z-50")},content:{class:de("mt-1 rounded-lg","bg-base-background","text-base-foreground","shadow-lg","border border-border-default")}}));return(d,w)=>{const h=_e("tooltip");return d.displayMode==="icon-only"?(m(),T("div",{key:0,class:J(["relative inline-flex h-full shrink-0 items-center justify-center px-2",ws]),style:pe(s.value),onClick:a},[c.value?(m(),T("i",{key:0,class:J(["shrink-0 text-base",c.value,u.value])},null,2)):d.badge.label?(m(),T("div",{key:1,class:J(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},z(d.badge.label),3)):(m(),T("div",{key:2,class:J(["size-2 shrink-0 rounded-full",p.value])},null,2)),L(v(et),{ref_key:"popover",ref:t,"append-to":"body","auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:g.value},{default:E(()=>[y("div",kd,[d.badge.label?(m(),T("div",{key:0,class:J(["w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},z(d.badge.label),3)):A("",!0),y("div",Cd,z(d.badge.text),1),d.badge.tooltip?(m(),T("div",Sd,z(d.badge.tooltip),1)):A("",!0)])]),_:1},8,["pt"])],4)):d.displayMode==="compact"?(m(),T("div",{key:1,class:"relative inline-flex h-full",style:pe(s.value)},[y("div",{class:J(["flex h-full shrink-0 items-center gap-2 whitespace-nowrap",[{"flex-row-reverse":d.reverseOrder},d.noPadding?"":"px-3",ws]]),onClick:a},[c.value?(m(),T("i",{key:0,class:J(["shrink-0 text-base",c.value,u.value])},null,2)):A("",!0),d.badge.label?(m(),T("div",{key:1,class:J(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},z(d.badge.label),3)):A("",!0)],2),L(v(et),{ref_key:"popover",ref:t,"append-to":"body","auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:g.value},{default:E(()=>[y("div",xd,[d.badge.label?(m(),T("div",{key:0,class:J(["w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},z(d.badge.label),3)):A("",!0),y("div",$d,z(d.badge.text),1),d.badge.tooltip?(m(),T("div",_d,z(d.badge.tooltip),1)):A("",!0)])]),_:1},8,["pt"])],4)):ue((m(),T("div",{key:2,class:J(["flex h-full shrink-0 items-center gap-2 whitespace-nowrap",[{"flex-row-reverse":d.reverseOrder},d.noPadding?"":"px-3"]]),style:pe(s.value)},[c.value?(m(),T("i",{key:0,class:J(["shrink-0 text-base",c.value,u.value])},null,2)):A("",!0),d.badge.label?(m(),T("div",{key:1,class:J(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},z(d.badge.label),3)):A("",!0),y("div",{class:J(["font-inter text-sm",r.value])},z(d.badge.text),3)],6)),[[h,d.badge.tooltip]])}}}),Nd=3e3,Md=5*60*1e3,Id=K({__name:"SubscribeButton",props:{label:{},size:{default:"large"},variant:{default:"default"},fluid:{type:Boolean,default:!0}},emits:["subscribed"],setup(e,{emit:o}){const t=e,a=b(()=>de("font-bold",t.fluid&&"w-full")),l=o,{subscribe:s,isActiveSubscription:i,fetchStatus:r}=On(),u=ql(),c=R(!1),p=R(!1);let g=null;const d=n(()=>{p.value=!0,c.value=!0;const C=Date.now(),f=n(async()=>{try{if(Date.now()-C>Md){w();return}await r(),i.value&&(w(),u?.trackMonthlySubscriptionSucceeded(),l("subscribed"))}catch(S){console.error("[SubscribeButton] Error polling subscription status:",S)}},"poll");f(),g=window.setInterval(f,Nd)},"startPollingSubscriptionStatus"),w=n(()=>{g&&(clearInterval(g),g=null),p.value=!1,c.value=!1},"stopPolling"),h=n(async()=>{c.value=!0;try{await s(),d()}catch(C){console.error("[SubscribeButton] Error initiating subscription:",C),c.value=!1}},"handleSubscribe");return Ct(()=>{w()}),(C,f)=>(m(),O(v(re),{label:C.label||C.$t("subscription.required.subscribe"),size:C.size,loading:c.value,disabled:p.value,severity:"primary",style:pe(C.variant==="gradient"?{background:"var(--color-subscription-button-gradient)",color:"var(--color-white)"}:void 0),pt:{root:{class:a.value}},onClick:h},null,8,["label","size","loading","disabled","style","pt"]))}}),Pd=K({__name:"GlobalToast",setup(e){const o=Wt(),t=wt(),a=ne();te(()=>t.messagesToAdd,i=>{i.length!==0&&(i.forEach(r=>{o.add(r)}),t.messagesToAdd=[])},{deep:!0}),te(()=>t.messagesToRemove,i=>{i.length!==0&&(i.forEach(r=>{o.remove(r)}),t.messagesToRemove=[])},{deep:!0}),te(()=>t.removeAllRequested,i=>{i&&(o.removeAllGroups(),t.removeAllRequested=!1)});function l(){const i=document.getElementById("dynamic-toast-style")||s(),r=document.querySelector(".graph-canvas-container")?.getBoundingClientRect();r&&(i.textContent=`
    .p-toast.p-component.p-toast-top-right {
      top: ${r.top+100}px !important;
      right: ${window.innerWidth-(r.left+r.width)+20}px !important;
       z-index: 10000 !important;
    }
  `)}n(l,"updateToastPosition");function s(){const i=document.createElement("style");return i.id="dynamic-toast-style",document.head.appendChild(i),i}return n(s,"createStyleElement"),te(()=>a.get("Comfy.UseNewMenu"),()=>Le(l),{immediate:!0}),te(()=>a.get("Comfy.Sidebar.Location"),()=>Le(l),{immediate:!0}),(i,r)=>(m(),O(v(Fo)))}});let pn,Va;(function(){const e=globalThis;typeof e.requestIdleCallback!="function"||typeof e.cancelIdleCallback!="function"?pn=n((o,t,a)=>{setTimeout(()=>{if(l)return;const s=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,s-Date.now())}}))});let l=!1;return{dispose(){l||(l=!0)}}},"_runWhenIdle"):pn=n((o,t,a)=>{const l=o.requestIdleCallback(t,typeof a=="number"?{timeout:a}:void 0);let s=!1;return{dispose(){s||(s=!0,o.cancelIdleCallback(l))}}},"_runWhenIdle"),Va=n((o,t)=>pn(globalThis,o,t),"runWhenGlobalIdle")})();const Rd={class:"comfy-menu-hamburger no-drag top-0 right-0"},Dd=K({__name:"MenuHamburger",setup(e){const o=lt(),t=ne(),a=n(()=>{o.focusMode=!1},"exitFocusMode");return be(()=>{t.get("Comfy.UseNewMenu")==="Disabled"&&(o.focusMode?j.ui.menuContainer.style.display="none":j.ui.menuContainer.style.display="block")}),(l,s)=>{const i=_e("tooltip");return ue((m(),T("div",Rd,[ue(L(v(re),{icon:"pi pi-bars",severity:"secondary",text:"",size:"large","aria-label":l.$t("menu.showMenu"),"aria-live":"assertive",onClick:a,onContextmenu:v(Kl)},null,8,["aria-label","onContextmenu"]),[[i,{value:l.$t("menu.showMenu"),showDelay:300}]]),s[0]||(s[0]=y("div",{class:"window-actions-spacer"},null,-1))],512)),[[Qe,v(o).focusMode]])}}}),Ad=Se(Dd,[["__scopeId","data-v-048d09e7"]]),Ld=K({__name:"UnloadWindowConfirmDialog",setup(e){const o=ne(),t=Me(),a=n(l=>{if(o.get("Comfy.Window.UnloadConfirmation")&&t.modifiedWorkflows.length>0)return l.preventDefault(),!0},"handleBeforeUnload");return De(()=>{window.addEventListener("beforeunload",a)}),Ct(()=>{window.removeEventListener("beforeunload",a)}),(l,s)=>(m(),T("div"))}}),Ed={class:"splitter-overlay-root pointer-events-none flex flex-col"},Vd={class:"side-toolbar-container"},Wd=K({__name:"LiteGraphCanvasSplitterOverlay",setup(e){const o=ne(),t=b(()=>o.get("Comfy.Sidebar.Location")),a=b(()=>o.get("Comfy.Sidebar.UnifiedWidth")),l=b(()=>Qt().activeSidebarTab!==null),s=b(()=>Yt().bottomPanelVisible),i=b(()=>Qt().activeSidebarTabId),r=b(()=>a.value?"unified-sidebar":i.value??"default-sidebar");return(u,c)=>(m(),T("div",Ed,[Pe(u.$slots,"workflow-tabs",{},void 0,!0),y("div",{class:J(["pointer-events-none flex flex-1 overflow-hidden",{"flex-row":t.value==="left","flex-row-reverse":t.value==="right"}])},[y("div",Vd,[Pe(u.$slots,"side-toolbar",{},void 0,!0)]),L(v(wn),{key:"main-splitter-stable",class:"splitter-overlay flex-1 overflow-hidden","pt:gutter":l.value?"":"hidden","state-key":r.value||"main-splitter","state-storage":"local"},{default:E(()=>[t.value==="left"?(m(),O(v(Tt),{key:0,class:"side-bar-panel pointer-events-auto","min-size":10,size:20,style:pe({display:l.value&&t.value==="left"?"flex":"none"})},{default:E(()=>[l.value&&t.value==="left"?Pe(u.$slots,"side-bar-panel",{key:0},void 0,!0):A("",!0)]),_:3},8,["style"])):A("",!0),L(v(Tt),{size:80,class:"flex flex-col"},{default:E(()=>[Pe(u.$slots,"topmenu",{sidebarPanelVisible:l.value},void 0,!0),L(v(wn),{class:"splitter-overlay splitter-overlay-bottom mr-1 mb-1 ml-1 flex-1",layout:"vertical","pt:gutter":"rounded-tl-lg rounded-tr-lg "+(s.value?"":"hidden"),"state-key":"bottom-panel-splitter","state-storage":"local"},{default:E(()=>[L(v(Tt),{class:"graph-canvas-panel relative"},{default:E(()=>[Pe(u.$slots,"graph-canvas-panel",{},void 0,!0)]),_:3}),ue(L(v(Tt),{class:"bottom-panel pointer-events-auto rounded-lg"},{default:E(()=>[Pe(u.$slots,"bottom-panel",{},void 0,!0)]),_:3},512),[[Qe,s.value]])]),_:3},8,["pt:gutter"])]),_:3}),t.value==="right"?(m(),O(v(Tt),{key:1,class:"side-bar-panel pointer-events-auto","min-size":10,size:20,style:pe({display:l.value&&t.value==="right"?"flex":"none"})},{default:E(()=>[l.value&&t.value==="right"?Pe(u.$slots,"side-bar-panel",{key:0},void 0,!0):A("",!0)]),_:3},8,["style"])):A("",!0)]),_:3},8,["pt:gutter","state-key"])],2)]))}}),Od=Se(Wd,[["__scopeId","data-v-d3c440a8"]]),Bd=pl(()=>sa(()=>import("./ComfyQueueButton-CseMwkKR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url)),zd={class:"flex h-full items-center"},Fd=K({__name:"ComfyActionbar",setup(e){const o=ne(),t=b(()=>o.get("Comfy.UseNewMenu")),a=b(()=>t.value!=="Disabled"),l=document.querySelector(".workflow-tabs-container"),s=R(null),i=R(null),r=zo("Comfy.MenuPosition.Docked",!0),u=zo("Comfy.MenuPosition.Floating",{x:0,y:0}),{x:c,y:p,style:g,isDragging:d}=fl(s,{initialValue:{x:0,y:0},handle:i,containerElement:document.body,onMove:n(M=>{const N=l?.getBoundingClientRect().bottom??40;M.y<N&&(M.y=N)},"onMove")});so([c,p],([M,N])=>{u.value={x:M,y:N}},{debounce:300});const w=n(()=>{if(s.value){const M=window.innerWidth,N=window.innerHeight,I=s.value.offsetWidth,V=s.value.offsetHeight;if(I===0||V===0)return;if(u.value.x!==0||u.value.y!==0){c.value=Ut(u.value.x,0,M-I),p.value=Ut(u.value.y,0,N-V),C();return}c.value===0&&p.value===0&&(c.value=Ut((M-I)/2,0,M-I),p.value=Ut(N-V-10,0,N-V),C())}},"setInitialPosition");De(w),te(a,async M=>{M&&await Le(w)}),Re(i,"mousedown",()=>{});const h=R({x:c.value,y:p.value,windowWidth:window.innerWidth,windowHeight:window.innerHeight}),C=n(()=>{h.value={x:c.value,y:p.value,windowWidth:window.innerWidth,windowHeight:window.innerHeight}},"captureLastDragState");te(d,M=>{M||C()},{immediate:!0}),Re(window,"resize",n(()=>{if(s.value){const M=window.innerWidth,N=window.innerHeight,I=s.value.offsetWidth,V=s.value.offsetHeight,P=h.value.x,G=h.value.windowWidth-(h.value.x+I),D=h.value.y,B=h.value.windowHeight-(h.value.y+V),W=[{edge:"left",distance:P},{edge:"right",distance:G},{edge:"top",distance:D},{edge:"bottom",distance:B}].reduce((q,Q)=>Q.distance<q.distance?Q:q),H=h.value.y/h.value.windowHeight,U=h.value.x/h.value.windowWidth;W.edge==="left"?(c.value=W.distance,p.value=H*N):W.edge==="right"?(c.value=M-I-W.distance,p.value=H*N):W.edge==="top"?(c.value=U*M,p.value=W.distance):(c.value=U*M,p.value=N-V-W.distance),c.value=Ut(c.value,0,M-I),p.value=Ut(p.value,0,N-V)}},"adjustMenuPosition"));const S=R(!1),$=n(()=>{d.value&&(S.value=!0)},"onMouseEnterDropZone"),k=n(()=>{d.value&&(S.value=!1)},"onMouseLeaveDropZone");te(d,M=>{M?r.value&&(r.value=!1):(S.value&&(r.value=!0),S.value=!1)});const x=b(()=>de("w-[200px] border-dashed border-blue-500 opacity-80","m-1.5 flex items-center justify-center self-stretch","rounded-md before:w-50 before:-ml-50 before:h-full","pointer-events-auto",S.value&&"border-[3px] opacity-100 scale-105 shadow-[0_0_20px] shadow-blue-500")),_=b(()=>de("actionbar pointer-events-auto z1000",d.value&&"select-none pointer-events-none",r.value?"p-0 static mr-2 border-none bg-transparent":"fixed shadow-interface"));return(M,N)=>(m(),T("div",zd,[v(d)&&!v(r)?(m(),T("div",{key:0,class:J(x.value),onMouseenter:$,onMouseleave:k},z(v(Z)("actionbar.dockToTop")),35)):A("",!0),L(v(aa),{class:J(["pointer-events-auto z-1010",_.value]),style:pe(v(g)),pt:{header:{class:"hidden"},content:{class:v(r)?"p-0":"p-1"}}},{default:E(()=>[y("div",{ref_key:"panelRef",ref:s,class:"flex items-center select-none"},[y("span",{ref_key:"dragHandleRef",ref:i,class:J(v(de)("drag-handle cursor-grab w-3 h-max mr-2",v(d)&&"cursor-grabbing"))},null,2),L(v(Bd))],512)]),_:1},8,["style","class","pt"])]))}}),Ud=n((e,o)=>{const t=e?.type;return t?!o[t]:!1},"isNodeMissingDefinition"),Gd=n((e,o)=>{if(!e)return[];const t=v(o);return Ql(e,a=>Ud(a,t))},"collectMissingNodes"),Hd=n((e,o)=>Gd(e,o).length>0,"graphHasMissingNodes"),jd={key:0,class:"icon-[lucide--triangle-alert] text-warning-background"},qd={class:"p-breadcrumb-item-label px-2"},Kd={key:2,class:"pi pi-angle-down text-[10px]"},Qd=K({__name:"SubgraphBreadcrumbItem",props:{item:{},isActive:{type:Boolean,default:!1}},setup(e){const o=e,t=ut(),a=b(()=>Hd(j.graph,t.nodeDefsByName)),{t:l}=ce(),s=R(),i=it(),r=Me(),u=tt(),c=R(!1),p=R(),g=R(),d=R(),w=n(async(x,_)=>{if(x&&x!==_){if(o.item.updateTitle?.(x),r.activeSubgraph)r.activeSubgraph.name=x;else if(r.activeWorkflow)try{await u.renameWorkflow(r.activeWorkflow,da.basePath+pa(x))}catch(N){console.error(N),i.showErrorDialog(N);return}const M=Bn();M.restoreState(M.exportState())}},"rename"),h=o.item.key==="root",C=b(()=>a.value&&h?l("breadcrumbsMenu.missingNodesWarning"):o.item.label),f=b(()=>[{label:l("g.rename"),icon:"pi pi-pencil",command:$},{label:l("breadcrumbsMenu.duplicate"),icon:"pi pi-copy",command:n(async()=>{await u.duplicateWorkflow(r.activeWorkflow)},"command"),visible:h&&!o.item.isBlueprint},{separator:!0,visible:h},{label:l("menuLabels.Save"),icon:"pi pi-save",command:n(async()=>{await ke().execute("Comfy.SaveWorkflow")},"command"),visible:h},{label:l("menuLabels.Save As"),icon:"pi pi-save",command:n(async()=>{await ke().execute("Comfy.SaveWorkflowAs")},"command"),visible:h},{separator:!0},{label:l("breadcrumbsMenu.clearWorkflow"),icon:"pi pi-trash",command:n(async()=>{await ke().execute("Comfy.ClearWorkflow")},"command")},{separator:!0,visible:o.item.key==="root"&&o.item.isBlueprint},{label:l("subgraphStore.publish"),icon:"pi pi-copy",command:n(async()=>{await u.saveWorkflowAs(r.activeWorkflow)},"command"),visible:o.item.key==="root"&&o.item.isBlueprint},{separator:!0,visible:h},{label:o.item.isBlueprint?l("breadcrumbsMenu.deleteBlueprint"):l("breadcrumbsMenu.deleteWorkflow"),icon:"pi pi-times",command:n(async()=>{await u.deleteWorkflow(r.activeWorkflow)},"command"),visible:h}]),S=n(x=>{c.value||(x.detail===1?o.isActive?s.value?.toggle(x):o.item.command?.({item:o.item,originalEvent:x}):o.isActive&&x.detail===2&&(s.value?.hide(),x.stopPropagation(),x.preventDefault(),$()))},"handleClick"),$=n(()=>{c.value=!0,p.value=o.item.label,Le(()=>{g.value?.$el&&(g.value.$el.focus(),g.value.$el.select(),d.value&&(g.value.$el.style.width=`${Math.max(200,d.value.offsetWidth)}px`))})},"startRename"),k=n(async x=>{x&&await w(p.value,o.item.label),c.value=!1},"inputBlur");return(x,_)=>{const M=_e("tooltip");return m(),T(le,null,[ue((m(),T("a",{ref_key:"wrapperRef",ref:d,draggable:"false",href:"#",class:J(["p-breadcrumb-item-link h-12 cursor-pointer px-2",{"flex items-center gap-1":x.isActive,"p-breadcrumb-item-link-menu-visible":s.value?.overlayVisible,"p-breadcrumb-item-link-icon-visible":x.isActive,"active-breadcrumb-item":x.isActive}]),onClick:S},[a.value&&h?(m(),T("i",jd)):A("",!0),y("span",qd,z(x.item.label),1),x.item.isBlueprint?(m(),O(v(Ht),{key:1,value:"Blueprint",severity:"primary"})):A("",!0),x.isActive?(m(),T("i",Kd)):A("",!0)],2)),[[M,{value:C.value,showDelay:512},void 0,{bottom:!0}]]),x.isActive?(m(),O(v(la),{key:0,ref_key:"menu",ref:s,model:f.value,popup:!0,pt:{root:{style:"background-color: var(--comfy-menu-bg)"},itemLink:{class:"py-2"}}},null,8,["model"])):A("",!0),c.value?(m(),O(v(oa),{key:1,ref_key:"itemInputRef",ref:g,modelValue:p.value,"onUpdate:modelValue":_[0]||(_[0]=N=>p.value=N),class:"fixed z-10000 px-2 py-2 text-[.8rem]",onBlur:_[1]||(_[1]=N=>k(!1)),onClick:_[2]||(_[2]=Ne(()=>{},["stop"])),onKeydown:[_[3]||(_[3]=qt(N=>k(!0),["enter"])),_[4]||(_[4]=qt(N=>k(!1),["esc"]))]},null,8,["modelValue"])):A("",!0)],64)}}}),Jd=Se(Qd,[["__scopeId","data-v-baeb0b7a"]]),Wa=n((e,o)=>{o={debounceTime:25,useMutationObserver:!0,useResizeObserver:!0,...o};const t=R(!1),a=[],l=R(!1),s=n(()=>{t.value=e.scrollWidth>e.clientWidth,o.onCheck?.(t.value)},"checkOverflowFn"),i=o.debounceTime?qo(s,o.debounceTime):s;return o.useMutationObserver&&a.push(ml(e,i,{subtree:!0,childList:!0}).stop),o.useResizeObserver&&a.push(Us(e,i).stop),{isOverflowing:Oo(t),disposed:Oo(l),checkOverflow:i,dispose:n(()=>{l.value=!0,a.forEach(r=>r())},"dispose")}},"useOverflowObserver"),ks=28,Cs=8,fn=8,Ss=20,Yd=K({__name:"SubgraphBreadcrumb",setup(e){const o=Me(),t=Bn(),a=R(),l=b(()=>o.activeWorkflow?.filename),s=b(()=>fa().isSubgraphBlueprint(o.activeWorkflow)),i=R(!1),r=R(!1),u=b(()=>a.value?a.value.$el?.querySelector(".p-breadcrumb-list"):null),c=b(()=>{const d=t.navigationStack.map(w=>({label:w.name,command:n(()=>{const h=fe().getCanvas();if(!h.graph)throw new TypeError("Canvas has no graph");h.setGraph(w)},"command"),updateTitle:n(h=>{const C=fe().getCanvas().graph?.rootGraph;C&&Jl(C,w.id,f=>{f.title=h})},"updateTitle")}));return[p.value,...d]}),p=b(()=>({label:l.value,icon:"pi pi-home",key:"root",isBlueprint:s.value,command:n(()=>{const d=fe().getCanvas();if(!d.graph)throw new TypeError("Canvas has no graph");d.setGraph(d.graph.rootGraph)},"command")}));let g;return te(u,d=>{g?.dispose(),g=void 0,d&&(g=Wa(d,{onCheck:n(w=>{if(r.value=w,i.value){if(!w){const h=[...d.querySelectorAll(".p-breadcrumb-item")];if(h.length<3)return;const C=h.filter(I=>I.querySelector(".p-breadcrumb-item-link-icon-visible")).length,f=d.querySelectorAll(".p-breadcrumb-separator"),$=f[f.length-1].offsetWidth,k=(ks+fn+fn)*h.length+C*Ss,x=(h.length-1)*$,_=(h.length-1)*(Cs*2),M=k+x+_,N=d.clientWidth;M<=N&&(i.value=!1)}}else w&&(i.value=!0)},"onCheck")}))}),Gs(()=>{g?.disposed.value||g?.checkOverflow()}),(d,w)=>(m(),T("div",{class:J(["subgraph-breadcrumb w-auto drop-shadow-[var(--interface-panel-drop-shadow)]",{"subgraph-breadcrumb-collapse":i.value,"subgraph-breadcrumb-overflow":r.value}]),style:pe({"--p-breadcrumb-gap":"0px","--p-breadcrumb-item-margin":`${Cs/2}px`,"--p-breadcrumb-item-min-width":`${ks}px`,"--p-breadcrumb-item-padding":`${fn}px`,"--p-breadcrumb-icon-width":`${Ss}px`})},[L(v(Rl),{ref_key:"breadcrumbRef",ref:a,class:"w-fit rounded-lg p-0",model:c.value,pt:{item:{class:"pointer-events-auto"}},"aria-label":d.$t("g.graphNavigation")},{item:E(({item:h})=>[L(Jd,{item:h,"is-active":h===c.value.at(-1)},null,8,["item","is-active"])]),separator:E(()=>w[0]||(w[0]=[y("span",{style:{transform:"scale(1.5)"}}," / ",-1)])),_:1},8,["model","aria-label"])],6))}}),Zd=Se(Yd,[["__scopeId","data-v-0e6867de"]]),dt=n(e=>({value:e,showDelay:300,hideDelay:0,pt:{text:{class:"border-node-component-tooltip-border bg-node-component-tooltip-surface text-node-component-tooltip border rounded-md px-2 py-1 text-xs leading-none shadow-none"},arrow:{class:"border-t-node-component-tooltip-border"}}}),"buildTooltipConfig"),Xd={class:"flex flex-col gap-3 p-2"},ep={class:"flex flex-col gap-1"},tp={class:"relative h-2 w-full overflow-hidden rounded-full border border-interface-stroke bg-interface-panel-surface"},op={class:"flex items-start justify-end gap-4 text-[12px] leading-none"},np={class:"flex items-center gap-1 text-text-primary opacity-90"},sp={class:"font-bold"},ap={class:"flex items-center gap-1 text-text-secondary"},lp={class:"inline-block max-w-[10rem] truncate"},ip={class:"flex items-center gap-1"},rp={class:"flex items-center gap-4 text-[12px] text-text-primary"},up={class:"flex items-center gap-2"},cp={class:"opacity-90"},dp={class:"font-bold"},pp={class:"ml-1"},fp={class:"flex items-center gap-2"},mp={class:"opacity-90"},vp={class:"font-bold"},gp={class:"ml-1"},hp=K({__name:"QueueOverlayActive",props:{totalProgressStyle:{},currentNodeProgressStyle:{},totalPercentFormatted:{},currentNodePercentFormatted:{},currentNodeName:{},runningCount:{},queuedCount:{},bottomRowClass:{}},emits:["interruptAll","clearQueued","viewAllJobs"],setup(e){const{t:o}=ce(),t=b(()=>dt(o("sideToolbar.queueProgressOverlay.cancelJobTooltip"))),a=b(()=>dt(o("sideToolbar.queueProgressOverlay.clearQueueTooltip")));return(l,s)=>{const i=Hs("i18n-t"),r=_e("tooltip");return m(),T("div",Xd,[y("div",ep,[y("div",tp,[y("div",{class:"absolute inset-0 h-full rounded-full transition-[width]",style:pe(l.totalProgressStyle)},null,4),y("div",{class:"absolute inset-0 h-full rounded-full transition-[width]",style:pe(l.currentNodeProgressStyle)},null,4)]),y("div",op,[y("div",np,[L(i,{keypath:"sideToolbar.queueProgressOverlay.total"},{percent:E(()=>[y("span",sp,z(l.totalPercentFormatted),1)]),_:1})]),y("div",ap,[y("span",null,z(v(o)("sideToolbar.queueProgressOverlay.currentNode")),1),y("span",lp,z(l.currentNodeName),1),y("span",ip,[y("span",null,z(l.currentNodePercentFormatted),1)])])])]),y("div",{class:J(l.bottomRowClass)},[y("div",rp,[y("div",up,[y("span",cp,[y("span",dp,z(l.runningCount),1),y("span",pp,z(v(o)("sideToolbar.queueProgressOverlay.running")),1)]),l.runningCount>0?ue((m(),O(Ee,{key:0,type:"secondary",size:"sm",class:"size-6 bg-destructive-background hover:bg-destructive-background-hover","aria-label":v(o)("sideToolbar.queueProgressOverlay.interruptAll"),onClick:s[0]||(s[0]=u=>l.$emit("interruptAll"))},{default:E(()=>s[3]||(s[3]=[y("i",{class:"icon-[lucide--x] block size-4 leading-none text-text-primary"},null,-1)])),_:1},8,["aria-label"])),[[r,t.value,void 0,{top:!0}]]):A("",!0)]),y("div",fp,[y("span",mp,[y("span",vp,z(l.queuedCount),1),y("span",gp,z(v(o)("sideToolbar.queueProgressOverlay.queuedSuffix")),1)]),l.queuedCount>0?ue((m(),O(Ee,{key:0,type:"secondary",size:"sm",class:"size-6 bg-secondary-background hover:bg-destructive-background","aria-label":v(o)("sideToolbar.queueProgressOverlay.clearQueued"),onClick:s[1]||(s[1]=u=>l.$emit("clearQueued"))},{default:E(()=>s[4]||(s[4]=[y("i",{class:"icon-[lucide--list-x] block size-4 leading-none text-text-primary"},null,-1)])),_:1},8,["aria-label"])),[[r,a.value,void 0,{top:!0}]]):A("",!0)])]),L(bt,{class:"h-6 min-w-[120px] flex-1 px-2 py-0 text-[12px]",type:"secondary",label:v(o)("sideToolbar.queueProgressOverlay.viewAllJobs"),onClick:s[2]||(s[2]=u=>l.$emit("viewAllJobs"))},null,8,["label"])],2)])}}}),yp={class:"inline-flex items-center gap-2"},bp={key:0,class:"inline-flex items-center"},wp={class:"inline-flex items-center gap-2"},kp={key:0,class:"relative inline-flex h-6 items-center"},Cp=["src","alt"],Sp={class:"text-[14px] font-normal text-text-primary"},xp={class:"font-bold"},$p={class:"font-bold"},_p={class:"font-bold"},Tp={class:"font-bold"},Np=K({__name:"CompletionSummaryBanner",props:{mode:{},completedCount:{},failedCount:{},thumbnailUrls:{default:n(()=>[],"default")},ariaLabel:{}},emits:["click"],setup(e,{emit:o}){const t=e,a=o;return(l,s)=>{const i=Hs("i18n-t");return m(),O(Ee,{type:"secondary",size:"fit-content",class:"group w-full justify-between gap-3 rounded-lg p-1 text-left font-normal hover:cursor-pointer focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-background","aria-label":t.ariaLabel,onClick:s[0]||(s[0]=r=>a("click",r))},{default:E(()=>[y("span",yp,[t.mode==="allFailed"?(m(),T("span",bp,[y("i",{class:J(["ml-1 icon-[lucide--circle-alert] block size-4 leading-none","text-destructive-background"])})])):A("",!0),y("span",wp,[t.mode!=="allFailed"?(m(),T("span",kp,[(m(!0),T(le,null,we(t.thumbnailUrls,(r,u)=>(m(),T("span",{key:r+u,class:"inline-block h-6 w-6 overflow-hidden rounded-[6px] border-0 bg-secondary-background",style:pe({marginLeft:u===0?"0":"-12px"})},[y("img",{src:r,alt:l.$t("sideToolbar.queueProgressOverlay.preview"),class:"h-full w-full object-cover"},null,8,Cp)],4))),128))])):A("",!0),y("span",Sp,[t.mode==="allSuccess"?(m(),O(i,{key:0,keypath:"sideToolbar.queueProgressOverlay.jobsCompleted",plural:t.completedCount},{count:E(()=>[y("span",xp,z(t.completedCount),1)]),_:1},8,["plural"])):t.mode==="mixed"?(m(),T(le,{key:1},[L(i,{keypath:"sideToolbar.queueProgressOverlay.jobsCompleted",plural:t.completedCount},{count:E(()=>[y("span",$p,z(t.completedCount),1)]),_:1},8,["plural"]),s[1]||(s[1]=y("span",null,", ",-1)),L(i,{keypath:"sideToolbar.queueProgressOverlay.jobsFailed",plural:t.failedCount},{count:E(()=>[y("span",_p,z(t.failedCount),1)]),_:1},8,["plural"])],64)):(m(),O(i,{key:2,keypath:"sideToolbar.queueProgressOverlay.jobsFailed",plural:t.failedCount},{count:E(()=>[y("span",Tp,z(t.failedCount),1)]),_:1},8,["plural"]))])])]),s[2]||(s[2]=y("span",{class:"flex items-center justify-center rounded p-1 text-text-secondary transition-colors duration-200 ease-in-out"},[y("i",{class:"icon-[lucide--chevron-down] block size-4 leading-none"})],-1))]),_:1},8,["aria-label"])}}}),Mp={class:"pointer-events-auto"},Ip=K({__name:"QueueOverlayEmpty",props:{summary:{}},emits:["summaryClick"],setup(e){const{t:o}=ce();return(t,a)=>(m(),T("div",Mp,[L(Np,{mode:t.summary.mode,"completed-count":t.summary.completedCount,"failed-count":t.summary.failedCount,"thumbnail-urls":t.summary.thumbnailUrls,"aria-label":v(o)("sideToolbar.queueProgressOverlay.expandCollapsedQueue"),onClick:a[0]||(a[0]=l=>t.$emit("summaryClick"))},null,8,["mode","completed-count","failed-count","thumbnail-urls","aria-label"])]))}});function Pp(e,o){const t=Me(),a=tt(),l=xt(),{copyToClipboard:s}=ma(),i=yo(),r=ut(),u=Yl(),c=n(async()=>{const I=e();if(!I)return;const V=I.taskRef?.workflow;if(!V)return;const P=`Job ${I.id}.json`,G=t.createTemporary(P,V);await a.openWorkflow(G)},"openJobWorkflow"),p=n(async()=>{const I=e();I&&await s(I.id)},"copyJobId"),g=n(async()=>{const I=e();I&&(I.state==="running"||I.state==="initialization"?await he.interrupt(I.id):I.state==="pending"&&await he.deleteItem("queue",I.id),await l.update())},"cancelJob"),d=n(async()=>{const I=e();if(!I)return;const G=I.taskRef?.status?.messages?.find(D=>D?.[0]==="execution_error")?.[1]?.exception_message;G&&await s(String(G))},"copyErrorMessage"),w=n(()=>{const I=e();if(!I)return;const P=I.taskRef?.status?.messages?.find(G=>G?.[0]==="execution_error")?.[1];P&&it().showExecutionErrorDialog(P)},"reportError"),h=n(async()=>{const I=e();if(!I)return;const V=I.taskRef?.previewOutput;if(!V)return;let P=null,G=null;if(V.isImage?(P="LoadImage",G="image"):V.isVideo?(P="LoadVideo",G="file"):V.isAudio&&(P="LoadAudio",G="audio"),!P||!G)return;const D=r.nodeDefsByName[P];if(!D)return;const B=i.addNodeOnGraph(D,{pos:i.getCanvasCenter()});if(!B)return;const F=n(q=>q==="input"||q==="output"||q==="temp","isResultItemType"),W={filename:V.filename,subfolder:V.subfolder,type:F(V.type)?V.type:void 0},H=Zl(W,{rootFolder:W.type}),U=B.widgets?.find(q=>q.name===G);U&&(U.value=H,U.callback?.(H)),B.graph?.setDirtyCanvas(!0,!0)},"addOutputLoaderNode"),C=n(()=>{const I=e();if(!I)return;const V=I.taskRef?.previewOutput;V&&Jo(V.url)},"downloadPreviewAsset"),f=n(async()=>{const I=e();if(!I)return;const V=I.taskRef?.workflow;if(!V)return;const P=ne();let G=`Job ${I.id}.json`;if(P.get("Comfy.PromptFilename")){const F=await it().prompt({title:Z("workflowService.exportWorkflow"),message:Z("workflowService.enterFilename")+":",defaultValue:G});if(!F)return;G=pa(F)}const D=JSON.stringify(V,null,2),B=new Blob([D],{type:"application/json"});Xl(G,B)},"exportJobWorkflow"),S=n(async()=>{const I=e();if(!I)return;const V=I.taskRef,P=V?.previewOutput;if(!V||!P)return;const G=ei(V,P);await u.confirmDelete(G)&&await l.update()},"deleteJobAsset"),$=n(async()=>{const I=e()?.taskRef;I&&await l.delete(I)},"removeFailedJob"),k=b(()=>ye("queue.jobMenu.openAsWorkflowNewTab","Open as workflow in new tab")),x=b(()=>ye("queue.jobMenu.openWorkflowNewTab","Open workflow in new tab")),_=b(()=>ye("queue.jobMenu.copyJobId","Copy job ID")),M=b(()=>ye("queue.jobMenu.cancelJob","Cancel job"));return{jobMenuEntries:b(()=>{const I=e(),V=I?.state;if(!V)return[];const P=!!I?.taskRef?.previewOutput;return V==="completed"?[{key:"inspect-asset",label:ye("queue.jobMenu.inspectAsset","Inspect asset"),icon:"icon-[lucide--zoom-in]",onClick:o?()=>{const G=e();G&&o(G)}:void 0},{key:"add-to-current",label:ye("queue.jobMenu.addToCurrentWorkflow","Add to current workflow"),icon:"icon-[comfy--node]",onClick:h},{key:"download",label:ye("queue.jobMenu.download","Download"),icon:"icon-[lucide--download]",onClick:C},{kind:"divider",key:"d1"},{key:"open-workflow",label:k.value,icon:"icon-[comfy--workflow]",onClick:c},{key:"export-workflow",label:ye("queue.jobMenu.exportWorkflow","Export workflow"),icon:"icon-[comfy--file-output]",onClick:f},{kind:"divider",key:"d2"},{key:"copy-id",label:_.value,icon:"icon-[lucide--copy]",onClick:p},{kind:"divider",key:"d3"},...P?[{key:"delete",label:ye("queue.jobMenu.deleteAsset","Delete asset"),icon:"icon-[lucide--trash-2]",onClick:S}]:[]]:V==="failed"?[{key:"open-workflow",label:x.value,icon:"icon-[comfy--workflow]",onClick:c},{kind:"divider",key:"d1"},{key:"copy-id",label:_.value,icon:"icon-[lucide--copy]",onClick:p},{key:"copy-error",label:ye("queue.jobMenu.copyErrorMessage","Copy error message"),icon:"icon-[lucide--copy]",onClick:d},{key:"report-error",label:ye("queue.jobMenu.reportError","Report error"),icon:"icon-[lucide--message-circle-warning]",onClick:w},{kind:"divider",key:"d2"},{key:"delete",label:ye("queue.jobMenu.removeJob","Remove job"),icon:"icon-[lucide--circle-minus]",onClick:$}]:[{key:"open-workflow",label:k.value,icon:"icon-[comfy--workflow]",onClick:c},{kind:"divider",key:"d1"},{key:"copy-id",label:_.value,icon:"icon-[lucide--copy]",onClick:p},{kind:"divider",key:"d2"},{key:"cancel-job",label:M.value,icon:"icon-[lucide--x]",onClick:g}]}),openJobWorkflow:c,copyJobId:p,cancelJob:g}}n(Pp,"useJobMenu");const Rp={class:"flex h-12 items-center justify-between gap-2 border-b border-interface-stroke px-2"},Dp={class:"px-2 text-[14px] font-normal text-text-primary"},Ap={key:0,class:"ml-4 inline-flex items-center gap-1 text-blue-100"},Lp={class:"font-bold"},Ep={class:"ml-1"},Vp={class:"flex items-center gap-1"},Wp={class:"flex flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3 font-inter"},Op=K({__name:"QueueOverlayHeader",props:{headerTitle:{},showConcurrentIndicator:{type:Boolean},concurrentWorkflowCount:{}},emits:["clearHistory"],setup(e,{emit:o}){const t=o,{t:a}=ce(),l=R(null),s=b(()=>dt(a("g.more"))),i=n(u=>{l.value?.toggle(u)},"onMoreClick"),r=n(()=>{l.value?.hide(),t("clearHistory")},"onClearHistoryFromMenu");return(u,c)=>{const p=_e("tooltip");return m(),T("div",Rp,[y("div",Dp,[y("span",null,z(u.headerTitle),1),u.showConcurrentIndicator?(m(),T("span",Ap,[c[0]||(c[0]=y("span",{class:"inline-block size-2 rounded-full bg-blue-100"},null,-1)),y("span",null,[y("span",Lp,z(u.concurrentWorkflowCount),1),y("span",Ep,z(v(a)("sideToolbar.queueProgressOverlay.running")),1)])])):A("",!0)]),y("div",Vp,[ue((m(),O(Ee,{type:"transparent",size:"sm",class:"size-6 bg-transparent hover:bg-secondary-background hover:opacity-100","aria-label":v(a)("sideToolbar.queueProgressOverlay.moreOptions"),onClick:i},{default:E(()=>c[1]||(c[1]=[y("i",{class:"icon-[lucide--more-horizontal] block size-4 leading-none text-text-secondary"},null,-1)])),_:1},8,["aria-label"])),[[p,s.value,void 0,{top:!0}]]),L(v(et),{ref_key:"morePopoverRef",ref:l,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:E(()=>[y("div",Wp,[L(Fe,{class:"w-full justify-start gap-2 bg-transparent p-2 font-inter text-[12px] leading-none text-text-primary hover:bg-transparent hover:opacity-90",type:"transparent",label:v(a)("sideToolbar.queueProgressOverlay.clearHistory"),"aria-label":v(a)("sideToolbar.queueProgressOverlay.clearHistory"),onClick:r},{icon:E(()=>c[2]||(c[2]=[y("i",{class:"icon-[lucide--file-x-2] block size-4 leading-none text-text-secondary"},null,-1)])),_:1},8,["label","aria-label"])])]),_:1},512)])])}}}),Bp={class:"flex min-w-[14rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3 font-inter"},zp={key:0,class:"px-2 py-1"},Fp=K({__name:"JobContextMenu",props:{entries:{}},emits:["action"],setup(e,{expose:o,emit:t}){const a=t,l=R(null);function s(u){l.value&&l.value.toggle(u)}n(s,"open");function i(){l.value?.hide()}n(i,"hide");function r(u){a("action",u)}return n(r,"onEntry"),o({open:s,hide:i}),(u,c)=>(m(),O(v(et),{ref_key:"jobItemPopoverRef",ref:l,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:E(()=>[y("div",Bp,[(m(!0),T(le,null,we(u.entries,p=>(m(),T(le,{key:p.key},[p.kind==="divider"?(m(),T("div",zp,c[0]||(c[0]=[y("div",{class:"h-px bg-interface-stroke"},null,-1)]))):(m(),O(Fe,{key:1,class:"w-full justify-start gap-2 bg-transparent p-2 font-inter text-[12px] leading-none text-text-primary hover:bg-interface-panel-hover-surface",type:"transparent",label:p.label,"aria-label":p.label,onClick:n(g=>r(p),"onClick")},{icon:E(()=>[p.icon?(m(),T("i",{key:0,class:J([p.icon,"block size-4 shrink-0 leading-none text-text-secondary"])},null,2)):A("",!0)]),_:2},1032,["label","aria-label","onClick"]))],64))),128))])]),_:1},512))}}),mo=n(e=>{const o=Math.round(e??0);return vl(o,0,100)},"clampPercentInt"),Ho=n((e,o)=>{const t=mo(o);return new Intl.NumberFormat(e,{style:"percent",maximumFractionDigits:0}).format((t||0)/100)},"formatPercent0");function Oa(){const{locale:e}=ce(),o=Je(),t=b(()=>mo(Math.round((o.executionProgress??0)*100))),a=b(()=>Ho(e.value,t.value)),l=b(()=>mo(Math.round((o.executingNodeProgress??0)*100))),s=b(()=>Ho(e.value,l.value)),i=b(()=>({width:`${t.value}%`,background:"var(--color-interface-panel-job-progress-primary)"})),r=b(()=>({width:`${l.value}%`,background:"var(--color-interface-panel-job-progress-secondary)"}));return{totalPercent:t,totalPercentFormatted:a,currentNodePercent:l,currentNodePercentFormatted:s,totalProgressStyle:i,currentNodeProgressStyle:r}}n(Oa,"useQueueProgress");const Up=n(e=>{const o=new Date(e),t=o.getFullYear(),a=String(o.getMonth()+1).padStart(2,"0"),l=String(o.getDate()).padStart(2,"0");return`${t}-${a}-${l}`},"dateKey"),Gp=n(e=>{const o=new Date(e),t=new Date;return o.getFullYear()===t.getFullYear()&&o.getMonth()===t.getMonth()&&o.getDate()===t.getDate()},"isToday"),Hp=n(e=>{const o=new Date(e),t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1);return o.getFullYear()===a.getFullYear()&&o.getMonth()===a.getMonth()&&o.getDate()===a.getDate()},"isYesterday"),jp=n((e,o)=>{const t=new Date(e);return new Intl.DateTimeFormat(o,{month:"short",day:"numeric"}).format(t)},"formatShortMonthDay"),kn=n((e,o)=>{const t=new Date(e);return new Intl.DateTimeFormat(o,{hour:"numeric",minute:"2-digit",second:"2-digit"}).format(t)},"formatClockTime"),gt=n(e=>{switch(e){case"pending":return"icon-[lucide--loader-circle]";case"initialization":return"icon-[lucide--server-crash]";case"running":return"icon-[lucide--zap]";case"completed":return"icon-[lucide--check-check]";case"failed":return"icon-[lucide--alert-circle]";default:return"icon-[lucide--circle]"}},"iconForJobState"),xs=n((e,o)=>{const t=o("g.job"),a=String(e.promptId??"").split("-")[0],l=e.queueIndex;return typeof l=="number"?`${t} #${l}`:a?`${t} ${a}`:t},"buildTitle"),mn=n((e,o,t)=>{const a=e.createTime;return a!==void 0?t(a,o):""},"buildQueuedTime"),qp=n((e,o,t)=>{if(o==="pending")return t.showAddedHint?{iconName:"icon-[lucide--check]",primary:t.t("queue.jobAddedToQueue"),secondary:mn(e,t.locale,t.formatClockTimeFn),showClear:!0}:{iconName:gt(o),primary:t.t("queue.inQueue"),secondary:mn(e,t.locale,t.formatClockTimeFn),showClear:!0};if(o==="initialization")return{iconName:gt(o),primary:t.t("queue.initializingAlmostReady"),secondary:mn(e,t.locale,t.formatClockTimeFn),showClear:!0};if(o==="running"){if(t.isActive){const a=Ho(t.locale,mo(t.totalPercent)),l=Ho(t.locale,mo(t.currentNodePercent)),s=t.t("sideToolbar.queueProgressOverlay.total",{percent:a}),i=t.currentNodeName?`${t.currentNodeName} ${t.t("sideToolbar.queueProgressOverlay.colonPercent",{percent:l})}`:"";return{iconName:gt(o),primary:s,secondary:i,showClear:!0}}return{iconName:gt(o),primary:t.t("g.running"),secondary:"",showClear:!0}}if(o==="completed"){const a=e.executionTimeInSeconds,l=e.previewOutput,s=l&&l.isImage?l.url:void 0;return{iconName:gt(o),iconImageUrl:s,primary:l?.filename&&l.filename.length?l.filename:xs(e,t.t),secondary:a!==void 0?`${a.toFixed(2)}s`:"",showClear:!1}}return o==="failed"?{iconName:gt(o),primary:t.t("g.failed"),secondary:t.t("g.failed"),showClear:!0}:{iconName:gt(o),primary:xs(e,t.t),secondary:"",showClear:!0}},"buildJobDisplay"),Qn=n((e,o)=>{if(o)return"initialization";switch(e.displayStatus){case"Running":return"running";case"Pending":return"pending";case"Completed":return"completed";case"Failed":case"Cancelled":return"failed"}return"failed"},"jobStateFromTask"),$s=["All","Completed","Failed"],_s=["mostRecent","totalGenerationTime"],Kp=3e3,Ts=new Map,Ns=n(e=>{if(e==null)return null;const o=String(e);return o.length?o:null},"taskIdToKey"),Qp=n((e,o,t)=>{const a=n(l=>{const s=t.format(l,"day");return s&&s[0].toLocaleUpperCase(o)+s.slice(1)},"formatRelativeDay");return Gp(e)?a(0):Hp(e)?a(-1):jp(e,o)},"dateLabelForTimestamp");function Jp(){const{t:e,locale:o}=ce(),t=xt(),a=Je(),l=Me(),s=R(new Set),i=R(new Set),r=new Map,u=n(D=>{const B=r.get(D);B!==void 0&&(clearTimeout(B),r.delete(D))},"clearAddedHintTimeout"),c=n(D=>{u(D);const B=setTimeout(()=>{r.delete(D);const F=new Set(i.value);F.delete(D)&&(i.value=F)},Kp);r.set(D,B)},"scheduleAddedHintExpiry");te(()=>t.pendingTasks.map(D=>Ns(D.promptId)).filter(D=>!!D),D=>{const B=new Set(D),F=new Set(i.value),W=new Set(s.value);D.forEach(H=>{W.has(H)||(W.add(H),F.add(H),c(H))});for(const H of Array.from(W))B.has(H)||(W.delete(H),F.delete(H),u(H));i.value=F,s.value=W},{immediate:!0});const p=n((D,B)=>{if(B!=="pending")return!1;const F=Ns(D.promptId);return F?i.value.has(F):!1},"shouldShowAddedHint");rt(()=>{r.forEach(D=>clearTimeout(D)),r.clear(),s.value=new Set,i.value=new Set});const{totalPercent:g,currentNodePercent:d}=Oa(),w=b(()=>{const D=o.value;let B=Ts.get(D);return B||(B=new Intl.RelativeTimeFormat(D,{numeric:"auto"}),Ts.set(D,B)),B}),h=b(()=>e("queue.jobList.undated")||"Undated"),C=n(D=>a.isPromptInitializing(D),"isJobInitializing"),f=b(()=>{const D=a.executingNode;if(!D)return e("g.emDash");const B=(D.title??"").toString().trim();if(B)return B;const F=(D.type??"").toString().trim()||e("g.untitled"),W=`nodeDefs.${Oe(F)}.display_name`;return ye(W,F)}),S=R("All"),$=R("all"),k=R("mostRecent"),x=b(()=>[...t.pendingTasks,...t.runningTasks,...t.historyTasks].sort((B,F)=>F.queueIndex-B.queueIndex)),_=b(()=>x.value.map(D=>({task:D,state:Qn(D,C(D?.promptId))}))),M=b(()=>_.value.some(({state:D})=>D==="failed"));te(()=>M.value,D=>{!D&&S.value==="Failed"&&(S.value="All")});const N=b(()=>{let D=_.value;if(S.value==="Completed"?D=D.filter(({state:B})=>B==="completed"):S.value==="Failed"&&(D=D.filter(({state:B})=>B==="failed")),$.value==="current"){const B=l.activeWorkflow?.activeState?.id;if(!B)return[];D=D.filter(({task:F})=>{const W=F.workflow?.id;return!!W&&W===B})}return D}),I=b(()=>N.value.map(({task:D})=>D)),V=b(()=>N.value.map(({task:D,state:B})=>{const F=String(D.promptId??"")===String(a.activePromptId??""),W=p(D,B),H=qp(D,B,{t:e,locale:o.value,formatClockTimeFn:kn,isActive:F,totalPercent:F?g.value:void 0,currentNodePercent:F?d.value:void 0,currentNodeName:F?f.value:void 0,showAddedHint:W});return{id:String(D.promptId),title:H.primary,meta:H.secondary,state:B,iconName:H.iconName,iconImageUrl:H.iconImageUrl,showClear:H.showClear,taskRef:D,progressTotalPercent:B==="running"&&F?g.value:void 0,progressCurrentPercent:B==="running"&&F?d.value:void 0,runningNodeName:B==="running"&&F?f.value:void 0,executionTimeMs:D.executionTime,computeHours:D.executionTime!==void 0?D.executionTime/36e5:void 0}})),P=b(()=>{const D=new Map;return V.value.forEach(B=>D.set(B.id,B)),D}),G=b(()=>{const D=[],B=new Map,F=o.value;for(const{task:W,state:H}of N.value){let U;H==="completed"||H==="failed"?U=W.executionEndTimestamp:U=W.createTime;const q=U===void 0?"undated":Up(U);let Q=B.get(q);if(Q===void 0){const Y=U===void 0?h.value:Qp(U,F,w.value);D.push({key:q,label:Y,items:[]}),Q=D.length-1,B.set(q,Q)}const me=P.value.get(String(W.promptId));me&&D[Q].items.push(me)}if(k.value==="totalGenerationTime"){const W=n(U=>typeof U=="number"&&!Number.isNaN(U)?U:-1,"valueOrDefault"),H=n((U,q)=>W(q.executionTimeMs)-W(U.executionTimeMs),"sortByExecutionTimeDesc");D.forEach(U=>{U.items.sort(H)})}return D});return{selectedJobTab:S,selectedWorkflowFilter:$,selectedSortMode:k,hasFailedJobs:M,allTasksSorted:x,filteredTasks:I,jobItems:V,groupedJobItems:G,currentNodeName:f}}n(Jp,"useJobList");const Yp={class:"flex items-center justify-between gap-2 px-3"},Zp={class:"min-w-0 flex-1 overflow-x-auto"},Xp={class:"inline-flex items-center gap-1 whitespace-nowrap"},ef={class:"ml-2 flex shrink-0 items-center gap-2"},tf={key:0,class:"pointer-events-none absolute -top-1 -right-1 inline-block size-2 rounded-full bg-base-foreground"},of={class:"flex min-w-[12rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3"},nf={key:0,class:"icon-[lucide--check] block size-4 leading-none text-text-secondary"},sf={key:0,class:"icon-[lucide--check] block size-4 leading-none text-text-secondary"},af={key:0,class:"pointer-events-none absolute -top-1 -right-1 inline-block size-2 rounded-full bg-base-foreground"},lf={class:"flex min-w-[12rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3"},rf={key:0,class:"icon-[lucide--check] block size-4 leading-none text-text-secondary"},uf={key:0,class:"mx-2 mt-1 h-px"},cf=K({__name:"JobFiltersBar",props:{selectedJobTab:{},selectedWorkflowFilter:{},selectedSortMode:{},hasFailedJobs:{type:Boolean}},emits:["update:selectedJobTab","update:selectedWorkflowFilter","update:selectedSortMode"],setup(e,{emit:o}){const t=e,a=o,{t:l}=ce(),s=R(null),i=R(null),r=b(()=>dt(l("sideToolbar.queueProgressOverlay.filterBy"))),u=b(()=>dt(l("sideToolbar.queueProgressOverlay.sortBy"))),c=b(()=>t.hasFailedJobs?$s:$s.filter(f=>f!=="Failed")),p=n(f=>{s.value&&s.value.toggle(f)},"onFilterClick"),g=n(f=>{s.value?.hide?.(),a("update:selectedWorkflowFilter",f)},"selectWorkflowFilter"),d=n(f=>{i.value&&i.value.toggle(f)},"onSortClick"),w=n(f=>{i.value?.hide?.(),a("update:selectedSortMode",f)},"selectSortMode"),h=n(f=>l(f==="All"?"g.all":f==="Completed"?"g.completed":"g.failed"),"tabLabel"),C=n(f=>f==="mostRecent"?l("queue.jobList.sortMostRecent"):f==="totalGenerationTime"?l("queue.jobList.sortTotalGenerationTime"):"","sortLabel");return(f,S)=>{const $=_e("tooltip");return m(),T("div",Yp,[y("div",Zp,[y("div",Xp,[(m(!0),T(le,null,we(c.value,k=>(m(),O(bt,{key:k,class:J(["h-6 px-3 py-1 text-[12px] leading-none hover:opacity-90",[f.selectedJobTab===k?"text-text-primary":"text-text-secondary"]]),type:f.selectedJobTab===k?"secondary":"transparent",label:h(k),onClick:n(x=>f.$emit("update:selectedJobTab",k),"onClick")},null,8,["type","class","label","onClick"]))),128))])]),y("div",ef,[ue((m(),O(Ee,{key:0,type:"secondary",size:"sm",class:"relative size-6 bg-secondary-background hover:bg-secondary-background-hover hover:opacity-90","aria-label":v(l)("sideToolbar.queueProgressOverlay.filterJobs"),onClick:p},{default:E(()=>[S[2]||(S[2]=y("i",{class:"icon-[lucide--list-filter] block size-4 leading-none text-text-primary"},null,-1)),f.selectedWorkflowFilter!=="all"?(m(),T("span",tf)):A("",!0)]),_:1},8,["aria-label"])),[[$,r.value,void 0,{top:!0}]]),(m(),O(v(et),{key:1,ref_key:"filterPopoverRef",ref:s,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:E(()=>[y("div",of,[L(Fe,{class:"w-full justify-between gap-1 bg-transparent p-2 font-inter text-[12px] leading-none text-text-primary hover:bg-transparent hover:opacity-90",type:"transparent","icon-position":"right",label:v(l)("sideToolbar.queueProgressOverlay.filterAllWorkflows"),"aria-label":v(l)("sideToolbar.queueProgressOverlay.filterAllWorkflows"),onClick:S[0]||(S[0]=k=>g("all"))},{icon:E(()=>[f.selectedWorkflowFilter==="all"?(m(),T("i",nf)):A("",!0)]),_:1},8,["label","aria-label"]),S[3]||(S[3]=y("div",{class:"mx-2 mt-1 h-px"},null,-1)),L(Fe,{class:"w-full justify-between gap-1 bg-transparent p-2 font-inter text-[12px] leading-none text-text-primary hover:bg-transparent hover:opacity-90",type:"transparent","icon-position":"right",label:v(l)("sideToolbar.queueProgressOverlay.filterCurrentWorkflow"),"aria-label":v(l)("sideToolbar.queueProgressOverlay.filterCurrentWorkflow"),onClick:S[1]||(S[1]=k=>g("current"))},{icon:E(()=>[f.selectedWorkflowFilter==="current"?(m(),T("i",sf)):A("",!0)]),_:1},8,["label","aria-label"])])]),_:1},512)),ue((m(),O(Ee,{type:"secondary",size:"sm",class:"relative size-6 bg-secondary-background hover:bg-secondary-background-hover hover:opacity-90","aria-label":v(l)("sideToolbar.queueProgressOverlay.sortJobs"),onClick:d},{default:E(()=>[S[4]||(S[4]=y("i",{class:"icon-[lucide--arrow-up-down] block size-4 leading-none text-text-primary"},null,-1)),f.selectedSortMode!=="mostRecent"?(m(),T("span",af)):A("",!0)]),_:1},8,["aria-label"])),[[$,u.value,void 0,{top:!0}]]),L(v(et),{ref_key:"sortPopoverRef",ref:i,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:E(()=>[y("div",lf,[(m(!0),T(le,null,we(v(_s),(k,x)=>(m(),T(le,{key:k},[L(Fe,{class:"w-full justify-between gap-1 bg-transparent p-2 font-inter text-[12px] leading-none text-text-primary hover:bg-transparent hover:opacity-90",type:"transparent","icon-position":"right",label:C(k),"aria-label":C(k),onClick:n(_=>w(k),"onClick")},{icon:E(()=>[f.selectedSortMode===k?(m(),T("i",rf)):A("",!0)]),_:2},1032,["label","aria-label","onClick"]),x<v(_s).length-1?(m(),T("div",uf)):A("",!0)],64))),128))])]),_:1},512)])])}}}),Ms=n(e=>{const t=e?.status?.messages;if(!Array.isArray(t)||!t.length)return null;const a=t.find(i=>Array.isArray(i)&&i[0]==="execution_error");if(!a)return null;const l=a[1],s=String(l?.exception_message??"");return{detail:l,message:s}},"extractExecutionError"),df=n(({taskForJob:e,copyToClipboard:o,dialog:t})=>{const a=b(()=>Ms(e.value)?.message??"");return{errorMessageValue:a,copyErrorMessage:n(()=>{a.value&&o(a.value)},"copyErrorMessage"),reportJobError:n(()=>{const i=Ms(e.value);if(i?.detail){t.showExecutionErrorDialog(i.detail);return}a.value&&t.showErrorDialog(new Error(a.value),{reportType:"queueJobError"})},"reportJobError")}},"useJobErrorReporting"),Cn=n(e=>{const o=Math.max(0,Math.floor(e/1e3)),t=Math.floor(o/60),a=o%60;return`${t}m ${a}s`},"formatElapsedTime"),pf=n(e=>e.historyTasks.map(o=>Number(o.executionTimeInSeconds)).filter(o=>typeof o=="number"&&!Number.isNaN(o)),"pickRecentDurations"),ff=n(({queueStore:e,executionStore:o,taskForJob:t,jobState:a,firstSeenTs:l,jobsAhead:s,nowTs:i})=>{const r=b(()=>o.runningWorkflowCount),u=b(()=>a.value==="pending"&&!!l.value&&(r.value??0)>1),c=b(()=>pf(e).slice(-20)),p=b(()=>{const h=c.value;if(!h.length)return null;const C=h.slice().sort((N,I)=>N-I),f=C.reduce((N,I)=>N+I,0)/C.length,S=C[Math.min(C.length-1,Math.floor(C.length*.75))],$=e.runningTasks,k=i.value,x=$.map(N=>N.executionStartTimestamp).filter(N=>typeof N=="number").map(N=>{const I=Math.max(0,Math.floor((k-N)/1e3));return{lo:Math.max(0,Math.round(f-I)),hi:Math.max(0,Math.round(S-I))}});if(!x.length)return null;const _=x.reduce((N,I)=>Math.min(N,I.lo),1/0),M=x.reduce((N,I)=>Math.min(N,I.hi),1/0);return[_,M]}),g=b(()=>{const h=c.value;if(!h.length)return null;const C=s.value;if(C==null)return null;const f=h.slice().sort((_,M)=>_-M),S=f.reduce((_,M)=>_+M,0)/f.length,$=f[Math.min(f.length-1,Math.floor(f.length*.75))];if(C<=0)return p.value??[0,0];const k=Math.max(1,r.value||1),x=Math.ceil(C/k);return[Math.round(S*x),Math.round($*x)]}),d=b(()=>{const h=c.value;if(!h.length)return null;const C=h.slice().sort((I,V)=>I-V),f=C.reduce((I,V)=>I+V,0)/C.length,S=C[Math.min(C.length-1,Math.floor(C.length*.75))],$=t.value,x=(a.value==="running"?$?.executionStartTimestamp:void 0)??l.value,_=x?Math.max(0,Math.floor((i.value-x)/1e3)):0,M=Math.max(0,Math.round(f-_)),N=Math.max(0,Math.round(S-_));return[M,N]}),w=b(()=>{const h=t.value,f=(a.value==="running"?h?.executionStartTimestamp:void 0)??l.value;return f?Cn(i.value-f):""});return{runningWorkflowCount:r,showParallelQueuedStats:u,estimateRangeSeconds:g,estimateRemainingRangeSeconds:d,timeElapsedValue:w}},"useQueueEstimates"),mf={class:"w-[300px] min-w-[260px] rounded-lg border border-interface-stroke bg-interface-panel-surface shadow-md"},vf={class:"flex items-center border-b border-interface-stroke p-4"},gf={class:"text-[0.875rem] leading-normal font-normal text-text-primary"},hf={class:"flex flex-col gap-6 px-4 pt-4 pb-4"},yf={class:"grid grid-cols-2 items-center gap-x-2 gap-y-2"},bf={class:"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary"},wf={class:"flex min-w-0 items-center text-[0.75rem] leading-normal font-normal text-text-secondary"},kf={class:"block min-w-0 truncate"},Cf={key:0,class:"grid grid-cols-2 items-center gap-x-2 gap-y-2"},Sf={class:"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary"},xf={class:"flex min-w-0 items-center text-[0.75rem] leading-normal font-normal text-text-secondary"},$f={class:"block min-w-0 truncate"},_f={key:1,class:"grid grid-cols-2 gap-x-2"},Tf={class:"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary"},Nf={class:"flex items-center justify-between gap-4"},Mf={class:"col-span-2 mt-2 rounded bg-interface-panel-hover-surface px-4 py-2 text-[0.75rem] leading-normal text-text-secondary"},If=K({__name:"JobDetailsPopover",props:{jobId:{},workflowId:{}},setup(e){const o=e,t=b(()=>Z("g.copy")),a=Me(),l=xt(),s=Je(),i=it(),{locale:r}=ce(),u=b(()=>{const U=o.workflowId;if(!U)return"";const q=a.activeWorkflow?.activeState?.id;return q&&q===U?a.activeWorkflow?.filename??U:U}),c=b(()=>o.jobId),{copyToClipboard:p}=ma(),g=n(()=>void p(c.value),"copyJobId"),d=b(()=>{const U=o.jobId,q=n(Q=>Q.find(me=>String(me.promptId??"")===String(U)),"findIn");return q(l.pendingTasks)||q(l.runningTasks)||q(l.historyTasks)||null}),w=b(()=>{const U=d.value;if(!U)return null;const q=s.isPromptInitializing(String(U?.promptId));return Qn(U,q)}),h=b(()=>d.value?.createTime),C=b(()=>h.value!==void 0?kn(h.value,r.value):""),f=b(()=>{const U=d.value;return U?Number(U.queueIndex):null}),S=b(()=>{const U=f.value;return U==null?null:l.pendingTasks.filter(Q=>Number(Q.queueIndex)<U).length}),$=b(()=>{if(S.value==null)return"";const U=S.value;return Z("queue.jobDetails.queuePositionValue",{count:U},U)}),k=R(Date.now());let x=null;De(()=>{x=window.setInterval(()=>{k.value=Date.now()},1e3)}),rt(()=>{x!=null&&(clearInterval(x),x=null)});const{showParallelQueuedStats:_,estimateRangeSeconds:M,estimateRemainingRangeSeconds:N,timeElapsedValue:I}=ff({queueStore:l,executionStore:s,taskForJob:d,jobState:w,firstSeenTs:h,jobsAhead:S,nowTs:k}),V=n((U,q)=>{if(q<=60){const Y=Math.max(1,Math.round(q)),ee=Math.max(1,Math.min(Y,Math.round(U)));return ee===Y?Z("queue.jobDetails.eta.seconds",{count:Y},Y):Z("queue.jobDetails.eta.secondsRange",{lo:ee,hi:Y})}if(U>=60&&q<90)return Z("queue.jobDetails.eta.minutes",{count:1},1);const Q=Math.max(1,Math.floor(U/60)),me=Math.max(Q,Math.ceil(q/60));return Q===me?Z("queue.jobDetails.eta.minutes",{count:Q},Q):Z("queue.jobDetails.eta.minutesRange",{lo:Q,hi:me})},"formatEta"),P=b(()=>{const U=M.value;if(!U)return"";const[q,Q]=U;return V(q,Q)}),G=b(()=>{const U=N.value;if(!U)return"";const[q,Q]=U;return V(q,Q)}),D=b(()=>[{label:Z("queue.jobDetails.workflow"),value:u.value},{label:Z("queue.jobDetails.jobId"),value:c.value,canCopy:!0}]),B=b(()=>{if(w.value==="pending"){if(!h.value)return[];const U=[{label:Z("queue.jobDetails.queuedAt"),value:C.value}];return _.value&&U.push({label:Z("queue.jobDetails.queuePosition"),value:$.value},{label:Z("queue.jobDetails.timeElapsed"),value:I.value},{label:Z("queue.jobDetails.estimatedStartIn"),value:P.value}),U}if(w.value==="running")return h.value?[{label:Z("queue.jobDetails.queuedAt"),value:C.value},{label:Z("queue.jobDetails.timeElapsed"),value:I.value},{label:Z("queue.jobDetails.estimatedFinishIn"),value:G.value}]:[];if(w.value==="completed"){const U=d.value,q=U?.executionEndTimestamp,Q=U?.executionTime,me=q?kn(q,r.value):"",Y=Q!==void 0?Cn(Q):"";return Q!==void 0&&(Q/36e5).toFixed(3)+"",[{label:Z("queue.jobDetails.generatedOn"),value:me},{label:Z("queue.jobDetails.totalGenerationTime"),value:Y}]}if(w.value==="failed"){const q=d.value?.executionTime,Q=q!==void 0?Cn(q):"";return q!==void 0&&(q/36e5).toFixed(3)+"",[{label:Z("queue.jobDetails.queuedAt"),value:C.value},{label:Z("queue.jobDetails.failedAfter"),value:Q}]}return[]}),{errorMessageValue:F,copyErrorMessage:W,reportJobError:H}=df({taskForJob:d,copyToClipboard:p,dialog:i});return(U,q)=>(m(),T("div",mf,[y("div",vf,[y("span",gf,z(v(Z)("queue.jobDetails.header")),1)]),y("div",hf,[y("div",yf,[(m(!0),T(le,null,we(D.value,Q=>(m(),T(le,{key:Q.label},[y("div",bf,z(Q.label),1),y("div",wf,[y("span",kf,z(Q.value),1),Q.canCopy?(m(),O(Ee,{key:0,type:"transparent",size:"sm",class:"ml-2 size-6 bg-transparent hover:opacity-90","aria-label":t.value,onClick:Ne(g,["stop"])},{default:E(()=>q[0]||(q[0]=[y("i",{class:"icon-[lucide--copy] block size-4 leading-none text-text-secondary"},null,-1)])),_:1},8,["aria-label"])):A("",!0)])],64))),128))]),B.value.length?(m(),T("div",Cf,[(m(!0),T(le,null,we(B.value,Q=>(m(),T(le,{key:Q.label},[y("div",Sf,z(Q.label),1),y("div",xf,[y("span",$f,z(Q.value),1)])],64))),128))])):A("",!0),w.value==="failed"?(m(),T("div",_f,[y("div",Tf,z(v(Z)("queue.jobDetails.errorMessage")),1),y("div",Nf,[L(Fe,{class:"h-6 justify-start gap-2 bg-transparent px-0 text-[0.75rem] leading-none text-text-secondary hover:opacity-90",type:"transparent",label:t.value,"aria-label":t.value,"icon-position":"right",onClick:Ne(v(W),["stop"])},{icon:E(()=>q[1]||(q[1]=[y("i",{class:"icon-[lucide--copy] block size-3.5 leading-none"},null,-1)])),_:1},8,["label","aria-label","onClick"]),L(Fe,{class:"h-6 justify-start gap-2 bg-transparent px-0 text-[0.75rem] leading-none text-text-secondary hover:opacity-90",type:"transparent",label:v(Z)("queue.jobDetails.report"),"icon-position":"right",onClick:Ne(v(H),["stop"])},{icon:E(()=>q[2]||(q[2]=[y("i",{class:"icon-[lucide--message-circle-warning] block size-3.5 leading-none"},null,-1)])),_:1},8,["label","onClick"])]),y("div",Mf,z(v(F)),1)])):A("",!0)])]))}}),Pf={class:"w-[300px] min-w-[260px] rounded-lg shadow-md"},Rf={class:"p-3"},Df={class:"relative aspect-square w-full overflow-hidden rounded-lg"},Af=["src","alt"],Lf={key:0,class:"absolute bottom-2 left-2 rounded px-2 py-0.5 text-xs text-text-primary",style:{background:"rgba(217, 217, 217, 0.40)",backdropFilter:"blur(2px)"}},Ef={class:"mt-2 text-center"},Vf=["title"],Wf={key:0,class:"mt-1 text-[0.75rem] leading-normal text-text-secondary"},Of=K({inheritAttrs:!1,__name:"QueueAssetPreview",props:{imageUrl:{},name:{},timeLabel:{}},emits:["image-click"],setup(e){const o=R(null),t=R(null),a=R(null),l=n(()=>{const s=o.value;s&&(t.value=s.naturalWidth||null,a.value=s.naturalHeight||null)},"onImgLoad");return(s,i)=>(m(),T("div",Pf,[y("div",Rf,[y("div",Df,[y("img",{ref_key:"imgRef",ref:o,src:s.imageUrl,alt:s.name,class:"h-full w-full cursor-pointer object-contain",onClick:i[0]||(i[0]=r=>s.$emit("image-click")),onLoad:l},null,40,Af),s.timeLabel?(m(),T("div",Lf,z(s.timeLabel),1)):A("",!0)]),y("div",Ef,[y("div",{class:"truncate text-[0.875rem] leading-normal font-semibold text-text-primary",title:s.name},z(s.name),9,Vf),t.value&&a.value?(m(),T("div",Wf,z(t.value)+"x"+z(a.value),1)):A("",!0)])])]))}}),Bf={key:0,class:"absolute inset-0"},zf={class:"relative z-[1] flex items-center gap-1"},Ff={class:"relative inline-flex items-center justify-center"},Uf={class:"inline-flex h-6 w-6 items-center justify-center overflow-hidden rounded-[6px]"},Gf=["src"],Hf={class:"relative z-[1] min-w-0 flex-1"},jf=["title"],qf={class:"relative z-[1] flex items-center gap-2 text-text-secondary"},Kf={key:"actions",class:"inline-flex items-center gap-2 pr-1"},Qf={key:"secondary",class:"pr-2"},Jf=K({__name:"QueueJobItem",props:{jobId:{},workflowId:{default:void 0},state:{},title:{},rightText:{default:""},iconName:{default:void 0},iconImageUrl:{default:void 0},showClear:{type:Boolean,default:void 0},showMenu:{type:Boolean,default:void 0},progressTotalPercent:{default:void 0},progressCurrentPercent:{default:void 0},runningNodeName:{default:void 0},activeDetailsId:{default:null}},emits:["cancel","delete","menu","view","details-enter","details-leave"],setup(e,{emit:o}){const t=e,a=o,{t:l}=ce(),s=b(()=>dt(l("g.cancel"))),i=b(()=>dt(l("g.delete"))),r=b(()=>dt(l("g.more"))),u=R(null),c=b(()=>t.activeDetailsId===t.jobId),p=n(()=>{h.value||a("details-enter",t.jobId)},"onRowEnter"),g=n(()=>a("details-leave",t.jobId),"onRowLeave"),d=n(()=>a("details-enter",t.jobId),"onPopoverEnter"),w=n(()=>a("details-leave",t.jobId),"onPopoverLeave"),h=R(!1),C=R(null),f=R(null),S=n(()=>{C.value!==null&&(clearTimeout(C.value),C.value=null)},"clearPreviewHideTimer"),$=n(()=>{f.value!==null&&(clearTimeout(f.value),f.value=null)},"clearPreviewShowTimer"),k=b(()=>t.state==="completed"&&!!t.iconImageUrl),x=n(()=>{k.value&&(S(),$(),f.value=window.setTimeout(()=>{h.value=!0,f.value=null},200))},"scheduleShowPreview"),_=n(()=>{S(),$(),C.value=window.setTimeout(()=>{h.value=!1,C.value=null},150)},"scheduleHidePreview"),M=n(()=>x(),"onIconEnter"),N=n(()=>_(),"onIconLeave"),I=n(()=>x(),"onPreviewEnter"),V=n(()=>_(),"onPreviewLeave"),P=R(null),G=n(()=>{const Y=u.value;if(!Y)return;const ee=Y.getBoundingClientRect(),se=8;P.value={top:ee.top,right:window.innerWidth-ee.left+se}},"updatePopoverPosition"),D=b(()=>c.value||h.value&&k.value);te(D,Y=>{Y?Le(G):P.value=null},{immediate:!1});const B=R(!1),F=b(()=>t.iconName?t.iconName:gt(t.state)),W=b(()=>t.state==="pending"&&F.value===gt("pending")&&!t.iconImageUrl),H=b(()=>t.showClear!==void 0?t.showClear:t.state!=="completed"),U=n(()=>a("details-leave",t.jobId),"emitDetailsLeave"),q=n(()=>{U(),a("cancel")},"onCancelClick"),Q=n(()=>{U(),a("delete")},"onDeleteClick"),me=n(Y=>{(t.showMenu!==void 0?t.showMenu:!0)&&a("menu",Y)},"onContextMenu");return(Y,ee)=>{const se=_e("tooltip");return m(),T("div",{ref_key:"rowRef",ref:u,class:"relative",onMouseenter:p,onMouseleave:g,onContextmenu:Ne(me,["stop","prevent"])},[(m(),O(Rt,{to:"body"},[!h.value&&c.value&&P.value?(m(),T("div",{key:0,class:"fixed z-50",style:pe({top:`${P.value.top}px`,right:`${P.value.right}px`}),onMouseenter:d,onMouseleave:w},[L(If,{"job-id":t.jobId,"workflow-id":t.workflowId},null,8,["job-id","workflow-id"])],36)):A("",!0)])),(m(),O(Rt,{to:"body"},[h.value&&k.value&&P.value?(m(),T("div",{key:0,class:"fixed z-50",style:pe({top:`${P.value.top}px`,right:`${P.value.right}px`}),onMouseenter:I,onMouseleave:V},[L(Of,{"image-url":Y.iconImageUrl,name:t.title,"time-label":Y.rightText||void 0,onImageClick:ee[0]||(ee[0]=xe=>a("view"))},null,8,["image-url","name","time-label"])],36)):A("",!0)])),y("div",{class:"relative flex items-center justify-between gap-2 overflow-hidden rounded-lg border border-secondary-background bg-secondary-background p-1 text-[12px] text-text-primary transition-colors duration-150 ease-in-out hover:border-secondary-background-hover hover:bg-secondary-background-hover",onMouseenter:ee[3]||(ee[3]=xe=>B.value=!0),onMouseleave:ee[4]||(ee[4]=xe=>B.value=!1)},[t.state==="running"&&(t.progressTotalPercent!==void 0||t.progressCurrentPercent!==void 0)?(m(),T("div",Bf,[t.progressTotalPercent!==void 0?(m(),T("div",{key:0,class:"pointer-events-none absolute inset-y-0 left-0 h-full bg-interface-panel-job-progress-primary transition-[width]",style:pe({width:`${t.progressTotalPercent}%`})},null,4)):A("",!0),t.progressCurrentPercent!==void 0?(m(),T("div",{key:1,class:"pointer-events-none absolute inset-y-0 left-0 h-full bg-interface-panel-job-progress-secondary transition-[width]",style:pe({width:`${t.progressCurrentPercent}%`})},null,4)):A("",!0)])):A("",!0),y("div",zf,[y("div",Ff,[y("div",{class:"absolute left-1/2 top-1/2 size-10 -translate-x-1/2 -translate-y-1/2",onMouseenter:Ne(M,["stop"]),onMouseleave:Ne(N,["stop"])},null,32),y("div",Uf,[Y.iconImageUrl?(m(),T("img",{key:0,src:Y.iconImageUrl,class:"h-full w-full object-cover"},null,8,Gf)):(m(),T("i",{key:1,class:J(v(de)(F.value,"size-4",W.value&&"animate-spin"))},null,2))])])]),y("div",Hf,[y("div",{class:"truncate opacity-90",title:t.title},[Pe(Y.$slots,"primary",{},()=>[qe(z(t.title),1)])],8,jf)]),y("div",qf,[L(Rn,{mode:"out-in","enter-active-class":"transition-opacity transition-transform duration-150 ease-out","leave-active-class":"transition-opacity transition-transform duration-150 ease-in","enter-from-class":"opacity-0 translate-y-0.5","enter-to-class":"opacity-100 translate-y-0","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-0.5"},{default:E(()=>[B.value?(m(),T("div",Kf,[t.state==="failed"&&H.value?ue((m(),O(Ee,{key:0,type:"transparent",size:"sm",class:"size-6 transform gap-1 rounded bg-destructive-background text-text-primary transition duration-150 ease-in-out hover:-translate-y-px hover:bg-destructive-background-hover hover:opacity-95","aria-label":v(l)("g.delete"),onClick:Ne(Q,["stop"])},{default:E(()=>ee[5]||(ee[5]=[y("i",{class:"icon-[lucide--trash-2] size-4"},null,-1)])),_:1},8,["aria-label"])),[[se,i.value,void 0,{top:!0}]]):t.state!=="completed"&&t.state!=="running"&&H.value?ue((m(),O(Ee,{key:1,type:"transparent",size:"sm",class:"size-6 transform gap-1 rounded bg-destructive-background text-text-primary transition duration-150 ease-in-out hover:-translate-y-px hover:bg-destructive-background-hover hover:opacity-95","aria-label":v(l)("g.cancel"),onClick:Ne(q,["stop"])},{default:E(()=>ee[6]||(ee[6]=[y("i",{class:"icon-[lucide--x] size-4"},null,-1)])),_:1},8,["aria-label"])),[[se,s.value,void 0,{top:!0}]]):t.state==="completed"?(m(),O(bt,{key:2,class:"h-6 transform gap-1 rounded bg-modal-card-button-surface px-2 py-0 text-text-primary transition duration-150 ease-in-out hover:-translate-y-px hover:opacity-95",type:"transparent",label:v(l)("menuLabels.View"),"aria-label":v(l)("menuLabels.View"),onClick:ee[1]||(ee[1]=Ne(xe=>a("view"),["stop"]))},null,8,["label","aria-label"])):A("",!0),t.showMenu===void 0||t.showMenu?ue((m(),O(Ee,{key:3,type:"transparent",size:"sm",class:"size-6 transform gap-1 rounded bg-modal-card-button-surface text-text-primary transition duration-150 ease-in-out hover:-translate-y-px hover:opacity-95","aria-label":v(l)("g.more"),onClick:ee[2]||(ee[2]=Ne(xe=>a("menu",xe),["stop"]))},{default:E(()=>ee[7]||(ee[7]=[y("i",{class:"icon-[lucide--more-horizontal] size-4"},null,-1)])),_:1},8,["aria-label"])),[[se,r.value,void 0,{top:!0}]]):A("",!0)])):t.state!=="running"?(m(),T("div",Qf,[Pe(Y.$slots,"secondary",{},()=>[qe(z(t.rightText),1)])])):A("",!0)]),_:3}),t.state==="running"&&H.value?ue((m(),O(Ee,{key:0,type:"transparent",size:"sm",class:"size-6 transform gap-1 rounded bg-destructive-background text-text-primary transition duration-150 ease-in-out hover:-translate-y-px hover:bg-destructive-background-hover hover:opacity-95","aria-label":v(l)("g.cancel"),onClick:Ne(q,["stop"])},{default:E(()=>ee[8]||(ee[8]=[y("i",{class:"icon-[lucide--x] size-4"},null,-1)])),_:1},8,["aria-label"])),[[se,s.value,void 0,{top:!0}]]):A("",!0)])],32)],544)}}}),Yf={class:"flex flex-col gap-4 px-3 pb-4"},Zf={class:"text-[12px] leading-none text-text-secondary"},Xf=K({__name:"JobGroupsList",props:{displayedJobGroups:{}},emits:["cancelItem","deleteItem","menu","viewItem"],setup(e,{emit:o}){const t=e,a=o,l=n(h=>{a("cancelItem",h)},"emitCancelItem"),s=n(h=>{a("deleteItem",h)},"emitDeleteItem"),i=R(null),r=R(null),u=R(null),c=n(()=>{r.value!==null&&(clearTimeout(r.value),r.value=null)},"clearHideTimer"),p=n(()=>{u.value!==null&&(clearTimeout(u.value),u.value=null)},"clearShowTimer"),g=n(h=>{c(),p(),u.value=window.setTimeout(()=>{i.value=h,u.value=null},200)},"onDetailsEnter"),d=n(h=>{c(),p(),r.value=window.setTimeout(()=>{i.value===h&&(i.value=null),r.value=null},150)},"onDetailsLeave"),w=n(()=>{c(),p(),i.value=null},"resetActiveDetails");return te(()=>t.displayedJobGroups,h=>{const C=i.value;if(!C)return;h.some(S=>S.items.some($=>$.id===C))||w()}),Ct(w),(h,C)=>(m(),T("div",Yf,[(m(!0),T(le,null,we(h.displayedJobGroups,f=>(m(),T("div",{key:f.key,class:"flex flex-col gap-2"},[y("div",Zf,z(f.label),1),(m(!0),T(le,null,we(f.items,S=>(m(),O(Jf,{key:S.id,"job-id":S.id,"workflow-id":S.taskRef?.workflow?.id,state:S.state,title:S.title,"right-text":S.meta,"icon-name":S.iconName,"icon-image-url":S.iconImageUrl,"show-clear":S.showClear,"show-menu":!0,"progress-total-percent":S.progressTotalPercent,"progress-current-percent":S.progressCurrentPercent,"running-node-name":S.runningNodeName,"active-details-id":i.value,onCancel:n($=>l(S),"onCancel"),onDelete:n($=>s(S),"onDelete"),onMenu:n($=>h.$emit("menu",S,$),"onMenu"),onView:n($=>h.$emit("viewItem",S),"onView"),onDetailsEnter:g,onDetailsLeave:d},null,8,["job-id","workflow-id","state","title","right-text","icon-name","icon-image-url","show-clear","progress-total-percent","progress-current-percent","running-node-name","active-details-id","onCancel","onDelete","onMenu","onView"]))),128))]))),128))]))}}),em={class:"flex w-full flex-col gap-4"},tm={class:"flex items-center justify-between px-3"},om={class:"ml-4 inline-flex items-center"},nm={class:"inline-flex h-6 items-center text-[12px] leading-none text-text-primary opacity-90"},sm={class:"font-bold"},am={class:"ml-1"},lm={class:"flex-1 min-h-0 overflow-y-auto"},im=K({__name:"QueueOverlayExpanded",props:{headerTitle:{},showConcurrentIndicator:{type:Boolean},concurrentWorkflowCount:{},queuedCount:{},selectedJobTab:{},selectedWorkflowFilter:{},selectedSortMode:{},displayedJobGroups:{},hasFailedJobs:{type:Boolean}},emits:["showAssets","clearHistory","clearQueued","update:selectedJobTab","update:selectedWorkflowFilter","update:selectedSortMode","cancelItem","deleteItem","viewItem"],setup(e,{emit:o}){const t=o,{t:a}=ce(),l=R(null),s=R(null),{jobMenuEntries:i}=Pp(()=>l.value,g=>t("viewItem",g)),r=n(g=>{t("cancelItem",g)},"onCancelItemEvent"),u=n(g=>{t("deleteItem",g)},"onDeleteItemEvent"),c=n((g,d)=>{l.value=g,s.value?.open(d)},"onMenuItem"),p=n(async g=>{g.kind!=="divider"&&(g.onClick&&await g.onClick(),s.value?.hide())},"onJobMenuAction");return(g,d)=>(m(),T("div",em,[L(Op,{"header-title":g.headerTitle,"show-concurrent-indicator":g.showConcurrentIndicator,"concurrent-workflow-count":g.concurrentWorkflowCount,onClearHistory:d[0]||(d[0]=w=>g.$emit("clearHistory"))},null,8,["header-title","show-concurrent-indicator","concurrent-workflow-count"]),y("div",tm,[L(Fe,{class:"grow gap-1 p-2 text-center font-inter text-[12px] leading-none hover:opacity-90 justify-center",type:"secondary",label:v(a)("sideToolbar.queueProgressOverlay.showAssets"),"aria-label":v(a)("sideToolbar.queueProgressOverlay.showAssets"),onClick:d[1]||(d[1]=w=>g.$emit("showAssets"))},{icon:E(()=>d[7]||(d[7]=[y("div",{class:"pointer-events-none block size-4 shrink-0 leading-none icon-[comfy--image-ai-edit]","aria-hidden":"true"},null,-1)])),_:1},8,["label","aria-label"]),y("div",om,[y("div",nm,[y("span",sm,z(g.queuedCount),1),y("span",am,z(v(a)("sideToolbar.queueProgressOverlay.queuedSuffix")),1)]),g.queuedCount>0?(m(),O(Ee,{key:0,class:"group ml-2 size-6 bg-secondary-background hover:bg-destructive-background",type:"secondary",size:"sm","aria-label":v(a)("sideToolbar.queueProgressOverlay.clearQueued"),onClick:d[2]||(d[2]=w=>g.$emit("clearQueued"))},{default:E(()=>d[8]||(d[8]=[y("i",{class:"pointer-events-none icon-[lucide--list-x] block size-4 leading-none text-text-primary transition-colors group-hover:text-base-background"},null,-1)])),_:1},8,["aria-label"])):A("",!0)])]),L(cf,{"selected-job-tab":g.selectedJobTab,"selected-workflow-filter":g.selectedWorkflowFilter,"selected-sort-mode":g.selectedSortMode,"has-failed-jobs":g.hasFailedJobs,"onUpdate:selectedJobTab":d[3]||(d[3]=w=>g.$emit("update:selectedJobTab",w)),"onUpdate:selectedWorkflowFilter":d[4]||(d[4]=w=>g.$emit("update:selectedWorkflowFilter",w)),"onUpdate:selectedSortMode":d[5]||(d[5]=w=>g.$emit("update:selectedSortMode",w))},null,8,["selected-job-tab","selected-workflow-filter","selected-sort-mode","has-failed-jobs"]),y("div",lm,[L(Xf,{"displayed-job-groups":g.displayedJobGroups,onCancelItem:r,onDeleteItem:u,onViewItem:d[6]||(d[6]=w=>g.$emit("viewItem",w)),onMenu:c},null,8,["displayed-job-groups"])]),L(Fp,{ref_key:"jobContextMenuRef",ref:s,entries:v(i),onAction:p},null,8,["entries"])]))}}),rm={class:"w-[360px] rounded-2xl border border-interface-stroke bg-interface-panel-surface text-text-primary shadow-interface font-inter"},um={class:"flex items-center justify-between border-b border-interface-stroke px-4 py-4"},cm={class:"m-0 text-[14px] font-normal leading-none"},dm={class:"flex flex-col gap-4 px-4 py-4 text-[14px] text-text-secondary"},pm={class:"m-0"},fm={class:"m-0"},mm={class:"flex items-center justify-end px-4 py-4"},vm={class:"flex items-center gap-4 text-[14px] leading-none"},gm=K({__name:"QueueClearHistoryDialog",setup(e){const o=St(),t=xt(),{t:a}=ce(),{wrapWithErrorHandlingAsync:l}=ho(),s=R(!1),i=l(async()=>{await t.clear(["history"]),o.closeDialog()},void 0,()=>{s.value=!1}),r=n(async()=>{s.value||(s.value=!0,await i())},"onConfirm"),u=n(()=>{o.closeDialog()},"onCancel");return(c,p)=>(m(),T("section",rm,[y("header",um,[y("p",cm,z(v(a)("sideToolbar.queueProgressOverlay.clearHistoryDialogTitle")),1),L(Ee,{type:"transparent",size:"sm",class:"size-6 bg-transparent text-text-secondary hover:bg-secondary-background hover:opacity-100","aria-label":v(a)("g.close"),onClick:u},{default:E(()=>p[0]||(p[0]=[y("i",{class:"icon-[lucide--x] block size-4 leading-none"},null,-1)])),_:1},8,["aria-label"])]),y("div",dm,[y("p",pm,z(v(a)("sideToolbar.queueProgressOverlay.clearHistoryDialogDescription")),1),y("p",fm,z(v(a)("sideToolbar.queueProgressOverlay.clearHistoryDialogAssetsNote")),1)]),y("footer",mm,[y("div",vm,[L(bt,{class:"min-h-[24px] px-1 py-1 text-[14px] leading-[1] text-text-secondary hover:text-text-primary",type:"transparent",label:v(a)("g.cancel"),onClick:u},null,8,["label"]),L(bt,{class:"min-h-[32px] px-4 py-2 text-[12px] font-normal leading-[1]",type:"secondary",label:v(a)("g.clear"),disabled:s.value,onClick:r},null,8,["label","disabled"])])])]))}}),hm=n(()=>{const e=xt(),o=Je(),t=b(()=>e.runningTasks.length>0||!o.isIdle),a=R(null),l=R(null),s=R(null),i=n(()=>{s.value!==null&&(clearTimeout(s.value),s.value=null)},"clearDismissTimer"),r=n(()=>{i(),s.value=window.setTimeout(()=>{l.value=null,s.value=null},6e3)},"startDismissTimer"),u=n(()=>{l.value=null,i()},"clearSummary");return te(t,(p,g)=>{if(!g&&p&&(a.value=Date.now()),g&&!p){const d=a.value??0,w=e.historyTasks.filter($=>{const k=$.executionEndTimestamp;return typeof k=="number"&&k>=d});if(!w.length){l.value=null,i();return}let h=0,C=0;const f=[];for(const $ of w){const k=Qn($,!1);if(k==="completed"){h++;const x=$.previewOutput;x?.isImage&&f.push(x.urlWithTimestamp)}else k==="failed"&&C++}if(h===0&&C===0){l.value=null,i();return}let S="mixed";C===0?S="allSuccess":h===0&&(S="allFailed"),l.value={mode:S,completedCount:h,failedCount:C,thumbnailUrls:f.slice(0,3)},r()}},{immediate:!0}),{summary:b(()=>l.value),clearSummary:u}},"useCompletionSummary");function ym(e){const o=R(-1),t=yt([]);return{galleryActiveIndex:o,galleryItems:t,onViewItem:n(l=>{const s=e().flatMap(u=>{const c=u.previewOutput;return c&&c.supportsPreview?[c]:[]});if(!s.length)return;t.value=s;const i=l.taskRef?.previewOutput?.url,r=i?s.findIndex(u=>u.url===i):0;o.value=r>=0?r:0},"onViewItem")}}n(ym,"useResultGallery");const bm={class:J(["flex","justify-end","w-full","pointer-events-none"])},wm=K({__name:"QueueProgressOverlay",props:{expanded:{type:Boolean},menuHovered:{type:Boolean,default:!1}},emits:["update:expanded"],setup(e,{emit:o}){const t=e,a=o,{t:l}=ce(),s=xt(),i=ke(),r=Je(),u=Qt(),c=St(),p=va(),g=ti(),{wrapWithErrorHandlingAsync:d}=ho(),{totalPercentFormatted:w,currentNodePercentFormatted:h,totalProgressStyle:C,currentNodeProgressStyle:f}=Oa(),S=R(!1),$=b(()=>S.value||t.menuHovered),k=R(!1),x=b({get:n(()=>t.expanded===void 0?k.value:t.expanded,"get"),set:n(X=>{t.expanded===void 0&&(k.value=X),a("update:expanded",X)},"set")}),{summary:_,clearSummary:M}=hm(),N=b(()=>_.value!==null),I=b(()=>s.runningTasks.length),V=b(()=>s.pendingTasks.length),P=b(()=>!r.isIdle),G=b(()=>I.value>0||P.value),D=b(()=>I.value+V.value),B=b(()=>x.value?"expanded":G.value?"active":N.value?"empty":"hidden"),F=b(()=>B.value==="expanded"||B.value==="empty"||B.value==="active"&&$.value),W=b(()=>B.value!=="hidden"),H=b(()=>F.value?"border-interface-stroke bg-interface-panel-surface shadow-interface":"border-transparent bg-transparent shadow-none"),U=b(()=>`flex items-center justify-end gap-4 transition-opacity duration-200 ease-in-out ${B.value==="active"&&$.value?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`),q=b(()=>G.value?`${D.value} ${l("sideToolbar.queueProgressOverlay.activeJobsSuffix")}`:l("sideToolbar.queueProgressOverlay.jobQueue")),Q=b(()=>r.runningWorkflowCount),me=b(()=>Q.value>1),{selectedJobTab:Y,selectedWorkflowFilter:ee,selectedSortMode:se,hasFailedJobs:xe,filteredTasks:He,groupedJobItems:je,currentNodeName:ot}=Jp(),Ue=b(()=>je.value),Be=d(async X=>{const Te=X.taskRef?.promptId;Te&&await he.interrupt(Te)}),mt=d(async X=>{X.taskRef&&await s.delete(X.taskRef)}),{galleryActiveIndex:Ge,galleryItems:$t,onViewItem:vt}=ym(()=>He.value),Ye=n(X=>{x.value=X},"setExpanded"),Ft=n(()=>{Ye(!0)},"openExpandedFromEmpty"),eo=n(()=>{Ye(!0)},"viewAllJobs"),to=n(()=>{Ft(),M()},"onSummaryClick"),ie=n(()=>{u.activeSidebarTabId="assets"},"openAssetsSidebar"),ge=n(async X=>{const Te=X.taskRef,Ze=Te?.promptId,al=Te?.previewOutput;if(!Ze||!al)return;const ns=String(Ze);if(ie(),await Le(),await p.updateHistory(),!p.historyAssets.find(ll=>ll.id===ns))throw new Error("Asset not found in media assets panel");g.setSelection([ns])},"focusAssetInSidebar"),Ie=d(async X=>{vt(X),await ge(X)}),Ve=d(async()=>{await i.execute("Comfy.ClearPendingTasks")}),ae=d(async()=>{const X=s.runningTasks;await Promise.all(X.filter(Te=>Te.promptId!=null).map(Te=>he.interrupt(Te.promptId)))}),oe=n(()=>{c.showDialog({key:"queue-clear-history",component:gm,dialogComponentProps:{headless:!0,closable:!1,closeOnEscape:!0,dismissableMask:!0,pt:{root:{class:"max-w-[360px] w-auto bg-transparent border-none shadow-none"},content:{class:"!p-0 bg-transparent"}}}})},"showClearHistoryDialog"),oo=n(()=>{oe()},"onClearHistoryFromMenu");return(X,Te)=>(m(),T(le,null,[ue(y("div",bm,[y("div",{class:J(["pointer-events-auto flex w-[350px] min-w-[310px] max-h-[60vh] flex-col overflow-hidden rounded-lg border font-inter transition-colors duration-200 ease-in-out",H.value]),onMouseenter:Te[3]||(Te[3]=Ze=>S.value=!0),onMouseleave:Te[4]||(Te[4]=Ze=>S.value=!1)},[x.value?(m(),O(im,{key:0,"selected-job-tab":v(Y),"onUpdate:selectedJobTab":Te[0]||(Te[0]=Ze=>st(Y)?Y.value=Ze:null),"selected-workflow-filter":v(ee),"onUpdate:selectedWorkflowFilter":Te[1]||(Te[1]=Ze=>st(ee)?ee.value=Ze:null),"selected-sort-mode":v(se),"onUpdate:selectedSortMode":Te[2]||(Te[2]=Ze=>st(se)?se.value=Ze:null),class:"flex-1 min-h-0","header-title":q.value,"show-concurrent-indicator":me.value,"concurrent-workflow-count":Q.value,"queued-count":V.value,"displayed-job-groups":Ue.value,"has-failed-jobs":v(xe),onShowAssets:ie,onClearHistory:oo,onClearQueued:v(Ve),onCancelItem:v(Be),onDeleteItem:v(mt),onViewItem:v(Ie)},null,8,["selected-job-tab","selected-workflow-filter","selected-sort-mode","header-title","show-concurrent-indicator","concurrent-workflow-count","queued-count","displayed-job-groups","has-failed-jobs","onClearQueued","onCancelItem","onDeleteItem","onViewItem"])):G.value?(m(),O(hp,{key:1,"total-progress-style":v(C),"current-node-progress-style":v(f),"total-percent-formatted":v(w),"current-node-percent-formatted":v(h),"current-node-name":v(ot),"running-count":I.value,"queued-count":V.value,"bottom-row-class":U.value,onInterruptAll:v(ae),onClearQueued:v(Ve),onViewAllJobs:eo},null,8,["total-progress-style","current-node-progress-style","total-percent-formatted","current-node-percent-formatted","current-node-name","running-count","queued-count","bottom-row-class","onInterruptAll","onClearQueued"])):v(_)?(m(),O(Ip,{key:2,summary:v(_),onSummaryClick:to},null,8,["summary"])):A("",!0)],34)],512),[[Qe,W.value]]),L(oi,{"active-index":v(Ge),"onUpdate:activeIndex":Te[5]||(Te[5]=Ze=>st(Ge)?Ge.value=Ze:null),"all-gallery-items":v($t)},null,8,["active-index","all-gallery-items"])],64))}}),km=Vt("actionBarButton",()=>{const e=zn();return{buttons:b(()=>e.extensions.flatMap(t=>t.actionBarButtons??[]))}}),Cm={class:"flex h-full shrink-0 items-center gap-1"},Sm=K({__name:"ActionBarButtons",setup(e){const o=km();return(t,a)=>{const l=_e("tooltip");return m(),T("div",Cm,[(m(!0),T(le,null,we(v(o).buttons,(s,i)=>ue((m(),O(v(re),{key:i,label:s.label,"aria-label":s.tooltip||s.label,class:J([s.class,"h-7"]),text:"",rounded:"",severity:"secondary",onClick:s.onClick},{icon:E(()=>[y("i",{class:J(s.icon)},null,2)]),_:2},1032,["label","aria-label","class","onClick"])),[[l,s.tooltip,void 0,{bottom:!0}]])),128))])}}}),xm={class:"current-user-popover w-72"},$m={class:"p-3"},_m={class:"flex flex-col items-center"},Tm={class:"my-0 mb-1 truncate text-lg font-semibold"},Nm={key:0,class:"my-0 truncate text-sm text-muted"},Mm={key:0,class:"flex items-center justify-between"},Im={class:"flex flex-col gap-1"},Pm=K({__name:"CurrentUserPopover",emits:["close"],setup(e,{emit:o}){const t=o,{buildDocsUrl:a}=Zt(),l="settingsCategories.Credits",{userDisplayName:s,userEmail:i,userPhotoUrl:r,handleSignOut:u}=Xt(),c=ga(),p=it(),{isActiveSubscription:g,fetchStatus:d}=On(),w=n(()=>{p.showSettingsDialog("user"),t("close")},"handleOpenUserSettings"),h=n(()=>{p.showSettingsDialog("credits"),t("close")},"handleOpenPlanAndCreditsSettings"),C=n(()=>{p.showTopUpCreditsDialog(),t("close")},"handleTopUp"),f=n(()=>{window.open(a("/tutorials/api-nodes/overview#api-nodes",{includeLocale:!0}),"_blank"),t("close")},"handleOpenPartnerNodesInfo"),S=n(async()=>{await u(),t("close")},"handleLogout"),$=n(async()=>{await d()},"handleSubscribed");return De(()=>{c.fetchBalance()}),(k,x)=>(m(),T("div",xm,[y("div",$m,[y("div",_m,[L(Da,{class:"mb-3","photo-url":v(r),"pt:icon:class":{"text-2xl!":!v(r)},size:"large"},null,8,["photo-url","pt:icon:class"]),y("h3",Tm,z(v(s)||k.$t("g.user")),1),v(i)?(m(),T("p",Nm,z(v(i)),1)):A("",!0)])]),v(g)?(m(),T("div",Mm,[y("div",Im,[L(ni,{"text-class":"text-2xl"}),L(v(re),{label:k.$t("subscription.partnerNodesCredits"),severity:"secondary",text:"",size:"small",class:"pl-6 p-0 h-auto justify-start",pt:{root:{class:"hover:bg-transparent active:bg-transparent"}},onClick:f},null,8,["label"])]),L(v(re),{label:k.$t("credits.topUp.topUp"),severity:"secondary",size:"small",onClick:C},null,8,["label"])])):(m(),O(Id,{key:1,label:k.$t("subscription.subscribeToComfyCloud"),size:"small",variant:"gradient",onSubscribed:$},null,8,["label"])),L(v(is),{class:"my-2"}),L(v(re),{class:"justify-start",label:k.$t("userSettings.title"),icon:"pi pi-cog",text:"",fluid:"",severity:"secondary",onClick:w},null,8,["label"]),v(g)?(m(),O(v(re),{key:2,class:"justify-start",label:k.$t(v(l)),icon:"pi pi-receipt",text:"",fluid:"",severity:"secondary",onClick:h},null,8,["label"])):A("",!0),L(v(is),{class:"my-2"}),L(v(re),{class:"justify-start",label:k.$t("auth.signOut.signOut"),icon:"pi pi-sign-out",text:"",fluid:"",severity:"secondary",onClick:S},null,8,["label"])]))}}),Rm={class:"flex items-center gap-1 rounded-full hover:bg-interface-button-hover-surface"},Ba=K({__name:"CurrentUserButton",setup(e){const{isLoggedIn:o,userPhotoUrl:t}=Xt(),a=R(null),l=b(()=>t.value??void 0),s=n(()=>{a.value?.hide()},"closePopover");return(i,r)=>(m(),T("div",null,[v(o)?(m(),O(v(re),{key:0,class:"user-profile-button p-1 hover:bg-transparent",severity:"secondary",text:"","aria-label":i.$t("g.currentUser"),onClick:r[0]||(r[0]=u=>a.value?.toggle(u))},{default:E(()=>[y("div",Rm,[L(Da,{"photo-url":l.value},null,8,["photo-url"]),r[1]||(r[1]=y("i",{class:"pi pi-chevron-down px-1",style:{fontSize:"0.6rem"}},null,-1))])]),_:1},8,["aria-label"])):A("",!0),L(v(et),{ref_key:"popover",ref:a,"show-arrow":!1},{default:E(()=>[L(Pm,{onClose:s})]),_:1},512)]))}}),Dm={class:"mb-1"},Am=["href"],za=K({__name:"LoginButton",setup(e){const{isLoggedIn:o,handleSignIn:t}=Xt(),{buildDocsUrl:a}=Zt(),l=a("/tutorials/api-nodes/overview#api-nodes",{includeLocale:!0}),s=R(null);let i=null,r=null;const u=n(g=>{i&&(clearTimeout(i),i=null),r&&(clearTimeout(r),r=null),r=setTimeout(()=>{s.value&&s.value.show(g,g.target)},200)},"showPopover"),c=n(()=>{i&&(clearTimeout(i),i=null)},"cancelHidePopover"),p=n(()=>{r&&(clearTimeout(r),r=null),i=setTimeout(()=>{s.value&&s.value.hide()},150)},"hidePopover");return(g,d)=>(m(),T(le,null,[v(o)?A("",!0):(m(),O(v(re),{key:0,outlined:"",rounded:"",severity:"secondary",class:"size-8 bg-secondary-background text-base-foreground hover:bg-secondary-background-hover",onClick:d[0]||(d[0]=w=>v(t)()),onMouseenter:u,onMouseleave:p},{icon:E(()=>d[1]||(d[1]=[y("i",{class:"icon-[lucide--user] size-4"},null,-1)])),_:1})),L(v(et),{ref_key:"popoverRef",ref:s,class:"p-2",onMouseout:p,onMouseover:c},{default:E(()=>[y("div",null,[y("div",Dm,z(v(Z)("auth.loginButton.tooltipHelp")),1),y("a",{href:v(l),target:"_blank",class:"text-neutral-500 hover:text-primary"},z(v(Z)("auth.loginButton.tooltipLearnMore")),9,Am)])]),_:1},512)],64))}}),Lm={class:"min-w-0 flex-1"},Em={class:"mx-1 flex flex-col items-end gap-1"},Vm={class:"actionbar-container pointer-events-auto flex h-12 items-center rounded-lg border border-interface-stroke px-2 shadow-interface"},Wm={key:0,class:"absolute -top-1 -right-1 min-w-[16px] rounded-full bg-primary-background py-0.25 text-[10px] font-medium leading-[14px] text-white"},Om=K({__name:"TopMenuSection",setup(e){const o=lt(),t=Je(),a=ke(),{isLoggedIn:l}=Xt(),s=ze(),{t:i}=ce(),r=R(!1),u=xt(),c=R(!1),p=b(()=>u.pendingTasks.length),g=b(()=>dt(i("sideToolbar.queueProgressOverlay.viewJobHistory"))),d=b(()=>r.value?"bg-secondary-background-selected":"bg-secondary-background"),w=b(()=>dt(i("menu.interrupt"))),{isIdle:h}=at(t),C=R();De(()=>{C.value&&(j.menu.element.style.width="fit-content",C.value.appendChild(j.menu.element))});const f=n(()=>{r.value=!r.value},"toggleQueueOverlay"),S=n(async()=>{h.value||await a.execute("Comfy.Interrupt")},"cancelCurrentJob");return($,k)=>{const x=_e("tooltip");return v(o).focusMode?A("",!0):(m(),T("div",{key:0,class:"ml-1 flex gap-x-0.5 pt-1",onMouseenter:k[1]||(k[1]=_=>c.value=!0),onMouseleave:k[2]||(k[2]=_=>c.value=!1)},[y("div",Lm,[L(Zd)]),y("div",Em,[y("div",Vm,[L(Sm),y("div",{ref_key:"legacyCommandsContainerRef",ref:C,class:"[&:not(:has(*>*:not(:empty)))]:hidden"},null,512),L(Fd),ue((m(),O(Ee,{type:"transparent",size:"sm",class:"mr-2 bg-destructive-background text-base-foreground transition-colors duration-200 ease-in-out hover:bg-destructive-background-hover focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-destructive-background",disabled:v(h),"aria-label":v(i)("menu.interrupt"),onClick:S},{default:E(()=>k[3]||(k[3]=[y("i",{class:"icon-[lucide--x] size-4"},null,-1)])),_:1},8,["disabled","aria-label"])),[[x,w.value,void 0,{bottom:!0}]]),ue((m(),O(Ee,{type:"transparent",size:"sm",class:J(["queue-history-toggle relative mr-2 transition-colors duration-200 ease-in-out hover:bg-secondary-background-hover focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-background",d.value]),"aria-pressed":r.value,"aria-label":v(i)("sideToolbar.queueProgressOverlay.expandCollapsedQueue"),onClick:f},{default:E(()=>[k[4]||(k[4]=y("i",{class:"icon-[lucide--history] block size-4 text-muted-foreground"},null,-1)),p.value>0?(m(),T("span",Wm,z(p.value),1)):A("",!0)]),_:1},8,["class","aria-pressed","aria-label"])),[[x,g.value,void 0,{bottom:!0}]]),v(l)?(m(),O(Ba,{key:0,class:"shrink-0"})):v(s)?(m(),O(za,{key:1})):A("",!0)]),L(wm,{expanded:r.value,"onUpdate:expanded":k[0]||(k[0]=_=>r.value=_),"menu-hovered":c.value},null,8,["expanded","menu-hovered"])])],32))}}}),Bm=Se(Om,[["__scopeId","data-v-377f7d76"]]),Jn=K({__name:"ExtensionSlot",props:{extension:{}},setup(e){const o=e,t=n((a,l)=>{a.render(l)},"mountCustomExtension");return Ct(()=>{o.extension.type==="custom"&&o.extension.destroy&&o.extension.destroy()}),(a,l)=>a.extension.type==="vue"?(m(),O(Kt(a.extension.component),{key:0})):(m(),T("div",{key:1,ref:n(s=>{s&&t(o.extension,s)},"ref")},null,512))}}),zm={class:"flex h-full flex-col"},Fm={class:"flex w-full justify-between"},Um={class:"tabs-container"},Gm={class:"font-normal"},Hm={class:"flex items-center gap-2"},jm={class:"h-0 grow"},qm=K({__name:"BottomPanel",setup(e){const o=Yt(),t=it(),{t:a}=ce(),l=b(()=>{const c=o.activeBottomPanelTabId;return c==="shortcuts-essentials"||c==="shortcuts-view-controls"}),s=n(c=>c!=="shortcuts-essentials"&&c!=="shortcuts-view-controls","shouldCapitalizeTab"),i=n(c=>{const p=c.titleKey?a(c.titleKey):c.title||"";return s(c.id)?p.toUpperCase():p},"getTabDisplayTitle"),r=n(async()=>{t.showSettingsDialog("keybinding")},"openKeybindingSettings"),u=n(()=>{o.activePanel=null},"closeBottomPanel");return(c,p)=>(m(),T("div",zm,[(m(),O(v(Ll),{key:c.$i18n.locale,value:v(o).activeBottomPanelTabId,"onUpdate:value":p[0]||(p[0]=g=>v(o).activeBottomPanelTabId=g),style:{"--p-tabs-tablist-background":"var(--comfy-menu-bg)"}},{default:E(()=>[L(v(Al),{"pt:tab-list":"border-none h-full flex items-center py-2 border-b-1 border-solid",class:"bg-transparent"},{default:E(()=>[y("div",Fm,[y("div",Um,[(m(!0),T(le,null,we(v(o).bottomPanelTabs,g=>(m(),O(v(Dl),{key:g.id,value:g.id,class:J(["m-1 mx-2 border-none",{"tab-list-single-item":v(o).bottomPanelTabs.length===1}]),"pt:root":n(d=>({class:{"p-3 rounded-lg":!0,"pointer-events-none":v(o).bottomPanelTabs.length===1},style:{color:"var(--fg-color)",backgroundColor:!d.context.active||v(o).bottomPanelTabs.length===1?"":"var(--bg-color)"}}),"pt:root")},{default:E(()=>[y("span",Gm,z(i(g)),1)]),_:2},1032,["value","class","pt:root"]))),128))]),y("div",Hm,[l.value?(m(),O(v(re),{key:0,label:c.$t("shortcuts.manageShortcuts"),icon:"pi pi-cog",severity:"secondary",size:"small",text:"",onClick:r},null,8,["label"])):A("",!0),L(v(re),{class:"justify-self-end",icon:"pi pi-times",severity:"secondary",size:"small",text:"",onClick:u})])])]),_:1})]),_:1},8,["value"])),y("div",jm,[v(o).bottomPanelVisible&&v(o).activeBottomPanelTab?(m(),O(Jn,{key:0,extension:v(o).activeBottomPanelTab},null,8,["extension"])):A("",!0)])]))}}),Km=Se(qm,[["__scopeId","data-v-d5048ae1"]]);function Fa(e={}){const{useTransform:o=!1}=e,a=fe().getCanvas(),{canvasPosToClientPos:l,update:s}=si(a.canvas,a),i=ne();te([()=>i.get("Comfy.Sidebar.Location"),()=>i.get("Comfy.Sidebar.Size"),()=>i.get("Comfy.UseNewMenu")],()=>s(),{flush:"post"});const r=R({}),u=n(p=>{const{pos:g,size:d,scale:w=a.ds.scale}=p,[h,C]=l(g),[f,S]=d;return o?{position:"fixed",transformOrigin:"0 0",transform:`scale(${w})`,left:`${h}px`,top:`${C}px`,width:`${f}px`,height:`${S}px`}:{position:"fixed",left:`${h}px`,top:`${C}px`,width:`${f*w}px`,height:`${S*w}px`}},"computeStyle");return{style:r,updatePosition:n(p=>{r.value=u(p)},"updatePosition")}}n(Fa,"useAbsolutePosition");function Qm(e,o){const t=Math.max(e.x,o.x),a=Math.max(e.y,o.y),l=Math.min(e.x+e.width,o.x+o.width),s=Math.min(e.y+e.height,o.y+o.height);return t>=l||a>=s?null:[t,a,l-t,s-a]}n(Qm,"intersect");const Jm=n((e={})=>{const o=R({}),{margin:t=4}=e,a=n((s,i,r,u)=>{if(!r&&u){const{scale:c,offset:p}=u,g=Qm({x:s.left-i.left,y:s.top-i.top,width:s.width,height:s.height},{x:(u.x+p[0]-t)*c,y:(u.y+p[1]-t)*c,width:(u.width+2*t)*c,height:(u.height+2*t)*c});if(!g)return"";const d=(g[0]-s.left+i.left)/c+"px",w=(g[1]-s.top+i.top)/c+"px",h=g[2]/c+"px",C=g[3]/c+"px";return`polygon(0% 0%, 0% 100%, ${d} 100%, ${d} ${w}, calc(${d} + ${h}) ${w}, calc(${d} + ${h}) calc(${w} + ${C}), ${d} calc(${w} + ${C}), ${d} 100%, 100% 100%, 100% 0%)`}return""},"calculateClipPath");return{style:o,updateClipPath:n((s,i,r,u)=>{const c=s.getBoundingClientRect(),p=i.getBoundingClientRect(),g=a(c,p,r,u);o.value={clipPath:g||"none",willChange:"clip-path"}},"updateClipPath")}},"useDomClipping"),Ym=["title"],Zm=K({__name:"DomWidget",props:{widgetState:{}},emits:["update:widgetValue"],setup(e,{emit:o}){const t=e.widgetState.widget,a=o,l=R(),s=R({}),{style:i,updatePosition:r}=Fa({useTransform:!0}),{style:u,updateClipPath:c}=Jm(),p=fe(),g=ne(),d=b(()=>g.get("Comfy.DOMClippingEnabled")),w=n(()=>{const k=p.canvas;if(!k||!l.value)return;const x=Object.values(k.selected_nodes??{})[0];if(!x){c(l.value,k.canvas,!1,void 0);return}const _=x===e.widgetState.widget.node,M=x?.renderArea,N=k.ds.offset,I=k.ds.scale,V=M?{x:M[0],y:M[1],width:M[2],height:M[3],scale:I,offset:[N[0],N[1]]}:void 0;c(l.value,k.canvas,_,V)},"updateDomClipping"),{left:h,top:C}=js(p.getCanvas().canvas);te([()=>e.widgetState,h,C],([k,x,_])=>{r(k),d.value&&w(),s.value={...i.value,...d.value?u.value:{},zIndex:k.zIndex,pointerEvents:k.readonly||t.computedDisabled?"none":"auto",opacity:t.computedDisabled?.5:1}},{deep:!0}),te(()=>e.widgetState.visible,(k,x)=>{!k&&x&&t.options.onHide?.(t)}),Re(document,"mousedown",k=>{!lo(t)||!e.widgetState.visible||!t.element.blur||t.element.contains(k.target)||t.element.blur()}),De(()=>{lo(t)&&Re(t.element,t.options.selectOn??["focus","click"],()=>{const k=p.canvas;k?.selectNode(e.widgetState.widget.node),k?.bringToFront(e.widgetState.widget.node)})});const S=t.node.constructor.nodeData?.inputs?.[t.name]?.tooltip,$=n(()=>{e.widgetState.visible&&lo(t)&&l.value&&(l.value.contains(t.element)||l.value.appendChild(t.element))},"mountElementIfVisible");return De(()=>{Le(()=>{$()}).catch(k=>{console.error("Error mounting DOM widget element:",k)})}),te(()=>e.widgetState.visible,()=>{$()}),(k,x)=>ue((m(),T("div",{ref_key:"widgetElement",ref:l,class:"dom-widget",title:v(S),style:pe(s.value)},[v(ai)(v(t))?(m(),O(Kt(v(t).component),kt({key:0,"model-value":v(t).value,widget:v(t)},v(t).props,{"onUpdate:modelValue":x[0]||(x[0]=_=>a("update:widgetValue",_))}),null,16,["model-value","widget"])):A("",!0)],12,Ym)),[[Qe,k.widgetState.visible]])}}),Xm=Se(Zm,[["__scopeId","data-v-781496d2"]]),ev={class:"isolate"},tv=K({__name:"DomWidgets",setup(e){const o=li(),t=b(()=>[...o.widgetStates.values()]),a=n(()=>{const s=l.canvas;if(!s)return;const i=s.low_quality,r=s.graph;for(const u of t.value){const c=u.widget;if(!c.isVisible()||!u.active){u.visible=!1;continue}const p=c.node,g=r?.nodes.includes(p);if(u.visible=!!g&&s.isNodeVisible(p)&&!(c.options.hideOnZoom&&i),u.visible&&p){const d=c.margin;u.pos=[p.pos[0]+d,p.pos[1]+d+c.y],u.size=[(c.width??p.width)-d*2,(c.computedHeight??50)-d*2],u.zIndex=s.graph?.nodes.indexOf(p)??-1,u.readonly=s.read_only}}},"updateWidgets"),l=fe();return Ko(()=>l.canvas,s=>s.onDrawForeground=po(s.onDrawForeground,a),{immediate:!0}),(s,i)=>(m(),T("div",ev,[(m(!0),T(le,null,we(t.value,r=>(m(),O(Xm,{key:r.widget.id,"widget-state":r,"onUpdate:widgetValue":n(u=>r.widget.value=u,"onUpdate:widgetValue")},null,8,["widget-state","onUpdate:widgetValue"]))),128))]))}});function ov(){const e=R(!1),o=n(()=>{e.value=!0},"showModal"),t=n(()=>{e.value=!1},"hideModal"),a=n(()=>{e.value=!e.value},"toggleModal"),l=b(()=>e.value);return{isModalVisible:e,showModal:o,hideModal:t,toggleModal:a,hasActivePopup:l}}n(ov,"useZoomControls");function nv(e,o){const t=new Map,a=R(""),l=R(0),s=R({bounds:!1,nodes:!1,connections:!1,viewport:!1}),i=Ce.getVersion(),r=new Map,u=qs(()=>{o()},500),c=n(()=>{const C=e.value;if(!C||r.has(C.id))return;const f={onNodeAdded:C.onNodeAdded,onNodeRemoved:C.onNodeRemoved,onConnectionChange:C.onConnectionChange,onTrigger:C.onTrigger};r.set(C.id,f),C.onNodeAdded=function(S){f.onNodeAdded?.call(this,S),u()},C.onNodeRemoved=function(S){f.onNodeRemoved?.call(this,S),t.delete(S.id),u()},C.onConnectionChange=function(S){f.onConnectionChange?.call(this,S),u()},C.onTrigger=function(S){f.onTrigger?.call(this,S),S.type==="node:property:changed"&&(S.property==="mode"||S.property==="bgcolor"||S.property==="color")&&(t.delete(String(S.nodeId)),u())}},"setupEventListeners"),p=n(C=>{const f=C||e.value;if(!f)return;const S=r.get(f.id);if(!S){console.error("Attempted to cleanup event listeners for graph that was never set up");return}f.onNodeAdded=S.onNodeAdded,f.onNodeRemoved=S.onNodeRemoved,f.onConnectionChange=S.onConnectionChange,f.onTrigger=S.onTrigger,r.delete(f.id)},"cleanupEventListeners");return{updateFlags:s,setupEventListeners:c,cleanupEventListeners:p,checkForChanges:n(()=>{const C=e.value;if(!C)return!1;let f=!1,S=!1,$=!1;const k=ha.create(C),x=k.getNodeCount();x!==l.value&&(f=!0,l.value=x);const _=k.getNodes();for(const I of _){const V=I.id,P=`${I.x},${I.y},${I.width},${I.height}`;t.get(V)!==P&&(S=!0,t.set(V,P))}const M=new Set(_.map(I=>I.id));for(const[I]of t)M.has(I)||(t.delete(I),f=!0);const N=JSON.stringify(C.links||{});return N!==a.value&&($=!0,a.value=N),(f||S)&&(s.value.bounds=!0,s.value.nodes=!0),$&&(s.value.connections=!0),f||S||$},"checkForChangesInternal"),init:n(()=>{c(),he.addEventListener("graphChanged",u),te(i,()=>{u()})},"init"),destroy:n(()=>{p(),he.removeEventListener("graphChanged",u),t.clear()},"destroy"),clearCache:n(()=>{t.clear(),a.value="",l.value=0},"clearCache")}}n(nv,"useMinimapGraph");function sv(e,o,t,a,l,s,i){const r=R(!1),u=R({left:0,top:0,width:a,height:l}),c=n(()=>{if(!e.value)return;const f=e.value.getBoundingClientRect();u.value={left:f.left,top:f.top,width:f.width,height:f.height}},"updateContainerRect"),p=n(f=>{r.value=!0,c();const S=f.currentTarget;S instanceof HTMLElement&&S.setPointerCapture(f.pointerId),g(f)},"handlePointerDown"),g=n(f=>{if(!r.value||!i.value)return;const S=f.clientX-u.value.left,$=f.clientY-u.value.top,k=(a-o.value.width*t.value)/2,x=(l-o.value.height*t.value)/2,_=(S-k)/t.value+o.value.minX,M=($-x)/t.value+o.value.minY;s(_,M)},"handlePointerMove"),d=n(f=>{if(r.value=!1,!f)return;const S=f.currentTarget;S instanceof HTMLElement&&S.hasPointerCapture(f.pointerId)&&S.releasePointerCapture(f.pointerId)},"releasePointer");return{isDragging:r,containerRect:u,updateContainerRect:c,handlePointerDown:p,handlePointerMove:g,handlePointerUp:d,handlePointerCancel:d,handleWheel:n(f=>{f.preventDefault();const S=i.value;if(!S)return;u.value.left===0&&u.value.top===0&&e.value&&c();const $=S.ds,k=f.deltaY>0?.9:1.1,x=$.scale*k;if(x<.1||x>10)return;const N=f.clientX-u.value.left,I=f.clientY-u.value.top,V=(a-o.value.width*t.value)/2,P=(l-o.value.height*t.value)/2,G=(N-V)/t.value+o.value.minX,D=(I-P)/t.value+o.value.minY;$.scale=x,s(G,D)},"handleWheel")}}n(sv,"useMinimapInteraction");function av(e,o,t,a,l,s,i,r){const u=R(!0),c=R(!0),p=n(()=>{const w=o.value;if(!e.value||!w)return;const h=e.value.getContext("2d");if(!h)return;if(!w._nodes||w._nodes.length===0){h.clearRect(0,0,i,r);return}(u.value||l.value.nodes||l.value.connections)&&(ii(e.value,w,{bounds:t.value,scale:a.value,settings:{nodeColors:s.nodeColors.value,showLinks:s.showLinks.value,showGroups:s.showGroups.value,renderBypass:s.renderBypass.value,renderError:s.renderError.value},width:i,height:r}),u.value=!1,l.value.nodes=!1,l.value.connections=!1)},"renderMinimap");return{needsFullRedraw:u,needsBoundsUpdate:c,renderMinimap:p,updateMinimap:n((w,h)=>{(c.value||l.value.bounds)&&(w(),c.value=!1,l.value.bounds=!1,u.value=!0,l.value.viewport=!0),(u.value||l.value.nodes||l.value.connections)&&p(),l.value.viewport&&(h(),l.value.viewport=!1)},"updateMinimap"),forceFullRedraw:n(()=>{u.value=!0,l.value.bounds=!0,l.value.nodes=!0,l.value.connections=!0,l.value.viewport=!0},"forceFullRedraw")}}n(av,"useMinimapRenderer");function lv(){const e=ne(),o=ft(),t=b(()=>e.get("Comfy.Minimap.NodeColors")),a=b(()=>e.get("Comfy.Minimap.ShowLinks")),l=b(()=>e.get("Comfy.Minimap.ShowGroups")),s=b(()=>e.get("Comfy.Minimap.RenderBypassState")),i=b(()=>e.get("Comfy.Minimap.RenderErrorState")),r=253,u=200,c=b(()=>o.completedActivePalette.light_theme),p=b(()=>({width:`${r}px`,height:`${u}px`,border:"1px solid var(--interface-stroke)",borderRadius:"8px"})),g=b(()=>({width:"210px",height:`${u}px`,border:"1px solid var(--interface-stroke)",borderRadius:"8px"}));return{nodeColors:t,showLinks:a,showGroups:l,renderBypass:s,renderError:i,containerStyles:p,panelStyles:g,isLightTheme:c}}n(lv,"useMinimapSettings");function iv(e,o,t,a){const l=R({minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}),s=R(1),i=R({x:0,y:0,width:0,height:0}),r=R({width:0,height:0}),u=n(()=>{const f=e.value;if(!f)return;const S=f.canvas,$=window.devicePixelRatio||1;r.value={width:S.clientWidth||S.width/$,height:S.clientHeight||S.height/$}},"updateCanvasDimensions"),c=n(()=>{const f=ha.create(o.value);if(!f.hasData())return{minX:0,minY:0,maxX:100,maxY:100,width:100,height:100};const S=f.getBounds();return ri(S)},"calculateGraphBounds"),p=n(()=>ui(l.value,t,a),"calculateScale"),g=n(()=>{const f=e.value;if(!f)return;(r.value.width===0||r.value.height===0)&&u();const S=f.ds,$=r.value.width/S.scale,k=r.value.height/S.scale,x=-S.offset[0],_=-S.offset[1],M=(t-l.value.width*s.value)/2,N=(a-l.value.height*s.value)/2;i.value={x:(x-l.value.minX)*s.value+M,y:(_-l.value.minY)*s.value+N,width:$*s.value,height:k*s.value}},"updateViewport"),d=n(()=>{l.value=c(),s.value=p()},"updateBounds"),w=n((f,S)=>{const $=e.value;if(!$)return;(r.value.width===0||r.value.height===0)&&u();const k=$.ds,x=r.value.width/k.scale,_=r.value.height/k.scale;k.offset[0]=-(f-x/2),k.offset[1]=-(S-_/2),$.setDirty(!0,!0)},"centerViewOn"),{resume:h,pause:C}=go(g);return{bounds:b(()=>l.value),scale:b(()=>s.value),viewportTransform:b(()=>i.value),canvasDimensions:b(()=>r.value),updateCanvasDimensions:u,updateViewport:g,updateBounds:d,centerViewOn:w,startViewportSync:h,stopViewportSync:C}}n(iv,"useMinimapViewport");function Yn(){const e=fe(),o=Me(),t=ne(),a=R(),l=R(),s=R(null),i=R(!0),r=R(!1),u=250,c=200,p=b(()=>e.canvas),g=b(()=>o.activeSubgraph||p.value?.graph),d=lv(),{nodeColors:w,showLinks:h,showGroups:C,renderBypass:f,renderError:S,containerStyles:$,panelStyles:k}=d,x=n(async(H,U)=>{await t.set(H,U),I.forceFullRedraw(),I.updateMinimap(_.updateBounds,_.updateViewport)},"updateOption"),_=iv(p,g,u,c),M=sv(a,_.bounds,_.scale,u,c,_.centerViewOn,p),N=nv(g,()=>{I.forceFullRedraw(),I.updateMinimap(_.updateBounds,_.updateViewport)}),I=av(l,g,_.bounds,_.scale,N.updateFlags,d,u,c),{pause:V,resume:P}=go(async()=>{i.value&&await N.checkForChanges()&&I.updateMinimap(_.updateBounds,_.updateViewport)},{immediate:!1}),G=n(async()=>{r.value||(i.value=t.get("Comfy.Minimap.Visible"),p.value&&g.value&&(N.init(),a.value&&M.updateContainerRect(),_.updateCanvasDimensions(),window.addEventListener("resize",M.updateContainerRect),window.addEventListener("scroll",M.updateContainerRect),window.addEventListener("resize",_.updateCanvasDimensions),I.forceFullRedraw(),I.updateMinimap(_.updateBounds,_.updateViewport),_.updateViewport(),i.value&&(P(),_.startViewportSync()),r.value=!0))},"init"),D=n(()=>{V(),_.stopViewportSync(),N.destroy(),window.removeEventListener("resize",M.updateContainerRect),window.removeEventListener("scroll",M.updateContainerRect),window.removeEventListener("resize",_.updateCanvasDimensions),r.value=!1},"destroy");te(p,async(H,U)=>{U&&(N.cleanupEventListeners(),V(),_.stopViewportSync(),N.destroy(),window.removeEventListener("resize",M.updateContainerRect),window.removeEventListener("scroll",M.updateContainerRect),window.removeEventListener("resize",_.updateCanvasDimensions)),H&&!r.value&&await G()},{immediate:!0,flush:"post"}),te(g,(H,U)=>{H&&H!==U&&(N.cleanupEventListeners(U||void 0),N.setupEventListeners(),I.forceFullRedraw(),I.updateMinimap(_.updateBounds,_.updateViewport))}),te(i,async H=>{H?(a.value&&M.updateContainerRect(),_.updateCanvasDimensions(),I.forceFullRedraw(),await Le(),await Le(),I.updateMinimap(_.updateBounds,_.updateViewport),_.updateViewport(),P(),_.startViewportSync()):(V(),_.stopViewportSync())});const B=n(async()=>{i.value=!i.value,await t.set("Comfy.Minimap.Visible",i.value)},"toggle"),F=n(H=>{s.value=H},"setMinimapRef"),W=b(()=>{const H=_.viewportTransform.value;return{transform:`translate(${H.x}px, ${H.y}px)`,width:`${H.width}px`,height:`${H.height}px`,border:`2px solid ${d.isLightTheme.value?"#E0E0E0":"#FFF"}`,backgroundColor:"rgba(255, 255, 255, 0.2)",willChange:"transform",backfaceVisibility:"hidden",perspective:"1000px",pointerEvents:"none"}});return{visible:b(()=>i.value),initialized:b(()=>r.value),containerRef:a,canvasRef:l,containerStyles:$,viewportStyles:W,panelStyles:k,width:u,height:c,nodeColors:w,showLinks:h,showGroups:C,renderBypass:f,renderError:S,init:G,destroy:D,toggle:B,renderMinimap:I.renderMinimap,handlePointerDown:M.handlePointerDown,handlePointerMove:M.handlePointerMove,handlePointerUp:M.handlePointerUp,handlePointerCancel:M.handlePointerCancel,handleWheel:M.handleWheel,setMinimapRef:F,updateOption:x}}n(Yn,"useMinimap");const rv={class:"flex items-center gap-1 pr-0.5"},uv={class:"rounded-lg bg-interface-panel-selected-surface p-2 group-hover:bg-interface-button-hover-surface"},cv={class:"flex flex-col gap-1"},dv={class:"flex items-center gap-2"},pv={class:"text-[9px] text-text-primary"},fv={class:"flex items-center gap-2"},mv={class:"text-[9px] text-text-primary"},vv=K({__name:"CanvasModeSelector",props:{buttonStyles:{}},setup(e){const o=R(),t=R(),a=ke(),l=fe(),s=b(()=>l.canvas?.read_only??!1),i=b(()=>s.value?"icon-[lucide--hand]":"icon-[lucide--mouse-pointer-2]"),r=b(()=>a.formatKeySequence(a.getCommand("Comfy.Canvas.Unlock")).toUpperCase()),u=b(()=>a.formatKeySequence(a.getCommand("Comfy.Canvas.Lock")).toUpperCase()),c=n(d=>{const w=o.value?.$el||o.value;t.value?.toggle(d,w)},"toggle"),p=n(d=>{d==="select"&&s.value?a.execute("Comfy.Canvas.Unlock"):d==="hand"&&!s.value&&a.execute("Comfy.Canvas.Lock"),t.value?.hide()},"setMode"),g=b(()=>({root:{class:"absolute z-50 -translate-y-2"},content:{class:["mb-2 text-text-primary","shadow-lg border border-interface-stroke","bg-nav-background","rounded-lg","p-2 px-3","min-w-39","select-none"]}}));return(d,w)=>(m(),T(le,null,[L(v(re),{ref_key:"buttonRef",ref:o,severity:"secondary",class:"group h-8 rounded-none! bg-comfy-menu-bg p-0 transition-none! hover:rounded-lg! hover:bg-interface-button-hover-surface!",style:pe(d.buttonStyles),onClick:c},{default:E(()=>[y("div",rv,[y("div",uv,[y("i",{class:J([i.value,"block h-4 w-4"])},null,2)]),w[2]||(w[2]=y("i",{class:"icon-[lucide--chevron-down] block h-4 w-4 pr-1.5"},null,-1))])]),_:1},8,["style"]),L(v(et),{ref_key:"popover",ref:t,"auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:g.value},{default:E(()=>[y("div",cv,[y("div",{class:"flex cursor-pointer items-center justify-between px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:w[0]||(w[0]=h=>p("select"))},[y("div",dv,[w[3]||(w[3]=y("i",{class:"icon-[lucide--mouse-pointer-2] h-4 w-4"},null,-1)),y("span",null,z(d.$t("graphCanvasMenu.select")),1)]),y("span",pv,z(r.value),1)]),y("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:w[1]||(w[1]=h=>p("hand"))},[y("div",fv,[w[4]||(w[4]=y("i",{class:"icon-[lucide--hand] h-4 w-4"},null,-1)),y("span",null,z(d.$t("graphCanvasMenu.hand")),1)]),y("span",mv,z(u.value),1)])])]),_:1},8,["pt"])],64))}}),gv={key:0,class:"absolute right-0 bottom-[62px] z-1300 flex w-[250px] justify-center border-0! bg-inherit!"},hv={class:"flex flex-col gap-1"},yv={class:"font-medium"},bv={class:"text-[9px] text-text-primary"},wv={class:"font-medium"},kv={class:"text-[9px] text-text-primary"},Cv={class:"font-medium"},Sv={class:"text-[9px] text-text-primary"},xv=K({__name:"ZoomControlsModal",props:{visible:{type:Boolean}},setup(e){const o=Yn(),t=ke(),a=fe(),{formatKeySequence:l}=ke(),s=e,i=R(null),r=n(S=>{const $=S.value;isNaN($)||$<1||$>1e3||a.setAppZoomFromPercentage($)},"applyZoom"),u=n(S=>{t.execute(S)},"executeCommand"),c=n(S=>{if(i.value)return;const $=n(()=>t.execute(S),"cmd");$(),i.value=window.setInterval($,100)},"startRepeat"),p=n(()=>{i.value&&(clearInterval(i.value),i.value=null)},"stopRepeat"),g=b(()=>({...o.containerStyles.value,height:void 0,width:void 0})),d=b(()=>l(t.getCommand("Comfy.Canvas.ZoomIn"))),w=b(()=>l(t.getCommand("Comfy.Canvas.ZoomOut"))),h=b(()=>l(t.getCommand("Comfy.Canvas.FitView"))),C=R(null),f=R(null);return te(()=>s.visible,async S=>{S&&(await Le(),f.value?.querySelector("input")?.focus())}),(S,$)=>S.visible?(m(),T("div",gv,[y("div",{class:"w-4/5 rounded-lg border border-interface-stroke bg-interface-panel-surface p-2 text-text-primary shadow-lg select-none",style:pe(g.value),onClick:$[3]||($[3]=Ne(()=>{},["stop"]))},[y("div",hv,[y("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onMousedown:$[0]||($[0]=k=>c("Comfy.Canvas.ZoomIn")),onMouseup:p,onMouseleave:p},[y("span",yv,z(S.$t("graphCanvasMenu.zoomIn")),1),y("span",bv,z(d.value),1)],32),y("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onMousedown:$[1]||($[1]=k=>c("Comfy.Canvas.ZoomOut")),onMouseup:p,onMouseleave:p},[y("span",wv,z(S.$t("graphCanvasMenu.zoomOut")),1),y("span",kv,z(w.value),1)],32),y("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:$[2]||($[2]=k=>u("Comfy.Canvas.FitView"))},[y("span",Cv,z(S.$t("zoomControls.zoomToFit")),1),y("span",Sv,z(h.value),1)]),y("div",{ref_key:"zoomInputContainer",ref:f,class:"zoomInputContainer flex items-center gap-1 rounded bg-input-surface p-2"},[L(v(El),{ref_key:"zoomInput",ref:C,"default-value":v(a).appScalePercentage,min:1,max:1e3,"show-buttons":!1,"use-grouping":!1,unstyled:!0,"input-class":"bg-transparent border-none outline-hidden text-sm shadow-none my-0 w-full",fluid:"",onInput:r,onKeyup:qt(r,["enter"])},null,8,["default-value"]),$[4]||($[4]=y("span",{class:"flex-shrink-0 text-sm text-text-primary"},"%",-1))],512)])],4)])):A("",!0)}}),$v={class:"inline-flex items-center gap-1 px-2 text-xs"},_v=K({__name:"GraphCanvasMenu",setup(e){const{t:o}=ce(),t=ke(),{formatKeySequence:a}=ke(),l=fe(),s=ne(),i=Bt(),r=Yn(),{isModalVisible:u,toggleModal:c,hideModal:p,hasActivePopup:g}=ov(),d=b(()=>{const V=["borderRadius"],P=["borderRadius"],G={border:"none"},D=r.containerStyles.value,B={...Object.fromEntries(Object.entries(D).filter(([W])=>P.includes(W))),...G},F=Object.entries(D).filter(([W])=>V.includes(W)).reduce((W,[H,U])=>({...W,[H]:U}),{});return{buttonStyles:B,buttonGroupStyles:F}}),w=b(()=>s.get("Comfy.LinkRenderMode")===ve.HIDDEN_LINK),h=b(()=>a(t.getCommand("Comfy.Canvas.FitView")).toUpperCase()),C=b(()=>a(t.getCommand("Comfy.Canvas.ToggleMinimap")).toUpperCase()),f=b(()=>["bg-comfy-menu-bg",u.value?"not-active:bg-interface-panel-selected-surface!":"","hover:bg-interface-button-hover-surface!","p-0","h-8","w-15"]),S=b(()=>({"bg-comfy-menu-bg":!0,"hover:bg-interface-button-hover-surface!":!0,"not-active:bg-interface-panel-selected-surface!":s.get("Comfy.Minimap.Visible"),"p-0":!0,"w-8":!0,"h-8":!0})),$=b(()=>{const V=o("graphCanvasMenu.fitView"),P=h.value;return P?`${V} (${P})`:V}),k=b(()=>{const V=s.get("Comfy.Minimap.Visible")?o("zoomControls.hideMinimap"):o("zoomControls.showMinimap"),P=C.value;return P?`${V} (${P})`:V}),x=b(()=>w.value?o("graphCanvasMenu.showLinks"):o("graphCanvasMenu.hideLinks")),_=b(()=>w.value?o("graphCanvasMenu.showLinks"):o("graphCanvasMenu.hideLinks")),M=b(()=>["bg-comfy-menu-bg",w.value?"not-active:bg-interface-panel-selected-surface!":"","hover:bg-interface-button-hover-surface!","p-0","w-8","h-8"]);De(()=>{l.initScaleSync()});const N=n(()=>{t.execute("Comfy.Canvas.ToggleMinimap")},"onMinimapToggleClick"),I=n(()=>{t.execute("Comfy.Canvas.ToggleLinkVisibility")},"onLinkVisibilityToggleClick");return Ct(()=>{l.cleanupScaleSync()}),(V,P)=>{const G=_e("tooltip");return m(),T("div",null,[L(xv,{visible:v(u),onClose:v(p)},null,8,["visible","onClose"]),v(g)?(m(),T("div",{key:0,class:"fixed inset-0 z-1200",onClick:P[0]||(P[0]=(...D)=>v(p)&&v(p)(...D))})):A("",!0),L(v(Vl),{class:"absolute right-0 bottom-0 z-[1200] flex-row gap-1 border-[1px] border-interface-stroke bg-comfy-menu-bg p-2",style:pe({...d.value.buttonGroupStyles}),onWheel:v(i).handleWheel},{default:E(()=>[L(vv,{"button-styles":d.value.buttonStyles},null,8,["button-styles"]),P[6]||(P[6]=y("div",{class:"h-[27px] w-[1px] self-center bg-node-divider"},null,-1)),ue((m(),O(v(re),{severity:"secondary",icon:"pi pi-expand","aria-label":$.value,style:pe(d.value.buttonStyles),class:"h-8 w-8 bg-comfy-menu-bg p-0 hover:bg-interface-button-hover-surface!",onClick:P[1]||(P[1]=()=>v(t).execute("Comfy.Canvas.FitView"))},{icon:E(()=>P[2]||(P[2]=[y("i",{class:"icon-[lucide--focus] h-4 w-4"},null,-1)])),_:1},8,["aria-label","style"])),[[G,$.value,void 0,{top:!0}]]),ue((m(),O(v(re),{ref:"zoomButton",severity:"secondary",label:v(o)("zoomControls.label"),class:J(f.value),"aria-label":v(o)("zoomControls.label"),"data-testid":"zoom-controls-button",style:pe(d.value.buttonStyles),onClick:v(c)},{default:E(()=>[y("span",$v,[y("span",null,z(v(l).appScalePercentage)+"%",1),P[3]||(P[3]=y("i",{class:"icon-[lucide--chevron-down] h-4 w-4"},null,-1))])]),_:1},8,["label","class","aria-label","style","onClick"])),[[G,v(o)("zoomControls.label"),void 0,{top:!0}]]),P[7]||(P[7]=y("div",{class:"h-[27px] w-[1px] self-center bg-node-divider"},null,-1)),ue((m(),O(v(re),{ref:"minimapButton",severity:"secondary","aria-label":k.value,"data-testid":"toggle-minimap-button",style:pe(d.value.buttonStyles),class:J(S.value),onClick:N},{icon:E(()=>P[4]||(P[4]=[y("i",{class:"icon-[lucide--map] h-4 w-4"},null,-1)])),_:1},8,["aria-label","style","class"])),[[G,k.value,void 0,{top:!0}]]),ue((m(),O(v(re),{severity:"secondary",class:J(M.value),"aria-label":_.value,"data-testid":"toggle-link-visibility-button",style:pe(d.value.buttonStyles),onClick:I},{icon:E(()=>P[5]||(P[5]=[y("i",{class:"icon-[lucide--route-off] h-4 w-4"},null,-1)])),_:1},8,["class","aria-label","style"])),[[G,{value:x.value,pt:{root:{style:"z-index: 2; transform: translateY(-20px);"}}},void 0,{top:!0}]])]),_:1},8,["style","onWheel"])])}}}),Tv=K({__name:"NodeTooltip",setup(e){let o;const t=ut(),a=ne(),l=R(),s=R(""),i=R(),r=R();function u(){return s.value=""}n(u,"hideTooltip");async function c(d){if(!d)return;i.value=j.canvas.mouse[0]+"px",r.value=j.canvas.mouse[1]+"px",s.value=d,await Le();const w=l.value?.getBoundingClientRect();w&&(w.right>window.innerWidth&&(i.value=j.canvas.mouse[0]-w.width+"px"),w.top<0&&(r.value=j.canvas.mouse[1]+w.height+"px"))}n(c,"showTooltip");function p(){const{canvas:d}=j,w=d?.node_over;if(!w)return;const h=w.constructor,C=t.nodeDefsByName[w.type??""];if(h.title_mode!==ve.NO_TITLE&&d.graph_mouse[1]<w.pos[1])return c(C?.description);if(w.flags?.collapsed)return;const f=ci(w,d.graph_mouse[0],d.graph_mouse[1],[0,0]);if(f!==-1){const k=w.inputs[f].name,x=ye(`nodeDefs.${Oe(w.type??"")}.inputs.${Oe(k)}.tooltip`,C?.inputs[k]?.tooltip??"");return c(x)}const S=di(w,d.graph_mouse[0],d.graph_mouse[1],[0,0]);if(S!==-1){const k=ye(`nodeDefs.${Oe(w.type??"")}.outputs.${S}.tooltip`,C?.outputs[S]?.tooltip??"");return c(k)}const $=j.canvas.getWidgetAtCursor();if($&&!lo($)){const k=ye(`nodeDefs.${Oe(w.type??"")}.inputs.${Oe($.name)}.tooltip`,C?.inputs[$.name]?.tooltip??"");return c($.tooltip??k)}}return n(p,"onIdle"),Re(window,"mousemove",n(d=>{u(),clearTimeout(o),d.target.nodeName==="CANVAS"&&(o=window.setTimeout(p,a.get("LiteGraph.Node.TooltipDelay")))},"onMouseMove")),Re(window,"click",u),(d,w)=>s.value?(m(),T("div",{key:0,ref_key:"tooltipRef",ref:l,class:"node-tooltip",style:pe({left:i.value,top:r.value})},z(s.value),5)):A("",!0)}}),Nv=Se(Tv,[["__scopeId","data-v-6c42a423"]]),Mv=K({__name:"BypassButton",setup(e){const o=ke(),t=n(async()=>{await o.execute("Comfy.Canvas.ToggleSelectedNodes.Bypass")},"toggleBypass");return(a,l)=>{const s=_e("tooltip");return ue((m(),O(v(re),{severity:"secondary",text:"","data-testid":"bypass-button",class:"hover:bg-secondary-background",onClick:t},{icon:E(()=>l[0]||(l[0]=[y("i",{class:"icon-[lucide--redo-dot] h-4 w-4"},null,-1)])),_:1})),[[s,{value:a.$t("commands.Comfy_Canvas_ToggleSelectedNodes_Bypass.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Iv={class:"relative"},Pv={class:"flex items-center gap-1 px-0"},Rv={key:0,class:"color-picker-container absolute -top-10 left-1/2"},Dv=["data-testid"],Av=K({__name:"ColorPickerButton",setup(e){const{t:o}=ce(),t=fe(),a=ft(),l=Me(),s=b(()=>a.completedActivePalette.light_theme),i=n(f=>io(f,{lightness:.5}),"toLightThemeColor"),r=R(!1),u={name:"noColor",localizedName:o("color.noColor"),value:{dark:ve.NODE_DEFAULT_BGCOLOR,light:i(ve.NODE_DEFAULT_BGCOLOR)}},c=[u,...Object.entries(Xe.node_colors).map(([f,S])=>({name:f,localizedName:o(`color.${f}`),value:{dark:S.bgcolor,light:i(S.bgcolor)}}))],p=R(null),g=n(f=>{const S=f?.name??u.name,$=S===u.name?null:Xe.node_colors[S];for(const k of t.selectedItems)Po(k)&&k.setColorOption($);t.canvas?.setDirty(!0,!0),d.value=$,r.value=!1,l.activeWorkflow?.changeTracker.checkState()},"applyColor"),d=R(null),w=b(()=>d.value?s.value?i(d.value?.bgcolor):d.value?.bgcolor:null),h=b(()=>d.value?.bgcolor?c.find(S=>S.value.dark===d.value?.bgcolor||S.value.light===d.value?.bgcolor)?.localizedName??u.localizedName:null),C=n(f=>{r.value=!1,p.value=null,d.value=pi(f)},"updateColorSelectionFromNode");return te(()=>t.selectedItems,f=>{C(f)},{immediate:!0}),(f,S)=>{const $=_e("tooltip");return m(),T("div",Iv,[ue((m(),O(v(re),{"data-testid":"color-picker-button",severity:"secondary",text:"",onClick:S[0]||(S[0]=()=>r.value=!r.value)},{default:E(()=>[y("div",Pv,[y("i",{class:"pi pi-circle-fill h-4 w-4",style:pe({color:w.value??""})},null,4),S[1]||(S[1]=y("i",{class:"pi pi-chevron-down h-4 w-4 py-1",style:{fontSize:"0.5rem"}},null,-1))])]),_:1})),[[$,{value:h.value??v(o)("color.noColor"),showDelay:1e3},void 0,{top:!0}]]),r.value?(m(),T("div",Rv,[L(v(ia),{"model-value":p.value,options:c,"option-label":"name","data-key":"value","onUpdate:modelValue":g},{option:E(({option:k})=>[ue(y("i",{class:"pi pi-circle-fill",style:pe({color:s.value?k.value.light:k.value.dark}),"data-testid":k.name},null,12,Dv),[[$,k.localizedName,void 0,{top:!0}]])]),_:1},8,["model-value"])])):A("",!0)])}}}),Lv=Se(Av,[["__scopeId","data-v-ae10caa8"]]),Ev=K({__name:"ConfigureSubgraph",setup(e){return(o,t)=>{const a=_e("tooltip");return ue((m(),O(v(re),{severity:"secondary",text:"",icon:"icon-[lucide--settings-2]",onClick:v(ya)},null,8,["onClick"])),[[a,{value:o.$t("commands.Comfy_Graph_EditSubgraphWidgets.label"),showDelay:1e3},void 0,{top:!0}]])}}});function It(){const e=fe(),o=ut(),t=Qt(),a=fi(),{id:l}=mi(),{selectedItems:s}=at(e),i=b(()=>s.value.filter(M=>Mt(M))),r=b(()=>i.value.length!==1?null:o.fromLGraphNode(i.value[0])),u=b(()=>s.value.length>0),c=b(()=>s.value.length===1),p=b(()=>s.value.length>1),g=b(()=>c.value&&Mt(s.value[0])),d=b(()=>g.value&&s.value[0]?.isSubgraphNode?.()),w=b(()=>g.value&&ba(s.value[0])),h=b(()=>s.value.some(M=>M instanceof Dt)),C=b(()=>{const M=ne().get("Comfy.Load3D.3DViewerEnable");return i.value.length===1&&i.value.some(vi)&&M}),f=b(()=>w.value),S=b(()=>Hn(i.value).length>0),$=n(M=>M.length?{collapsed:M.some(N=>N.flags?.collapsed),pinned:M.some(N=>N.pinned),bypassed:M.some(N=>N.mode===Ae.BYPASS)}:{collapsed:!1,pinned:!1,bypassed:!1},"computeSelectionStatesFromNodes"),k=b(()=>$(i.value));return{selectedItems:s,selectedNodes:i,nodeDef:r,showNodeHelp:n(()=>{const M=r.value;if(!M)return;const N=t.activeSidebarTabId===l,I=a.currentHelpNode;if(N&&a.isHelpOpen&&I&&I.nodePath===M.nodePath){a.closeHelp(),t.toggleSidebarTab(l);return}N||t.toggleSidebarTab(l),a.openHelp(M)},"showNodeHelp"),hasAny3DNodeSelected:C,hasAnySelection:u,hasSingleSelection:c,hasMultipleSelection:p,isSingleNode:g,isSingleSubgraph:d,isSingleImageNode:w,hasSubgraphs:h,hasImageNode:f,hasOutputNodesSelected:S,selectedNodesStates:k,computeSelectionFlags:n(()=>$(i.value),"computeSelectionFlags")}}n(It,"useSelectionState");const Vv=K({__name:"ConvertToSubgraphButton",setup(e){const o=ke(),{isSingleSubgraph:t,hasAnySelection:a}=It(),l=t,s=b(()=>a.value&&!t.value);return(i,r)=>{const u=_e("tooltip");return v(l)?ue((m(),O(v(re),{key:0,severity:"secondary","data-testid":"convert-to-subgraph-button",text:"",onClick:r[0]||(r[0]=()=>v(o).execute("Comfy.Graph.UnpackSubgraph"))},{icon:E(()=>r[2]||(r[2]=[y("i",{class:"icon-[lucide--expand] h-4 w-4"},null,-1)])),_:1})),[[u,{value:i.$t("commands.Comfy_Graph_UnpackSubgraph.label"),showDelay:1e3},void 0,{top:!0}]]):s.value?ue((m(),O(v(re),{key:1,severity:"secondary","data-testid":"convert-to-subgraph-button",text:"",onClick:r[1]||(r[1]=()=>v(o).execute("Comfy.Graph.ConvertToSubgraph"))},{icon:E(()=>r[3]||(r[3]=[y("i",{class:"icon-[lucide--shrink]"},null,-1)])),_:1})),[[u,{value:i.$t("commands.Comfy_Graph_ConvertToSubgraph.label"),showDelay:1e3},void 0,{top:!0}]]):A("",!0)}}}),Wv=K({__name:"DeleteButton",setup(e){const o=ke(),{selectedItems:t}=It(),a=b(()=>t.value.some(l=>l.removable!==!1));return(l,s)=>{const i=_e("tooltip");return ue((m(),O(v(re),{severity:"secondary",text:"","icon-class":"w-4 h-4",icon:"pi pi-trash","data-testid":"delete-button",onClick:s[0]||(s[0]=()=>v(o).execute("Comfy.Canvas.DeleteSelectedItems"))},null,512)),[[Qe,a.value],[i,{value:l.$t("commands.Comfy_Canvas_DeleteSelectedItems.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Ov=K({__name:"ExecuteButton",setup(e){const{t:o}=ce(),t=ke(),a=fe(),{selectedNodes:l}=It(),s=a.getCanvas(),i=R(!1),r=b(()=>l.value.filter(Mt).filter(Sr));function u(){if(this.selected&&this.constructor.nodeData?.output_node&&i.value)return{color:"orange",lineWidth:2,padding:10}}n(u,"outputNodeStokeStyle");const c=n(()=>{i.value=!0;for(const d of r.value)d.strokeStyles.outputNode=u;s.setDirty(!0)},"handleMouseEnter"),p=n(()=>{i.value=!1,s.setDirty(!0)},"handleMouseLeave"),g=n(async()=>{await t.execute("Comfy.QueueSelectedOutputNodes")},"handleClick");return(d,w)=>{const h=_e("tooltip");return ue((m(),O(v(re),{class:"size-8 bg-primary-background text-white p-0",text:"",onMouseenter:w[0]||(w[0]=()=>c()),onMouseleave:w[1]||(w[1]=()=>p()),onClick:g},{default:E(()=>w[2]||(w[2]=[y("i",{class:"icon-[lucide--play] size-4"},null,-1)])),_:1})),[[h,{value:v(o)("selectionToolbox.executeButton.tooltip"),showDelay:1e3},void 0,{top:!0}]])}}}),Bv=K({__name:"ExtensionCommandButton",props:{command:{}},setup(e){const o=ke();return(t,a)=>{const l=_e("tooltip");return ue((m(),O(v(re),{severity:"secondary",text:"","icon-class":"w-4 h-4",icon:typeof t.command.icon=="function"?t.command.icon():t.command.icon,onClick:a[0]||(a[0]=()=>v(o).execute(t.command.id))},null,8,["icon"])),[[l,{value:v(ye)(`commands.${v(Oe)(t.command.id)}.label`,"")||void 0,showDelay:1e3},void 0,{top:!0}]])}}}),zv=K({__name:"InfoButton",setup(e){const{showNodeHelp:o}=It(),t=n(()=>{o()},"onInfoClick");return(a,l)=>{const s=_e("tooltip");return ue((m(),O(v(re),{"data-testid":"info-button",text:"",severity:"secondary",onClick:t},{default:E(()=>l[0]||(l[0]=[y("i",{class:"icon-[lucide--info] h-4 w-4"},null,-1)])),_:1})),[[s,{value:a.$t("g.info"),showDelay:1e3},void 0,{top:!0}]])}}}),Fv=K({__name:"Load3DViewerButton",setup(e){const o=ke(),t=n(()=>{o.execute("Comfy.3DViewer.Open3DViewer")},"open3DViewer");return(a,l)=>{const s=_e("tooltip");return ue((m(),O(v(re),{severity:"secondary",text:"",icon:"pi pi-pencil","icon-class":"w-4 h-4",onClick:t},null,512)),[[s,{value:a.$t("commands.Comfy_3DViewer_Open3DViewer.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Uv=K({__name:"MaskEditorButton",setup(e){const o=ke(),{isSingleImageNode:t}=It(),a=n(()=>{o.execute("Comfy.MaskEditor.OpenMaskEditor")},"openMaskEditor");return(l,s)=>{const i=ca,r=_e("tooltip");return ue((m(),O(v(re),{severity:"secondary",text:"",onClick:a},{default:E(()=>[L(i,{class:"!h-4 !w-4"})]),_:1})),[[Qe,v(t)],[r,{value:l.$t("commands.Comfy_MaskEditor_OpenMaskEditor.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Gv=n(e=>e!=null&&typeof e=="object"&&"refresh"in e&&typeof e.refresh=="function","isRefreshableWidget"),Hv=n(()=>{const e=fe(),o=R([]);be(()=>{o.value=e.selectedItems.filter(Mt)});const t=b(()=>o.value.flatMap(s=>{if(!s.widgets)return[];const i=[];for(const r of s.widgets)Gv(r)&&i.push(r);return i})),a=b(()=>t.value.length>0);async function l(){a.value&&await Promise.all(t.value.map(s=>s.refresh()))}return n(l,"refreshSelected"),{isRefreshable:a,refreshSelected:l}},"useRefreshableSelection"),jv=K({__name:"RefreshSelectionButton",setup(e){const{t:o}=ce(),{isRefreshable:t,refreshSelected:a}=Hv();return(l,s)=>{const i=_e("tooltip");return ue((m(),O(v(re),{severity:"secondary",text:"","data-testid":"refresh-button",onClick:v(a)},{default:E(()=>s[0]||(s[0]=[y("i",{class:"icon-[lucide--refresh-cw] h-4 w-4"},null,-1)])),_:1},8,["onClick"])),[[Qe,v(t)],[i,v(o)("g.refreshNode"),void 0,{top:!0}]])}}}),qv=K({__name:"SaveToSubgraphLibrary",setup(e){const o=ke(),t=fe(),a=b(()=>t.selectedItems?.length===1&&t.selectedItems[0]instanceof Dt);return(l,s)=>{const i=_e("tooltip");return ue((m(),O(v(re),{severity:"secondary",text:"",onClick:s[0]||(s[0]=()=>v(o).execute("Comfy.PublishSubgraph"))},{icon:E(()=>s[1]||(s[1]=[y("i",{class:"icon-[lucide--book-open]"},null,-1)])),_:1})),[[Qe,a.value],[i,{value:l.$t("commands.Comfy_PublishSubgraph.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Nt=R(!1),Ua=R(0),Ga=R(0),We=R(!1);let Pt=!1,nt=null;function Eo(e){const o=e.canvas;if(!o)return null;const t=Array.from(o.selectedItems);if(t.length!==1)return null;const a=t[0];return Mt(a)?`N:${a.id}`:wa(a)?`G:${a.id}`:null}n(Eo,"buildSelectionSignature");function Kv(e){return nt?Eo(e)===nt:!1}n(Kv,"currentSelectionMatchesSignature");function Qv(e){const o=fe(),t=o.getCanvas(),{getSelectableItems:a}=Yo(),{shouldRenderVueNodes:l}=Go(),s=R({x:0,y:0}),i=R(!1),{left:r,top:u}=js(t.canvas),c=b(()=>{const S=o.canvas?.state?.draggingItems??!1,$=l.value&&Ce.isDraggingVueNodes.value;return S||$}),p=n(()=>{const S=a();if(!S.size){i.value=!1;return}if(c.value){i.value=!1;return}i.value=!0;const $=[];for(const x of S)if(x.id!=null)if(l.value&&typeof x.id=="string"){const _=Ce.getNodeLayoutRef(x.id).value;_&&$.push([_.bounds.x,_.bounds.y,_.bounds.width,_.bounds.height])}else(x instanceof pt||x instanceof At)&&$.push([x.pos[0],x.pos[1]-ve.NODE_TITLE_HEIGHT,x.size[0],x.size[1]+ve.NODE_TITLE_HEIGHT]);const k=xr($);k&&(s.value={x:k.x+k.width/2,y:k.y-10},g())},"updateSelectionBounds"),g=n(()=>{if(!i.value)return;const{scale:S,offset:$}=t.ds,k=(s.value.x+$[0])*S+r.value,x=(s.value.y+$[1])*S+u.value;e.value&&(e.value.style.setProperty("--tb-x",`${k}px`),e.value.style.setProperty("--tb-y",`${x}px`))},"updateTransform"),{resume:d,pause:w}=go(g);be(()=>{i.value?d():w()}),te(()=>o.getCanvas().state.selectionChanged,S=>{S&&((We.value||nt)&&(We.value=!1,Pt=!1,Nt.value?nt=Eo(o):nt=null),p(),o.getCanvas().state.selectionChanged=!1)},{immediate:!0}),te(()=>Nt.value,S=>{S?nt=Eo(o):o.canvas?.state?.draggingItems||(nt=null,We.value&&(We.value=!1))});const h=n(S=>{if(S){C();return}f()},"handleDragStateChange"),C=n(()=>{if(i.value=!1,!Nt.value){We.value=!1,Pt=!1;return}if(Eo(o)!==nt&&(nt=null),Nt.value=!1,Pt=!0,We.value=!!nt,We.value){Ua.value++;return}Pt=!1},"handleDragStart"),f=n(()=>{requestAnimationFrame(()=>{p();const S=Kv(o),$=Pt&&i.value&&We.value&&S;We.value=$&&We.value,Pt=!1,$&&Ga.value++})},"handleDragEnd");return te(c,h),rt(()=>{Jv()}),{visible:i}}n(Qv,"useSelectionToolboxPosition");function Jv(){Nt.value=!1,We.value=!1,Pt=!1,nt=null}n(Jv,"resetMoreOptionsState");function Ha(){const e=ne(),o=Zo(),{hasMultipleSelection:t}=It(),a=b(()=>t.value);return{frameNodes:n(()=>{const{canvas:s}=j;if(!s.selectedItems?.size)return;const i=new At,r=e.get("Comfy.GroupSelectedNodes.Padding");i.resizeTo(s.selectedItems,r),s.graph?.add(i),o.titleEditorTarget=i},"frameNodes"),canFrame:a}}n(Ha,"useFrameNodes");const Yv=K({__name:"FrameNodes",setup(e){const{frameNodes:o}=Ha();return(t,a)=>{const l=_e("tooltip");return ue((m(),O(v(re),{class:"frame-nodes-button",text:"",severity:"secondary",onClick:v(o)},{default:E(()=>a[0]||(a[0]=[y("i",{class:"icon-[lucide--frame] h-4 w-4"},null,-1)])),_:1},8,["onClick"])),[[l,{value:t.$t("g.frameNodes"),showDelay:1e3},void 0,{top:!0}]])}}});function Zn(){const e=fe(),o=Me();return{refreshCanvas:n(()=>{e.canvas?.emitBeforeChange(),e.canvas?.setDirty(!0,!0),e.canvas?.graph?.afterChange(),e.canvas?.emitAfterChange(),o.activeWorkflow?.changeTracker?.checkState()},"refreshCanvas")}}n(Zn,"useCanvasRefresh");function Xn(){const{t:e}=ce(),o=fe(),t=ft(),a=Zn(),l=b(()=>t.completedActivePalette.light_theme),s=n(w=>io(w,{lightness:.5}),"toLightThemeColor"),i={name:"noColor",localizedName:e("color.noColor"),value:{dark:ve.NODE_DEFAULT_BGCOLOR,light:s(ve.NODE_DEFAULT_BGCOLOR)}},r=[i,...Object.entries(Xe.node_colors).map(([w,h])=>({name:w,localizedName:e(`color.${w}`),value:{dark:h.bgcolor,light:s(h.bgcolor)}}))],u=[{name:"default",localizedName:e("shape.default"),value:Co.ROUND},{name:"box",localizedName:e("shape.box"),value:Co.BOX},{name:"card",localizedName:e("shape.CARD"),value:Co.CARD}];return{colorOptions:r,shapeOptions:u,applyColor:n(w=>{const h=w?.name??i.name,C=h===i.name?null:Xe.node_colors[h];for(const f of o.selectedItems)Po(f)&&f.setColorOption(C);a.refreshCanvas()},"applyColor"),applyShape:n(w=>{const h=Array.from(o.selectedItems).filter(C=>C instanceof pt);h.length!==0&&(h.forEach(C=>{C.shape=w.value}),a.refreshCanvas())},"applyShape"),getCurrentColor:n(()=>{const w=Array.from(o.selectedItems);if(w.length===0)return null;const h=w.find(S=>Po(S));if(!h||!Po(h))return null;const f=h.getColorOption()?.bgcolor??null;return r.find(S=>S.value.dark===f||S.value.light===f)??i},"getCurrentColor"),getCurrentShape:n(()=>{const w=Array.from(o.selectedItems).filter(f=>f instanceof pt);if(w.length===0)return null;const C=w[0].shape??Co.ROUND;return u.find(f=>f.value===C)??u[0]},"getCurrentShape"),isLightTheme:l}}n(Xn,"useNodeCustomization");function Zv(){const{t:e}=ce(),o=fe(),t=Me(),a=ne(),l=Zn(),{shapeOptions:s,colorOptions:i,isLightTheme:r}=Xn();return{getFitGroupToNodesOption:n(d=>({label:"Fit Group To Nodes",icon:"icon-[lucide--move-diagonal-2]",action:n(()=>{try{d.recomputeInsideNodes()}catch(h){console.warn("Failed to recompute group nodes:",h);return}const w=a.get("Comfy.GroupSelectedNodes.Padding");d.resizeTo(d.children,w),d.graph?.change(),o.canvas?.setDirty(!0,!0),t.activeWorkflow?.changeTracker?.checkState()},"action")}),"getFitGroupToNodesOption"),getGroupShapeOptions:n((d,w)=>({label:e("contextMenu.Shape"),icon:"icon-[lucide--box]",hasSubmenu:!0,submenu:s.map(h=>({label:h.localizedName,action:n(()=>{(d.nodes||[]).forEach(f=>f.shape=h.value),l.refreshCanvas(),w()},"action")}))}),"getGroupShapeOptions"),getGroupColorOptions:n((d,w)=>({label:e("contextMenu.Color"),icon:"icon-[lucide--palette]",hasSubmenu:!0,submenu:i.map(h=>({label:h.localizedName,color:r.value?h.value.light:h.value.dark,action:n(()=>{d.color=r.value?h.value.light:h.value.dark,l.refreshCanvas(),w()},"action")}))}),"getGroupColorOptions"),getGroupModeOptions:n((d,w)=>{const h=[];try{d.recomputeInsideNodes()}catch($){return console.warn("Failed to recompute group nodes for mode options:",$),h}const C=d.nodes||[];if(!C.length)return h;let f=!0;for(let $=1;$<C.length;$++)if(C[$].mode!==C[0].mode){f=!1;break}const S=n(($,k)=>({label:e(`selectionToolbox.${$}`),icon:k===Ae.BYPASS?"icon-[lucide--ban]":k===Ae.NEVER?"icon-[lucide--zap-off]":"icon-[lucide--play]",action:n(()=>{C.forEach(x=>{x.mode=k}),o.canvas?.setDirty(!0,!0),d.graph?.change(),t.activeWorkflow?.changeTracker?.checkState(),w()},"action")}),"createModeAction");if(f)switch(C[0].mode){case Ae.ALWAYS:h.push(S("Set Group Nodes to Never",Ae.NEVER)),h.push(S("Bypass Group Nodes",Ae.BYPASS));break;case Ae.NEVER:h.push(S("Set Group Nodes to Always",Ae.ALWAYS)),h.push(S("Bypass Group Nodes",Ae.BYPASS));break;case Ae.BYPASS:h.push(S("Set Group Nodes to Always",Ae.ALWAYS)),h.push(S("Set Group Nodes to Never",Ae.NEVER));break;default:h.push(S("Set Group Nodes to Always",Ae.ALWAYS)),h.push(S("Set Group Nodes to Never",Ae.NEVER)),h.push(S("Bypass Group Nodes",Ae.BYPASS));break}else h.push(S("Set Group Nodes to Always",Ae.ALWAYS)),h.push(S("Set Group Nodes to Never",Ae.NEVER)),h.push(S("Bypass Group Nodes",Ae.BYPASS));return h},"getGroupModeOptions")}}n(Zv,"useGroupMenuOptions");function Xv(){const{t:e}=ce(),o=n(()=>{ke().execute("Comfy.MaskEditor.OpenMaskEditor")},"openMaskEditor"),t=n(i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(!r)return;const u=new URL(r.src);u.searchParams.delete("preview"),window.open(u.toString(),"_blank")},"openImage"),a=n(async i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(!r)return;const u=document.createElement("canvas"),c=u.getContext("2d");if(c){u.width=r.naturalWidth,u.height=r.naturalHeight,c.drawImage(r,0,0);try{const p=await new Promise(g=>{u.toBlob(g,"image/png")});if(!p){console.warn("Failed to create image blob");return}if(!navigator.clipboard?.write){console.warn("Clipboard API not available");return}await navigator.clipboard.write([new ClipboardItem({"image/png":p})])}catch(p){console.error("Failed to copy image to clipboard:",p)}}},"copyImage"),l=n(i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(r)try{const u=new URL(r.src);u.searchParams.delete("preview"),Jo(u.toString())}catch(u){console.error("Failed to save image:",u)}},"saveImage");return{getImageMenuOptions:n(i=>i?.imgs?.length?[{label:e("contextMenu.Open in Mask Editor"),action:n(()=>o(),"action")},{label:e("contextMenu.Open Image"),icon:"icon-[lucide--external-link]",action:n(()=>t(i),"action")},{label:e("contextMenu.Copy Image"),icon:"icon-[lucide--copy]",action:n(()=>a(i),"action")},{label:e("contextMenu.Save Image"),icon:"icon-[lucide--download]",action:n(()=>l(i),"action")}]:[],"getImageMenuOptions")}}n(Xv,"useImageMenuOptions");function eg(){const{getSelectedNodes:e,toggleSelectedNodesMode:o}=Yo(),t=ke(),a=Me();return{adjustNodeSize:n(()=>{e().forEach(p=>{const g=p.computeSize();p.setSize([g[0],g[1]])}),j.canvas.setDirty(!0,!0),a.activeWorkflow?.changeTracker?.checkState()},"adjustNodeSize"),toggleNodeCollapse:n(()=>{e().forEach(p=>{p.collapse()}),j.canvas.setDirty(!0,!0),a.activeWorkflow?.changeTracker?.checkState()},"toggleNodeCollapse"),toggleNodePin:n(()=>{e().forEach(p=>{p.pin(!p.pinned)}),j.canvas.setDirty(!0,!0),a.activeWorkflow?.changeTracker?.checkState()},"toggleNodePin"),toggleNodeBypass:n(()=>{o(Ae.BYPASS),j.canvas.setDirty(!0,!0)},"toggleNodeBypass"),runBranch:n(async()=>{const c=e();Hn(c).length!==0&&await t.execute("Comfy.QueueSelectedOutputNodes")},"runBranch")}}n(eg,"useSelectedNodeActions");function tg(){const{t:e}=ce(),{shapeOptions:o,applyShape:t,applyColor:a,colorOptions:l,isLightTheme:s}=Xn(),{adjustNodeSize:i,toggleNodeCollapse:r,toggleNodePin:u,toggleNodeBypass:c,runBranch:p}=eg(),g=b(()=>o.map(k=>({label:k.localizedName,action:n(()=>t(k),"action")}))),d=b(()=>l.map(k=>({label:k.localizedName,color:s.value?k.value.light:k.value.dark,action:n(()=>a(k.name==="noColor"?null:k),"action")})));return{getNodeInfoOption:n(k=>({label:e("contextMenu.Node Info"),icon:"icon-[lucide--info]",action:k}),"getNodeInfoOption"),getAdjustSizeOption:n(()=>({label:e("contextMenu.Adjust Size"),icon:"icon-[lucide--move-diagonal-2]",action:i}),"getAdjustSizeOption"),getNodeVisualOptions:n((k,x)=>[{label:k.collapsed?e("contextMenu.Expand Node"):e("contextMenu.Minimize Node"),icon:k.collapsed?"icon-[lucide--maximize-2]":"icon-[lucide--minimize-2]",action:n(()=>{r(),x()},"action")},{label:e("contextMenu.Shape"),icon:"icon-[lucide--box]",hasSubmenu:!0,submenu:g.value,action:n(()=>{},"action")},{label:e("contextMenu.Color"),icon:"icon-[lucide--palette]",hasSubmenu:!0,submenu:d.value,action:n(()=>{},"action")}],"getNodeVisualOptions"),getPinOption:n((k,x)=>({label:k.pinned?e("contextMenu.Unpin"):e("contextMenu.Pin"),icon:k.pinned?"icon-[lucide--pin-off]":"icon-[lucide--pin]",action:n(()=>{u(),x()},"action")}),"getPinOption"),getBypassOption:n((k,x)=>({label:k.bypassed?e("contextMenu.Remove Bypass"):e("contextMenu.Bypass"),icon:k.bypassed?"icon-[lucide--zap-off]":"icon-[lucide--ban]",shortcut:"Ctrl+B",action:n(()=>{c(),x()},"action")}),"getBypassOption"),getRunBranchOption:n(()=>({label:e("contextMenu.Run Branch"),icon:"icon-[lucide--play]",action:p}),"getRunBranchOption"),colorSubmenu:d}}n(tg,"useNodeMenuOptions");function og(){const{t:e}=ce(),o=fe(),t=Zn(),a=[{name:"top",localizedName:e("contextMenu.Top"),value:"top",icon:"icon-[lucide--align-start-vertical]"},{name:"bottom",localizedName:e("contextMenu.Bottom"),value:"bottom",icon:"icon-[lucide--align-end-vertical]"},{name:"left",localizedName:e("contextMenu.Left"),value:"left",icon:"icon-[lucide--align-start-horizontal]"},{name:"right",localizedName:e("contextMenu.Right"),value:"right",icon:"icon-[lucide--align-end-horizontal]"}],l=[{name:"horizontal",localizedName:e("contextMenu.Horizontal"),value:!0,icon:"icon-[lucide--align-center-horizontal]"},{name:"vertical",localizedName:e("contextMenu.Vertical"),value:!1,icon:"icon-[lucide--align-center-vertical]"}];return{alignOptions:a,distributeOptions:l,applyAlign:n(r=>{const u=Array.from(o.selectedItems).filter(p=>Mt(p));if(u.length===0)return;const c=gi(u,r.value);o.canvas?.repositionNodesVueMode(c),t.refreshCanvas()},"applyAlign"),applyDistribute:n(r=>{const u=Array.from(o.selectedItems).filter(p=>Mt(p));if(u.length<2)return;const c=hi(u,r.value);o.canvas?.repositionNodesVueMode(c),t.refreshCanvas()},"applyDistribute")}}n(og,"useNodeArrangement");function ng(){const e=fe(),o=wt(),t=it(),a=Zo(),l=Me();return{copySelection:n(()=>{const p=j.canvas;if(!p.selectedItems||p.selectedItems.size===0){o.add({severity:"warn",summary:Z("g.nothingToCopy"),detail:Z("g.selectItemsToCopy"),life:3e3});return}p.copyToClipboard(),o.add({severity:"success",summary:Z("g.copied"),detail:Z("g.itemsCopiedToClipboard"),life:2e3})},"copySelection"),pasteSelection:n(()=>{j.canvas.pasteFromClipboard({connectInputs:!1}),l.activeWorkflow?.changeTracker?.checkState()},"pasteSelection"),duplicateSelection:n(()=>{const p=j.canvas;if(!p.selectedItems||p.selectedItems.size===0){o.add({severity:"warn",summary:Z("g.nothingToDuplicate"),detail:Z("g.selectItemsToDuplicate"),life:3e3});return}p.copyToClipboard(),p.selectedItems.clear(),e.updateSelectedItems(),p.pasteFromClipboard({connectInputs:!1}),l.activeWorkflow?.changeTracker?.checkState()},"duplicateSelection"),deleteSelection:n(()=>{const p=j.canvas;if(!p.selectedItems||p.selectedItems.size===0){o.add({severity:"warn",summary:Z("g.nothingToDelete"),detail:Z("g.selectItemsToDelete"),life:3e3});return}p.deleteSelected(),p.setDirty(!0,!0),l.activeWorkflow?.changeTracker?.checkState()},"deleteSelection"),renameSelection:n(async()=>{const p=Array.from(e.selectedItems);if(p.length===1){const g=p[0];if(g instanceof pt){a.titleEditorTarget=g;return}const d="title"in g?g.title:"",w=await t.prompt({title:Z("g.rename"),message:Z("g.enterNewName"),defaultValue:d});if(w&&w!==d&&"title"in g){const h=g;h.title=w,j.canvas.setDirty(!0,!0),l.activeWorkflow?.changeTracker?.checkState()}return}if(p.length>1){const g=await t.prompt({title:Z("g.batchRename"),message:Z("g.enterBaseName"),defaultValue:"Item"});g&&(p.forEach((d,w)=>{if("title"in d){const h=d;h.title=`${g} ${w+1}`}}),j.canvas.setDirty(!0,!0),l.activeWorkflow?.changeTracker?.checkState());return}o.add({severity:"warn",summary:Z("g.nothingToRename"),detail:Z("g.selectItemsToRename"),life:3e3})},"renameSelection")}}n(ng,"useSelectionOperations");function sg(){const{getSelectedNodes:e}=Yo(),o=fe(),t=Me(),a=Ot(),l=ut(),s=ka(),i=n(()=>{const g=o.getCanvas(),d=g.subgraph??g.graph;if(!d)return null;const w=d.convertToSubgraph(g.selectedItems);if(!w)return;const{node:h}=w;g.select(h),o.updateSelectedItems(),t.activeWorkflow?.changeTracker?.checkState()},"convertToSubgraph");return{convertToSubgraph:i,unpackSubgraph:n(()=>{const g=o.getCanvas(),d=g.subgraph??g.graph;if(!d)return;const h=Array.from(g.selectedItems).filter(C=>C instanceof Dt);h.length!==0&&(h.forEach(C=>{a.revokeSubgraphPreviews(C),d.unpackSubgraph(C)}),t.activeWorkflow?.changeTracker?.checkState())},"unpackSubgraph"),addSubgraphToLibrary:n(async()=>{const g=Array.from(o.selectedItems);if(g.length===1){const h=g[0];if(Mt(h)){const C=l.fromLGraphNode(h);if(C){await s.addBookmark(C.nodePath);return}}}const d=e();if(d.length===0)return;if(!d.some(h=>h instanceof Dt)){i();return}for(const h of d)if(h instanceof Dt){const C=l.fromLGraphNode(h);C&&await s.addBookmark(C.nodePath)}},"addSubgraphToLibrary"),isSubgraphSelected:n(()=>Array.from(o.selectedItems).some(d=>d instanceof Dt),"isSubgraphSelected"),hasSelectableNodes:n(()=>e().length>0,"hasSelectableNodes")}}n(sg,"useSubgraphOperations");function ag(){const{t:e}=ce(),{copySelection:o,duplicateSelection:t,deleteSelection:a,renameSelection:l}=ng(),{alignOptions:s,distributeOptions:i,applyAlign:r,applyDistribute:u}=og(),{convertToSubgraph:c,unpackSubgraph:p,addSubgraphToLibrary:g}=sg(),{frameNodes:d}=Ha(),w=b(()=>s.map(x=>({label:x.localizedName,icon:x.icon,action:n(()=>r(x),"action")}))),h=b(()=>i.map(x=>({label:x.localizedName,icon:x.icon,action:n(()=>u(x),"action")})));return{getBasicSelectionOptions:n(()=>[{label:e("contextMenu.Rename"),action:l},{label:e("contextMenu.Copy"),shortcut:"Ctrl+C",action:o},{label:e("contextMenu.Duplicate"),shortcut:"Ctrl+D",action:t}],"getBasicSelectionOptions"),getSubgraphOptions:n(x=>x?[{label:e("contextMenu.Add Subgraph to Library"),icon:"icon-[lucide--folder-plus]",action:g},{label:e("contextMenu.Unpack Subgraph"),icon:"icon-[lucide--expand]",action:p}]:[{label:e("contextMenu.Convert to Subgraph"),icon:"icon-[lucide--shrink]",action:c,badge:Sn.NEW}],"getSubgraphOptions"),getMultipleNodesOptions:n(()=>{const x=n(()=>{ke().execute("Comfy.GroupNode.ConvertSelectedNodesToGroupNode")},"convertToGroupNodes");return[{label:e("contextMenu.Convert to Group Node"),icon:"icon-[lucide--group]",action:x,badge:Sn.DEPRECATED},{label:e("g.frameNodes"),icon:"icon-[lucide--frame]",action:d}]},"getMultipleNodesOptions"),getDeleteOption:n(()=>({label:e("contextMenu.Delete"),icon:"icon-[lucide--trash-2]",shortcut:"Delete",action:a}),"getDeleteOption"),getAlignmentOptions:n(()=>[{label:e("contextMenu.Align Selected To"),icon:"icon-[lucide--align-start-horizontal]",hasSubmenu:!0,submenu:w.value,action:n(()=>{},"action")},{label:e("contextMenu.Distribute Nodes"),icon:"icon-[lucide--align-center-horizontal]",hasSubmenu:!0,submenu:h.value,action:n(()=>{},"action")}],"getAlignmentOptions"),alignSubmenu:w,distributeSubmenu:h}}n(ag,"useSelectionMenuOptions");var Sn=(e=>(e.NEW="new",e.DEPRECATED="deprecated",e))(Sn||{});let xn=null;function ja(e,o,t=!1){xn?.toggle&&xn.toggle(e,o,t)}n(ja,"toggleNodeOptions");function $n(e){xn=e}n($n,"registerNodeOptionsInstance");function lg(){const{selectedItems:e,selectedNodes:o,nodeDef:t,showNodeHelp:a,hasSubgraphs:l,hasImageNode:s,hasOutputNodesSelected:i,hasMultipleSelection:r,computeSelectionFlags:u}=It(),{getImageMenuOptions:c}=Xv(),{getNodeInfoOption:p,getAdjustSizeOption:g,getNodeVisualOptions:d,getPinOption:w,getBypassOption:h,getRunBranchOption:C}=tg(),{getFitGroupToNodesOption:f,getGroupShapeOptions:S,getGroupColorOptions:$,getGroupModeOptions:k}=Zv(),{getBasicSelectionOptions:x,getSubgraphOptions:_,getMultipleNodesOptions:M,getDeleteOption:N,getAlignmentOptions:I}=ag(),V=l,P=r,G=R(0),D=n(()=>{G.value++},"bump"),B=b(()=>{G.value;const W=u(),H=e.value.filter(wa),U=H.length===1&&o.value.length===0?H[0]:null,q=V.value,Q=[];return Q.push(...x()),Q.push({type:"divider"}),t.value&&Q.push(p(a)),U?Q.push(f(U)):Q.push(g()),U?(Q.push(S(U,D)),Q.push($(U,D)),Q.push({type:"divider"})):(Q.push(...d(W,D)),Q.push({type:"divider"})),s.value&&o.value.length>0&&Q.push(...c(o.value[0])),Q.push(..._(q)),P.value&&Q.push(...M()),Q.push({type:"divider"}),U||Q.push(w(W,D)),P.value&&Q.push(...I()),U?Q.push(...k(U,D)):Q.push(h(W,D)),i.value&&Q.push(C()),Q.push({type:"divider"}),Q.push(N()),Q}),F=b(()=>B.value.filter(W=>W.hasSubmenu&&W.submenu));return{menuOptions:B,menuOptionsWithSubmenu:F,bump:D,hasSubgraphs:V,registerNodeOptionsInstance:$n}}n(lg,"useMoreOptionsMenu");const ig=K({__name:"NodeOptionsButton",setup(e){const o=R(null),t=n(a=>{const l=o.value?.$el||o.value,s=l instanceof HTMLElement?l:null;s&&ja(a,s,!0)},"handleClick");return(a,l)=>{const s=_e("tooltip");return ue((m(),O(v(re),{ref_key:"buttonRef",ref:o,"data-testid":"more-options-button",text:"",class:"h-8 w-8 px-0",severity:"secondary",onClick:t},{default:E(()=>l[0]||(l[0]=[y("i",{class:"icon-[lucide--more-vertical] h-4 w-4"},null,-1)])),_:1})),[[s,{value:a.$t("g.moreOptions"),showDelay:1e3},void 0,{top:!0}]])}}}),rg={},ug={class:"h-6 w-px self-center bg-border-default"};function cg(e,o){return m(),T("div",ug)}n(cg,"_sfc_render$1");const Is=Se(rg,[["render",cg]]),dg=K({__name:"SelectionToolbox",setup(e){const o=ke(),t=fe(),a=yi(),l=Bt(),s=R(),{visible:i}=Qv(s),r=b(()=>{const B=new Set(t.selectedItems.map(F=>a.invokeExtensions("getSelectionToolboxCommands",F).flat()).flat());return Array.from(B).map(F=>o.getCommand(F)).filter(F=>F!==void 0)}),{hasAnySelection:u,hasMultipleSelection:c,isSingleNode:p,isSingleSubgraph:g,isSingleImageNode:d,hasAny3DNodeSelected:w,hasOutputNodesSelected:h,nodeDef:C}=It(),f=b(()=>!!C.value),S=b(()=>u.value),$=b(()=>u.value),k=b(()=>c.value),x=b(()=>g.value),_=b(()=>p.value||g.value||c.value),M=b(()=>w.value),N=b(()=>d.value),I=b(()=>u.value),V=b(()=>u.value),P=b(()=>h.value),G=b(()=>S.value||$.value||k.value||x.value),D=b(()=>_.value);return(B,F)=>(m(),T("div",{ref_key:"toolboxRef",ref:s,style:{transform:"translate(var(--tb-x), var(--tb-y))"},class:"pointer-events-none fixed top-0 left-0 z-40"},[L(Rn,{name:"slide-up"},{default:E(()=>[v(i)?(m(),O(v(aa),{key:0,class:"selection-toolbox pointer-events-auto rounded-lg border border-interface-stroke bg-interface-panel-surface",pt:{header:"hidden",content:"p-2 h-12 flex flex-row gap-1"},onWheel:v(l).forwardEventToCanvas},{default:E(()=>[I.value?(m(),O(Wv,{key:0})):A("",!0),f.value&&G.value?(m(),O(Is,{key:1})):A("",!0),f.value?(m(),O(zv,{key:2})):A("",!0),S.value?(m(),O(Lv,{key:3})):A("",!0),k.value?(m(),O(Yv,{key:4})):A("",!0),$.value?(m(),O(Vv,{key:5})):A("",!0),x.value?(m(),O(Ev,{key:6})):A("",!0),x.value?(m(),O(qv,{key:7})):A("",!0),N.value?(m(),O(Uv,{key:8})):A("",!0),G.value&&D.value?(m(),O(Is,{key:9})):A("",!0),_.value?(m(),O(Mv,{key:10})):A("",!0),V.value?(m(),O(jv,{key:11})):A("",!0),M.value?(m(),O(Fv,{key:12})):A("",!0),(m(!0),T(le,null,we(r.value,W=>(m(),O(Bv,{key:W.id,command:W},null,8,["command"]))),128)),P.value?(m(),O(Ov,{key:13})):A("",!0),L(ig)]),_:1},8,["onWheel"])):A("",!0)]),_:1})],512))}}),pg=Se(dg,[["__scopeId","data-v-d1982b69"]]),fg=K({__name:"TitleEditor",setup(e){const o=ne(),t=R(!1),a=R(""),{style:l,updatePosition:s}=Fa(),i=R({}),r=b(()=>({...l.value,...i.value})),u=Zo(),c=fe(),p=R(!0),g=n(w=>{if(u.titleEditorTarget&&w?.trim()){const h=w.trim();u.titleEditorTarget.title=h;const C=u.titleEditorTarget;C instanceof pt&&C.isSubgraphNode?.()&&(C.subgraph.name=h),j.graph.setDirtyCanvas(!0,!0)}t.value=!1,u.titleEditorTarget=null,c.canvas.allow_dragcanvas=p.value},"onEdit");return te(()=>u.titleEditorTarget,w=>{if(w===null)return;a.value=w.title,t.value=!0;const h=c.canvas;p.value=h.allow_dragcanvas,h.allow_dragcanvas=!1;const C=h.ds.scale;if(w instanceof At){const f=w;s({pos:f.pos,size:[f.size[0],f.titleHeight]}),i.value={fontSize:`${f.font_size*C}px`}}else if(w instanceof pt){const f=w,[S,$]=f.getBounding();s({pos:[S,$],size:[f.width,ve.NODE_TITLE_HEIGHT]}),i.value={fontSize:`${12*C}px`}}}),Re(document,"litegraph:canvas",n(w=>{if(w.detail.subType==="group-double-click"){if(!o.get("Comfy.Group.DoubleClickTitleToEdit"))return;const h=w.detail.group,[C,f]=h.pos;w.detail.originalEvent.canvasY-f<=h.titleHeight&&(u.titleEditorTarget=h)}else if(w.detail.subType==="node-double-click"){if(!o.get("Comfy.Node.DoubleClickTitleToEdit"))return;const h=w.detail.node,[C,f]=h.pos;w.detail.originalEvent.canvasY-f<=0&&(u.titleEditorTarget=h)}},"canvasEventHandler")),(w,h)=>t.value?(m(),T("div",{key:0,class:"group-title-editor node-title-editor",style:pe(r.value)},[L(bi,{"is-editing":t.value,"model-value":a.value,onEdit:g},null,8,["is-editing","model-value"])],4)):A("",!0)}}),mg=Se(fg,[["__scopeId","data-v-5a43f2bb"]]);function vg(){const e=n(async(s,i,r,u,c,p)=>{if(!s.label||!s.hasSubmenu)return;const g=u.value===s.label;if(c.forEach(d=>{const w=p[`submenu-${d.label}`];w&&w.hide()}),u.value=null,!g){u.value=s.label,await Le();const d=i.currentTarget,w=d.getBoundingClientRect(),h=d.closest('[data-pc-section="content"]');if(h){const C=h.getBoundingClientRect(),f=o(C.right+8,w.top,`submenu-target-${s.label}`),S=t(C.right+8,w.top);r.show(S,f),a(f,100)}else{const C=o(w.right+8,w.top,`submenu-fallback-target-${s.label}`),f=t(w.right+8,w.top);r.show(f,C),a(C,100)}}},"toggleSubmenu"),o=n((s,i,r)=>{const u=document.createElement("div");return u.style.position="absolute",u.style.left=`${s}px`,u.style.top=`${i}px`,u.style.width="1px",u.style.height="1px",u.style.pointerEvents="none",u.style.visibility="hidden",u.id=r,document.body.appendChild(u),u},"createPositionedTarget"),t=n((s,i)=>new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:s,clientY:i}),"createMouseEvent"),a=n((s,i)=>{setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},i)},"cleanupTempTarget");return{toggleSubmenu:e,hideAllSubmenus:n((s,i,r)=>{s.forEach(u=>{const c=i[`submenu-${u.label}`];c&&c.hide()}),r.value=null},"hideAllSubmenus")}}n(vg,"useSubmenuPositioning");const gg={key:0,class:"my-1 h-px bg-border-default"},hg={class:"flex-1"},yg={key:1,class:"flex h-3.5 min-w-3.5 items-center justify-center rounded bg-interface-menu-keybind-surface-default px-1 py-0 text-xxs"},bg={key:2,size:14,class:"icon-[lucide--chevron-right] opacity-60"},wg=K({__name:"MenuOptionItem",props:{option:{}},emits:["click"],setup(e,{emit:o}){const{t}=ce(),a=e,l=o,s=n(i=>{l("click",a.option,i)},"handleClick");return(i,r)=>i.option.type==="divider"?(m(),T("div",gg)):(m(),T("div",{key:1,role:"button",class:"group flex cursor-pointer items-center gap-2 rounded px-3 py-1.5 text-left text-sm text-text-primary hover:bg-interface-menu-component-surface-hovered",onClick:s},[i.option.icon?(m(),T("i",{key:0,class:J([i.option.icon,"h-4 w-4"])},null,2)):A("",!0),y("span",hg,z(i.option.label),1),i.option.shortcut?(m(),T("span",yg,z(i.option.shortcut),1)):A("",!0),i.option.hasSubmenu?(m(),T("i",bg)):A("",!0),i.option.badge?(m(),O(v(Wl),{key:3,severity:i.option.badge==="new"?"info":"secondary",value:v(t)(i.option.badge),class:J(v(de)("h-4 gap-2.5 px-1 text-[9px] text-base-foreground uppercase rounded-4xl",{"bg-primary-background":i.option.badge==="new","bg-secondary-background":i.option.badge==="deprecated"}))},null,8,["severity","value","class"])):A("",!0)]))}}),kg=["title","onClick"],Cg={key:0,class:"icon-[lucide--check] size-4 flex-shrink-0"},Sg={key:1,class:"w-4 flex-shrink-0"},xg=K({__name:"SubmenuPopover",props:{option:{}},emits:["submenu-click"],setup(e,{expose:o,emit:t}){const a=e,l=t,{getCurrentShape:s}=Xn(),i=R();o({show:n((d,w)=>{i.value?.show(d,w)},"show"),hide:n(()=>{i.value?.hide()},"hide")});const c=n(d=>{l("submenu-click",d)},"handleSubmenuClick"),p=n(d=>{if(d.color)return!1;const w=s();return w?w.localizedName===d.label:!1},"isShapeSelected"),g=b(()=>a.option.submenu&&a.option.submenu.length>0&&a.option.submenu.every(d=>d.color&&!d.icon));return(d,w)=>(m(),O(v(et),{ref_key:"popover",ref:i,"auto-z-index":!0,"base-z-index":1100,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-[60]"},content:{class:["text-base-foreground rounded-lg","shadow-lg border border-base-background","bg-interface-panel-surface"]}}},{default:E(()=>[y("div",{class:J(g.value?"flex flex-col gap-1 p-2":"flex flex-col p-2 min-w-40")},[(m(!0),T(le,null,we(d.option.submenu,h=>(m(),T("div",{key:h.label,class:J(v(de)("hover:bg-secondary-background-hover rounded cursor-pointer",g.value?"w-7 h-7 flex items-center justify-center":"flex items-center gap-2 px-3 py-1.5 text-sm")),title:h.label,onClick:n(C=>c(h),"onClick")},[h.color?(m(),T("div",{key:0,class:"size-5 rounded-full border border-border-default",style:pe({backgroundColor:h.color})},null,4)):h.color?A("",!0):(m(),T(le,{key:1},[p(h)?(m(),T("i",Cg)):(m(),T("div",Sg)),y("span",null,z(h.label),1)],64))],10,kg))),128))],2)]),_:1},512))}}),$g={class:"flex min-w-48 flex-col p-2"},_g=K({__name:"NodeOptions",setup(e,{expose:o}){const t=R(),a=R(null),l=R(!0),s=R(!1),i=R(!1),r=R(null),u=R({}),c=R(null),{menuOptions:p,menuOptionsWithSubmenu:g,bump:d}=lg(),{toggleSubmenu:w,hideAllSubmenus:h}=vg(),C=Bt();let f=null;function S(){if(f&&f.isConnected)return f;const U=t.value?.$el;if(U instanceof HTMLElement)return f=U,U;const q=a.value;if(q){const Q=Array.from(document.querySelectorAll("div.absolute.z-50")),me=q.getBoundingClientRect();let Y=null;for(const ee of Q){const se=ee.getBoundingClientRect(),xe=Math.abs(se.top-me.bottom);(!Y||xe<Y.dist)&&(Y={el:ee,dist:xe})}if(Y&&Y.el)return f=Y.el,Y.el}return null}n(S,"resolveOverlayEl");const $=n(()=>{if(!s.value)return;const U=a.value,q=S();if(!U||!q)return;const Q=U.getBoundingClientRect(),me=8,Y=l.value?Q.left+Q.width/2:Q.right-Q.width/4,ee=l.value?Q.bottom+me:Q.top-me-6;try{q.style.position="fixed",q.style.left=`${Y}px`,q.style.top=`${ee}px`,q.style.transform="translate(-50%, 0)"}catch(se){console.warn("[NodeOptions] Failed to set overlay style",se);return}performance.now()},"repositionPopover"),{resume:k,pause:x}=go($);function _(U,q,Q){const me=q||a.value;return!me||!me.isConnected?!1:(a.value=me,Q!==void 0&&(l.value=Q),d(),t.value?.show(U??new Event("reopen"),me),s.value=!0,Nt.value=!0,We.value=!1,!0)}n(_,"openPopover");function M(U="manual"){r.value=U,t.value?.hide(),s.value=!1,Nt.value=!1,x(),G(),U!=="drag"?(i.value=!1,We.value=!1):We.value||(i.value=!0,We.value=!0)}n(M,"closePopover");let N=0;function I(){if(!s.value&&!(!i.value&&!We.value)){if(_(new Event("reopen"),a.value||void 0)){i.value=!1,N=0;return}N>=5||(N++,requestAnimationFrame(()=>I()))}}n(I,"attemptRestore");const V=n((U,q,Q)=>{s.value?M("manual"):_(U,q,Q)},"toggle"),P=n((U="manual")=>M(U),"hide");o({toggle:V,hide:P,isOpen:s});const G=n(()=>{h(g.value,u.value,c)},"hideAll"),D=n((U,q)=>{if(!U.hasSubmenu&&U.action)U.action(),P();else if(U.hasSubmenu){q.stopPropagation();const Q=`submenu-${U.label}`,me=u.value[Q];me&&w(U,q,me,c,g.value,u.value)}},"handleOptionClick"),B=n(U=>{U.action(),P("manual")},"handleSubmenuClick"),F=n((U,q)=>{q?u.value[U]=q:delete u.value[U]},"setSubmenuRef"),W=n(()=>{f=S(),requestAnimationFrame(()=>$()),k()},"onPopoverShow"),H=n(()=>{r.value==null&&(s.value=!1,G(),i.value=!1,Nt.value=!1,We.value=!1),f=null,x(),r.value=null},"onPopoverHide");return te(()=>Ua.value,()=>{s.value?P("drag"):i.value=i.value||We.value}),te(()=>Ga.value,()=>I()),De(()=>{$n({toggle:V,hide:P,isOpen:s}),We.value&&!s.value&&requestAnimationFrame(()=>I())}),rt(()=>{x(),$n(null)}),(U,q)=>(m(),T("div",null,[L(v(et),{ref_key:"popover",ref:t,"append-to":"body","auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50 w-[300px]"},content:{class:["mt-2 text-base-foreground rounded-lg","shadow-lg border border-border-default","bg-interface-panel-surface"]}},onShow:W,onHide:H,onWheel:v(C).forwardEventToCanvas},{default:E(()=>[y("div",$g,[(m(!0),T(le,null,we(v(p),(Q,me)=>(m(),O(wg,{key:Q.label||`divider-${me}`,option:Q,onClick:D},null,8,["option"]))),128))])]),_:1},8,["onWheel"]),(m(!0),T(le,null,we(v(g),Q=>(m(),O(xg,{key:`submenu-${Q.label}`,ref_for:!0,ref:n(me=>F(`submenu-${Q.label}`,me),"ref"),option:Q,onSubmenuClick:B},null,8,["option"]))),128))]))}}),es=Vt("searchBox",()=>{const e=ne(),{x:o,y:t}=gl(),a=b(()=>e.get("Comfy.NodeSearchBoxImpl")==="default"),l=yt(null);function s(u){l.value=u}n(s,"setPopoverRef");const i=R(!1);function r(){if(a.value){i.value=!i.value;return}l.value&&l.value.showSearchBox(new MouseEvent("click",{clientX:o.value,clientY:t.value,layerY:t.value}))}return n(r,"toggleVisible"),{newSearchBoxEnabled:a,setPopoverRef:s,toggleVisible:r,visible:i}}),Tg={name:"AutoCompletePlus",extends:ko,emits:["focused-option-changed"],data(){return{isComposing:!1}},mounted(){typeof ko.mounted=="function"&&ko.mounted.call(this);const e=this.$el.querySelector("input");e&&(e.addEventListener("compositionstart",()=>{this.isComposing=!0}),e.addEventListener("compositionend",()=>{this.isComposing=!1})),this.$watch(()=>this.focusedOptionIndex,(o,t)=>{this.$emit("focused-option-changed",o)})},methods:{onKeyDown(e){if(e.key==="Enter"&&this.isComposing){e.preventDefault(),e.stopPropagation();return}ko.methods.onKeyDown.call(this,e)}}},Ng={class:"option-container flex w-full cursor-pointer items-center justify-between overflow-hidden px-2 py-0"},Mg={class:"option-display-name flex flex-col font-semibold"},Ig={key:0},Pg=["innerHTML"],Rg=["innerHTML"],Dg={key:0,class:"option-category truncate text-sm font-light text-muted"},Ag={class:"option-badges"},Lg=K({__name:"NodeSearchItem",props:{nodeDef:{},currentQuery:{}},setup(e){const o=ne(),t=b(()=>o.get("Comfy.NodeSearchBoxImpl.ShowCategory")),a=b(()=>o.get("Comfy.NodeSearchBoxImpl.ShowIdName")),l=b(()=>o.get("Comfy.NodeSearchBoxImpl.ShowNodeFrequency")),s=Fn(),i=b(()=>s.getNodeFrequency(c.nodeDef)),r=ka(),u=b(()=>r.isBookmarked(c.nodeDef)),c=e;return(p,g)=>(m(),T("div",Ng,[y("div",Mg,[y("div",null,[u.value?(m(),T("span",Ig,g[0]||(g[0]=[y("i",{class:"pi pi-bookmark-fill mr-1 text-sm"},null,-1)]))):A("",!0),y("span",{innerHTML:v(rs)(p.nodeDef.display_name,p.currentQuery)},null,8,Pg),g[1]||(g[1]=y("span",null,"",-1)),a.value?(m(),O(v(Ht),{key:1,severity:"secondary"},{default:E(()=>[y("span",{innerHTML:v(rs)(p.nodeDef.name,p.currentQuery)},null,8,Rg)]),_:1})):A("",!0)]),t.value?(m(),T("div",Dg,z(p.nodeDef.category.replaceAll("/"," > ")),1)):A("",!0)]),y("div",Ag,[p.nodeDef.experimental?(m(),O(v(Ht),{key:0,value:p.$t("g.experimental"),severity:"primary"},null,8,["value"])):A("",!0),p.nodeDef.deprecated?(m(),O(v(Ht),{key:1,value:p.$t("g.deprecated"),severity:"danger"},null,8,["value"])):A("",!0),l.value&&i.value>0?(m(),O(v(Ht),{key:2,value:v(wi)(i.value,{roundToInt:!0}),severity:"secondary"},null,8,["value"])):A("",!0),p.nodeDef.nodeSource.type!==v(ki).Unknown?(m(),O(v(Ol),{key:3,class:"text-sm font-light"},{default:E(()=>[qe(z(p.nodeDef.nodeSource.displayText),1)]),_:1})):A("",!0)])]))}}),Eg=Se(Lg,[["__scopeId","data-v-acda36a0"]]),Vg={class:"comfy-vue-node-search-container flex w-full min-w-96 items-center justify-center"},Wg={key:0,class:"comfy-vue-node-preview-container absolute top-[50px] left-[-350px]"},Og={class:"_dialog-body"},Bg=K({__name:"NodeSearchBox",props:{filters:{},searchLimit:{default:64}},emits:["addFilter","removeFilter","addNode"],setup(e,{emit:o}){const t=ne(),{t:a}=ce(),l=b(()=>t.get("Comfy.NodeSearchBoxImpl.NodePreview")),s=R(),i=R(!1),r=`comfy-vue-node-search-box-input-${Math.random()}`,u=R([]),c=R(null),p=R(""),g=b(()=>e.filters.length===0?a("g.searchNodes")+"...":""),d=ut(),w=Fn(),h=qo(N=>{N.trim()},500),C=n(N=>{const I=N===""&&e.filters.length===0;p.value=N,u.value=I?w.topNodeDefs:[...d.nodeSearchService.searchNode(N,e.filters,{limit:e.searchLimit})],h(N)},"search"),f=o,S=n(N=>{f("addNode",N)},"onAddNode");let $=null;const k=n(async()=>{$??=document.getElementById(r),$&&($.blur(),await Le(()=>$?.focus()))},"reFocusInput");De(()=>{$??=document.getElementById(r),$&&$.focus(),s.value.hide=()=>C(""),C(""),s.value.show()});const x=n(N=>{i.value=!1,f("addFilter",N)},"onAddFilter"),_=n(async(N,I)=>{N.stopPropagation(),N.preventDefault(),f("removeFilter",I),await k()},"onRemoveFilter"),M=n(N=>{if(N===-1){c.value=null;return}const I=u.value[N];c.value=I},"setHoverSuggestion");return(N,I)=>(m(),T("div",Vg,[l.value?(m(),T("div",Wg,[c.value?(m(),O(Ci,{key:c.value?.name||"","node-def":c.value},null,8,["node-def"])):A("",!0)])):A("",!0),L(v(re),{icon:"pi pi-filter",severity:"secondary",class:"filter-button z-10",onClick:I[0]||(I[0]=V=>i.value=!0)}),L(v(ra),{visible:i.value,"onUpdate:visible":I[1]||(I[1]=V=>i.value=V),class:"min-w-96","dismissable-mask":"",modal:"",onHide:k},{header:E(()=>[y("h3",null,z(N.$t("g.addNodeFilterCondition")),1)]),default:E(()=>[y("div",Og,[L(Si,{onAddFilter:x})])]),_:1},8,["visible"]),L(Tg,{ref_key:"autoCompletePlus",ref:s,"model-value":N.filters,class:"comfy-vue-node-search-box z-10 grow","scroll-height":"40vh",placeholder:g.value,"input-id":r,"append-to":"self",suggestions:u.value,delay:100,loading:!v(w).isLoaded,"complete-on-focus":"","auto-option-focus":"","force-selection":"",multiple:"","option-label":"display_name",onComplete:I[2]||(I[2]=V=>C(V.query)),onOptionSelect:I[3]||(I[3]=V=>S(V.value)),onFocusedOptionChanged:I[4]||(I[4]=V=>M(V))},{option:E(({option:V})=>[L(Eg,{"node-def":V,"current-query":p.value},null,8,["node-def","current-query"])]),chip:E(({value:V})=>[V.filterDef&&V.value?(m(),O(xi,{key:`${V.filterDef.id}-${V.value}`,text:V.value,badge:V.filterDef.invokeSequence.toUpperCase(),"badge-class":V.filterDef.invokeSequence+"-badge",onRemove:n(P=>_(P,V),"onRemove")},null,8,["text","badge","badge-class","onRemove"])):A("",!0)]),_:1},8,["model-value","placeholder","suggestions","loading"])]))}}),zg=K({__name:"NodeSearchBoxPopover",setup(e,{expose:o}){let t=null,a=null,l=!1;const s=ne(),i=es(),r=yo(),{visible:u,newSearchBoxEnabled:c}=at(i),p=R(!0);function g(){return t?[t.canvasX,t.canvasY]:r.getCanvasCenter()}n(g,"getNewNodeLocation");const d=R([]);function w(W){d.value.push(W)}n(w,"addFilter");function h(W){d.value=d.value.filter(H=>as(H)!==as(W))}n(h,"removeFilter");function C(){d.value=[]}n(C,"clearFilters");function f(){u.value=!1}n(f,"closeDialog");const S=fe();function $(W){const H=r.addNodeOnGraph(W,{pos:g()});l&&t?S.getCanvas().linkConnector.connectToNode(H,t):t||console.warn("The trigger event was undefined when addNode was called."),l=!1,Me().activeWorkflow?.changeTracker?.checkState(),window.requestAnimationFrame(f)}n($,"addNode");function k(W){c.value?W?.pointerType==="touch"?setTimeout(()=>{M(W)},128):M(W):S.getCanvas().showSearchBox(W)}n(k,"showSearchBox");function x(){return S.getCanvas().linkConnector.renderLinks.at(0)}n(x,"getFirstLink");const _=ut();function M(W){const H=x();if(H){const U=H.toType==="input"?_.nodeSearchService.inputTypeFilter:_.nodeSearchService.outputTypeFilter,q=H.fromSlot.type?.toString()??"";w({filterDef:U,value:q})}u.value=!0,t=W,p.value=!1,setTimeout(()=>{p.value=!0},300)}n(M,"showNewSearchBox");function N(W){const H=x();if(!H)return;const{node:U,fromSlot:q,toType:Q}=H,me={e:W,allow_searchbox:!0,showSearchBox:n(()=>{ot(),k(W)},"showSearchBox")},Y=H.fromReroute?.id,ee=Q==="input"?{nodeFrom:U,slotFrom:q,afterRerouteId:Y}:{nodeTo:U,slotTo:q,afterRerouteId:Y},se=S.getCanvas(),xe=se.showConnectionMenu({...ee,...me});if(!xe){console.warn("No menu was returned from showConnectionMenu");return}t=W,a=new AbortController;const{signal:He}=a,je={once:!0,signal:He};Re(se.canvas,"connect-new-default-node",Ue=>{if(!(Ue instanceof CustomEvent))throw new Error("Invalid event");const Be=Ue.detail?.node;if(!(Be instanceof pt))throw new Error("Invalid node");l=!1,Ue.preventDefault(),se.linkConnector.connectToNode(Be,W)},je);const ot=Re(xe.controller.signal,"abort",F,je)}n(N,"showContextMenu"),be(()=>{const{canvas:W}=S;W&&(ve.release_link_on_empty_shows_menu=!1,W.allow_searchbox=!1,Re(W.linkConnector.events,"dropped-on-canvas",B))});function I(W){if(W.detail.subType==="empty-double-click")k(W.detail.originalEvent);else if(W.detail.subType==="group-double-click"){const H=W.detail.group,[U,q]=H.pos;W.detail.originalEvent.canvasY-q>H.titleHeight&&k(W.detail.originalEvent)}}n(I,"canvasEventHandler");const V=b(()=>s.get("Comfy.LinkRelease.Action")),P=b(()=>s.get("Comfy.LinkRelease.ActionShift"));function G(W){return W.preventDefault()}n(G,"preventDefault");function D(W){W.preventDefault();const H=S.getCanvas();H.linkConnector.state.snapLinksPos=[W.detail.canvasX,W.detail.canvasY],Re(H.linkConnector.events,"reset",G,{once:!0})}n(D,"cancelNextReset");function B(W){switch(l=!0,W.detail.shiftKey?P.value:V.value){case ht.SEARCH_BOX:D(W),k(W.detail);break;case ht.CONTEXT_MENU:D(W),N(W.detail);break;case ht.NO_ACTION:}}n(B,"handleDroppedOnCanvas");function F(){a?.abort(),a=null,t=null;const W=S.getCanvas();W.linkConnector.events.removeEventListener("reset",G),l&&W.linkConnector.disconnectLinks(),W.linkConnector.reset(),W.setDirty(!0,!0)}return n(F,"reset"),te(u,()=>{u.value||F()}),Re(document,"litegraph:canvas",I),o({showSearchBox:k}),(W,H)=>(m(),T("div",null,[L(v(ra),{visible:v(u),"onUpdate:visible":H[0]||(H[0]=U=>st(u)?u.value=U:null),modal:"","dismissable-mask":p.value,pt:{root:{class:"invisible-dialog-root",role:"search"},mask:{class:"node-search-box-dialog-mask"},transition:{enterFromClass:"opacity-0 scale-75",enterActiveClass:"transition-all duration-100 ease-out",leaveActiveClass:"transition-all duration-100 ease-in",leaveToClass:"opacity-0 scale-75"}},onHide:C},{container:E(()=>[L(Bg,{filters:d.value,onAddFilter:w,onRemoveFilter:h,onAddNode:$},null,8,["filters"])]),_:1},8,["visible","dismissable-mask"])]))}}),Fg=["width","height"],Ug=K({__name:"ComfyLogo",props:{size:{default:16},color:{default:"currentColor"},class:{},mode:{default:"outline"}},setup(e){const o=b(()=>e.class||""),t=b(()=>({stroke:e.mode==="outline"?e.color:void 0,strokeWidth:e.mode==="outline"?1:void 0,fill:e.mode==="fill"?e.color:"none"}));return(a,l)=>(m(),T("svg",{class:J(o.value),width:a.size,height:a.size,viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg"},[y("path",kt({d:"M14.8193 0.600586C15.1248 0.600586 15.3296 0.70893 15.459 0.881836C15.5914 1.05888 15.6471 1.33774 15.5527 1.66895L14.8037 4.30176C14.7063 4.64386 14.4729 4.97024 14.1641 5.21191C13.8544 5.45415 13.496 5.58984 13.1699 5.58984H13.1689L9.5791 5.59668H7.90625C7.52654 5.59668 7.19496 5.84986 7.09082 6.21289L5.69434 11.0889C5.63007 11.3133 5.66134 11.5534 5.77734 11.7529L5.83203 11.8359C5.99177 12.0491 6.24252 12.1758 6.50977 12.1758H6.51074L8.88281 12.1709H11.4971C11.7643 12.171 11.9541 12.254 12.084 12.3906L12.1357 12.4521C12.2685 12.6295 12.3249 12.9089 12.2305 13.2402L11.4805 15.8721C11.383 16.2144 11.1498 16.5415 10.8408 16.7832C10.5314 17.0252 10.1736 17.161 9.84766 17.1611H9.84668L6.25684 17.168H3.64258C3.33762 17.1679 3.13349 17.0588 3.00391 16.8857C2.87135 16.7087 2.81482 16.43 2.90918 16.0986L3.39551 14.3887C3.46841 14.1327 3.41794 13.8576 3.25879 13.6445V13.6436C3.09901 13.4303 2.84745 13.3037 2.58008 13.3037H1.18066C0.875088 13.3037 0.670398 13.1953 0.541016 13.0225C0.408483 12.8451 0.351891 12.5655 0.446289 12.2344L2.11914 6.38965L2.30371 5.74707V5.74609C2.40139 5.40341 2.63456 5.07671 2.94336 4.83496C3.25302 4.59258 3.61143 4.45705 3.9375 4.45703H5.6123C5.94484 4.45703 6.24083 4.26316 6.37891 3.9707L6.42773 3.83984L6.98145 1.89551C7.07894 1.55317 7.31212 1.22614 7.62109 0.984375C7.93074 0.742127 8.2892 0.606445 8.61523 0.606445H8.61621L12.1982 0.600586H14.8193Z"},t.value),null,16)],10,Fg))}}),Gg={class:"relative aspect-square w-full overflow-hidden rounded-t-lg select-none"},Hg={key:1,class:"flex h-full w-full items-center justify-center"},jg=K({__name:"BaseThumbnail",props:{hoverZoom:{default:4},isHovered:{type:Boolean}},setup(e){const o=R(!1),t=R(null);return De(()=>{Array.from(t.value?.getElementsByTagName("img")??[]).forEach(l=>{Re(l,"error",()=>{o.value=!0})})}),(a,l)=>(m(),T("div",Gg,[o.value?(m(),T("div",Hg,l[0]||(l[0]=[y("img",{src:$r,draggable:"false",class:"h-full w-full transform-gpu object-cover transition-transform duration-300 ease-out"},null,-1)]))):(m(),T("div",{key:0,ref_key:"contentRef",ref:t,class:"h-full w-full transform-gpu transition-transform duration-1000 ease-out",style:pe(a.isHovered?{transform:`scale(${1+a.hoverZoom/100})`}:void 0)},[Pe(a.$slots,"default",{},void 0,!0)],4))]))}}),tn=Se(jg,[["__scopeId","data-v-c216f2c0"]]),qg={class:"flex h-full w-full items-center justify-center p-4",style:{backgroundImage:"url(/assets/images/default-template.png)",backgroundRepeat:"round"}},Kg=["src"],Qg=K({__name:"AudioThumbnail",props:{src:{}},setup(e){return(o,t)=>(m(),O(tn,null,{default:E(()=>[y("div",qg,[y("audio",{controls:"",class:"relative w-full",src:o.src,onClick:t[0]||(t[0]=Ne(()=>{},["stop"]))},null,8,Kg)])]),_:1}))}}),Jg=50,Yg=K({__name:"CompareSliderThumbnail",props:{baseImageSrc:{},overlayImageSrc:{},alt:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const o=e.isVideo||e.baseImageSrc?.toLowerCase().endsWith(".webp")||e.overlayImageSrc?.toLowerCase().endsWith(".webp")||!1,t=R(Jg),a=R(null),{elementX:l,elementWidth:s,isOutside:i}=hl(a);return te([()=>e.isHovered,l,s,i],([r,u,c,p])=>{r&&(p||(t.value=u/c*100))}),(r,u)=>(m(),O(tn,{"is-hovered":r.isHovered},{default:E(()=>[L(fo,{src:r.baseImageSrc,alt:r.alt,"image-class":v(o)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain"},null,8,["src","alt","image-class"]),y("div",{ref_key:"containerRef",ref:a,class:"absolute inset-0"},[L(fo,{src:r.overlayImageSrc,alt:r.alt,"image-class":v(o)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain","image-style":{clipPath:`inset(0 ${100-t.value}% 0 0)`}},null,8,["src","alt","image-class","image-style"]),y("div",{class:"pointer-events-none absolute inset-y-0 z-10 w-0.5 bg-white/30 backdrop-blur-sm",style:pe({left:`${t.value}%`})},null,4)],512)]),_:1},8,["is-hovered"]))}}),Zg=K({__name:"DefaultThumbnail",props:{src:{},alt:{},hoverZoom:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const o=e.isVideo??(e.src?.toLowerCase().endsWith(".webp")||!1);return(t,a)=>(m(),O(tn,{"hover-zoom":t.hoverZoom,"is-hovered":t.isHovered},{default:E(()=>[L(fo,{src:t.src,alt:t.alt,"image-class":["transform-gpu transition-transform duration-300 ease-out",v(o)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain"],"image-style":t.isHovered?{transform:`scale(${1+t.hoverZoom/100})`}:void 0},null,8,["src","alt","image-class","image-style"])]),_:1},8,["hover-zoom","is-hovered"]))}}),Xg={class:"relative h-full w-full"},eh={class:"absolute inset-0"},th={class:"absolute inset-0 z-10"},oh=K({__name:"HoverDissolveThumbnail",props:{baseImageSrc:{},overlayImageSrc:{},alt:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const o=e.isVideo||e.baseImageSrc?.toLowerCase().endsWith(".webp")||e.overlayImageSrc?.toLowerCase().endsWith(".webp")||!1,t=b(()=>o?"size-full object-cover":"size-full object-contain"),a=b(()=>{const l="size-full transition-opacity duration-300",s=o?"object-cover":"object-contain",i=e.isHovered?"opacity-100":"opacity-0";return`${l} ${s} ${i}`});return(l,s)=>(m(),O(tn,{"is-hovered":l.isHovered},{default:E(()=>[y("div",Xg,[y("div",eh,[L(fo,{src:l.baseImageSrc,alt:l.alt,"image-class":t.value},null,8,["src","alt","image-class"])]),y("div",th,[L(fo,{src:l.overlayImageSrc,alt:l.alt,"image-class":a.value},null,8,["src","alt","image-class"])])])]),_:1},8,["is-hovered"]))}});function nh(e,o={}){const{itemsPerPage:t=12,initialPage:a=1}=o,l=R(a),s=R(!1),i=yt(new Set([])),r=b(()=>{const w="value"in e?e.value:e;return Array.isArray(w)?w:[]}),u=b(()=>{const w=r.value;if(w.length===0)return[];const h=Array.from(i.value).sort((S,$)=>S-$),f=Math.max(...h,0)*t;return w.slice(0,f)}),c=b(()=>{const w=r.value;if(w.length===0)return!1;const h=Array.from(i.value);return Math.max(...h,0)*t<w.length}),p=b(()=>{const w=r.value;return w.length===0?0:Math.ceil(w.length/t)}),g=n(async()=>{if(s.value||!c.value)return;s.value=!0;const w=Array.from(i.value),h=Math.max(...w,0)+1,C=new Set(i.value);C.add(h),i.value=C,l.value=h,s.value=!1},"loadNextPage");return te(()=>r.value.length,w=>{w>0&&i.value.size===0&&(i.value=new Set([1]))},{immediate:!0}),{paginatedItems:u,isLoading:s,hasMoreItems:c,currentPage:l,totalPages:p,loadNextPage:g,reset:n(()=>{l.value=a,i.value=new Set([]),s.value=!1,r.value.length>0&&(i.value=new Set([1]))},"reset")}}n(nh,"useLazyPagination");function sh(e){const o=ne(),t=R(""),a=R(o.get("Comfy.Templates.SelectedModels")),l=R(o.get("Comfy.Templates.SelectedUseCases")),s=R(o.get("Comfy.Templates.SelectedRunsOn")),i=R(o.get("Comfy.Templates.SortBy")),r=b(()=>{const D="value"in e?e.value:e;return Array.isArray(D)?D:[]}),u={keys:[{name:"name",weight:.3},{name:"title",weight:.3},{name:"description",weight:.2},{name:"tags",weight:.1},{name:"models",weight:.1}],threshold:.4,includeScore:!0,includeMatches:!0},c=b(()=>new Os(r.value,u)),p=b(()=>{const D=new Set;return r.value.forEach(B=>{Array.isArray(B.models)&&B.models.forEach(F=>D.add(F))}),Array.from(D).sort()}),g=b(()=>{const D=new Set;return r.value.forEach(B=>{B.tags&&Array.isArray(B.tags)&&B.tags.forEach(F=>D.add(F))}),Array.from(D).sort()}),d=b(()=>["ComfyUI","External or Remote API"]),w=yl(t,50),h=b(()=>w.value.trim()?c.value.search(w.value).map(B=>B.item):r.value),C=b(()=>a.value.length===0?h.value:h.value.filter(D=>!D.models||!Array.isArray(D.models)?!1:a.value.some(B=>D.models?.includes(B)))),f=b(()=>l.value.length===0?C.value:C.value.filter(D=>!D.tags||!Array.isArray(D.tags)?!1:l.value.some(B=>D.tags?.includes(B)))),S=b(()=>s.value.length===0?f.value:f.value.filter(D=>{const B=D.openSource===!1,F=D.openSource!==!1;return s.value.some(W=>W==="External or Remote API"?B:W==="ComfyUI"?F:!1)})),$=n(D=>typeof D.vram=="number"&&Number.isFinite(D.vram)&&D.vram>0?D.vram:Number.POSITIVE_INFINITY,"getVramMetric"),k=b(()=>{const D=[...S.value];switch(i.value){case"alphabetical":return D.sort((B,F)=>{const W=B.title||B.name||"",H=F.title||F.name||"";return W.localeCompare(H)});case"newest":return D.sort((B,F)=>{const W=new Date(B.date||"1970-01-01");return new Date(F.date||"1970-01-01").getTime()-W.getTime()});case"vram-low-to-high":return D.sort((B,F)=>{const W=$(B),H=$(F);if(W===H){const U=B.title||B.name||"",q=F.title||F.name||"";return U.localeCompare(q)}return W===Number.POSITIVE_INFINITY?1:H===Number.POSITIVE_INFINITY?-1:W-H});case"model-size-low-to-high":return D.sort((B,F)=>{const W=typeof B.size=="number"?B.size:Number.POSITIVE_INFINITY,H=typeof F.size=="number"?F.size:Number.POSITIVE_INFINITY;return W===H?0:W-H});case"default":default:return D}}),x=b(()=>k.value),_=n(()=>{t.value="",a.value=[],l.value=[],s.value=[],i.value="newest"},"resetFilters"),M=n(D=>{a.value=a.value.filter(B=>B!==D)},"removeModelFilter"),N=n(D=>{l.value=l.value.filter(B=>B!==D)},"removeUseCaseFilter"),I=n(D=>{s.value=s.value.filter(B=>B!==D)},"removeRunsOnFilter"),V=b(()=>x.value.length),P=b(()=>r.value.length),G=qo(()=>{},500);return te([t,a,l,s,i],()=>{(t.value.trim()!==""||a.value.length>0||l.value.length>0||s.value.length>0||i.value!=="default")&&G()},{deep:!0}),so(a,D=>{o.set("Comfy.Templates.SelectedModels",D)},{debounce:500,deep:!0}),so(l,D=>{o.set("Comfy.Templates.SelectedUseCases",D)},{debounce:500,deep:!0}),so(s,D=>{o.set("Comfy.Templates.SelectedRunsOn",D)},{debounce:500,deep:!0}),so(i,D=>{o.set("Comfy.Templates.SortBy",D)},{debounce:500}),{searchQuery:t,selectedModels:a,selectedUseCases:l,selectedRunsOn:s,sortBy:i,filteredTemplates:x,availableModels:p,availableUseCases:g,availableRunsOn:d,filteredCount:V,totalCount:P,resetFilters:_,removeModelFilter:M,removeUseCaseFilter:N,removeRunsOnFilter:I}}n(sh,"useTemplateFiltering");function qa(){const{t:e}=ce(),o=Aa(),t=St(),a=R(null),l=R(null),s=b(()=>o.isLoaded),i=b(()=>o.groupedTemplates),r=n(async()=>(o.isLoaded||await o.loadWorkflowTemplates(),o.isLoaded),"loadTemplates"),u=n(()=>{if(i.value.length>0){const C=i.value[0].modules[0];c(C)}},"selectFirstTemplateCategory"),c=n(C=>(a.value=C,C!==null),"selectTemplateCategory"),p=n((C,f,S="1")=>{const $=f==="default"?he.fileURL(`/templates/${C.name}`):he.apiURL(`/workflow_templates/${f}/${C.name}`),k=f==="default"&&S?`-${S}`:"";return`${$}${k}.${C.mediaSubtype}`},"getTemplateThumbnailUrl"),g=n((C,f)=>{const S=C.title??C.name??`${f} Template`;return f==="default"?C.localizedTitle??S:S},"getTemplateTitle"),d=n(C=>(C.localizedDescription||C.description)?.replace(/[-_]/g," ").trim()??"","getTemplateDescription"),w=n(async(C,f)=>{if(!s.value)return!1;l.value=C;let S;try{if(f==="all"){const _=i.value.find(I=>I.label===e("templateWorkflows.category.ComfyUI Examples","ComfyUI Examples"))?.modules.find(I=>I.moduleName==="all")?.templates.find(I=>I.name===C);if(!_||!_.sourceModule)return!1;const M=_.sourceModule;S=await h(C,M);const N=M==="default"?e(`templateWorkflows.template.${C}`,C):C;return t.closeDialog(),await j.loadGraphData(S,!0,!0,N,{openSource:"template"}),!0}S=await h(C,f);const $=f==="default"?e(`templateWorkflows.template.${C}`,C):C;return t.closeDialog(),await j.loadGraphData(S,!0,!0,$,{openSource:"template"}),!0}catch($){return console.error("Error loading workflow template:",$),!1}finally{l.value=null}},"loadWorkflowTemplate"),h=n(async(C,f)=>f==="default"?fetch(he.fileURL(`/templates/${C}.json`)).then(S=>S.json()):fetch(he.apiURL(`/workflow_templates/${f}/${C}.json`)).then(S=>S.json()),"fetchTemplateJson");return{selectedTemplate:a,loadingTemplateId:l,isTemplatesLoaded:s,allTemplateGroups:i,loadTemplates:r,selectFirstTemplateCategory:u,selectTemplateCategory:c,getTemplateThumbnailUrl:p,getTemplateTitle:g,getTemplateDescription:d,loadWorkflowTemplate:w}}n(qa,"useTemplateWorkflows");const ah={class:"text-neutral text-base"},lh={class:"flex gap-2"},ih={class:"relative flex flex-wrap justify-between gap-2 px-6 pb-4"},rh={class:"flex flex-wrap gap-2"},uh={key:0,class:"text-neutral px-6 pt-4 pb-2 text-2xl font-semibold"},ch={key:0,class:"flex h-64 flex-col items-center justify-center text-neutral-500"},dh={class:"mb-2 text-lg"},ph={class:"text-sm"},fh={key:1},mh={key:0,class:"inline-block h-8 w-48 animate-pulse rounded bg-dialog-surface"},vh={class:"relative h-full w-full overflow-hidden rounded-lg"},gh={class:"flex flex-col gap-2 pt-3"},hh=["title"],yh={class:"flex justify-between gap-2"},bh={class:"flex-1"},wh=["title"],kh={key:0,class:"flex flex-col-reverse justify-center"},Ch={key:0,class:"text-sm text-muted"},Sh={key:3,class:"mt-6 px-6 text-sm text-muted"},xh=K({__name:"WorkflowTemplateSelectorDialog",props:{onClose:{type:Function}},setup(e){const{t:o}=ce(),t=R(0),a=R(!1);De(()=>{t.value=Date.now()});const l=n(()=>{e.onClose()},"onClose");Vn(Xo,l);const s=Aa(),{loadTemplates:i,loadWorkflowTemplate:r,getTemplateThumbnailUrl:u,getTemplateTitle:c,getTemplateDescription:p}=qa(),g=n(ae=>ae.sourceModule||"default","getEffectiveSourceModule"),d=n(ae=>{const oe=g(ae);return u(ae,oe,oe==="default"?"1":"")},"getBaseThumbnailSrc"),w=n(ae=>{const oe=g(ae);return u(ae,oe,oe==="default"?"2":"")},"getOverlayThumbnailSrc"),h=n(ae=>{ae.tutorialUrl&&window.open(ae.tutorialUrl,"_blank")},"openTutorial"),C=b(()=>Ve.value?[{id:"skeleton-all",label:"All Templates",icon:"icon-[lucide--layout-grid]"},{id:"skeleton-basics",label:"Basics",icon:"icon-[lucide--graduation-cap]"},{title:"Generation Type",items:[{id:"skeleton-1",label:"...",icon:"icon-[lucide--loader-2]"},{id:"skeleton-2",label:"...",icon:"icon-[lucide--loader-2]"}]},{title:"Closed Source Models",items:[{id:"skeleton-3",label:"...",icon:"icon-[lucide--loader-2]"}]}]:s.navGroupedTemplates),f=b(()=>Kn()),S=b(()=>s.enhancedTemplates),$=b(()=>ee.value?s.filterTemplatesByCategory(ee.value):S.value),{searchQuery:k,selectedModels:x,selectedUseCases:_,selectedRunsOn:M,sortBy:N,filteredTemplates:I,availableModels:V,availableUseCases:P,availableRunsOn:G,filteredCount:D,totalCount:B,resetFilters:F}=sh($),W=b({get(){return x.value.map(ae=>({name:ae,value:ae}))},set(ae){x.value=ae.map(oe=>oe.value)}}),H=b({get(){return _.value.map(ae=>({name:ae,value:ae}))},set(ae){_.value=ae.map(oe=>oe.value)}}),U=b({get(){return M.value.map(ae=>({name:ae,value:ae}))},set(ae){M.value=ae.map(oe=>oe.value)}}),q=R(null),Q=R(null),me=R([]),Y=R(0),ee=R("all"),se=R(""),xe=b(()=>V.value.map(ae=>({name:ae,value:ae}))),He=b(()=>P.value.map(ae=>({name:ae,value:ae}))),je=b(()=>G.value.map(ae=>({name:ae,value:ae}))),ot=b(()=>W.value.length===0?o("templateWorkflows.modelFilter","Model Filter"):W.value.length===1?W.value[0].name:o("templateWorkflows.modelsSelected",{count:W.value.length})),Ue=b(()=>H.value.length===0?o("templateWorkflows.useCaseFilter","Use Case"):H.value.length===1?H.value[0].name:o("templateWorkflows.useCasesSelected",{count:H.value.length})),Be=b(()=>U.value.length===0?o("templateWorkflows.runsOnFilter","Runs On"):U.value.length===1?U.value[0].name:o("templateWorkflows.runsOnSelected",{count:U.value.length})),mt=b(()=>[{name:o("templateWorkflows.sort.newest","Newest"),value:"newest"},{name:o("templateWorkflows.sort.default","Default"),value:"default"},{name:o("templateWorkflows.sort.vramLowToHigh","VRAM Usage (Low to High)"),value:"vram-low-to-high"},{name:o("templateWorkflows.sort.modelSizeLowToHigh","Model Size (Low to High)"),value:"model-size-low-to-high"},{name:o("templateWorkflows.sort.alphabetical","Alphabetical (A-Z)"),value:"alphabetical"}]),Ge=R(null),$t=b(()=>!k.value.trim()),{paginatedItems:vt,isLoading:Ye,hasMoreItems:Ft,loadNextPage:eo,reset:to}=nh(I,{itemsPerPage:24}),ie=b(()=>$t.value?vt.value:I.value);_r(Ge,()=>{$t.value&&Ft.value&&!Ye.value&&eo()}),te([k,ee,N,x,_,M],()=>{to(),q.value=null,Y.value++});const ge=n(async ae=>{q.value=ae.name;try{await r(ae.name,g(ae)),a.value=!0,l()}finally{q.value=null}},"onLoadWorkflow"),Ie=b(()=>{const ae=C.value.find(oe=>"id"in oe?oe.id===ee.value:oe.items?.some(oo=>oo.id===ee.value));return ae?"id"in ae?ae.label:ae.items?.find(oe=>oe.id===ee.value)?.label||o("templateWorkflows.allTemplates","All Templates"):o("templateWorkflows.allTemplates","All Templates")}),{isLoading:Ve}=En(async()=>(await Promise.all([i(),s.loadWorkflowTemplates()]),!0),!1,{immediate:!0});return Ct(()=>{me.value=[]}),(ae,oe)=>{const oo=_e("tooltip");return m(),O(jn,{"content-title":ae.$t("templateWorkflows.title","Workflow Templates"),class:"workflow-template-selector-dialog"},{leftPanel:E(()=>[L(qn,{modelValue:ee.value,"onUpdate:modelValue":oe[0]||(oe[0]=X=>ee.value=X),"nav-items":C.value},{"header-icon":E(()=>oe[8]||(oe[8]=[y("i",{class:"icon-[comfy--template]"},null,-1)])),"header-title":E(()=>[y("span",ah,z(ae.$t("sideToolbar.templates","Templates")),1)]),_:1},8,["modelValue","nav-items"])]),header:E(()=>[L(Qo,{modelValue:v(k),"onUpdate:modelValue":oe[1]||(oe[1]=X=>st(k)?k.value=X:null),size:"lg",class:"max-w-[384px]"},null,8,["modelValue"])]),"header-right-area":E(()=>[y("div",lh,[v(D)!==v(B)?(m(),O(Fe,{key:0,type:"secondary",label:ae.$t("templateWorkflows.resetFilters","Clear Filters"),onClick:v(F)},{icon:E(()=>oe[9]||(oe[9]=[y("i",{class:"icon-[lucide--filter-x]"},null,-1)])),_:1},8,["label","onClick"])):A("",!0)])]),contentFilter:E(()=>[y("div",ih,[y("div",rh,[L(Lt,{modelValue:W.value,"onUpdate:modelValue":oe[2]||(oe[2]=X=>W.value=X),"search-query":se.value,"onUpdate:searchQuery":oe[3]||(oe[3]=X=>se.value=X),class:"w-[250px]",label:ot.value,options:xe.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:E(()=>oe[10]||(oe[10]=[y("i",{class:"icon-[lucide--cpu]"},null,-1)])),_:1},8,["modelValue","search-query","label","options"]),L(Lt,{modelValue:H.value,"onUpdate:modelValue":oe[4]||(oe[4]=X=>H.value=X),label:Ue.value,options:He.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:E(()=>oe[11]||(oe[11]=[y("i",{class:"icon-[lucide--target]"},null,-1)])),_:1},8,["modelValue","label","options"]),L(Lt,{modelValue:U.value,"onUpdate:modelValue":oe[5]||(oe[5]=X=>U.value=X),label:Be.value,options:je.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:E(()=>oe[12]||(oe[12]=[y("i",{class:"icon-[lucide--server]"},null,-1)])),_:1},8,["modelValue","label","options"])]),y("div",null,[L(en,{modelValue:v(N),"onUpdate:modelValue":oe[6]||(oe[6]=X=>st(N)?N.value=X:null),label:ae.$t("templateWorkflows.sorting","Sort by"),options:mt.value,class:"w-62.5"},{icon:E(()=>oe[13]||(oe[13]=[y("i",{class:"icon-[lucide--arrow-up-down] text-muted-foreground"},null,-1)])),_:1},8,["modelValue","label","options"])])]),v(Ve)?A("",!0):(m(),T("div",uh,[y("span",null,z(Ie.value),1)]))]),content:E(()=>[!v(Ve)&&v(I).length===0?(m(),T("div",ch,[oe[14]||(oe[14]=y("i",{class:"mb-4 icon-[lucide--search] h-12 w-12 opacity-50"},null,-1)),y("p",dh,z(ae.$t("templateWorkflows.noResults","No templates found")),1),y("p",ph,z(ae.$t("templateWorkflows.noResultsHint","Try adjusting your search or filters")),1)])):(m(),T("div",fh,[v(Ve)?(m(),T("span",mh)):A("",!0),(m(),T("div",{key:Y.value,style:pe(f.value),"data-testid":"template-workflows-content"},[(m(!0),T(le,null,we(v(Ve)?12:0,X=>(m(),O(Ro,{key:`initial-skeleton-${X}`,size:"compact",variant:"ghost",rounded:"lg",class:"hover:bg-base-background"},{top:E(()=>[L(Do,{ratio:"landscape"},{default:E(()=>oe[15]||(oe[15]=[y("div",{class:"h-full w-full animate-pulse bg-dialog-surface"},null,-1)])),_:1})]),bottom:E(()=>[L(Ao,null,{default:E(()=>oe[16]||(oe[16]=[y("div",{class:"px-4 py-3"},[y("div",{class:"mb-2 h-6 animate-pulse rounded bg-dialog-surface"}),y("div",{class:"h-4 animate-pulse rounded bg-dialog-surface"})],-1)])),_:1})]),_:2},1024))),128)),(m(!0),T(le,null,we(v(Ve)?[]:ie.value,X=>(m(),O(Ro,{key:X.name,ref_for:!0,ref_key:"cardRefs",ref:me,size:"compact",variant:"ghost",rounded:"lg","data-testid":`template-workflow-${X.name}`,class:"hover:bg-base-background",onMouseenter:n(Te=>Q.value=X.name,"onMouseenter"),onMouseleave:oe[7]||(oe[7]=Te=>Q.value=null),onClick:n(Te=>ge(X),"onClick")},{top:E(()=>[L(Do,{ratio:"square"},{default:E(()=>[y("div",vh,[X.mediaType==="audio"?(m(),O(Qg,{key:0,src:d(X)},null,8,["src"])):X.thumbnailVariant==="compareSlider"?(m(),O(Yg,{key:1,"base-image-src":d(X),"overlay-image-src":w(X),alt:v(c)(X,g(X)),"is-hovered":Q.value===X.name,"is-video":X.mediaType==="video"||X.mediaSubtype==="webp"},null,8,["base-image-src","overlay-image-src","alt","is-hovered","is-video"])):X.thumbnailVariant==="hoverDissolve"?(m(),O(oh,{key:2,"base-image-src":d(X),"overlay-image-src":w(X),alt:v(c)(X,g(X)),"is-hovered":Q.value===X.name,"is-video":X.mediaType==="video"||X.mediaSubtype==="webp"},null,8,["base-image-src","overlay-image-src","alt","is-hovered","is-video"])):(m(),O(Zg,{key:3,src:d(X),alt:v(c)(X,g(X)),"is-hovered":Q.value===X.name,"is-video":X.mediaType==="video"||X.mediaSubtype==="webp","hover-zoom":X.thumbnailVariant==="zoomHover"?16:5},null,8,["src","alt","is-hovered","is-video","hover-zoom"])),q.value===X.name?(m(),O(v(Bl),{key:4,class:"absolute inset-0 z-10 m-auto h-12 w-12"})):A("",!0)])]),"bottom-right":E(()=>[X.tags&&X.tags.length>0?(m(!0),T(le,{key:0},we(X.tags,Te=>(m(),O(Lo,{key:Te,label:Te},null,8,["label"]))),128)):A("",!0)]),_:2},1024)]),bottom:E(()=>[L(Ao,null,{default:E(()=>[y("div",gh,[y("h3",{class:"m-0 line-clamp-1 text-sm",title:v(c)(X,g(X))},z(v(c)(X,g(X))),9,hh),y("div",yh,[y("div",bh,[y("p",{class:"m-0 line-clamp-2 text-sm text-muted",title:v(p)(X)},z(v(p)(X)),9,wh)]),X.tutorialUrl?(m(),T("div",kh,[Q.value===X.name?ue((m(),O(Ee,kt({key:0,ref_for:!0},ae.$attrs,{type:"primary",size:"sm",onClick:Ne(Te=>h(X),["stop"])}),{default:E(()=>oe[17]||(oe[17]=[y("i",{class:"icon-[lucide--info] size-4"},null,-1)])),_:2},1040,["onClick"])),[[oo,ae.$t("g.seeTutorial"),void 0,{bottom:!0}]]):A("",!0)])):A("",!0)])])]),_:2},1024)]),_:2},1032,["data-testid","onMouseenter","onClick"]))),128)),(m(!0),T(le,null,we(v(Ye)?6:0,X=>(m(),O(Ro,{key:`skeleton-${X}`,size:"compact",variant:"ghost",rounded:"lg",class:"hover:bg-base-background"},{top:E(()=>[L(Do,{ratio:"square"},{default:E(()=>oe[18]||(oe[18]=[y("div",{class:"h-full w-full animate-pulse bg-dialog-surface"},null,-1)])),_:1})]),bottom:E(()=>[L(Ao,null,{default:E(()=>oe[19]||(oe[19]=[y("div",{class:"px-4 py-3"},[y("div",{class:"mb-2 h-6 animate-pulse rounded bg-dialog-surface"}),y("div",{class:"h-4 animate-pulse rounded bg-dialog-surface"})],-1)])),_:1})]),_:2},1024))),128))],4))])),!v(Ve)&&v(Ft)?(m(),T("div",{key:2,ref_key:"loadTrigger",ref:Ge,class:"mt-4 flex h-4 w-full items-center justify-center"},[v(Ye)?(m(),T("div",Ch,z(ae.$t("templateWorkflows.loadingMore","Loading more...")),1)):A("",!0)],512)):A("",!0),v(Ve)?A("",!0):(m(),T("div",Sh,z(ae.$t("templateWorkflows.resultsCount",{count:v(D),total:v(B)})),1))]),_:1},8,["content-title"])}}}),Ps="global-workflow-template-selector",ts=n(()=>{const e=it(),o=St();function t(){o.closeDialog({key:Ps})}n(t,"hide");function a(l="command"){e.showLayoutDialog({key:Ps,component:xh,props:{onClose:t},dialogComponentProps:{pt:{content:{class:"!px-0 overflow-hidden h-full !py-0"},root:{style:"width: 90vw; height: 85vh; max-width: 1400px; display: flex;"}}}})}return n(a,"show"),{show:a,hide:t}},"useWorkflowTemplateSelectorDialog"),_n=n((e,o,t=30)=>{const a=e instanceof HTMLElement?e:e.target;let l=0;const s=setInterval(()=>{o(l++)},t),i=n(()=>{clearInterval(s),r(),u()},"dispose"),r=Re(document,"mouseup",i),u=Re(a,"mouseup",i);return{dispose:i}},"whileMouseDown"),$h={class:"flex h-8 w-8 items-center justify-center rounded-lg bg-black"},_h=["href","onMousedown","onClick"],Th={class:"p-menubar-item-label text-nowrap"},Nh={key:3,class:"keybinding-tag ml-auto rounded border border-surface p-1 text-xs text-nowrap text-muted"},Mh={key:4,class:"pi pi-angle-right ml-auto"},Ih={class:"p-menubar-item-label text-nowrap"},Ph=K({__name:"ComfyMenuButton",setup(e){const{t:o}=ce(),t=ke(),a=Ca(),l=ft(),s=Sa(),i=St(),r=_t(),u=ne(),c=R(null),p=R(null),g=b({get:n(()=>u.get("Comfy.VueNodes.Enabled")??!1,"get"),set:n(async P=>{await u.set("Comfy.VueNodes.Enabled",P)},"set")});function d(P){c.value?.toggle(P)}n(d,"onLogoMenuClick");const w=n(P=>{const G=typeof P.label=="function"?P.label():P.label,D=G?o(`menuLabels.${Oe(G)}`,G):void 0;return{...P,label:D,items:P.items?.map(w)}},"translateMenuItem"),h=n(P=>{i.showDialog({key:"global-settings",headerComponent:$i,component:_i,props:{defaultPanel:P}})},"showSettings"),C=n(async()=>{await r.openManager({initialTab:ro.All,showToastOnLegacyError:!1})},"showManageExtensions"),f=b(()=>l.palettes.map(P=>({key:`theme-${P.id}`,label:P.name,parentPath:"theme",comfyCommand:{active:n(()=>l.activePaletteId===P.id,"active")},command:n(async()=>{await s.loadColorPalette(P.id)},"command")}))),S=b(()=>[{separator:!0},{key:"theme",label:o("menu.theme"),items:f.value},{key:"nodes-2.0-toggle",label:"Nodes 2.0"},{separator:!0},{key:"browse-templates",label:o("menuLabels.Browse Templates"),icon:"icon-[comfy--template]",command:n(()=>ts().show("menu"),"command")},{key:"settings",label:o("g.settings"),icon:"mdi mdi-cog-outline",command:n(()=>{h()},"command")},{key:"manage-extensions",label:o("menu.manageExtensions"),icon:"mdi mdi-puzzle-outline",command:C}]),$=b(()=>{const P=a.menuItems.map(w);let G=P.findIndex(B=>B.key==="Help"),D;if(G!==-1){P[G].icon="mdi mdi-help-circle-outline";const B=G!==P.length-1;D=P.splice(G,1,...B?[{separator:!0}]:[])[0]}return G=P.length,P.splice(G,0,...S.value,...D?[{separator:!0},D]:[]),P}),k=n(()=>{Le(()=>{c.value&&(c.value.dirty=!0)})},"onMenuShow"),x=n(P=>P.comfyCommand?.id==="Comfy.Canvas.ZoomIn"||P.comfyCommand?.id==="Comfy.Canvas.ZoomOut","isZoomCommand"),_=n((P,G)=>{P.comfyCommand&&_n(G,async()=>{await t.execute(P.comfyCommand.id)},50)},"handleZoomMouseDown"),M=n((P,G)=>{if(x(P)||P.comfyCommand?.active)return G.preventDefault(),G.stopPropagation(),P.comfyCommand?.active&&P.command?.({item:P,originalEvent:G}),!1},"handleItemClick"),N=n(P=>P.parentPath&&(P.parentPath==="theme"||a.menuItemHasActiveStateChildren[P.parentPath]),"hasActiveStateSiblings"),I=n(()=>!1,"handleNodes2ToggleClick"),V=n(async P=>{await u.set("Comfy.VueNodes.Enabled",P)},"onNodes2ToggleChange");return(P,G)=>{const D=_e("tooltip");return m(),T(le,null,[ue((m(),T("div",{ref_key:"menuButtonRef",ref:p,class:J(["comfy-menu-button-wrapper flex shrink-0 cursor-pointer flex-col items-center justify-center p-2 transition-colors",{"comfy-menu-button-active":c.value?.visible}]),onClick:G[0]||(G[0]=B=>d(B))},[y("div",$h,[L(Ug,{alt:"ComfyUI Logo",class:"comfyui-logo h-[18px] w-[18px] text-white",mode:"fill"})])],2)),[[D,{value:v(o)("sideToolbar.labels.menu"),showDelay:300,hideDelay:300}]]),L(v(Fl),{ref_key:"menuRef",ref:c,model:$.value,popup:!0,class:"comfy-command-menu",onShow:k},{item:E(({item:B,props:F})=>[B.key!=="nodes-2.0-toggle"?(m(),T("a",kt({key:0,class:"p-menubar-item-link px-4 py-2"},F.action,{href:B.url,target:"_blank",class:typeof B.class=="function"?B.class():B.class,onMousedown:n(W=>x(B)?_(B,W):void 0,"onMousedown"),onClick:n(W=>M(B,W),"onClick")}),[N(B)?(m(),T("i",{key:0,class:J(["p-menubar-item-icon pi pi-check text-sm",{invisible:!B.comfyCommand?.active?.()}])},null,2)):B.icon&&B.comfyCommand?.id!=="Comfy.NewBlankWorkflow"?(m(),T("span",{key:1,class:J(["p-menubar-item-icon text-sm",B.icon])},null,2)):A("",!0),y("span",Th,z(B.label),1),B.comfyCommand?.id==="Comfy.NewBlankWorkflow"?(m(),T("i",{key:2,class:J(["ml-auto",B.icon])},null,2)):A("",!0),B?.comfyCommand?.keybinding?(m(),T("span",Nh,z(B.comfyCommand.keybinding.combo.toString()),1)):A("",!0),B.items?(m(),T("i",Mh)):A("",!0)],16,_h)):(m(),T("div",{key:1,class:"flex items-center justify-between px-4 py-2",onClick:Ne(I,["stop"])},[y("span",Ih,z(B.label),1),L(v(Ht),{severity:"info",class:"ml-2 text-xs"},{default:E(()=>[qe(z(P.$t("g.beta")),1)]),_:1}),L(v(zl),{modelValue:g.value,"onUpdate:modelValue":[G[1]||(G[1]=W=>g.value=W),V],class:"ml-4","aria-label":B.label,pt:{root:{style:{width:"38px",height:"20px"}},handle:{style:{width:"16px",height:"16px"}}},onClick:G[2]||(G[2]=Ne(()=>{},["stop"]))},null,8,["modelValue","aria-label"])]))]),_:1},8,["model"])],64)}}}),Rh=Se(Ph,[["__scopeId","data-v-7cdf607b"]]),Dh={viewBox:"0 0 256 256",width:"1.2em",height:"1.2em"};function Ah(e,o){return m(),T("svg",Dh,o[0]||(o[0]=[y("path",{fill:"currentColor",d:"m120 137l-72 64a12 12 0 1 1-16-18l61.91-55L32 73a12 12 0 1 1 16-18l72 64a12 12 0 0 1 0 18m96 43h-96a12 12 0 0 0 0 24h96a12 12 0 0 0 0-24"},null,-1)]))}n(Ah,"render$1");const Lh=Ks({name:"ph-terminal-bold",render:Ah}),Eh={class:"side-bar-button-content"},Vh={key:0,class:"side-bar-button-label"},Wh=K({__name:"SidebarIcon",props:{icon:{default:""},selected:{type:Boolean,default:!1},tooltip:{default:""},tooltipSuffix:{default:""},iconBadge:{type:[String,Function],default:""},label:{default:""},isSmall:{type:Boolean,default:!1}},emits:["click"],setup(e,{emit:o}){const{t}=ce(),a=o,l=b(()=>typeof e.iconBadge=="function"?e.iconBadge()??"":e.iconBadge),s=b(()=>!!l.value),i=b(()=>t(e.tooltip)+e.tooltipSuffix);return(r,u)=>{const c=_e("tooltip");return ue((m(),O(v(re),{text:"",pt:{root:{class:`side-bar-button p-button-secondary ${r.selected?"side-bar-button-selected":""}`,"aria-label":i.value}},onClick:u[0]||(u[0]=p=>a("click",p))},{icon:E(()=>[y("div",Eh,[Pe(r.$slots,"icon",{},()=>[s.value?(m(),O(v(Ul),{key:0,value:l.value},{default:E(()=>[typeof r.icon=="string"?(m(),T("i",{key:0,class:J(r.icon+" side-bar-button-icon")},null,2)):(m(),O(Kt(r.icon),{key:1,class:"side-bar-button-icon"}))]),_:1},8,["value"])):typeof r.icon=="string"?(m(),T("i",{key:1,class:J(r.icon+" side-bar-button-icon")},null,2)):typeof r.icon=="object"?(m(),O(Kt(r.icon),{key:2,class:"side-bar-button-icon"})):A("",!0)],!0),r.label&&!r.isSmall?(m(),T("span",Vh,z(v(t)(r.label)),1)):A("",!0)])]),_:3},8,["pt"])),[[c,{value:i.value,showDelay:300,hideDelay:300}]])}}}),zt=Se(Wh,[["__scopeId","data-v-c90a38ba"]]),Oh=K({__name:"SidebarBottomPanelToggleButton",setup(e){const o=Yt(),t=n(()=>{o.toggleBottomPanel()},"toggleConsole");return(a,l)=>{const s=Lh;return m(),O(zt,{label:a.$t("sideToolbar.labels.console"),tooltip:a.$t("menu.toggleBottomPanel"),selected:v(o).activePanel=="terminal",onClick:t},{icon:E(()=>[L(s)]),_:1},8,["label","tooltip","selected"])}}}),Bh=K({__name:"SidebarSettingsButton",setup(e){const{t:o}=ce(),{getCommand:t,formatKeySequence:a}=ke(),l=t("Comfy.ShowSettingsDialog"),s=b(()=>`${o("g.settings")} (${a(l)})`),i=n(()=>{l.function()},"showSettingsDialog");return(r,u)=>(m(),O(zt,{label:r.$t("g.settings"),tooltip:s.value,onClick:i},{icon:E(()=>u[0]||(u[0]=[y("i",{class:"icon-[lucide--settings]"},null,-1)])),_:1},8,["label","tooltip"]))}}),zh=K({__name:"SidebarShortcutsToggleButton",setup(e){const{t:o}=ce(),t=Yt(),a=ke(),l=a.getCommand("Workspace.ToggleBottomPanel.Shortcuts"),{formatKeySequence:s}=a,i=b(()=>t.activePanel==="shortcuts"),r=b(()=>`${o("shortcuts.keyboardShortcuts")} (${s(l)})`),u=n(()=>{t.togglePanel("shortcuts")},"toggleShortcutsPanel");return(c,p)=>(m(),O(zt,{label:c.$t("shortcuts.shortcuts"),tooltip:r.value,selected:i.value,onClick:u},{icon:E(()=>p[0]||(p[0]=[y("i",{class:"icon-[lucide--keyboard]"},null,-1)])),_:1},8,["label","tooltip","selected"]))}}),Fh=["width","height"],Uh={"clip-path":"url(#clip0_1099_16244)"},Gh=["stroke"],Hh=K({__name:"PuzzleIcon",props:{size:{default:16},color:{default:"currentColor"},class:{}},setup(e){const o=b(()=>e.class||"");return(t,a)=>(m(),T("svg",{xmlns:"http://www.w3.org/2000/svg",width:t.size,height:t.size,viewBox:"0 0 16 16",fill:"none",class:J(o.value)},[y("g",Uh,[y("path",{d:"M4.99992 3.00016C4.99992 2.07969 5.74611 1.3335 6.66658 1.3335C7.58706 1.3335 8.33325 2.07969 8.33325 3.00016V4.00016H8.99992C9.9318 4.00016 10.3977 4.00016 10.7653 4.1524C11.2553 4.35539 11.6447 4.74474 11.8477 5.2348C11.9999 5.60234 11.9999 6.06828 11.9999 7.00016H12.9999C13.9204 7.00016 14.6666 7.74635 14.6666 8.66683C14.6666 9.5873 13.9204 10.3335 12.9999 10.3335H11.9999V11.4668C11.9999 12.5869 11.9999 13.147 11.7819 13.5748C11.5902 13.9511 11.2842 14.2571 10.9079 14.4488C10.4801 14.6668 9.92002 14.6668 8.79992 14.6668H8.33325V13.5002C8.33325 12.6717 7.66168 12.0002 6.83325 12.0002C6.00482 12.0002 5.33325 12.6717 5.33325 13.5002V14.6668H4.53325C3.41315 14.6668 2.85309 14.6668 2.42527 14.4488C2.04895 14.2571 1.74299 13.9511 1.55124 13.5748C1.33325 13.147 1.33325 12.5869 1.33325 11.4668V10.3335H2.33325C3.25373 10.3335 3.99992 9.5873 3.99992 8.66683C3.99992 7.74635 3.25373 7.00016 2.33325 7.00016H1.33325C1.33325 6.06828 1.33325 5.60234 1.48549 5.2348C1.68848 4.74474 2.07783 4.35539 2.56789 4.1524C2.93543 4.00016 3.40137 4.00016 4.33325 4.00016H4.99992V3.00016Z",stroke:t.color,"stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"},null,8,Gh)]),a[0]||(a[0]=y("defs",null,[y("clipPath",{id:"clip0_1099_16244"},[y("rect",{width:"16",height:"16",fill:"white"})])],-1))],10,Fh))}}),Rs=Qs.create({baseURL:xa(),headers:{"Content-Type":"application/json"}}),jh=n(()=>{const e=R(!1),o=R(null);te(()=>xa(),s=>{Rs.defaults.baseURL=s});const t=n((s,i,r)=>{if(!Qs.isAxiosError(s))return s instanceof Error?`${i}: ${s.message}`:`${i}: Unknown error occurred`;const u=s;if(u.response){const{status:c,data:p}=u.response;if(r&&r[c])return r[c];switch(c){case 400:return`Bad request: ${p?.message||"Invalid input"}`;case 401:return"Unauthorized: Authentication required";case 403:return`Forbidden: ${p?.message||"Access denied"}`;case 404:return`Not found: ${p?.message||"Resource not found"}`;case 500:return`Server error: ${p?.message||"Internal server error"}`;default:return`${i}: ${p?.message||u.message}`}}return`${i}: ${u.message}`},"handleApiError"),a=n(async(s,i,r)=>{e.value=!0,o.value=null;try{return(await s()).data}catch(u){return Ti(u)||(o.value=t(u,i,r)),null}finally{e.value=!1}},"executeApiRequest");return{isLoading:e,error:o,getReleases:n(async(s,i)=>{const r="/releases";return await a(()=>Rs.get(r,{params:s,signal:i}),"Failed to get releases",{400:"Invalid project or version parameter"})},"getReleases")}},"useReleaseService"),wo=Vt("release",()=>{const e=R([]),o=R(!1),t=R(null),a=jh(),l=$a(),s=ne(),i=b(()=>l?.systemStats?.system?.comfyui_version??""),r=b(()=>s.get("Comfy.Locale")),u=b(()=>s.get("Comfy.Release.Version")),c=b(()=>s.get("Comfy.Release.Status")),p=b(()=>s.get("Comfy.Release.Timestamp")),g=b(()=>s.get("Comfy.Notification.ShowVersionUpdates")),d=b(()=>e.value[0]??null),w=b(()=>e.value.slice(0,3)),h=3*24*60*60*1e3,C=b(()=>!!d.value&&ao.compare(d.value.version,i.value||"0.0.0")>0),f=b(()=>!!d.value&&ao.compare(d.value.version,i.value||"0.0.0")===0),S=b(()=>{const P=d.value?.attention;return P==="medium"||P==="high"}),$=b(()=>!(!ze()||jt||!g.value||!C.value||!S.value||u.value===d.value?.version&&["skipped","changelog seen"].includes(c.value))),k=b(()=>{if(!ze()||jt||!g.value||!C.value)return!1;const{version:P}=d.value;return u.value===P&&c.value==="changelog seen"?!1:S.value?!0:!(u.value===P&&c.value==="skipped"&&p.value&&Date.now()-p.value>=h)}),x=b(()=>!(!ze()||jt||!g.value||!f.value||u.value===d.value.version&&c.value==="what's new seen"));async function _(P){P!==d.value?.version||c.value==="changelog seen"||(await s.set("Comfy.Release.Version",P),await s.set("Comfy.Release.Status","skipped"),await s.set("Comfy.Release.Timestamp",Date.now()))}n(_,"handleSkipRelease");async function M(P){P===d.value?.version&&(await s.set("Comfy.Release.Version",P),await s.set("Comfy.Release.Status","changelog seen"),await s.set("Comfy.Release.Timestamp",Date.now()))}n(M,"handleShowChangelog");async function N(P){P===d.value?.version&&(await s.set("Comfy.Release.Version",P),await s.set("Comfy.Release.Status","what's new seen"),await s.set("Comfy.Release.Timestamp",Date.now()))}n(N,"handleWhatsNewSeen");async function I(){if(!o.value&&g.value&&!l.systemStats?.system?.argv?.includes("--disable-api-nodes")){o.value=!0,t.value=null;try{l.systemStats||await Js(l.isInitialized);const P=await a.getReleases({project:"comfyui",current_version:i.value,form_factor:l.getFormFactor(),locale:Ni(r.value)});P!==null?e.value=P:a.error.value&&(t.value=a.error.value)}catch(P){t.value=P instanceof Error?P.message:"Unknown error occurred"}finally{o.value=!1}}}n(I,"fetchReleases");async function V(){await I()}return n(V,"initialize"),{releases:e,isLoading:o,error:t,recentRelease:d,recentReleases:w,shouldShowToast:$,shouldShowRedDot:k,shouldShowPopup:x,shouldShowUpdateButton:C,handleSkipRelease:_,handleShowChangelog:M,handleWhatsNewSeen:N,fetchReleases:I,initialize:V}}),qh=Object.freeze(Object.defineProperty({__proto__:null,useReleaseStore:wo},Symbol.toStringTag,{value:"Module"})),Kh=["aria-label"],Qh={class:"help-menu-section",role:"menubar"},Jh=["onClick","onMouseenter","onMouseleave"],Yh={class:"help-menu-icon-container"},Zh={class:"help-menu-icon"},Xh={key:0,class:"menu-red-dot"},ey={class:"menu-label"},ty={key:0,class:"pi pi-chevron-right"},oy={key:0,class:"submenu-divider"},ny=["onClick"],sy={class:"menu-label"},ay={key:0,class:"whats-new-section"},ly={class:"section-description"},iy=["aria-label"],ry=["onClick","onKeydown"],uy={class:"release-content"},cy={class:"release-title"},dy=["datetime"],py={class:"normal-state"},fy={class:"hover-state"},my={key:1,class:"help-menu-item",role:"status","aria-live":"polite"},vy={key:2,class:"help-menu-item",role:"status"},gy=K({__name:"HelpCenterMenuContent",emits:["close"],setup(e,{emit:o}){const t={MINUTE:6e4,HOUR:36e5,DAY:864e5,WEEK:6048e5,MONTH:2592e6,YEAR:31536e6},a={DELAY_MS:100,OFFSET_PX:8,Z_INDEX:10001},{t:l}=ce(),{staticUrls:s,buildDocsUrl:i}=Zt(),r=wo(),u=ke(),c=ne(),p=o,g=R(!1),d=R(null),w=R({});let h=null;const C=R(Date.now()),f=b(()=>r.releases.length>0),S=b(()=>c.get("Comfy.Notification.ShowVersionUpdates")),{shouldShowRedDot:$}=_a(),k=b(()=>[{key:"desktop-guide",type:"item",label:l("helpCenter.desktopUserGuide"),visible:ze(),action:n(()=>{N(),I(i("/installation/desktop",{includeLocale:!0,platform:!0})),p("close")},"action")},{key:"dev-tools",type:"item",label:l("helpCenter.openDevTools"),visible:ze(),action:n(()=>{U(),p("close")},"action")},{key:"divider-1",type:"divider",visible:ze()},{key:"reinstall",type:"item",label:l("helpCenter.reinstall"),visible:ze(),action:n(()=>{q(),p("close")},"action")}].filter(ee=>ee.visible!==!1)),x=b(()=>!!k.value.length),_=b(()=>M.value.find(Y=>Y.key==="more")),M=b(()=>{const Y=[{key:"docs",type:"item",icon:"pi pi-book",label:l("helpCenter.docs"),action:n(()=>{N(),I(i("/",{includeLocale:!0})),p("close")},"action")},{key:"discord",type:"item",icon:"pi pi-discord",label:"Discord",action:n(()=>{N(),I(s.discord),p("close")},"action")},{key:"github",type:"item",icon:"pi pi-github",label:l("helpCenter.github"),action:n(()=>{N(),I(s.github),p("close")},"action")},{key:"help",type:"item",icon:"pi pi-question-circle",label:l("helpCenter.helpFeedback"),action:n(()=>{N(),u.execute("Comfy.ContactSupport"),p("close")},"action")}];return Y.push({key:"manager",type:"item",icon:Hh,label:l("helpCenter.managerExtension"),showRedDot:$.value,action:n(async()=>{N(),await _t().openManager({initialTab:ro.All,showToastOnLegacyError:!1}),p("close")},"action")}),Y.push({key:"more",type:"item",icon:"",label:l("helpCenter.more"),visible:x.value,action:n(()=>{},"action"),items:k.value}),Y}),N=n((Y,ee)=>{},"trackResourceClick"),I=n(Y=>{window.open(Y,"_blank","noopener,noreferrer")},"openExternalLink"),V=n(()=>{h&&(clearTimeout(h),h=null)},"clearHoverTimeout"),P=n(Y=>{const ee=Y.getBoundingClientRect(),se=210,He=(_.value?.items?.filter(Ge=>Ge.visible!==!1).length||0)*48+16,je=d.value?.offsetHeight||He,ot=window.innerWidth,Ue=window.innerHeight;let Be=ee.top,mt=ee.right+a.OFFSET_PX;return mt+se>ot&&(mt=ee.left-se-a.OFFSET_PX),Be+je>Ue&&(Be=Math.max(a.OFFSET_PX,ee.bottom-je)),Be<a.OFFSET_PX&&(Be=a.OFFSET_PX),Be-=8,{position:"fixed",top:`${Be}px`,left:`${mt}px`,zIndex:a.Z_INDEX}},"calculateSubmenuPosition"),G=n(Y=>{if(!Y)return"date";const ee=new Date(Y),xe=Math.abs(new Date().getTime()-ee.getTime()),He=[{unit:t.YEAR,suffix:"y"},{unit:t.MONTH,suffix:"mo"},{unit:t.WEEK,suffix:"w"},{unit:t.DAY,suffix:"d"},{unit:t.HOUR,suffix:"h"},{unit:t.MINUTE,suffix:"min"}];for(const{unit:je,suffix:ot}of He){const Ue=Math.floor(xe/je);if(Ue>0)return`${Ue}${ot} ago`}return"now"},"formatReleaseDate"),D=n(Y=>r.shouldShowUpdateButton&&Y===r.recentReleases[0],"shouldShowUpdateButton"),B=n(async(Y,ee)=>{if(Y!=="more"||!_.value?.items||!_.value.items.some(He=>He.visible!==!1))return;V();const xe=ee.currentTarget;w.value=P(xe),g.value=!0,await Le(),d.value&&(w.value=P(xe))},"onMenuItemHover"),F=n(Y=>{Y==="more"&&(h=window.setTimeout(()=>{g.value=!1},a.DELAY_MS))},"onMenuItemLeave"),W=n(()=>{V()},"onSubmenuHover"),H=n(()=>{g.value=!1},"onSubmenuLeave"),U=n(()=>{ze()&&uo().openDevTools()},"openDevTools"),q=n(()=>{ze()&&uo().reinstall()},"onReinstall"),Q=n(Y=>{r.handleShowChangelog(Y.version);const ee=Un(Y.version),se=`${i("/changelog",{includeLocale:!0})}#${ee}`;I(se),p("close")},"onReleaseClick"),me=n(Y=>{I(i("/installation/update_comfyui",{includeLocale:!0})),p("close")},"onUpdate");return De(async()=>{f.value||await r.fetchReleases()}),Ct(()=>{Math.round((Date.now()-C.value)/1e3)}),(Y,ee)=>(m(),T("div",{class:"help-center-menu",role:"menu","aria-label":Y.$t("helpCenter.helpFeedback")},[y("nav",Qh,[(m(!0),T(le,null,we(M.value,se=>ue((m(),T("button",{key:se.key,type:"button",class:J(["help-menu-item",{"more-item":se.key==="more"}]),role:"menuitem",onClick:se.action,onMouseenter:n(xe=>B(se.key,xe),"onMouseenter"),onMouseleave:n(xe=>F(se.key),"onMouseleave")},[y("div",Yh,[y("div",Zh,[typeof se.icon=="object"?(m(),O(Kt(se.icon),{key:0,size:16})):(m(),T("i",{key:1,class:J(se.icon)},null,2))]),se.showRedDot?(m(),T("div",Xh)):A("",!0)]),y("span",ey,z(se.label),1),se.key==="more"?(m(),T("i",ty)):A("",!0)],42,Jh)),[[Qe,se.visible!==!1]])),128))]),(m(),O(Rt,{to:"body"},[g.value?(m(),T("div",{key:0,ref_key:"submenuRef",ref:d,class:"more-submenu",style:pe(w.value),onMouseenter:W,onMouseleave:H},[(m(!0),T(le,null,we(_.value?.items,se=>(m(),T(le,{key:se.key},[se.type==="divider"?ue((m(),T("div",oy,null,512)),[[Qe,se.visible!==!1]]):ue((m(),T("button",{key:1,type:"button",class:"help-menu-item submenu-item",role:"menuitem",onClick:se.action},[y("span",sy,z(se.label),1)],8,ny)),[[Qe,se.visible!==!1]])],64))),128))],36)):A("",!0)])),S.value?(m(),T("section",ay,[y("h3",ly,z(Y.$t("helpCenter.whatsNew")),1),f.value?(m(),T("div",{key:0,role:"group","aria-label":Y.$t("helpCenter.recentReleases")},[(m(!0),T(le,null,we(v(r).recentReleases,se=>(m(),T("article",{key:se.id||se.version,class:"help-menu-item release-menu-item",role:"button",tabindex:"0",onClick:n(xe=>Q(se),"onClick"),onKeydown:[qt(xe=>Q(se),["enter"]),qt(Ne(xe=>Q(se),["prevent"]),["space"])]},[ee[0]||(ee[0]=y("i",{class:"pi pi-refresh help-menu-icon","aria-hidden":"true"},null,-1)),y("div",uy,[y("span",cy,z(Y.$t("g.releaseTitle",{package:"Comfy",version:se.version})),1),y("time",{class:"release-date",datetime:se.published_at},[y("span",py,z(G(se.published_at)),1),y("span",fy,z(Y.$t("helpCenter.clickToLearnMore")),1)],8,dy)]),D(se)?(m(),O(v(re),{key:0,label:Y.$t("helpCenter.updateAvailable"),size:"small",class:"update-button",onClick:Ne(xe=>me(),["stop"])},null,8,["label","onClick"])):A("",!0)],40,ry))),128))],8,iy)):v(r).isLoading?(m(),T("div",my,[ee[1]||(ee[1]=y("i",{class:"pi pi-spin pi-spinner help-menu-icon","aria-hidden":"true"},null,-1)),y("span",null,z(Y.$t("helpCenter.loadingReleases")),1)])):(m(),T("div",vy,[ee[2]||(ee[2]=y("i",{class:"pi pi-info-circle help-menu-icon","aria-hidden":"true"},null,-1)),y("span",null,z(Y.$t("helpCenter.noRecentReleases")),1)]))])):A("",!0)],8,Kh))}}),hy=Se(gy,[["__scopeId","data-v-6c6651d8"]]),yy={key:0,class:"release-toast-popup"},by={class:"release-notification-toast"},wy={class:"toast-header"},ky={class:"toast-text"},Cy={class:"toast-title"},Sy={class:"toast-version-badge"},xy={class:"toast-actions-section"},$y={class:"actions-row"},_y={class:"left-actions"},Ty=["href"],Ny={class:"right-actions"},My=K({__name:"ReleaseNotificationToast",setup(e){const{buildDocsUrl:o}=Zt(),t=wo(),a=R(!1),l=b(()=>t.recentRelease),s=b(()=>t.shouldShowToast&&!a.value),i=b(()=>{const h=o("/changelog",{includeLocale:!0});if(l.value?.version){const C=Un(l.value.version);return`${h}#${C}`}return h});let r=null;const u=n(()=>{r&&clearTimeout(r),r=setTimeout(()=>{p()},8e3)},"startAutoHide"),c=n(()=>{r&&(clearTimeout(r),r=null)},"clearAutoHide"),p=n(()=>{a.value=!0,c()},"dismissToast"),g=n(()=>{l.value&&t.handleSkipRelease(l.value.version),p()},"handleSkip"),d=n(()=>{l.value&&t.handleShowChangelog(l.value.version),p()},"handleLearnMore"),w=n(()=>{window.open(o("/installation/update_comfyui",{includeLocale:!0}),"_blank"),p()},"handleUpdate");return te(s,h=>{h?u():c()}),De(async()=>{t.releases.length||await t.fetchReleases()}),(h,C)=>s.value?(m(),T("div",yy,[y("div",by,[y("div",wy,[C[0]||(C[0]=y("div",{class:"toast-icon"},[y("i",{class:"pi pi-download"})],-1)),y("div",ky,[y("div",Cy,z(h.$t("releaseToast.newVersionAvailable")),1),y("div",Sy,z(l.value?.version),1)])]),y("div",xy,[y("div",$y,[y("div",_y,[y("a",{class:"learn-more-link",href:i.value,target:"_blank",rel:"noopener,noreferrer",onClick:d},z(h.$t("releaseToast.whatsNew")),9,Ty)]),y("div",Ny,[y("button",{class:"skip-button",onClick:g},z(h.$t("releaseToast.skip")),1),y("button",{class:"cta-button",onClick:w},z(h.$t("releaseToast.update")),1)])])])])])):A("",!0)}}),Iy=Se(My,[["__scopeId","data-v-c39af871"]]),Py={key:0,class:"whats-new-popup-container"},Ry=["aria-label"],Dy={class:"popup-content"},Ay=["innerHTML"],Ly={class:"popup-actions"},Ey=["href"],Vy=K({__name:"WhatsNewPopup",emits:["whats-new-dismissed"],setup(e,{expose:o,emit:t}){const{t:a}=ce(),{buildDocsUrl:l}=Zt(),s=wo(),i=t,r=R(!1),u=b(()=>s.recentRelease),c=b(()=>s.shouldShowPopup&&!r.value),p=b(()=>{const C=l("/changelog",{includeLocale:!0});if(u.value?.version){const f=Un(u.value.version);return`${C}#${f}`}return C}),g=b(()=>{if(!u.value?.content)return`<p>${a("whatsNewPopup.noReleaseNotes")}</p>`;try{return Mi(u.value.content)}catch(C){return console.error("Error parsing markdown:",C),u.value.content.replace(/\n/g,"<br>")}}),d=n(()=>{r.value=!1},"show"),w=n(()=>{r.value=!0,i("whats-new-dismissed")},"hide"),h=n(async()=>{u.value&&await s.handleWhatsNewSeen(u.value.version),w()},"closePopup");return De(async()=>{s.releases.length||await s.fetchReleases()}),o({show:d,hide:w}),(C,f)=>c.value?(m(),T("div",Py,[f[2]||(f[2]=bl('<div class="help-center-arrow" data-v-21279e5a><svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 0 16 19" fill="none" data-v-21279e5a><path d="M15.25 1.27246L15.25 17.7275L0.999023 9.5L15.25 1.27246Z" fill="#353535" data-v-21279e5a></path><path d="M15.25 1.27246L0.999023 9.5" stroke="#4e4e4e" stroke-width="1" fill="none" data-v-21279e5a></path><path d="M0.999023 9.5L15.25 17.7275" stroke="#4e4e4e" stroke-width="1" fill="none" data-v-21279e5a></path></svg></div>',1)),y("div",{class:"whats-new-popup",onClick:f[0]||(f[0]=Ne(()=>{},["stop"]))},[y("button",{class:"close-button","aria-label":C.$t("g.close"),onClick:h},f[1]||(f[1]=[y("div",{class:"close-icon"},null,-1)]),8,Ry),y("div",Dy,[y("div",{class:"content-text",innerHTML:g.value},null,8,Ay),y("div",Ly,[y("a",{class:"learn-more-link",href:p.value,target:"_blank",rel:"noopener,noreferrer",onClick:h},z(C.$t("whatsNewPopup.learnMore")),9,Ey)])])])])):A("",!0)}}),Wy=Se(Vy,[["__scopeId","data-v-21279e5a"]]),Tn=Vt("helpCenter",()=>{const e=R(!1);return{isVisible:e,toggle:n(()=>{e.value=!e.value},"toggle"),show:n(()=>{e.value=!0},"show"),hide:n(()=>{e.value=!1},"hide")}}),Oy=K({__name:"SidebarHelpCenterIcon",props:{isSmall:{type:Boolean}},setup(e){const o=ne(),t=wo(),a=Tn(),{isVisible:l}=at(a),{shouldShowRedDot:s}=at(t),i=Ii(),{showNodeConflictDialog:r}=it(),{shouldShowRedDot:u,markConflictsAsSeen:c}=_a(),p=e,{isSmall:g}=Ys(p),d=b(()=>s.value||u.value),w=b(()=>o.get("Comfy.Sidebar.Location")),h=n(()=>{a.toggle()},"toggleHelpCenter"),C=n(()=>{a.hide()},"closeHelpCenter"),f=n(async()=>{try{await i.shouldShowConflictModalAfterUpdate()&&S()}catch($){console.error("[HelpCenter] Error checking conflict modal:",$)}},"handleWhatsNewDismissed"),S=n(()=>{r({showAfterWhatsNew:!0,dialogComponentProps:{onClose:n(()=>{c()},"onClose")}})},"showConflictModal");return De(async()=>{await t.initialize()}),($,k)=>(m(),T("div",null,[L(zt,{icon:"pi pi-question-circle",class:"comfy-help-center-btn",label:$.$t("menu.help"),tooltip:$.$t("sideToolbar.helpCenter"),"icon-badge":d.value?"":"","is-small":v(g),onClick:h},null,8,["label","tooltip","icon-badge","is-small"]),(m(),O(Rt,{to:"#graph-canvas-container"},[v(l)?(m(),T("div",{key:0,class:J(["help-center-popup",{"sidebar-left":w.value==="left","sidebar-right":w.value==="right","small-sidebar":v(g)}])},[L(hy,{onClose:C})],2)):A("",!0)])),(m(),O(Rt,{to:"#graph-canvas-container"},[L(Iy,{class:J({"sidebar-left":w.value==="left","sidebar-right":w.value==="right","small-sidebar":v(g)})},null,8,["class"])])),(m(),O(Rt,{to:"#graph-canvas-container"},[L(Wy,{class:J({"sidebar-left":w.value==="left","sidebar-right":w.value==="right","small-sidebar":v(g)}),onWhatsNewDismissed:f},null,8,["class"])])),(m(),O(Rt,{to:"body"},[v(l)?(m(),T("div",{key:0,class:"help-center-backdrop",onClick:C})):A("",!0)]))]))}}),By=Se(Oy,[["__scopeId","data-v-91ae5559"]]),zy=K({__name:"SidebarLogoutIcon",setup(e){const{t:o}=ce(),t=Ta(),a=b(()=>`${o("sideToolbar.logout")} (${t.currentUser?.username})`),l=n(async()=>{await t.logout(),window.location.reload()},"logout");return(s,i)=>(m(),O(zt,{icon:"pi pi-sign-out",tooltip:a.value,label:s.$t("sideToolbar.logout"),onClick:l},null,8,["tooltip","label"]))}}),Fy=K({__name:"SidebarTemplatesButton",setup(e){const o=ne(),t=b(()=>o.get("Comfy.Sidebar.Size")==="small"),a=n(()=>{ts().show("sidebar")},"openTemplates");return(l,s)=>(m(),O(zt,{icon:"icon-[comfy--template]",tooltip:l.$t("sideToolbar.templates"),label:l.$t("sideToolbar.labels.templates"),"is-small":t.value,class:"templates-tab-button",onClick:a},null,8,["tooltip","label","is-small"]))}}),Uy=20,Gy=50,Hy=K({__name:"SideToolbar",setup(e){const o=lt(),t=ne(),a=Ta(),l=ke(),s=fe(),i=R(),r=R(),u=R(),c=R(),p=b(()=>t.get("Comfy.Sidebar.Size")==="small"),g=b(()=>t.get("Comfy.Sidebar.Location")),d=b(()=>t.get("Comfy.Sidebar.Style")),w=b(()=>C.value||k.value||d.value==="connected"),h=b(()=>o.getSidebarTabs()),C=b(()=>o.sidebarTab.activeSidebarTab),f=n(async M=>{M.id,M.id,M.id,M.id,await l.commands.find(N=>N.id===`Workspace.ToggleSidebarTab.${M.id}`)?.function?.()},"onTabClick"),S=Pi(),$=n(M=>{const N=S.getKeybindingByCommandId(`Workspace.ToggleSidebarTab.${M.id}`);return N?` (${N.combo.toString()})`:""},"getTabTooltipSuffix"),k=R(!1),x=b(()=>de("sidebar-item-group flex flex-col items-center overflow-hidden flex-shrink-0"+(w.value?"":" rounded-lg shadow-interface"))),_=qo(()=>{if(!i.value||!u.value||!c.value)return;const M=i.value.clientHeight,N=u.value.scrollHeight,I=c.value.scrollHeight,V=N+I;k.value?k.value=M<V+Gy:k.value=M<V+Uy},16);return De(()=>{if(!i.value)return;const M=Us(i.value,_);_(),Ct(()=>{M.stop()}),te([p,g],async()=>{s.canvas&&(g.value==="left"?(await Le(),s.canvas.fpsInfoLocation=[i.value?.getBoundingClientRect()?.right,null]):s.canvas.fpsInfoLocation=null,s.canvas.setDirty(!1,!0))},{immediate:!0})}),(M,N)=>(m(),T("nav",{ref_key:"sideToolbarRef",ref:i,class:J(["side-tool-bar-container flex h-full flex-col items-center bg-transparent [.floating-sidebar]:-mr-2 pointer-events-auto",{"small-sidebar":p.value,"connected-sidebar":w.value,"floating-sidebar":!w.value,"overflowing-sidebar":k.value,"border-r border-[var(--interface-stroke)] shadow-interface":w.value}])},[y("div",{ref_key:"contentMeasureRef",ref:r,class:J(k.value?"side-tool-bar-container overflow-y-auto":"flex flex-col h-full")},[y("div",{ref_key:"topToolbarRef",ref:u,class:J(x.value)},[L(Rh),(m(!0),T(le,null,we(h.value,I=>(m(),O(zt,{key:I.id,icon:I.icon,"icon-badge":I.iconBadge,tooltip:I.tooltip,"tooltip-suffix":$(I),label:I.label||I.title,"is-small":p.value,selected:I.id===C.value?.id,class:J(I.id+"-tab-button"),onClick:n(V=>f(I),"onClick")},null,8,["icon","icon-badge","tooltip","tooltip-suffix","label","is-small","selected","class","onClick"]))),128)),L(Fy)],2),y("div",{ref_key:"bottomToolbarRef",ref:c,class:J(["mt-auto",x.value])},[v(a).isMultiUserServer?(m(),O(zy,{key:0,"is-small":p.value},null,8,["is-small"])):A("",!0),L(By,{"is-small":p.value},null,8,["is-small"]),L(Oh,{"is-small":p.value},null,8,["is-small"]),L(zh,{"is-small":p.value},null,8,["is-small"]),L(Bh,{"is-small":p.value},null,8,["is-small"])],2)],2)],2))}}),jy=Se(Hy,[["__scopeId","data-v-6f9c7998"]]),qy=Vt("topbarBadge",()=>{const e=zn();return{badges:b(()=>e.extensions.flatMap(t=>t.topbarBadges??[]))}}),Ky={class:"flex h-full shrink-0 items-center"},Ka=K({__name:"TopbarBadges",props:{reverseOrder:{type:Boolean,default:!1},noPadding:{type:Boolean,default:!1}},setup(e){const o=Bs(Zs),t=o.greaterOrEqual("xl"),a=o.greaterOrEqual("lg"),l=b(()=>t.value?"full":a.value?"compact":"icon-only"),s=qy();return(i,r)=>(m(),T("div",Ky,[(m(!0),T(le,null,we(v(s).badges,u=>(m(),O(Td,{key:u.text,badge:u,"display-mode":l.value,"reverse-order":i.reverseOrder,"no-padding":i.noPadding},null,8,["badge","display-mode","reverse-order","no-padding"]))),128))]))}}),Qy={class:"workflow-preview-content"},Jy={key:0,class:"workflow-preview-thumbnail relative"},Yy=["src"],Zy={class:"workflow-preview-footer"},Xy={class:"workflow-preview-name"},eb=250,tb=K({__name:"WorkflowTabPopover",props:{workflowFilename:{},thumbnailUrl:{},isActiveTab:{type:Boolean}},setup(e,{expose:o}){const t=e,{thumbnailUrl:a,isActiveTab:l}=Ys(t),s=R(null),i=R(null);let r=null,u=null;const c=bn(),p=n(h=>{r&&(clearTimeout(r),r=null),u&&(clearTimeout(u),u=null),u=setTimeout(async()=>{if(s.value&&i.value){s.value.show(h,i.value),await Le();const C=document.querySelector(`.workflow-popover-fade[data-popover-id="${c}"]`);if(C){const f=i.value.getBoundingClientRect().left,S=C.getBoundingClientRect().width,$=S/2;let k=f-$,x=0;if(k<0)x=k-8,k=8;else if(k+S>window.innerWidth){const _=window.innerWidth-S-16;x=k-_,k=_}x+$<0&&(x=-$+24),C.style.left=`${k}px`,C.style.setProperty("--shift",`${x}px`)}}},200)},"showPopover"),g=n(()=>{},"cancelHidePopover"),d=n(()=>{u&&(clearTimeout(u),u=null),r=setTimeout(()=>{s.value&&s.value.hide()},100)},"hidePopover");return o({showPopover:p,hidePopover:d,togglePopover:n(h=>{s.value&&s.value.toggle(h)},"togglePopover")}),(h,C)=>(m(),T(le,null,[y("div",{ref_key:"positionRef",ref:i,class:"absolute bottom-0 left-1/2 -translate-x-1/2"},null,512),L(v(et),{ref_key:"popoverRef",ref:s,"append-to":"body",pt:{root:{class:"workflow-popover-fade fit-content","data-popover-id":v(c)}},onMouseenter:g,onMouseleave:d},{default:E(()=>[y("div",Qy,[v(a)&&!v(l)?(m(),T("div",Jy,[y("img",{src:v(a),class:"block h-[200px] rounded-lg object-cover p-2",style:pe({width:`${eb}px`})},null,12,Yy)])):A("",!0),y("div",Zy,[y("span",Xy,z(h.workflowFilename),1)])])]),_:1},8,["pt"])],64))}}),ob=Se(tb,[["__scopeId","data-v-4c13cb50"]]),nb={class:"workflow-label inline-block max-w-[150px] truncate text-sm"},sb={class:"relative"},ab={key:0,class:"absolute top-1/2 left-1/2 z-10 w-4 -translate-1/2 bg-(--comfy-menu-bg) text-2xl font-bold group-hover:hidden"},lb=K({__name:"WorkflowTab",props:{class:{},workflowOption:{}},setup(e){const o=e,{t}=ce(),a=lt(),l=Me(),s=ne(),i=R(null),r=R(null),u=Di(),c=b(()=>s.get("Comfy.Workflow.AutoSave")),p=b(()=>s.get("Comfy.Workflow.AutoSaveDelay")),g=b(()=>a.shiftDown?!1:o.workflowOption.workflow.isPersisted?o.workflowOption.workflow.isModified?c.value==="off"||c.value==="after delay"&&p.value>3e3:!1:!0),d=b(()=>l.activeWorkflow?.key===o.workflowOption.workflow.key),w=b(()=>u.getThumbnail(o.workflowOption.workflow.key)),h=n(x=>{r.value?.showPopover(x)},"handleMouseEnter"),C=n(()=>{r.value?.hidePopover()},"handleMouseLeave"),f=n(x=>{r.value?.togglePopover(x)},"handleClick"),S=n(async x=>{for(const _ of x)if(!await tt().closeWorkflow(_.workflow,{warnIfUnsaved:!a.shiftDown,hint:t("sideToolbar.workflowTab.dirtyCloseHint")}))break},"closeWorkflows"),$=n(async x=>{await S([x])},"onCloseWorkflow"),k=n(()=>i.value,"tabGetter");return Ri(k,{getInitialData:n(()=>({workflowKey:o.workflowOption.workflow.key}),"getInitialData")}),Na(k,{getData:n(()=>({workflowKey:o.workflowOption.workflow.key}),"getData"),onDrop:n(x=>{const _=l.openWorkflows.findIndex(N=>N.key===x.source.data.workflowKey),M=l.openWorkflows.findIndex(N=>N.key===x.location.current.dropTargets[0]?.data.workflowKey);_!==M&&l.reorderWorkflows(_,M)},"onDrop")}),rt(()=>{r.value?.hidePopover()}),(x,_)=>(m(),T(le,null,[y("div",kt({ref_key:"workflowTabRef",ref:i,class:"workflow-tab group flex gap-2 p-2"},x.$attrs,{onMouseenter:h,onMouseleave:C,onClick:f}),[y("span",nb,z(x.workflowOption.workflow.filename),1),y("div",sb,[g.value?(m(),T("span",ab,"")):A("",!0),L(v(re),{class:"close-button invisible w-auto p-0",icon:"pi pi-times",text:"",severity:"secondary",size:"small",onClick:_[0]||(_[0]=Ne(M=>$(x.workflowOption),["stop"]))})])],16),L(ob,{ref_key:"popoverRef",ref:r,"workflow-filename":x.workflowOption.workflow.filename,"thumbnail-url":w.value,"is-active-tab":d.value},null,8,["workflow-filename","thumbnail-url","is-active-tab"])],64))}}),ib=K({__name:"WorkflowOverflowMenu",props:{workflows:{},activeWorkflow:{}},setup(e){const o=e,t=R(null),a=tt(),l=b(()=>o.workflows.map(s=>({label:s.filename,icon:o.activeWorkflow?.key===s.key?"pi pi-check":void 0,command:n(()=>{a.openWorkflow(s)},"command")})));return(s,i)=>{const r=_e("tooltip");return m(),T("div",null,[ue(L(v(re),{class:"rounded-none",icon:"pi pi-ellipsis-h",text:"",severity:"secondary","aria-label":s.$t("g.moreWorkflows"),onClick:i[0]||(i[0]=u=>t.value?.toggle(u))},null,8,["aria-label"]),[[r,{value:s.$t("g.moreWorkflows"),showDelay:300}]]),L(v(la),{ref_key:"menu",ref:t,model:l.value,popup:!0,class:"max-h-[40vh] overflow-auto"},null,8,["model"])])}}}),rb={key:3,class:"window-actions-spacer app-drag shrink-0"},ub=K({__name:"WorkflowTabs",props:{class:{}},setup(e){const o=e,{t}=ce(),a=lt(),l=Me(),s=Ai(),i=tt(),r=R(),u=R(),c=R(null),p=R(!1),g=R(!1),d=R(!1),w=ze(),h=n(F=>({value:F.path,workflow:F}),"workflowToOption"),C=b(()=>l.openWorkflows.map(h)),f=b(()=>l.activeWorkflow?h(l.activeWorkflow):null),S=n(async F=>{F&&f.value?.value!==F.value&&await i.openWorkflow(F.workflow)},"onWorkflowChange"),$=n(async F=>{for(const W of F)if(!await i.closeWorkflow(W.workflow,{warnIfUnsaved:!a.shiftDown}))break},"closeWorkflows"),k=n(async F=>{await $([F])},"onCloseWorkflow"),x=n((F,W)=>{r.value=W,u.value.show(F)},"showContextMenu"),_=b(()=>{const F=r.value;if(!F)return[];const W=C.value.findIndex(H=>H.workflow===F.workflow);return[{label:t("tabMenu.duplicateTab"),command:n(async()=>{await i.duplicateWorkflow(F.workflow)},"command")},{separator:!0},{label:t("tabMenu.closeTab"),command:n(()=>k(F),"command")},{label:t("tabMenu.closeTabsToLeft"),command:n(()=>$(C.value.slice(0,W)),"command"),disabled:W<=0},{label:t("tabMenu.closeTabsToRight"),command:n(()=>$(C.value.slice(W+1)),"command"),disabled:W===C.value.length-1},{label:t("tabMenu.closeOtherTabs"),command:n(()=>$([...C.value.slice(W+1),...C.value.slice(0,W)]),"command"),disabled:C.value.length<=1},{label:s.isBookmarked(F.workflow.path)?t("tabMenu.removeFromBookmarks"):t("tabMenu.addToBookmarks"),command:n(()=>s.toggleBookmarked(F.workflow.path),"command"),disabled:F.workflow.isTemporary}]}),M=ke(),N=n(F=>{const W=F.currentTarget,H=F.deltaX||F.deltaY;W.scroll({left:W.scrollLeft+H})},"handleWheel"),I=b(()=>c.value?.querySelector(".p-scrollpanel-content")??null),V=n(F=>{const W=I.value;W&&W.scrollBy({left:F*20})},"scroll"),P=n(async(F={})=>{if(!f.value)return;F.waitForDom!==!1&&await Le();const W=c.value;if(!W)return;const H=W.querySelector(".p-togglebutton-checked");H&&H.scrollIntoView({block:"nearest",inline:"nearest"})},"ensureActiveTabVisible");te(()=>l.activeWorkflow,()=>{P()},{immediate:!0});let G=null,D=null,B=null;return te(I,(F,W,H)=>{if(D?.(),B?.(),G?.dispose(),!F)return;const U=wl(F);D=te([()=>U.arrivedState.left,()=>U.arrivedState.right],([q,Q])=>{g.value=!q,d.value=!Q},{immediate:!0}),G=Wa(F),B=te(G.isOverflowing,q=>{p.value=q,q&&Le(()=>{U.measure(),P({waitForDom:!1})})},{immediate:!0}),H(()=>{D?.(),B?.(),G?.dispose()})},{immediate:!0}),Gs(()=>{G?.disposed.value||G?.checkOverflow()}),(F,W)=>{const H=_e("tooltip");return m(),T("div",{ref_key:"containerRef",ref:c,class:J(["workflow-tabs-container flex h-full max-w-full flex-auto flex-row overflow-hidden border-b border-[var(--interface-stroke)] shadow-interface",{"workflow-tabs-container-desktop":v(w)}])},[p.value?(m(),O(v(re),{key:0,icon:"pi pi-chevron-left",text:"",severity:"secondary",class:"overflow-arrow overflow-arrow-left",disabled:!g.value,onMousedown:W[0]||(W[0]=U=>v(_n)(U,()=>V(-1)))},null,8,["disabled"])):A("",!0),L(v(Gl),{class:"no-drag overflow-hidden","pt:content":{class:"p-0 w-full flex",onwheel:N},"pt:bar-x":"h-1"},{default:E(()=>[L(v(ia),{class:J(["workflow-tabs bg-transparent",o.class]),"model-value":f.value,options:C.value,"option-label":"label","data-key":"value","onUpdate:modelValue":S},{option:E(({option:U})=>[L(lb,{"workflow-option":U,onContextmenu:n(q=>x(q,U),"onContextmenu"),onMouseup:Ne(q=>k(U),["middle"])},null,8,["workflow-option","onContextmenu","onMouseup"])]),_:1},8,["class","model-value","options"])]),_:1},8,["pt:content"]),p.value?(m(),O(v(re),{key:1,icon:"pi pi-chevron-right",text:"",severity:"secondary",class:"overflow-arrow overflow-arrow-right",disabled:!d.value,onMousedown:W[1]||(W[1]=U=>v(_n)(U,()=>V(1)))},null,8,["disabled"])):A("",!0),p.value?(m(),O(ib,{key:2,workflows:v(l).openWorkflows,"active-workflow":v(l).activeWorkflow},null,8,["workflows","active-workflow"])):A("",!0),ue(L(v(re),{class:"new-blank-workflow-button no-drag shrink-0 rounded-none",icon:"pi pi-plus",text:"",severity:"secondary","aria-label":F.$t("sideToolbar.newBlankWorkflow"),onClick:W[2]||(W[2]=()=>v(M).execute("Comfy.NewBlankWorkflow"))},null,8,["aria-label"]),[[H,{value:F.$t("sideToolbar.newBlankWorkflow"),showDelay:300}]]),L(v(Hl),{ref_key:"menu",ref:u,model:_.value},null,8,["model"]),v(w)?(m(),T("div",rb)):A("",!0)],2)}}}),Qa=Se(ub,[["__scopeId","data-v-4cd2c75d"]]);function Ja(e,o){const t=ut();return function(a){try{let l=a.value;l===void 0&&a.type==="combo"&&a.options?.values&&Array.isArray(a.options.values)&&a.options.values.length>0&&(l=a.options.values[0]);const s=t.getInputSpecForWidget(e,a.name),i=o.get(a.name);return{name:a.name,type:a.type,value:l,label:a.label,options:a.options?{...a.options}:void 0,callback:a.callback,spec:s,slotMetadata:i,isDOMWidget:lo(a)}}catch{return{name:a.name||"unknown",type:a.type||"text",value:void 0}}}}n(Ja,"safeWidgetMapper");function cb(e){return e==null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="object"}n(cb,"isValidWidgetValue");function db(e){const{createNode:o,deleteNode:t,setSource:a}=bo(),l=Dn(new Map),s=new Map,i=n(k=>{const x=s.get(k),_=l.get(k);if(!x||!_)return;const M=new Map;x.inputs?.forEach((I,V)=>{I?.widget?.name&&M.set(I.widget.name,{index:V,linked:I.link!=null})});const N=_.widgets?.map(I=>{const V=M.get(I.name);return V?{...I,slotMetadata:V}:I});l.set(k,{..._,widgets:N,inputs:x.inputs?[...x.inputs]:void 0,outputs:x.outputs?[...x.outputs]:void 0})},"refreshNodeSlots");function r(k){const x=k.graph&&"id"in k.graph&&k.graph!==k.graph.rootGraph?String(k.graph.id):null,_=new Map,M=kl(k.widgets??[]);Object.defineProperty(k,"widgets",{get(){return M},set(G){M.splice(0,M.length,...G)}});const N=Cl(()=>(k.inputs?.forEach((G,D)=>{G?.widget?.name&&_.set(G.widget.name,{index:D,linked:G.link!=null})}),k.widgets?.map(Ja(k,_))??[])),I=k.type||k.constructor?.comfyClass||k.constructor?.title||k.constructor?.name||"Unknown",V=k.constructor?.nodeData?.api_node??!1,P=k.badges;return{id:String(k.id),title:typeof k.title=="string"?k.title:"",type:I,mode:k.mode||0,selected:k.selected||!1,executing:!1,subgraphId:x,apiNode:V,badges:P,hasErrors:!!k.has_errors,widgets:N,inputs:k.inputs?[...k.inputs]:void 0,outputs:k.outputs?[...k.outputs]:void 0,flags:k.flags?{...k.flags}:void 0,color:k.color||void 0,bgcolor:k.bgcolor||void 0}}n(r,"extractVueNodeData");const u=n(k=>s.get(k),"getNode"),c=n(k=>{if(!(k==null||k===void 0)){if(typeof k=="string"||typeof k=="number"||typeof k=="boolean")return k;if(typeof k=="object")return Array.isArray(k)&&k.length>0&&k.every(x=>x instanceof File),k;console.warn(`Invalid widget value type: ${typeof k}`,k)}},"validateWidgetValue"),p=n((k,x,_)=>{try{const M=l.get(k);if(!M?.widgets)return;const N=M.widgets.map(V=>V.name===x?{...V,value:c(_)}:V),I={...M,widgets:N};l.set(k,I)}catch{}},"updateVueWidgetState"),g=n((k,x,_)=>{let M=!1;return N=>{if(!M){M=!0;try{if(N!=null&&typeof N!="string"&&typeof N!="number"&&typeof N!="boolean"&&typeof N!="object"){console.warn(`Invalid widget value type: ${typeof N}`),M=!1;return}k.value=N,x&&x.call(k,N),p(_,k.name,N)}finally{M=!1}}}},"createWrappedWidgetCallback"),d=n(k=>{if(!k.widgets)return;const x=String(k.id);k.widgets.forEach(_=>{const M=_.callback;_.callback=g(_,M,x)})},"setupNodeWidgetCallbacks"),w=n(()=>{if(!e?._nodes)return;const k=new Set(e._nodes.map(x=>String(x.id)));for(const x of Array.from(l.keys()))k.has(x)||(s.delete(x),l.delete(x));e._nodes.forEach(x=>{const _=String(x.id);s.set(_,x),d(x),l.set(_,r(x))})},"syncWithGraph"),h=n((k,x)=>{const _=String(k.id);s.set(_,k),d(k),l.set(_,r(k));const M=n(()=>{const N={x:k.pos[0],y:k.pos[1]},I={width:k.size[0],height:k.size[1]};a(Jt.Canvas),o(_,{position:N,size:I,zIndex:k.order||0,visible:!0})},"initializeVueNodeLayout");window.app?.configuringGraph?k.onAfterGraphConfigured=po(k.onAfterGraphConfigured,()=>{l.set(_,r(k)),M()}):M(),x&&x(k)},"handleNodeAdded"),C=n((k,x)=>{const _=String(k.id);a(Jt.Canvas),t(_),s.delete(_),l.delete(_),x&&x(k)},"handleNodeRemoved"),f=n((k,x,_)=>()=>{e.onNodeAdded=k||void 0,e.onNodeRemoved=x||void 0,e.onTrigger=_||void 0,s.clear(),l.clear()},"createCleanupFunction"),$=n(()=>{const k=e.onNodeAdded,x=e.onNodeRemoved,_=e.onTrigger;e.onNodeAdded=N=>{h(N,k)},e.onNodeRemoved=N=>{C(N,x)};const M={"node:property:changed":n(N=>{const I=String(N.nodeId),V=l.get(I);if(V)switch(N.property){case"title":l.set(I,{...V,title:String(N.newValue)});break;case"flags.collapsed":l.set(I,{...V,flags:{...V.flags,collapsed:!!N.newValue}});break;case"flags.pinned":l.set(I,{...V,flags:{...V.flags,pinned:!!N.newValue}});break;case"mode":l.set(I,{...V,mode:typeof N.newValue=="number"?N.newValue:0});break;case"color":l.set(I,{...V,color:typeof N.newValue=="string"?N.newValue:void 0});break;case"bgcolor":l.set(I,{...V,bgcolor:typeof N.newValue=="string"?N.newValue:void 0})}},"node:property:changed"),"node:slot-errors:changed":n(N=>{i(String(N.nodeId))},"node:slot-errors:changed"),"node:slot-links:changed":n(N=>{N.slotType===Li.INPUT&&i(String(N.nodeId))},"node:slot-links:changed")};return e.onTrigger=N=>{switch(N.type){case"node:property:changed":M["node:property:changed"](N);break;case"node:slot-errors:changed":M["node:slot-errors:changed"](N);break;case"node:slot-links:changed":M["node:slot-links:changed"](N);break}_?.(N)},w(),f(k||void 0,x||void 0,_||void 0)},"setupEventListeners")();return e._nodes&&e._nodes.length>0&&e._nodes.forEach(k=>{e.onNodeAdded&&e.onNodeAdded(k)}),{vueNodeData:l,getNode:u,cleanup:$}}n(db,"useGraphNodeManager");const Ya=Et(()=>zo("comfy.vueNodesMigration.dismissed",!1));function pb(){const e=R();function o(a){a?.graph&&(t(),e.value=Ce.onChange(l=>{for(const s of l.nodeIds){const i=Ce.getNodeLayoutRef(s).value;if(!i)continue;const r=a.graph?.getNodeById(parseInt(s));if(!r)continue;(r.pos[0]!==i.position.x||r.pos[1]!==i.position.y)&&(r.pos[0]=i.position.x,r.pos[1]=i.position.y);const u=Ei(i.size.height);(r.size[0]!==i.size.width||r.size[1]!==u)&&r.setSize([i.size.width,u])}a.setDirty(!0,!0)}))}n(o,"startSync");function t(){e.value?.(),e.value=void 0}return n(t,"stopSync"),rt(t),{startSync:o,stopSync:t}}n(pb,"useLayoutSync");function fb(){const e=fe(),o=bo(),{shouldRenderVueNodes:t}=Go(),a=yt(null),{startSync:l}=pb(),s=Ya();let i=!1;const r=n(()=>{const g=j.canvas?.graph;if(!g||a.value)return;const d=db(g);a.value=d;const w=g._nodes.map(h=>({id:h.id.toString(),pos:[h.pos[0],h.pos[1]],size:[h.size[0],Vi(h.size[1])]}));Ce.initializeFromLiteGraph(w);for(const h of g.reroutes.values()){const[C,f]=h.pos,S=h.parentId??void 0,$=Array.from(h.linkIds);o.createReroute(h.id,{x:C,y:f},S,$)}for(const h of g._links.values())o.createLink(h.id,h.origin_id,h.origin_slot,h.target_id,h.target_slot);l(e.canvas)},"initializeNodeManager"),u=n(()=>{if(a.value){try{a.value.cleanup()}catch{}a.value=null}},"disposeNodeManagerAndSyncs");return te(()=>t.value&&!!j.canvas?.graph,(g,d)=>{g&&(r(),us(j.canvas?.graph?.extra.workflowRendererVersion),d===!1&&!s.value&&!i&&(i=!0,wt().add({group:"vue-nodes-migration",severity:"info",life:0})))},{immediate:!0}),Ko(()=>!t.value,()=>{us(j.canvas?.graph?.extra.workflowRendererVersion),u(),j.canvas?.setDirty(!0,!0)}),te(()=>t.value,(g,d)=>{g!==d&&Ce.clearAllSlotLayouts()},{immediate:!0,flush:"sync"}),{nodeManager:a,initializeNodeManager:r,disposeNodeManagerAndSyncs:u,setupEmptyGraphListener:n(()=>{const g=j.canvas?.graph;if(!t.value||a.value||g?._nodes.length!==0)return;const d=g.onNodeAdded;g.onNodeAdded=function(w){g.onNodeAdded=d,t.value&&!a.value&&r(),d&&d.call(this,w)}},"setupEmptyGraphListener"),cleanup:n(()=>{a.value&&(a.value.cleanup(),a.value=null)},"cleanup")}}n(fb,"useVueNodeLifecycleIndividual");const on=Et(fb);function mb(e){const[o,t]=e.pos,a=o+e.size[0],l=t+e.size[1];return[o,a,t,l]}n(mb,"getNodeBounds");function vb(e){if(!e)return;const o=e.ds,t=e.canvas.width,a=e.canvas.height,l=500*o.scale,[s,i]=o.offset,r=-l/o.scale-s,u=(t+l)/o.scale-s,c=-l/o.scale-i,p=(a+l)/o.scale-i;return[r,u,c,p]}n(vb,"viewportEdges");function gb(e,o){const[t,a,l,s]=e,[i,r,u,c]=o,p=a<i,g=t>r,d=s<u,w=l>c;return!(p||g||d||w)}n(gb,"boundsIntersect");function hb(){const e=fe(),{nodeManager:o}=on(),t=b(()=>vb(e.canvas));function a(i){if(!t.value||!i)return!0;const r=mb(i);return gb(r,t.value)}n(a,"inViewport");function l(){if(!o.value||!j.canvas)return;const i=document.querySelectorAll("[data-node-id]");for(const r of i){const u=r.getAttribute("data-node-id");if(!u)continue;const c=o.value.getNode(u);if(!c)continue;const p=a(c)?"":"none";r instanceof HTMLElement&&r.style.display!==p&&(r.style.display=p)}}return n(l,"updateVisibility"),{handleTransformUpdate:qs(()=>l,100,!0)}}n(hb,"useViewportCullingIndividual");const yb=Et(hb);function bb(e,o,t=""){try{return e(o)}catch{return t}}n(bb,"safePricingExecution");const vn=n(e=>{const o=e.widgets?.find(s=>s.name==="duration");if(!o)return"$0.05/second";const t=Number(o.value);return`$${(.05*(isNaN(t)?5:t)).toFixed(2)}/Run`},"calculateRunwayDurationPrice"),xo=n(e=>o=>{const t=o.widgets?.find(s=>s.name==="duration");if(!t)return`$${e.toFixed(3)}/second`;const a=parseFloat(String(t.value));return Number.isFinite(a)?`$${(e*a).toFixed(2)}/Run`:`$${e.toFixed(3)}/second`},"makeOmniProDurationCalculator"),gn=n(e=>{const o=e.widgets?.find(r=>r.name==="duration_seconds"),t=e.widgets?.find(r=>r.name==="quality"),a=e.widgets?.find(r=>r.name==="motion_mode");if(!o||!t)return"$0.45-1.2/Run (varies with duration, quality & motion mode)";const l=String(o.value),s=String(t.value),i=String(a?.value);if(l.includes("5")){if(s.includes("1080p")||s.includes("720p")&&i?.includes("fast"))return"$1.2/Run";if(s.includes("720p")&&i?.includes("normal"))return"$0.6/Run";if(s.includes("540p")&&i?.includes("fast"))return"$0.9/Run";if(s.includes("540p")&&i?.includes("normal"))return"$0.45/Run";if(s.includes("360p")&&i?.includes("fast"))return"$0.9/Run";if(s.includes("360p")&&i?.includes("normal"))return"$0.45/Run";if(s.includes("720p")&&i?.includes("fast"))return"$1.2/Run"}else if(l.includes("8")){if(s.includes("720p")&&i?.includes("normal"))return"$1.2/Run";if(s.includes("540p")&&i?.includes("normal"))return"$0.9/Run";if(s.includes("540p")&&i?.includes("fast"))return"$1.2/Run";if(s.includes("360p")&&i?.includes("normal"))return"$0.9/Run";if(s.includes("360p")&&i?.includes("fast")||s.includes("1080p")&&i?.includes("normal")||s.includes("1080p")&&i?.includes("fast")||s.includes("720p")&&i?.includes("normal")||s.includes("720p")&&i?.includes("fast"))return"$1.2/Run"}return"$0.9/Run"},"pixversePricingCalculator"),$o=n(e=>{const o=e.widgets?.find($=>$.name==="model"),t=e.widgets?.find($=>$.name==="duration"),a=e.widgets?.find($=>$.name==="resolution");if(!o||!t||!a)return"Token-based";const l=String(o.value).toLowerCase(),s=String(a.value).toLowerCase(),i=parseFloat(String(t.value)),r={"seedance-1-0-pro":{"480p":[.23,.24],"720p":[.51,.56],"1080p":[1.18,1.22]},"seedance-1-0-pro-fast":{"480p":[.09,.1],"720p":[.21,.23],"1080p":[.47,.49]},"seedance-1-0-lite":{"480p":[.17,.18],"720p":[.37,.41],"1080p":[.85,.88]}},u=l.includes("seedance-1-0-pro-fast")?"seedance-1-0-pro-fast":l.includes("seedance-1-0-pro")?"seedance-1-0-pro":l.includes("seedance-1-0-lite")?"seedance-1-0-lite":"",c=s.includes("1080")?"1080p":s.includes("720")?"720p":s.includes("480")?"480p":"",p=u&&c?r[u]?.[c]:void 0;if(!p)return"Token-based";const[g,d]=p,w=i/10,h=g*w,C=d*w,f=`$${h.toFixed(2)}/Run`,S=`$${C.toFixed(2)}/Run`;return f===S?f:`$${h.toFixed(2)}-$${C.toFixed(2)}/Run`},"byteDanceVideoPricingCalculator"),Ds=n(e=>{const o=e.widgets?.find(d=>d.name==="model"),t=e.widgets?.find(d=>d.name==="duration"),a=e.widgets?.find(d=>d.name==="resolution"),l="$0.04-0.24/second";if(!o||!t||!a)return l;const s=String(o.value).toLowerCase(),i=String(a.value).toLowerCase(),r=parseFloat(String(t.value)),c={"ltx-2 (pro)":{"1920x1080":.06,"2560x1440":.12,"3840x2160":.24},"ltx-2 (fast)":{"1920x1080":.04,"2560x1440":.08,"3840x2160":.16}}[s];if(!c)return l;const p=c[i];return p?`$${(p*r).toFixed(2)}/Run`:l},"ltxvPricingCalculator"),vo={BASIC:new Set(["720x1280","1280x720"]),PRO:new Set(["1024x1792","1792x1024"])},wb=new Set([...vo.BASIC,...vo.PRO]);function kb(e,o,t){const a=e?.toLowerCase()??"",l=t?.toLowerCase()??"";if(!o||Number.isNaN(o))return"Set duration (4s / 8s / 12s)";if(!l)return"Set size (720x1280, 1280x720, 1024x1792, 1792x1024)";if(!wb.has(l))return"Invalid size. Must be 720x1280, 1280x720, 1024x1792, or 1792x1024.";if(!a.includes("sora-2-pro")){if(a.includes("sora-2")&&!vo.BASIC.has(l))return"sora-2 supports only 720x1280 or 1280x720";if(!a.includes("sora-2"))return"Unsupported model"}}n(kb,"validateSora2Selection");function Cb(e,o){const t=e?.toLowerCase()??"",a=o?.toLowerCase()??"";return t.includes("sora-2-pro")?vo.PRO.has(a)?.5:.3:t.includes("sora-2")?.1:vo.PRO.has(a)?.5:.1}n(Cb,"perSecForSora2");function Sb(e,o){return`$${(e*o).toFixed(2)}/Run`}n(Sb,"formatRunPrice");const xb=n(e=>{const o=n(r=>String(e.widgets?.find(u=>u.name===r)?.value??""),"getWidgetValue"),t=o("model"),a=o("size"),l=Number(e.widgets?.find(r=>["duration","duration_s"].includes(r.name))?.value);if(!t||!a||!l)return"Set model, duration & size";const s=kb(t,l,a);if(s)return s;const i=Cb(t,a);return Sb(i,l)},"sora2PricingCalculator"),As={FluxProCannyNode:{displayPrice:"$0.05/Run"},FluxProDepthNode:{displayPrice:"$0.05/Run"},FluxProExpandNode:{displayPrice:"$0.05/Run"},FluxProFillNode:{displayPrice:"$0.05/Run"},FluxProUltraImageNode:{displayPrice:"$0.06/Run"},FluxProKontextProNode:{displayPrice:"$0.04/Run"},FluxProKontextMaxNode:{displayPrice:"$0.08/Run"},Flux2ProImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(p=>p.name==="width"),t=e.widgets?.find(p=>p.name==="height"),a=Number(o?.value),l=Number(t?.value);if(!Number.isFinite(a)||!Number.isFinite(l)||a<=0||l<=0)return"$0.03$0.15/Run";const s=e.inputs?.find(p=>p.name==="images"),i=typeof s?.link<"u"&&s.link!=null,r=1024*1024,u=Math.max(1,Math.floor((a*l+r-1)/r)),c=.03+.015*Math.max(u-1,0);if(i){const p=c+.015,g=c+.12;return`~$${parseFloat(p.toFixed(3))}$${parseFloat(g.toFixed(3))}/Run`}return`$${parseFloat(c.toFixed(3))}/Run`},"displayPrice")},OpenAIVideoSora2:{displayPrice:xb},IdeogramV1:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="num_images"),t=e.widgets?.find(r=>r.name==="turbo");if(!o)return"$0.02-0.06 x num_images/Run";const a=Number(o.value)||1;return`$${((String(t?.value).toLowerCase()==="true"?.02:.06)*a).toFixed(2)}/Run`},"displayPrice")},IdeogramV2:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="num_images"),t=e.widgets?.find(r=>r.name==="turbo");if(!o)return"$0.05-0.08 x num_images/Run";const a=Number(o.value)||1;return`$${((String(t?.value).toLowerCase()==="true"?.05:.08)*a).toFixed(2)}/Run`},"displayPrice")},IdeogramV3:{displayPrice:n(e=>{const o=e.widgets?.find(c=>c.name==="rendering_speed"),t=e.widgets?.find(c=>c.name==="num_images"),a=e.inputs?.find(c=>c.name==="character_image"),l=typeof a?.link<"u"&&a.link!=null;if(!o)return"$0.03-0.08 x num_images/Run (varies with rendering speed & num_images)";const s=Number(t?.value)||1;let i=.06;const r=String(o.value);return r.toLowerCase().includes("quality")?l?i=.2:i=.09:r.toLowerCase().includes("default")?l?i=.15:i=.06:r.toLowerCase().includes("turbo")&&(l?i=.1:i=.03),`$${(i*s).toFixed(2)}/Run`},"displayPrice")},KlingCameraControlI2VNode:{displayPrice:"$0.49/Run"},KlingCameraControlT2VNode:{displayPrice:"$0.14/Run"},KlingDualCharacterVideoEffectNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="mode"),t=e.widgets?.find(r=>r.name==="model_name"),a=e.widgets?.find(r=>r.name==="duration");if(!o||!t||!a)return"$0.14-2.80/Run (varies with model, mode & duration)";const l=String(o.value),s=String(a.value),i=String(t.value);return i.includes("v1-6")||i.includes("v1-5")?l.includes("pro")?s.includes("10")?"$0.98/Run":"$0.49/Run":s.includes("10")?"$0.56/Run":"$0.28/Run":i.includes("v1")?l.includes("pro")?s.includes("10")?"$0.98/Run":"$0.49/Run":s.includes("10")?"$0.28/Run":"$0.14/Run":"$0.14/Run"},"displayPrice")},KlingImage2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="mode"),t=e.widgets?.find(r=>r.name==="model_name"),a=e.widgets?.find(r=>r.name==="duration");if(!o){if(!t)return"$0.14-2.80/Run (varies with model, mode & duration)";const r=String(t.value);return r.includes("v2-1-master")||r.includes("v2-master")?"$1.40/Run":r.includes("v1-6")||r.includes("v1-5")?"$0.28/Run":"$0.14/Run"}const l=String(o.value),s=String(a.value),i=String(t.value);return i.includes("v2-5-turbo")?s.includes("10")?"$0.70/Run":"$0.35/Run":i.includes("v2-1-master")||i.includes("v2-master")?s.includes("10")?"$2.80/Run":"$1.40/Run":i.includes("v2-1")||i.includes("v1-6")||i.includes("v1-5")?l.includes("pro")?s.includes("10")?"$0.98/Run":"$0.49/Run":s.includes("10")?"$0.56/Run":"$0.28/Run":i.includes("v1")?l.includes("pro")?s.includes("10")?"$0.98/Run":"$0.49/Run":s.includes("10")?"$0.28/Run":"$0.14/Run":"$0.14/Run"},"displayPrice")},KlingImageGenerationNode:{displayPrice:n(e=>{const t=e.inputs?.find(c=>c.name==="image")?.link?"image to image":"text to image",a=e.widgets?.find(c=>c.name==="model_name"),l=e.widgets?.find(c=>c.name==="n");if(!a)return"$0.0035-0.028 x n/Run (varies with modality & model)";const s=String(a.value),i=Number(l?.value)||1;let r=.014;return t.includes("text to image")?s.includes("kling-v1-5")||s.includes("kling-v2")?r=.014:s.includes("kling-v1")&&(r=.0035):t.includes("image to image")&&(s.includes("kling-v1-5")?r=.028:s.includes("kling-v1")&&(r=.0035)),`$${(r*i).toFixed(4)}/Run`},"displayPrice")},KlingLipSyncAudioToVideoNode:{displayPrice:"~$0.10/Run"},KlingLipSyncTextToVideoNode:{displayPrice:"~$0.10/Run"},KlingSingleImageVideoEffectNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="effect_scene");if(!o)return"$0.28-0.49/Run (varies with effect scene)";const t=String(o.value);return t.includes("fuzzyfuzzy")||t.includes("squish")?"$0.28/Run":t.includes("dizzydizzy")||t.includes("bloombloom")?"$0.49/Run":(t.includes("expansion"),"$0.28/Run")},"displayPrice")},KlingStartEndFrameNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="mode");if(!o)return"$0.14-2.80/Run (varies with model, mode & duration)";const t=String(o.value);return t.includes("v2-5-turbo")?t.includes("10")?"$0.70/Run":"$0.35/Run":t.includes("v2-1")?t.includes("10s")?"$0.98/Run":"$0.49/Run":t.includes("v2-master")?t.includes("10s")?"$2.80/Run":"$1.40/Run":t.includes("v1-6")?t.includes("pro")?t.includes("10s")?"$0.98/Run":"$0.49/Run":t.includes("10s")?"$0.56/Run":"$0.28/Run":t.includes("v1")?t.includes("pro")?t.includes("10s")?"$0.98/Run":"$0.49/Run":t.includes("10s")?"$0.28/Run":"$0.14/Run":"$0.14/Run"},"displayPrice")},KlingTextToVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="mode");if(!o)return"$0.14-2.80/Run (varies with model, mode & duration)";const t=String(o.value);return t.includes("v2-5-turbo")?t.includes("10")?"$0.70/Run":"$0.35/Run":t.includes("v2-1-master")||t.includes("v2-master")?t.includes("10s")?"$2.80/Run":"$1.40/Run":t.includes("v1-6")?t.includes("pro")?t.includes("10s")?"$0.98/Run":"$0.49/Run":t.includes("10s")?"$0.56/Run":"$0.28/Run":t.includes("v1")?t.includes("pro")?t.includes("10s")?"$0.98/Run":"$0.49/Run":t.includes("10s")?"$0.28/Run":"$0.14/Run":"$0.14/Run"},"displayPrice")},KlingVideoExtendNode:{displayPrice:"$0.28/Run"},KlingVirtualTryOnNode:{displayPrice:"$0.07/Run"},KlingOmniProTextToVideoNode:{displayPrice:xo(.112)},KlingOmniProFirstLastFrameNode:{displayPrice:xo(.112)},KlingOmniProImageToVideoNode:{displayPrice:xo(.112)},KlingOmniProVideoToVideoNode:{displayPrice:xo(.168)},KlingOmniProEditVideoNode:{displayPrice:"$0.168/second"},LumaImageToVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="model"),t=e.widgets?.find(r=>r.name==="resolution"),a=e.widgets?.find(r=>r.name==="duration");if(!o||!t||!a)return"$0.14-11.47/Run (varies with model, resolution & duration)";const l=String(o.value),s=String(t.value).toLowerCase(),i=String(a.value);if(l.includes("ray-flash-2")){if(i.includes("5s")){if(s.includes("4k"))return"$2.19/Run";if(s.includes("1080p"))return"$0.55/Run";if(s.includes("720p"))return"$0.24/Run";if(s.includes("540p"))return"$0.14/Run"}else if(i.includes("9s")){if(s.includes("4k"))return"$3.95/Run";if(s.includes("1080p"))return"$0.99/Run";if(s.includes("720p"))return"$0.43/Run";if(s.includes("540p"))return"$0.252/Run"}}else if(l.includes("ray-2")){if(i.includes("5s")){if(s.includes("4k"))return"$6.37/Run";if(s.includes("1080p"))return"$1.59/Run";if(s.includes("720p"))return"$0.71/Run";if(s.includes("540p"))return"$0.40/Run"}else if(i.includes("9s")){if(s.includes("4k"))return"$11.47/Run";if(s.includes("1080p"))return"$2.87/Run";if(s.includes("720p"))return"$1.28/Run";if(s.includes("540p"))return"$0.72/Run"}}else if(l.includes("ray-1.6"))return"$0.35/Run";return"$0.55/Run"},"displayPrice")},LumaVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="model"),t=e.widgets?.find(r=>r.name==="resolution"),a=e.widgets?.find(r=>r.name==="duration");if(!o||!t||!a)return"$0.14-11.47/Run (varies with model, resolution & duration)";const l=String(o.value),s=String(t.value).toLowerCase(),i=String(a.value);if(l.includes("ray-flash-2")){if(i.includes("5s")){if(s.includes("4k"))return"$2.19/Run";if(s.includes("1080p"))return"$0.55/Run";if(s.includes("720p"))return"$0.24/Run";if(s.includes("540p"))return"$0.14/Run"}else if(i.includes("9s")){if(s.includes("4k"))return"$3.95/Run";if(s.includes("1080p"))return"$0.99/Run";if(s.includes("720p"))return"$0.43/Run";if(s.includes("540p"))return"$0.252/Run"}}else if(l.includes("ray-2")){if(i.includes("5s")){if(s.includes("4k"))return"$6.37/Run";if(s.includes("1080p"))return"$1.59/Run";if(s.includes("720p"))return"$0.71/Run";if(s.includes("540p"))return"$0.40/Run"}else if(i.includes("9s")){if(s.includes("4k"))return"$11.47/Run";if(s.includes("1080p"))return"$2.87/Run";if(s.includes("720p"))return"$1.28/Run";if(s.includes("540p"))return"$0.72/Run"}}else if(l.includes("ray-1-6"))return"$0.35/Run";return"$0.55/Run"},"displayPrice")},MinimaxImageToVideoNode:{displayPrice:"$0.43/Run"},MinimaxTextToVideoNode:{displayPrice:"$0.43/Run"},MinimaxHailuoVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="resolution"),t=e.widgets?.find(s=>s.name==="duration");if(!o||!t)return"$0.28-0.56/Run (varies with resolution & duration)";const a=String(o.value),l=String(t.value);if(a.includes("768P")){if(l.includes("6"))return"$0.28/Run";if(l.includes("10"))return"$0.56/Run"}else if(a.includes("1080P")&&l.includes("6"))return"$0.49/Run";return"$0.43/Run"},"displayPrice")},OpenAIDalle2:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="size"),t=e.widgets?.find(r=>r.name==="n");if(!o)return"$0.016-0.02 x n/Run (varies with size & n)";const a=String(o.value),l=Number(t?.value)||1;let s=.02;return a.includes("1024x1024")?s=.02:a.includes("512x512")?s=.018:a.includes("256x256")&&(s=.016),`$${(s*l).toFixed(3)}/Run`},"displayPrice")},OpenAIDalle3:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="size"),t=e.widgets?.find(s=>s.name==="quality");if(!o||!t)return"$0.04-0.12/Run (varies with size & quality)";const a=String(o.value),l=String(t.value);return a.includes("1024x1024")?l.includes("hd")?"$0.08/Run":"$0.04/Run":a.includes("1792x1024")||a.includes("1024x1792")?l.includes("hd")?"$0.12/Run":"$0.08/Run":"$0.04/Run"},"displayPrice")},OpenAIGPTImage1:{displayPrice:n(e=>{const o=e.widgets?.find(i=>i.name==="quality"),t=e.widgets?.find(i=>i.name==="n");if(!o)return"$0.011-0.30 x n/Run (varies with quality & n)";const a=String(o.value),l=Number(t?.value)||1;let s="$0.046-0.07";return a.includes("high")?s="$0.167-0.30":a.includes("medium")?s="$0.046-0.07":a.includes("low")&&(s="$0.011-0.02"),l===1?`${s}/Run`:`${s} x ${l}/Run`},"displayPrice")},PikaImageToVideoNode2_2:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="duration"),t=e.widgets?.find(s=>s.name==="resolution");if(!o||!t)return"$0.2-1.0/Run (varies with duration & resolution)";const a=String(o.value),l=String(t.value);if(a.includes("5")){if(l.includes("1080p"))return"$0.45/Run";if(l.includes("720p"))return"$0.2/Run"}else if(a.includes("10")){if(l.includes("1080p"))return"$1.0/Run";if(l.includes("720p"))return"$0.6/Run"}return"$0.2/Run"},"displayPrice")},PikaScenesV2_2:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="duration"),t=e.widgets?.find(s=>s.name==="resolution");if(!o||!t)return"$0.2-1.0/Run (varies with duration & resolution)";const a=String(o.value),l=String(t.value);if(a.includes("5")){if(l.includes("720p"))return"$0.3/Run";if(l.includes("1080p"))return"$0.5/Run"}else if(a.includes("10")){if(l.includes("720p"))return"$0.4/Run";if(l.includes("1080p"))return"$1.5/Run"}return"$0.3/Run"},"displayPrice")},PikaStartEndFrameNode2_2:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="duration"),t=e.widgets?.find(s=>s.name==="resolution");if(!o||!t)return"$0.2-1.0/Run (varies with duration & resolution)";const a=String(o.value),l=String(t.value);if(a.includes("5")){if(l.includes("720p"))return"$0.2/Run";if(l.includes("1080p"))return"$0.3/Run"}else if(a.includes("10")){if(l.includes("720p"))return"$0.25/Run";if(l.includes("1080p"))return"$1.0/Run"}return"$0.2/Run"},"displayPrice")},PikaTextToVideoNode2_2:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="duration"),t=e.widgets?.find(s=>s.name==="resolution");if(!o||!t)return"$0.2-1.5/Run (varies with duration & resolution)";const a=String(o.value),l=String(t.value);if(a.includes("5")){if(l.includes("1080p"))return"$0.45/Run";if(l.includes("720p"))return"$0.2/Run"}else if(a.includes("10")){if(l.includes("1080p"))return"$1.0/Run";if(l.includes("720p"))return"$0.6/Run"}return"$0.45/Run"},"displayPrice")},Pikadditions:{displayPrice:"$0.3/Run"},Pikaffects:{displayPrice:"$0.45/Run"},Pikaswaps:{displayPrice:"$0.3/Run"},PixverseImageToVideoNode:{displayPrice:gn},PixverseTextToVideoNode:{displayPrice:gn},PixverseTransitionVideoNode:{displayPrice:gn},RecraftCreativeUpscaleNode:{displayPrice:"$0.25/Run"},RecraftCrispUpscaleNode:{displayPrice:"$0.004/Run"},RecraftGenerateColorFromImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");return o?`$${(.04*(Number(o.value)||1)).toFixed(2)}/Run`:"$0.04 x n/Run"},"displayPrice")},RecraftGenerateImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");return o?`$${(.04*(Number(o.value)||1)).toFixed(2)}/Run`:"$0.04 x n/Run"},"displayPrice")},RecraftGenerateVectorImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");return o?`$${(.08*(Number(o.value)||1)).toFixed(2)}/Run`:"$0.08 x n/Run"},"displayPrice")},RecraftImageInpaintingNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");return o?`$${(.04*(Number(o.value)||1)).toFixed(2)}/Run`:"$0.04 x n/Run"},"displayPrice")},RecraftImageToImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");return o?`$${(.04*(Number(o.value)||1)).toFixed(2)}/Run`:"$0.04 x n/Run"},"displayPrice")},RecraftRemoveBackgroundNode:{displayPrice:"$0.01/Run"},RecraftReplaceBackgroundNode:{displayPrice:"$0.04/Run"},RecraftTextToImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");return o?`$${(.04*(Number(o.value)||1)).toFixed(2)}/Run`:"$0.04 x n/Run"},"displayPrice")},RecraftTextToVectorNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");return o?`$${(.08*(Number(o.value)||1)).toFixed(2)}/Run`:"$0.08 x n/Run"},"displayPrice")},RecraftVectorizeImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="n");return o?`$${(.01*(Number(o.value)||1)).toFixed(2)}/Run`:"$0.01 x n/Run"},"displayPrice")},StabilityStableImageSD_3_5Node:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="model");if(!o)return"$0.035-0.065/Run (varies with model)";const t=String(o.value).toLowerCase();return t.includes("large")?"$0.065/Run":(t.includes("medium"),"$0.035/Run")},"displayPrice")},StabilityStableImageUltraNode:{displayPrice:"$0.08/Run"},StabilityUpscaleConservativeNode:{displayPrice:"$0.25/Run"},StabilityUpscaleCreativeNode:{displayPrice:"$0.25/Run"},StabilityUpscaleFastNode:{displayPrice:"$0.01/Run"},StabilityTextToAudio:{displayPrice:"$0.20/Run"},StabilityAudioToAudio:{displayPrice:"$0.20/Run"},StabilityAudioInpaint:{displayPrice:"$0.20/Run"},VeoVideoGenerationNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="duration_seconds");return o?`$${(.5*Number(o.value)).toFixed(2)}/Run`:"$2.50-5.0/Run (varies with duration)"},"displayPrice")},Veo3VideoGenerationNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model"),t=e.widgets?.find(s=>s.name==="generate_audio");if(!o||!t)return"$0.80-3.20/Run (varies with model & audio generation)";const a=String(o.value),l=String(t.value).toLowerCase()==="true";return a.includes("veo-3.0-fast-generate-001")||a.includes("veo-3.1-fast-generate")?l?"$1.20/Run":"$0.80/Run":a.includes("veo-3.0-generate-001")||a.includes("veo-3.1-generate")?l?"$3.20/Run":"$1.60/Run":"$0.80-3.20/Run"},"displayPrice")},Veo3FirstLastFrameNode:{displayPrice:n(e=>{const o=e.widgets?.find(c=>c.name==="model"),t=e.widgets?.find(c=>c.name==="generate_audio"),a=e.widgets?.find(c=>c.name==="duration");if(!o||!t||!a)return"$0.40-3.20/Run (varies with model & audio generation)";const l=String(o.value),s=String(t.value).toLowerCase()==="true",i=parseFloat(String(a.value));let r=null;return l.includes("veo-3.1-fast-generate")?r=s?.15:.1:l.includes("veo-3.1-generate")&&(r=s?.4:.2),r===null?"$0.40-3.20/Run":`$${(r*i).toFixed(2)}/Run`},"displayPrice")},LumaImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="model"),t=e.widgets?.find(l=>l.name==="aspect_ratio");if(!o||!t)return"$0.0045-0.0182/Run (varies with model & aspect ratio)";const a=String(o.value);return a.includes("photon-flash-1")?"$0.0019/Run":a.includes("photon-1")?"$0.0073/Run":"$0.0172/Run"},"displayPrice")},LumaImageModifyNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="model");if(!o)return"$0.0019-0.0073/Run (varies with model)";const t=String(o.value);return t.includes("photon-flash-1")?"$0.0019/Run":t.includes("photon-1")?"$0.0073/Run":"$0.0172/Run"},"displayPrice")},MoonvalleyTxt2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="length");if(!o)return"$1.50/Run";const t=String(o.value);return t==="5s"?"$1.50/Run":t==="10s"?"$3.00/Run":"$1.50/Run"},"displayPrice")},MoonvalleyImg2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="length");if(!o)return"$1.50/Run";const t=String(o.value);return t==="5s"?"$1.50/Run":t==="10s"?"$3.00/Run":"$1.50/Run"},"displayPrice")},MoonvalleyVideo2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="length");if(!o)return"$2.25/Run";const t=String(o.value);return t==="5s"?"$2.25/Run":t==="10s"?"$4.00/Run":"$2.25/Run"},"displayPrice")},RunwayTextToImageNode:{displayPrice:"$0.08/Run"},RunwayImageToVideoNodeGen3a:{displayPrice:vn},RunwayImageToVideoNodeGen4:{displayPrice:vn},RunwayFirstLastFrameNode:{displayPrice:vn},Rodin3D_Regular:{displayPrice:"$0.4/Run"},Rodin3D_Detail:{displayPrice:"$0.4/Run"},Rodin3D_Smooth:{displayPrice:"$0.4/Run"},Rodin3D_Sketch:{displayPrice:"$0.4/Run"},TripoTextToModelNode:{displayPrice:n(e=>{const o=e.widgets?.find(c=>c.name==="quad"),t=e.widgets?.find(c=>c.name==="style"),a=e.widgets?.find(c=>c.name==="texture"),l=e.widgets?.find(c=>c.name==="texture_quality");if(!o||!t||!a)return"$0.1-0.4/Run (varies with quad, style, texture & quality)";const s=String(o.value).toLowerCase()==="true",i=String(t.value).toLowerCase(),r=String(a.value).toLowerCase()==="true",u=String(l?.value||"standard").toLowerCase();return i.includes("none")?s?u.includes("detailed")?r?"$0.35/Run":"$0.30/Run":r?"$0.25/Run":"$0.20/Run":r?"$0.15/Run":"$0.10/Run":s?u.includes("detailed")?r?"$0.40/Run":"$0.35/Run":r?"$0.30/Run":"$0.25/Run":r?"$0.20/Run":"$0.15/Run"},"displayPrice")},TripoImageToModelNode:{displayPrice:n(e=>{const o=e.widgets?.find(c=>c.name==="quad"),t=e.widgets?.find(c=>c.name==="style"),a=e.widgets?.find(c=>c.name==="texture"),l=e.widgets?.find(c=>c.name==="texture_quality");if(!o||!t||!a)return"$0.2-0.5/Run (varies with quad, style, texture & quality)";const s=String(o.value).toLowerCase()==="true",i=String(t.value).toLowerCase(),r=String(a.value).toLowerCase()==="true",u=String(l?.value||"standard").toLowerCase();return i.includes("none")?s?u.includes("detailed")?r?"$0.45/Run":"$0.40/Run":r?"$0.35/Run":"$0.30/Run":r?"$0.25/Run":"$0.20/Run":s?u.includes("detailed")?r?"$0.50/Run":"$0.45/Run":r?"$0.40/Run":"$0.35/Run":r?"$0.30/Run":"$0.25/Run"},"displayPrice")},TripoRefineNode:{displayPrice:"$0.3/Run"},TripoTextureNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="texture_quality");return o?String(o.value).includes("detailed")?"$0.2/Run":"$0.1/Run":"$0.1-0.2/Run (varies with quality)"},"displayPrice")},TripoConvertModelNode:{displayPrice:"$0.10/Run"},TripoRetargetRiggedModelNode:{displayPrice:"$0.10/Run"},TripoMultiviewToModelNode:{displayPrice:n(e=>{const o=e.widgets?.find(c=>c.name==="quad"),t=e.widgets?.find(c=>c.name==="style"),a=e.widgets?.find(c=>c.name==="texture"),l=e.widgets?.find(c=>c.name==="texture_quality");if(!o||!t||!a)return"$0.2-0.5/Run (varies with quad, style, texture & quality)";const s=String(o.value).toLowerCase()==="true",i=String(t.value).toLowerCase(),r=String(a.value).toLowerCase()==="true",u=String(l?.value||"standard").toLowerCase();return i.includes("none")?s?u.includes("detailed")?r?"$0.45/Run":"$0.40/Run":r?"$0.35/Run":"$0.30/Run":r?"$0.25/Run":"$0.20/Run":s?u.includes("detailed")?r?"$0.50/Run":"$0.45/Run":r?"$0.40/Run":"$0.35/Run":r?"$0.30/Run":"$0.25/Run"},"displayPrice")},GeminiNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="model");if(!o)return"Token-based";const t=String(o.value);return t.includes("veo-2.0")?"$0.5/second":t.includes("gemini-2.5-flash-preview-04-17")||t.includes("gemini-2.5-flash")?"$0.0003/$0.0025 per 1K tokens":t.includes("gemini-2.5-pro-preview-05-06")||t.includes("gemini-2.5-pro")?"$0.00125/$0.01 per 1K tokens":t.includes("gemini-3-pro-preview")?"$0.002/$0.012 per 1K tokens":"Token-based"},"displayPrice")},GeminiImageNode:{displayPrice:"~$0.039/Image (1K)"},GeminiImage2Node:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="resolution");if(!o)return"Token-based";const t=String(o.value);return t.includes("1K")||t.includes("2K")?"~$0.134/Image":t.includes("4K")?"~$0.24/Image":"Token-based"},"displayPrice")},OpenAIChatNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="model");if(!o)return"Token-based";const t=String(o.value);return t.includes("o4-mini")?"$0.0011/$0.0044 per 1K tokens":t.includes("o1-pro")?"$0.15/$0.60 per 1K tokens":t.includes("o1")?"$0.015/$0.06 per 1K tokens":t.includes("o3-mini")?"$0.0011/$0.0044 per 1K tokens":t.includes("o3")?"$0.01/$0.04 per 1K tokens":t.includes("gpt-4o")?"$0.0025/$0.01 per 1K tokens":t.includes("gpt-4.1-nano")?"$0.0001/$0.0004 per 1K tokens":t.includes("gpt-4.1-mini")?"$0.0004/$0.0016 per 1K tokens":t.includes("gpt-4.1")?"$0.002/$0.008 per 1K tokens":t.includes("gpt-5-nano")?"$0.00005/$0.0004 per 1K tokens":t.includes("gpt-5-mini")?"$0.00025/$0.002 per 1K tokens":t.includes("gpt-5")?"$0.00125/$0.01 per 1K tokens":"Token-based"},"displayPrice")},ViduTextToVideoNode:{displayPrice:"$0.4/Run"},ViduImageToVideoNode:{displayPrice:"$0.4/Run"},ViduReferenceVideoNode:{displayPrice:"$0.4/Run"},ViduStartEndToVideoNode:{displayPrice:"$0.4/Run"},ByteDanceImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="model");return o&&String(o.value).includes("seedream-3-0-t2i")?"$0.03/Run":"Token-based"},"displayPrice")},ByteDanceImageEditNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="model");return o&&String(o.value).includes("seededit-3-0-i2i")?"$0.03/Run":"Token-based"},"displayPrice")},ByteDanceSeedreamNode:{displayPrice:n(e=>{const o=e.widgets?.find(p=>p.name==="model"),t=e.widgets?.find(p=>p.name==="sequential_image_generation"),a=e.widgets?.find(p=>p.name==="max_images"),l=String(o?.value??"").toLowerCase();let s=.03;if(l.includes("seedream-4-5-251128")?s=.04:l.includes("seedream-4-0-250828")&&(s=.03),!t||!a)return`$${s}/Run ($${s} for one output image)`;if(String(t.value).toLowerCase()==="disabled")return`$${s}/Run`;const r=Number(a.value),u=Number.isFinite(r)&&r>0?r:1;return u===1?`$${s}/Run`:`$${(s*u).toFixed(2)}/Run ($${s} for one output image)`},"displayPrice")},ByteDanceTextToVideoNode:{displayPrice:$o},ByteDanceImageToVideoNode:{displayPrice:$o},ByteDanceFirstLastFrameNode:{displayPrice:$o},ByteDanceImageReferenceNode:{displayPrice:$o},WanTextToVideoApi:{displayPrice:n(e=>{const o=e.widgets?.find(c=>c.name==="duration"),t=e.widgets?.find(c=>c.name==="size");if(!o||!t)return"$0.05-0.15/second";const a=parseFloat(String(o.value)),l=String(t.value).toLowerCase(),s=l.includes("1080")?"1080p":l.includes("720")?"720p":l.includes("480")?"480p":l.match(/^\s*(\d{3,4}p)/)?.[1]??"",r={"480p":.05,"720p":.1,"1080p":.15}[s];return isNaN(a)||!r?"$0.05-0.15/second":`$${(r*a).toFixed(2)}/Run`},"displayPrice")},WanImageToVideoApi:{displayPrice:n(e=>{const o=e.widgets?.find(u=>u.name==="duration"),t=e.widgets?.find(u=>u.name==="resolution");if(!o||!t)return"$0.05-0.15/second";const a=parseFloat(String(o.value)),l=String(t.value).trim().toLowerCase(),i={"480p":.05,"720p":.1,"1080p":.15}[l];return isNaN(a)||!i?"$0.05-0.15/second":`$${(i*a).toFixed(2)}/Run`},"displayPrice")},WanTextToImageApi:{displayPrice:"$0.03/Run"},WanImageToImageApi:{displayPrice:"$0.03/Run"},LtxvApiTextToVideo:{displayPrice:Ds},LtxvApiImageToVideo:{displayPrice:Ds}},$b=n(()=>({getNodeDisplayPrice:n(a=>{if(!a.constructor?.nodeData?.api_node)return"";const l=a.constructor.nodeData.name,s=As[l];return s?typeof s.displayPrice=="function"?bb(s.displayPrice,a,""):s.displayPrice:""},"getNodeDisplayPrice"),getNodePricingConfig:n(a=>As[a.constructor.nodeData?.name??""],"getNodePricingConfig"),getRelevantWidgetNames:n(a=>({KlingTextToVideoNode:["mode","model_name","duration"],KlingImage2VideoNode:["mode","model_name","duration"],KlingImageGenerationNode:["modality","model_name","n"],KlingDualCharacterVideoEffectNode:["mode","model_name","duration"],KlingSingleImageVideoEffectNode:["effect_scene"],KlingStartEndFrameNode:["mode","model_name","duration"],KlingOmniProTextToVideoNode:["duration"],KlingOmniProFirstLastFrameNode:["duration"],KlingOmniProImageToVideoNode:["duration"],KlingOmniProVideoToVideoNode:["duration"],MinimaxHailuoVideoNode:["resolution","duration"],OpenAIDalle3:["size","quality"],OpenAIDalle2:["size","n"],OpenAIVideoSora2:["model","size","duration"],OpenAIGPTImage1:["quality","n"],IdeogramV1:["num_images","turbo"],IdeogramV2:["num_images","turbo"],IdeogramV3:["rendering_speed","num_images","character_image"],FluxProKontextProNode:[],FluxProKontextMaxNode:[],Flux2ProImageNode:["width","height","images"],VeoVideoGenerationNode:["duration_seconds"],Veo3VideoGenerationNode:["model","generate_audio"],Veo3FirstLastFrameNode:["model","generate_audio","duration"],LumaVideoNode:["model","resolution","duration"],LumaImageToVideoNode:["model","resolution","duration"],LumaImageNode:["model","aspect_ratio"],LumaImageModifyNode:["model","aspect_ratio"],PikaTextToVideoNode2_2:["duration","resolution"],PikaImageToVideoNode2_2:["duration","resolution"],PikaScenesV2_2:["duration","resolution"],PikaStartEndFrameNode2_2:["duration","resolution"],PixverseTextToVideoNode:["duration_seconds","quality","motion_mode"],PixverseTransitionVideoNode:["duration_seconds","motion_mode","quality"],PixverseImageToVideoNode:["duration_seconds","quality","motion_mode"],StabilityStableImageSD_3_5Node:["model"],RecraftTextToImageNode:["n"],RecraftImageToImageNode:["n"],RecraftImageInpaintingNode:["n"],RecraftTextToVectorNode:["n"],RecraftVectorizeImageNode:["n"],RecraftGenerateColorFromImageNode:["n"],RecraftGenerateImageNode:["n"],RecraftGenerateVectorImageNode:["n"],MoonvalleyTxt2VideoNode:["length"],MoonvalleyImg2VideoNode:["length"],MoonvalleyVideo2VideoNode:["length"],RunwayImageToVideoNodeGen3a:["duration"],RunwayImageToVideoNodeGen4:["duration"],RunwayFirstLastFrameNode:["duration"],TripoTextToModelNode:["quad","style","texture","texture_quality"],TripoImageToModelNode:["quad","style","texture","texture_quality"],TripoTextureNode:["texture_quality"],GeminiNode:["model"],GeminiImage2Node:["resolution"],OpenAIChatNode:["model"],ByteDanceImageNode:["model"],ByteDanceImageEditNode:["model"],ByteDanceSeedreamNode:["model","sequential_image_generation","max_images"],ByteDanceTextToVideoNode:["model","duration","resolution"],ByteDanceImageToVideoNode:["model","duration","resolution"],ByteDanceFirstLastFrameNode:["model","duration","resolution"],ByteDanceImageReferenceNode:["model","duration","resolution"],WanTextToVideoApi:["duration","size"],WanImageToVideoApi:["duration","resolution"],LtxvApiTextToVideo:["model","duration","resolution"],LtxvApiImageToVideo:["model","duration","resolution"]})[a]||[],"getRelevantWidgetNames")}),"useNodePricing"),_b=n(()=>{function e(s){if(!s.isSubgraphNode())return;s.badges=s.badges.filter(r=>!t(r));const i=o(s.subgraph);i.length>1?s.badges.push(l("Partner Nodes x "+i.length)):s.badges.push(...i)}n(e,"updateSubgraphCredits");function o(s,i=new Set){if(i.has(s.id))return[];i.add(s.id);const r=[];for(const u of s.nodes)r.push(...u.isSubgraphNode()?o(u.subgraph,i):u.badges.filter(c=>t(c)));return r}n(o,"collectCreditsBadges");function t(s){return(typeof s=="function"?s():s).icon?.unicode===""}n(t,"isCreditsBadge");const a=ft();function l(s){const i=a.completedActivePalette.light_theme;return new Gn({text:s,iconOptions:{unicode:"",fontFamily:"PrimeIcons",color:i?io("#FABC25",{lightness:.5}):"#FABC25",bgColor:i?io("#654020",{lightness:.5}):"#654020",fontSize:8},fgColor:a.completedActivePalette.colors.litegraph_base.BADGE_FG_COLOR,bgColor:i?io("#8D6932",{lightness:.5}):"#8D6932"})}return n(l,"getCreditsBadge"),{getCreditsBadge:l,updateSubgraphCredits:e}},"usePriceBadge"),Tb=n((e,o={})=>{const{widgetNames:t,triggerCanvasRedraw:a=!1}=o,l=R({});if(e.widgets){const s=t?e.widgets.filter(r=>t.includes(r.name)):e.widgets,i={};if(s.forEach(r=>{i[r.name]=r.value}),l.value=i,s.forEach(r=>{r.callback=po(r.callback,()=>{l.value={...l.value,[r.name]:r.value},a&&e.graph?.setDirtyCanvas(!0,!0)})}),t&&t.length>s.length){const r=t.map(u=>s.some(c=>c.name==u)?-1:e.inputs.findIndex(c=>c.name==u)).filter(u=>u>=0);e.onConnectionsChange=po(e.onConnectionsChange,(u,c,p)=>{r.includes(c)&&(l.value={...l.value,[r[c]]:p},a&&e.graph?.setDirtyCanvas(!0,!0))})}}return s=>Sl(l,s)},"useComputedWithWidgetWatch"),Nb=n(()=>{const e=ne(),o=zn(),t=ft(),a=_b(),l=b(()=>e.get("Comfy.NodeBadge.NodeSourceBadgeMode")),s=b(()=>e.get("Comfy.NodeBadge.NodeIdBadgeMode")),i=b(()=>e.get("Comfy.NodeBadge.NodeLifeCycleBadgeMode")),r=b(()=>e.get("Comfy.NodeBadge.ShowApiPricing"));te([l,s,i,r],()=>{j.graph?.setDirtyCanvas(!0,!0)});const u=ut();function c(p,g){return!(g===ct.None||p?.isCoreNode&&g===ct.HideBuiltIn)}n(c,"badgeTextVisible"),De(()=>{const p=$b();o.registerExtension({name:"Comfy.NodeBadge",nodeCreated(g){g.badgePosition=Wi.TopRight;const d=b(()=>{const w=u.fromLGraphNode(g);return new Gn({text:xl.truncate([c(w,s.value)?`#${g.id}`:"",c(w,i.value)?w?.nodeLifeCycleBadgeText??"":"",c(w,l.value)?w?.nodeSource?.badgeText??"":""].filter(h=>h.length>0).join(" "),{length:31}),fgColor:t.completedActivePalette.colors.litegraph_base.BADGE_FG_COLOR,bgColor:t.completedActivePalette.colors.litegraph_base.BADGE_BG_COLOR})});if(g.badges.push(()=>d.value),g.constructor.nodeData?.api_node&&r.value){const h=typeof p.getNodePricingConfig(g)?.displayPrice=="function";let C;const f=n(()=>{const S=p.getNodeDisplayPrice(g);return a.getCreditsBadge(S)},"createBadge");if(h){const S=p.getRelevantWidgetNames(g.constructor.nodeData?.name);C=Tb(g,{widgetNames:S,triggerCanvasRedraw:!0})(f)}else C=b(f);g.badges.push(()=>C.value)}},init(){j.canvas.canvas.addEventListener("litegraph:set-graph",()=>{for(const g of j.canvas.graph?.nodes??[])a.updateSubgraphCredits(g)}),j.canvas.canvas.addEventListener("subgraph-converted",g=>a.updateSubgraphCredits(g.detail.subgraphNode))},afterConfigureGraph(){for(const g of j.canvas.graph?.nodes??[])a.updateSubgraphCredits(g)}})})},"useNodeBadge"),Mb=n(e=>{const o=Wn(),t=yo(),a=tt();Na(()=>e.value,{getDropEffect:n(l=>l.source.data.type==="tree-explorer-node"?"copy":"move","getDropEffect"),onDrop:n(async l=>{const s=l.location.current.input,i=l.source.data;if(i.type==="tree-explorer-node"){const r=i.data,c=Ma().clientPosToCanvasPos([s.clientX,s.clientY]);if(r.data instanceof Oi){const p=r.data,g=[...c];g[1]+=ve.NODE_TITLE_HEIGHT,t.addNodeOnGraph(p,{pos:g})}else if(r.data instanceof Bi){const p=r.data,g=c,d=j.graph.getNodeOnPos(g[0],g[1]);let w=null,h=null;if(d){const C=o.getAllNodeProviders(p.directory);for(const f of C)f.nodeDef.name===d.comfyClass&&(h=d,w=f)}if(!h){const C=o.getNodeProvider(p.directory);C&&(h=t.addNodeOnGraph(C.nodeDef,{pos:g}),w=C)}if(h){const C=h.widgets?.find(f=>f.name===w?.key);C&&(C.value=p.file_name)}}else if(r.data instanceof da){const p=r.data;await a.insertWorkflow(p,{position:c})}}},"onDrop")})},"useCanvasDrop"),Ib=n(()=>{nn.install(Xe.prototype,"getCanvasMenuOptions");const{getCanvasMenuOptions:e}=Xe.prototype,o=n(function(...r){const u=e.apply(this,r),c=j.collectCanvasMenuItems(this);for(const g of c)u.push(g);const p=nn.extractLegacyItems("getCanvasMenuOptions",this,...r);for(const g of p)u.push(g);for(const g of u)g?.content&&(g.content=ye(`contextMenu.${g.content}`,g.content));return u},"getCanvasCenterMenuOptions");Xe.prototype.getCanvasMenuOptions=o,nn.registerWrapper("getCanvasMenuOptions",o,e,Xe.prototype);const t=Xe.prototype.getNodeMenuOptions,a=n(function(...r){const u=t.apply(this,r),c=r[0],p=j.collectNodeMenuItems(c);for(const g of p)u.push(g);return u},"getNodeMenuOptionsWithExtensions");Xe.prototype.getNodeMenuOptions=a;function l(r,u){if(!r)return;const c=/Convert (.*) to input/,p=/Convert (.*) to widget/,g=ye("contextMenu.Convert ","Convert "),d=ye("contextMenu. to input"," to input"),w=ye("contextMenu. to widget"," to widget");for(const h of r){if(typeof h=="string"||(l(h?.submenu?.options,u),!h?.content))continue;zi(`contextMenu.${h.content}`)&&(h.content=ye(`contextMenu.${h.content}`,h.content));const C=u.extra||u.parentMenu?.options?.extra,f=h.content?.match(c);if(f){let $=f[1];C?.inputs?.find(k=>{if(k.name!=$)return!1;$=k.label?k.label:k.name}),C?.widgets?.find(k=>{if(k.name!=$)return!1;$=k.label?k.label:k.name}),h.content=g+$+d;continue}const S=h.content?.match(p);if(S){let $=S[1];C?.inputs?.find(k=>{if(k.name!=$)return!1;$=k.label?k.label:k.name}),C?.widgets?.find(k=>{if(k.name!=$)return!1;$=k.label?k.label:k.name}),h.content=g+$+w;continue}}}n(l,"translateMenus");const s=ve.ContextMenu;function i(r,u){return u.title&&(u.title=ye(`nodeDefs.${Oe(u.title)}.display_name`,u.title)),l(r,u),new s(r,u)}n(i,"ContextMenu"),ve.ContextMenu=i,ve.ContextMenu.prototype=s.prototype},"useContextMenuTranslation");function Pb(){const e=window.getSelection();return e!==null&&e.toString().trim().length>0}n(Pb,"hasTextSelection");function Za(e){return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&!["button","checkbox","file","hidden","image","radio","range","reset","search","submit"].includes(e.type)||fe().linearMode||Pb()}n(Za,"shouldIgnoreCopyPaste");const Rb=['<meta charset="utf-8"><div><span data-metadata="','"></span></div><span style="white-space:pre-wrap;">Text</span>'],Db=n(()=>{const e=fe();Re(document,"copy",o=>{if(Za(o.target))return;const t=e.canvas;if(t?.selectedItems){const a=t.copyToClipboard(),l=btoa(String.fromCharCode(...Array.from(new TextEncoder().encode(a))));return o.clipboardData?.setData("text/html",Rb.join(l)),o.preventDefault(),o.stopImmediatePropagation(),!1}})},"useCopy"),Ab=n(()=>{window.LiteGraph=ve,window.LGraph=Fi,window.LLink=Ui,window.LGraphNode=pt,window.LGraphGroup=At,window.DragAndScale=Gi,window.LGraphCanvas=Xe,window.ContextMenu=Hi,window.LGraphBadge=Gn},"useGlobalLitegraph");function Lb(e){const t=e.getData("text/html").match(/data-metadata="([A-Za-z0-9+/=]+)"/)?.[1];if(!t)return!1;try{const a=atob(t),l=Uint8Array.from(a,i=>i.charCodeAt(0)),s=new TextDecoder().decode(l);return fe().getCanvas()._deserializeItems(JSON.parse(s),{}),!0}catch(a){console.error(a)}return!1}n(Lb,"pasteClipboardItems");const Eb=n(()=>{const e=lt(),o=fe(),t=n((a,l,s)=>{if(!l)return;const i=Array.from(a).filter(u=>u.type.startsWith(s)),r=i[0]?.getAsFile();r&&(l.pasteFile?.(r),l.pasteFiles?.(Array.from(i).map(u=>u.getAsFile()).filter(u=>u!==null)))},"pasteItemsOnNode");Re(document,"paste",async a=>{if(Za(a.target)||e.shiftDown)return;const{canvas:l}=o;if(!l)return;const{graph:s}=l;let i=a.clipboardData;if(!i)throw new Error("No clipboard data on clipboard event");const{items:r}=i,u=l.current_node,c=u?.is_selected,p=c&&ba(u),g=c&&ji(u),d=c&&qi(u);let w=p?u:null,h=d?u:null;const C=g?u:null;for(const S of r)if(S.type.startsWith("image/")){if(!w){const $=ve.createNode("LoadImage");$&&($.pos=[l.graph_mouse[0],l.graph_mouse[1]],w=s?.add($)??null),s?.change()}t(r,w,"image");return}else if(S.type.startsWith("video/")){if(C){t(r,C,"video");return}}else if(S.type.startsWith("audio/")){if(!h){const $=ve.createNode("LoadAudio");$&&($.pos=[l.graph_mouse[0],l.graph_mouse[1]],h=s?.add($)??null),s?.change()}t(r,h,"audio");return}if(Lb(i))return;i=i.getData("text/plain");let f=null;try{i=i.slice(i.indexOf("{")),f=JSON.parse(i)}catch{try{i=i.slice(i.indexOf(`workflow
`)),i=i.slice(i.indexOf("{")),f=JSON.parse(i)}catch{f=null}}if(f&&f.version&&f.nodes&&f.extra)await j.loadGraphData(f);else{if(a.target instanceof HTMLTextAreaElement&&a.target.type==="textarea"||a.target instanceof HTMLInputElement&&a.target.type==="text")return;l.pasteFromClipboard()}})},"usePaste"),Vb=n(()=>{const e=ne(),o=fe();be(()=>{const t=e.get("Comfy.Graph.CanvasInfo");o.canvas&&(o.canvas.show_info=t,o.canvas.draw(!1,!0))}),be(()=>{const t=e.get("Comfy.Graph.ZoomSpeed");o.canvas&&(o.canvas.zoom_speed=t)}),be(()=>{ve.snaps_for_comfy=e.get("Comfy.Node.AutoSnapLinkToSlot")}),be(()=>{ve.snap_highlights_node=e.get("Comfy.Node.SnapHighlightsNode")}),be(()=>{pt.keepAllLinksOnBypass=e.get("Comfy.Node.BypassAllLinksOnDelete")}),be(()=>{ve.middle_click_slot_add_default_node=e.get("Comfy.Node.MiddleClickRerouteNode")}),be(()=>{const t=e.get("Comfy.LinkRenderMode");o.canvas&&(o.canvas.links_render_mode=t,o.canvas.setDirty(!1,!0))}),be(()=>{const t=e.get("LiteGraph.Canvas.MinFontSizeForLOD");o.canvas&&(o.canvas.min_font_size_for_lod=t,o.canvas.setDirty(!0,!0))}),be(()=>{const t=e.get("Comfy.Graph.LinkMarkers"),{canvas:a}=o;a&&(a.linkMarkerShape=t,a.setDirty(!1,!0))}),be(()=>{const t=e.get("LiteGraph.Canvas.MaximumFps"),{canvas:a}=o;a&&(a.maximumFps=t)}),be(()=>{const t=e.get("Comfy.Graph.CtrlShiftZoom"),{canvas:a}=o;a&&(a.dragZoomEnabled=t)}),be(()=>{sn.doubleClickTime=e.get("Comfy.Pointer.DoubleClickTime")}),be(()=>{sn.bufferTime=e.get("Comfy.Pointer.ClickBufferTime")}),be(()=>{sn.maxClickDrift=e.get("Comfy.Pointer.ClickDrift")}),be(()=>{ve.CANVAS_GRID_SIZE=e.get("Comfy.SnapToGrid.GridSize")}),be(()=>{ve.alwaysSnapToGrid=e.get("pysssss.SnapToGrid")}),be(()=>{ve.context_menu_scaling=e.get("LiteGraph.ContextMenu.Scaling")}),be(()=>{ve.Reroute.maxSplineOffset=e.get("LiteGraph.Reroute.SplineOffset")}),be(()=>{const t=e.get("Comfy.Canvas.NavigationMode");ve.canvasNavigationMode=t,ve.macTrackpadGestures=t==="standard"}),be(()=>{const t=e.get("Comfy.Canvas.LeftMouseClickBehavior");ve.leftMouseClickBehavior=t}),be(()=>{const t=e.get("Comfy.Canvas.MouseWheelScroll");ve.mouseWheelScroll=t}),be(()=>{ve.saveViewportWithGraph=e.get("Comfy.EnableWorkflowViewRestore")})},"useLitegraphSettings"),Wb=[{id:"Comfy.Memory.AllowManualUnload",name:"Allow manual unload of models and execution cache via user command",type:"hidden",defaultValue:!0,versionAdded:"1.18.0"},{id:"Comfy.Validation.Workflows",name:"Validate workflows",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl",category:["Comfy","Node Search Box","Implementation"],experimental:!0,name:"Node search box implementation",type:"combo",options:["default","litegraph (legacy)"],defaultValue:"default"},{id:"Comfy.LinkRelease.Action",category:["LiteGraph","LinkRelease","Action"],name:"Action on link release (No modifier)",type:"combo",options:Object.values(ht),defaultValue:ht.CONTEXT_MENU,defaultsByInstallVersion:{"1.24.1":ht.SEARCH_BOX}},{id:"Comfy.LinkRelease.ActionShift",category:["LiteGraph","LinkRelease","ActionShift"],name:"Action on link release (Shift)",type:"combo",options:Object.values(ht),defaultValue:ht.SEARCH_BOX,defaultsByInstallVersion:{"1.24.1":ht.CONTEXT_MENU}},{id:"Comfy.NodeSearchBoxImpl.NodePreview",category:["Comfy","Node Search Box","NodePreview"],name:"Node preview",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl.ShowCategory",category:["Comfy","Node Search Box","ShowCategory"],name:"Show node category in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl.ShowIdName",category:["Comfy","Node Search Box","ShowIdName"],name:"Show node id name in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!1},{id:"Comfy.NodeSearchBoxImpl.ShowNodeFrequency",category:["Comfy","Node Search Box","ShowNodeFrequency"],name:"Show node frequency in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!1},{id:"Comfy.Sidebar.Location",category:["Appearance","Sidebar","Location"],name:"Sidebar location",type:"combo",options:["left","right"],defaultValue:"left"},{id:"Comfy.Sidebar.Size",category:["Appearance","Sidebar","Size"],name:"Sidebar size",type:"combo",options:["normal","small"],defaultValue:n(()=>window.innerWidth<1536?"small":"normal","defaultValue")},{id:"Comfy.Sidebar.UnifiedWidth",category:["Appearance","Sidebar","UnifiedWidth"],name:"Unified sidebar width",type:"boolean",defaultValue:!0,versionAdded:"1.18.1"},{id:"Comfy.Sidebar.Style",category:["Appearance","Sidebar","Style"],name:"Sidebar style",type:"combo",options:["floating","connected"],defaultValue:"connected"},{id:"Comfy.TextareaWidget.FontSize",category:["Appearance","Node Widget","TextareaWidget","FontSize"],name:"Textarea widget font size",type:"slider",defaultValue:10,attrs:{min:8,max:24}},{id:"Comfy.TextareaWidget.Spellcheck",category:["Comfy","Node Widget","TextareaWidget","Spellcheck"],name:"Textarea widget spellcheck",type:"boolean",defaultValue:!1},{id:"Comfy.Workflow.SortNodeIdOnSave",name:"Sort node IDs when saving workflow",type:"boolean",defaultValue:!1},{id:"Comfy.Canvas.NavigationMode",category:["LiteGraph","Canvas Navigation","NavigationMode"],name:"Navigation Mode",defaultValue:"legacy",type:"combo",sortOrder:100,options:[{value:"standard",text:"Standard (New)"},{value:"legacy",text:"Drag Navigation"},{value:"custom",text:"Custom"}],versionAdded:"1.25.0",defaultsByInstallVersion:{"1.25.0":"legacy"},onChange:n(async(e,o)=>{if(!o)return;const t=ne();e==="standard"?(await t.set("Comfy.Canvas.LeftMouseClickBehavior","select"),await t.set("Comfy.Canvas.MouseWheelScroll","panning")):e==="legacy"&&(await t.set("Comfy.Canvas.LeftMouseClickBehavior","panning"),await t.set("Comfy.Canvas.MouseWheelScroll","zoom"))},"onChange")},{id:"Comfy.Canvas.LeftMouseClickBehavior",category:["LiteGraph","Canvas Navigation","LeftMouseClickBehavior"],name:"Left Mouse Click Behavior",defaultValue:"panning",type:"radio",sortOrder:50,options:[{value:"panning",text:"Panning"},{value:"select",text:"Select"}],versionAdded:"1.27.4",onChange:n(async e=>{const o=ne(),t=o.get("Comfy.Canvas.NavigationMode");if(t!=="custom"){if(e==="select"&&t==="standard"||e==="panning"&&t==="legacy")return;await o.set("Comfy.Canvas.NavigationMode","custom")}},"onChange")},{id:"Comfy.Canvas.MouseWheelScroll",category:["LiteGraph","Canvas Navigation","MouseWheelScroll"],name:"Mouse Wheel Scroll",defaultValue:"zoom",type:"radio",options:[{value:"panning",text:"Panning"},{value:"zoom",text:"Zoom in/out"}],versionAdded:"1.27.4",onChange:n(async e=>{const o=ne(),t=o.get("Comfy.Canvas.NavigationMode");if(t!=="custom"){if(e==="panning"&&t==="standard"||e==="zoom"&&t==="legacy")return;await o.set("Comfy.Canvas.NavigationMode","custom")}},"onChange")},{id:"Comfy.Graph.CanvasInfo",category:["LiteGraph","Canvas","CanvasInfo"],name:"Show canvas info on bottom left corner (fps, etc.)",type:"boolean",defaultValue:!0},{id:"Comfy.Node.ShowDeprecated",name:"Show deprecated nodes in search",tooltip:"Deprecated nodes are hidden by default in the UI, but remain functional in existing workflows that use them.",type:"boolean",defaultValue:!1},{id:"Comfy.Node.ShowExperimental",name:"Show experimental nodes in search",tooltip:"Experimental nodes are marked as such in the UI and may be subject to significant changes or removal in future versions. Use with caution in production workflows",type:"boolean",defaultValue:!0},{id:"Comfy.Node.Opacity",category:["Appearance","Node","Opacity"],name:"Node opacity",type:"slider",defaultValue:1,attrs:{min:.01,max:1,step:.01}},{id:"Comfy.Workflow.ShowMissingNodesWarning",name:"Show missing nodes warning",type:"boolean",defaultValue:!0},{id:"Comfy.Workflow.ShowMissingModelsWarning",name:"Show missing models warning",type:"boolean",defaultValue:!0,experimental:!0},{id:"Comfy.Workflow.WarnBlueprintOverwrite",name:"Require confirmation to overwrite an existing subgraph blueprint",type:"boolean",defaultValue:!0},{id:"Comfy.Graph.ZoomSpeed",category:["LiteGraph","Canvas","ZoomSpeed"],name:"Canvas zoom speed",type:"slider",defaultValue:1.1,attrs:{min:1.01,max:2.5,step:.01}},{id:"Comfy.NodeLibrary.Bookmarks",name:"Node library bookmarks with display name (deprecated)",type:"hidden",defaultValue:[],deprecated:!0},{id:"Comfy.NodeLibrary.Bookmarks.V2",name:"Node library bookmarks v2 with unique name",type:"hidden",defaultValue:[]},{id:"Comfy.NodeLibrary.BookmarksCustomization",name:"Node library bookmarks customization",type:"hidden",defaultValue:{}},{id:"Comfy.Queue.ImageFit",name:"Queue image fit",type:"hidden",defaultValue:"cover"},{id:"Comfy.GroupSelectedNodes.Padding",category:["LiteGraph","Group","Padding"],name:"Group selected nodes padding",type:"slider",defaultValue:10,attrs:{min:0,max:100}},{id:"Comfy.Node.DoubleClickTitleToEdit",category:["LiteGraph","Node","DoubleClickTitleToEdit"],name:"Double click node title to edit",type:"boolean",defaultValue:!0},{id:"Comfy.Node.AllowImageSizeDraw",category:["LiteGraph","Node Widget","AllowImageSizeDraw"],name:"Show width  height below the image preview",type:"boolean",defaultValue:!0},{id:"Comfy.Group.DoubleClickTitleToEdit",category:["LiteGraph","Group","DoubleClickTitleToEdit"],name:"Double click group title to edit",type:"boolean",defaultValue:!0},{id:"Comfy.Window.UnloadConfirmation",name:"Show confirmation when closing window",type:"boolean",defaultValue:!0,versionModified:"1.7.12"},{id:"Comfy.TreeExplorer.ItemPadding",category:["Appearance","Tree Explorer","ItemPadding"],name:"Tree explorer item padding",type:"slider",defaultValue:2,attrs:{min:0,max:8,step:1}},{id:"Comfy.ModelLibrary.AutoLoadAll",name:"Automatically load all model folders",tooltip:"If true, all folders will load as soon as you open the model library (this may cause delays while it loads). If false, root level model folders will only load once you click on them.",type:"boolean",defaultValue:!1},{id:"Comfy.ModelLibrary.NameFormat",name:"What name to display in the model library tree view",tooltip:'Select "filename" to render a simplified view of the raw filename (without directory or ".safetensors" extension) in the model list. Select "title" to display the configurable model metadata title.',type:"combo",options:["filename","title"],defaultValue:"title"},{id:"Comfy.Locale",name:"Language",type:"combo",options:[{value:"en",text:"English"},{value:"zh",text:""},{value:"zh-TW",text:""},{value:"ru",text:""},{value:"ja",text:""},{value:"ko",text:""},{value:"fr",text:"Franais"},{value:"es",text:"Espaol"},{value:"ar",text:""},{value:"tr",text:"Trke"}],defaultValue:n(()=>navigator.language.split("-")[0]||"en","defaultValue")},{id:"Comfy.NodeBadge.NodeSourceBadgeMode",category:["LiteGraph","Node","NodeSourceBadgeMode"],name:"Node source badge mode",type:"combo",options:Object.values(ct),defaultValue:ct.HideBuiltIn},{id:"Comfy.NodeBadge.NodeIdBadgeMode",category:["LiteGraph","Node","NodeIdBadgeMode"],name:"Node ID badge mode",type:"combo",options:[ct.None,ct.ShowAll],defaultValue:ct.None},{id:"Comfy.NodeBadge.NodeLifeCycleBadgeMode",category:["LiteGraph","Node","NodeLifeCycleBadgeMode"],name:"Node life cycle badge mode",type:"combo",options:[ct.None,ct.ShowAll],defaultValue:ct.ShowAll},{id:"Comfy.NodeBadge.ShowApiPricing",category:["Comfy","API Nodes"],name:"Show API node pricing badge",type:"boolean",defaultValue:!0,versionAdded:"1.20.3"},{id:"Comfy.Notification.ShowVersionUpdates",category:["Comfy","Notification Preferences"],name:"Show version updates",tooltip:"Show updates for new models, and major new features.",type:"boolean",defaultValue:!0},{id:"Comfy.ConfirmClear",category:["Comfy","Workflow","ConfirmClear"],name:"Require confirmation when clearing workflow",type:"boolean",defaultValue:!0},{id:"Comfy.PromptFilename",category:["Comfy","Workflow","PromptFilename"],name:"Prompt for filename when saving workflow",type:"boolean",defaultValue:!0},{id:"Comfy.PreviewFormat",category:["LiteGraph","Node Widget","PreviewFormat"],name:"Preview image format",tooltip:"When displaying a preview in the image widget, convert it to a lightweight image, e.g. webp, jpeg, webp;50, etc.",type:"text",defaultValue:""},{id:"Comfy.DisableSliders",category:["LiteGraph","Node Widget","DisableSliders"],name:"Disable node widget sliders",type:"boolean",defaultValue:!1},{id:"Comfy.DisableFloatRounding",category:["LiteGraph","Node Widget","DisableFloatRounding"],name:"Disable default float widget rounding.",tooltip:"(requires page reload) Cannot disable round when round is set by the node in the backend.",type:"boolean",defaultValue:!1},{id:"Comfy.FloatRoundingPrecision",category:["LiteGraph","Node Widget","FloatRoundingPrecision"],name:"Float widget rounding decimal places [0 = auto].",tooltip:"(requires page reload)",type:"slider",attrs:{min:0,max:6,step:1},defaultValue:0},{id:"LiteGraph.Node.TooltipDelay",name:"Tooltip Delay",type:"number",attrs:{min:100,max:3e3,step:50},defaultValue:500,versionAdded:"1.9.0"},{id:"Comfy.EnableTooltips",category:["LiteGraph","Node","EnableTooltips"],name:"Enable Tooltips",type:"boolean",defaultValue:!0},{id:"Comfy.DevMode",name:"Enable dev mode options (API save, etc.)",type:"boolean",defaultValue:!1,onChange:n(e=>{const o=document.getElementById("comfy-dev-save-api-button");o&&(o.style.display=e?"flex":"none")},"onChange")},{id:"Comfy.UseNewMenu",category:["Comfy","Menu","UseNewMenu"],defaultValue:"Top",name:"Use new menu",type:"combo",options:["Disabled","Top"],tooltip:"Menu bar position. On mobile devices, the menu is always shown at the top.",migrateDeprecatedValue:n(e=>e==="Floating"||e==="Bottom"?"Top":e,"migrateDeprecatedValue")},{id:"Comfy.Workflow.WorkflowTabsPosition",name:"Opened workflows position",type:"combo",options:["Sidebar","Topbar"],defaultValue:"Topbar",migrateDeprecatedValue:n(e=>e==="Topbar (2nd-row)"?"Topbar":e,"migrateDeprecatedValue")},{id:"Comfy.Graph.CanvasMenu",category:["LiteGraph","Canvas","CanvasMenu"],name:"Show graph canvas menu",type:"boolean",defaultValue:!0},{id:"Comfy.QueueButton.BatchCountLimit",name:"Batch count limit",tooltip:"The maximum number of tasks added to the queue at one button click",type:"number",defaultValue:100,versionAdded:"1.3.5"},{id:"Comfy.Keybinding.UnsetBindings",name:"Keybindings unset by the user",type:"hidden",defaultValue:[],versionAdded:"1.3.7",versionModified:"1.7.3",migrateDeprecatedValue:n(e=>e.map(o=>(o.targetSelector==="#graph-canvas"&&(o.targetElementId="graph-canvas-container"),o)),"migrateDeprecatedValue")},{id:"Comfy.Keybinding.NewBindings",name:"Keybindings set by the user",type:"hidden",defaultValue:[],versionAdded:"1.3.7"},{id:"Comfy.Extension.Disabled",name:"Disabled extension names",type:"hidden",defaultValue:[],versionAdded:"1.3.11"},{id:"Comfy.LinkRenderMode",category:["LiteGraph","Graph","LinkRenderMode"],name:"Link Render Mode",defaultValue:2,type:"combo",options:[{value:ve.STRAIGHT_LINK,text:"Straight"},{value:ve.LINEAR_LINK,text:"Linear"},{value:ve.SPLINE_LINK,text:"Spline"},{value:ve.HIDDEN_LINK,text:"Hidden"}]},{id:"Comfy.Node.AutoSnapLinkToSlot",category:["LiteGraph","Node","AutoSnapLinkToSlot"],name:"Auto snap link to node slot",tooltip:"When dragging a link over a node, the link automatically snap to a viable input slot on the node",type:"boolean",defaultValue:!0,versionAdded:"1.3.29"},{id:"Comfy.Node.SnapHighlightsNode",category:["LiteGraph","Node","SnapHighlightsNode"],name:"Snap highlights node",tooltip:"When dragging a link over a node with viable input slot, highlight the node",type:"boolean",defaultValue:!0,versionAdded:"1.3.29"},{id:"Comfy.Node.BypassAllLinksOnDelete",category:["LiteGraph","Node","BypassAllLinksOnDelete"],name:"Keep all links when deleting nodes",tooltip:"When deleting a node, attempt to reconnect all of its input and output links (bypassing the deleted node)",type:"boolean",defaultValue:!0,versionAdded:"1.3.40"},{id:"Comfy.Node.MiddleClickRerouteNode",category:["LiteGraph","Node","MiddleClickRerouteNode"],name:"Middle-click creates a new Reroute node",type:"boolean",defaultValue:!0,versionAdded:"1.3.42"},{id:"Comfy.Graph.LinkMarkers",category:["LiteGraph","Link","LinkMarkers"],name:"Link midpoint markers",defaultValue:So.Circle,type:"combo",options:[{value:So.None,text:"None"},{value:So.Circle,text:"Circle"},{value:So.Arrow,text:"Arrow"}],versionAdded:"1.3.42"},{id:"Comfy.DOMClippingEnabled",category:["LiteGraph","Node","DOMClippingEnabled"],name:"Enable DOM element clipping (enabling may reduce performance)",type:"boolean",defaultValue:!0},{id:"Comfy.Graph.CtrlShiftZoom",category:["LiteGraph","Canvas","CtrlShiftZoom"],name:"Enable fast-zoom shortcut (Ctrl + Shift + Drag)",type:"boolean",defaultValue:!0,versionAdded:"1.4.0"},{id:"Comfy.Pointer.ClickDrift",category:["LiteGraph","Pointer","ClickDrift"],name:"Pointer click drift (maximum distance)",tooltip:`If the pointer moves more than this distance while holding a button down, it is considered dragging (rather than clicking).

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`,experimental:!0,type:"slider",attrs:{min:0,max:20,step:1},defaultValue:6,versionAdded:"1.4.3"},{id:"Comfy.Pointer.ClickBufferTime",category:["LiteGraph","Pointer","ClickBufferTime"],name:"Pointer click drift delay",tooltip:`After pressing a pointer button down, this is the maximum time (in milliseconds) that pointer movement can be ignored for.

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`,experimental:!0,type:"slider",attrs:{min:0,max:1e3,step:25},defaultValue:150,versionAdded:"1.4.3"},{id:"Comfy.Pointer.DoubleClickTime",category:["LiteGraph","Pointer","DoubleClickTime"],name:"Double click interval (maximum)",tooltip:"The maximum time in milliseconds between the two clicks of a double-click.  Increasing this value may assist if double-clicks are sometimes not registered.",type:"slider",attrs:{min:100,max:1e3,step:50},defaultValue:300,versionAdded:"1.4.3"},{id:"Comfy.SnapToGrid.GridSize",category:["LiteGraph","Canvas","GridSize"],name:"Snap to grid size",type:"slider",attrs:{min:1,max:500},tooltip:"When dragging and resizing nodes while holding shift they will be aligned to the grid, this controls the size of that grid.",defaultValue:ve.CANVAS_GRID_SIZE},{id:"pysssss.SnapToGrid",category:["LiteGraph","Canvas","AlwaysSnapToGrid"],name:"Always snap to grid",type:"boolean",defaultValue:!1,versionAdded:"1.3.13"},{id:"Comfy.Server.ServerConfigValues",name:"Server config values for frontend display",tooltip:"Server config values used for frontend display only",type:"hidden",defaultValue:{},versionAdded:"1.4.8"},{id:"Comfy.Server.LaunchArgs",name:"Server launch arguments",tooltip:"These are the actual arguments that are passed to the server when it is launched.",type:"hidden",defaultValue:{},versionAdded:"1.4.8"},{id:"Comfy.Queue.MaxHistoryItems",name:"Queue history size",tooltip:"The maximum number of tasks that show in the queue history.",type:"slider",attrs:{min:2,max:256,step:2},defaultValue:64,versionAdded:"1.4.12"},{id:"LiteGraph.Canvas.MaximumFps",name:"Maximum FPS",tooltip:"The maximum frames per second that the canvas is allowed to render. Caps GPU usage at the cost of smoothness. If 0, the screen refresh rate is used. Default: 0",type:"slider",attrs:{min:0,max:120},defaultValue:0,versionAdded:"1.5.1"},{id:"Comfy.EnableWorkflowViewRestore",category:["Comfy","Workflow","EnableWorkflowViewRestore"],name:"Save and restore canvas position and zoom level in workflows",type:"boolean",defaultValue:!0,versionModified:"1.5.4"},{id:"Comfy.Workflow.ConfirmDelete",name:"Show confirmation when deleting workflows",type:"boolean",defaultValue:!0,versionAdded:"1.5.6"},{id:"Comfy.ColorPalette",name:"The active color palette id",type:"hidden",defaultValue:"dark",versionModified:"1.6.7",migrateDeprecatedValue(e){return e.startsWith("custom_")?e.replace("custom_",""):e}},{id:"Comfy.CustomColorPalettes",name:"Custom color palettes",type:"hidden",defaultValue:{},versionModified:"1.6.7"},{id:"Comfy.WidgetControlMode",category:["Comfy","Node Widget","WidgetControlMode"],name:"Widget control mode",tooltip:"Controls when widget values are updated (randomize/increment/decrement), either before the prompt is queued or after.",type:"combo",defaultValue:"after",options:["before","after"],versionModified:"1.6.10"},{id:"Comfy.TutorialCompleted",name:"Tutorial completed",type:"hidden",defaultValue:!1,versionAdded:"1.8.7"},{id:"Comfy.InstalledVersion",name:"The frontend version that was running when the user first installed ComfyUI",type:"hidden",defaultValue:null,versionAdded:"1.24.0"},{id:"LiteGraph.ContextMenu.Scaling",name:"Scale node combo widget menus (lists) when zoomed in",defaultValue:!1,type:"boolean",versionAdded:"1.8.8"},{id:"LiteGraph.Canvas.LowQualityRenderingZoomThreshold",type:"hidden",deprecated:!0,name:"Low quality rendering zoom threshold (deprecated)",tooltip:"Zoom level threshold for performance mode. Lower values (0.1) = quality at all zoom levels. Higher values (1.0) = performance mode even when zoomed in. Performance mode simplifies rendering by hiding text labels, shadows, and details.",attrs:{min:.1,max:1,step:.01},defaultValue:.6,versionAdded:"1.9.1",versionModified:"1.26.7"},{id:"LiteGraph.Canvas.MinFontSizeForLOD",name:"Zoom Node Level of Detail - font size threshold",tooltip:"Controls when the nodes switch to low quality LOD rendering. Uses font size in pixels to determine when to switch. Set to 0 to disable. Values 1-24 set the minimum font size threshold for LOD - higher values (24px) = switch nodes to simplified rendering sooner when zooming out, lower values (1px) = maintain full node quality longer.",type:"slider",attrs:{min:0,max:24,step:1},defaultValue:8,versionAdded:"1.26.7",hideInVueNodes:!0},{id:"Comfy.Canvas.SelectionToolbox",category:["LiteGraph","Canvas","SelectionToolbox"],name:"Show selection toolbox",type:"boolean",defaultValue:!0,versionAdded:"1.10.5"},{id:"LiteGraph.Reroute.SplineOffset",name:"Reroute spline offset",tooltip:"The bezier control point offset from the reroute centre point",type:"slider",defaultValue:20,attrs:{min:0,max:400},versionAdded:"1.15.7"},{id:"Comfy.Toast.DisableReconnectingToast",name:"Disable toasts when reconnecting or reconnected",type:"hidden",defaultValue:!1,versionAdded:"1.15.12"},{id:"Comfy.Minimap.Visible",name:"Display minimap on canvas",type:"hidden",defaultValue:window.innerWidth>=Zs.lg,versionAdded:"1.25.0"},{id:"Comfy.Minimap.NodeColors",name:"Display node with its original color on minimap",type:"hidden",defaultValue:!1,versionAdded:"1.26.0"},{id:"Comfy.Minimap.ShowLinks",name:"Display links on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.ShowGroups",name:"Display node groups on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.RenderBypassState",name:"Render bypass state on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.RenderErrorState",name:"Render error state on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Workflow.AutoSaveDelay",name:"Auto Save Delay (ms)",defaultValue:1e3,type:"number",tooltip:'Only applies if Auto Save is set to "after delay".',versionAdded:"1.16.0"},{id:"Comfy.Workflow.AutoSave",name:"Auto Save",type:"combo",options:["off","after delay"],defaultValue:"off",versionAdded:"1.16.0"},{id:"Comfy.Workflow.Persist",name:"Persist workflow state and restore on page (re)load",type:"boolean",defaultValue:!0,versionAdded:"1.16.1"},{id:"LiteGraph.Node.DefaultPadding",name:"Always shrink new nodes",tooltip:"Resize nodes to the smallest possible size when created. When disabled, a newly added node will be widened slightly to show widget values.",type:"boolean",defaultValue:!1,versionAdded:"1.18.0"},{id:"Comfy.Canvas.BackgroundImage",category:["Appearance","Canvas","Background"],name:"Canvas background image",type:"backgroundImage",tooltip:'Image URL for the canvas background. You can right-click an image in the outputs panel and select "Set as Background" to use it, or upload your own image using the upload button.',defaultValue:"",versionAdded:"1.20.4",versionModified:"1.20.5"},{id:"Comfy.Release.Version",name:"Last seen release version",type:"hidden",defaultValue:""},{id:"Comfy.Release.Status",name:"Release status",type:"hidden",defaultValue:"skipped"},{id:"Comfy.Release.Timestamp",name:"Release seen timestamp",type:"hidden",defaultValue:0},{id:"Comfy.Templates.SelectedModels",name:"Template library - Selected model filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SelectedUseCases",name:"Template library - Selected use case filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SelectedRunsOn",name:"Template library - Selected runs on filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SortBy",name:"Template library - Sort preference",type:"hidden",defaultValue:"newest"},{id:"Comfy.VueNodes.Enabled",category:["Comfy","Nodes 2.0","VueNodesEnabled"],name:"Modern Node Design (Nodes 2.0)",type:"boolean",tooltip:"Modern: DOM-based rendering with enhanced interactivity, native browser features, and updated visual design. Classic: Traditional canvas rendering.",defaultValue:!1,sortOrder:100,experimental:!0,versionAdded:"1.27.1"},{id:"Comfy.VueNodes.AutoScaleLayout",category:["Comfy","Nodes 2.0","AutoScaleLayout"],name:"Auto-scale layout (Nodes 2.0)",tooltip:"Automatically scale node positions when switching to Nodes 2.0 rendering to prevent overlap",type:"boolean",sortOrder:50,experimental:!0,defaultValue:!0,versionAdded:"1.30.3"},{id:"Comfy.Assets.UseAssetAPI",name:"Use Asset API for model library",type:"hidden",tooltip:"Use new Asset API for model browsing",defaultValue:!1,experimental:!0}];function Ob(){const e=Me(),o=ne(),t=tt(),a=b(()=>o.get("Comfy.Workflow.AutoSave")),l=b(()=>o.get("Comfy.Workflow.AutoSaveDelay"));let s=null,i=!1,r=!1;const u=n(()=>{if(s&&(clearTimeout(s),s=null),a.value==="after delay"){if(i){r=!0;return}const p=l.value;s=setTimeout(async()=>{const g=e.activeWorkflow;if(g?.isModified&&g.isPersisted)try{i=!0,await t.saveWorkflow(g)}catch(d){console.error("Auto save failed:",d)}finally{i=!1,r&&(r=!1,u())}},p)}},"scheduleAutoSave");te(a,p=>{s&&(clearTimeout(s),s=null),p==="after delay"&&e.activeWorkflow?.isModified&&u()},{immediate:!0});const c=n(()=>{u()},"onGraphChanged");he.addEventListener("graphChanged",c),rt(()=>{s&&(clearTimeout(s),s=null),he.removeEventListener("graphChanged",c)})}n(Ob,"useWorkflowAutoSave");function Bb(){const e=ea(),o=ta(),{t}=ce(),a=Wt(),l=qa(),s=Ia.TEMPLATE,i=n(c=>/^[a-zA-Z0-9_-]+$/.test(c),"isValidParameter"),r=n(()=>{const c={...e.query};delete c.template,delete c.source,o.replace({query:c})},"cleanupUrlParams");return{loadTemplateFromUrl:n(async()=>{const c=e.query.template;if(!c||typeof c!="string")return;if(!i(c)){console.warn(`[useTemplateUrlLoader] Invalid template parameter format: ${c}`);return}const p=e.query.source||"default";if(!i(p)){console.warn(`[useTemplateUrlLoader] Invalid source parameter format: ${p}`);return}try{await l.loadTemplates(),await l.loadWorkflowTemplate(c,p)||a.add({severity:"error",summary:t("g.error"),detail:t("templateWorkflows.error.templateNotFound",{templateName:c}),life:3e3})}catch(g){console.error("[useTemplateUrlLoader] Failed to load template from URL:",g),a.add({severity:"error",summary:t("g.error"),detail:t("g.errorLoadingTemplate"),life:3e3})}finally{r(),Ki(s)}},"loadTemplateFromUrl")}}n(Bb,"useTemplateUrlLoader");function zb(){const e=Me(),o=ne(),t=ea(),a=ta(),l=Bb(),s=Ia.TEMPLATE,i=n(async()=>{Qi(s);const x=Ji(s,t.query);return x&&await a.replace({query:x}),x??t.query},"ensureTemplateQueryFromIntent"),r=b(()=>o.get("Comfy.Workflow.Persist")),u=n(()=>{if(!r.value)return;const x=JSON.stringify(j.graph.serialize());try{localStorage.setItem("workflow",x),he.clientId&&sessionStorage.setItem(`workflow:${he.clientId}`,x)}catch(_){const M=Object.keys(sessionStorage).filter(N=>N.startsWith("workflow:")||N==="workflow");throw console.error("QuotaExceededError details:",{workflowSizeKB:Math.round(x.length/1024),totalStorageItems:Object.keys(sessionStorage).length,ourWorkflowKeys:M.length,ourWorkflowSizes:M.map(N=>({key:N,sizeKB:Math.round(sessionStorage[N].length/1024)})),error:_ instanceof Error?_.message:String(_)}),_}},"persistCurrentWorkflow"),c=n(async(x,_)=>{if(!x)return!1;const M=JSON.parse(x);return await j.loadGraphData(M,!0,!0,_),!0},"loadWorkflowFromStorage"),p=n(async()=>{const x=an("Comfy.PreviousWorkflow"),_=he.initialClientId??he.clientId;if(_){const N=sessionStorage.getItem(`workflow:${_}`);if(await c(N,x))return!0}const M=localStorage.getItem("workflow");return await c(M,x)},"loadPreviousWorkflowFromStorage"),g=n(async()=>{o.get("Comfy.TutorialCompleted")?await j.loadGraphData():(await o.set("Comfy.TutorialCompleted",!0),await tt().loadBlankWorkflow(),await ke().execute("Comfy.BrowseTemplates"))},"loadDefaultWorkflow"),d=n(async()=>{if(r.value)try{await p()||await g()}catch(x){console.error("Error loading previous workflow",x),await g()}},"initializeWorkflow"),w=n(async()=>{const x=await i();x.template&&typeof x.template=="string"&&await l.loadTemplateFromUrl()},"loadTemplateFromUrlIfPresent");te(()=>e.activeWorkflow?.key,x=>{x&&(ln("Comfy.PreviousWorkflow",x),u())}),he.addEventListener("graphChanged",u),Xs(()=>{he.removeEventListener("graphChanged",u)});const h=b(()=>e.openWorkflows),C=b(()=>e.activeWorkflow),f=b(()=>{if(!h.value||!C.value)return{paths:[],activeIndex:-1};const x=h.value.filter(M=>M?.isPersisted).map(M=>M.path),_=h.value.findIndex(M=>M.path===C.value?.path);return{paths:x,activeIndex:_}}),S=JSON.parse(an("Comfy.OpenWorkflowsPaths")||"[]"),$=JSON.parse(an("Comfy.ActiveWorkflowIndex")||"-1");return te(f,({paths:x,activeIndex:_})=>{r.value&&(ln("Comfy.OpenWorkflowsPaths",JSON.stringify(x)),ln("Comfy.ActiveWorkflowIndex",JSON.stringify(_)))}),{initializeWorkflow:d,loadTemplateFromUrlIfPresent:w,restoreWorkflowTabsState:n(()=>{if(!r.value)return;S?.length>0&&$>=0&&e.openWorkflowsInBackground({left:S.slice(0,$),right:S.slice($)})},"restoreWorkflowTabsState")}}n(zb,"useWorkflowPersistence");function Fb(e,o={}){const{settleDelay:t=200,passive:a=!0}=o,l=R(!1),s=n(()=>{l.value=!0},"markTransformActive"),i=$l(()=>{l.value=!1},t);return Re(e,"wheel",n(()=>{s(),i()},"handleWheel"),{capture:!0,passive:a}),{isTransforming:l}}n(Fb,"useTransformSettling");function Ub(){const e=Dn({x:0,y:0,z:1}),o=b(()=>({transform:`scale(${e.z}) translate(${e.x}px, ${e.y}px)`,transformOrigin:"0 0"}));function t(d){!d||!d.ds||(e.x=d.ds.offset[0],e.y=d.ds.offset[1],e.z=d.ds.scale||1)}n(t,"syncWithCanvas");function a(d){return{x:(d.x+e.x)*e.z,y:(d.y+e.y)*e.z}}n(a,"canvasToScreen");const l=n(d=>({x:d.x/e.z-e.x,y:d.y/e.z-e.y}),"screenToCanvas");function s(d,w){const h=a({x:d[0],y:d[1]}),C=w[0]*e.z,f=w[1]*e.z;return new DOMRect(h.x,h.y,C,f)}n(s,"getNodeScreenBounds");function i(d){return e.z<.1?Math.min(d*5,2):e.z>3?Math.max(d*.5,.05):d}n(i,"calculateAdjustedMargin");function r(d){return Math.max(d[0],d[1])*e.z<4}n(r,"isNodeTooSmall");function u(d,w){const h=d.width*w,C=d.height*w;return{left:-h,right:d.width+h,top:-C,bottom:d.height+C}}n(u,"getExpandedViewportBounds");function c(d,w,h){const C=d.x+w[0]*e.z,f=d.y+w[1]*e.z;return!(C<h.left||d.x>h.right||f<h.top||d.y>h.bottom)}n(c,"testViewportIntersection");function p(d,w,h,C=.2){if(r(w))return!1;const f=a({x:d[0],y:d[1]}),S=i(C),$=u(h,S);return c(f,w,$)}n(p,"isNodeInViewport");function g(d,w=.2){const h=d.width*w,C=d.height*w,f=l({x:-h,y:-C}),S=l({x:d.width+h,y:d.height+C});return{x:f.x,y:f.y,width:S.x-f.x,height:S.y-f.y}}return n(g,"getViewportBounds"),{camera:Oo(e),transformStyle:o,syncWithCanvas:t,canvasToScreen:a,screenToCanvas:l,getNodeScreenBounds:s,isNodeInViewport:p,getViewportBounds:g}}n(Ub,"useTransformStateIndividual");const os=Et(Ub),Gb=K({__name:"TransformPane",props:{canvas:{}},emits:["transformUpdate"],setup(e,{emit:o}){const t=e,{transformStyle:a,syncWithCanvas:l}=os(),s=b(()=>t.canvas?.canvas),{isTransforming:i}=Fb(s,{settleDelay:512}),r=o;return go(()=>{t.canvas&&(l(t.canvas),r("transformUpdate"))},{immediate:!0}),(u,c)=>(m(),T("div",{"data-testid":"transform-pane",class:J(v(de)("absolute inset-0 w-full h-full pointer-events-none",v(i)?"transform-pane--interacting":"will-change-auto")),style:pe(v(a))},[Pe(u.$slots,"default",{},void 0,!0)],6))}}),Hb=Se(Gb,[["__scopeId","data-v-7a56b17c"]]),jb={class:"flex items-center gap-2"},qb={for:"node-colors"},Kb={class:"flex items-center gap-2"},Qb={for:"show-links"},Jb={class:"flex items-center gap-2"},Yb={for:"show-groups"},Zb={class:"flex items-center gap-2"},Xb={for:"render-bypass"},ew={class:"flex items-center gap-2"},tw={for:"render-error"},ow=K({__name:"MiniMapPanel",props:{panelStyles:{},nodeColors:{type:Boolean},showLinks:{type:Boolean},showGroups:{type:Boolean},renderBypass:{type:Boolean},renderError:{type:Boolean}},emits:["updateOption"],setup(e){return(o,t)=>(m(),T("div",{class:"minimap-panel mr-2 flex flex-col gap-2 bg-comfy-menu-bg p-3 text-sm shadow-interface",style:pe(o.panelStyles)},[y("div",jb,[L(v(no),{"input-id":"node-colors",name:"node-colors","model-value":o.nodeColors,binary:"","onUpdate:modelValue":t[0]||(t[0]=a=>o.$emit("updateOption","Comfy.Minimap.NodeColors",a))},null,8,["model-value"]),t[5]||(t[5]=y("i",{class:"icon-[lucide--palette]"},null,-1)),y("label",qb,z(o.$t("minimap.nodeColors")),1)]),y("div",Kb,[L(v(no),{"input-id":"show-links",name:"show-links","model-value":o.showLinks,binary:"","onUpdate:modelValue":t[1]||(t[1]=a=>o.$emit("updateOption","Comfy.Minimap.ShowLinks",a))},null,8,["model-value"]),t[6]||(t[6]=y("i",{class:"icon-[lucide--route]"},null,-1)),y("label",Qb,z(o.$t("minimap.showLinks")),1)]),y("div",Jb,[L(v(no),{"input-id":"show-groups",name:"show-groups","model-value":o.showGroups,binary:"","onUpdate:modelValue":t[2]||(t[2]=a=>o.$emit("updateOption","Comfy.Minimap.ShowGroups",a))},null,8,["model-value"]),t[7]||(t[7]=y("i",{class:"icon-[lucide--frame]"},null,-1)),y("label",Yb,z(o.$t("minimap.showGroups")),1)]),y("div",Zb,[L(v(no),{"input-id":"render-bypass",name:"render-bypass","model-value":o.renderBypass,binary:"","onUpdate:modelValue":t[3]||(t[3]=a=>o.$emit("updateOption","Comfy.Minimap.RenderBypassState",a))},null,8,["model-value"]),t[8]||(t[8]=y("i",{class:"icon-[lucide--circle-slash-2]"},null,-1)),y("label",Xb,z(o.$t("minimap.renderBypassState")),1)]),y("div",ew,[L(v(no),{"input-id":"render-error",name:"render-error","model-value":o.renderError,binary:"","onUpdate:modelValue":t[4]||(t[4]=a=>o.$emit("updateOption","Comfy.Minimap.RenderErrorState",a))},null,8,["model-value"]),t[9]||(t[9]=y("i",{class:"icon-[lucide--message-circle-warning]"},null,-1)),y("label",tw,z(o.$t("minimap.renderErrorState")),1)])],4))}}),nw=["width","height"],sw=K({__name:"MiniMap",setup(e){const o=ke(),t=R(),{initialized:a,visible:l,containerRef:s,canvasRef:i,containerStyles:r,viewportStyles:u,width:c,height:p,panelStyles:g,nodeColors:d,showLinks:w,showGroups:h,renderBypass:C,renderError:f,updateOption:S,destroy:$,handlePointerDown:k,handlePointerMove:x,handlePointerUp:_,handlePointerCancel:M,handleWheel:N,setMinimapRef:I}=Yn(),V=R(!1),P=n(()=>{V.value=!V.value},"toggleOptionsPanel");return De(()=>{t.value&&I(t.value)}),rt(()=>{$()}),(G,D)=>v(l)&&v(a)?(m(),T("div",{key:0,ref_key:"minimapRef",ref:t,class:"minimap-main-container absolute right-0 bottom-[54px] z-1000 flex"},[V.value?(m(),O(ow,{key:0,"panel-styles":v(g),"node-colors":v(d),"show-links":v(w),"show-groups":v(h),"render-bypass":v(C),"render-error":v(f),onUpdateOption:v(S)},null,8,["panel-styles","node-colors","show-links","show-groups","render-bypass","render-error","onUpdateOption"])):A("",!0),y("div",{ref_key:"containerRef",ref:s,class:"litegraph-minimap relative border border-interface-stroke bg-comfy-menu-bg shadow-interface",style:pe(v(r))},[L(v(re),{class:"absolute top-1 left-1 z-10 hover:bg-interface-button-hover-surface!",size:"small",text:"",severity:"secondary",onClick:Ne(P,["stop"])},{icon:E(()=>D[7]||(D[7]=[y("i",{class:"icon-[lucide--settings-2]"},null,-1)])),_:1}),L(v(re),{class:"absolute top-1 right-1 z-10 hover:bg-interface-button-hover-surface!",size:"small",text:"",severity:"secondary","data-testid":"close-minmap-button",onClick:D[0]||(D[0]=Ne(()=>v(o).execute("Comfy.Canvas.ToggleMinimap"),["stop"]))},{icon:E(()=>D[8]||(D[8]=[y("i",{class:"icon-[lucide--x]"},null,-1)])),_:1}),y("hr",{class:"absolute top-7 h-px border-0 bg-node-component-border",style:pe({width:v(r).width})},null,4),y("canvas",{ref_key:"canvasRef",ref:i,width:v(c),height:v(p),class:"minimap-canvas"},null,8,nw),y("div",{class:"minimap-viewport",style:pe(v(u))},null,4),y("div",{class:"absolute inset-0 touch-none",onPointerdown:D[1]||(D[1]=(...B)=>v(k)&&v(k)(...B)),onPointermove:D[2]||(D[2]=(...B)=>v(x)&&v(x)(...B)),onPointerup:D[3]||(D[3]=(...B)=>v(_)&&v(_)(...B)),onPointerleave:D[4]||(D[4]=(...B)=>v(_)&&v(_)(...B)),onPointercancel:D[5]||(D[5]=(...B)=>v(M)&&v(M)(...B)),onWheel:D[6]||(D[6]=(...B)=>v(N)&&v(N)(...B))},null,32)],4)],512)):A("",!0)}}),aw=Se(sw,[["__scopeId","data-v-fdf41881"]]);function Xa(e={}){const{layoutSource:o=Jt.Vue}=e,t=bo();function a(l,s){t.setSource(s??o),t.bringNodeToFront(l)}return n(a,"bringNodeToFront"),{bringNodeToFront:a}}n(Xa,"useNodeZIndex");function Nn(e){return e.ctrlKey||e.metaKey||e.shiftKey}n(Nn,"isMultiSelectKey");function lw(){const e=fe(),{nodeManager:o}=on(),{bringNodeToFront:t}=Xa(),{shouldHandleNodePointerEvents:a}=Bt();function l(c,p){if(!a.value||!e.canvas||!o.value)return;const g=o.value.getNode(p);if(!g)return;const d=Nn(c),w=e.selectedItems.length,h=!d&&g.selected&&w>1;d?g.selected||e.canvas.select(g):h||(e.canvas.deselectAll(),e.canvas.select(g)),g.flags?.pinned||t(p),e.updateSelectedItems()}n(l,"handleNodeSelect");function s(c,p){if(!a.value||!o.value)return;const g=o.value.getNode(c);if(!g)return;(g.flags?.collapsed??!1)!==p&&g.collapse()}n(s,"handleNodeCollapse");function i(c,p){if(!a.value||!o.value)return;const g=o.value.getNode(c);g&&(g.title=p)}n(i,"handleNodeTitleUpdate");function r(c,p){if(!a.value||!e.canvas||!o.value)return;const g=o.value.getNode(p);g&&(c.preventDefault(),g.selected||l(c,p))}n(r,"handleNodeRightClick");function u(c,p){if(!a.value||!e.canvas||!o.value)return;const g=o.value.getNode(c);if(g){if(!p){e.canvas.deselectAll(),e.canvas.select(g),e.updateSelectedItems();return}g.selected?e.canvas.deselect(g):e.canvas.select(g),e.updateSelectedItems()}}return n(u,"toggleNodeSelectionAfterPointerUp"),{handleNodeSelect:l,handleNodeCollapse:s,handleNodeTitleUpdate:i,handleNodeRightClick:r,toggleNodeSelectionAfterPointerUp:u}}n(lw,"useNodeEventHandlersIndividual");const el=Et(lw);function tl(){const e=ne(),o=b(()=>e.get("Comfy.SnapToGrid.GridSize")),t=b(()=>e.get("pysssss.SnapToGrid"));function a(i){return i.shiftKey||t.value}n(a,"shouldSnap");function l(i){const r=o.value;if(!r)return{...i};const u=[i.x,i.y];return cs(u,r)?{x:u[0],y:u[1]}:{...i}}n(l,"applySnapToPosition");function s(i){const r=o.value;if(!r)return{...i};const u=[i.width,i.height];return cs(u,r)?{width:u[0],height:u[1]}:{...i}}return n(s,"applySnapToSize"),{gridSize:o,alwaysSnap:t,shouldSnap:a,applySnapToPosition:l,applySnapToSize:s}}n(tl,"useNodeSnap");function ol(){const e=yt(!1);let o=null;function t(l){l!==e.value&&(!o&&(o=j.canvas?.canvas??null,!o)||(e.value=l,o.dispatchEvent(new KeyboardEvent(l?"keydown":"keyup",{key:"Shift",shiftKey:l,bubbles:!0}))))}n(t,"syncShiftState");function a(l){t(l.shiftKey);const s=n(u=>{u.key==="Shift"&&t(u.shiftKey)},"handleKeyEvent"),i=Re(window,"keydown",s,{passive:!0}),r=Re(window,"keyup",s,{passive:!0});return()=>{i(),r()}}return n(a,"trackShiftKey"),Xs(()=>{e.value=!1,o=null}),{trackShiftKey:a}}n(ol,"useShiftKeySync");const nl=Et(iw);function iw(){const e=bo(),{selectedNodeIds:o}=at(fe()),t=os(),{shouldSnap:a,applySnapToPosition:l}=tl(),{trackShiftKey:s}=ol();let i=null,r=null,u=null,c=null,p=null;function g(h,C){const f=Ke(Ce.getNodeLayoutRef(C));if(!f)return;const S=f.position??{x:0,y:0};p=s(h),i={...S},r={x:h.clientX,y:h.clientY};const $=Ke(o);if($?.has(C)&&$.size>1){u=new Map;for(const k of $){if(k===C)continue;const x=Ce.getNodeLayoutRef(k).value;x&&u.set(k,{...x.position})}}else u=null;e.setSource(Jt.Vue)}n(g,"startDrag");function d(h,C){if(!i||!r||c!==null)return;const{target:f,pointerId:S}=h;f instanceof HTMLElement&&!f.hasPointerCapture(S)&&f.setPointerCapture(S),c=requestAnimationFrame(()=>{if(c=null,!i||!r)return;const $={x:h.clientX-r.x,y:h.clientY-r.y},k=t.screenToCanvas({x:0,y:0}),x=t.screenToCanvas($),_={x:x.x-k.x,y:x.y-k.y},M={x:i.x+_.x,y:i.y+_.y};if(e.moveNode(C,M),u&&u.size>0)for(const[N,I]of u){const V={x:I.x+_.x,y:I.y+_.y};e.moveNode(N,V)}})}n(d,"handleDrag");function w(h,C){if(a(h)&&C){const f=[],S=Ke(Ce.getNodeLayoutRef(C));if(S){const $=S.position,k=l({...$});(k.x!==$.x||k.y!==$.y)&&f.push({nodeId:C,bounds:{x:k.x,y:k.y,width:S.size.width,height:S.size.height}})}if(u&&u.size>0)for(const $ of u.keys()){const k=Ce.getNodeLayoutRef($).value;if(k){const x={...k.position},_=l(x);(_.x!==x.x||_.y!==x.y)&&f.push({nodeId:$,bounds:{x:_.x,y:_.y,width:k.size.width,height:k.size.height}})}}f.length>0&&Ce.batchUpdateNodeBounds(f)}i=null,r=null,u=null,p?.(),p=null,c!==null&&(cancelAnimationFrame(c),c=null)}return n(w,"endDrag"),{startDrag:g,handleDrag:d,endDrag:w}}n(iw,"useNodeDragIndividual");function rw(e){const{startDrag:o,endDrag:t,handleDrag:a}=nl(),{forwardEventToCanvas:l,shouldHandleNodePointerEvents:s}=Bt(),{handleNodeSelect:i,toggleNodeSelectionAfterPointerUp:r}=el(),{nodeManager:u}=on(),c=n(x=>Yi(x)?(l(x),!0):!1,"forwardMiddlePointerIfNeeded"),p=R({x:0,y:0}),g=3;function d(x){if(c(x)||x.button!==0)return;if(!s.value){l(x);return}const _=Ke(e);if(!_){console.warn("LGraphNode: nodeData is null/undefined in handlePointerDown");return}u.value?.getNode(_)?.flags?.pinned||(p.value={x:x.clientX,y:x.clientY},o(x,_))}n(d,"onPointerdown");function w(x){if(c(x)||Ce.isResizingVueNodes.value)return;const _=Ke(e);if(u.value?.getNode(_)?.flags?.pinned)return;const M=Nn(x),N=x.buttons&1;if(N&&M&&!Ce.isDraggingVueNodes.value){Ce.isDraggingVueNodes.value=!0,i(x,_),o(x,_);return}if(N&&!Ce.isDraggingVueNodes.value){const I=x.clientX-p.value.x,V=x.clientY-p.value.y;Math.sqrt(I*I+V*V)>g&&(Ce.isDraggingVueNodes.value=!0,i(x,_))}Ce.isDraggingVueNodes.value&&a(x,_)}n(w,"onPointermove");function h(){Ce.isDraggingVueNodes.value=!1}n(h,"cleanupDragState");function C(x){try{const _=Ke(e);t(x,_)}catch(_){console.error("Error during endDrag:",_)}finally{h()}}n(C,"safeDragEnd");function f(x){if(c(x))return;if(!s.value){l(x);return}if(Ce.isDraggingVueNodes.value){C(x);return}if(x.button===2)return;const N=Nn(x),I=Ke(e);I&&r(I,N)}n(f,"onPointerup");function S(x){Ce.isDraggingVueNodes.value&&C(x)}n(S,"onPointercancel");function $(x){Ce.isDraggingVueNodes.value&&(x.preventDefault(),h())}return n($,"onContextmenu"),_l(()=>{h()}),{pointerHandlers:{onPointerdown:d,onPointermove:w,onPointerup:f,onPointercancel:S,onContextmenu:$}}}n(rw,"useNodePointerInteractions");const jo=new Map([["node",{dataAttribute:"nodeId",updateHandler:n(e=>{const o=e.map(({id:t,bounds:a})=>({nodeId:t,bounds:a}));Ce.batchUpdateNodeBounds(o)},"updateHandler")}]]),Ls=new ResizeObserver(e=>{if(fe().linearMode)return;const o=Ma(),t=new Map,a=new Set;for(const l of e){if(!(l.target instanceof HTMLElement))continue;const s=l.target;let i,r;for(const[S,$]of jo){const k=s.dataset[$.dataAttribute];if(k){i=S,r=k;break}}if(!i||!r)continue;const u=Array.isArray(l.borderBoxSize)?l.borderBoxSize[0]:{inlineSize:l.contentRect.width,blockSize:l.contentRect.height},c=u.inlineSize,p=u.blockSize,g=s.getBoundingClientRect(),[d,w]=o.clientPosToCanvasPos([g.left,g.top]),h={x:d,y:w},C={x:h.x,y:h.y+ve.NODE_TITLE_HEIGHT,width:Math.max(0,c),height:Math.max(0,p)};let f=t.get(i);f||(f=[],t.set(i,f)),f.push({id:r,bounds:C}),i==="node"&&r&&a.add(r)}Ce.setSource(Jt.DOM);for(const[l,s]of t){const i=jo.get(l);i&&s.length&&i.updateHandler(s)}if(a.size>0)for(const l of a)Zi(l)});function uw(e,o){const t=Ke(e);De(()=>{const a=ls()?.proxy?.$el;if(!(a instanceof HTMLElement)||!t)return;const l=jo.get(o);l&&(a.dataset[l.dataAttribute]=t,Ls.observe(a))}),rt(()=>{const a=ls()?.proxy?.$el;if(!(a instanceof HTMLElement))return;const l=jo.get(o);l&&(delete a.dataset[l.dataAttribute],Ls.unobserve(a))})}n(uw,"useVueElementTracking");const cw=n(e=>{const o=b(()=>Ke(e)??""),{nodeLocationProgressStates:t,isIdle:a}=at(Je()),l=b(()=>{const c=o.value;return c?t.value[c]:void 0}),s=b(()=>!a.value&&l.value?.state==="running"),i=b(()=>{const c=l.value;return c&&c.max>0?c.value/c.max:void 0}),r=b(()=>{const c=i.value;return c!==void 0?Math.round(c*100):void 0}),u=b(()=>{const c=l.value;return c?c.state:"idle"});return{executing:s,progress:i,progressPercentage:r,progressState:l,executionState:u}},"useNodeExecutionState");function dw(e){const o=Ke(e),t=bo(),a=Ce.getNodeLayoutRef(o);rt(()=>{Ce.cleanupNodeRef(o)});const l=b(()=>a.value?.position??{x:0,y:0}),s=b(()=>a.value?.size??{width:200,height:100}),i=b(()=>a.value?.zIndex??0);function r(u){t.setSource(Jt.Vue),t.moveNode(o,u)}return n(r,"moveNodeTo"),{position:l,size:s,zIndex:i,moveNodeTo:r}}n(dw,"useNodeLayout");const pw=n((e,o)=>{const t=Ke(e),a=Me(),{nodePreviewImages:l}=at(Ot()),s=b(()=>a.nodeIdToNodeLocatorId(t)),i=b(()=>{const p=s.value;if(!p)return;const g=l.value[p];return g?.length?g:void 0}),r=b(()=>!!i.value?.length),u=b(()=>{const p=i.value;return p?.length?p.at(-1):""}),c=b(()=>o?.isCollapsed?!o.isCollapsed.value&&r.value:r.value);return{locatorId:s,previewUrls:i,hasPreview:r,latestPreviewUrl:u,shouldShowPreviewImg:c}},"useNodePreviewState");function fw(e){const o=os(),t=R(!1),a=R(null),l=R(null),{shouldSnap:s,applySnapToSize:i}=tl(),{trackShiftKey:r}=ol();return{startResize:n(c=>{c.preventDefault(),c.stopPropagation();const p=c.currentTarget;if(!(p instanceof HTMLElement))return;const g=p.closest("[data-node-id]");if(!(g instanceof HTMLElement))return;const d=g.getBoundingClientRect(),w=o.camera.z,h={width:d.width/w,height:d.height/w},C=r(c);p.setPointerCapture(c.pointerId),Ce.isResizingVueNodes.value=!0,t.value=!0,a.value={x:c.clientX,y:c.clientY},l.value=h;const f=n(x=>{if(!t.value||!a.value||!l.value)return;const _=o.camera.z,M=(x.clientX-a.value.x)/(_||1),N=(x.clientY-a.value.y)/(_||1);let I={width:l.value.width+M,height:l.value.height+N};s(x)&&(I=i(I));const V=p.closest("[data-node-id]");V instanceof HTMLElement&&e({size:I},V)},"handlePointerMove"),S=n(x=>{t.value&&(t.value=!1,Ce.isResizingVueNodes.value=!1,a.value=null,l.value=null,C(),p.releasePointerCapture(x.pointerId),$(),k())},"handlePointerUp"),$=Re("pointermove",f),k=Re("pointerup",S)},"startResize"),isResizing:t}}n(fw,"useNodeResize");const mw={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function vw(e,o){return m(),T("svg",mw,o[0]||(o[0]=[y("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[y("path",{d:"m2 2l20 20M10.41 10.41a2 2 0 1 1-2.83-2.83m5.92 5.92L6 21m12-9l3 3"}),y("path",{d:"M3.59 3.59A2 2 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59M21 15V5a2 2 0 0 0-2-2H9"})],-1)]))}n(vw,"render");const gw=Ks({name:"lucide-image-off",render:vw}),hw={key:0,class:"flex h-full min-h-16 w-full min-w-16 flex-col"},yw={class:"relative h-88 w-full grow overflow-hidden rounded-[5px] bg-node-component-surface"},bw={key:0,class:"text-pure-white flex h-full w-full flex-col items-center justify-center text-center"},ww={class:"text-xs text-smoke-400"},kw=["src","alt"],Cw={class:"text-node-component-header-text mt-1 text-center text-xs"},Sw=K({__name:"LivePreview",props:{imageUrl:{}},setup(e){const o=e,t=R(null),a=R(!1);te(()=>o.imageUrl,()=>{t.value=null,a.value=!1});const l=n(i=>{if(!i.target||!(i.target instanceof HTMLImageElement))return;const r=i.target;a.value=!1,r.naturalWidth&&r.naturalHeight&&(t.value=`${r.naturalWidth} x ${r.naturalHeight}`)},"handleImageLoad"),s=n(()=>{a.value=!0,t.value=null},"handleImageError");return(i,r)=>{const u=gw;return i.imageUrl?(m(),T("div",hw,[y("div",yw,[a.value?(m(),T("div",bw,[L(u,{class:"mb-1 size-8 text-smoke-500"}),y("p",ww,z(i.$t("g.imageFailedToLoad")),1)])):(m(),T("img",{key:1,src:i.imageUrl,alt:i.$t("g.liveSamplingPreview"),class:"pointer-events-none h-full w-full object-contain object-center",onLoad:l,onError:s},null,40,kw))]),y("div",Cw,z(a.value?i.$t("g.errorLoadingImage"):t.value||i.$t("g.calculatingDimensions")),1)])):A("",!0)}}}),xw={key:0,class:"node-error p-2 text-sm text-red-500"},$w=["data-node-id"],_w={class:"flex flex-col justify-center items-center relative"},Tw={class:"relative mb-1"},Nw=["data-testid"],Mw={key:1,class:"min-h-0 flex-1 flex"},Iw={key:2,class:"min-h-0 flex-1 px-4"},Pw=["aria-label"],Rw="absolute h-3 w-3 opacity-0 pointer-events-auto focus-visible:outline focus-visible:outline-2 focus-visible:outline-white/40",Dw=225,Es="h-2 bg-primary-500 transition-all duration-300",Aw=K({__name:"LGraphNode",props:{nodeData:{},error:{default:null},zoomLevel:{}},setup(e){const{t:o}=ce(),{handleNodeCollapse:t,handleNodeTitleUpdate:a,handleNodeRightClick:l}=el(),{bringNodeToFront:s}=Xa();uw(()=>e.nodeData.id,"node");const{selectedNodeIds:i}=at(fe()),r=b(()=>i.value.has(e.nodeData.id)),u=b(()=>rn(e.nodeData)),{executing:c,progress:p}=cw(u),g=Je(),d=b(()=>g.lastExecutionErrorNodeId===e.nodeData.id),w=b(()=>!!(d.value||e.nodeData.hasErrors||e.error||(g.lastNodeErrors?.[e.nodeData.id]?.errors.length??0)>0)),h=b(()=>e.nodeData.flags?.collapsed??!1),C=b(()=>e.nodeData.mode===Ae.BYPASS),f=b(()=>e.nodeData.mode===Ae.NEVER),S=b(()=>{const ie=ft();return e.nodeData.bgcolor?Xi(e.nodeData.bgcolor,!!ie.completedActivePalette.light_theme):""}),$=b(()=>{const ie=ne().get("Comfy.Node.Opacity")??1;return C.value||f.value?ie*.5:ie}),k=b(()=>er(e.nodeData).length>0),x=b(()=>!!e.nodeData.outputs?.length),{handleWheel:_,shouldHandleNodePointerEvents:M}=Bt(),N=R(null),{toastErrorHandler:I}=ho();Fs(ie=>(N.value=ie.message,I(ie),!1));const{position:V,size:P,zIndex:G}=dw(()=>e.nodeData.id),{pointerHandlers:D}=rw(()=>e.nodeData.id),{onPointerdown:B,...F}=D,{startDrag:W}=nl();async function H(ie){if(ie.altKey&&Ge.value){const ge=Xe.cloneNodes([Ge.value]);if(ge?.created?.length){const[Ie]=ge.created;W(ie,`${Ie.id}`),Ce.isDraggingVueNodes.value=!0,await Le(),s(`${Ie.id}`);return}}B(ie)}n(H,"nodeOnPointerdown");const U=n(ie=>{ie.preventDefault(),ie.stopPropagation(),l(ie,e.nodeData.id);const ge=ie.currentTarget;ge&&ja(ie,ge,!1)},"handleContextMenu");De(()=>{P.value&&vt.value&&(vt.value.style.setProperty("--node-width",`${P.value.width}px`),vt.value.style.setProperty("--node-height",`${P.value.height}px`))});const{startResize:q}=fw((ie,ge)=>{if(h.value)return;const Ie=Math.max(ie.size.width,Dw);ge.style.setProperty("--node-width",`${Ie}px`),ge.style.setProperty("--node-height",`${ie.size.height}px`)}),Q=n(ie=>{e.nodeData.flags?.pinned||q(ie)},"handleResizePointerDown");te(h,ie=>{const ge=vt.value;if(!ge)return;const[Ie,Ve]=ie?["","-x"]:["-x",""],ae=ge.style.getPropertyValue(`--node-width${Ie}`);ge.style.setProperty(`--node-width${Ve}`,ae),ge.style.setProperty(`--node-width${Ie}`,"");const oe=ge.style.getPropertyValue(`--node-height${Ie}`);ge.style.setProperty(`--node-height${Ve}`,oe),ge.style.setProperty(`--node-height${Ie}`,"")});const me=b(()=>!!$t.value&&$t.value.urls.length>0),{latestPreviewUrl:Y,shouldShowPreviewImg:ee}=pw(()=>e.nodeData.id,{isCollapsed:h}),se=b(()=>w.value?"border-node-stroke-error":c.value?"border-node-stroke-executing":"border-node-stroke"),xe=b(()=>de(r.value&&(w.value&&"outline-error "||c.value&&"outline-node-executing"||"outline-node-component-outline"))),He=b(()=>de(e.nodeData.flags?.pinned?"cursor-default":Ce.isDraggingVueNodes.value?"cursor-grabbing":"cursor-grab")),je=n(()=>{t(e.nodeData.id,!h.value)},"handleCollapse"),ot=n(ie=>{a(e.nodeData.id,ie)},"handleHeaderTitleUpdate"),Ue=n(()=>{const ie=j.graph?.rootGraph||j.graph;if(!ie){console.warn("LGraphNode: No graph available for subgraph navigation");return}const ge=rn(e.nodeData),Ie=ds(ie,ge);if(!Ie?.isSubgraphNode()||!("subgraph"in Ie)){console.warn("LGraphNode: Node is not a valid subgraph node",Ie);return}const Ve=j.canvas;if(!Ve||typeof Ve.openSubgraph!="function"){console.warn("LGraphNode: Canvas or openSubgraph method not available");return}Ve.openSubgraph(Ie.subgraph,Ie)},"handleEnterSubgraph"),Be=Ot(),mt=b(()=>e.nodeData.subgraphId?`${e.nodeData.subgraphId}:${e.nodeData.id}`:e.nodeData.id),Ge=b(()=>{const ie=rn(e.nodeData),ge=j.graph?.rootGraph||j.graph;return ge?ds(ge,ie):null}),$t=b(()=>{const ie=Be.nodeOutputs[mt.value],ge=Ge.value;if(!ge||!ie?.images?.length)return;const Ie=Be.getNodeImageUrls(ge);if(!Ie?.length)return;const Ve=ge.inputs?.some(oe=>oe.type==="VIDEO");return{type:ge.previewMediaType==="video"||!ge.previewMediaType&&Ve?"video":"image",urls:Ie}}),vt=R(),Ye=R(!1);function Ft(ie){const ge=Ge.value;if(!ge||!ge.onDragOver){Ye.value=!1;return}const Ie=ge.onDragOver(ie);Ye.value=Ie}n(Ft,"handleDragOver");function eo(){Ye.value=!1}n(eo,"handleDragLeave");async function to(ie){Ye.value=!1;const ge=Ge.value;!ge||!ge.onDragDrop||await ge.onDragDrop(ie)}return n(to,"handleDrop"),(ie,ge)=>N.value?(m(),T("div",xw,z(v(ye)("nodeErrors.render","Node Render Error")),1)):(m(),T("div",kt({key:1,ref_key:"nodeContainerRef",ref:vt,"data-node-id":ie.nodeData.id,class:v(de)("bg-component-node-background lg-node absolute pb-1","contain-style contain-layout min-w-[225px] min-h-(--node-height) w-(--node-width)","rounded-2xl touch-none flex flex-col","border-1 border-solid border-component-node-border",v(M)&&"hover:ring-7 ring-node-component-ring","outline-transparent outline-2",se.value,xe.value,He.value,{"before:rounded-2xl before:pointer-events-none before:absolute before:bg-bypass/60 before:inset-0":C.value,"before:rounded-2xl before:pointer-events-none before:absolute before:inset-0":f.value,"ring-4 ring-primary-500 bg-primary-500/10":Ye.value},v(M)?"pointer-events-auto":"pointer-events-none"),style:[{transform:`translate(${v(V).x??0}px, ${(v(V).y??0)-v(ve).NODE_TITLE_HEIGHT}px)`,zIndex:v(G),opacity:$.value,"--component-node-background":S.value}]},F,{onPointerdown:H,onWheel:ge[0]||(ge[0]=(...Ie)=>v(_)&&v(_)(...Ie)),onContextmenu:U,onDragover:Ne(Ft,["prevent"]),onDragleave:eo,onDrop:Ne(to,["stop","prevent"])}),[y("div",_w,[h.value?(m(),T(le,{key:0},[k.value?(m(),O(ps,{key:0,multi:"",class:"absolute left-0 -translate-x-1/2"})):A("",!0),x.value?(m(),O(ps,{key:1,multi:"",class:"absolute right-0 translate-x-1/2"})):A("",!0),L(fs,{"node-data":ie.nodeData,unified:""},null,8,["node-data"])],64)):A("",!0),L(tr,{"node-data":ie.nodeData,collapsed:h.value,onCollapse:je,"onUpdate:title":ot,onEnterSubgraph:Ue},null,8,["node-data","collapsed"])]),h.value&&v(c)&&v(p)!==void 0?(m(),T("div",{key:0,class:J(v(de)("absolute inset-x-4 -bottom-[1px] translate-y-1/2 rounded-full",Es)),style:pe({width:`${Math.min(v(p)*100,100)}%`})},null,6)):A("",!0),h.value?A("",!0):(m(),T(le,{key:1},[y("div",Tw,[v(c)&&v(p)!==void 0?(m(),T("div",{key:0,class:J(v(de)("absolute inset-x-0 top-1/2 -translate-y-1/2",v(p)<1&&"rounded-r-full",Es)),style:pe({width:`${Math.min(v(p)*100,100)}%`})},null,6)):A("",!0)]),y("div",{class:"flex flex-1 flex-col gap-1 pb-2","data-testid":`node-body-${ie.nodeData.id}`},[L(fs,{"node-data":ie.nodeData},null,8,["node-data"]),ie.nodeData.widgets?.length?(m(),O(Pa,{key:0,"node-data":ie.nodeData},null,8,["node-data"])):A("",!0),me.value?(m(),T("div",Mw,[L(wd,{"node-data":ie.nodeData,media:$t.value},null,8,["node-data","media"])])):A("",!0),v(ee)?(m(),T("div",Iw,[L(Sw,{"image-url":v(Y)||null},null,8,["image-url"])])):A("",!0)],8,Nw)],64)),h.value?A("",!0):(m(),T("div",{key:2,role:"button","aria-label":v(o)("g.resizeFromBottomRight"),class:J(v(de)(Rw,"right-0 bottom-0 cursor-se-resize")),onPointerdown:Ne(Q,["stop"])},null,42,Pw))],16,$w))}});let _o=[],To=!1,No=null;const Lw=n(()=>{function e(l){const s=Object.keys(l.settingValues).length===0||!l.get("Comfy.TutorialCompleted"),i=!localStorage.getItem("workflow"),r=!localStorage.getItem("Comfy.PreviousWorkflow");return s&&i&&r}n(e,"checkIsNewUser");async function o(l){if(To){if(No)try{await l()}catch(s){console.error("New user initialization callback failed:",s)}}else _o.push(l)}n(o,"registerInitCallback");async function t(l){if(!To){if(No=e(l),To=!0,!No){_o=[];return}await l.set("Comfy.InstalledVersion","1.33.13");for(const s of _o)try{await s()}catch(i){console.error("New user initialization callback failed:",i)}_o=[]}}n(t,"initializeIfNewUser");function a(){return To?No:null}return n(a,"isNewUser"),{registerInitCallback:o,initializeIfNewUser:t,isNewUser:a}},"newUserService"),Ew={key:0,class:"pointer-events-auto relative w-full h-10 bg-gradient-to-r from-blue-600 to-blue-700 flex items-center justify-center px-4"},Vw={class:"flex items-center text-sm text-white"},Ww={class:"pl-2"},Ow={class:"pl-1.5 hidden md:inline"},Bw="vueNodesBannerDismissed",zw=K({__name:"TryVueNodeBanner",setup(e){const o=ne(),t=zo(Bw,!1),a=b(()=>{try{return o.get("Comfy.VueNodes.Enabled")??!1}catch{return!1}}),l=b(()=>!(a.value||t.value)),s=n(()=>{t.value=!0},"handleDismiss"),i=n(async()=>{try{await o.set("Comfy.VueNodes.Enabled",!0)}catch(r){console.error("Failed to enable Nodes 2.0:",r)}finally{s()}},"handleTryItOut");return(r,u)=>l.value?(m(),T("div",Ew,[y("div",Vw,[u[0]||(u[0]=y("i",{class:"icon-[lucide--rocket]"},null,-1)),y("span",Ww,z(r.$t("vueNodesBanner.title")),1),y("span",Ow,z(r.$t("vueNodesBanner.desc")),1),L(v(re),{class:"cursor-pointer bg-transparent rounded h-7 px-3 border border-white text-white ml-4 text-xs",onClick:i},{default:E(()=>[qe(z(r.$t("vueNodesBanner.tryItOut")),1)]),_:1})]),L(v(re),{class:"cursor-pointer bg-transparent border-0 outline-0 grid place-items-center absolute right-4 text-white",unstyled:"",onClick:s},{default:E(()=>u[1]||(u[1]=[y("i",{class:"w-5 h-5 icon-[lucide--x]"},null,-1)])),_:1})])):A("",!0)}}),Fw={key:0,class:"workflow-tabs-container pointer-events-auto relative h-9.5 w-full"},Uw={key:0,class:"app-drag fixed top-0 left-0 z-10 h-[var(--comfy-topbar-height)] w-full"},Gw={class:"flex h-full items-center"},Hw={class:"sidebar-content-container h-full w-full overflow-x-hidden overflow-y-auto"},jw=K({__name:"GraphCanvas",emits:["ready"],setup(e,{emit:o}){const t=o,a=R(null),l=yt(null),s=ne(),i=ut(),r=lt(),u=fe(),c=Je(),p=wt(),g=ft(),d=Sa(),w=Bt(),h=b(()=>s.get("Comfy.UseNewMenu")!=="Disabled"),C=b(()=>s.get("Comfy.Workflow.WorkflowTabsPosition")),f=b(()=>s.get("Comfy.Graph.CanvasMenu")),S=b(()=>s.get("Comfy.EnableTooltips")),$=b(()=>s.get("Comfy.Canvas.SelectionToolbox")),k=b(()=>r.sidebarTab.activeSidebarTab),x=b(()=>!r.focusMode&&h.value),_=b(()=>s.get("Comfy.Minimap.Visible")),{shouldRenderVueNodes:M}=Go(),N=on(),{handleTransformUpdate:I}=yb(),V=n(async()=>{M.value&&(N.disposeNodeManagerAndSyncs(),await Le(),N.initializeNodeManager())},"handleVueNodeLifecycleReset");te(()=>u.currentGraph,V),te(()=>u.isInSubgraph,async(F,W)=>{W&&!F&&Me().updateActiveGraph(),await V()});const P=b(()=>Array.from(N.nodeManager.value?.vueNodeData?.values()??[]));be(()=>{ve.nodeOpacity=s.get("Comfy.Node.Opacity")}),be(()=>{ve.nodeLightness=g.completedActivePalette.light_theme?.5:void 0}),be(()=>{i.showDeprecated=s.get("Comfy.Node.ShowDeprecated")}),be(()=>{i.showExperimental=s.get("Comfy.Node.ShowExperimental")}),be(()=>{const F=s.get("Comfy.TextareaWidget.Spellcheck");document.querySelectorAll("textarea.comfy-multiline-input").forEach(H=>{H.spellcheck=F,H.focus(),H.blur()})}),te(()=>s.get("Comfy.WidgetControlMode"),()=>{if(u.canvas){for(const F of j.graph.nodes)if(F.widgets){for(const W of F.widgets)if(W[lr]&&(ms(W),W.linkedWidgets))for(const H of W.linkedWidgets)ms(H)}j.graph.setDirtyCanvas(!0)}}),te([()=>u.canvas,()=>s.get("Comfy.ColorPalette")],async([F,W])=>{F&&await d.loadColorPalette(W)}),te(()=>s.get("Comfy.Canvas.BackgroundImage"),async()=>{if(!u.canvas)return;const F=g.activePaletteId;F&&(await d.loadColorPalette(F),u.canvas.setDirty(!1,!0))}),te(()=>g.activePaletteId,async F=>{await s.set("Comfy.ColorPalette",F)}),te(()=>[c.nodeLocationProgressStates,u.canvas],([F,W])=>{if(W?.graph){for(const H of W.graph.nodes){const U=Me().nodeIdToNodeLocatorId(H.id),q=F[U];q&&q.state==="running"?H.progress=q.value/q.max:H.progress=void 0}W.graph.setDirtyCanvas(!0,!1)}},{deep:!0}),te(()=>c.lastNodeErrors,F=>{if(j.graph){for(const W of j.graph.nodes){for(const q of W.inputs)delete q.hasErrors;for(const q of W.outputs)delete q.hasErrors;const H=F?.[W.id];if(!H)continue;H.errors.filter(q=>q.extra_info?.input_name!==void 0).forEach(q=>{const Q=q.extra_info.input_name,me=W.findInputSlot(Q);me!==-1&&(W.inputs[me].hasErrors=!0)})}j.canvas.draw(!0,!0)}}),Re(a,"litegraph:no-items-selected",()=>{p.add({severity:"warn",summary:Z("toastMessages.nothingSelected"),life:2e3})},{passive:!0});const G=n(async()=>{try{const F=await he.getCustomNodesI18n();sr(F)}catch(F){console.error("Failed to load custom nodes i18n",F)}},"loadCustomNodesI18n"),D=R(!1),B=zb();return Mb(a),Vb(),Nb(),De(async()=>{Ab(),Ib(),Db(),Eb(),Ob(),Go(),j.vueAppReady=!0,r.spinner=!0,or.init(),await G();try{await s.loadSettingValues()}catch(H){if(H instanceof nr)localStorage.removeItem("Comfy.userId"),localStorage.removeItem("Comfy.userName"),window.location.reload();else throw H}Wb.forEach(s.addSetting),await Lw().initializeIfNewUser(s),await j.setup(a.value),u.canvas=j.canvas,u.canvas.render_canvas_border=!1,r.spinner=!1,es().setPopoverRef(l.value),window.app=j,window.graph=j.graph,D.value=!0,N.setupEmptyGraphListener(),j.canvas.onSelectionChange=po(j.canvas.onSelectionChange,()=>u.updateSelectedItems()),g.customPalettes=s.get("Comfy.CustomColorPalettes"),await B.initializeWorkflow(),B.restoreWorkflowTabsState(),await B.loadTemplateFromUrlIfPresent();const{useReleaseStore:F}=await sa(async()=>{const{useReleaseStore:H}=await Promise.resolve().then(()=>qh);return{useReleaseStore:H}},void 0,import.meta.url);F().initialize(),te(()=>s.get("Comfy.Locale"),async()=>{await ke().execute("Comfy.RefreshNodeDefinitions"),await tt().reloadCurrentWorkflow()}),Ko(()=>fe().canvas,H=>{Re(H.canvas,"litegraph:set-graph",()=>{Me().updateActiveGraph()})},{immediate:!0}),t("ready")}),rt(()=>{N.cleanup()}),(F,W)=>(m(),T(le,null,[D.value?(m(),O(Od,{key:0},Ln({"graph-canvas-panel":E(()=>[f.value?(m(),O(_v,{key:0,class:"pointer-events-auto"})):A("",!0),D.value&&_.value&&x.value?(m(),O(aw,{key:1,class:"pointer-events-auto"})):A("",!0)]),_:2},[x.value?{name:"workflow-tabs",fn:E(()=>[L(zw),C.value==="Topbar"?(m(),T("div",Fw,[v(ar)()&&C.value!=="Topbar"?(m(),T("div",Uw)):A("",!0),y("div",Gw,[L(Qa),L(Ka)])])):A("",!0)]),key:"0"}:void 0,x.value?{name:"side-toolbar",fn:E(()=>[L(jy)]),key:"1"}:void 0,x.value?{name:"side-bar-panel",fn:E(()=>[y("div",Hw,[k.value?(m(),O(Jn,{key:0,extension:k.value},null,8,["extension"])):A("",!0)])]),key:"2"}:void 0,x.value?{name:"topmenu",fn:E(()=>[L(Bm)]),key:"3"}:void 0,x.value?{name:"bottom-panel",fn:E(()=>[L(Km)]),key:"4"}:void 0]),1024)):A("",!0),y("canvas",{id:"graph-canvas",ref_key:"canvasRef",ref:a,tabindex:"1",class:"absolute inset-0 size-full touch-none"},null,512),v(M)&&v(j).canvas&&D.value?(m(),O(Hb,{key:1,canvas:v(j).canvas,onTransformUpdate:v(I),onWheelCapture:v(w).forwardEventToCanvas},{default:E(()=>[(m(!0),T(le,null,we(P.value,H=>(m(),O(Aw,{key:H.id,"node-data":H,error:v(c).lastExecutionError?.node_id===H.id?"Execution error":null,"zoom-level":v(u).canvas?.ds?.scale||1,"data-node-id":H.id},null,8,["node-data","error","zoom-level","data-node-id"]))),128))]),_:1},8,["canvas","onTransformUpdate","onWheelCapture"])):A("",!0),S.value?(m(),O(Nv,{key:2})):A("",!0),L(zg,{ref_key:"nodeSearchboxPopoverRef",ref:l},null,512),D.value?(m(),T(le,{key:3},[L(mg),$.value?(m(),O(pg,{key:0})):A("",!0),L(_g),v(M)?A("",!0):(m(),O(tv,{key:1}))],64)):A("",!0)],64))}}),qw={class:"flex flex-auto flex-col items-start"},Kw={class:"my-4 text-lg font-medium"},Qw=K({__name:"RerouteMigrationToast",setup(e){const{t:o}=ce(),t=Wt(),a=Me(),l=n(async()=>{const s=j.graph.serialize(),i=ir(s);await j.loadGraphData(i,!1,!1,a.activeWorkflow),t.removeGroup("reroute-migration")},"migrateToLitegraphReroute");return(s,i)=>(m(),O(v(Fo),{group:"reroute-migration"},{message:E(()=>[y("div",qw,[y("div",Kw,z(v(o)("toastMessages.migrateToLitegraphReroute")),1),L(v(re),{class:"self-end",size:"small",label:v(o)("g.migrate"),severity:"warn",onClick:l},null,8,["label"])])]),_:1}))}}),Jw={class:"flex flex-auto items-center justify-between gap-4"},Yw={class:"whitespace-nowrap"},Zw={class:"flex flex-auto items-center justify-between gap-4"},Xw={class:"whitespace-nowrap"},e0=K({__name:"VueNodesMigrationToast",setup(e){const{t:o}=ce(),t=Wt(),a=Ya(),l=n(async()=>{await i(),t.removeGroup("vue-nodes-migration"),a.value=!0,r()},"switchBack"),s=n(()=>{a.value=!0,r()},"handleClose"),i=n(async()=>{await ne().set("Comfy.VueNodes.Enabled",!1)},"disableVueNodes"),r=n(()=>{wt().add({group:"vue-nodes-check-main-menu",severity:"info",life:5e3})},"showMainMenuToast");return(u,c)=>(m(),T(le,null,[L(v(Fo),{group:"vue-nodes-migration",position:"bottom-center",class:"w-auto",onClose:s},{message:E(()=>[y("div",Jw,[y("span",Yw,z(v(o)("vueNodesMigration.message")),1),L(v(re),{class:"whitespace-nowrap",size:"small",label:v(o)("vueNodesMigration.button"),text:"",onClick:l},null,8,["label"])])]),_:1}),L(v(Fo),{group:"vue-nodes-check-main-menu",position:"bottom-center",class:"w-auto"},{message:E(()=>[y("div",Zw,[y("span",Xw,z(v(o)("vueNodesMigrationMainMenu.message")),1)])]),_:1})],64))}}),Vs="ComfyUI",t0=" - ComfyUI",o0=n(()=>{const e=Je(),o=ne(),t=Me(),a=lt(),l=b(()=>e.isIdle?"":`[${Math.round(e.executionProgress*100)}%]`),s=b(()=>o.get("Comfy.UseNewMenu")!=="Disabled"),i=b(()=>o.get("Comfy.Workflow.AutoSave")==="after delay"),r=b(()=>!!t.activeWorkflow?.isModified),u=b(()=>!!t.activeWorkflow?.isPersisted),c=b(()=>a.shiftDown||i.value?!1:!!(!u.value||r.value)),p=b(()=>c.value?" *":""),g=b(()=>{const C=t.activeWorkflow?.filename;return C?p.value+C+t0:Vs}),d=b(()=>{const f=Object.entries(e.nodeProgressStates).filter(([_,M])=>M.state==="running");if(f.length===0)return"";if(f.length>1)return`${l.value}[${f.length} ${Z("g.nodesRunning","nodes running")}]`;const[S,$]=f[0],k=Math.round($.value/$.max*100),x=e.activePrompt?.workflow?.changeTracker?.activeState.nodes.find(_=>String(_.id)===S)?.type||"Node";return`${l.value}[${k}%] ${x}`}),w=b(()=>l.value+(s.value?g.value:Vs)),h=b(()=>d.value||w.value);Tl(h)},"useBrowserTabTitle"),n0={},s0={class:"size-full bg-modal-panel-background pr-6 pb-8 pl-4"};function a0(e,o){return m(),T("div",s0,[Pe(e.$slots,"default")])}n(a0,"_sfc_render");const l0=Se(n0,[["render",a0]]),i0={class:"text-neutral text-base"},r0={class:"flex gap-2"},u0={class:"relative flex gap-2 px-6 pb-4"},c0=K({__name:"SampleModelSelector",props:{onClose:{type:Function}},setup(e){const o=R([{name:"Vue",value:"vue"},{name:"React",value:"react"},{name:"Angular",value:"angular"},{name:"Svelte",value:"svelte"}]),t=R([{name:"Project A",value:"proj-a"},{name:"Project B",value:"proj-b"},{name:"Project C",value:"proj-c"}]),a=R([{name:"Popular",value:"popular"},{name:"Latest",value:"latest"},{name:"A  Z",value:"az"}]),l=R([{id:"installed",label:"Installed",icon:"icon-[lucide--download]"},{title:"TAGS",items:[{id:"tag-sd15",label:"SD 1.5",icon:"icon-[lucide--tag]"},{id:"tag-sdxl",label:"SDXL",icon:"icon-[lucide--tag]"},{id:"tag-utility",label:"Utility",icon:"icon-[lucide--tag]"}]},{title:"CATEGORIES",items:[{id:"cat-models",label:"Models",icon:"icon-[lucide--layers]"},{id:"cat-nodes",label:"Nodes",icon:"icon-[lucide--grid-3x3]"}]}]);Vn(Xo,e.onClose);const s=R(""),i=R(""),r=R([]),u=R([]),c=R("popular"),p=R("installed"),g=b(()=>Kn());return(d,w)=>(m(),O(jn,{"content-title":d.$t("assetBrowser.checkpoints")},{leftPanel:E(()=>[L(qn,{modelValue:p.value,"onUpdate:modelValue":w[0]||(w[0]=h=>p.value=h),"nav-items":l.value},{"header-icon":E(()=>w[6]||(w[6]=[y("i",{class:"text-neutral icon-[lucide--puzzle]"},null,-1)])),"header-title":E(()=>[y("span",i0,z(d.$t("g.title")),1)]),_:1},8,["modelValue","nav-items"])]),header:E(()=>[L(Qo,{modelValue:s.value,"onUpdate:modelValue":w[1]||(w[1]=h=>s.value=h),size:"lg",class:"max-w-[384px]"},null,8,["modelValue"])]),"header-right-area":E(()=>[y("div",r0,[L(Fe,{type:"primary",label:d.$t("g.upload"),onClick:n(()=>{},"onClick")},{icon:E(()=>w[7]||(w[7]=[y("i",{class:"icon-[lucide--upload]"},null,-1)])),_:1},8,["label"]),L(rr,null,{default:E(({close:h})=>[L(Fe,{type:"secondary",label:d.$t("g.settings"),onClick:n(()=>{h()},"onClick")},{icon:E(()=>w[8]||(w[8]=[y("i",{class:"icon-[lucide--download]"},null,-1)])),_:2},1032,["label","onClick"]),L(Fe,{type:"primary",label:d.$t("g.profile"),onClick:n(()=>{h()},"onClick")},{icon:E(()=>w[9]||(w[9]=[y("i",{class:"icon-[lucide--scroll]"},null,-1)])),_:2},1032,["label","onClick"])]),_:1})])]),contentFilter:E(()=>[y("div",u0,[L(Lt,{modelValue:r.value,"onUpdate:modelValue":w[2]||(w[2]=h=>r.value=h),"search-query":i.value,"onUpdate:searchQuery":w[3]||(w[3]=h=>i.value=h),class:"w-[250px]",label:d.$t("assetBrowser.selectFrameworks"),options:o.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},null,8,["modelValue","search-query","label","options"]),L(Lt,{modelValue:u.value,"onUpdate:modelValue":w[4]||(w[4]=h=>u.value=h),label:d.$t("assetBrowser.selectProjects"),options:t.value},null,8,["modelValue","label","options"]),L(en,{modelValue:c.value,"onUpdate:modelValue":w[5]||(w[5]=h=>c.value=h),label:d.$t("assetBrowser.sortingType"),options:a.value,class:"w-[135px]"},{icon:E(()=>w[10]||(w[10]=[y("i",{class:"icon-[lucide--filter]"},null,-1)])),_:1},8,["modelValue","label","options"])])]),content:E(()=>[y("div",{style:pe(g.value)},[(m(),T(le,null,we(100,h=>L(Ro,{key:h,size:"regular"},{top:E(()=>[L(Do,{ratio:"landscape"},{default:E(()=>w[11]||(w[11]=[y("div",{class:"h-full w-full bg-blue-500"},null,-1)])),"top-right":E(()=>[L(Ee,{class:"!bg-white !text-neutral-900",onClick:n(()=>{},"onClick")},{default:E(()=>w[12]||(w[12]=[y("i",{class:"icon-[lucide--info]"},null,-1)])),_:1})]),"bottom-right":E(()=>[L(Lo,{label:"png"}),L(Lo,{label:"1.2 MB"}),L(Lo,{label:"LoRA"},{icon:E(()=>w[13]||(w[13]=[y("i",{class:"icon-[lucide--folder]"},null,-1)])),_:1})]),_:1})]),bottom:E(()=>[L(Ao)]),_:2},1024)),64))],4)]),rightPanel:E(()=>[L(l0)]),_:1},8,["content-title"]))}}),Ws="global-model-selector",d0=n(()=>{const e=it(),o=St();function t(){o.closeDialog({key:Ws})}n(t,"hide");function a(){e.showLayoutDialog({key:Ws,component:c0,props:{onClose:t}})}return n(a,"show"),{show:a,hide:t}},"useModelSelectorDialog");function p0(e,o){const t=ur.safeParse(e);if(!t.success){const C=t.error.errors.map(f=>`${f.path.join(".")}: ${f.message}`).join(", ");return console.error("Invalid asset item:",C),{success:!1,error:{code:"INVALID_ASSET",message:"Asset schema validation failed",assetId:e.id,details:{validationErrors:C}}}}const a=t.data,l=a.user_metadata;if(!l)return console.error(`Asset ${a.id} missing required user_metadata`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset missing required user_metadata",assetId:a.id}};const s=l.filename;if(typeof s!="string"||s.length===0)return console.error(`Asset ${a.id} has invalid user_metadata.filename (expected non-empty string, got ${typeof s})`),{success:!1,error:{code:"INVALID_ASSET",message:`Invalid filename (expected non-empty string, got ${typeof s})`,assetId:a.id}};if(a.tags.length===0)return console.error(`Asset ${a.id} has no tags defined (expected at least one category tag)`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset has no tags defined",assetId:a.id}};const i=a.tags.find(C=>C!==vs&&C!==gs);if(!i)return console.error(`Asset ${a.id} has no valid category tag. Available tags: ${a.tags.join(", ")} (expected tag other than '${vs}' or '${gs}')`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset has no valid category tag",assetId:a.id,details:{availableTags:a.tags}}};const u=Wn().getNodeProvider(i);if(!u)return console.error(`No node provider registered for category: ${i}`),{success:!1,error:{code:"NO_PROVIDER",message:`No node provider registered for category: ${i}`,assetId:a.id,details:{category:i}}};const p=yo().getCanvasCenter(),g=ve.createNode(u.nodeDef.name,u.nodeDef.display_name,{pos:p});if(!g)return console.error(`Failed to create node for type: ${u.nodeDef.name}`),{success:!1,error:{code:"NODE_CREATION_FAILED",message:`Failed to create node for type: ${u.nodeDef.name}`,assetId:a.id,details:{nodeType:u.nodeDef.name}}};const d=Me(),w=d.isSubgraphActive?d.activeSubgraph:j.canvas.graph;if(!w)return console.error("No active graph available"),{success:!1,error:{code:"NO_GRAPH",message:"No active graph available",assetId:a.id}};const h=g.widgets?.find(C=>C.name===u.key);return h?(w.add(g),h.value=s,{success:!0,value:g}):(console.error(`Widget ${u.key} not found on node ${u.nodeDef.name}`),{success:!1,error:{code:"MISSING_WIDGET",message:`Widget ${u.key} not found on node ${u.nodeDef.name}`,assetId:a.id,details:{widgetName:u.key,nodeType:u.nodeDef.name}}})}n(p0,"createModelNodeFromAsset");const Mo={DISTRIBUTION:"tf_42243568391700",ANONYMOUS_EMAIL:"tf_anonymous_requester_email",EMAIL:"tf_40029135130388",USER_ID:"tf_42515251051412"},f0="https://support.comfy.org/hc/en-us/requests/new";function m0(e){const o=new URLSearchParams({[Mo.DISTRIBUTION]:"oss"});return e?.userEmail&&(o.append(Mo.ANONYMOUS_EMAIL,e.userEmail),o.append(Mo.EMAIL,e.userEmail)),e?.userId&&o.append(Mo.USER_ID,e.userId),`${f0}?${o.toString()}`}n(m0,"buildSupportUrl");const{isActiveSubscription:hn,showSubscriptionDialog:yn}=On(),Io="1.22.2";function v0(){const e=tt(),o=Me(),t=it(),a=ft(),l=ga(),s=wt(),i=fe(),r=Je(),{staticUrls:u,buildDocsUrl:c}=Zt(),p=Yt(),{getSelectedNodes:g,toggleSelectedNodesMode:d}=Yo(),w=n(()=>o.activeWorkflow?.changeTracker,"getTracker"),h=n(f=>{const S=g();if(S.length===0)return;const $=ne().get("Comfy.SnapToGrid.GridSize");S.forEach(k=>{k.pos=f(k.pos,$)}),j.canvas.state.selectionChanged=!0,j.canvas.setDirty(!0,!0)},"moveSelectedNodes");return[{id:"Comfy.NewBlankWorkflow",icon:"pi pi-plus",label:"New Blank Workflow",menubarLabel:"New",category:"essentials",function:n(async()=>{j.graph._nodes.length>0,await e.loadBlankWorkflow()},"function")},{id:"Comfy.OpenWorkflow",icon:"pi pi-folder-open",label:"Open Workflow",menubarLabel:"Open",category:"essentials",function:n(()=>{j.ui.loadFile()},"function")},{id:"Comfy.LoadDefaultWorkflow",icon:"pi pi-code",label:"Load Default Workflow",function:n(async()=>{j.graph._nodes.length>0,await e.loadDefaultWorkflow()},"function")},{id:"Comfy.SaveWorkflow",icon:"pi pi-save",label:"Save Workflow",menubarLabel:"Save",category:"essentials",function:n(async()=>{const f=Me().activeWorkflow;f&&await e.saveWorkflow(f)},"function")},{id:"Comfy.PublishSubgraph",icon:"pi pi-save",label:"Publish Subgraph",menubarLabel:"Publish",function:n(async()=>{await fa().publishSubgraph()},"function")},{id:"Comfy.SaveWorkflowAs",icon:"pi pi-save",label:"Save Workflow As",menubarLabel:"Save As",category:"essentials",function:n(async()=>{const f=Me().activeWorkflow;f&&await e.saveWorkflowAs(f)},"function")},{id:"Comfy.ExportWorkflow",icon:"pi pi-download",label:"Export Workflow",menubarLabel:"Export",category:"essentials",function:n(async()=>{await e.exportWorkflow("workflow","workflow")},"function")},{id:"Comfy.ExportWorkflowAPI",icon:"pi pi-download",label:"Export Workflow (API Format)",menubarLabel:"Export (API)",function:n(async()=>{await e.exportWorkflow("workflow_api","output")},"function")},{id:"Comfy.Undo",icon:"pi pi-undo",label:"Undo",category:"essentials",function:n(async()=>{await w()?.undo?.()},"function")},{id:"Comfy.Redo",icon:"pi pi-refresh",label:"Redo",category:"essentials",function:n(async()=>{await w()?.redo?.()},"function")},{id:"Comfy.ClearWorkflow",icon:"pi pi-trash",label:"Clear Workflow",category:"essentials",function:n(()=>{if(!ne().get("Comfy.ConfirmClear")||confirm("Clear workflow?")){if(j.clean(),j.canvas.subgraph){const S=j.canvas.subgraph;cr(S).forEach(k=>S.remove(k))}he.dispatchCustomEvent("graphCleared")}},"function")},{id:"Comfy.Canvas.ResetView",icon:"pi pi-expand",label:"Reset View",function:n(()=>{yo().resetView()},"function")},{id:"Comfy.OpenClipspace",icon:"pi pi-clipboard",label:"Clipspace",function:n(()=>{j.openClipspace()},"function")},{id:"Comfy.RefreshNodeDefinitions",icon:"pi pi-refresh",label:"Refresh Node Definitions",category:"essentials",function:n(async()=>{await j.refreshComboInNodes()},"function")},{id:"Comfy.Interrupt",icon:"pi pi-stop",label:"Interrupt",category:"essentials",function:n(async()=>{await he.interrupt(r.activePromptId),s.add({severity:"info",summary:Z("g.interrupted"),detail:Z("toastMessages.interrupted"),life:1e3})},"function")},{id:"Comfy.ClearPendingTasks",icon:"pi pi-stop",label:"Clear Pending Tasks",category:"essentials",function:n(async()=>{await xt().clear(["queue"]),s.add({severity:"info",summary:Z("g.confirmed"),detail:Z("toastMessages.pendingTasksDeleted"),life:3e3})},"function")},{id:"Comfy.BrowseTemplates",icon:"pi pi-folder-open",label:"Browse Templates",function:n(()=>{ts().show()},"function")},{id:"Comfy.Canvas.ZoomIn",icon:"pi pi-plus",label:"Zoom In",category:"view-controls",function:n(()=>{const f=j.canvas.ds;f.changeScale(f.scale*1.1,f.element?[f.element.width/2,f.element.height/2]:void 0),j.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ZoomOut",icon:"pi pi-minus",label:"Zoom Out",category:"view-controls",function:n(()=>{const f=j.canvas.ds;f.changeScale(f.scale/1.1,f.element?[f.element.width/2,f.element.height/2]:void 0),j.canvas.setDirty(!0,!0)},"function")},{id:"Experimental.ToggleVueNodes",label:n(()=>`Experimental: ${ne().get("Comfy.VueNodes.Enabled")?"Disable":"Enable"} Nodes 2.0`,"label"),function:n(async()=>{const f=ne(),S=f.get("Comfy.VueNodes.Enabled")??!1;await f.set("Comfy.VueNodes.Enabled",!S)},"function")},{id:"Comfy.Canvas.FitView",icon:"pi pi-expand",label:"Fit view to selected nodes",menubarLabel:"Zoom to fit",category:"view-controls",function:n(()=>{if(ne().get("Comfy.VueNodes.Enabled")){const $=fe().selectedNodeIds,k=Ce.getAllNodes().value,x=$.size>0?Array.from($).map(I=>k.get(I)).filter(I=>I!=null):Array.from(k.values()),_=dr(x);if(!_){s.add({severity:"error",summary:Z("toastMessages.emptyCanvas"),life:3e3});return}const M=[_.x,_.y,_.width,_.height],N=n(()=>j.canvas.setDirty(!0,!0),"setDirty");j.canvas.ds.animateToBounds(M,N)}else{if(j.canvas.empty){s.add({severity:"error",summary:Z("toastMessages.emptyCanvas"),life:3e3});return}j.canvas.fitViewToSelectionAnimated()}},"function")},{id:"Comfy.Canvas.ToggleLock",icon:"pi pi-lock",label:"Canvas Toggle Lock",category:"view-controls",function:n(()=>{j.canvas.state.readOnly=!j.canvas.state.readOnly},"function")},{id:"Comfy.Canvas.Lock",icon:"pi pi-lock",label:"Lock Canvas",category:"view-controls",function:n(()=>{j.canvas.state.readOnly=!0},"function")},{id:"Comfy.Canvas.Unlock",icon:"pi pi-lock-open",label:"Unlock Canvas",function:n(()=>{j.canvas.state.readOnly=!1},"function")},{id:"Comfy.Canvas.ToggleLinkVisibility",icon:"pi pi-eye",label:"Canvas Toggle Link Visibility",menubarLabel:"Node Links",versionAdded:"1.3.6",function:(()=>{const f=ne();let S=ve.SPLINE_LINK;return async()=>{const $=f.get("Comfy.LinkRenderMode");$===ve.HIDDEN_LINK?await f.set("Comfy.LinkRenderMode",S):(S=$,await f.set("Comfy.LinkRenderMode",ve.HIDDEN_LINK))}})(),active:n(()=>ne().get("Comfy.LinkRenderMode")!==ve.HIDDEN_LINK,"active")},{id:"Comfy.Canvas.ToggleMinimap",icon:"pi pi-map",label:"Canvas Toggle Minimap",menubarLabel:"Minimap",versionAdded:"1.24.1",function:n(async()=>{const f=ne();await f.set("Comfy.Minimap.Visible",!f.get("Comfy.Minimap.Visible"))},"function"),active:n(()=>ne().get("Comfy.Minimap.Visible"),"active")},{id:"Comfy.QueuePrompt",icon:"pi pi-play",label:"Queue Prompt",versionAdded:"1.3.7",category:"essentials",function:n(async f=>{if(!hn.value){yn();return}const S=co().batchCount;await j.queuePrompt(0,S)},"function")},{id:"Comfy.QueuePromptFront",icon:"pi pi-play",label:"Queue Prompt (Front)",versionAdded:"1.3.7",category:"essentials",function:n(async f=>{if(!hn.value){yn();return}const S=co().batchCount;await j.queuePrompt(-1,S)},"function")},{id:"Comfy.QueueSelectedOutputNodes",icon:"pi pi-play",label:"Queue Selected Output Nodes",versionAdded:"1.19.6",function:n(async f=>{if(!hn.value){yn();return}const S=co().batchCount,$=g(),k=Hn($);if(k.length===0){s.add({severity:"error",summary:Z("toastMessages.nothingToQueue"),detail:Z("toastMessages.pleaseSelectOutputNodes"),life:3e3});return}const x=pr(k);if(x.length===0){s.add({severity:"error",summary:Z("toastMessages.failedToQueue"),detail:Z("toastMessages.failedExecutionPathResolution"),life:3e3});return}await j.queuePrompt(0,S,x)},"function")},{id:"Comfy.ShowSettingsDialog",icon:"pi pi-cog",label:"Show Settings Dialog",versionAdded:"1.3.7",category:"view-controls",function:n(()=>{t.showSettingsDialog()},"function")},{id:"Comfy.Graph.GroupSelectedNodes",icon:"pi pi-sitemap",label:"Group Selected Nodes",versionAdded:"1.3.7",category:"essentials",function:n(()=>{const{canvas:f}=j;if(!f.selectedItems?.size){s.add({severity:"error",summary:Z("toastMessages.nothingToGroup"),detail:Z("toastMessages.pleaseSelectNodesToGroup"),life:3e3});return}const S=new At,$=ne().get("Comfy.GroupSelectedNodes.Padding");S.resizeTo(f.selectedItems,$),f.graph?.add(S),S.recomputeInsideNodes(),Zo().titleEditorTarget=S},"function")},{id:"Workspace.NextOpenedWorkflow",icon:"pi pi-step-forward",label:"Next Opened Workflow",versionAdded:"1.3.9",function:n(async()=>{await e.loadNextOpenedWorkflow()},"function")},{id:"Workspace.PreviousOpenedWorkflow",icon:"pi pi-step-backward",label:"Previous Opened Workflow",versionAdded:"1.3.9",function:n(async()=>{await e.loadPreviousOpenedWorkflow()},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Mute",icon:"pi pi-volume-off",label:"Mute/Unmute Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{d(Ae.NEVER),j.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Bypass",icon:"pi pi-shield",label:"Bypass/Unbypass Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{d(Ae.BYPASS),j.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Pin",icon:"pi pi-pin",label:"Pin/Unpin Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{g().forEach(f=>{f.pin(!f.pinned)}),j.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelected.Pin",icon:"pi pi-pin",label:"Pin/Unpin Selected Items",versionAdded:"1.3.33",function:n(()=>{for(const f of j.canvas.selectedItems)(f instanceof pt||f instanceof At)&&f.pin(!f.pinned);j.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.Resize",icon:"pi pi-minus",label:"Resize Selected Nodes",versionAdded:"",function:n(()=>{g().forEach(f=>{const S=f.computeSize();f.setSize([S[0],S[1]])}),j.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Collapse",icon:"pi pi-minus",label:"Collapse/Expand Selected Nodes",versionAdded:"1.3.11",function:n(()=>{g().forEach(f=>{f.collapse()}),j.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.ToggleTheme",icon:"pi pi-moon",label:"Toggle Theme (Dark/Light)",versionAdded:"1.3.12",function:(()=>{let f=vr.id,S=gr.id;return async()=>{const $=ne(),k=a.completedActivePalette;k.light_theme?(S=k.id,await $.set("Comfy.ColorPalette",f)):(f=k.id,await $.set("Comfy.ColorPalette",S))}})()},{id:"Workspace.ToggleBottomPanel",icon:"pi pi-list",label:"Toggle Bottom Panel",menubarLabel:"Bottom Panel",versionAdded:"1.3.22",category:"view-controls",function:n(()=>{p.toggleBottomPanel()},"function"),active:n(()=>p.bottomPanelVisible,"active")},{id:"Workspace.ToggleFocusMode",icon:"pi pi-eye",label:"Toggle Focus Mode",menubarLabel:"Focus Mode",versionAdded:"1.3.27",category:"view-controls",function:n(()=>{lt().toggleFocusMode()},"function"),active:n(()=>lt().focusMode,"active")},{id:"Comfy.Graph.FitGroupToContents",icon:"pi pi-expand",label:"Fit Group To Contents",versionAdded:"1.4.9",function:n(()=>{for(const f of j.canvas.selectedItems)if(f instanceof At){f.recomputeInsideNodes();const S=ne().get("Comfy.GroupSelectedNodes.Padding");f.resizeTo(f.children,S),j.graph.change()}},"function")},{id:"Comfy.Help.OpenComfyUIIssues",icon:"pi pi-github",label:"Open ComfyUI Issues",menubarLabel:"ComfyUI Issues",versionAdded:"1.5.5",function:n(()=>{window.open(u.githubIssues,"_blank")},"function")},{id:"Comfy.Help.OpenComfyUIDocs",icon:"pi pi-info-circle",label:"Open ComfyUI Docs",menubarLabel:"ComfyUI Docs",versionAdded:"1.5.5",function:n(()=>{window.open(c("/",{includeLocale:!0}),"_blank")},"function")},{id:"Comfy.Help.OpenComfyOrgDiscord",icon:"pi pi-discord",label:"Open Comfy-Org Discord",menubarLabel:"Comfy-Org Discord",versionAdded:"1.5.5",function:n(()=>{window.open(u.discord,"_blank")},"function")},{id:"Workspace.SearchBox.Toggle",icon:"pi pi-search",label:"Toggle Search Box",versionAdded:"1.5.7",function:n(()=>{es().toggleVisible()},"function")},{id:"Comfy.Help.AboutComfyUI",icon:"pi pi-info-circle",label:"Open About ComfyUI",menubarLabel:"About ComfyUI",versionAdded:"1.6.4",function:n(()=>{t.showSettingsDialog("about")},"function")},{id:"Comfy.DuplicateWorkflow",icon:"pi pi-clone",label:"Duplicate Current Workflow",versionAdded:"1.6.15",function:n(async()=>{await e.duplicateWorkflow(o.activeWorkflow)},"function")},{id:"Workspace.CloseWorkflow",icon:"pi pi-times",label:"Close Current Workflow",versionAdded:"1.7.3",function:n(async()=>{o.activeWorkflow&&await e.closeWorkflow(o.activeWorkflow)},"function")},{id:"Comfy.ContactSupport",icon:"pi pi-question",label:"Contact Support",versionAdded:"1.17.8",function:n(()=>{const{userEmail:f,resolvedUserInfo:S}=Xt(),$=m0({userEmail:f.value,userId:S.value?.id});window.open($,"_blank")},"function")},{id:"Comfy.Help.OpenComfyUIForum",icon:"pi pi-comments",label:"Open ComfyUI Forum",menubarLabel:"ComfyUI Forum",versionAdded:"1.8.2",function:n(()=>{window.open(u.forum,"_blank")},"function")},{id:"Comfy.Canvas.DeleteSelectedItems",icon:"pi pi-trash",label:"Delete Selected Items",versionAdded:"1.10.5",function:n(()=>{j.canvas.deleteSelected(),j.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Manager.CustomNodesManager.ShowCustomNodesMenu",icon:"pi pi-puzzle",label:"Custom Nodes Manager",versionAdded:"1.12.10",function:n(async()=>{await _t().openManager({showToastOnLegacyError:!0})},"function")},{id:"Comfy.Manager.ShowUpdateAvailablePacks",icon:"pi pi-sync",label:"Check for Custom Node Updates",versionAdded:"1.17.0",function:n(async()=>{const f=_t();if(f.managerUIState.value===fr.DISABLED){s.add({severity:"error",summary:Z("g.error"),detail:Z("manager.notAvailable"),life:3e3});return}await f.openManager({initialTab:ro.UpdateAvailable,showToastOnLegacyError:!1})},"function")},{id:"Comfy.Manager.ShowMissingPacks",icon:"pi pi-exclamation-circle",label:"Install Missing Custom Nodes",versionAdded:"1.17.0",function:n(async()=>{await _t().openManager({initialTab:ro.Missing,showToastOnLegacyError:!1})},"function")},{id:"Comfy.Manager.ToggleManagerProgressDialog",icon:"pi pi-spinner",label:"Toggle the Custom Nodes Manager Progress Bar",versionAdded:"1.13.9",function:n(()=>{t.toggleManagerProgressDialog()},"function")},{id:"Comfy.User.OpenSignInDialog",icon:"pi pi-user",label:"Open Sign In Dialog",versionAdded:"1.17.6",function:n(async()=>{await t.showSignInDialog()},"function")},{id:"Comfy.User.SignOut",icon:"pi pi-sign-out",label:"Sign Out",versionAdded:"1.18.1",function:n(async()=>{await l.logout()},"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Up",icon:"pi pi-arrow-up",label:"Move Selected Nodes Up",versionAdded:Io,function:n(()=>h(([f,S],$)=>[f,S-$]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Down",icon:"pi pi-arrow-down",label:"Move Selected Nodes Down",versionAdded:Io,function:n(()=>h(([f,S],$)=>[f,S+$]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Left",icon:"pi pi-arrow-left",label:"Move Selected Nodes Left",versionAdded:Io,function:n(()=>h(([f,S],$)=>[f-$,S]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Right",icon:"pi pi-arrow-right",label:"Move Selected Nodes Right",versionAdded:Io,function:n(()=>h(([f,S],$)=>[f+$,S]),"function")},{id:"Comfy.Graph.ConvertToSubgraph",icon:"icon-[lucide--shrink]",label:"Convert Selection to Subgraph",versionAdded:"1.20.1",category:"essentials",function:n(()=>{const f=i.getCanvas(),S=f.subgraph??f.graph;if(!S)throw new TypeError("Canvas has no graph or subgraph set.");const $=S.convertToSubgraph(f.selectedItems);if(!$){s.add({severity:"error",summary:Z("toastMessages.cannotCreateSubgraph"),detail:Z("toastMessages.failedToConvertToSubgraph"),life:3e3});return}const{node:k}=$;f.select(k),i.updateSelectedItems()},"function")},{id:"Comfy.Graph.UnpackSubgraph",icon:"icon-[lucide--expand]",label:"Unpack the selected Subgraph",versionAdded:"1.26.3",function:n(()=>{const f=i.getCanvas(),S=f.subgraph??f.graph;if(!S)throw new TypeError("Canvas has no graph or subgraph set.");const $=j.canvas.selectedItems.values().next().value;$ instanceof Dt&&(Ot().revokeSubgraphPreviews($),S.unpackSubgraph($))},"function")},{id:"Comfy.Graph.EditSubgraphWidgets",label:"Edit Subgraph Widgets",icon:"icon-[lucide--settings-2]",versionAdded:"1.28.5",function:ya},{id:"Comfy.Graph.ToggleWidgetPromotion",icon:"icon-[lucide--arrow-left-right]",label:"Toggle promotion of hovered widget",versionAdded:"1.30.1",function:mr},{id:"Comfy.OpenManagerDialog",icon:"mdi mdi-puzzle-outline",label:"Manager",function:n(async()=>{await _t().openManager({initialTab:ro.All,showToastOnLegacyError:!1})},"function")},{id:"Comfy.ToggleHelpCenter",icon:"pi pi-question-circle",label:"Help Center",function:n(()=>{Tn().toggle()},"function"),active:n(()=>Tn().isVisible,"active")},{id:"Comfy.ToggleCanvasInfo",icon:"pi pi-info-circle",label:"Canvas Performance",function:n(async()=>{const f=ne(),S=f.get("Comfy.Graph.CanvasInfo");await f.set("Comfy.Graph.CanvasInfo",!S)},"function"),active:n(()=>ne().get("Comfy.Graph.CanvasInfo"),"active")},{id:"Workspace.ToggleBottomPanel.Shortcuts",icon:"pi pi-key",label:"Show Keybindings Dialog",versionAdded:"1.24.1",category:"view-controls",function:n(()=>{p.togglePanel("shortcuts")},"function")},{id:"Comfy.Graph.ExitSubgraph",icon:"pi pi-arrow-up",label:"Exit Subgraph",versionAdded:"1.20.1",function:n(()=>{const f=fe().getCanvas(),S=Bn();f.graph&&f.setGraph(S.navigationStack.at(-2)??f.graph.rootGraph)},"function")},{id:"Comfy.Dev.ShowModelSelector",icon:"pi pi-box",label:"Show Model Selector (Dev)",versionAdded:"1.26.2",category:"view-controls",function:n(()=>{d0().show()},"function")},{id:"Comfy.Manager.CustomNodesManager.ShowLegacyCustomNodesMenu",icon:"pi pi-bars",label:"Custom Nodes (Legacy)",versionAdded:"1.16.4",function:n(async()=>{await _t().openManager({legacyCommand:"Comfy.Manager.CustomNodesManager.ToggleVisibility",showToastOnLegacyError:!0,isLegacyOnly:!0})},"function")},{id:"Comfy.Manager.ShowLegacyManagerMenu",icon:"mdi mdi-puzzle",label:"Manager Menu (Legacy)",versionAdded:"1.16.4",function:n(async()=>{await _t().openManager({showToastOnLegacyError:!0,isLegacyOnly:!0})},"function")},{id:"Comfy.Memory.UnloadModels",icon:"mdi mdi-vacuum-outline",label:"Unload Models",versionAdded:"1.16.4",function:n(async()=>{if(!ne().get("Comfy.Memory.AllowManualUnload")){wt().add({severity:"error",summary:Z("g.error"),detail:Z("g.commandProhibited",{command:"Comfy.Memory.UnloadModels"}),life:3e3});return}await he.freeMemory({freeExecutionCache:!1})},"function")},{id:"Comfy.Memory.UnloadModelsAndExecutionCache",icon:"mdi mdi-vacuum-outline",label:"Unload Models and Execution Cache",versionAdded:"1.16.4",function:n(async()=>{if(!ne().get("Comfy.Memory.AllowManualUnload")){wt().add({severity:"error",summary:Z("g.error"),detail:Z("g.commandProhibited",{command:"Comfy.Memory.UnloadModelsAndExecutionCache"}),life:3e3});return}await he.freeMemory({freeExecutionCache:!0})},"function")},{id:"Comfy.BrowseModelAssets",icon:"pi pi-folder-open",label:"Experimental: Browse Model Assets",versionAdded:"1.28.3",function:n(async()=>{if(!ne().get("Comfy.Assets.UseAssetAPI")){if(!await t.confirm({title:"Enable Asset API",message:"The Asset API is currently disabled. Would you like to enable it?",type:"default"}))return;await ne().set("Comfy.Assets.UseAssetAPI",!0),await e.reloadCurrentWorkflow()}await Wc().browse({assetType:"models",title:Z("sideToolbar.modelLibrary"),onAssetSelected:n(S=>{const $=p0(S);$.success||(s.add({severity:"error",summary:Z("g.error"),detail:Z("assetBrowser.failedToCreateNode")}),console.error("Node creation failed:",$.error))},"onAssetSelected")})},"function")},{id:"Comfy.ToggleAssetAPI",icon:"pi pi-database",label:n(()=>`Experimental: ${ne().get("Comfy.Assets.UseAssetAPI")?"Disable":"Enable"} AssetAPI`,"label"),function:n(async()=>{const f=ne(),S=f.get("Comfy.Assets.UseAssetAPI")??!1;await f.set("Comfy.Assets.UseAssetAPI",!S),await tt().reloadCurrentWorkflow()},"function")},{id:"Comfy.ToggleLinear",icon:"pi pi-database",label:"toggle linear mode",function:n(()=>i.linearMode=!i.linearMode,"function")}].map(f=>({...f,source:"System"}))}n(v0,"useCoreCommands");const g0=n(()=>{const e="/assets/images/favicon_progress_16x16/frame_9.png",o=Nl(e),t=Je(),a=10;te([()=>t.executionProgress,()=>t.isIdle],([l,s])=>{if(s)o.value=e;else{const i=Math.min(Math.max(0,Math.floor(l*a)),a-1);o.value=`/assets/images/favicon_progress_16x16/frame_${i}.png`}})},"useProgressFavicon");var Mn=(e=>(e.NoPreviews="none",e.Auto="auto",e.Latent2RGB="latent2rgb",e.TAESD="taesd",e))(Mn||{}),In=(e=>(e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.CRITICAL="CRITICAL",e))(In||{}),Pn=(e=>(e.MD5="md5",e.SHA1="sha1",e.SHA256="sha256",e.SHA512="sha512",e))(Pn||{}),Gt=(e=>(e.Auto="auto",e.Disable="disable",e.Enable="enable",e))(Gt||{}),$e=(e=>(e.AUTO="auto",e.FP64="fp64",e.FP32="fp32",e.FP16="fp16",e.BF16="bf16",e.FP8E4M3FN="fp8_e4m3fn",e.FP8E5M2="fp8_e5m2",e))($e||{}),Vo=(e=>(e.Auto="auto",e.Split="split",e.Quad="quad",e.Pytorch="pytorch",e))(Vo||{}),Wo=(e=>(e.Auto="auto",e.GPUOnly="gpu-only",e.HighVram="highvram",e.NormalVram="normalvram",e.LowVram="lowvram",e.NoVram="novram",e.CPU="cpu",e))(Wo||{});const h0=[{id:"listen",name:"Host: The IP address to listen on",category:["Network"],type:"text",defaultValue:"127.0.0.1"},{id:"port",name:"Port: The port to listen on",category:["Network"],type:"number",defaultValue:8e3},{id:"tls-keyfile",name:"TLS Key File: Path to TLS key file for HTTPS",category:["Network"],type:"text",defaultValue:""},{id:"tls-certfile",name:"TLS Certificate File: Path to TLS certificate file for HTTPS",category:["Network"],type:"text",defaultValue:""},{id:"enable-cors-header",name:'Enable CORS header: Use "*" for all origins or specify domain',category:["Network"],type:"text",defaultValue:""},{id:"max-upload-size",name:"Maximum upload size (MB)",category:["Network"],type:"number",defaultValue:100},{id:"cuda-device",name:"CUDA device index to use",category:["CUDA"],type:"number",defaultValue:null},{id:"cuda-malloc",name:"Use CUDA malloc for memory allocation",category:["CUDA"],type:"combo",options:Object.values(Gt),defaultValue:Gt.Auto,getValue:n(e=>{switch(e){case Gt.Auto:return{};case Gt.Enable:return{"cuda-malloc":!0};case Gt.Disable:return{"disable-cuda-malloc":!0}}},"getValue")},{id:"global-precision",name:"Global floating point precision",category:["Inference"],type:"combo",options:[$e.AUTO,$e.FP32,$e.FP16],defaultValue:$e.AUTO,tooltip:"Global floating point precision",getValue:n(e=>{switch(e){case $e.AUTO:return{};case $e.FP32:return{"force-fp32":!0};case $e.FP16:return{"force-fp16":!0};default:return{}}},"getValue")},{id:"unet-precision",name:"UNET precision",category:["Inference"],type:"combo",options:[$e.AUTO,$e.FP64,$e.FP32,$e.FP16,$e.BF16,$e.FP8E4M3FN,$e.FP8E5M2],defaultValue:$e.AUTO,tooltip:"UNET precision",getValue:n(e=>{switch(e){case $e.AUTO:return{};default:return{[`${e.toLowerCase()}-unet`]:!0}}},"getValue")},{id:"vae-precision",name:"VAE precision",category:["Inference"],type:"combo",options:[$e.AUTO,$e.FP16,$e.FP32,$e.BF16],defaultValue:$e.AUTO,tooltip:"VAE precision",getValue:n(e=>{switch(e){case $e.AUTO:return{};default:return{[`${e.toLowerCase()}-vae`]:!0}}},"getValue")},{id:"cpu-vae",name:"Run VAE on CPU",category:["Inference"],type:"boolean",defaultValue:!1},{id:"text-encoder-precision",name:"Text Encoder precision",category:["Inference"],type:"combo",options:[$e.AUTO,$e.FP8E4M3FN,$e.FP8E5M2,$e.FP16,$e.FP32],defaultValue:$e.AUTO,tooltip:"Text Encoder precision",getValue:n(e=>{switch(e){case $e.AUTO:return{};default:return{[`${e.toLowerCase()}-text-enc`]:!0}}},"getValue")},{id:"force-channels-last",name:"Force channels-last memory format",category:["Memory"],type:"boolean",defaultValue:!1},{id:"directml",name:"DirectML device index",category:["Memory"],type:"number",defaultValue:null},{id:"disable-ipex-optimize",name:"Disable IPEX optimization",category:["Memory"],type:"boolean",defaultValue:!1},{id:"preview-method",name:"Method used for latent previews",category:["Preview"],type:"combo",options:Object.values(Mn),defaultValue:Mn.NoPreviews},{id:"preview-size",name:"Size of preview images",category:["Preview"],type:"slider",defaultValue:512,attrs:{min:128,max:2048,step:128}},{id:"cache-classic",name:"Use classic cache system",category:["Cache"],type:"boolean",defaultValue:!1},{id:"cache-lru",name:"Use LRU caching with a maximum of N node results cached.",category:["Cache"],type:"number",defaultValue:null,tooltip:"May use more RAM/VRAM."},{id:"cross-attention-method",name:"Cross attention method",category:["Attention"],type:"combo",options:Object.values(Vo),defaultValue:Vo.Auto,getValue:n(e=>{switch(e){case Vo.Auto:return{};default:return{[`use-${e.toLowerCase()}-cross-attention`]:!0}}},"getValue")},{id:"disable-xformers",name:"Disable xFormers optimization",type:"boolean",defaultValue:!1},{id:"force-upcast-attention",name:"Force attention upcast",category:["Attention"],type:"boolean",defaultValue:!1},{id:"dont-upcast-attention",name:"Prevent attention upcast",category:["Attention"],type:"boolean",defaultValue:!1},{id:"vram-management",name:"VRAM management mode",category:["Memory"],type:"combo",options:Object.values(Wo),defaultValue:Wo.Auto,getValue:n(e=>{switch(e){case Wo.Auto:return{};default:return{[e]:!0}}},"getValue")},{id:"reserve-vram",name:"Reserved VRAM (GB)",category:["Memory"],type:"number",defaultValue:null,tooltip:"Set the amount of vram in GB you want to reserve for use by your OS/other software. By default some amount is reserved depending on your OS."},{id:"default-hashing-function",name:"Default hashing function for model files",type:"combo",options:Object.values(Pn),defaultValue:Pn.SHA256},{id:"disable-smart-memory",name:"Disable smart memory management",tooltip:"Force ComfyUI to aggressively offload to regular ram instead of keeping models in vram when it can.",category:["Memory"],type:"boolean",defaultValue:!1},{id:"deterministic",name:"Make pytorch use slower deterministic algorithms when it can.",type:"boolean",defaultValue:!1,tooltip:"Note that this might not make images deterministic in all cases."},{id:"fast",name:"Enable some untested and potentially quality deteriorating optimizations.",type:"boolean",defaultValue:!1},{id:"dont-print-server",name:"Don't print server output to console.",type:"boolean",defaultValue:!1},{id:"disable-metadata",name:"Disable saving prompt metadata in files.",type:"boolean",defaultValue:!1},{id:"disable-all-custom-nodes",name:"Disable loading all custom nodes.",type:"boolean",defaultValue:!1},{id:"log-level",name:"Logging verbosity level",type:"combo",options:Object.values(In),defaultValue:In.INFO,getValue:n(e=>({verbose:e}),"getValue")},{id:"input-directory",name:"Input directory",category:["Directories"],type:"text",defaultValue:""},{id:"output-directory",name:"Output directory",category:["Directories"],type:"text",defaultValue:""}],y0=7*24*60*60*1e3,sl=Vt("versionCompatibility",()=>{const e=$a(),o=b(()=>hr.app_version),t=b(()=>e.systemStats?.system?.comfyui_version??""),a=b(()=>e.systemStats?.system?.required_frontend_version??""),l=b(()=>!o.value||!a.value||!ao.valid(o.value)||!ao.valid(a.value)?!1:ao.gt(a.value,o.value)),s=b(()=>!1),i=b(()=>l.value),r=b(()=>!o.value||!t.value||!a.value?null:`${o.value}-${t.value}-${a.value}`),u=Ml("comfy.versionMismatch.dismissals",{},localStorage,{serializer:{read:n(C=>{try{return JSON.parse(C)}catch{return{}}},"read"),write:n(C=>JSON.stringify(C),"write")}}),c=b(()=>{if(!r.value)return!1;const C=u.value[r.value];return C?Date.now()<C:!1}),p=b(()=>i.value&&!c.value),g=b(()=>l.value?{type:"outdated",frontendVersion:o.value,requiredVersion:a.value}:null);async function d(){e.systemStats||await Js(e.isInitialized)}n(d,"checkVersionCompatibility");function w(){if(!r.value)return;const C=Date.now()+y0;u.value={...u.value,[r.value]:C}}n(w,"dismissWarning");async function h(){await d()}return n(h,"initialize"),{frontendVersion:o,backendVersion:t,requiredFrontendVersion:a,hasVersionMismatch:i,shouldShowWarning:p,warningMessage:g,isFrontendOutdated:l,isFrontendNewer:s,checkVersionCompatibility:d,dismissWarning:w,initialize:h}});function b0(e={}){const{immediate:o=!1}=e,{t}=ce(),a=wt(),l=sl();let s=!1;const i=n(()=>{if(s)return;const r=l.warningMessage;if(!r)return;const u=t("g.frontendOutdated",{frontendVersion:r.frontendVersion,requiredVersion:r.requiredVersion}),c=t("g.versionMismatchWarningMessage",{warning:t("g.versionMismatchWarning"),detail:u});a.addAlert(c),s=!0,l.dismissWarning()},"showWarning");return De(()=>{o&&Ko(()=>l.shouldShowWarning,()=>{i()},{immediate:!0,once:!0})}),{showWarning:i,shouldShowWarning:b(()=>l.shouldShowWarning),dismissWarning:l.dismissWarning,hasVersionMismatch:b(()=>l.hasVersionMismatch)}}n(b0,"useFrontendVersionMismatchWarning");function w0(){const e=Ra(),o=co();let t=!1,a=0;he.addEventListener("graphChanged",()=>{o.mode==="change"&&(a?t=!0:(t=!1,j.queuePrompt(0,o.batchCount),a++))}),e.$subscribe(async()=>{a=e.count,!a&&!j.lastExecutionError&&(o.mode==="instant"||o.mode==="change"&&t)&&(t=!1,await j.queuePrompt(0,o.batchCount))},{detached:!0})}n(w0,"setupAutoQueueHandler");const k0={class:"absolute w-full h-full"},C0={class:"workflow-tabs-container pointer-events-auto h-9.5 w-full"},S0={class:"flex h-full items-center"},x0={class:"sidebar-content-container h-full w-full overflow-x-hidden overflow-y-auto border-r-1 border-node-component-border"},$0=["src"],_0={key:0,class:"pointer-events-none object-contain flex-1 max-h-full brightness-50 opacity-10",src:br},T0={class:"actionbar-container flex h-12 items-center rounded-lg border border-[var(--interface-stroke)] p-2 gap-2 bg-comfy-menu-bg justify-end"},N0={class:"rounded-lg border p-2 gap-2 h-full border-[var(--interface-stroke)] bg-comfy-menu-bg flex flex-col"},M0={class:"grow-1 flex justify-start flex-col overflow-y-auto contain-size *:max-h-100"},I0={class:"p-4 pb-0 border-t border-node-component-border"},P0=K({__name:"LinearView",setup(e){const o=Ot(),t=ke(),a=b(()=>{function p(g){const d=Ja(g,new Map),w=g.widgets?.map(h=>{const C=d(h);return C.callback=function(f){if(cb(f))return h.value=f??void 0,h.callback?.(h.value)},C})??[];return{id:`${g.id}`,title:g.title,type:g.type,mode:0,selected:!1,executing:!1,widgets:w}}return n(p,"nodeToNodeData"),j.graph.nodes.filter(g=>g.mode===0&&g.widgets?.length).map(p)}),{isLoggedIn:l}=Xt(),s=ze(),i={options:{step2:1,precision:1,min:1,max:100},value:1,name:Z("Number of generations"),type:"number"},{batchCount:r}=at(co());async function u(p){const d="shiftKey"in p&&p.shiftKey?"Comfy.QueuePromptFront":"Comfy.QueuePrompt";r.value>1,await t.execute(d,{metadata:{subscribe_to_run:!1,trigger_source:"button"}})}n(u,"runButtonClick");function c(){window.open("https://support.comfy.org/hc/en-us/requests/new?ticket_form_id=40026345549204","_blank","noopener,noreferrer")}return n(c,"openFeedback"),(p,g)=>(m(),T("div",k0,[y("div",C0,[y("div",S0,[L(Qa),L(Ka)])]),L(v(wn),{class:"h-[calc(100%-38px)] w-full bg-comfy-menu-secondary-bg",pt:{gutter:{class:"bg-transparent w-4 -mx-3"}}},{default:E(()=>[L(v(Tt),{size:1,class:"min-w-min bg-comfy-menu-bg"},{default:E(()=>[y("div",x0,[L(Jn,{extension:v(yr)()},null,8,["extension"])])]),_:1}),L(v(Tt),{size:98,class:"flex flex-row overflow-y-auto flex-wrap min-w-min gap-4 m-4"},{default:E(()=>[(m(!0),T(le,null,we(v(o).latestOutput,d=>(m(),T("img",{key:d,class:"pointer-events-none object-contain flex-1 max-h-full",src:d},null,8,$0))),128)),v(o).latestOutput.length===0?(m(),T("img",_0)):A("",!0)]),_:1}),L(v(Tt),{size:1,class:"flex flex-col gap-1 p-1 min-w-min"},{default:E(()=>[y("div",T0,[L(v(re),{label:v(Z)("g.feedback"),severity:"secondary",onClick:c},null,8,["label"]),L(v(re),{label:v(Z)("linearMode.openWorkflow"),severity:"secondary",class:"min-w-max",icon:"icon-[comfy--workflow]","icon-pos":"right",onClick:g[0]||(g[0]=d=>v(fe)().linearMode=!1)},null,8,["label"]),L(v(re),{label:v(Z)("linearMode.share"),severity:"contrast",onClick:g[1]||(g[1]=d=>v(tt)().exportWorkflow("workflow","workflow"))},null,8,["label"]),v(l)?(m(),O(Ba,{key:0})):v(s)?(m(),O(za,{key:1})):A("",!0)]),y("div",N0,[y("div",M0,[(m(!0),T(le,null,we(a.value,d=>(m(),O(Pa,{key:d.id,"node-data":d,class:"border-b-1 border-node-component-border pt-1 pb-2 last:border-none"},null,8,["node-data"]))),128))]),y("div",I0,[L(Nr,{modelValue:v(r),"onUpdate:modelValue":g[2]||(g[2]=d=>st(r)?r.value=d:null),widget:i,class:"*:[.min-w-56]:basis-0"},null,8,["modelValue"]),L(v(re),{label:v(Z)("menu.run"),class:"w-full mt-4",icon:"icon-[lucide--play]",onClick:u},null,8,["label"])])])]),_:1})]),_:1})]))}}),R0={class:"comfyui-body grid h-full w-full overflow-hidden"},D0=K({__name:"GraphView",setup(e){w0(),g0(),o0();const{t:o}=ce(),t=Wt(),a=ne(),l=Je(),s=ft(),i=xt(),r=va(),u=sl(),c=R(null),{linearMode:p}=at(fe());wr(),te(()=>s.completedActivePalette,N=>{const I="dark-theme";N.light_theme?document.body.classList.remove(I):document.body.classList.add(I),ze()&&uo().changeTheme({color:"rgba(0, 0, 0, 0)",symbolColor:N.colors.comfy_base["input-text"]})},{immediate:!0}),ze()&&te(()=>i.tasks,(N,I)=>{const V=new Set(I.filter(P=>P.isRunning).map(P=>P.promptId));N.filter(P=>V.has(P.promptId)&&P.isHistory).forEach(P=>{uo().Events.incrementUserProperty(`execution:${P.displayStatus.toLowerCase()}`,1),uo().Events.trackEvent("execution",{status:P.displayStatus.toLowerCase()})})},{deep:!0}),be(()=>{const N=a.get("Comfy.TextareaWidget.FontSize");document.documentElement.style.setProperty("--comfy-textarea-font-size",`${N}px`)}),be(()=>{const N=a.get("Comfy.TreeExplorer.ItemPadding");document.documentElement.style.setProperty("--comfy-tree-explorer-item-padding",`${N}px`)}),be(async()=>{const N=a.get("Comfy.Locale");if(N)try{await Cr(N),ua.global.locale.value=N}catch(I){console.error(`Failed to switch to locale "${N}":`,I)}});const g=b(()=>a.get("Comfy.UseNewMenu"));be(()=>{g.value==="Disabled"?(j.ui.menuContainer.style.setProperty("display","block"),j.ui.restoreMenuPosition()):j.ui.menuContainer.style.setProperty("display","none")}),be(()=>{i.maxHistoryItems=a.get("Comfy.Queue.MaxHistoryItems")});const d=n(()=>{const N=v0();ke().registerCommands(N),Ca().registerCoreMenuCommands(),un().registerCoreKeybindings(),Qt().registerCoreSidebarTabs(),Yt().registerCoreBottomPanelTabs(),j.extensionManager=lt()},"init"),w=Ra(),h=Qt(),C=n(async N=>{w.update(N),await i.update(),h.activeSidebarTabId==="assets"&&await r.updateHistory()},"onStatus"),f=n(async()=>{await i.update(),h.activeSidebarTabId==="assets"&&await r.updateHistory()},"onExecutionSuccess"),S={severity:"error",summary:o("g.reconnecting")},$=n(()=>{a.get("Comfy.Toast.DisableReconnectingToast")||(t.remove(S),t.add(S))},"onReconnecting"),k=n(()=>{a.get("Comfy.Toast.DisableReconnectingToast")||(t.remove(S),t.add({severity:"success",summary:o("g.reconnected"),life:2e3}))},"onReconnected");De(()=>{he.addEventListener("status",C),he.addEventListener("execution_success",f),he.addEventListener("reconnecting",$),he.addEventListener("reconnected",k),l.bindExecutionEvents();try{d(),c.value?.prepend(j.ui.menuContainer)}catch(N){console.error("Failed to init ComfyUI frontend",N)}}),Ct(()=>{he.removeEventListener("status",C),he.removeEventListener("execution_success",f),he.removeEventListener("reconnecting",$),he.removeEventListener("reconnected",k),l.unbindExecutionEvents()}),Re(window,"keydown",un().keybindHandler);const{wrapWithErrorHandling:x,wrapWithErrorHandlingAsync:_}=ho();b0({immediate:!0}),Le(()=>{u.initialize().catch(N=>{console.warn("Version compatibility check failed:",N)})});const M=n(()=>{Va(()=>{x(un().registerUserKeybindings)(),x(Tr().loadServerConfig)(h0,a.get("Comfy.Server.ServerConfigValues")),_(kr().loadModelFolders)(),_(Fn().loadNodeFrequencies)(),ut().nodeSearchService.searchNode("")},1e3)},"onGraphReady");return(N,I)=>(m(),T(le,null,[y("div",R0,[I[0]||(I[0]=y("div",{id:"comfyui-body-top",class:"comfyui-body-top"},null,-1)),I[1]||(I[1]=y("div",{id:"comfyui-body-bottom",class:"comfyui-body-bottom"},null,-1)),I[2]||(I[2]=y("div",{id:"comfyui-body-left",class:"comfyui-body-left"},null,-1)),I[3]||(I[3]=y("div",{id:"comfyui-body-right",class:"comfyui-body-right"},null,-1)),ue(y("div",{id:"graph-canvas-container",ref_key:"graphCanvasContainerRef",ref:c,class:"graph-canvas-container"},[L(jw,{onReady:M})],512),[[Qe,!v(p)]]),v(p)?(m(),O(P0,{key:0})):A("",!0)]),L(Pd),L(Qw),L(e0),v(ze)()?A("",!0):(m(),O(Ld,{key:0})),L(Ad)],64))}}),A0=Se(D0,[["__scopeId","data-v-28426374"]]),Q0=Object.freeze(Object.defineProperty({__proto__:null,default:A0},Symbol.toStringTag,{value:"Module"}));export{Q0 as G,Hd as g};
//# sourceMappingURL=GraphView-JQ93MQWb.js.map
